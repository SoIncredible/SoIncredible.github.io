<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>EddieLee</title>
  
  <subtitle>to infinity and beyondâœ¨ğŸ›¸.</subtitle>
  <link href="https://soincredible.github.io/atom.xml" rel="self"/>
  
  <link href="https://soincredible.github.io/"/>
  <updated>2025-05-22T01:30:50.985Z</updated>
  <id>https://soincredible.github.io/</id>
  
  <author>
    <name>Eddie Lee</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>CSharpä¸­çš„å§”æ‰˜</title>
    <link href="https://soincredible.github.io/posts/4f9ac505/"/>
    <id>https://soincredible.github.io/posts/4f9ac505/</id>
    <published>2025-05-22T01:00:06.000Z</published>
    <updated>2025-05-22T01:30:50.985Z</updated>
    
    <content type="html"><![CDATA[<h1>å§”æ‰˜</h1><p>ä¸€ç¯‡å¾ˆå¥½çš„åšå®¢https://www.cnblogs.com/skysoot/archive/2012/04/05/2433639.html</p><p>C#ä¸­çš„å§”æ‰˜ç±»ä¼¼äºCæˆ–C++ä¸­çš„å‡½æ•°æŒ‡é’ˆã€‚å§”æ‰˜æ˜¯å­˜æœ‰å¯¹æŸä¸ªæ–¹æ³•çš„å¼•ç”¨çš„ä¸€ç§å¼•ç”¨ç±»å‹å˜é‡ï¼Œå¼•ç”¨å¯åœ¨è¿è¡Œæ—¶è¢«æ”¹å˜ã€‚</p><p>å§”æ‰˜ç‰¹åˆ«ç”¨äºå®ç°äº‹ä»¶å’Œå›è°ƒæ–¹æ³•ã€‚æ‰€æœ‰çš„å§”æ‰˜éƒ½æ´¾ç”Ÿè‡ª<code>System.Delegate</code>ç±»ã€‚</p><h2 id="ä»å®é™…é—®é¢˜å‡ºå‘æ¥ç†è§£å§”æ‰˜">ä»å®é™…é—®é¢˜å‡ºå‘æ¥ç†è§£å§”æ‰˜</h2><h3 id="å°†æ–¹æ³•ä½œä¸ºæ–¹æ³•çš„å‚æ•°">å°†æ–¹æ³•ä½œä¸ºæ–¹æ³•çš„å‚æ•°</h3><p>è¿™ä¸ªæ ‡é¢˜éå¸¸åœ°æ‹—å£ï¼Œä½†æˆ‘ä»¬å…ˆä¸ç®¡å®ƒï¼Œæ¥çœ‹ä¸¤ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GreetPeople</span>(<span class="params"><span class="built_in">string</span> name</span>)</span>&#123;</span><br><span class="line">EnglishGreeting(name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">EnglishGreeting</span>(<span class="params"><span class="built_in">string</span> name</span>)</span>&#123;</span><br><span class="line">  Console.WriteLine(<span class="string">&quot;Good Moring,&quot;</span> + name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆä¸ç®¡è¿™ä¸¤ä¸ªæ–¹æ³•æœ‰æ²¡æœ‰å®é™…çš„æ„ä¹‰ï¼Œæˆ‘ä»¬ç°åœ¨æƒ³é€šè¿‡è¿™ä¸¤ä¸ªæ–¹æ³•æ¥å‘æŸäººé—®å¥½ï¼Œå½“ä¼ å…¥æŸäººçš„å§“åæ—¶ï¼Œæ¯”å¦‚è¯´&quot;Joe&quot;è¿›å»çš„æ—¶å€™ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­å°†è°ƒç”¨EnglishGreetingæ–¹æ³•ï¼Œå†æ¬¡ä¼ é€’nameå‚æ•°ï¼ŒEnglishGreetingæ–¹æ³•åˆ™ç”¨äºå‘å±å¹•è¾“å‡º&quot;Good Moring, Joe&quot;ã€‚</p><p>é‚£ä¹ˆç°åœ¨ï¼Œå‡è®¾è¿™ä¸ªç¨‹åºè¦è¿›è¡Œå…¨çƒåŒ–äº†ï¼Œæˆ‘ä½œä¸ºä¸€ä¸ªä¸­å›½äººï¼Œæˆ‘ä¸ç†è§£&quot;Good Moring&quot;æ˜¯ä»€ä¹ˆæ„æ€ï¼Œé‚£æˆ‘å°±åªèƒ½å†åŠ ä¸€ä¸ªä¸­æ–‡çš„é—®å€™æ–¹æ³•ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ChineseGreeting</span>(<span class="params"><span class="built_in">string</span> name</span>)</span>&#123;</span><br><span class="line">Console.WriteLine(<span class="string">&quot;æ—©ä¸Šå¥½ï¼Œ&quot;</span>+name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™GreetPeopleä¹Ÿéœ€è¦æ”¹ä¸€ä¸‹äº†ï¼Œä¸ç„¶å¦‚ä½•åˆ¤æ–­åˆ°åº•ç”¨å“ªä¸ªç‰ˆæœ¬çš„Greetingé—®å€™æ–¹æ³•åˆé€‚å‘¢ï¼Ÿå½“ç„¶åœ¨è¿›è¡Œè¿™ä¸ªä¹‹å‰ï¼Œæˆ‘ä»¬æœ€å¥½å†å®šä¹‰ä¸€ä¸ªæšä¸¾ä½œä¸ºåˆ¤æ–­çš„ä¾æ®ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> Language&#123;</span><br><span class="line">English, Chinese</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GreetPeople</span>(<span class="params"><span class="built_in">string</span> name, Language lang</span>)</span>&#123;</span><br><span class="line"><span class="keyword">switch</span>(lang)&#123;</span><br><span class="line"><span class="keyword">case</span> Language.English:</span><br><span class="line">EnglishGreeting(name);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> Language.Chinese:</span><br><span class="line">    ChineseGreeting(name);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>OKï¼Œå°½ç®¡è¿™æ ·è§£å†³äº†é—®é¢˜ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•çš„å¯æ‰©å±•æ€§å¤ªå·®äº†ï¼Œå¦‚æœä¹‹åæˆ‘ä»¬è¿˜è¦å†æ·»åŠ éŸ©æ–‡ç‰ˆã€æ—¥æ–‡ç‰ˆï¼Œæˆ‘ä»¬å°±ä¸å¾—ä¸åå¤ä¿®æ”¹æšä¸¾å’ŒGreetPeopleçš„æ–¹æ³•ï¼Œæ¥é€‚åº”æ–°çš„éœ€æ±‚ã€‚</p><p>é‚£ä¹ˆåœ¨è€ƒè™‘æ–°çš„è§£å†³æ–¹æ¡ˆä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹GreetPeopleçš„æ–¹æ³•ç­¾åï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GreetPeople</span>(<span class="params"><span class="built_in">string</span> name, Language lang</span>)</span>;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åªçœ‹<code>string name</code>ï¼Œåœ¨è¿™é‡Œï¼Œstringæ˜¯å‚æ•°ç±»å‹ï¼Œnameæ˜¯å‚æ•°å˜é‡ï¼Œå½“æˆ‘ä»¬èµ‹ç»™nameå­—ç¬¦ä¸²&quot;Joe&quot;æ—¶ï¼Œä»–å°±ä»£è¡¨äº†&quot;Joe&quot;è¿™ä¸ªå€¼ï¼›å½“æˆ‘ä»¬èµ‹ç»™ä»–&quot;å‘¨æ°ä¼¦&quot;æ—¶ï¼Œå®ƒåˆä»£è¡¨ç€&quot;å‘¨æ°ä¼¦&quot;è¿™ä¸ªå€¼ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä½“å†…å¯¹è¿™ä¸ªnameè¿›è¡Œå…¶ä»–çš„æ“ä½œã€‚</p><p>é‚£æˆ‘ä»¬å†ä»”ç»†æƒ³ä¸€æƒ³ï¼Œå‡å¦‚GreetPeopleæ–¹æ³•å¯ä»¥æ¥å—ä¸€ä¸ªå‚æ•°å˜é‡ï¼Œè¿™ä¸ªå˜é‡å¯ä»¥ä»£è¡¨å¦ä¸€ä¸ªæ–¹æ³•ï¼Œå½“æˆ‘ä»¬ç»™è¿™ä¸ªå˜é‡èµ‹å€¼EnglishGreetingçš„æ—¶å€™å®ƒä»£è¡¨ç€EnglishGreeting()è¿™ä¸ªæ–¹æ³•ï¼›å½“æˆ‘ä»¬ç»™å®ƒèµ‹å€¼ChineseGreetingçš„æ—¶å€™ï¼Œå®ƒåˆä»£è¡¨ç€ChineseGreeting()çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªå‚æ•°å˜é‡å‘½åä¸ºMakeGreetingï¼Œé‚£ä¹ˆä¸æ˜¯å¯ä»¥å¦‚åŒç»™nameèµ‹å€¼çš„æ—¶å€™ä¸€æ ·ï¼Œåœ¨è°ƒç”¨Greet People()æ–¹æ³•çš„æ—¶å€™ï¼Œç»™è¿™ä¸ªMakeGreetingå‚æ•°ä¹Ÿé™„ä¸Šå€¼ä¹ˆï¼Œç„¶åæˆ‘ä»¬åœ¨æ–¹æ³•ä½“å†…ï¼Œä¹Ÿå¯ä»¥åƒä½¿ç”¨åˆ«çš„å‚æ•°ä¸€æ ·ä½¿ç”¨MakeGreetingã€‚ä½†æ˜¯ï¼Œç”±äºMakeGreetingä»£è¡¨ç€ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒçš„ä½¿ç”¨æ–¹å¼åº”è¯¥å’Œå®ƒè¢«èµ‹çš„æ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œæ¯”å¦‚<code>MakeGreeting(name)</code>ï¼›</p><p>å¥½äº†ï¼Œæœ‰äº†æ€è·¯äº†ï¼Œæˆ‘ä»¬ç°åœ¨å°±æ¥æ”¹æ”¹GreetPeople()æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥æ˜¯è¿™ä¸ªæ ·å­ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GreetPeople</span>(<span class="params"><span class="built_in">string</span> name, *** MakeGreeting</span>)</span>&#123;</span><br><span class="line">MakeGreeting(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ° ***ï¼Œè¿™ä¸ªä½ç½®é€šå¸¸æ”¾ç½®çš„åº”è¯¥æ˜¯å‚æ•°çš„ç±»å‹ï¼Œä½†æ˜¯åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä»…ä»…æƒ³åˆ°çš„æ˜¯åº”è¯¥æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”æŒ‰ç…§è¿™ä¸ªæ€è·¯å»æ”¹å†™GreetPeopleæ–¹æ³•ï¼Œç°åœ¨å°±å‡ºç°äº†ä¸€ä¸ªå¤§é—®é¢˜ï¼šè¿™ä¸ªä»£è¡¨ç€æ–¹æ³•çš„MakeGreetingå‚æ•°åº”è¯¥æ˜¯ä»€ä¹ˆç±»å‹çš„ï¼Ÿ</p><p>**è¯´æ˜ï¼š**è¿™é‡Œå·²ç»ä¸å†éœ€è¦æšä¸¾äº†ï¼Œå› ä¸ºåœ¨ç»™MakeGreetingèµ‹å€¼çš„æ—¶å€™åŠ¨æ€åœ°å†³å®šä½¿ç”¨å“ªä¸ªæ–¹æ³•ï¼Œæ˜¯ChineseGreetingè¿˜æ˜¯EnglishGreetingï¼Œè€Œåœ¨è¿™ä¸¤ä¸ªæ–¹æ³•å†…éƒ¨ï¼Œå·²ç»å¯¹ä½¿ç”¨GroodMoringè¿˜æ˜¯æ—©ä¸Šå¥½åšäº†åŒºåˆ†ã€‚</p><p>ä¸‹é¢å°±è¯¥å§”æ‰˜å‡ºåœºäº†ï¼š</p><p>æˆ‘ä»¬MakeGreetingä»£è¡¨çš„ä¸¤ä¸ªæ–¹æ³•çš„ç­¾åå¦‚ä¸‹ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">EnglishGreeting</span>(<span class="params"><span class="built_in">string</span> name</span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">chineseGreeting</span>(<span class="params"><span class="built_in">string</span> name</span>)</span>;</span><br></pre></td></tr></table></figure><p>å¦‚åŒ<code>name</code>å¯ä»¥æ¥å—stringç±»å‹çš„æ•°æ®ä¸€æ ·ï¼ŒMakeGreetingå®ƒä¹Ÿä»£è¡¨ç€æ¥å—ç›¸åŒçš„ä¸€ç±»æ•°æ®ï¼Œå†è¿›ä¸€æ­¥è®²ï¼Œå°±æ˜¯MakeGreetingä»£è¡¨äº†å‚æ•°ç±»å‹å’Œè¿”å›ç±»å‹éƒ½ç›¸åŒçš„ä¸€ç±»æ–¹æ³•ã€‚æœ¬ä¾‹ä¸­å§”æ‰˜çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">GreetingDelegate</span>(<span class="params"><span class="built_in">string</span> name</span>)</span>;</span><br></pre></td></tr></table></figure><p>ä¸ä¸Šé¢EnglishGreeting()æ–¹æ³•çš„ç­¾åå¯¹æ¯”ä¸€ä¸‹ï¼Œå‡ºäº†åŠ å…¥delegateå…³é”®å­—ä»¥å¤–ï¼Œå…¶ä»–çš„éƒ¨åˆ†éƒ½æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œé‚£ä¹ˆå†æ¬¡è°ƒç”¨GreetPeopleæ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">Greetingdelegate</span>(<span class="params"><span class="built_in">string</span> name</span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GreetPeople</span>(<span class="params"><span class="built_in">string</span> name, Greetingdelegate MakeGreeting</span>)</span>&#123;</span><br><span class="line">MakeGreeting(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å§”æ‰˜Greeting Delegatå‡ºç°çš„ä½ç½®å’Œstringç›¸åŒï¼Œstringæ˜¯ä¸€ä¸ªç±»å‹ï¼ŒGreeting Delegateä¹Ÿæ˜¯ä¸€ä¸ªç±»å‹ï¼Œæˆ–è€…è¯´æ˜¯ä¸€ä¸ªç±»ã€‚ä½†æ˜¯å§”æ‰˜çš„å£°æ˜æ–¹å¼å’Œç±»å®Œå…¨ä¸åŒã€‚å®é™…ä¸Šï¼Œå§”æ‰˜åœ¨ç¼–è¯‘çš„æ—¶å€™ç¡®å®ä¼šè¢«ç¼–è¯‘æˆç±»ã€‚å› ä¸ºDelegateæ˜¯ä¸€ä¸ªç±»ï¼Œæ‰€ä»¥åœ¨ä»»ä½•å¯ä»¥å£°æ˜ç±»çš„åœ°æ–¹éƒ½å¯ä»¥å£°æ˜å§”æ‰˜ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä»£ç ã€‚</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">GreetingDelegate</span>(<span class="params"><span class="built_in">string</span> name</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">EnglishGreeting</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Good Morning, &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ChineseGreeting</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æ—©ä¸Šå¥½, &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">GreetPeople</span>(<span class="params"><span class="built_in">string</span> name, GreetingDelegate MakeGreeting</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        MakeGreeting(name);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        GreetPeople(<span class="string">&quot;Joe&quot;</span>, EnglishGreeting);</span><br><span class="line">        GreetPeople(<span class="string">&quot;å‘¨æ°ä¼¦&quot;</span>, ChineseGreeting);</span><br><span class="line">        Console.ReadLine();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“åˆæ¸¸æˆå¼€å‘ä¸­çš„å®é™…åº”ç”¨ï¼Œæˆ‘ä»¬ç»å¸¸è®²å§”æ‰˜å’Œå•ä¾‹æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼ç­‰è®¾è®¡æ¨¡å¼ç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ï¼Œä¸‹é¢æˆ‘å°†å°è¯•æŠ½è±¡å‡ºä¸€ä¸ªäº‹ä»¶ä¸­å¿ƒçš„ç±»ï¼Œå®ƒä¸“é—¨è´Ÿè´£å¤„ç†å„ç§å§”æ‰˜äº‹ä»¶ï¼Œç”±äºåœ¨ä¸€ä¸ªæ¸¸æˆè¿›ç¨‹ä¸­åªä¼šæœ‰ä¸€ä¸ª<strong>äº‹ä»¶å¤„ç†ä¸­å¿ƒ</strong>ï¼Œæ‰€ä»¥æˆ‘è¦å°†å®ƒè®¾è®¡æˆ<a href="http://soincredible777.com.cn/posts/279644bd/">å•ä¾‹æ¨¡å¼</a>ã€‚</p><p><strong>æˆ‘ä»¬ç°åœ¨å¯¹å§”æ‰˜åšä¸€ä¸ªæ€»ç»“ï¼šå§”æ‰˜æ˜¯ä¸€ä¸ªç±»ï¼Œå®ƒå®šä¹‰äº†æ–¹æ³•çš„ç±»å‹ï¼Œä½¿å¾—å¯ä»¥å°†æ–¹æ³•ä½œä¸ºå¦ä¸€ä¸ªæ–¹æ³•çš„å‚æ•°æ¥è¿›è¡Œä¼ é€’ï¼Œè¿™ç§å°†æ–¹æ³•åŠ¨æ€åœ°èµ‹ç»™å‚æ•°çš„åšæ³•ï¼Œå¯ä»¥é¿å…åœ¨ç¨‹åºä¸­å¤§é‡åœ°ä½¿ç”¨if-else(switch)è¯­å¥ï¼ŒåŒæ—¶ä½¿å¾—ç¨‹åºå…·æœ‰æ›´å¥½çš„å¯æ‰©å±•æ€§ã€‚</strong></p><h2 id="å£°æ˜å§”æ‰˜">å£°æ˜å§”æ‰˜</h2><p>å§”æ‰˜å£°æ˜å†³å®šäº†å¯ç”±è¯¥å§”æ‰˜å¼•ç”¨çš„æ–¹æ³•ã€‚å§”æ‰˜å¯æŒ‡å‘ä¸€ä¸ªä¸å…¶å…·æœ‰ç›¸åŒæ ‡ç­¾çš„æ–¹æ³•ã€‚</p><p>å‡è®¾æœ‰ä¸€ä¸ªå§”æ‰˜ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="built_in">int</span> <span class="title">MyDelegate</span>(<span class="params"><span class="built_in">string</span> s</span>)</span>;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„å§”æ‰˜å¯è¢«ç”¨äºå¼•ç”¨ä»»ä½•ä¸€ä¸ªå¸¦æœ‰ä¸€ä¸ªå•ä¸€çš„stringå‚æ•°çš„æ–¹æ³•ï¼Œå¹¶è¿”å›ä¸€ä¸ªint ç±»å‹çš„å˜é‡ã€‚</p><p>å£°æ˜å§”æ‰˜çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">delegate</span> &lt;<span class="keyword">return</span> type&gt;&lt;<span class="built_in">delegate</span>-name&gt;&lt;parameter list&gt;</span><br></pre></td></tr></table></figure><h2 id="å®ä¾‹åŒ–å§”æ‰˜">å®ä¾‹åŒ–å§”æ‰˜</h2><p>ä¸€æ—¦å£°æ˜äº†å§”æ‰˜ç±»å‹ï¼Œå§”æ‰˜å¯¹è±¡å°±å¿…é¡»ä½¿ç”¨newå…³é”®å­—æ¥åˆ›å»ºï¼Œå¹¶ä¸”ä¸ä¸€ä¸ªç‰¹å®šçš„æ–¹æ³•æœ‰å…³ï¼Œå½“å§”æ‰˜åˆ›å»ºæ—¶ï¼Œä¼ é€’åˆ°newè¯­å¥çš„å‚æ•°å°±åƒæ–¹æ³•è°ƒç”¨ä¸€æ ·ä¹¦å†™ï¼Œä½†æ˜¯ä¸å¸¦æœ‰å‚æ•°ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">printString</span>(<span class="params"><span class="built_in">string</span> s</span>)</span>;</span><br><span class="line">pringString ps1 = <span class="keyword">new</span> printString(WriteToScreen);</span><br><span class="line">printString ps2 = <span class="keyword">new</span> printString(WriteToFile);</span><br></pre></td></tr></table></figure><p>ä¸‹é¢çš„å®ä¾‹æ¼”ç¤ºäº†å§”æ‰˜çš„å£°æ˜ã€å®ä¾‹åŒ–å’Œä½¿ç”¨ï¼Œè¯¥å§”æ‰˜å¯ç”¨äºå¼•ç”¨å¸¦æœ‰ä¸€ä¸ªæ•´å½¢å‚æ•°çš„æ–¹æ³•ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ•´å‹å€¼ã€‚</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">delegate</span> <span class="built_in">int</span> <span class="title">NumberChanger</span>(<span class="params"><span class="built_in">int</span> n</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DelegateAppl</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">TestDelegate</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">int</span> num = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">AddNum</span>(<span class="params"><span class="built_in">int</span> p</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            num += p;</span><br><span class="line">            <span class="keyword">return</span> num;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">MultNum</span>(<span class="params"><span class="built_in">int</span> q</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            num *= q;</span><br><span class="line">            <span class="keyword">return</span> num;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">getNum</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> num;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            NumberChanger nc1 = <span class="keyword">new</span> NumberChanger(AddNum);</span><br><span class="line">            NumberChanger nc2 = <span class="keyword">new</span> NumberChanger(MultNum);</span><br><span class="line">            nc1(<span class="number">25</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Value of Num: &#123;0&#125;&quot;</span>, getNum());</span><br><span class="line">            nc2(<span class="number">5</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Value of Num: &#123;0&#125;&quot;</span>, getNum());</span><br><span class="line">            Console.ReadKey();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ä¸Šé¢ä»£ç è¢«ç¼–è¯‘å’Œæ‰§è¡Œçš„æ—¶å€™ï¼Œå®ƒä¼šäº§ç”Ÿå¦‚ä¸‹ç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Value of Num: 35</span><br><span class="line">Value of Num: 175</span><br></pre></td></tr></table></figure><p><strong>è¡¥å……ï¼š</strong></p><ol><li>å§”æ‰˜é‡Œé¢å­˜å‚¨çš„æ–¹æ³•å¯ä»¥æ˜¯é™æ€æ–¹æ³•ä¹Ÿå¯ä»¥æ˜¯éé™æ€çš„æ–¹æ³•ã€‚</li><li>å½“å£°æ˜çš„å§”æ‰˜åŒ…å«è¿”å›å€¼çš„æ—¶å€™ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨Invokeæ–¹æ³•ï¼Œå¦åˆ™åªä¼šå¾—åˆ°æœ€åä¸€ä¸ªæ–¹æ³•çš„ç»“æœã€‚</li><li>å®šä¹‰å§”æ‰˜ä¸å®šä¹‰æ–¹æ³•ç›¸æ¯”ï¼Œä¸€æ˜¯æ²¡æœ‰æ–¹æ³•ä½“ï¼Œè€Œæ˜¯å¤šç”¨äº†delegateä¿®é¥°ã€‚</li></ol><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="built_in">int</span> <span class="title">MyDelegate</span>(<span class="params"><span class="built_in">int</span> a, <span class="built_in">int</span> b</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">Test1</span>(<span class="params"><span class="built_in">int</span> a, <span class="built_in">int</span> b</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> a * b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">Test2</span>(<span class="params"><span class="built_in">int</span> a, <span class="built_in">int</span> b</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Program program = <span class="keyword">new</span> Program();</span><br><span class="line">        MyDelegate myDelegate = <span class="keyword">new</span> MyDelegate(program.Test1);</span><br><span class="line">        myDelegate += program.Test2;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// å°†delegateå­˜æ”¾åˆ°ä¸€ä¸ªæ•°ç»„ä¸­æ‰èƒ½ä¾æ¬¡è·å–æ¯ä¸€ä¸ªæ–¹æ³•çš„è¿”å›å€¼ã€‚</span></span><br><span class="line">        Delegate[] delegates = myDelegate.GetInvocationList();</span><br><span class="line">        <span class="keyword">foreach</span> (MyDelegate item <span class="keyword">in</span> delegates)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(item(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Console.ReadKey();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å§”æ‰˜çš„å¤šæ’­-Multicasting-of-a-Delegate">å§”æ‰˜çš„å¤šæ’­(Multicasting of a Delegate)</h2><p>å§”æ‰˜å¯¹è±¡å¯ä»¥ä½¿ç”¨&quot;+â€œè¿ç®—ç¬¦è¿›è¡Œåˆå¹¶ã€‚ä¸€ä¸ªåˆå¹¶å§”æ‰˜è°ƒç”¨å®ƒæ‰€åˆå¹¶çš„ä¸¤ä¸ªå§”æ‰˜ã€‚åªæœ‰ç›¸åŒç±»å‹çš„å§”æ‰˜å¯ä»¥è¢«åˆå¹¶ã€‚â€-&quot;è¿ç®—ç¬¦å¯ç”¨äºä»åˆå¹¶çš„å§”æ‰˜ä¸­ç§»é™¤ç»„ä»¶å§”æ‰˜ã€‚</p><p>ä½¿ç”¨å§”æ‰˜çš„è¿™ä¸ªç‰¹ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå§”æ‰˜è¢«è°ƒç”¨æ—¶è¦è°ƒç”¨çš„æ–¹æ³•çš„è°ƒç”¨åˆ—è¡¨ï¼Œè¿™ç§è¡Œä¸ºè¢«ç§°ä¸ºå§”æ‰˜çš„å¤šæ’­(multicasting)ï¼Œä¹Ÿå«ç»„æ’­ã€‚ä¸‹é¢çš„ç¨‹åºæ¼”ç¤ºäº†å§”æ‰˜çš„å¤šæ’­ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">delegate</span> <span class="built_in">int</span> <span class="title">NumberChanger</span>(<span class="params"><span class="built_in">int</span> n</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DelegateAppl</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">testdelegate</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">int</span> num = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">AddNum</span>(<span class="params"><span class="built_in">int</span> p</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            num += p;</span><br><span class="line">            <span class="keyword">return</span> num;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">MultNum</span>(<span class="params"><span class="built_in">int</span> q</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            num *= q;</span><br><span class="line">            <span class="keyword">return</span> num;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">getNum</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> num;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            NumberChanger nc;</span><br><span class="line">            NumberChanger nc1 = <span class="keyword">new</span> NumberChanger(AddNum);</span><br><span class="line">            NumberChanger nc2 = <span class="keyword">new</span> NumberChanger(MultNum);</span><br><span class="line"></span><br><span class="line">            nc = nc1;</span><br><span class="line">            nc += nc2;</span><br><span class="line">            nc += AddNum;</span><br><span class="line">            nc(<span class="number">5</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Value of Num: &#123;0&#125;&quot;</span>, getNum());</span><br><span class="line">            Console.ReadKey();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å§”æ‰˜çš„ç”¨é€”">å§”æ‰˜çš„ç”¨é€”</h2><p>ä¸‹é¢å®é™…æ¼”ç¤ºäº†å§”æ‰˜çš„ç”¨æ³•ï¼Œå§”æ‰˜<code>printString</code>å¯ç”¨äºå¼•ç”¨å¸¦æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºè¾“å…¥çš„æ–¹æ³•ï¼Œå¹¶ä¸è¿”å›ä»»ä½•ä¸œè¥¿ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªå§”æ‰˜æ¥è°ƒç”¨ä¸¤ä¸ªæ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªæŠŠå­—ç¬¦ä¸²æ‰“å°åˆ°æ§åˆ¶å°ï¼Œç¬¬äºŒä¸ªæŠŠå­—ç¬¦ä¸²æ‰“å°åˆ°æ–‡ä»¶ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DelegateAppl</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">PrintString</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> FileStream fs;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> StreamWriter sw;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">printString</span>(<span class="params"><span class="built_in">string</span> s</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">WriteToScreen</span>(<span class="params"><span class="built_in">string</span> str</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;The String is:&#123;0&#125;&quot;</span>, str);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">WriteToFile</span>(<span class="params"><span class="built_in">string</span> s</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            fs = <span class="keyword">new</span> FileStream(<span class="string">&quot;./message.txt&quot;</span>, FileMode.Append, FileAccess.Write);</span><br><span class="line">            sw = <span class="keyword">new</span> StreamWriter(fs);</span><br><span class="line">            sw.WriteLine(s);</span><br><span class="line">            sw.Flush();</span><br><span class="line">            sw.Close();</span><br><span class="line">            fs.Close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sendString</span>(<span class="params">printString ps</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            ps(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            printString ps1 = <span class="keyword">new</span> printString(WriteToScreen);</span><br><span class="line">            printString ps2 = <span class="keyword">new</span> printString(WriteToFile);</span><br><span class="line">            sendString(ps1);</span><br><span class="line">            sendString(ps2);</span><br><span class="line">            Console.ReadKey();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>äº‹ä»¶</h1><p>äº‹ä»¶åŸºæœ¬ä¸Šè¯´æ˜¯ä¸€ä¸ªç”¨æˆ·çš„æ“ä½œï¼Œæ¯”å¦‚æŒ‰é”®ã€ç‚¹å‡»ã€é¼ æ ‡ç§»åŠ¨ç­‰ç­‰ï¼Œæˆ–è€…æ˜¯ä¸€äº›æç¤ºä¿¡æ¯ï¼Œå¦‚ç³»ç»Ÿç”Ÿæˆçš„é€šçŸ¥ã€‚åº”ç”¨ç¨‹åºéœ€è¦åœ¨äº‹ä»¶å‘ç”Ÿæ—¶å“åº”äº‹ä»¶ï¼Œæ¯”å¦‚ä¸­æ–­ã€‚</p><p>C#ä¸­ä½¿ç”¨äº‹ä»¶æœºåˆ¶å®ç°çº¿ç¨‹é—´çš„é€šä¿¡ã€‚</p><p>äº‹ä»¶æ˜¯ä¸€ä¸ªå—é™åˆ¶çš„å§”æ‰˜ï¼Œå…ˆçœ‹å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">MyDelegate</span>()</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">MyDelegateClass</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> MyDelegate? myDelegate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (myDelegate != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            myDelegate();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Test</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        MyDelegateClass delegateClass = <span class="keyword">new</span> MyDelegateClass();</span><br><span class="line">        delegateClass.myDelegate += Run;</span><br><span class="line">        delegateClass.myDelegate.Invoke();</span><br><span class="line">        delegateClass.Test();</span><br><span class="line">        delegateClass.myDelegate = <span class="keyword">new</span> MyDelegate(Run);</span><br><span class="line">        delegateClass.myDelegate();</span><br><span class="line"></span><br><span class="line">        Console.ReadKey();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Run</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Running.......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç è¿è¡Œæ—¶æ²¡æœ‰é—®é¢˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨MyDelegateClassä¸­å£°æ˜çš„å§”æ‰˜ï¼Œæ—¢å¯ä»¥åœ¨å½“å‰ç±»ä¸­æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨å…¶ä»–çš„ç±»ä¸­æ‰§è¡Œï¼Œè¿˜å¯ä»¥åœ¨å…¶ä»–çš„ç±»ä¸­é‡æ–°èµ‹å€¼åå†è¢«è°ƒç”¨æ‰§è¡Œã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹äº‹ä»¶å£°æ˜çš„æƒ…å†µï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">delegate void MyDelegate();</span><br><span class="line"></span><br><span class="line">internal class MyDelegateClass</span><br><span class="line">&#123;</span><br><span class="line">    public event MyDelegate? myDelegate;</span><br><span class="line"></span><br><span class="line">    public void Test()</span><br><span class="line">    &#123;</span><br><span class="line">        if (myDelegate != null)</span><br><span class="line">        &#123;</span><br><span class="line">            myDelegate();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Test</span><br><span class="line">&#123;</span><br><span class="line">    static void Main(string[] args)</span><br><span class="line">    &#123;</span><br><span class="line">        MyDelegateClass delegateClass = new MyDelegateClass();</span><br><span class="line">        delegateClass.myDelegate += Run;</span><br><span class="line">        delegateClass.myDelegate.Invoke();</span><br><span class="line">        delegateClass.Test();</span><br><span class="line">        delegateClass.myDelegate = new MyDelegate(Run);</span><br><span class="line">        delegateClass.myDelegate();</span><br><span class="line"></span><br><span class="line">        Console.ReadKey();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static void Run()</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(&quot;Running.......&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°å£°æ˜äº‹ä»¶å…¶å®å°±æ˜¯åœ¨å£°æ˜å§”æ‰˜å˜é‡çš„æ¡ä»¶ä¸‹ï¼Œåªç”¨äº†ä¸ª<code>event</code>ä¿®é¥°è€Œå·²ï¼Œå³<code>myDelegate</code>ç°åœ¨æ˜¯ä¸€ä¸ªäº‹ä»¶å˜é‡ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå§”æ‰˜å˜é‡äº†ï¼Œæˆ‘ä»¬å‘ç°å®ƒä»ç„¶èƒ½åœ¨å½“å‰ç±»ä¸­è¢«æ‰§è¡Œï¼Œä½†æ˜¯åœ¨å¦å¤–çš„ä¸€ä¸ªç±»ä¸­ï¼Œæ—¢ä¸èƒ½è¢«ç›´æ¥è°ƒç”¨æ‰§è¡Œï¼Œä¹Ÿä¸èƒ½è¢«é‡æ–°èµ‹å€¼äº†ï¼Œåªèƒ½é€šè¿‡<code>+=</code>æˆ–è€…<code>-=</code>æ¥å¢å‡å‡½æ•°ï¼Œè¿™å°±æ˜¯äº‹ä»¶å­˜åœ¨çš„å¿…è¦ï¼Œå› ä¸ºäº‹ä»¶çš„è¿™ä¸¤ä¸ªé™åˆ¶æ¡ä»¶ï¼Œåœ¨æŸç§ç¨‹åº¦ä¸Šä¼šæ›´å®‰å…¨ã€‚</p><p>**ç–‘é—®ï¼š**å¦‚æœæˆ‘åœ¨ç±»ä¸­å£°æ˜äº†ä¸€ä¸ªå§”æ‰˜ï¼Œé‚£ä¹ˆåœ¨å®ä¾‹åŒ–è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œæˆ‘å¹¶æ²¡æœ‰æ˜¾å¼åœ°ç»™ç»™è¿™ä¸ªå§”æ‰˜èµ‹å€¼ï¼Œ<s>ä¸ºä»€ä¹ˆä¸ä¼šæŠ¥é”™å‘¢</s>ï¼Ÿä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨Mainå‡½æ•°ä¸­å®ä¾‹åŒ–ä¸€ä¸ªå§”æ‰˜ï¼Œä¸ç»™ä»–èµ‹å€¼çš„è¯ï¼Œå°±ä¼šæŠ¥é”™ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p><p>ä¸‹é¢çš„ä»£ç ç»™å‡ºäº†ç­”æ¡ˆï¼Œä¸Šé¢è¯´çš„ä¸¤ç§æƒ…å†µéƒ½ä¼šæŠ¥é”™çš„ï¼Œä½†æ˜¯åœ¨å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™è¿˜éœ€è¦æ‰‹åŠ¨åœ°åŠ ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶ï¼Œåˆ¤æ–­å®ä¾‹åŒ–çš„å¯¹è±¡ä¸­çš„å§”æ‰˜æ˜¯ä¸æ˜¯ç©ºçš„ã€‚</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">MyDelegate</span>()</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">MyDelegateClass</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">protected</span> MyDelegate? myDelegate;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RegitserDelegate</span>(<span class="params">MyDelegate mmm</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        myDelegate += mmm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">InvokeDelegate</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (myDelegate == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;å§”æ‰˜æ˜¯ç©ºçš„ï¼ä¸èƒ½è°ƒç”¨ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            myDelegate.Invoke();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Run</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Running.......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Func</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        MyDelegateClass delegateClass = <span class="keyword">new</span> MyDelegateClass();</span><br><span class="line">        delegateClass.InvokeDelegate();</span><br><span class="line">        MyDelegate mm = <span class="keyword">new</span> MyDelegate(MyDelegateClass.Run);</span><br><span class="line">        delegateClass.RegitserDelegate(mm);</span><br><span class="line">        delegateClass.InvokeDelegate();</span><br><span class="line">        Console.ReadKey();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ä¸­ç”¨åˆ°äº†ä¸€äº›è®¿é—®ä¿®é¥°ç¬¦</p><ul><li><code>public</code>: å…¬æœ‰è®¿é—®ï¼Œä¸å—ä»»ä½•é™åˆ¶</li><li><code>private</code>: ç§æœ‰è®¿é—®ï¼Œåªé™äºæœ¬ç±»æˆå‘˜è®¿é—®ï¼Œå­ç±»ã€å®ä¾‹éƒ½ä¸èƒ½è®¿é—®</li><li><code>protected</code>: ä¿æŠ¤è®¿é—®ï¼Œåªé™äºæœ¬ç±»å’Œå­ç±»è®¿é—®ï¼Œå®ä¾‹ä¸èƒ½è®¿é—®</li><li><code>internal</code>: å†…éƒ¨è®¿é—®ï¼Œ åªé™äºæœ¬é¡¹ç›®å†…è®¿é—®ï¼Œå…¶ä»–ä¸èƒ½è®¿é—®</li></ul><p>**TIPSï¼š**åœ¨è®¡ç®—æœºç§‘å­¦é¢†åŸŸï¼Œ<code>å£°æ˜(Decalration)</code>æŒ‡çš„æ˜¯å‘ç¼–è¯‘å™¨è¯´æ˜ä¸€ä¸ªå˜é‡æˆ–è€…å‡½æ•°ä¿¡æ¯ï¼ŒåŒ…æ´»ï¼šåå­—ã€ç±»å‹ã€åˆå§‹å€¼ç­‰ç­‰ï¼Œå³å£°æ˜å˜é‡ã€å‡½æ•°çš„å±æ€§ç»†èŠ‚ï¼›è€Œ<code>å®šä¹‰(Definition)</code>åˆ™æŒ‡æ˜å˜é‡ã€å‡½æ•°å­˜å‚¨åœ¨å“ªé‡Œï¼Œå½“å®šä¹‰å‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿä¸ºå˜é‡æˆ–è€…å‡½æ•°åˆ†é…å†…å­˜å•å…ƒã€‚</p><h2 id="é€šè¿‡äº‹ä»¶ä½¿ç”¨å§”æ‰˜">é€šè¿‡äº‹ä»¶ä½¿ç”¨å§”æ‰˜</h2><p>äº‹ä»¶åœ¨ç±»ä¸­å£°æ˜ä¸”ç”Ÿæˆï¼Œä¸”é€šè¿‡ä½¿ç”¨åŒä¸€ä¸ªç±»æˆ–è€…å…¶ä»–ç±»ä¸­çš„å§”æ‰˜ä¸äº‹ä»¶å¤„ç†ç¨‹åºå…³è”ã€‚åŒ…å«äº‹ä»¶çš„ç±»ç”¨äºå‘å¸ƒäº‹ä»¶ï¼Œå®ƒè¢«ç§°ä¸ºå‘å¸ƒå™¨(publisher)ç±»ã€‚å…¶ä»–æ¥å—è¯¥äº‹ä»¶çš„ç±»è¢«ç§°ä¸ºè®¢é˜…å™¨(subscriber)ç±»ã€‚äº‹ä»¶ä½¿ç”¨å‘å¸ƒ-è®¢é˜…(publisher-subscriber)æ¨¡å‹ã€‚</p><p>å‘å¸ƒå™¨(publisher)æ˜¯ä¸€ä¸ªåŒ…å«äº‹ä»¶å’Œå§”æ‰˜å®šä¹‰çš„å¯¹è±¡ã€‚äº‹ä»¶å’Œå§”æ‰˜ä¹‹é—´çš„è”ç³»ä¹Ÿå®šä¹‰åœ¨è¿™ä¸ªå¯¹è±¡ä¸­ã€‚å‘å¸ƒå™¨ç±»çš„å¯¹è±¡è°ƒç”¨è¿™ä¸ªäº‹ä»¶ï¼Œå¹¶é€šçŸ¥å…¶ä»–çš„å¯¹è±¡ã€‚</p><p>è®¢é˜…å™¨(subscriber)æ˜¯ä¸€ä¸ªæ¥å—äº‹ä»¶å¹¶æä¾›äº‹ä»¶å¤„ç†ç¨‹åºçš„å¯¹è±¡ã€‚åœ¨å‘å¸ƒå™¨ç±»ä¸­çš„å§”æ‰˜è°ƒç”¨è®¢é˜…å™¨ç±»ä¸­ã€‚</p><h2 id="å£°æ˜äº‹ä»¶-Event">å£°æ˜äº‹ä»¶(Event)</h2><p>åœ¨ç±»çš„å†…éƒ¨å£°æ˜äº‹ä»¶ï¼Œé¦–å…ˆå¿…é¡»å£°æ˜è¯¥äº‹ä»¶çš„å§”æ‰˜ç±»å‹ã€‚å¦‚ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">BoilerLogHandler</span>(<span class="params"><span class="built_in">string</span> status</span>)</span>;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œå£°æ˜äº‹ä»¶æœ¬èº«ï¼Œä½¿ç”¨eventå…³é”®å­—ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">event</span> BoilerLogHandler BoilerEventLog;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç å®šä¹‰äº†ä¸€ä¸ªåä¸ºBoilerLogHandlerçš„å§”æ‰˜å’Œä¸€ä¸ªåä¸ºBoilerEventLogçš„äº‹ä»¶ï¼Œè¯¥äº‹ä»¶åœ¨ç”Ÿæˆçš„æ—¶å€™ä¼šè°ƒç”¨å§”æ‰˜ã€‚</p><h2 id="å®ä¾‹">å®ä¾‹</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">SimpleEvent</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/******å‘å¸ƒå™¨ç±»*******/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EventTest</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">int</span> <span class="keyword">value</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">NumManipulationHandler</span>()</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">event</span> NumManipulationHandler ChangeNum;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnNumChanged</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (ChangeNum != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                ChangeNum(); <span class="comment">// äº‹ä»¶è¢«è§¦å‘</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">&quot;Event not fire&quot;</span>);</span><br><span class="line">                Console.ReadKey();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">EventTest</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">int</span> n = <span class="number">5</span>;</span><br><span class="line">            SetValue(<span class="number">5</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetValue</span>(<span class="params"><span class="built_in">int</span> n</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">value</span> != n)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">value</span> = n;</span><br><span class="line">                OnNumChanged();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/********è®¢é˜…å™¨ç±»********/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">subscribEvent</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printf</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;event fire&quot;</span>);</span><br><span class="line">            Console.ReadKey();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/********è§¦å‘********/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MainClass</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            EventTest e = <span class="keyword">new</span> EventTest(); <span class="comment">// å®ä¾‹åŒ–å¯¹è±¡ï¼Œç¬¬ä¸€æ¬¡æ²¡æœ‰è§¦å‘äº‹ä»¶</span></span><br><span class="line">            subscribEvent v = <span class="keyword">new</span> subscribEvent();</span><br><span class="line">            e.ChangeNum += <span class="keyword">new</span> EventTest.NumManipulationHandler(v.printf); <span class="comment">// æ³¨å†Œ</span></span><br><span class="line">            e.SetValue(<span class="number">7</span>);</span><br><span class="line">            e.SetValue(<span class="number">11</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å°æ•…äº‹ï¼š">å°æ•…äº‹ï¼š</h2><p>æ›¾ç».NETåªæœ‰ä¸€ä¸ªDelegateï¼Œåˆ«äººæƒ³è¦ä½¿ç”¨å§”æ‰˜çš„æ—¶å€™ï¼Œå¿…é¡»ä½¿ç”¨delegateå…³é”®å­—æ¥å®šä¹‰ä¸€ä¸ªå§”æ‰˜ï¼Œä½†æ˜¯è¿™æ ·æœ‰ä¸€ä¸ªå¼Šç«¯ï¼Œé‚£å°±æ˜¯delegateå¯ä»¥ä½¿ç”¨<code>=</code>å°†æ‰€æœ‰å·²ç»è®¢é˜…çš„å–æ¶ˆï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>+</code>å’Œ<code>-</code>å¯¹è®¢é˜…è¿›è¡Œåˆå¹¶å’Œåˆ é™¤ï¼Œåªä¿ç•™<code>=</code>ä¹‹åçš„æ–°çš„è®¢é˜…ï¼Œè¿™å°±ç»™äº†çŠ¯ç½ªåˆ†å­å¯ä¹˜ä¹‹æœºã€‚æ‰€ä»¥eventåº”è¿è€Œç”Ÿï¼Œeventæ˜¯ä¸€ç§ç‰¹æ®Šçš„å§”æ‰˜ï¼Œå®ƒåªèƒ½ä½¿ç”¨<code>+=</code>ã€<code>-=</code>ï¼Œè€Œä¸èƒ½ç›´æ¥ä½¿ç”¨<code>=</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œeventåœ¨å®šä¹‰ç±»ï¼ˆå‘å¸ƒè€…ï¼‰ä¸­æ˜¯å¯ä»¥ç›´æ¥<code>=</code>çš„ï¼Œä½†æ˜¯åœ¨å…¶ä»–ç±»ä¸­ï¼ˆè®¢é˜…è€…ï¼‰å°±åªèƒ½ä½¿ç”¨<code>+=</code>ã€<code>-=</code>äº†ï¼Œä¹Ÿå°±æ˜¯è¯´å‘å¸ƒè€…å‘å¸ƒäº†ä¸€ä¸ªäº‹ä»¶ä¹‹åï¼Œè®¢é˜…è€…é’ˆå¯¹ä»–åªèƒ½è¿›è¡Œè‡ªèº«çš„è®¢é˜…å’Œå–æ¶ˆã€‚ä½†æ˜¯åœ¨äº‹ä»¶å‘å¸ƒå’Œè®¢é˜…çš„è¿‡ç¨‹ä¸­ï¼Œå®šä¹‰äº‹ä»¶çš„åŸå‹å§”æ‰˜ç±»å‹å¸¸å¸¸æ˜¯ä¸€ä»¶é‡å¤æ€§çš„å·¥ä½œã€‚æ‰€ä»¥<code>Event Handler</code>åº”è¿è€Œç”Ÿï¼Œå®ƒçš„å‡ºç°å°±æ˜¯ä¸ºäº†é¿å…è¿™ç§é‡å¤æ€§çš„å·¥ä½œï¼Œå¹¶å»ºè®®å°½é‡ä½¿ç”¨è¯¥ç±»å‹ä½œä¸ºäº‹ä»¶çš„åŸå‹ã€‚</p><p>ä¸‹é¢æ˜¯EvenHandlerçš„å®ä¾‹ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TeacherArgs</span> : <span class="title">EventArgs</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Teacher</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">event</span> EventHandler acthandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Teacher</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;è€å¸ˆæ¥äº†&quot;</span>);</span><br><span class="line">        TeacherArgs args = <span class="keyword">new</span> TeacherArgs() &#123; Name = Name &#125;;</span><br><span class="line">        acthandler(<span class="literal">null</span>, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HeadArgs</span> : <span class="title">EventArgs</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> MedalCount &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Headmaster</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> MedalCount;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">event</span> EventHandler actHandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Headmaster</span>(<span class="params"><span class="built_in">string</span> name, <span class="built_in">int</span> medalCount</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = name;</span><br><span class="line">        MedalCount = medalCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æ ¡é•¿æ¥äº†&quot;</span>);</span><br><span class="line">        HeadArgs args = <span class="keyword">new</span> HeadArgs() &#123; Name = Name, MedalCount = MedalCount &#125;;</span><br><span class="line">        actHandler(<span class="literal">null</span>, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Students</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Action_Teacher</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        TeacherArgs args = e <span class="keyword">as</span> TeacherArgs;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;å…¨ä½“èµ·ç«‹ï¼Œå–Šï¼š&#123;0&#125;å¥½ï¼&quot;</span>, args.Name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Action_Master</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        HeadArgs args = e <span class="keyword">as</span> HeadArgs;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;å…¨ä½“èµ·ç«‹ï¼Œå–Šï¼š&#123;0&#125;å¥½&quot;</span>, args.Name);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æ ¡é•¿è·å¥–æ•°ä¸ºï¼š&#123;0&#125;&quot;</span>, args.MedalCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Action_Monitor</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        MonitorArgs args = e <span class="keyword">as</span> MonitorArgs;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;ç­é•¿æ¥äº†ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•å‚æ•°&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MonitorArgs</span> : <span class="title">EventArgs</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Monitor</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">event</span> EventHandler actHandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;ç­é•¿æ¥äº†ï¼Œä½†æ˜¯ä»€ä¹ˆå‚æ•°éƒ½æ²¡æœ‰&quot;</span>);</span><br><span class="line">        MonitorArgs args = <span class="keyword">new</span> MonitorArgs() &#123; &#125;;</span><br><span class="line">        actHandler(<span class="literal">null</span>, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Students students = <span class="keyword">new</span> Students();</span><br><span class="line">        Headmaster headmaster = <span class="keyword">new</span> Headmaster(<span class="string">&quot;å­™æ ¡é•¿&quot;</span>, <span class="number">10</span>);</span><br><span class="line">        Teacher teacher = <span class="keyword">new</span> Teacher(<span class="string">&quot;åˆ˜è€å¸ˆ&quot;</span>);</span><br><span class="line">        Monitor monitor = <span class="keyword">new</span> Monitor();</span><br><span class="line">        headmaster.actHandler += students.Action_Master;</span><br><span class="line">        teacher.acthandler += students.Action_Teacher;</span><br><span class="line">        monitor.actHandler += students.Action_Monitor;</span><br><span class="line">        teacher.Come();</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        headmaster.Come();</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        monitor.Come();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>**æ€»ç»“ï¼š**ä½¿ç”¨EventHandlerå¯ä»¥</p><ol><li>æ ‡å‡†åŒ–</li><li>å¯ä»¥çœç•¥å®šä¹‰å§”æ‰˜è¿™ä¸€æ­¥ï¼Œä¸å¿…å®šä¹‰å¤šä¸ªä¸åŒç±»å‹çš„å§”æ‰˜</li><li>æ­é…EventArgsï¼Œå¯ä»¥ä¼ é€’å¤šä¸ªä¿¡æ¯</li></ol><p>ä¸‹é¢çš„ä»£ç æ˜¯ä¸ä½¿ç”¨EventHandlerçš„å®ç°ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Diagnostics.Metrics;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">TeacherDelegate</span>(<span class="params"><span class="built_in">string</span> name</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">HeadMasterDelegate</span>(<span class="params"><span class="built_in">string</span> name, <span class="built_in">int</span> medalCount</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">MonitorDelegate</span>()</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Teacher</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> Name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">event</span> TeacherDelegate acthandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Teacher</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;è€å¸ˆæ¥äº†&quot;</span>);</span><br><span class="line">        acthandler(Name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Headmaster</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> Name;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> MedalCount;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">event</span> HeadMasterDelegate actHandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Headmaster</span>(<span class="params"><span class="built_in">string</span> name, <span class="built_in">int</span> medalCount</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = name;</span><br><span class="line">        MedalCount = medalCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æ ¡é•¿æ¥äº†&quot;</span>);</span><br><span class="line">        actHandler(Name, MedalCount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Monitor</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">event</span> MonitorDelegate actHandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;ç­é•¿æ¥äº†ï¼Œä½†æ˜¯ä»€ä¹ˆå‚æ•°éƒ½æ²¡æœ‰&quot;</span>);</span><br><span class="line">        actHandler();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Students</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Action_Teacher</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;å…¨ä½“èµ·ç«‹ï¼Œå–Šï¼š&#123;0&#125;å¥½ï¼&quot;</span>, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Action_Master</span>(<span class="params"><span class="built_in">string</span> name, <span class="built_in">int</span> medalCount</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;å…¨ä½“èµ·ç«‹ï¼Œå–Šï¼š&#123;0&#125;å¥½&quot;</span>, name);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æ ¡é•¿è·å¥–æ•°ä¸ºï¼š&#123;0&#125;&quot;</span>, medalCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Action_Monitor</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;ç­é•¿æ¥äº†ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•å‚æ•°&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Students students = <span class="keyword">new</span> Students();</span><br><span class="line">        Headmaster headmaster = <span class="keyword">new</span> Headmaster(<span class="string">&quot;å­™æ ¡é•¿&quot;</span>, <span class="number">10</span>);</span><br><span class="line">        Teacher teacher = <span class="keyword">new</span> Teacher(<span class="string">&quot;åˆ˜è€å¸ˆ&quot;</span>);</span><br><span class="line">        Monitor monitor = <span class="keyword">new</span> Monitor();</span><br><span class="line">        headmaster.actHandler += students.Action_Master;</span><br><span class="line">        teacher.acthandler += students.Action_Teacher;</span><br><span class="line">        monitor.actHandler += students.Action_Monitor;</span><br><span class="line">        teacher.Come();</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        headmaster.Come();</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        monitor.Come();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­å›åˆ°å°æ•…äº‹ï¼šåœ¨è¿™ä¸ªæ•…äº‹ä¸­ï¼ŒDelegateæ˜¯è€å¤§å“¥ï¼Œä½†æ˜¯EventHandleræ˜¯eventçš„å°å¼Ÿï¼Œè€å¤§å“¥ä¸å¤ªé«˜å…´äº†ï¼Œè¯´æˆ‘ä¹Ÿè¦æœ‰å°å¼Ÿï¼Œä½†æ›´é‡è¦çš„åŸå› æ˜¯æ¯æ¬¡å®šä¹‰Delegateä¹Ÿæ˜¯å¾ˆéº»çƒ¦çš„ï¼Œæ‰€ä»¥Actionåº”è¿è€Œç”Ÿï¼ŒActionæ˜¯ç³»ç»Ÿé¢„å®šä¹‰çš„ä¸€ç§å§”æ‰˜ï¼Œæ²¡æœ‰<strong>è¿”å›å€¼</strong>ï¼Œå‚æ•°åœ¨<code>&lt;&gt;</code>ä¸­ä¼ å…¥ï¼Œä¸‹é¢å°±æ˜¯ä½¿ç”¨Actionçš„æ–¹æ³•æ¥å®ç°ä¸Šé¢çš„ä»£ç ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Teacher</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> Name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Action&lt;<span class="built_in">string</span>&gt; acthandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Teacher</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;è€å¸ˆæ¥äº†&quot;</span>);</span><br><span class="line">        acthandler(Name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Headmaster</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> Name;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> MedalCount;</span><br><span class="line">    <span class="keyword">public</span> Action&lt;<span class="built_in">string</span>, <span class="built_in">int</span>&gt; actHandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Headmaster</span>(<span class="params"><span class="built_in">string</span> name, <span class="built_in">int</span> medalCount</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = name;</span><br><span class="line">        MedalCount = medalCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æ ¡é•¿æ¥äº†&quot;</span>);</span><br><span class="line">        actHandler(Name, MedalCount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Monitor</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Action actHandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;ç­é•¿æ¥äº†ï¼Œä½†æ˜¯ä»€ä¹ˆå‚æ•°éƒ½æ²¡æœ‰&quot;</span>);</span><br><span class="line">        actHandler();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Students</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Action_Teacher</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;å…¨ä½“èµ·ç«‹ï¼Œå–Šï¼š&#123;0&#125;å¥½ï¼&quot;</span>, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Action_Master</span>(<span class="params"><span class="built_in">string</span> name, <span class="built_in">int</span> medalCount</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;å…¨ä½“èµ·ç«‹ï¼Œå–Šï¼š&#123;0&#125;å¥½&quot;</span>, name);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æ ¡é•¿è·å¥–æ•°ä¸ºï¼š&#123;0&#125;&quot;</span>, medalCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Action_Monitor</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;ç­é•¿æ¥äº†ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•å‚æ•°&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Students students = <span class="keyword">new</span> Students();</span><br><span class="line">        Headmaster headmaster = <span class="keyword">new</span> Headmaster(<span class="string">&quot;å­™æ ¡é•¿&quot;</span>, <span class="number">10</span>);</span><br><span class="line">        Teacher teacher = <span class="keyword">new</span> Teacher(<span class="string">&quot;åˆ˜è€å¸ˆ&quot;</span>);</span><br><span class="line">        Monitor monitor = <span class="keyword">new</span> Monitor();</span><br><span class="line">        headmaster.actHandler += students.Action_Master;</span><br><span class="line">        teacher.acthandler += students.Action_Teacher;</span><br><span class="line">        monitor.actHandler += students.Action_Monitor;</span><br><span class="line">        teacher.Come();</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        headmaster.Come();</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        monitor.Come();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢è¿™æ®µä»£ç æ˜¯ç”¨Funcçš„æ–¹å¼å®ç°çš„ï¼ŒFun<code>&lt;&gt;</code>ä¸­æ¯”æ³¨å†Œçš„å‡½æ•°çš„å‚æ•°å¤š1ä¸ªï¼Œæœ€åä¸€ä¸ªæ˜¯å‚æ•°æ˜¯å‡½æ•°çš„è¿”å›ç±»å‹ã€‚</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Teacher</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> Name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Func&lt;<span class="built_in">string</span>, <span class="built_in">bool</span>&gt; acthandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Teacher</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;è€å¸ˆæ¥äº†&quot;</span>);</span><br><span class="line">        acthandler(Name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Headmaster</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> Name;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> MedalCount;</span><br><span class="line">    <span class="keyword">public</span> Func&lt;<span class="built_in">string</span>, <span class="built_in">int</span>, <span class="built_in">bool</span>&gt; actHandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Headmaster</span>(<span class="params"><span class="built_in">string</span> name, <span class="built_in">int</span> medalCount</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = name;</span><br><span class="line">        MedalCount = medalCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æ ¡é•¿æ¥äº†&quot;</span>);</span><br><span class="line">        actHandler(Name, MedalCount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Monitor</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Func&lt;<span class="built_in">bool</span>&gt; actHandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;ç­é•¿æ¥äº†ï¼Œä½†æ˜¯ä»€ä¹ˆå‚æ•°éƒ½æ²¡æœ‰&quot;</span>);</span><br><span class="line">        actHandler();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Students</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Action_Teacher</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;å…¨ä½“èµ·ç«‹ï¼Œå–Šï¼š&#123;0&#125;å¥½ï¼&quot;</span>, name);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Action_Master</span>(<span class="params"><span class="built_in">string</span> name, <span class="built_in">int</span> medalCount</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;å…¨ä½“èµ·ç«‹ï¼Œå–Šï¼š&#123;0&#125;å¥½&quot;</span>, name);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æ ¡é•¿è·å¥–æ•°ä¸ºï¼š&#123;0&#125;&quot;</span>, medalCount);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Action_Monitor</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;ç­é•¿æ¥äº†ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•å‚æ•°&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Students students = <span class="keyword">new</span> Students();</span><br><span class="line">        Headmaster headmaster = <span class="keyword">new</span> Headmaster(<span class="string">&quot;å­™æ ¡é•¿&quot;</span>, <span class="number">10</span>);</span><br><span class="line">        Teacher teacher = <span class="keyword">new</span> Teacher(<span class="string">&quot;åˆ˜è€å¸ˆ&quot;</span>);</span><br><span class="line">        Monitor monitor = <span class="keyword">new</span> Monitor();</span><br><span class="line">        headmaster.actHandler += students.Action_Master;</span><br><span class="line">        teacher.acthandler += students.Action_Teacher;</span><br><span class="line">        monitor.actHandler += students.Action_Monitor;</span><br><span class="line">        teacher.Come();</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        headmaster.Come();</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        monitor.Come();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>å†™ä¸€ä¸ªå¸¦æœ‰äº‹ä»¶ä¸­å¿ƒçš„å‘å¸ƒã€è®¢é˜…ç³»ç»Ÿ</h1><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Runtime.CompilerServices;</span><br><span class="line"><span class="keyword">using</span> Microsoft.VisualBasic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerState</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">PlayerDeath</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;ç©å®¶æ­»äº¡ï¼å‘äº‹ä»¶ä¸­å¿ƒå‘é€æ¶ˆæ¯ï¼&quot;</span>);</span><br><span class="line">        MessageCenter.Instance.SendMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AudioManager</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> AudioManager Instance = <span class="keyword">new</span> AudioManager();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">AudioManager</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æˆ‘æ˜¯AudioManagerï¼Œæˆ‘å·²ç»åˆ›å»ºå®Œæ¯•ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">PlayDeathAudio</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æ‰§è¡Œæ­»äº¡éŸ³æ•ˆ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DataManager</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> DataManager Instance = <span class="keyword">new</span> DataManager();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">DataManager</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æˆ‘æ˜¯DataManagerï¼Œæˆ‘å·²ç»åˆ›å»ºå®Œæ¯•ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ResetData</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;ç©å®¶æ­»äº¡ï¼Œæ‰§è¡Œæ•°æ®é‡åˆ¶&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EnenyManager</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> EnenyManager Instance = <span class="keyword">new</span> EnenyManager();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">EnenyManager</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æˆ‘æ˜¯EnemyManagerï¼Œæˆ‘å·²ç»åˆ›å»ºå®Œæˆï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">EnemyVictory</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;ç©å®¶æ­»äº¡ï¼Œæ•Œäººèƒœåˆ©ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MessageCenter</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œæ˜¯äº‹ä»¶ä¸­å¿ƒï¼Œå¤„ç†æ¸¸æˆä¸­å„ç±»äº‹ä»¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> MessageCenter Instance = <span class="keyword">new</span> MessageCenter();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MessageCenter</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æ„é€ å‡½æ•°ä½¿ç”¨privateå…³é”®å­—å°±å¯ä»¥é¿å…åœ¨åˆ«çš„ç±»ä¸­ä½¿ç”¨newå®ä¾‹åŒ–å¯¹è±¡äº†</span></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æˆ‘æ˜¯äº‹ä»¶ä¸­å¿ƒï¼Œæˆ‘å·²ç»åˆå§‹åŒ–å®Œæˆï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">PlayerDeathDelegate</span>()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> PlayerDeathDelegate DeathDelegate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SendMessage</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (DeathDelegate == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;å§”æ‰˜æ˜¯ç©ºçš„ï¼æ²¡æœ‰ä»€ä¹ˆå¥½æ‰§è¡Œçš„ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            DeathDelegate.Invoke();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Register</span>(<span class="params">PlayerDeathDelegate deathDelegate</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        DeathDelegate += deathDelegate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameStart</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PlayerState player = <span class="keyword">new</span> PlayerState();</span><br><span class="line">        <span class="comment">// æ¸¸æˆå¼€å§‹åè¦å…ˆå°†å‡½æ•°æ³¨å†Œåˆ°äº‹ä»¶ä¸­å¿ƒå»</span></span><br><span class="line">        MessageCenter.Instance.Register(AudioManager.Instance.PlayDeathAudio);</span><br><span class="line">        MessageCenter.Instance.Register(DataManager.Instance.ResetData);</span><br><span class="line">        MessageCenter.Instance.Register(EnenyManager.Instance.EnemyVictory);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        player.PlayerDeath();</span><br><span class="line"></span><br><span class="line">        Console.ReadKey();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç è¿˜ä¸å¤Ÿå®Œå–„ï¼Œæ¯”å¦‚ç°åœ¨åªæ˜¯å¤„ç†äº†ç©å®¶æ­»äº¡è¿™ä¸€ç§äº‹ä»¶ï¼Œé‚£å¦‚ä½•å¤„ç†ç©å®¶å…¶ä»–çŠ¶æ€çš„äº‹ä»¶å‘¢ï¼Ÿè¿˜æœ‰å¦‚æœä¸æ˜¯ç©å®¶ï¼Œæ˜¯åˆ«çš„ä»€ä¹ˆæ¯”å¦‚å®ç‰©ã€ä½¿ç”¨è¯æ°´ç­‰ç­‰å„ç§çš„å§”æ‰˜ï¼Œè¯¥æ€ä¹ˆå®ç°ï¼Ÿè¿™éƒ½æ˜¯åè¯äº†ï¼Œå§”æ‰˜çš„å­¦ä¹ åˆ°æ­¤å¯ä»¥å…ˆå‘Šä¸€æ®µè½äº†ã€‚</p><h1>é¡¹ç›®ä¸­çš„æŒ‰é’®å“åº”ç‚¹å‡»äº‹ä»¶çš„æ–¹æ³•</h1><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ButtonUI</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Button btn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UI.Extension;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ButtonPage</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> ButtonUI _ui;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        _ui = gameObject.GetComponent&lt;ButtonUI&gt;();</span><br><span class="line">        _ui.btn.onClick.AddListener(OnBtnClicked);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnBtnClicked</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;æˆ‘è¢«ç‚¹å‡»äº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;å§”æ‰˜&lt;/h1&gt;
&lt;p&gt;ä¸€ç¯‡å¾ˆå¥½çš„åšå®¢https://www.cnblogs.com/skysoot/archive/2012/04/05/2433639.html&lt;/p&gt;
&lt;p&gt;C#ä¸­çš„å§”æ‰˜ç±»ä¼¼äºCæˆ–C++ä¸­çš„å‡½æ•°æŒ‡é’ˆã€‚å§”æ‰˜æ˜¯å­˜æœ‰å¯¹æŸä¸ªæ–¹æ³•çš„å¼•ç”¨çš„ä¸€ç§å¼•ç”¨ç±»å‹å˜é‡ï¼Œå¼•ç”¨å¯</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>PhysXç¬”è®°</title>
    <link href="https://soincredible.github.io/posts/6f4ce0cc/"/>
    <id>https://soincredible.github.io/posts/6f4ce0cc/</id>
    <published>2025-05-14T08:09:35.000Z</published>
    <updated>2025-05-21T13:45:27.598Z</updated>
    
    
    
    
    
  </entry>
  
  <entry>
    <title>ProjectO</title>
    <link href="https://soincredible.github.io/posts/8a8aad75/"/>
    <id>https://soincredible.github.io/posts/8a8aad75/</id>
    <published>2025-05-14T08:08:18.000Z</published>
    <updated>2025-05-21T13:45:27.599Z</updated>
    
    <content type="html"><![CDATA[<h1>ç´¢å¼•</h1><p><a href="https://soincredible.github.io/posts/ff09e316">ETæ¡†æ¶8.1</a><br><a href="">ç‰©ç†æ¨¡æ‹Ÿ</a><br><a href="">åŠ¨ç”»</a><br><a href="">æŠ€èƒ½ç¼–è¾‘å™¨</a><br><a href="">æ•°æ®åº“MongoDB</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;ç´¢å¼•&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://soincredible.github.io/posts/ff09e316&quot;&gt;ETæ¡†æ¶8.1&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;&quot;&gt;ç‰©ç†æ¨¡æ‹Ÿ&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;&quot;&gt;åŠ¨ç”»&lt;/a&gt;&lt;br&gt;
&lt;a href</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>The performance characteristics of async methods in C#</title>
    <link href="https://soincredible.github.io/posts/4b84508e/"/>
    <id>https://soincredible.github.io/posts/4b84508e/</id>
    <published>2025-05-13T00:59:38.000Z</published>
    <updated>2025-05-14T06:09:09.679Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨æœ€è¿‘çš„ä¸¤ç¯‡åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ·±å…¥æ¢è®¨äº†C#å¼‚æ­¥æ–¹æ³•çš„å†…éƒ¨å®ç°æœºåˆ¶ï¼Œå¹¶è¯¦ç»†åˆ†æäº†C#ç¼–è¯‘å™¨æä¾›çš„æ‰©å±•ç‚¹å¦‚ä½•è°ƒæ•´å¼‚æ­¥æ–¹æ³•çš„è¡Œä¸ºã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†é‡ç‚¹ç ”ç©¶å¼‚æ­¥æ–¹æ³•çš„æ€§èƒ½ç‰¹å¾ã€‚</p><p>æ­£å¦‚æœ¬ç³»åˆ—ç¬¬ä¸€ç¯‡æ–‡ç« æ‰€è¿°ï¼Œç¼–è¯‘å™¨è¿›è¡Œäº†å¤§é‡è½¬æ¢å·¥ä½œï¼Œä½¿å¼‚æ­¥ç¼–ç¨‹ä½“éªŒå‡ ä¹ä¸åŒæ­¥ç¼–ç¨‹æ— å¼‚ã€‚ä½†ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œç¼–è¯‘å™¨éœ€è¦åˆ›å»ºçŠ¶æ€æœºå®ä¾‹ã€å°†å…¶ä¼ é€’ç»™å¼‚æ­¥æ–¹æ³•ç”Ÿæˆå™¨ã€è°ƒç”¨ä»»åŠ¡ç­‰å¾…å™¨ç­‰ã€‚æ˜¾ç„¶ï¼Œæ‰€æœ‰è¿™äº›é€»è¾‘éƒ½ä¼šå¸¦æ¥æ€§èƒ½å¼€é”€ï¼Œä½†å…·ä½“ä»£ä»·æœ‰å¤šå¤§å‘¢ï¼Ÿ</p><p>åœ¨TPLï¼ˆä»»åŠ¡å¹¶è¡Œåº“ï¼‰å‡ºç°ä¹‹å‰ï¼Œå¼‚æ­¥æ“ä½œé€šå¸¸ç²’åº¦è¾ƒç²—ï¼Œå› æ­¤å…¶å¼€é”€å¾€å¾€å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ä½†åœ¨ç°ä»£åº”ç”¨ä¸­ï¼Œå³ä½¿ç›¸å¯¹ç®€å•çš„ç¨‹åºæ¯ç§’ä¹Ÿå¯èƒ½æ‰§è¡Œæˆç™¾ä¸Šåƒæ¬¡å¼‚æ­¥æ“ä½œã€‚TPLè™½ç„¶é’ˆå¯¹è¿™ç§å·¥ä½œè´Ÿè½½è¿›è¡Œäº†ä¼˜åŒ–è®¾è®¡ï¼Œä½†å®ƒå¹¶éé­”æ³•ï¼Œä»ç„¶å­˜åœ¨ä¸€å®šå¼€é”€ã€‚</p><p>ä¸ºäº†å‡†ç¡®æµ‹é‡å¼‚æ­¥æ–¹æ³•çš„å¼€é”€ï¼Œæˆ‘ä»¬å°†å¯¹é¦–ç¯‡åšå®¢ä¸­çš„ç¤ºä¾‹è¿›è¡Œé€‚å½“è°ƒæ•´åä½œä¸ºæµ‹è¯•åŸºå‡†ã€‚</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">StockPrices</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">int</span> Count = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">private</span> List&lt;(<span class="built_in">string</span> name, <span class="built_in">decimal</span> price)&gt; _stockPricesCache;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Async version</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;<span class="built_in">decimal</span>&gt; <span class="title">GetStockPriceForAsync</span>(<span class="params"><span class="built_in">string</span> companyId</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> InitializeMapIfNeededAsync();</span><br><span class="line">        <span class="keyword">return</span> DoGetPriceFromCache(companyId);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Sync version that calls async init</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">decimal</span> <span class="title">GetStockPriceFor</span>(<span class="params"><span class="built_in">string</span> companyId</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        InitializeMapIfNeededAsync().GetAwaiter().GetResult();</span><br><span class="line">        <span class="keyword">return</span> DoGetPriceFromCache(companyId);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Purely sync version</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">decimal</span> <span class="title">GetPriceFromCacheFor</span>(<span class="params"><span class="built_in">string</span> companyId</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        InitializeMapIfNeeded();</span><br><span class="line">        <span class="keyword">return</span> DoGetPriceFromCache(companyId);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="built_in">decimal</span> <span class="title">DoGetPriceFromCache</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> kvp <span class="keyword">in</span> _stockPricesCache)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (kvp.name == name)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> kvp.price;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> InvalidOperationException(<span class="string">$&quot;Can&#x27;t find price for &#x27;<span class="subst">&#123;name&#125;</span>&#x27;.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    [<span class="meta">MethodImpl(MethodImplOptions.NoInlining)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">InitializeMapIfNeeded</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Similar initialization logic.</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">async</span> Task <span class="title">InitializeMapIfNeededAsync</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_stockPricesCache != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">await</span> Task.Delay(<span class="number">42</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Getting the stock prices from the external source.</span></span><br><span class="line">        <span class="comment">// Generate 1000 items to make cache hit somewhat expensive</span></span><br><span class="line">        _stockPricesCache = Enumerable.Range(<span class="number">1</span>, Count)</span><br><span class="line">            .Select(n =&gt; (name: n.ToString(), price: (<span class="built_in">decimal</span>)n))</span><br><span class="line">            .ToList();</span><br><span class="line">        _stockPricesCache.Add((name: <span class="string">&quot;MSFT&quot;</span>, price: <span class="number">42</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åœ¨æœ€è¿‘çš„ä¸¤ç¯‡åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ·±å…¥æ¢è®¨äº†C#å¼‚æ­¥æ–¹æ³•çš„å†…éƒ¨å®ç°æœºåˆ¶ï¼Œå¹¶è¯¦ç»†åˆ†æäº†C#ç¼–è¯‘å™¨æä¾›çš„æ‰©å±•ç‚¹å¦‚ä½•è°ƒæ•´å¼‚æ­¥æ–¹æ³•çš„è¡Œä¸ºã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†é‡ç‚¹ç ”ç©¶å¼‚æ­¥æ–¹æ³•çš„æ€§èƒ½ç‰¹å¾ã€‚&lt;/p&gt;
&lt;p&gt;æ­£å¦‚æœ¬ç³»åˆ—ç¬¬ä¸€ç¯‡æ–‡ç« æ‰€è¿°ï¼Œç¼–è¯‘å™¨è¿›è¡Œäº†å¤§é‡è½¬æ¢å·¥ä½œï¼Œä½¿å¼‚æ­¥ç¼–ç¨‹ä½“éªŒå‡ ä¹ä¸åŒæ­¥ç¼–ç¨‹æ— å¼‚ã€‚ä½†ä¸ºäº†å®</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>C#ä¸­çš„Task</title>
    <link href="https://soincredible.github.io/posts/323f6783/"/>
    <id>https://soincredible.github.io/posts/323f6783/</id>
    <published>2025-05-08T15:44:35.000Z</published>
    <updated>2025-05-09T01:44:30.371Z</updated>
    
    <content type="html"><![CDATA[<h1>å…³äºTaskScheduler</h1><p>TaskScheduleræ˜¯C#<code>System.Threading.Tasks</code>å‘½åç©ºé—´ä¸‹çš„ä¸€ä¸ªæŠ½è±¡ç±», åœ¨<code>.Net Framework 4.8</code>ä¸­C#å†…ç½®äº†ä¸‰ä¸ªTaskSchedulerçš„æ´¾ç”Ÿç±»: <code>ConcurrentExclusiveScheduler</code>ã€<code>SynchronizationContextTaskScheduler</code>ã€<code>ThreadPoolTaskScheduler</code>.</p><p>å…¶ä¸­çš„<code>ThreadPoolTaskScheduler</code>, è¢«è®¾ç½®ä¸ºäº†Default TaskScheduler</p><h1>ExecutionContext</h1><p>æ‰§è¡Œä¸Šä¸‹æ–‡,</p><h1>StackCrawlMark</h1><h1>å…³äºThread</h1><h1>è°ƒç”¨Task.Runçš„æ—¶å€™ å‘ç”Ÿäº†ä»€ä¹ˆ</h1>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;å…³äºTaskScheduler&lt;/h1&gt;
&lt;p&gt;TaskScheduleræ˜¯C#&lt;code&gt;System.Threading.Tasks&lt;/code&gt;å‘½åç©ºé—´ä¸‹çš„ä¸€ä¸ªæŠ½è±¡ç±», åœ¨&lt;code&gt;.Net Framework 4.8&lt;/code&gt;ä¸­C#å†…ç½®äº†ä¸‰ä¸ªTaskSche</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Extending the asynce methods in CSharp(è¯‘)</title>
    <link href="https://soincredible.github.io/posts/40aca622/"/>
    <id>https://soincredible.github.io/posts/40aca622/</id>
    <published>2025-05-08T13:01:43.000Z</published>
    <updated>2025-05-22T12:58:40.801Z</updated>
    
    <content type="html"><![CDATA[<p>é¦–å…ˆè¦ææ¸…æ¥š, ä¸ºä»€ä¹ˆè¦å®ç°æˆ‘ä»¬è‡ªå·±çš„å¼‚æ­¥, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Taskæ¥å®Œæˆæˆ‘ä»¬çš„å¼‚æ­¥æ“ä½œ, æˆ‘ä»¬å°†éœ€è¦å¼‚æ­¥çš„æ“ä½œç”¨TaskåŒ…è£…, Task(Awaiter)ä½•æ—¶ç»“æŸã€å¦‚ä½•è°ƒåº¦éƒ½æ˜¯TaskScheduleråšçš„, æˆ‘ä»¬æ²¡æœ‰å¤ªå¤šæƒé™å¹²é¢„ æˆ‘ä»¬èƒ½åšçš„åªæ˜¯å‘Šè¯‰Task ç­‰ä½ çš„ä»»åŠ¡å®Œæˆä¹‹å ä½ éœ€è¦è°ƒç”¨stateMachinerçš„MoveNextæ–¹æ³•, å¦‚æœæˆ‘è¦å®ç°è‡ªå·±çš„ç±»ä¼¼ETTaskçš„åŠŸèƒ½, æˆ‘å¸Œæœ›æˆ‘èƒ½è‡ªå·±å†³å®šå¦‚ä½•è°ƒåº¦è¿™äº›ETTask, è¦ä¸ç„¶å®ç°è‡ªå·±çš„ETTaskçš„æ„ä¹‰å°±æ²¡æœ‰äº†. C#ä¸­å¼‚æ­¥æ“ä½œåˆ°è¿™é‡Œå°±å·²ç»æ­ç¤ºåœ°æ¯”è¾ƒæ¸…æ¥šäº†, åªæ˜¯Taskçš„è°ƒåº¦ç›®å‰å¯¹æˆ‘ä»¬æ¥è¯´è¿˜æ˜¯é»‘ç›’, æœ€å¥½å®ƒä¹Ÿåªæ˜¯é»‘ç›’</p><p>å› æ­¤, åœ¨ç¬”è€…çœ‹æ¥, è¦å®ç°è‡ªå·±çš„å¼‚æ­¥, å°±æ˜¯è¦å®ç°å¦‚ä½•è°ƒåº¦è¿™äº›å¼‚æ­¥æ“ä½œ, å³æˆ‘ä»¬è¦å®ç°TaskSchedulerçš„åŠŸèƒ½.</p><p>æˆ‘ä»¬ä½¿ç”¨TaskåŒ…è£…ä¸€äº›æ“ä½œ, è¿™äº›æ“ä½œå¯èƒ½æ˜¯<code>ComputeBound</code>ç±»å‹æˆ–è€…<code>IOBound</code>ç±»å‹, ä¹Ÿå¯èƒ½åªæ˜¯ä¸€ä¸ªå»¶æ—¶<code>Task.Delay</code>æ“ä½œ, ç”šè‡³å¯èƒ½å°±æ˜¯ä¸€ä¸ªç®€å•çš„åŒæ­¥æ–¹æ³•. ä¸è®ºæ˜¯ä»€ä¹ˆæ“ä½œ, ä½ åªè¦å°†è¯¥æ“ä½œä½¿ç”¨TaskåŒ…è£…, å¹¶ä¸”è°ƒç”¨äº†è¯¥Task, é‚£ä¹ˆä½ å°±å¯ä»¥é€šè¿‡è·å–<code>Task.GetAwaiter()</code>æ¥å£è·å–åˆ°è¯¥Taskçš„Awaiter, ç„¶åé€šè¿‡è°ƒç”¨Awaiter.IsCompleteæ¥åˆ¤æ–­åŒ…è£…è¿›è¯¥Taskçš„æ“ä½œæœ‰æ²¡æœ‰å®Œæˆ.</p><p>æˆ‘ä»¬å¸Œæœ›çš„æ˜¯Taskå¯ä»¥è¢«await, é‚£ä¹ˆTaskä¸­å°±è¦æœ‰ä¸€ä¸ª<code>GetAwaiter()</code>æ–¹æ³•<br>é‚£ä¹ˆtaskçš„GetAwaiteræ–¹æ³•è¿”å›å›æ¥çš„æ˜¯ä¸€ä¸ªTaskAwaiterç±»å‹<br>æ‰€ä»¥æ˜¯TaskAwaiterç±»å‹å®ç°äº†INotifyCompletionæ¥å£ã€ ä¸”TaskAwaiterä¸­æœ‰<code>bool IsComplete &#123;get;&#125;</code>å±æ€§å’Œ<code>T GetResult()</code>æ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public static async Task Foo()</span><br><span class="line">&#123;</span><br><span class="line">    var lazy = new Lazy&lt;int&gt;(() =&gt; 42);</span><br><span class="line">    var result = await lazy;</span><br><span class="line">    Console.WriteLine(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­() =&gt; 42 çš„å«ä¹‰<br>()ï¼šè¡¨ç¤ºä¸€ä¸ªæ²¡æœ‰å‚æ•°çš„åŒ¿åæ–¹æ³•ï¼ˆç±»ä¼¼æ— å‚å‡½æ•°ï¼‰ã€‚</p><p>=&gt;ï¼šLambda è¿ç®—ç¬¦ï¼Œåˆ†éš”å‚æ•°å’Œæ–¹æ³•ä½“ã€‚</p><p>42ï¼šæ–¹æ³•çš„è¿”å›å€¼ï¼ˆæ­¤å¤„ç›´æ¥è¿”å›å¸¸é‡å€¼ 42ï¼‰ã€‚</p><p>Lazy<T> çš„æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ª Func<T> å§”æ‰˜ï¼ˆå³ä¸€ä¸ªæ— å‚ä¸”è¿”å› T ç±»å‹çš„æ–¹æ³•ï¼‰ã€‚Lambda è¡¨è¾¾å¼ () =&gt; 42 æ­£å¥½åŒ¹é…è¿™ä¸ªå§”æ‰˜ç±»å‹ï¼š</p><p>Func<int> çš„ç­¾åæ˜¯ int Func()ï¼Œè€Œ () =&gt; 42 æ˜¯ä¸€ä¸ªæ— å‚ä¸”è¿”å› int çš„è¡¨è¾¾å¼ã€‚</p><p>å› æ­¤ï¼Œä»£ç å¯ä»¥ç®€åŒ–ä¸º Lambda å½¢å¼ï¼Œè€Œä¸éœ€è¦æ˜¾å¼å®šä¹‰ä¸€ä¸ªå•ç‹¬çš„æ–¹æ³•ã€‚</p><p>åœ¨ä¹‹å‰çš„åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†C#ç¼–è¯‘å™¨å¦‚ä½•è½¬æ¢å¼‚æ­¥æ–¹æ³•ã€‚æœ¬æ–‡å°†é‡ç‚¹ä»‹ç»C#ç¼–è¯‘å™¨æä¾›çš„æ‰©å±•ç‚¹ï¼Œç”¨äºè‡ªå®šä¹‰å¼‚æ­¥æ–¹æ³•çš„è¡Œä¸ºã€‚</p><p>æœ‰ä¸‰ç§æ–¹å¼å¯ä»¥æ§åˆ¶å¼‚æ­¥æ–¹æ³•çš„è¿è¡Œæœºåˆ¶ï¼š</p><ul><li>åœ¨System.Runtime.CompilerServiceså‘½åç©ºé—´ä¸­æä¾›è‡ªå®šä¹‰çš„å¼‚æ­¥æ–¹æ³•ç”Ÿæˆå™¨</li><li>ä½¿ç”¨è‡ªå®šä¹‰ä»»åŠ¡ç­‰å¾…å™¨</li><li>å®šä¹‰è‡ªå·±çš„ç±»ä»»åŠ¡ç±»å‹</li></ul><h1>System.Runtime.CompilerServiceså‘½åç©ºé—´ä¸­çš„è‡ªå®šä¹‰ç±»å‹</h1><p>æ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æ‰€äº†è§£çš„ï¼ŒC#ç¼–è¯‘å™¨å°†å¼‚æ­¥æ–¹æ³•è½¬æ¢ä¸ºä¸€ä¸ªç”Ÿæˆçš„çŠ¶æ€æœºï¼Œè¯¥çŠ¶æ€æœºä¾èµ–äºä¸€äº›é¢„å®šä¹‰ç±»å‹ã€‚ä½†C#ç¼–è¯‘å™¨å¹¶ä¸è¦æ±‚è¿™äº›å·²çŸ¥ç±»å‹å¿…é¡»æ¥è‡ªç‰¹å®šç¨‹åºé›†ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨é¡¹ç›®ä¸­æä¾›è‡ªå·±çš„AsyncVoidMethodBuilderå®ç°ï¼ŒC#ç¼–è¯‘å™¨ä¼šå°†å¼‚æ­¥æœºåˆ¶&quot;ç»‘å®š&quot;åˆ°æ‚¨çš„è‡ªå®šä¹‰ç±»å‹ã€‚</p><p>è¿™æ˜¯æ¢ç´¢åº•å±‚è½¬æ¢åŸç†å’Œäº†è§£è¿è¡Œæ—¶æƒ…å†µçš„ç»ä½³æ–¹å¼ï¼š</p><p>å¿…é¡»è¦æ³¨æ„, è¿™ç§æ–¹å¼ä½ å¿…é¡»å°†ä½ çš„builderå®šä¹‰åœ¨<code>System.Runtime.CompilerServices</code>å‘½åç©ºé—´ä¸‹</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">System.Runtime.CompilerServices</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// AsyncVoidMethodBuilder.cs in your project</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AsyncVoidMethodBuilder</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">AsyncVoidMethodBuilder</span>()</span></span><br><span class="line">            =&gt; Console.WriteLine(<span class="string">&quot;.ctor&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AsyncVoidMethodBuilder <span class="title">Create</span>()</span></span><br><span class="line">            =&gt; <span class="keyword">new</span> AsyncVoidMethodBuilder();</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetResult</span>()</span> =&gt; Console.WriteLine(<span class="string">&quot;SetResult&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Start</span>&lt;<span class="title">TStateMachine</span>&gt;(<span class="params"><span class="keyword">ref</span> TStateMachine stateMachine</span>)</span></span><br><span class="line"><span class="function">            <span class="keyword">where</span> TStateMachine : IAsyncStateMachine</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Start&quot;</span>);</span><br><span class="line">            stateMachine.MoveNext();</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetStateMachine</span>(<span class="params">IAsyncStateMachine stateMachine</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetException</span>(<span class="params">Exception exception</span>)</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AwaitOnCompleted</span>&lt;<span class="title">TAwaiter</span>, <span class="title">TStateMachine</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="keyword">ref</span> TAwaiter awaiter, <span class="keyword">ref</span> TStateMachine stateMachine</span>)</span></span><br><span class="line"><span class="function">            <span class="keyword">where</span> TAwaiter : INotifyCompletion</span></span><br><span class="line"><span class="function">            <span class="keyword">where</span> TStateMachine : IAsyncStateMachine</span></span><br><span class="line">        &#123;</span><br><span class="line">            stateMachine.MoveNext();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AwaitUnsafeOnCompleted</span>&lt;<span class="title">TAwaiter</span>, <span class="title">TStateMachine</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="keyword">ref</span> TAwaiter awaiter, <span class="keyword">ref</span> TStateMachine stateMachine</span>)</span></span><br><span class="line"><span class="function">            <span class="keyword">where</span> TAwaiter : ICriticalNotifyCompletion</span></span><br><span class="line"><span class="function">            <span class="keyword">where</span> TStateMachine : IAsyncStateMachine</span></span><br><span class="line">        &#123;</span><br><span class="line">            stateMachine.MoveNext();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨, ä½ é¡¹ç›®ä¸­æ‰€æœ‰çš„å¼‚æ­¥æ–¹æ³•éƒ½ä¼šä½¿ç”¨è¿™ä¸ªè‡ªå®šä¹‰ç‰ˆæœ¬çš„<code>AsyncVoidMethodBuilder</code>. æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„å¼‚æ­¥æ–¹æ³•ç®€å•æµ‹è¯•ä¸€ä¸‹:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RunAsyncVoid</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(<span class="string">&quot;Before VoidAsync&quot;</span>);</span><br><span class="line">    VoidAsync();</span><br><span class="line">    Console.WriteLine(<span class="string">&quot;After VoidAsync&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">async</span> <span class="keyword">void</span> <span class="title">VoidAsync</span>()</span> &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœæ˜¯:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Before VoidAsync</span><br><span class="line">.ctor</span><br><span class="line">Start</span><br><span class="line">SetResult</span><br><span class="line">After VoidAsync</span><br></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥å®ç° UnsafeAwaitOnComplete æ–¹æ³•æ¥æµ‹è¯•å¸¦æœ‰ await å­å¥çš„å¼‚æ­¥æ–¹æ³•åœ¨è¿”å›æœªå®Œæˆä»»åŠ¡æ—¶çš„è¡Œä¸ºã€‚å®Œæ•´ç¤ºä¾‹å¯ä»¥åœ¨ GitHub ä¸Šæ‰¾åˆ°ã€‚</p><p>è¦ä¿®æ”¹ async Task å’Œ async Task<T> æ–¹æ³•çš„è¡Œä¸ºï¼Œæ‚¨éœ€è¦æä¾›è‡ªå·±çš„ AsyncTaskMethodBuilder å’Œ AsyncTaskMethodBuilder<T> å®ç°ã€‚å®Œæ•´çš„å®ç°ç¤ºä¾‹å¯ä»¥åœ¨æˆ‘çš„ GitHub é¡¹ç›® EduAsync(*) ä¸­æ‰¾åˆ°ï¼Œåˆ†åˆ«å¯¹åº”æ–‡ä»¶ AsyncTaskBuilder.cs å’Œ AsyncTaskMethodBuilderOfT.csã€‚</p><h1>Custom awaiters</h1><p>å‰é¢çš„ç¤ºä¾‹å±äº&quot;é»‘å®¢æ‰‹æ®µ&quot;ï¼Œå¹¶ä¸é€‚åˆç”Ÿäº§ç¯å¢ƒã€‚è™½ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼å­¦ä¹ å¼‚æ­¥æœºåˆ¶ï¼Œä½†æ‚¨è‚¯å®šä¸å¸Œæœ›åœ¨è‡ªå·±çš„ä»£ç åº“ä¸­çœ‹åˆ°è¿™æ ·çš„ä»£ç ã€‚C# è¯­è¨€è®¾è®¡è€…åœ¨ç¼–è¯‘å™¨ä¸­å†…ç½®äº†æ­£ç¡®çš„æ‰©å±•ç‚¹ï¼Œå…è®¸åœ¨å¼‚æ­¥æ–¹æ³•ä¸­&quot;await&quot;ä¸åŒçš„ç±»å‹ã€‚</p><p>è¦ä½¿æŸä¸ªç±»å‹æˆä¸º&quot;å¯ç­‰å¾…çš„&quot;ï¼ˆå³å¯ä»¥åœ¨ await è¡¨è¾¾å¼ä¸­ä½¿ç”¨ï¼‰ï¼Œè¯¥ç±»å‹éœ€è¦éµå¾ªç‰¹å®šæ¨¡å¼ï¼š</p><p>ç¼–è¯‘å™¨å¿…é¡»èƒ½å¤Ÿæ‰¾åˆ°ä¸€ä¸ªåä¸º GetAwaiter çš„å®ä¾‹æ–¹æ³•æˆ–æ‰©å±•æ–¹æ³•ã€‚è¯¥æ–¹æ³•çš„è¿”å›ç±»å‹éœ€è¦æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š</p><ul><li>å¿…é¡»å®ç° INotifyCompletion æ¥å£</li><li>å¿…é¡»åŒ…å« bool IsCompleted {get;} å±æ€§</li><li>å¿…é¡»æä¾› T GetResult() æ–¹æ³•</li></ul><p>è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥è½»æ˜“çš„å°†<code>Lazy&lt;T&gt;</code>å˜å¾—awaitable:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> LazyAwaiter&lt;T&gt; : INotifyCompletion</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> Lazy&lt;T&gt; _lazy;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LazyAwaiter</span>(<span class="params">Lazy&lt;T&gt; lazy</span>)</span> =&gt; _lazy = lazy;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">GetResult</span>()</span> =&gt; _lazy.Value;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> IsCompleted =&gt; <span class="literal">true</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnCompleted</span>(<span class="params">Action continuation</span>)</span> &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">LazyAwaiterExtensions</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="title">LazyAwaiter</span>&lt;<span class="title">T</span>&gt; <span class="title">GetAwaiter</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="keyword">this</span> Lazy&lt;T&gt; lazy</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LazyAwaiter&lt;T&gt;(lazy);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">async</span> Task <span class="title">Foo</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> lazy = <span class="keyword">new</span> Lazy&lt;<span class="built_in">int</span>&gt;(() =&gt; <span class="number">42</span>);</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">await</span> lazy;</span><br><span class="line">    Console.WriteLine(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç¤ºä¾‹å¯èƒ½çœ‹èµ·æ¥æœ‰äº›åˆ»æ„ï¼Œä½†è¿™ç§æ‰©å±•æœºåˆ¶å®é™…ä¸Šéå¸¸å®ç”¨ï¼Œå¹¶ä¸”å·²è¢«å¹¿æ³›åº”ç”¨ã€‚ä¾‹å¦‚ï¼š</p><p>.NET çš„ Reactive Extensions å°±æä¾›äº†è‡ªå®šä¹‰ç­‰å¾…å™¨ï¼Œå…è®¸åœ¨å¼‚æ­¥æ–¹æ³•ä¸­ç­‰å¾… IObservable<T> å®ä¾‹</p><p>åŸºç¡€ç±»åº“(BCL)æœ¬èº«ä¹ŸåŒ…å«å¤šä¸ªå®ç°ï¼š</p><p>YieldAwaitableï¼ˆç”± Task.Yield ä½¿ç”¨ï¼‰</p><p>HopToThreadPoolAwaitable</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> HopToThreadPoolAwaitable : INotifyCompletion</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> HopToThreadPoolAwaitable <span class="title">GetAwaiter</span>()</span> =&gt; <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> IsCompleted =&gt; <span class="literal">false</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnCompleted</span>(<span class="params">Action continuation</span>)</span> =&gt; Task.Run(continuation);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetResult</span>()</span> &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹å•å…ƒæµ‹è¯•å±•ç¤ºäº†æœ€åä¸€ä¸ªç­‰å¾…å™¨çš„å®é™…åº”ç”¨ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">Test</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> testThreadId = Thread.CurrentThread.ManagedThreadId;</span><br><span class="line">    <span class="keyword">await</span> Sample();</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">async</span> Task <span class="title">Sample</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Assert.AreEqual(Thread.CurrentThread.ManagedThreadId, testThreadId);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">await</span> <span class="literal">default</span>(HopToThreadPoolAwaitable);</span><br><span class="line">        Assert.AreNotEqual(Thread.CurrentThread.ManagedThreadId, testThreadId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»»ä½•å¼‚æ­¥æ–¹æ³•çš„ç¬¬ä¸€éƒ¨åˆ†ï¼ˆåœ¨é¦–ä¸ª await è¯­å¥ä¹‹å‰ï¼‰éƒ½ä¼šåŒæ­¥æ‰§è¡Œã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ç§æœºåˆ¶éå¸¸é€‚åˆç”¨äºç«‹å³è¿›è¡Œå‚æ•°éªŒè¯ï¼Œä½†æœ‰æ—¶æˆ‘ä»¬éœ€è¦ç¡®ä¿æ–¹æ³•ä½“ä¸ä¼šé˜»å¡è°ƒç”¨è€…çº¿ç¨‹ã€‚HopToThreadPoolAwaitable çš„ä½œç”¨å°±æ˜¯ç¡®ä¿æ–¹æ³•çš„å‰©ä½™éƒ¨åˆ†åœ¨çº¿ç¨‹æ± çº¿ç¨‹è€Œéè°ƒç”¨è€…çº¿ç¨‹ä¸­æ‰§è¡Œã€‚</p><h1>Task-Like Types</h1><p>è‡ªå®šä¹‰ç­‰å¾…å™¨ï¼ˆcustom awaitersï¼‰ä»æ”¯æŒ async/await çš„ç¼–è¯‘å™¨æœ€åˆç‰ˆæœ¬ï¼ˆå³ C# 5ï¼‰å°±å·²å­˜åœ¨ã€‚è¿™ç§æ‰©å±•æœºåˆ¶è™½ç„¶å¾ˆæœ‰ç”¨ï¼Œä½†å­˜åœ¨é™åˆ¶â€”â€”æ‰€æœ‰å¼‚æ­¥æ–¹æ³•éƒ½å¿…é¡»è¿”å› voidã€Task æˆ– Task<T>ã€‚ä» C# 7.2 å¼€å§‹ï¼Œç¼–è¯‘å™¨å¼€å§‹æ”¯æŒç±»ä»»åŠ¡ç±»å‹ã€‚</p><p>ç±»ä»»åŠ¡ç±»å‹æ˜¯æŒ‡å…·æœ‰å…³è”æ„å»ºå™¨ç±»å‹çš„ç±»æˆ–ç»“æ„ä½“ï¼Œè¯¥æ„å»ºå™¨ç±»å‹é€šè¿‡ AsyncMethodBuilderAttribute(**) æ ‡è¯†ã€‚è¦ä½¿ç±»ä»»åŠ¡ç±»å‹çœŸæ­£æœ‰ç”¨ï¼Œå®ƒå¿…é¡»æ»¡è¶³å‰ä¸€èŠ‚æè¿°çš„&quot;å¯ç­‰å¾…&quot;æ¡ä»¶ã€‚æœ¬è´¨ä¸Šï¼Œç±»ä»»åŠ¡ç±»å‹æ•´åˆäº†å‰æ–‡æ‰€è¿°çš„ä¸¤ç§æ‰©å±•æœºåˆ¶ï¼Œå¹¶å°†ç¬¬ä¸€ç§æ–¹å¼è½¬åŒ–ä¸ºå®˜æ–¹æ”¯æŒæ–¹æ¡ˆã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®šä¹‰ä¸ºç»“æ„ä½“çš„è‡ªå®šä¹‰ç±»ä»»åŠ¡ç±»å‹ç®€å•ç¤ºä¾‹ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">TaskLikeMethodBuilder</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TaskLikeMethodBuilder</span>()</span></span><br><span class="line">        =&gt; Console.WriteLine(<span class="string">&quot;.ctor&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TaskLikeMethodBuilder <span class="title">Create</span>()</span></span><br><span class="line">        =&gt; <span class="keyword">new</span> TaskLikeMethodBuilder();</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetResult</span>()</span> =&gt; Console.WriteLine(<span class="string">&quot;SetResult&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Start</span>&lt;<span class="title">TStateMachine</span>&gt;(<span class="params"><span class="keyword">ref</span> TStateMachine stateMachine</span>)</span></span><br><span class="line"><span class="function">        <span class="keyword">where</span> TStateMachine : IAsyncStateMachine</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Start&quot;</span>);</span><br><span class="line">        stateMachine.MoveNext();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> TaskLike Task =&gt; <span class="literal">default</span>(TaskLike);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// AwaitOnCompleted, AwaitUnsafeOnCompleted, SetException </span></span><br><span class="line">    <span class="comment">// and SetStateMachine are empty</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">[<span class="meta">System.Runtime.CompilerServices.AsyncMethodBuilder(typeof(TaskLikeMethodBuilder))</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> TaskLike</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> TaskLikeAwaiter <span class="title">GetAwaiter</span>()</span> =&gt; <span class="literal">default</span>(TaskLikeAwaiter);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> TaskLikeAwaiter : INotifyCompletion</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetResult</span>()</span> &#123; &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> IsCompleted =&gt; <span class="literal">true</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnCompleted</span>(<span class="params">Action continuation</span>)</span> &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰è¿”å›ç±»ä»»åŠ¡ç±»å‹ï¼ˆTaskLikeï¼‰çš„æ–¹æ³•ï¼Œç”šè‡³å¯ä»¥åœ¨æ–¹æ³•ä½“å†…ä½¿ç”¨ä¸åŒçš„ç±»ä»»åŠ¡ç±»å‹ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> TaskLike <span class="title">FooAsync</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">await</span> Task.Yield();</span><br><span class="line">    <span class="keyword">await</span> <span class="literal">default</span>(TaskLike);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¼•å…¥ç±»ä»»åŠ¡ç±»å‹ï¼ˆtask-like typesï¼‰çš„ä¸»è¦ç›®çš„æ˜¯å‡å°‘å¼‚æ­¥æ“ä½œçš„å¼€é”€ã€‚æ¯ä¸ªè¿”å› Task<T> çš„å¼‚æ­¥æ“ä½œè‡³å°‘ä¼šåœ¨æ‰˜ç®¡å †ä¸Šåˆ†é…ä¸€ä¸ªå¯¹è±¡â€”â€”å³ä»»åŠ¡æœ¬èº«ã€‚å¯¹äºç»å¤§å¤šæ•°åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œè¿™å®Œå…¨ä¸æ˜¯é—®é¢˜ï¼Œå°¤å…¶æ˜¯å¤„ç†ç²—ç²’åº¦å¼‚æ­¥æ“ä½œæ—¶ã€‚ä½†å¯¹äºåŸºç¡€è®¾æ–½çº§åˆ«çš„ä»£ç ï¼ˆæ¯ç§’å¯èƒ½æ¶‰åŠæ•°åƒä¸ªå°å‹ä»»åŠ¡ï¼‰è€Œè¨€ï¼Œæƒ…å†µåˆ™ä¸åŒã€‚åœ¨è¿™ç±»åœºæ™¯ä¸‹ï¼Œå‡å°‘æ¯æ¬¡è°ƒç”¨çš„å†…å­˜åˆ†é…å¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½ã€‚</p><h1>å¼‚æ­¥æ¨¡å¼æ‰©å±•åŸºç¡€</h1><p>C# ç¼–è¯‘å™¨ä¸ºæ‰©å±•å¼‚æ­¥æ–¹æ³•æä¾›äº†å¤šç§æ–¹å¼ï¼š</p><ul><li>ä¿®æ”¹ç°æœ‰åŸºäº Task çš„å¼‚æ­¥æ–¹æ³•, é€šè¿‡æä¾›è‡ªå®šä¹‰çš„ AsyncTaskMethodBuilder ç±»å‹å®ç°æ¥æ”¹å˜è¡Œä¸º</li><li>å®ç°&quot;å¯ç­‰å¾…æ¨¡å¼&quot;, é€šè¿‡å®ç° â€œawaitable patternâ€ ä½¿ç±»å‹æ”¯æŒ await æ“ä½œ</li><li>æ„å»ºè‡ªå®šä¹‰ç±»ä»»åŠ¡ç±»å‹ï¼ˆC# 7+ï¼‰, ä» C# 7 å¼€å§‹æ”¯æŒåˆ›å»ºè‡ªå·±çš„ç±»ä»»åŠ¡ç±»å‹</li></ul><h1>æ‰©å±•é˜…è¯»</h1><p>[æ·±åº¦è§£æ C# å¼‚æ­¥æ–¹æ³•](Dissecting the async methods in C#)</p><p>[EduAsync ä»£ç åº“ï¼ˆGitHubï¼‰](EduAsync repo on github)</p><p>[ç±»ä»»åŠ¡ç±»å‹è¯¦è§£](Task-like types)</p><p>ä¸‹ä¸€ç¯‡åšå®¢, æˆ‘ä»¬å°†æ¢è®¨å¼‚æ­¥æ–¹æ³•çš„æ€§èƒ½ç‰¹å¾ï¼Œå¹¶åˆ†ææ–°å‹å€¼ç±»å‹ System.ValueTask å¦‚ä½•å½±å“æ€§èƒ½è¡¨ç°ã€‚</p><h1>å­¦ä»¥è‡´ç”¨</h1><p>å°†Unityå¼‚æ­¥æ“ä½œç±»å‹å˜å¾—å¯ä»¥await<br>ç¬”è€…ä»Šå¤©æ‰¾åˆ°çš„åº”ç”¨åœºæ™¯: åœ¨Unityä¸­, å¦‚æœä½ åœ¨Editoræ¨¡å¼ä¸‹æ‰§è¡ŒæŸäº›å¼‚æ­¥æ“ä½œ, ä½ æ˜¯æ²¡æœ‰åŠæ³•é€šè¿‡MonoBehaviourå¼€å¯åç¨‹æ¥é©±åŠ¨å¼‚æ­¥æ“ä½œçš„, å½“ç„¶æœ‰ä¸€äº›å¥‡æŠ€æ·«å·§, æ¯”å¦‚I2é‚£ä¸ªå¤šè¯­è¨€æ’ä»¶, ç¬”è€…è®°å¾—å¥½åƒæ˜¯é€šè¿‡åœ¨åœºæ™¯ä¸­åˆ›å»ºä¸€ä¸ªæŒ‚åœ¨äº†å…¶å¼‚æ­¥æ“ä½œçš„MonoBehaviourçš„èŠ‚ç‚¹, åœ¨é‚£ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œå¼‚æ­¥æ“ä½œ, ä½†æ˜¯ç¬”è€…è§‰å¾—è¿˜æ˜¯ä¸å¤ªä¼˜é›…, éœ€è¦Unityåç¨‹é©±åŠ¨çš„å¼‚æ­¥æ“ä½œå˜æˆå¯ä»¥è¢«Task awaitçš„æ“ä½œ.</p><p>ä»£ç å¦‚ä¸‹:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> UnityWebRequestAsyncOperationAwaiter : ICriticalNotifyCompletion</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> UnityWebRequestAsyncOperation _asyncOperation;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UnityWebRequestAsyncOperationAwaiter</span>(<span class="params">UnityWebRequestAsyncOperation asyncOperation</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _asyncOperation = asyncOperation;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnCompleted</span>(<span class="params">Action continuation</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _asyncOperation.completed += _ =&gt; continuation();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UnsafeOnCompleted</span>(<span class="params">Action continuation</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _asyncOperation.completed += _ =&gt; continuation();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetResult</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_asyncOperation.webRequest.result != UnityWebRequest.Result.Success)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnityWebRequestException(_asyncOperation.webRequest);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> IsCompleted =&gt; _asyncOperation.isDone;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UnityWebRequestException</span> : <span class="title">Exception</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UnityWebRequestException</span>(<span class="params">UnityWebRequest request</span>) </span></span><br><span class="line"><span class="function">        : <span class="title">base</span>(<span class="params"><span class="string">$&quot;Error: <span class="subst">&#123;request.error&#125;</span>\nURL: <span class="subst">&#123;request.url&#125;</span>&quot;</span></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">UnityWebRequestAsyncOperationExtensions</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> UnityWebRequestAsyncOperationAwaiter <span class="title">GetAwaiter</span>(<span class="params"><span class="keyword">this</span> UnityWebRequestAsyncOperation asyncOperation</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UnityWebRequestAsyncOperationAwaiter(asyncOperation);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">AIDebugger</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Command(<span class="string">&quot;SetAIMatch&quot;</span>, QuickName = <span class="string">&quot;è®¾ç½®åŒ¹é…AI&quot;</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SetAIMatch</span>(<span class="params">[CommandParameter(<span class="string">&quot;æ˜¯å¦å¼€å¯AIåŒ¹é…&quot;</span></span>)]<span class="built_in">bool</span> enableAI)</span></span><br><span class="line">    &#123;</span><br><span class="line">        AIMatchDebugger.PostRequest(UserData.Instance.userId, enableAI);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AIMatchDebugger</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;UI Elements&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> InputField userIdInput;</span><br><span class="line">    <span class="keyword">public</span> Toggle needAIToggle;</span><br><span class="line">    <span class="keyword">public</span> Toggle needAIOnlyToggle;</span><br><span class="line">    <span class="keyword">public</span> Button submitButton;</span><br><span class="line">    <span class="keyword">public</span> Text statusText;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;Server Config&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">const</span> <span class="built_in">string</span> serverURL = <span class="string">&quot;http://fhdz3dfzwss.nalrer.cn:8016/gtest/dizhu/aiMatch&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        submitButton.onClick.AddListener(SubmitForm);</span><br><span class="line">        LoadDefaultValues();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">LoadDefaultValues</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        userIdInput.text = <span class="string">&quot;72087&quot;</span>;</span><br><span class="line">        needAIToggle.isOn = <span class="literal">true</span>;</span><br><span class="line">        needAIOnlyToggle.isOn = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SubmitForm</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// PostRequest();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">async</span> Task <span class="title">PostRequest</span>(<span class="params"><span class="built_in">int</span> userId, <span class="built_in">bool</span> enableAI</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// å‡†å¤‡è¡¨å•æ•°æ®</span></span><br><span class="line">            WWWForm form = <span class="keyword">new</span> WWWForm();</span><br><span class="line">            form.AddField(<span class="string">&quot;userId&quot;</span>, userId.ToString());</span><br><span class="line">            form.AddField(<span class="string">&quot;needAI&quot;</span>, enableAI ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">            form.AddField(<span class="string">&quot;needAIOnly&quot;</span>, enableAI ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            QDebug.Log(<span class="string">&quot;è¯·æ±‚å‘å‡ºå»äº†&quot;</span>);</span><br><span class="line">            <span class="comment">// å‘é€è¯·æ±‚</span></span><br><span class="line">            <span class="keyword">using</span> (UnityWebRequest www = UnityWebRequest.Post(serverURL, form))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">await</span> www.SendWebRequest();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (www.result != UnityWebRequest.Result.Success)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// statusText.text = $&quot;Error: &#123;www.error&#125;&quot;;</span></span><br><span class="line">                    QDebug.LogError(www.error);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// statusText.text = &quot;ä¿®æ”¹æˆåŠŸ&quot;;</span></span><br><span class="line">                    QDebug.Log(<span class="string">&quot;Form upload complete!&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            QDebug.LogError(<span class="string">&quot;å‘ç”Ÿå¼‚å¸¸äº†&quot;</span>);</span><br><span class="line">            <span class="keyword">throw</span>; <span class="comment">// TODO handle exception</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>æ€»ç»“</h1><p>ç¬”è€…æš‚ä¸”è®¤ä¸ºç¬¬ä¸‰ç§ Task-Like Typesæ˜¯å½“å‰ä¸»æµçš„C#ä¸­å®ç°è‡ªå®šä¹‰å¼‚æ­¥çš„æ–¹å¼. æƒ³è¦ç”¨è¿™ç§æ–¹å¼å®ç°å¼‚æ­¥, ä½ éœ€è¦:</p><p>ä½ æœ‰å¾ˆå¤šçš„æ“ä½œ, æ— è®ºæ˜¯C#æä¾›ç»™ä½ çš„Taskè¿˜æ˜¯ä½ è‡ªå·±åŸºäºC#å®ç°çš„ç±»Taskéƒ½æ˜¯æŠŠä½ æƒ³è¦ç”¨å¼‚æ­¥æ–¹å¼æ‰§è¡Œçš„æ“ä½œåŒ…è£…èµ·æ¥.</p><p>æ„å»ºè‡ªå·±çš„å¼‚æ­¥æœ‰ä¸‰ä¸ªé‡è¦è§’è‰²:</p><ul><li>è‡ªå·±çš„AsyncMethodBuilder</li><li>è‡ªå·±çš„Awaiter</li><li>è‡ªå·±çš„TaskLikeç±»å‹ è¿™é‡Œæ³¨æ„<code>awaiter</code>æ˜¯<code>awaiter</code>, <code>tasklike</code>æ˜¯<code>tasklike</code>, ä½†æ˜¯ETTaskå°†æ—¢æ˜¯tasklikeåˆæ˜¯awaiter</li></ul><ol><li>æœ‰ä¸€ä¸ªåä¸º<code>TaskLikeMethodBuilder</code>çš„method builder, è¿™ä¸ªBuilderé‡Œé¢éœ€è¦å¦‚ä¸‹æ¥å£<ul><li>public static TaskLikeMethodBuilder <strong>Create</strong>()æ¥å£</li><li>public void <strong>Start</strong><TStateMachine>(ref TStateMachine stateMachine) where TStateMachine : IAsyncStateMachineæ¥å£</li><li>public void <strong>SetException</strong>(Exception e)æ¥å£</li><li>public void <strong>SetResult</strong>() æ¥å£</li><li>public void <strong>AwaitOnCompleted</strong>&lt;TAwaiter, TStateMachine&gt;(<br>ref TAwaiter awaiter, ref TStateMachine stateMachine)<br>where TAwaiter : INotifyCompletion<br>where TStateMachine : IAsyncStateMachine æ¥å£</li><li>public void <strong>AwaitUnsafeOnCompleted</strong>&lt;TAwaiter, TStateMachine&gt;(<br>ref TAwaiter awaiter, ref TStateMachine stateMachine)<br>where TAwaiter : ICriticalNotifyCompletion<br>where TStateMachine : IAsyncStateMachine æ¥å£</li><li>public void <strong>SetStateMachine</strong>(IAsyncStateMachine stateMachine) æ¥å£</li><li>public TaskLike <strong>Task</strong> // åå­—å¿…é¡»æ˜¯Task</li></ul></li><li>æœ‰ä¸€ä¸ªå®ç°äº†ICriticalNotifyCompletionæ¥å£çš„ç±»<ul><li>OnCompleted(Action continuation)</li><li>UnsafeOnCompleted(Action continuation)</li></ul></li><li>ä¸€ä¸ªTasklikeç±»<ul><li>æœ‰ä¸€ä¸ªGetAwaiter</li><li>GetResult()æ¥å£</li><li>IsCompletedå±æ€§ æ³¨æ„å¿…é¡»æ˜¯å±æ€§(Property)</li></ul></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;é¦–å…ˆè¦ææ¸…æ¥š, ä¸ºä»€ä¹ˆè¦å®ç°æˆ‘ä»¬è‡ªå·±çš„å¼‚æ­¥, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Taskæ¥å®Œæˆæˆ‘ä»¬çš„å¼‚æ­¥æ“ä½œ, æˆ‘ä»¬å°†éœ€è¦å¼‚æ­¥çš„æ“ä½œç”¨TaskåŒ…è£…, Task(Awaiter)ä½•æ—¶ç»“æŸã€å¦‚ä½•è°ƒåº¦éƒ½æ˜¯TaskScheduleråšçš„, æˆ‘ä»¬æ²¡æœ‰å¤ªå¤šæƒé™å¹²é¢„ æˆ‘ä»¬èƒ½åšçš„åªæ˜¯å‘Šè¯‰Task ç­‰ä½ çš„ä»»åŠ¡å®Œæˆ</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Dissecting the async methods in CSharp</title>
    <link href="https://soincredible.github.io/posts/72dba58e/"/>
    <id>https://soincredible.github.io/posts/72dba58e/</id>
    <published>2025-05-07T12:44:20.000Z</published>
    <updated>2025-05-13T15:38:21.386Z</updated>
    
    <content type="html"><![CDATA[<h1>å…³äºå¼‚æ­¥çš„å†å²</h1><p>C#å¼€å‘è€…åœ¨ç¬¬ä¸€æ¬¡æ¥è§¦å¼‚æ­¥çš„æ¦‚å¿µ, åº”è¯¥æ˜¯é€šè¿‡Taskç±»å‹. Taskæ˜¯åœ¨<code>.Net 4.0</code>çš„æ—¶å€™è¢«å¼•å…¥çš„. ä¸€ä¸ªtaskå°±æ˜¯ä¸€ä¸ªworkå•å…ƒ, ä¸”è¯¥taskæ‰¿è¯º, åœ¨è¿™ä¸ªtaskæœªæ¥å®Œæˆçš„æ—¶å€™, ä¼šå°†ç»“æœè¿”å›ç»™taskçš„è°ƒç”¨è€…. è¿™ä¸ªTaskå¯èƒ½æ˜¯ç”±IOæ“ä½œæ”¯æŒæˆ–è€…è®¡ç®—å¯†é›†å‹æ“ä½œ(è¿™æ­£å¥½å¯¹åº”äº†ç¬”è€…åœ¨åç¨‹éƒ¨åˆ†æ‰€è¯´çš„CPUå¯†é›†å‹æ“ä½œå’ŒIOå‹æ“ä½œ, Unityåç¨‹åªèƒ½ç”¨æ¥åšIOå‹çš„å¼‚æ­¥æ“ä½œ). é‡è¦çš„æ˜¯è¯¥æ“ä½œçš„ç»“æœæ˜¯è‡ªåŒ…å«çš„ï¼Œä¸”å…·æœ‰ä¸€ç­‰å…¬æ°‘èº«ä»½ã€‚ä½ å¯ä»¥è‡ªç”±ä¼ é€’è¿™ä¸ª&quot;æœªæ¥&quot;ï¼šå°†å…¶å­˜å‚¨åœ¨å˜é‡ä¸­ã€ä»æ–¹æ³•è¿”å›å®ƒã€æˆ–ä¼ é€’ç»™å…¶ä»–æ–¹æ³•ã€‚ä½ å¯ä»¥å°†ä¸¤ä¸ª&quot;æœªæ¥&quot;åˆå¹¶å½¢æˆæ–°çš„ä»»åŠ¡ï¼Œå¯ä»¥åŒæ­¥ç­‰å¾…ç»“æœï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ·»åŠ &quot;å»¶ç»­&quot;æ¥&quot;ç­‰å¾…&quot;ç»“æœã€‚ä»…å‡­ä»»åŠ¡å®ä¾‹æœ¬èº«ï¼Œä½ å°±èƒ½å†³å®šåœ¨æ“ä½œæˆåŠŸã€å¤±è´¥æˆ–è¢«å–æ¶ˆæ—¶é‡‡å–ä½•ç§å¤„ç†ã€‚</p><p>ä»»åŠ¡å¹¶è¡Œåº“ (TPL) æ”¹å˜äº†æˆ‘ä»¬å¯¹å¹¶å‘ç¼–ç¨‹çš„è®¤çŸ¥ï¼Œè€Œ C# 5 é€šè¿‡å¼•å…¥ async/await è¿›ä¸€æ­¥æ¨åŠ¨äº†è¿™ä¸€å‘å±•ã€‚async/await è®©ä»»åŠ¡çš„ç»„åˆå˜å¾—æ›´åŠ å®¹æ˜“ï¼Œå¹¶å…è®¸å¼€å‘è€…ä½¿ç”¨ç†Ÿæ‚‰çš„ä»£ç ç»“æ„ï¼Œå¦‚ try/catchã€using ç­‰ã€‚ä½†æ˜¯async/awaitä¹Ÿæœ‰å…¶å¼€é”€. è¦ç†è§£å…·ä½“å¼€é”€æ˜¯ä»€ä¹ˆ, æˆ‘ä»¬éœ€è¦æ·±å…¥åº•å±‚æœºåˆ¶ä¸­.</p><h1>å¼‚æ­¥æ–¹æ³•å†…éƒ¨</h1><p>æ™®é€šæ–¹æ³•åªæœ‰ä¸€ä¸ªå…¥å£ç‚¹å’Œä¸€ä¸ªé€€å‡ºç‚¹ï¼ˆè™½ç„¶å¯èƒ½æœ‰å¤šä¸ª return è¯­å¥ï¼Œä½†åœ¨è¿è¡Œæ—¶ï¼Œæ¯æ¬¡è°ƒç”¨ä»…æœ‰ä¸€ä¸ªå®é™…é€€å‡ºç‚¹ï¼‰ã€‚ä½† å¼‚æ­¥æ–¹æ³•ï¼ˆ*ï¼‰ å’Œ è¿­ä»£å™¨æ–¹æ³•ï¼ˆåŒ…å« yield return çš„æ–¹æ³•ï¼‰åˆ™ä¸åŒã€‚å¯¹äºå¼‚æ­¥æ–¹æ³•è€Œè¨€ï¼Œè°ƒç”¨æ–¹å‡ ä¹å¯ä»¥ç«‹å³è·å–ç»“æœï¼ˆå³ Task æˆ– Task<T>ï¼‰ï¼Œç„¶åé€šè¿‡è¿”å›çš„ä»»åŠ¡ï¼ˆTaskï¼‰æ¥ â€œawaitâ€ æ–¹æ³•çš„å®é™…æ‰§è¡Œç»“æœã€‚</p><p>ï¼ˆ*ï¼‰æˆ‘ä»¬å®šä¹‰çš„ â€œå¼‚æ­¥æ–¹æ³•â€ æ˜¯æŒ‡ç”¨ async ä¸Šä¸‹æ–‡å…³é”®å­—æ ‡è®°çš„æ–¹æ³•ã€‚è¿™å¹¶ä¸ä¸€å®šæ„å‘³ç€è¯¥æ–¹æ³•ä¼šå¼‚æ­¥æ‰§è¡Œï¼Œç”šè‡³å®Œå…¨ä¸æ„å‘³ç€å®ƒæ˜¯å¼‚æ­¥çš„ã€‚å®ƒä»…è¡¨ç¤º ç¼–è¯‘å™¨ä¼šå¯¹è¯¥æ–¹æ³•è¿›è¡ŒæŸäº›ç‰¹æ®Šè½¬æ¢ã€‚</p><p>çœ‹ä¸€ä¸‹ä¸‹é¢è¿™ä¸ªå¼‚æ­¥æ–¹æ³•:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">StockPrices</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">decimal</span>&gt; _stockPrices;</span><br><span class="line">    <span class="comment">// è¢«æ ‡è®°äº†asyncçš„æ–¹æ³•, Compilerä¼šåœ¨èƒŒåå°†å…¶å†…éƒ¨çš„é€»è¾‘è½¬è°ƒç”¨ä¸€ä¸ªçŠ¶æ€æœº</span></span><br><span class="line">    <span class="comment">// è€Œè¿™ä¸ªå¼‚æ­¥æ–¹æ³•ä¸­åŸæ¥çš„é€»è¾‘ä¼šå…¨éƒ¨è½¬ç§»åˆ°Compilerè‡ªåŠ¨ç”Ÿæˆçš„çŠ¶æ€æœºçš„MoveNextæ–¹æ³•ä¸­ </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;<span class="built_in">decimal</span>&gt; <span class="title">GetStockPriceForAsync</span>(<span class="params"><span class="built_in">string</span> companyId</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> InitializeMapIfNeededAsync();</span><br><span class="line">        _stockPrices.TryGetValue(companyId, <span class="keyword">out</span> <span class="keyword">var</span> result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// è¢«æ ‡è®°äº†asyncçš„æ–¹æ³•, Compilerä¼šåœ¨èƒŒåå°†å…¶è½¬æ¢æˆçŠ¶æ€æœº</span></span><br><span class="line">    <span class="comment">// è€Œè¿™ä¸ªå¼‚æ­¥æ–¹æ³•ä¸­åŸæ¥çš„é€»è¾‘ä¼šå…¨éƒ¨è½¬ç§»åˆ°Compilerè‡ªåŠ¨ç”Ÿæˆçš„çŠ¶æ€æœºçš„MoveNextæ–¹æ³•ä¸­ </span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">async</span> Task <span class="title">InitializeMapIfNeededAsync</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_stockPrices != <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">await</span> Task.Delay(<span class="number">42</span>);</span><br><span class="line">        <span class="comment">// Getting the stock prices from the external source and cache in memory.</span></span><br><span class="line">        _stockPrices = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">decimal</span>&gt; &#123; &#123; <span class="string">&quot;MSFT&quot;</span>, <span class="number">42</span> &#125; &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><blockquote><p>ä¸Šé¢è¿™æ®µä»£ç ä¸­çš„ä¸¤ä¸ªæ–¹æ³•éƒ½ä½¿ç”¨äº†<code>async</code>æ ‡è®°, åˆ°å¤´æ¥éƒ½åªæ˜¯ä¸ºäº†<code>await Task.Delay(42)</code>è¿™ä¸€è¡Œä»£ç æœåŠ¡çš„.<br>ä¸ºäº†æ›´å¥½çš„ç†è§£ç¼–è¯‘å™¨åšäº†æˆ–è€…èƒ½åšä»€ä¹ˆ, è®©æˆ‘ä»¬å°è¯•ç€æ‰‹å†™ä¸€ä¸‹è½¬æ¢è¿‡ç¨‹</p></blockquote></blockquote><h1>æ‰‹åŠ¨è§£æ„å¼‚æ­¥æ–¹æ³•</h1><p>TPLï¼ˆä»»åŠ¡å¹¶è¡Œåº“ï¼‰æä¾›äº†ä¸¤å¤§æ ¸å¿ƒæ„å»ºæ¨¡å—ï¼Œå¸®åŠ©æˆ‘ä»¬æ„é€ å’Œç»„åˆä»»åŠ¡ï¼š</p><ul><li>ä»»åŠ¡å»¶ç»­ï¼ˆTask Continuationï¼‰-&gt; é€šè¿‡ <code>Task.ContinueWith</code>å®ç°</li><li>æ‰‹åŠ¨æ„å»ºä»»åŠ¡ -&gt; é€šè¿‡ <code>TaskCompletionSource&lt;T&gt;</code> ç±»å®ç°<br>ï¼ˆæ³¨ï¼šå‰è€…ç”¨äºé“¾å¼ç¼–æ’ä»»åŠ¡ï¼Œåè€…ç”¨äºæ‰‹åŠ¨æ§åˆ¶ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸã€‚ï¼‰</li></ul><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">GetStockPriceForAsync_StateMachine</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">enum</span> State &#123; Start, Step1, &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> StockPrices @this;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> <span class="built_in">string</span> _companyId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> TaskCompletionSource&lt;<span class="built_in">decimal</span>&gt; _tcs;</span><br><span class="line">    <span class="keyword">private</span> Task _initializeMapIfNeededTask;</span><br><span class="line">    <span class="keyword">private</span> State _state = State.Start;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GetStockPriceForAsync_StateMachine</span>(<span class="params">StockPrices @<span class="keyword">this</span>, <span class="built_in">string</span> companyId</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.@this = @this;</span><br><span class="line">        _companyId = companyId;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (_state == State.Start)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// The code from the start of the method to the first &#x27;await&#x27;.</span></span><br><span class="line"> </span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(_companyId))</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException();</span><br><span class="line"> </span><br><span class="line">                _initializeMapIfNeededTask = @this.InitializeMapIfNeeded();</span><br><span class="line"> </span><br><span class="line">                <span class="comment">// Update state and schedule continuation</span></span><br><span class="line">                _state = State.Step1;</span><br><span class="line">                _initializeMapIfNeededTask.ContinueWith(_ =&gt; Start());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (_state == State.Step1)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// Need to check the error and the cancel case first</span></span><br><span class="line">                <span class="keyword">if</span> (_initializeMapIfNeededTask.Status == TaskStatus.Canceled)</span><br><span class="line">                    _tcs.SetCanceled();</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (_initializeMapIfNeededTask.Status == TaskStatus.Faulted)</span><br><span class="line">                    _tcs.SetException(_initializeMapIfNeededTask.Exception.InnerException);</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// The code between first await and the rest of the method</span></span><br><span class="line"> </span><br><span class="line">                    @this._stockPrices.TryGetValue(_companyId, <span class="keyword">out</span> <span class="keyword">var</span> result);</span><br><span class="line">                    _tcs.SetResult(result);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            _tcs.SetException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> Task&lt;<span class="built_in">decimal</span>&gt; Task =&gt; _tcs.Task;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">decimal</span>&gt; <span class="title">GetStockPriceForAsync</span>(<span class="params"><span class="built_in">string</span> companyId</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> stateMachine = <span class="keyword">new</span> GetStockPriceForAsync_StateMachine(<span class="keyword">this</span>, companyId);</span><br><span class="line">    stateMachine.Start();</span><br><span class="line">    <span class="keyword">return</span> stateMachine.Task;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç è™½ç„¶å†—é•¿ï¼Œä½†é€»è¾‘ç›¸å¯¹ç›´æ¥ã€‚åŸå…ˆåœ¨ GetStockPriceForAsync ä¸­çš„æ‰€æœ‰é€»è¾‘éƒ½è¢«è½¬ç§»åˆ°äº† GetStockPriceForAsync_StateMachine.Start æ–¹æ³•ä¸­ï¼Œè¯¥æ–¹æ³•é‡‡ç”¨äº†&quot;å»¶ç»­ä¼ é€’é£æ ¼&quot;(continuation passing style)ã€‚å¼‚æ­¥è½¬æ¢çš„æ ¸å¿ƒç®—æ³•å°±æ˜¯å°†åŸå§‹æ–¹æ³•åœ¨ await è¾¹ç•Œå¤„åˆ†å‰²æˆè‹¥å¹²ä»£ç å—ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªä»£ç å—ï¼šä»æ–¹æ³•å¼€å§‹åˆ°ç¬¬ä¸€ä¸ª await ä¹‹é—´çš„ä»£ç </li><li>ç¬¬äºŒä¸ªä»£ç å—ï¼šä»ç¬¬ä¸€ä¸ª await åˆ°ç¬¬äºŒä¸ª await ä¹‹é—´çš„ä»£ç </li><li>ç¬¬ä¸‰ä¸ªä»£ç å—ï¼šä»ç¬¬äºŒä¸ª await åˆ°ç¬¬ä¸‰ä¸ª await æˆ–æ–¹æ³•ç»“æŸçš„ä»£ç  ä»¥æ­¤ç±»æ¨</li></ul><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Step 1 of the generated state machine:</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(_companyId)) <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException();</span><br><span class="line">_initializeMapIfNeededTask = @this.InitializeMapIfNeeded();</span><br></pre></td></tr></table></figure><p>æ¯ä¸ªè¢« await çš„ä»»åŠ¡ç°åœ¨éƒ½å˜æˆäº†çŠ¶æ€æœºçš„ä¸€ä¸ªå­—æ®µï¼Œè€Œ Start æ–¹æ³•ä¼šå°†è‡ªå·±æ³¨å†Œä¸ºè¿™äº›ä»»åŠ¡çš„å»¶ç»­ï¼ˆcontinuationï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_state = State.Step1;</span><br><span class="line">_initializeMapIfNeededTask.ContinueWith(_ =&gt; Start());</span><br></pre></td></tr></table></figure><p>éšåï¼Œå½“ä»»åŠ¡å®Œæˆæ—¶ï¼ŒStartæ–¹æ³•ä¼šè¢«å›è°ƒï¼Œå¹¶é€šè¿‡æ£€æŸ¥_stateå­—æ®µæ¥ç¡®å®šå½“å‰æ‰§è¡Œé˜¶æ®µã€‚æ¥ç€ï¼ŒçŠ¶æ€æœºä¼šåˆ¤æ–­ä»»åŠ¡æ˜¯æˆåŠŸå®Œæˆã€è¢«å–æ¶ˆè¿˜æ˜¯å‡ºç°å¼‚å¸¸ã€‚å¦‚æœæ˜¯æˆåŠŸå®Œæˆçš„æƒ…å†µï¼ŒçŠ¶æ€æœºå°±ä¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªä»£ç å—ã€‚å½“æ‰€æœ‰æ“ä½œéƒ½å®Œæˆåï¼ŒçŠ¶æ€æœºä¼šè®¾ç½®TaskCompletionSource<T>å®ä¾‹çš„ç»“æœå€¼ï¼Œæ­¤æ—¶ä»GetStockPricesForAsyncè¿”å›çš„ä»»åŠ¡çŠ¶æ€å°±ä¼šå˜æ›´ä¸ºå·²å®Œæˆã€‚</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The code between first await and the rest of the method</span></span><br><span class="line"> </span><br><span class="line">@this._stockPrices.TryGetValue(_companyId, <span class="keyword">out</span> <span class="keyword">var</span> result);</span><br><span class="line">_tcs.SetResult(result); <span class="comment">// The caller gets the result back</span></span><br></pre></td></tr></table></figure><p>è¿™ç§&quot;å®ç°æ–¹å¼&quot;å­˜åœ¨å‡ ä¸ªä¸¥é‡ç¼ºé™·ï¼š</p><ul><li>å¤§é‡å †å†…å­˜åˆ†é…ï¼š<ul><li>çŠ¶æ€æœºå®ä¾‹éœ€è¦1æ¬¡å†…å­˜åˆ†é…</li><li>TaskCompletionSource<T>éœ€è¦1æ¬¡åˆ†é…</li><li>TaskCompletionSource<T>å†…éƒ¨ä»»åŠ¡éœ€è¦1æ¬¡åˆ†é…, æŒ‰ç…§GPTçš„è¯´æ³•<code>TaskCompletionSource&lt;decimal&gt;</code>å†…éƒ¨ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª<code>Task&lt;decimal&gt;</code> å®ä¾‹ï¼ˆé€šè¿‡å…¶ .Task å±æ€§è®¿é—®ï¼‰</li><li>å»¶ç»­å§”æ‰˜(delegate)éœ€è¦1æ¬¡åˆ†é…, æŒ‡çš„åº”è¯¥æ˜¯<code> _initializeMapIfNeededTask.ContinueWith(_ =&gt; Start());</code></li></ul></li><li>ç¼ºå°‘&quot;çƒ­è·¯å¾„ä¼˜åŒ–&quot;ï¼š<br>å½“è¢«ç­‰å¾…çš„ä»»åŠ¡å·²ç»å®Œæˆæ—¶ï¼Œå®Œå…¨æ²¡æœ‰å¿…è¦åˆ›å»ºå»¶ç»­å§”æ‰˜</li><li>å¯æ‰©å±•æ€§ä¸è¶³ï¼š<br>å®ç°ä¸Taskç±»ç´§å¯†è€¦åˆï¼Œå¯¼è‡´æ— æ³•ç”¨äºå…¶ä»–åœºæ™¯ï¼Œä¾‹å¦‚ï¼š<ul><li>ç­‰å¾…éTaskç±»å‹</li><li>è¿”å›éTask/Task<T>ç±»å‹</li></ul></li></ul><p>ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹ä¸€ä¸‹ä¸Šè¿°æåˆ°çš„ç¼ºé™·åœ¨çœŸæ­£çš„å¼‚æ­¥æœºåˆ¶ä¸­æ˜¯å¦‚ä½•è¢«è§£å†³çš„.</p><h1>å¼‚æ­¥æœºåˆ¶</h1><p>ç¼–è¯‘å™¨æ‰§è¡Œå¼‚æ­¥æ–¹æ³•è½¬æ¢çš„æ•´ä¸ªè¿‡ç¨‹, å…¶å®å·²ç»å’Œä¸Šé¢æˆ‘ä»¬æ‰‹åŠ¨å®ç°çš„æ–¹å¼ååˆ†æ¥è¿‘äº†. ä¸ºäº†å¾—åˆ°é¢„æœŸçš„è¡Œä¸º, ç¼–è¯‘å™¨ä¾èµ–äºä»¥ä¸‹çš„ç±»å‹:</p><ul><li>å¯¹äºä¸€ä¸ªå¼‚æ­¥æ–¹æ³•çš„ç”Ÿæˆçš„çŠ¶æ€æœº, å…¶è¡Œä¸ºä¼šåƒæ ˆå¸§ä¸€æ ·, å¹¶ä¸”è¯¥çŠ¶æ€æœºåŒ…å«åŸå§‹å¼‚æ­¥æ–¹æ³•ä¸­çš„å…¨éƒ¨é€»è¾‘</li><li><code>AsyncTaskMethodBuilder&lt;T&gt;</code>æŒæœ‰å®Œæˆçš„taskï¼ˆä¸ TaskCompletionSource<T> ç±»å‹éå¸¸ç›¸ä¼¼ï¼‰, å¹¶ä¸”ç®¡ç†çŠ¶æ€æœºçš„è½¬æ¢.</li><li><code>TaskAwaiter&lt;T&gt;</code>è´Ÿè´£åŒ…è£…task, å¹¶åœ¨éœ€è¦æ—¶è°ƒåº¦å…¶å»¶ç»­</li><li><code>MoveNetRunner</code>è´Ÿè´£åœ¨æ­£ç¡®çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­è°ƒç”¨<code>IAsyncStateMachine.MoveNext</code>æ–¹æ³•</li></ul><p>ç”Ÿæˆçš„çŠ¶æ€æœºåœ¨Debugæ¨¡å¼ä¸‹æ˜¯ä¸€ä¸ªç±», åœ¨Releaseæ¨¡å¼ä¸‹åˆ™æ˜¯ä¸€ä¸ªstruct. å…¶ä»–çš„ç±»å‹(é™¤äº†<code>MoveNextRunner</code>ç±»)åœ¨BCLä¸­å‡è¢«å®šä¹‰ä¸ºäº†struct.</p><p>ç¼–è¯‘å™¨ç”Ÿæˆçš„çŠ¶æ€æœºç±»å‹åç§°é€šå¸¸ç±»ä¼¼äº<code>&lt;YourMethodNameAsync&gt;d_1</code>, ä¸ºäº†é¿å…åç§°å†²çª, ç”Ÿæˆçš„åå­—ä¸­åŒ…å«äº†ä¸€äº›æ— æ•ˆçš„æ ‡è¯†ç¬¦å­—ç¬¦, è¿™äº›å­—ç¬¦æ— æ³•è¢«ç”¨æˆ·ç›´æ¥å®šä¹‰æˆ–å¼•ç”¨. ä½†æ˜¯ä¸ºäº†ç®€åŒ–è¯´æ˜, åœ¨åç»­çš„æ‰€æœ‰ç¤ºä¾‹ä¸­, æˆ‘ä»¬è¿˜æ˜¯å°†ä½¿ç”¨æœ‰æ•ˆçš„æ ‡è¯†ç¬¦æ¥æ›¿æ¢æ‰<code>&lt;</code>ã€<code>&gt;</code>ã€<code>_</code>è¿™äº›å­—ç¬¦, å¹¶ä¸”ä½¿ç”¨æ›´å®¹æ˜“ç†è§£çš„åå­—.</p><h1>åŸå§‹æ–¹æ³•</h1><p>åŸå§‹çš„å¼‚æ­¥æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªçŠ¶æ€æœºå®ä¾‹, ç”¨æ•è·çš„çŠ¶æ€ï¼ˆå¦‚æœæ–¹æ³•éé™æ€ï¼Œåˆ™åŒ…æ‹¬ this æŒ‡é’ˆï¼‰åˆå§‹åŒ–è¯¥å®ä¾‹, é€šè¿‡ä¼ é€’çŠ¶æ€æœºå®ä¾‹çš„å¼•ç”¨å¹¶è°ƒç”¨<code>AsyncTaskMethodBuilder&lt;T&gt;.Start</code>æ¥å¯åŠ¨æ‰§è¡Œ</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">AsyncStateMachine(typeof(_GetStockPriceForAsync_d__1))</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">decimal</span>&gt; <span class="title">GetStockPriceFor</span>(<span class="params"><span class="built_in">string</span> companyId</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    _GetStockPriceForAsync_d__1 _GetStockPriceFor_d__;</span><br><span class="line">    _GetStockPriceFor_d__.__this = <span class="keyword">this</span>;</span><br><span class="line">    _GetStockPriceFor_d__.companyId = companyId;</span><br><span class="line">    _GetStockPriceFor_d__.__builder = AsyncTaskMethodBuilder&lt;<span class="built_in">decimal</span>&gt;.Create();</span><br><span class="line">    _GetStockPriceFor_d__.__state = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">var</span> __t__builder = _GetStockPriceFor_d__.__builder;</span><br><span class="line">    __t__builder.Start&lt;_GetStockPriceForAsync_d__1&gt;(<span class="keyword">ref</span> _GetStockPriceFor_d__);</span><br><span class="line">    <span class="keyword">return</span> _GetStockPriceFor_d__.__builder.Task;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼ é€’å¼•ç”¨æ˜¯ä¸€ä¸ªé‡è¦çš„ä¼˜åŒ–, å› ä¸ºä¸€ä¸ªçŠ¶æ€æœºå¾€å¾€æ˜¯ç›¸å¯¹å¤§çš„ç»“æ„(å¤§äº100bytes), å› æ­¤ä¼ é€’å¼•ç”¨ä¼šé¿å…å†—ä½™æ‹·è´.<br>çŠ¶æ€æœºä»£ç å¦‚ä¸‹:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> _GetStockPriceForAsync_d__1 : IAsyncStateMachine</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> StockPrices __this;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> companyId;</span><br><span class="line">    <span class="keyword">public</span> AsyncTaskMethodBuilder&lt;<span class="built_in">decimal</span>&gt; __builder;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> __state;</span><br><span class="line">    <span class="keyword">private</span> TaskAwaiter __task1Awaiter;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MoveNext</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">decimal</span> result;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            TaskAwaiter awaiter;</span><br><span class="line">            <span class="keyword">if</span> (__state != <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// State 1 of the generated state machine:</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(companyId))</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException();</span><br><span class="line"> </span><br><span class="line">                awaiter = __this.InitializeLocalStoreIfNeededAsync().GetAwaiter();</span><br><span class="line"> </span><br><span class="line">                <span class="comment">// Hot path optimization: if the task is completed,</span></span><br><span class="line">                <span class="comment">// the state machine automatically moves to the next step</span></span><br><span class="line">                <span class="keyword">if</span> (!awaiter.IsCompleted)</span><br><span class="line">                &#123;</span><br><span class="line">                    __state = <span class="number">0</span>;</span><br><span class="line">                    __task1Awaiter = awaiter;</span><br><span class="line"> </span><br><span class="line">                    <span class="comment">// The following call will eventually cause boxing of the state machine.</span></span><br><span class="line">                    __builder.AwaitUnsafeOnCompleted(<span class="keyword">ref</span> awaiter, <span class="keyword">ref</span> <span class="keyword">this</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                awaiter = __task1Awaiter;</span><br><span class="line">                __task1Awaiter = <span class="literal">default</span>(TaskAwaiter);</span><br><span class="line">                __state = <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">// GetResult returns void, but it&#x27;ll throw if the awaited task failed.</span></span><br><span class="line">            <span class="comment">// This exception is catched later and changes the resulting task.</span></span><br><span class="line">            awaiter.GetResult();</span><br><span class="line">            __this._stocks.TryGetValue(companyId, <span class="keyword">out</span> result);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception exception)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Final state: failure</span></span><br><span class="line">            __state = <span class="number">-2</span>;</span><br><span class="line">            __builder.SetException(exception);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Final state: success</span></span><br><span class="line">        __state = <span class="number">-2</span>;</span><br><span class="line">        __builder.SetResult(result);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">void</span> IAsyncStateMachine.SetStateMachine(IAsyncStateMachine stateMachine)</span><br><span class="line">    &#123;</span><br><span class="line">        __builder.SetStateMachine(stateMachine);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆçš„çŠ¶æ€æœºä»£ç çœ‹èµ·æ¥æ¯”è¾ƒå¤æ‚, ä½†æ˜¯æœ¬è´¨ä¸Š, å®ƒå’Œæˆ‘ä»¬æ‰‹å†™çš„é‚£ä¸€ç‰ˆçš„ä»£ç æ˜¯ååˆ†ç›¸ä¼¼çš„.<br>å³ä½¿ä¸¤ä¸ªç‰ˆæœ¬ååˆ†ç›¸ä¼¼, ä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€äº›é‡è¦çš„ä¸åŒçš„.</p><ol><li>â€œHot Pathâ€ ä¼˜åŒ–</li></ol><p>ä¸åƒæˆ‘ä»¬åŸç”Ÿçš„æ–¹å¼, ç”Ÿæˆçš„çŠ¶æ€æœºçŸ¥é“ä¸€ä¸ªè¢«awaitedçš„taskå¯èƒ½å·²ç»å®Œæˆäº†</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">awaiter = __this.InitializeLocalStoreIfNeededAsync().GetAwaiter();</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Hot path optimization: if the task is completed,</span></span><br><span class="line"><span class="comment">// the state machine automatically moves to the next step</span></span><br><span class="line"><span class="keyword">if</span> (!awaiter.IsCompleted)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Irrelevant stuff</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// The following call will eventually cause boxing of the state machine.</span></span><br><span class="line">    __builder.AwaitUnsafeOnCompleted(<span class="keyword">ref</span> awaiter, <span class="keyword">ref</span> <span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿™ä¸ªè¢«awaitçš„taskå·²ç»å®Œæˆäº†(æ— è®ºæˆåŠŸä¸å¦), çŠ¶æ€æœºä¼šå‘å‰ç›´è¡Œä¸‹ä¸€æ­¥</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GetResult returns void, but it&#x27;ll throw if the awaited task failed.</span></span><br><span class="line"><span class="comment">// This exception is catched later and changes the resulting task.</span></span><br><span class="line">awaiter.GetResult();</span><br><span class="line">__this._stocks.TryGetValue(companyId, <span class="keyword">out</span> result);</span><br></pre></td></tr></table></figure><p>è¿™å°±æ„å‘³ç€, å¦‚æœæ‰€æœ‰awaitedçš„taskéƒ½å·²ç»å®Œæˆäº†, æ•´ä¸ªçŠ¶æ€æœºå°†åªä¼šåœç•™åœ¨æ ˆä¸Š. ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ç”šè‡³åœ¨ä»Šå¤©å¦‚æœæ‰€æœ‰awaitedçš„taskéƒ½å·²ç»å®Œæˆæˆ–è€…åŒæ­¥å®Œæˆäº†, é‚£ä¹ˆè¿™ä¸ªå¼‚æ­¥æ–¹æ³•æ˜¯å¯ä»¥åªä¼šé€ æˆå¾ˆå°çš„å†…å­˜å¼€é”€çš„. ä»…å‰©çš„å¼€é”€åªæ˜¯è¿™ä¸ªtaskæœ¬èº«.</p><ol start="2"><li>é”™è¯¯å¤„ç†</li></ol><p>å½“å‰é€»è¾‘å¹¶æœªä¸“é—¨å¤„ç†ä»»åŠ¡å¤„äºæ•…éšœçŠ¶æ€æˆ–å·²å–æ¶ˆçŠ¶æ€çš„æƒ…å†µã€‚çŠ¶æ€æœºé€šè¿‡è°ƒç”¨awaiter.GetResult()æ–¹æ³•ï¼Œå½“ä»»åŠ¡è¢«å–æ¶ˆæ—¶å°†æŠ›å‡ºTaskCancelledExceptionï¼Œè‹¥ä»»åŠ¡å¤±è´¥åˆ™æŠ›å‡ºå…¶ä»–å¼‚å¸¸ã€‚è¿™ç§è®¾è®¡ååˆ†ä¼˜é›…ï¼Œå› ä¸ºGetResult()åœ¨é”™è¯¯å¤„ç†æœºåˆ¶ä¸Šä¸task.Wait()æˆ–task.Resultæœ‰æœ¬è´¨åŒºåˆ«ã€‚</p><p>æ— è®ºæ˜¯task.Wait()è¿˜æ˜¯task.Resultï¼Œå³ä¾¿ä»»åŠ¡å› å•ä¸€å¼‚å¸¸å¯¼è‡´å¤±è´¥ï¼Œå®ƒä»¬éƒ½ä¼šæŠ›å‡ºAggregateExceptionã€‚è¿™èƒŒåçš„é€»è¾‘å¾ˆç®€å•ï¼šä»»åŠ¡ä¸ä»…å¯èƒ½ä»£è¡¨é€šå¸¸åªæœ‰å•ä¸€æ•…éšœçš„IOæ“ä½œï¼Œä¹Ÿå¯èƒ½æ˜¯å¹¶è¡Œè®¡ç®—çš„ç»“æœã€‚åè€…å¯èƒ½äº§ç”Ÿå¤šä¸ªé”™è¯¯ï¼Œè€ŒAggregateExceptionæ­£æ˜¯ä¸ºèšåˆæ‰€æœ‰é”™è¯¯è€Œè®¾è®¡ã€‚</p><p>ä½†<code>async/await</code>æ¨¡å¼ä¸“ä¸ºå¼‚æ­¥æ“ä½œè®¾è®¡ï¼Œè¿™ç±»æ“ä½œé€šå¸¸æœ€å¤šåªä¼šäº§ç”Ÿä¸€ä¸ªé”™è¯¯ã€‚å› æ­¤è¯­è¨€è®¾è®¡è€…è®¤ä¸ºï¼Œè‹¥<code>awaiter.GetResult()</code>èƒ½å¯¹AggregateExceptionè¿›è¡Œè§£åŒ…å¹¶ä»…æŠ›å‡ºé¦–ä¸ªå¼‚å¸¸ï¼Œå°†æ›´ç¬¦åˆä½¿ç”¨åœºæ™¯ã€‚è¿™ä¸€è®¾è®¡å¹¶éå®Œç¾ï¼Œæˆ‘ä»¬å°†åœ¨åç»­æ–‡ç« ä¸­çœ‹åˆ°è¿™ç§æŠ½è±¡æ–¹æ¡ˆå¯èƒ½å­˜åœ¨çš„æ¼æ´ã€‚</p><p>å¼‚æ­¥çŠ¶æ€æœºåªæ˜¯æ•´ä¸ªæ‹¼å›¾çš„ä¸€éƒ¨åˆ†ã€‚è¦å®Œæ•´ç†è§£å…¶è¿ä½œæœºåˆ¶ï¼Œæˆ‘ä»¬è¿˜éœ€äº†è§£çŠ¶æ€æœºå®ä¾‹å¦‚ä½•ä¸<code>TaskAwaiter&lt;T&gt;</code>å’Œ<code>AsyncTaskMethodBuilder&lt;T&gt;</code>è¿›è¡Œäº¤äº’ã€‚</p><h1>è¿™äº›æ¨¡å—æ˜¯å¦‚ä½•è¢«è”ç³»åˆ°ä¸€èµ·çš„å‘¢?</h1><p><a href="https://devblogs.microsoft.com/wp-content/uploads/sites/31/2019/06/Async_sequence_state_machine_thumb.png"></a></p><p>å›¾è¡¨çœ‹ä¼¼è¿‡äºå¤æ‚ï¼Œä½†æ¯ä¸ªç»„ä»¶éƒ½ç»è¿‡ç²¾å¿ƒè®¾è®¡ä¸”æ‰®æ¼”ç€é‡è¦è§’è‰²ã€‚æœ€æœ‰è¶£çš„åä½œå‘ç”Ÿåœ¨ç­‰å¾…çš„ä»»åŠ¡å°šæœªå®Œæˆæ—¶ï¼ˆå›¾ä¸­ç”¨æ£•è‰²çŸ©å½¢æ ‡è®°ï¼‰ï¼š</p><p>çŠ¶æ€æœºæ³¨å†Œä»»åŠ¡å»¶ç»­</p><ul><li>çŠ¶æ€æœºè°ƒç”¨ <code>__builder.AwaitUnsafeOnCompleted(ref awaiter, ref this)</code>ï¼Œå°†è‡ªèº«æ³¨å†Œä¸ºä»»åŠ¡çš„å»¶ç»­ã€‚</li><li><code>AsyncTaskMethodBuilder</code> ç¡®ä¿ä»»åŠ¡å®Œæˆåè°ƒç”¨ <code>IAsyncStateMachine.MoveNext</code> æ–¹æ³•(è¯‘æ³¨:è¿™å¥è¯çš„æ„æ€æ˜¯è¯´, åªè¦ä½ , æ›´å‡†ç¡®åœ°è¯´è¿™æ®µä»£ç æ˜¯ç¼–è¯‘å™¨ç”Ÿæˆçš„, è°ƒç”¨äº†<code>AwaitUnsafeOnCompleted</code>æ¥å£, é‚£ä¹ˆç¼–è¯‘å™¨å°±èƒ½ä¿è¯ä»»åŠ¡å®Œæˆåä¼šè°ƒç”¨<code>IAsyncStateMachine.MoveNext</code>æ–¹æ³•äº†)ï¼š<ul><li>æ•è·å½“å‰ æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆExecutionContextï¼‰ï¼Œåˆ›å»ºä¸€ä¸ª MoveNextRunner å®ä¾‹ï¼Œå°†å…¶ä¸å½“å‰çŠ¶æ€æœºå®ä¾‹å…³è”ã€‚</li><li>ä»<code>MoveNextRunner.Run</code>åˆ›å»ºä¸€ä¸ª Action å§”æ‰˜ï¼Œç”¨äºåœ¨æ•è·çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­æ¨è¿›çŠ¶æ€æœºã€‚è°ƒç”¨ TaskAwaiter.UnsafeOnCompleted(action)ï¼Œå°†ä¸Šè¿° Action å§”æ‰˜è°ƒåº¦ä¸ºç­‰å¾…ä»»åŠ¡çš„å»¶ç»­(è¯‘æ³¨: å¯ä»¥å»çœ‹ä¸€ä¸‹C#æºç ä¸­çš„<code>MoveNextRunner</code>å’Œ<code>AsyncMethodBuilderCore</code>çš„å®ç°, å…¶ä¸­æ¸…æ™°åœ°å±•ç¤ºäº†å¦‚ä½•æ•è·å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡ã€å°†<code>IAsyncStateMachine.MoveNext</code>æ–¹æ³•å’Œæ‰§è¡Œä¸Šä¸‹æ–‡ä¸€èµ·åŒ…è£…è¿›<code>MoveNextRunner.Run</code>ç”Ÿæˆçš„Actionä¸­)ã€‚<br>å½“ç­‰å¾…çš„ä»»åŠ¡å®Œæˆæ—¶ï¼Œæ³¨å†Œçš„å›è°ƒï¼ˆAction å§”æ‰˜ï¼‰è¢«è§¦å‘ï¼ŒçŠ¶æ€æœºç»§ç»­æ‰§è¡Œå¼‚æ­¥æ–¹æ³•çš„ä¸‹ä¸€æ®µä»£ç å—ã€‚</li></ul></li></ul><p>è¿™å¼ æ—¶åºå›¾ä¸­<code>AsyncTaskMethodBuilder</code>çš„<code>Start</code>æ–¹æ³•çš„å…·ä½“å®ç°åœ¨ä¸Šé¢ç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç ä¸­ä½“ç°, ç¬”è€…æŠŠè¿™éƒ¨åˆ†ä»£ç è´´åˆ°ä¸‹é¢:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span>Initiates the builder&#x27;s execution with the associated state machine.<span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;TStateMachine&quot;&gt;</span>Specifies the type of the state machine.<span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;stateMachine&quot;&gt;</span>The state machine instance, passed by reference.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">[<span class="meta">SecuritySafeCritical</span>]</span><br><span class="line">[<span class="meta">DebuggerStepThrough</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Start</span>&lt;<span class="title">TStateMachine</span>&gt;(<span class="params"><span class="keyword">ref</span> TStateMachine stateMachine</span>) <span class="keyword">where</span> TStateMachine : IAsyncStateMachine</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// See comment on AsyncMethodBuilderCore.Start</span></span><br><span class="line">    <span class="comment">// AsyncMethodBuilderCore.Start(ref stateMachine);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (stateMachine == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;stateMachine&quot;</span>);</span><br><span class="line">    Contract.EndContractBlock();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Run the MoveNext method within a copy-on-write ExecutionContext scope.</span></span><br><span class="line">    <span class="comment">// This allows us to undo any ExecutionContext changes made in MoveNext,</span></span><br><span class="line">    <span class="comment">// so that they won&#x27;t &quot;leak&quot; out of the first await.</span></span><br><span class="line"></span><br><span class="line">    ExecutionContextSwitcher ecs = <span class="literal">default</span>(ExecutionContextSwitcher);</span><br><span class="line">    RuntimeHelpers.PrepareConstrainedRegions();</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        ExecutionContext.EstablishCopyOnWriteScope(<span class="keyword">ref</span> ecs);</span><br><span class="line">        stateMachine.MoveNext();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span></span><br><span class="line">    &#123;</span><br><span class="line">        ecs.Undo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®å°±æ˜¯è°ƒç”¨äº†çŠ¶æ€æœºçš„MoveNextæ–¹æ³•, ç„¶åå›åˆ°ç¼–è¯‘å™¨ä¸ºæˆ‘ä»¬ç”Ÿæˆçš„ä»£ç ä¸­, åœ¨çŠ¶æ€æœºçš„MoveNextæ–¹æ³•é‡Œ, è°ƒç”¨äº†<code> __builder.AwaitUnsafeOnCompleted(ref awaiter, ref this);</code>æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>AsyncTaskMethodBuilder</code>ä¸­çš„<code>AwaitUnsafeOnCompleted</code>çš„å…·ä½“å®ç°:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> Schedules the specified state machine to be pushed forward when the specified awaiter completes.</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;TAwaiter&quot;&gt;</span>Specifies the type of the awaiter.<span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;TStateMachine&quot;&gt;</span>Specifies the type of the state machine.<span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;awaiter&quot;&gt;</span>The awaiter.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;stateMachine&quot;&gt;</span>The state machine.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment">// çŠ¶æ€æœºè°ƒç”¨ `__builder.AwaitUnsafeOnCompleted(ref awaiter, ref this)`ï¼Œå°†è‡ªèº«æ³¨å†Œä¸ºä»»åŠ¡çš„å»¶ç»­ã€‚</span></span><br><span class="line">[<span class="meta">SecuritySafeCritical</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AwaitUnsafeOnCompleted</span>&lt;<span class="title">TAwaiter</span>, <span class="title">TStateMachine</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">ref</span> TAwaiter awaiter, <span class="keyword">ref</span> TStateMachine stateMachine</span>)</span></span><br><span class="line"><span class="function">    <span class="keyword">where</span> TAwaiter : ICriticalNotifyCompletion</span></span><br><span class="line"><span class="function">    <span class="keyword">where</span> TStateMachine : IAsyncStateMachine</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æ•è·å½“å‰ æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆExecutionContextï¼‰ï¼Œåˆ›å»ºä¸€ä¸ª MoveNextRunner å®ä¾‹ï¼Œå°†å…¶ä¸å½“å‰çŠ¶æ€æœºå®ä¾‹å…³è”ã€‚</span></span><br><span class="line">        AsyncMethodBuilderCore.MoveNextRunner runnerToInitialize = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">var</span> continuation = m_coreState.GetCompletionAction(AsyncCausalityTracer.LoggingOn ? <span class="keyword">this</span>.Task : <span class="literal">null</span>, <span class="keyword">ref</span> runnerToInitialize);</span><br><span class="line">        Contract.Assert(continuation != <span class="literal">null</span>, <span class="string">&quot;GetCompletionAction should always return a valid action.&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If this is our first await, such that we&#x27;ve not yet boxed the state machine, do so now.</span></span><br><span class="line">        <span class="keyword">if</span> (m_coreState.m_stateMachine == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Force the Task to be initialized prior to the first suspending await so </span></span><br><span class="line">            <span class="comment">// that the original stack-based builder has a reference to the right Task.</span></span><br><span class="line">            <span class="keyword">var</span> builtTask = <span class="keyword">this</span>.Task;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Box the state machine, then tell the boxed instance to call back into its own builder,</span></span><br><span class="line">            <span class="comment">// so we can cache the boxed reference.</span></span><br><span class="line">            Contract.Assert(!Object.ReferenceEquals((<span class="built_in">object</span>)stateMachine, (<span class="built_in">object</span>)stateMachine), <span class="string">&quot;Expected an unboxed state machine reference&quot;</span>);</span><br><span class="line">            <span class="comment">// æ•è·å½“å‰ æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆExecutionContextï¼‰ï¼Œåˆ›å»ºä¸€ä¸ª MoveNextRunner å®ä¾‹ï¼Œå°†å…¶ä¸å½“å‰çŠ¶æ€æœºå®ä¾‹å…³è”ã€‚ è¿™è¡Œä»£ç å†…éƒ¨å°†ä¼ å…¥çš„stateMachineä¼ é€’ç»™MoveNextRunnerçš„StateMachine</span></span><br><span class="line">            m_coreState.PostBoxInitialization(stateMachine, runnerToInitialize, builtTask);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è°ƒç”¨ TaskAwaiter.UnsafeOnCompleted(action)ï¼Œå°†ä¸Šè¿° Action å§”æ‰˜è°ƒåº¦ä¸ºç­‰å¾…ä»»åŠ¡çš„å»¶ç»­ã€‚</span></span><br><span class="line">        awaiter.UnsafeOnCompleted(continuation);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception e)</span><br><span class="line">    &#123;</span><br><span class="line">        AsyncMethodBuilderCore.ThrowAsync(e, targetContext: <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸‹å°±å’Œæ—¶åºå›¾ä¸­çš„å†…å®¹å¯¹ä¸Šäº†:<br><code>var continuation = m_coreState.GetCompletionAction(AsyncCausalityTracer.LoggingOn ? this.Task : null, ref runnerToInitialize);</code> å¯¹åº”äº†æ—¶åºå›¾ä¸­<code>MoveNextRunner</code>éƒ¨åˆ†.</p><p><code>awaiter.UnsafeOnCompleted(continuation);</code>å¯¹åº”äº†æ—¶åºå›¾ä¸­çš„<code>TaskAwaiter</code>éƒ¨åˆ†, å½“è¿™ä¸ªawaiter completeäº†ä¹‹å, å°±ä¼šè§¦å‘ä¼ å…¥çš„continuation, ä¹Ÿå°±æ˜¯stateMachineçš„<code>MoveNext</code>. æ•´ä¸ªæµç¨‹å°±è·‘é€šäº†.</p><p>åœ¨æˆ‘ä»¬ç¤ºä¾‹ä¸­è¿™ä¸ªAwaiteræ˜¯ä¸€ä¸ª<code>TaskAwaiter</code>, å…¶<code>UnsafeOnCompleted</code>æ¥å£çš„å®ç°å¦‚ä¸‹:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span>Schedules the continuation onto the <span class="doctag">&lt;see cref=&quot;System.Threading.Tasks.Task&quot;/&gt;</span> associated with this <span class="doctag">&lt;see cref=&quot;TaskAwaiter&quot;/&gt;</span>.<span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;continuation&quot;&gt;</span>The action to invoke when the await operation completes.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;exception cref=&quot;System.ArgumentNullException&quot;&gt;</span>The <span class="doctag">&lt;paramref name=&quot;continuation&quot;/&gt;</span> argument is null (Nothing in Visual Basic).<span class="doctag">&lt;/exception&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;exception cref=&quot;System.InvalidOperationException&quot;&gt;</span>The awaiter was not properly initialized.<span class="doctag">&lt;/exception&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;remarks&gt;</span>This method is intended for compiler user rather than use directly in code.<span class="doctag">&lt;/remarks&gt;</span></span></span><br><span class="line">[<span class="meta">SecurityCritical</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UnsafeOnCompleted</span>(<span class="params">Action continuation</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    OnCompletedInternal(m_task, continuation, continueOnCapturedContext:<span class="literal">true</span>, flowExecutionContext:<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">OnCompletedInternal</span>(<span class="params">Task task, Action continuation, <span class="built_in">bool</span> continueOnCapturedContext, <span class="built_in">bool</span> flowExecutionContext</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (continuation == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;continuation&quot;</span>);</span><br><span class="line">    StackCrawlMark stackMark = StackCrawlMark.LookForMyCaller;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If TaskWait* ETW events are enabled, trace a beginning event for this await</span></span><br><span class="line">    <span class="comment">// and set up an ending event to be traced when the asynchronous await completes.</span></span><br><span class="line">    <span class="keyword">if</span> ( TplEtwProvider.Log.IsEnabled() || Task.s_asyncDebuggingEnabled)</span><br><span class="line">    &#123;</span><br><span class="line">        continuation = OutputWaitEtwEvents(task, continuation);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the continuation onto the awaited task.</span></span><br><span class="line">    task.SetContinuationForAwait(continuation, continueOnCapturedContext, flowExecutionContext, <span class="keyword">ref</span> stackMark);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>C#æºç çœ‹åˆ°è¿™é‡Œå…¶å®å°±å·®ä¸å¤šäº†, å†å¾€ä¸‹çœ‹è°ƒç”¨å¯¹äºC#çš„ä½¿ç”¨è€…æ„ä¹‰å°±ä¸æ˜¯å¾ˆå¤§äº†.</p><h1>æ‰§è¡Œä¸Šä¸‹æ–‡</h1><p>é—®é¢˜ï¼šä»€ä¹ˆæ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Ÿä¸ºä½•éœ€è¦è¿™ç§å¤æ‚çš„è®¾è®¡ï¼Ÿ<br>åœ¨åŒæ­¥ä»£ç ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹é€šè¿‡ <code>çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆThread-Local Storageï¼‰</code> ç»´æŠ¤ç¯å¢ƒä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šå®‰å…¨å‡­æ®ï¼ˆå¦‚ SecurityContextï¼‰åŒºåŸŸæ€§è®¾ç½®ï¼ˆå¦‚ CultureInfoï¼‰æˆ–è€…å…¶ä»–ä¸Šä¸‹æ–‡æ•°æ®ï¼ˆå¦‚ AsyncLocal<T> çš„å€¼ï¼‰<br>å½“ä¸‰ä¸ªæ–¹æ³•åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ä¾æ¬¡è°ƒç”¨æ—¶ï¼Œè¿™äº›ä¿¡æ¯ä¼šè‡ªåŠ¨åœ¨æ–¹æ³•é—´æµåŠ¨ã€‚ä½†æ˜¯å¯¹äºå¼‚æ­¥æ–¹æ³•æ¥è¯´å°±ä¸å†æ˜¯è¿™æ ·äº†. å¼‚æ­¥æ–¹æ³•çš„æ¯ä¸ªä»£ç æ®µï¼ˆå¦‚ await å‰åçš„ä»£ç ï¼‰å¯èƒ½åœ¨ä¸åŒçº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œ<code>çº¿ç¨‹æœ¬åœ°å­˜å‚¨(Thread-Local Storage)</code>å¤±æ•ˆã€‚<br>å› æ­¤æ‰§è¡Œä¸Šä¸‹æ–‡æ´¾ä¸Šç”¨åœº, å®ƒä¸º ä¸€ä¸ªé€»è¾‘æ§åˆ¶æµ ç»´æŠ¤ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå³ä½¿è¯¥æ§åˆ¶æµè·¨è¶Šå¤šçº¿ç¨‹ã€‚<br>ä¾‹å¦‚ï¼ŒTask.Run æˆ– ThreadPool.QueueUserWorkItem ä¼š è‡ªåŠ¨æ•è·è°ƒç”¨çº¿ç¨‹çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå¹¶å°†å…¶ä¸ä»»åŠ¡ç»‘å®šã€‚<br>å½“ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œè°ƒåº¦å™¨ï¼ˆå¦‚ TaskSchedulerï¼‰é€šè¿‡ ExecutionContext.Run åœ¨æ•è·çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œå§”æ‰˜ï¼Œç¡®ä¿ç¯å¢ƒä¿¡æ¯ï¼ˆå¦‚å®‰å…¨å‡­æ®ï¼‰æ— ç¼å»¶ç»­ã€‚</p><p>é€šè¿‡ä¸‹é¢è¿™ä¸ªä¾‹å­ç†è§£ä¸€ä¸‹:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> Task <span class="title">ExecutionContextInAction</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> li = <span class="keyword">new</span> AsyncLocal&lt;<span class="built_in">int</span>&gt;();</span><br><span class="line">    li.Value = <span class="number">42</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> Task.Run(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Task.Run restores the execution context</span></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;In Task.Run: &quot;</span> + li.Value);</span><br><span class="line">    &#125;).ContinueWith(_ =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// The continuation restores the execution context as well</span></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;In Task.ContinueWith: &quot;</span> + li.Value);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­, æ‰§è¡Œä¸Šä¸‹æ–‡é€šè¿‡<code>Task.Run</code>æµå‘äº†<code>Task.ContinueWith</code>. å› æ­¤ä¸Šé¢è¿™æ®µä»£ç çš„æ‰§è¡Œç»“æœå¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In Task.Run: 42</span><br><span class="line">In Task.ContinueWith: 42</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸æ˜¯æ‰€æœ‰åœ¨BCLä¸­çš„æ–¹æ³•éƒ½ä¼šè‡ªåŠ¨æ•è·å¹¶æ¢å¤æ‰§è¡Œä¸Šä¸‹æ–‡. ä¸¤ä¸ªä¾‹å¤–æ˜¯: <code>TaskAwaiter&lt;T&gt;.UnsafeOnCompledte</code>å’Œ<code>AsyncMethodBuilder&lt;T&gt;.AwaitUnsafeOnComplete</code>. è¿™çœ‹èµ·æ¥ååˆ†å¥‡æ€ª, è¯­è¨€è®¾è®¡è€…å†³å®šæ·»åŠ ä¸å®‰å…¨çš„æ–¹æ³•æ‰‹åŠ¨ä½¿ç”¨<code>AsyncMethodBuilder&lt;T&gt;</code>å’Œ<code>MoveNetRunner</code>è€Œä¸æ˜¯ä¾èµ–äºå†…å»ºçš„ç±»ä¼¼<code>AwaitTaskContinuation</code>è¿™æ ·çš„æœºåˆ¶é©±åŠ¨æ‰§è¡Œä¸Šä¸‹æ–‡, çŒœæµ‹è¿™æ˜¯å‡ºäºæ€§èƒ½é—®é¢˜è€ƒè™‘æˆ–è€…æ˜¯å¯¹ç°æœ‰å®ç°çš„å¦ä¸€ä¸ªå¦¥å.</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">async</span> Task <span class="title">ExecutionContextInAsyncMethod</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> li = <span class="keyword">new</span> AsyncLocal&lt;<span class="built_in">int</span>&gt;();</span><br><span class="line">    li.Value = <span class="number">42</span>;</span><br><span class="line">    <span class="keyword">await</span> Task.Delay(<span class="number">42</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The context is implicitely captured. li.Value is 42</span></span><br><span class="line">    Console.WriteLine(<span class="string">&quot;After first await: &quot;</span> + li.Value);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> tsk2 = Task.Yield();</span><br><span class="line">    tsk2.GetAwaiter().UnsafeOnCompleted(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// The context is not captured: li.Value is 0</span></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Inside UnsafeOnCompleted: &quot;</span> + li.Value);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> tsk2;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The context is captured: li.Value is 42</span></span><br><span class="line">    Console.WriteLine(<span class="string">&quot;After second await: &quot;</span> + li.Value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœæ˜¯:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">After first await: 42</span><br><span class="line">Inside UnsafeOnCompleted: 0</span><br><span class="line">After second await: 42</span><br></pre></td></tr></table></figure><h1>ç»“è®º</h1><ul><li><p>å¼‚æ­¥æ–¹æ³•ï¼ˆasyncï¼‰çš„åº•å±‚è¡Œä¸ºä¸åŒæ­¥æ–¹æ³•æˆªç„¶ä¸åŒï¼Œå…¶æ ¸å¿ƒæœºåˆ¶ä¾èµ–äºç¼–è¯‘å™¨ç”Ÿæˆçš„ çŠ¶æ€æœºï¼ˆState Machineï¼‰ï¼š</p></li><li><p>ç¼–è¯‘å™¨ä¼šä¸ºæ¯ä¸ªå¼‚æ­¥æ–¹æ³•ç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„çŠ¶æ€æœºï¼Œå°†åŸæ–¹æ³•çš„å…¨éƒ¨é€»è¾‘è½¬ç§»è‡³çŠ¶æ€æœºä¸­ã€‚ çŠ¶æ€æœºè´Ÿè´£è·Ÿè¸ªæ‰§è¡Œè¿›åº¦ï¼ˆé€šè¿‡çŠ¶æ€å€¼ï¼‰ã€æŒ‚èµ·ï¼ˆawait æ—¶ï¼‰ä¸æ¢å¤ï¼ˆä»»åŠ¡å®Œæˆæ—¶ï¼‰çš„é€»è¾‘æµè½¬ã€‚</p></li><li><p>å¯¹åŒæ­¥å®Œæˆçš„æ·±åº¦ä¼˜åŒ–. è‹¥æ‰€æœ‰ç­‰å¾…çš„ä»»åŠ¡ï¼ˆawait çš„ä»»åŠ¡ï¼‰å·²åŒæ­¥å®Œæˆï¼ˆå¦‚ç¼“å­˜å‘½ä¸­ã€å†…å­˜è®¡ç®—ç­‰æ— é˜»å¡æ“ä½œï¼‰ï¼Œå¼‚æ­¥æ–¹æ³•çš„æ€§èƒ½å¼€é”€æä½ï¼Œå‡ ä¹ä¸åŒæ­¥æ–¹æ³•æ— å¼‚ã€‚<br>æ­¤ä¼˜åŒ–é¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æˆ–è°ƒåº¦ï¼Œæ˜¯å¼‚æ­¥ç¼–ç¨‹é«˜æ€§èƒ½çš„å…³é”®ä¿éšœã€‚<br>å¼‚æ­¥åœºæ™¯çš„å¤æ‚æ€§</p></li><li><p>å½“ç­‰å¾…çš„ä»»åŠ¡æœªå®Œæˆï¼ˆéœ€å¼‚æ­¥ç­‰å¾…ï¼‰æ—¶ï¼ŒçŠ¶æ€æœºä¾èµ–ä¸€ç³»åˆ—è¾…åŠ©ç±»å‹ï¼ˆå¦‚ AsyncTaskMethodBuilder<T>ã€TaskAwaiter<T>ã€MoveNextRunner ç­‰ï¼‰åä½œå®Œæˆï¼š</p><ul><li>æ³¨å†Œä»»åŠ¡å»¶ç»­ï¼ˆContinuationï¼‰ã€‚</li><li>ç»´æŠ¤æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆExecutionContextï¼‰ã€‚<br>è·¨çº¿ç¨‹è°ƒåº¦æ—¶çš„çŠ¶æ€å®‰å…¨æµè½¬ã€‚</li></ul></li></ul><p>é€šè¿‡SharpLab, æˆ‘ä»¬ç”Ÿæˆäº†æœ¬ç¯‡ç¤ºä¾‹ä¸­æ‰€æœ‰çš„ç»ç¼–è¯‘å™¨å¤„ç†è¿‡çš„å¼‚æ­¥ä»£ç :</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"><span class="keyword">using</span> System.Reflection;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.CompilerServices;</span><br><span class="line"><span class="keyword">using</span> System.Security;</span><br><span class="line"><span class="keyword">using</span> System.Security.Permissions;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"></span><br><span class="line">[<span class="meta">assembly: CompilationRelaxations(8)</span>]</span><br><span class="line">[<span class="meta">assembly: RuntimeCompatibility(WrapNonExceptionThrows = true)</span>]</span><br><span class="line">[<span class="meta">assembly: Debuggable(DebuggableAttribute.DebuggingModes.Default | DebuggableAttribute.DebuggingModes.IgnoreSymbolStoreSequencePoints | DebuggableAttribute.DebuggingModes.EnableEditAndContinue | DebuggableAttribute.DebuggingModes.DisableOptimizations)</span>]</span><br><span class="line">[<span class="meta">assembly: SecurityPermission(SecurityAction.RequestMinimum, SkipVerification = true)</span>]</span><br><span class="line">[<span class="meta">assembly: AssemblyVersion(<span class="string">&quot;0.0.0.0&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">module: UnverifiableCode</span>]</span><br><span class="line">[<span class="meta">module: RefSafetyRules(11)</span>]</span><br><span class="line"></span><br><span class="line">[<span class="meta">NullableContext(1)</span>]</span><br><span class="line">[<span class="meta">Nullable(0)</span>]</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">StockPrices</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">CompilerGenerated</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">sealed</span> <span class="keyword">class</span> &lt;<span class="title">GetStockPriceForAsync</span>&gt;<span class="title">d__1</span> : <span class="title">IAsyncStateMachine</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> &lt;&gt;<span class="number">1</span>__state;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">Nullable(0)</span>]</span><br><span class="line">        <span class="keyword">public</span> AsyncTaskMethodBuilder&lt;<span class="built_in">decimal</span>&gt; &lt;&gt;t__builder;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">Nullable(0)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> companyId;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">Nullable(0)</span>]</span><br><span class="line">        <span class="keyword">public</span> StockPrices &lt;&gt;<span class="number">4</span>__this;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">decimal</span> &lt;result&gt;<span class="number">5</span>__1;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> TaskAwaiter &lt;&gt;u__1;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">MoveNext</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">int</span> num = &lt;&gt;<span class="number">1</span>__state;</span><br><span class="line">            <span class="built_in">decimal</span> result;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                TaskAwaiter awaiter;</span><br><span class="line">                <span class="keyword">if</span> (num != <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    awaiter = &lt;&gt;<span class="number">4</span>__this.InitializeMapIfNeededAsync().GetAwaiter();</span><br><span class="line">                    <span class="keyword">if</span> (!awaiter.IsCompleted)</span><br><span class="line">                    &#123;</span><br><span class="line">                        num = (&lt;&gt;<span class="number">1</span>__state = <span class="number">0</span>);</span><br><span class="line">                        &lt;&gt;u__1 = awaiter;</span><br><span class="line">                        &lt;GetStockPriceForAsync&gt;d__1 stateMachine = <span class="keyword">this</span>;</span><br><span class="line">                        &lt;&gt;t__builder.AwaitUnsafeOnCompleted(<span class="keyword">ref</span> awaiter, <span class="keyword">ref</span> stateMachine);</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    awaiter = &lt;&gt;u__1;</span><br><span class="line">                    &lt;&gt;u__1 = <span class="literal">default</span>(TaskAwaiter);</span><br><span class="line">                    num = (&lt;&gt;<span class="number">1</span>__state = <span class="number">-1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                awaiter.GetResult();</span><br><span class="line">                &lt;&gt;<span class="number">4</span>__this._stockPrices.TryGetValue(companyId, <span class="keyword">out</span> &lt;result&gt;<span class="number">5</span>__1);</span><br><span class="line">                result = &lt;result&gt;<span class="number">5</span>__1;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception exception)</span><br><span class="line">            &#123;</span><br><span class="line">                &lt;&gt;<span class="number">1</span>__state = <span class="number">-2</span>;</span><br><span class="line">                &lt;&gt;t__builder.SetException(exception);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            &lt;&gt;<span class="number">1</span>__state = <span class="number">-2</span>;</span><br><span class="line">            &lt;&gt;t__builder.SetResult(result);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">void</span> IAsyncStateMachine.MoveNext()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//ILSpy generated this explicit interface implementation from .override directive in MoveNext</span></span><br><span class="line">            <span class="keyword">this</span>.MoveNext();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DebuggerHidden</span>]</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SetStateMachine</span>(<span class="params">IAsyncStateMachine stateMachine</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">void</span> IAsyncStateMachine.SetStateMachine(IAsyncStateMachine stateMachine)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//ILSpy generated this explicit interface implementation from .override directive in SetStateMachine</span></span><br><span class="line">            <span class="keyword">this</span>.SetStateMachine(stateMachine);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    [<span class="meta">CompilerGenerated</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">sealed</span> <span class="keyword">class</span> &lt;<span class="title">InitializeMapIfNeededAsync</span>&gt;<span class="title">d__2</span> : <span class="title">IAsyncStateMachine</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> &lt;&gt;<span class="number">1</span>__state;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> AsyncTaskMethodBuilder &lt;&gt;t__builder;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">Nullable(0)</span>]</span><br><span class="line">        <span class="keyword">public</span> StockPrices &lt;&gt;<span class="number">4</span>__this;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> TaskAwaiter &lt;&gt;u__1;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">MoveNext</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">int</span> num = &lt;&gt;<span class="number">1</span>__state;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                TaskAwaiter awaiter;</span><br><span class="line">                <span class="keyword">if</span> (num == <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    awaiter = &lt;&gt;u__1;</span><br><span class="line">                    &lt;&gt;u__1 = <span class="literal">default</span>(TaskAwaiter);</span><br><span class="line">                    num = (&lt;&gt;<span class="number">1</span>__state = <span class="number">-1</span>);</span><br><span class="line">                    <span class="keyword">goto</span> IL_007c;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (&lt;&gt;<span class="number">4</span>__this._stockPrices == <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    awaiter = Task.Delay(<span class="number">42</span>).GetAwaiter();</span><br><span class="line">                    <span class="keyword">if</span> (!awaiter.IsCompleted)</span><br><span class="line">                    &#123;</span><br><span class="line">                        num = (&lt;&gt;<span class="number">1</span>__state = <span class="number">0</span>);</span><br><span class="line">                        &lt;&gt;u__1 = awaiter;</span><br><span class="line">                        &lt;InitializeMapIfNeededAsync&gt;d__2 stateMachine = <span class="keyword">this</span>;</span><br><span class="line">                        &lt;&gt;t__builder.AwaitUnsafeOnCompleted(<span class="keyword">ref</span> awaiter, <span class="keyword">ref</span> stateMachine);</span><br><span class="line">                        <span class="comment">// ä»è¿™é‡Œè¿”å›å›å»å¹²å˜›äº†å‘¢?</span></span><br><span class="line">                        <span class="comment">// ç¨‹åºä¼šç»§ç»­æ‰§è¡Œä¸‹é¢çš„è¯­å¥</span></span><br><span class="line">                        <span class="comment">// Task(Awaiter)ä½•æ—¶ç»“æŸã€å¦‚ä½•è°ƒåº¦éƒ½æ˜¯TaskScheduleråšçš„, æˆ‘ä»¬æ²¡æœ‰å¤ªå¤šæƒé™å¹²é¢„ æˆ‘ä»¬èƒ½åšçš„åªæ˜¯</span></span><br><span class="line">                        <span class="comment">// å‘Šè¯‰Task ç­‰ä½ çš„ä»»åŠ¡å®Œæˆä¹‹å ä½ éœ€è¦è°ƒç”¨stateMachinerçš„MoveNextæ–¹æ³•</span></span><br><span class="line">                        <span class="comment">// å¦‚æœæˆ‘è¦å®ç°è‡ªå·±çš„ç±»ä¼¼ETTaskçš„åŠŸèƒ½, æˆ‘å¸Œæœ›æˆ‘èƒ½è‡ªå·±å†³å®šå¦‚ä½•è°ƒåº¦è¿™äº›ETTask, è¦ä¸ç„¶å®ç°è‡ªå·±çš„ETTaskçš„æ„ä¹‰å°±æ²¡æœ‰äº†.</span></span><br><span class="line">                        <span class="comment">// C#ä¸­å¼‚æ­¥æ“ä½œåˆ°è¿™é‡Œå°±å·²ç»æ­ç¤ºåœ°æ¯”è¾ƒæ¸…æ¥šäº†, åªæ˜¯Taskçš„è°ƒåº¦ç›®å‰å¯¹æˆ‘ä»¬æ¥è¯´è¿˜æ˜¯é»‘ç›’, æœ€å¥½å®ƒä¹Ÿåªæ˜¯é»‘ç›’</span></span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">goto</span> IL_007c;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">goto</span> end_IL_0007;</span><br><span class="line">                IL_007c:</span><br><span class="line">                awaiter.GetResult();</span><br><span class="line">                StockPrices stockPrices = &lt;&gt;<span class="number">4</span>__this;</span><br><span class="line">                Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">decimal</span>&gt; dictionary = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">decimal</span>&gt;();</span><br><span class="line">                dictionary.Add(<span class="string">&quot;MSFT&quot;</span>, <span class="number">42</span>m);</span><br><span class="line">                stockPrices._stockPrices = dictionary;</span><br><span class="line">                end_IL_0007:;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception exception)</span><br><span class="line">            &#123;</span><br><span class="line">                &lt;&gt;<span class="number">1</span>__state = <span class="number">-2</span>;</span><br><span class="line">                &lt;&gt;t__builder.SetException(exception);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            &lt;&gt;<span class="number">1</span>__state = <span class="number">-2</span>;</span><br><span class="line">            &lt;&gt;t__builder.SetResult();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">void</span> IAsyncStateMachine.MoveNext()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//ILSpy generated this explicit interface implementation from .override directive in MoveNext</span></span><br><span class="line">            <span class="keyword">this</span>.MoveNext();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DebuggerHidden</span>]</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SetStateMachine</span>(<span class="params">IAsyncStateMachine stateMachine</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">void</span> IAsyncStateMachine.SetStateMachine(IAsyncStateMachine stateMachine)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//ILSpy generated this explicit interface implementation from .override directive in SetStateMachine</span></span><br><span class="line">            <span class="keyword">this</span>.SetStateMachine(stateMachine);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">decimal</span>&gt; _stockPrices;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">AsyncStateMachine(typeof(&lt;GetStockPriceForAsync&gt;d__1))</span>]</span><br><span class="line">    [<span class="meta">DebuggerStepThrough</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">decimal</span>&gt; <span class="title">GetStockPriceForAsync</span>(<span class="params"><span class="built_in">string</span> companyId</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        &lt;GetStockPriceForAsync&gt;d__1 stateMachine = <span class="keyword">new</span> &lt;GetStockPriceForAsync&gt;d__1();</span><br><span class="line">        stateMachine.&lt;&gt;t__builder = AsyncTaskMethodBuilder&lt;<span class="built_in">decimal</span>&gt;.Create();</span><br><span class="line">        stateMachine.&lt;&gt;<span class="number">4</span>__this = <span class="keyword">this</span>;</span><br><span class="line">        stateMachine.companyId = companyId;</span><br><span class="line">        stateMachine.&lt;&gt;<span class="number">1</span>__state = <span class="number">-1</span>;</span><br><span class="line">        stateMachine.&lt;&gt;t__builder.Start(<span class="keyword">ref</span> stateMachine);</span><br><span class="line">        <span class="keyword">return</span> stateMachine.&lt;&gt;t__builder.Task;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">AsyncStateMachine(typeof(&lt;InitializeMapIfNeededAsync&gt;d__2))</span>]</span><br><span class="line">    [<span class="meta">DebuggerStepThrough</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> Task <span class="title">InitializeMapIfNeededAsync</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        &lt;InitializeMapIfNeededAsync&gt;d__2 stateMachine = <span class="keyword">new</span> &lt;InitializeMapIfNeededAsync&gt;d__2();</span><br><span class="line">        stateMachine.&lt;&gt;t__builder = AsyncTaskMethodBuilder.Create();</span><br><span class="line">        stateMachine.&lt;&gt;<span class="number">4</span>__this = <span class="keyword">this</span>;</span><br><span class="line">        stateMachine.&lt;&gt;<span class="number">1</span>__state = <span class="number">-1</span>;</span><br><span class="line">        stateMachine.&lt;&gt;t__builder.Start(<span class="keyword">ref</span> stateMachine); <span class="comment">// è¿™é‡Œé¢ä¼šç¬¬ä¸€æ¬¡è°ƒç”¨StateMachineçš„MoveNextæ–¹æ³•</span></span><br><span class="line">        <span class="keyword">return</span> stateMachine.&lt;&gt;t__builder.Task; <span class="comment">// ä¼šç«‹åˆ»è¿”å›Taskå›å» </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;å…³äºå¼‚æ­¥çš„å†å²&lt;/h1&gt;
&lt;p&gt;C#å¼€å‘è€…åœ¨ç¬¬ä¸€æ¬¡æ¥è§¦å¼‚æ­¥çš„æ¦‚å¿µ, åº”è¯¥æ˜¯é€šè¿‡Taskç±»å‹. Taskæ˜¯åœ¨&lt;code&gt;.Net 4.0&lt;/code&gt;çš„æ—¶å€™è¢«å¼•å…¥çš„. ä¸€ä¸ªtaskå°±æ˜¯ä¸€ä¸ªworkå•å…ƒ, ä¸”è¯¥taskæ‰¿è¯º, åœ¨è¿™ä¸ªtaskæœªæ¥å®Œæˆçš„æ—¶å€™, ä¼šå°†ç»“æœè¿”å›ç»™ta</summary>
      
    
    
    
    <category term="C#" scheme="https://soincredible.github.io/categories/C/"/>
    
    
    <category term="å¼‚æ­¥" scheme="https://soincredible.github.io/tags/%E5%BC%82%E6%AD%A5/"/>
    
  </entry>
  
  <entry>
    <title>ç²¾ç»†åŒ–å®éªŒç­–ç•¥ä¸‹ä¸€ç§å¤šç­–ç•¥äº¤å‰çš„ç¾æœ¯ã€åŠ¨æ•ˆæ¡†æ¶çš„å®ç°</title>
    <link href="https://soincredible.github.io/posts/4bbdbff1/"/>
    <id>https://soincredible.github.io/posts/4bbdbff1/</id>
    <published>2025-05-01T15:07:44.000Z</published>
    <updated>2025-05-07T03:12:56.673Z</updated>
    
    <content type="html"><![CDATA[<h1>ç¬”è€…å¯¹ç²¾ç»†åŒ–å®éªŒçš„å®šä¹‰</h1><p>å½“æ¸¸æˆè¦æ–°å¢æˆ–æ”¹åŠ¨ä¸€ä¸ªåŠŸèƒ½æ—¶, å¦‚æœå¼€å‘è€…ä¸èƒ½ç¡®å…¶ä¼šå¯¹ç”¨æˆ·ä½“éªŒé€ æˆä»€ä¹ˆå½±å“, å°±ä¼šç”¨åšå®éªŒçš„æ–¹å¼å°†åŠŸèƒ½å‘å¸ƒåˆ°çº¿ä¸Š, å³å°†ç”¨æˆ·åˆ†ä¸ºå¯¹ç…§ç»„å’Œå®éªŒç»„, çœ‹ä¸¤ç»„ç”¨æˆ·çš„æ•°æ®è¡¨ç°, æ¥åˆ¤æ–­è¯¥åŠŸèƒ½çš„å¥½å. å¦‚æœå®éªŒç»„æ•°æ®å¥½äºå¯¹ç…§ç»„, åˆ™åº”ç”¨å®éªŒç»„, åä¹‹åº”ç”¨å¯¹ç…§ç»„. ä¸è®ºåº”ç”¨å“ªä¸€ç»„, æ²¡æœ‰è¢«åº”ç”¨çš„é‚£ä¸€ç»„çš„ç¡¬ç¼–ç å°±å¯ä»¥åˆ é™¤æ‰, å› æ­¤å®éªŒç»„ä¸å¯¹ç…§ç»„é€»è¾‘çš„ä»£ç åªæ˜¯ä¼šä¸´æ—¶æ’å…¥åˆ°é¡¹ç›®ä¸­, åªè¦å®éªŒåº”ç”¨äº†ä¹‹åæŠŠéåº”ç”¨å®éªŒåˆ†æ”¯çš„ä»£ç åˆ å¹²å‡€, é•¿æœŸä¸‹æ¥æ˜¯ä¸ä¼šå¯¹æ•´ä¸ªé¡¹ç›®ä»£ç ç»“æ„æœ‰ä»€ä¹ˆå½±å“. ä½†æ˜¯æˆ‘ä»¬å›¢é˜Ÿåœ¨æŒ‰ç…§ä¸Šè¿°æ¨¡å¼æ¨è¿›äº†ä¸€æ®µæ—¶é—´ä¹‹åå‘ç°äº†è¿™ç§æ¨¡å¼å­˜åœ¨é—®é¢˜, åŒä¸€ä¸ªç‰ˆæœ¬ä¸Šçº¿çš„å¤šä¸ªå®éªŒä¹‹é—´å­˜åœ¨äº¤å‰, ä¸”ä¼šå¯¹å•ä¸ªå®éªŒçš„ç»“æœäº§ç”Ÿå½±å“, è€Œä¸”æœ‰çš„å®éªŒçŸ­æœŸå†…æ˜¯å®éªŒç»„çš„æ•°æ®å¥½, è€Œé•¿æœŸåˆå˜æˆäº†å¯¹ç…§ç»„çš„æ•°æ®å¥½. å› æ­¤, æˆ‘ä»¬è®¤ä¸ºä¹‹å‰å¯¹å®éªŒæ•°æ®çš„ç»“è®ºä¸å‡†ç¡®, æˆ‘ä»¬å†³å®šå°†ä¸€æ®µå‘¨æœŸå†…æœ€æ—©çš„é‚£ä¸ªç‰ˆæœ¬çš„é¡¹ç›®çŠ¶æ€å®šä¹‰ä¸º<strong>åŸºçº¿ç»„</strong>, åœ¨è¿™ä¸€å‘¨æœŸå†…çš„æ¯ä¸ªç‰ˆæœ¬ä¼šä¸Šçº¿çš„å®éªŒéƒ½ä¸ä¼šåº”ç”¨, è€Œæ˜¯ä¼šä¸€ç›´åœ¨çº¿ä¸Šè·‘, éšç€å®éªŒè¶Šå¼€è¶Šå¤š, å®éªŒä¹‹é—´çš„äº¤å‰é—®é¢˜è¶Šæ¥è¶Šä¸¥é‡, åˆå› ä¸ºè¿™äº›å®éªŒçš„åˆ†æ”¯ä»£ç ä¸ä¼šåˆ é™¤, ä»£ç ä¹Ÿä¼šå˜å¾—è¶Šæ¥è¶Šéš¾ä»¥ç»´æŠ¤, ä¸Šè¿°è¿™ç§åœ¨ä¸€æ®µå‘¨æœŸä¸Šçº¿å¤§é‡ä¸ä¼šåº”ç”¨å®éªŒ, ä¸”å¸Œæœ›æ¯ä¸ªå®éªŒéƒ½èƒ½äº¤å‰, åœ¨ä¸€æ®µå‘¨æœŸåä¼šå½¢æˆä¸Šç™¾ã€ä¸Šåƒæ¡å®éªŒåˆ†æ”¯çš„å®éªŒ, å°±æ˜¯<strong>ç²¾ç»†åŒ–å®éªŒ</strong>, å¯¹åº”çš„, æˆ‘ä»¬å›¢é˜Ÿå°±éœ€è¦ä¸€å¥—èƒ½å¤Ÿç®¡ç†ç²¾ç»†åŒ–å®éªŒçš„æ¡†æ¶.</p><h1>ç²¾ç»†åŒ–æ¡†æ¶çš„å®ç°æ€è·¯</h1><p>æ¯ä¸ªå®éªŒèƒ½å¤Ÿäº¤å‰, æ˜¯ååˆ†ç¾å¥½çš„æ„¿æ™¯. ä½†æ˜¯, åœ¨å®é™…å¼€å‘ä¸­æˆ‘ä»¬å‘ç°, ç»å¸¸ä¼šæœ‰äº’ä¸ºäº’æ–¥å…³ç³»çš„å®éªŒå­˜åœ¨, æ¯”å¦‚ä¸¤ä¸ªå®éªŒåŒæ—¶å¯¹æ¨¡å—Aåšäº†æ”¹åŠ¨, æˆ–è€…å®éªŒä¸€å½±å“æ¨¡å—ABC, å®éªŒäºŒå½±å“æ¨¡å—ABD, è¿™ç§æƒ…å†µæ˜¯ä¸å¯é¿å…çš„, å› æ­¤, ç²¾ç»†åŒ–æ¡†æ¶è¦åšçš„äº‹æƒ…, ä¸ä»…ä»…æ˜¯é©±åŠ¨è¿™äº›å®éªŒ, è¿˜è¦åˆ¶å®šä¸€å¥—è§„èŒƒ, å¤„ç†å®éªŒä¹‹é—´çš„å†²çªé—®é¢˜.</p><p>æœ¬ç¯‡åšå®¢ç¬”è€…ä¼šä»¥UIæ¢çš®å®éªŒå’ŒåŠ¨æ•ˆæ¢çš®å®éªŒä¸ºä¾‹å­, é˜è¿°UIæ¡†æ¶ã€åŠ¨æ•ˆæ’­æ”¾æ¡†æ¶çš„å®ç°æ€è·¯, ä»¥åŠè¿™äº›æ¡†æ¶å’Œç²¾ç»†åŒ–æ¡†æ¶çš„ååŒè¿‡ç¨‹.</p><h2 id="ä»ABTestæ¡†æ¶è¯´èµ·">ä»ABTestæ¡†æ¶è¯´èµ·</h2><p>æˆ‘ä»¬æœ€åˆä½¿ç”¨çš„ABæµ‹è¯•ç³»ç»Ÿååˆ†ç®€é™‹, ABæµ‹ç³»ç»Ÿåœ¨å¯åŠ¨æ—¶ä»ç£ç›˜ä¸ŠåŠ è½½ä¸Šæ¥æ‰€æœ‰çš„ABå®éªŒä¿¡æ¯, æ ¹æ®è®¾å¤‡çš„uid, åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·è¯¥è¡¨ç°ä¸ºå¯¹ç…§ç»„è¿˜æ˜¯å®éªŒç»„æ˜¯æ ¹æ®ç”¨æˆ·ä½¿ç”¨è®¾å¤‡çš„uid, æˆ‘ä»¬åœ¨åå°é…ç½®ä¸€ä¸ªå®éªŒçš„æ—¶å€™, æœ‰å¤šå°‘ä¸ªå®éªŒç»„å°±ä¼šç”Ÿæˆå‡ ä¸ªâ€œæ¡¶â€, è¿™äº›æ¡¶é‡Œé¢è£…çš„æ˜¯ç”¨æˆ·è®¾å¤‡çš„uid, ç”¨æˆ·è®¾å¤‡å¯åŠ¨æ¸¸æˆçš„æ—¶å€™, ç¨‹åºèƒ½å¤ŸçŸ¥é“å½“å‰è®¾å¤‡åœ¨å“ªä¸ªæ¡¶é‡Œ, ä½†æ˜¯åœ¨æŸä¸€ä¸ªæ¡¶é‡Œå¹¶ä¸æ„å‘³ç€å°±ä¸€å®šè¡¨ç°ä¸ºè¿™ä¸ªæ¡¶æ‰€å¯¹åº”çš„å®éªŒç»„, è¿˜æœ‰å…¶ä»–çš„é™åˆ¶æ¡ä»¶, æ¯”å¦‚å®‰è£…ç‰ˆæœ¬å¿…é¡»å¤§äºæŸä¸€ä¸ªç‰ˆæœ¬æˆ–è€…å¿…é¡»æ˜¯æ–°ç”¨æˆ·, æˆ–è€…å¿…é¡»æ˜¯æŸä¸€å›½å®¶åœ°åŒºçš„ç­‰ç­‰. æ€»ä¹‹, ä¸šåŠ¡å±‚åªéœ€è¦æŠŠå®ƒä»¬å…³ç³»çš„å®éªŒå­—æ®µä¼ å…¥, å°±èƒ½å¤Ÿæ‹¿åˆ°å½“å‰è®¾å¤‡å¯¹åº”å®éªŒæ‰€åœ¨çš„å®éªŒç»„æ˜¯å“ªä¸€ä¸ª.</p><h2 id="ç²¾ç»†åŒ–å®éªŒæ¨¡å—ç™»åœº">ç²¾ç»†åŒ–å®éªŒæ¨¡å—ç™»åœº</h2><p>ç²¾ç»†åŒ–å®éªŒè¦åšçš„, å°±æ˜¯æŠŠABTestæ¡†æ¶å’Œä¸šåŠ¡å±‚è§£è€¦, ä½œä¸ºä¸¤è€…ä¹‹é—´çš„æ¡¥æ¢. å½“ä½ æƒ³è®©ä¸¤ä¸ªæ¨¡å—è§£è€¦æ—¶, æœ€ç›´æ¥çš„æ–¹å¼å°±æ˜¯åœ¨ä¸¤ä¸ªæ¨¡å—é€šè®¯çš„æ¥å£å¤„å¢åŠ æ¡¥æ¥å±‚, æœ‰äº†è¿™å±‚æ¡¥æ¥, ABTestä¸­åºå¤§çš„æ•°æ®ä¸è‡³äºä¸€ä¸‹å­æ¶Œå‘ä¸šåŠ¡å±‚, è€Œæ˜¯åœ¨ç²¾ç»†åŒ–å®éªŒå±‚æ•´åˆã€å¤„ç†, ç²¾ç»†åŒ–å®éªŒå±‚ä¼šæŠŠABTestä¸­å½±å“åŒä¸€ä¸ªä¸šåŠ¡çš„å®éªŒä»¬æŒ‰ç…§äººä¸ºå®šä¹‰çš„è§„åˆ™è¿›è¡Œæ•´åˆã€å†²çªå¤„ç†, ç„¶åå°†ç»“æœè½¬æ¢æˆå¯¹åº”ä¸šåŠ¡èƒ½å¤Ÿè¯†åˆ«çš„æ ¼å¼â€”â€”ç²¾ç»†åŒ–å®éªŒå±‚éœ€è¦å’Œæ¯ä¸€ä¸ªå…·ä½“çš„ä¸šåŠ¡å®šä¹‰ä¸€å¥—åè®®, è¿™å¥—åè®®èƒ½å¤Ÿæè¿°, ç»è¿‡å¤šä¸ªå®éªŒçš„å¤šé‡å½±å“, è¯¥ä¸šåŠ¡æœ€ç»ˆçš„è¡¨ç°æ•ˆæœæ˜¯æ€æ ·çš„. æˆ‘ä»¬è®¡åˆ’ä½¿ç”¨Jsonä½œä¸ºè¿™äº›å®éªŒé…ç½®çš„è½½ä½“:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;1024&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;uiTest&quot;,</span><br><span class="line">        &quot;experimentSceneType&quot;: &quot;UIStyle&quot;, </span><br><span class="line">        &quot;experimentParam&quot;: &#123;</span><br><span class="line">            &quot;group1&quot;: [</span><br><span class="line">                [</span><br><span class="line">                    &quot;homePage&quot;,</span><br><span class="line">                    1</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;playPage&quot;,</span><br><span class="line">                    1</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;resultPage&quot;,</span><br><span class="line">                    1</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;settingPage&quot;,</span><br><span class="line">                    1</span><br><span class="line">                ]</span><br><span class="line">            ],</span><br><span class="line">            &quot;group2&quot;: [</span><br><span class="line">                [</span><br><span class="line">                    &quot;homePage&quot;,</span><br><span class="line">                    2</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;playPage&quot;,</span><br><span class="line">                    2</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;resultPage&quot;,</span><br><span class="line">                    2</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;settingPage&quot;,</span><br><span class="line">                    2</span><br><span class="line">                ]</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">     &quot;1025&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;uiTest2&quot;,</span><br><span class="line">        &quot;experimentSceneType&quot;: &quot;UIStyle&quot;, </span><br><span class="line">        &quot;experimentParam&quot;: &#123;</span><br><span class="line">            &quot;group1&quot;: [</span><br><span class="line">                [</span><br><span class="line">                    &quot;homePage&quot;,</span><br><span class="line">                    1</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;playPage&quot;,</span><br><span class="line">                    2</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;resultPage&quot;,</span><br><span class="line">                    1</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;settingPage&quot;,</span><br><span class="line">                    4</span><br><span class="line">                ]</span><br><span class="line">            ],</span><br><span class="line">            &quot;group2&quot;: [</span><br><span class="line">                [</span><br><span class="line">                    &quot;homePage&quot;,</span><br><span class="line">                    2</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;playPage&quot;,</span><br><span class="line">                    3</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;resultPage&quot;,</span><br><span class="line">                    5</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;settingPage&quot;,</span><br><span class="line">                    2</span><br><span class="line">                ]</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure><p>å¯¹ä¸Šè¿°Jsonæ ¼å¼åšä¸€ä¸‹è¯´æ˜, æœ€å¤–å±‚çš„æ•°å­—ä»£è¡¨å®éªŒID, <code>name</code>æ˜¯å®éªŒå, <code>experimentSceneType</code>æ˜¯å®éªŒåœºæ™¯, <code>experimentParam</code>èƒ½å¤Ÿæè¿°å®éªŒåœºæ™¯ä¸‹çš„å®éªŒå†…å®¹, <code>group</code>ä»£è¡¨å®éªŒåˆ†ç»„, ä¸åŒå®éªŒåœºæ™¯ä¸‹<code>group</code>å­—æ®µä¸‹çš„ç»“æ„ä¸ä¸€æ ·, åœ¨<code>UIStyle</code>å®éªŒåœºæ™¯ä¸‹æ˜¯ä¸€ä¸ªåˆ—è¡¨, æ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ªUI, å’Œè¯¥UIä½¿ç”¨çš„<code>styleId</code>.</p><p>ç¨‹åºå¯åŠ¨æ—¶å¿…å®šåŠ è½½ä¸Šé¢ä¸¤ä¸ªå®éªŒ, å¹¶å‘½ä¸­å…¶ä¸­ä¸€ä¸ªå®éªŒç»„, è€Œè¿™ä¸¤ä¸ªå®éªŒæ˜¯äº’æ–¥çš„, å› æ­¤ä¼šåœ¨ç²¾ç»†åŒ–å®éªŒå±‚è¿›è¡Œå¤„ç†. å…·ä½“çš„å¤„ç†è§„åˆ™, åˆ™éœ€è¦å’Œç­–åˆ’å›¢é˜Ÿä¸€èµ·åˆ¶å®š, ç¡¬ç¼–ç è¿›ç²¾ç»†åŒ–å®éªŒæ¨¡å—ä¸­, ç­‰ä¸šåŠ¡åœºæ™¯è¶³å¤Ÿä¸°å¯Œçš„æ—¶å€™, ä¹Ÿè®¸å¯ä»¥ä»ä¸­æå–å‡ºä¸€å¥—è§„åˆ™æ¥æ”¯æŒé…ç½®. ä¸è¿‡è¿™å°±ä¸åœ¨æœ¬ç¯‡åšå®¢è¦è®¨è®ºçš„èŒƒç•´å†…äº†. æ€»ä¹‹, ç»è¿‡ç²¾ç»†åŒ–å±‚çš„å¤„ç†ä¹‹å, UIStyleå®éªŒåœºæ™¯ä¼šå¾—åˆ°ä¸€ç»„ç±»ä¼¼groupå­—æ®µå†…çš„åˆ—è¡¨, è¿™é‡Œé¢å­˜å‚¨äº†æ‰€æœ‰UIçš„styleId, UIManagerä¾§ç»´æŠ¤ç€æ¯ä¸ªUIæ¯ä¸ªstyleIdçš„æ˜ å°„å…³ç³». æœ‰ç²¾ç»†åŒ–å±‚ä¼ æ¥çš„å‚æ•°, UIManagerå°±å¯ä»¥ç»™æ¯ä¸ªUIè®¾ç½®è¿è¡Œæ—¶styleIdäº†.</p><p>æˆ‘ä»¬è®¾è®¡çš„å®éªŒè¡¨æ ¼å¦‚ä¸‹:</p><h2 id="UIæ¡†æ¶çš„é…è¡¨">UIæ¡†æ¶çš„é…è¡¨</h2><h2 id="éŸ³é¢‘æ¡†æ¶é…è¡¨">éŸ³é¢‘æ¡†æ¶é…è¡¨</h2><h2 id="åŠ¨æ•ˆé…è¡¨">åŠ¨æ•ˆé…è¡¨</h2><h2 id="å®éªŒé…ç½®">å®éªŒé…ç½®</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;ç¬”è€…å¯¹ç²¾ç»†åŒ–å®éªŒçš„å®šä¹‰&lt;/h1&gt;
&lt;p&gt;å½“æ¸¸æˆè¦æ–°å¢æˆ–æ”¹åŠ¨ä¸€ä¸ªåŠŸèƒ½æ—¶, å¦‚æœå¼€å‘è€…ä¸èƒ½ç¡®å…¶ä¼šå¯¹ç”¨æˆ·ä½“éªŒé€ æˆä»€ä¹ˆå½±å“, å°±ä¼šç”¨åšå®éªŒçš„æ–¹å¼å°†åŠŸèƒ½å‘å¸ƒåˆ°çº¿ä¸Š, å³å°†ç”¨æˆ·åˆ†ä¸ºå¯¹ç…§ç»„å’Œå®éªŒç»„, çœ‹ä¸¤ç»„ç”¨æˆ·çš„æ•°æ®è¡¨ç°, æ¥åˆ¤æ–­è¯¥åŠŸèƒ½çš„å¥½å. å¦‚æœå®éªŒç»„æ•°æ®å¥½äºå¯¹ç…§ç»„, åˆ™åº”ç”¨å®éªŒç»„</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>æ—¶åŠ¿:å‘¨æœŸæ³¢åŠ¨ä¸‹çš„å›½å®¶ã€ç¤¾ä¼šå’Œä¸ªäºº</title>
    <link href="https://soincredible.github.io/posts/1cb37a62/"/>
    <id>https://soincredible.github.io/posts/1cb37a62/</id>
    <published>2025-04-29T05:58:00.000Z</published>
    <updated>2025-05-07T03:12:56.673Z</updated>
    
    <content type="html"><![CDATA[<h1>æ—¥æœ¬å¤±è½çš„ä¸‰åå¹´</h1><p>æ—¥æœ¬è´¢å›¢</p><p>å¹¿åœºåè®®</p><p>å›½å€º</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;æ—¥æœ¬å¤±è½çš„ä¸‰åå¹´&lt;/h1&gt;
&lt;p&gt;æ—¥æœ¬è´¢å›¢&lt;/p&gt;
&lt;p&gt;å¹¿åœºåè®®&lt;/p&gt;
&lt;p&gt;å›½å€º&lt;/p&gt;
</summary>
      
    
    
    
    <category term="è¯»ä¸‡å·ä¹¦" scheme="https://soincredible.github.io/categories/%E8%AF%BB%E4%B8%87%E5%8D%B7%E4%B9%A6/"/>
    
    
    <category term="è¯»ä¹¦ç¬”è®°" scheme="https://soincredible.github.io/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>å¯¹C#ä¸­ç±»å‹è½¬æ¢å’Œæ‹†è£…ç®±çš„æ€è€ƒ</title>
    <link href="https://soincredible.github.io/posts/fad28a7c/"/>
    <id>https://soincredible.github.io/posts/fad28a7c/</id>
    <published>2025-04-26T03:18:44.000Z</published>
    <updated>2025-05-10T06:14:44.896Z</updated>
    
    <content type="html"><![CDATA[<h1>ç±»å‹è½¬æ¢çš„å¼€é”€æ¥è‡ªå“ªé‡Œ?</h1><p>ç±»å‹è½¬æ¢åœ¨æ—¶é—´å’Œç©ºé—´ä¸Šéƒ½ä¼šé€ æˆå¼€é”€, å› ä¸ºç±»å‹è½¬æ¢C#ç¼–è¯‘å™¨ä¼šç”Ÿæˆé¢å¤–çš„ç±»å‹è½¬æ¢å¤„ç†ä»£ç , å¯¼è‡´ä»£ç æ–‡ä»¶çš„ä½“ç§¯å˜å¤§. æ—¢ç„¶æœ‰é¢å¤–çš„ILä»£ç ç”Ÿæˆåˆ™å°±éœ€è¦æœ‰é¢å¤–çš„æ—¶é—´å»æ‰§è¡Œ. å¦‚æœç±»å‹è½¬æ¢ä¸­æ¶‰åŠåˆ°è£…æ‹†ç®±æ“ä½œ, åˆ™è¿˜ä¼šå¯¹è¿è¡Œæ—¶å†…å­˜äº§ç”Ÿå½±å“.</p><ul><li>CLRä¼šç”Ÿæˆé¢å¤–ILä»£ç æ‰§è¡Œç±»å‹è½¬æ¢æ˜¯å¦åˆæ³•çš„åˆ¤æ–­é€»è¾‘, è¿™éƒ¨åˆ†å¼€é”€æ˜¯ä¸å¯é¿å…çš„, å³ä¾¿å¼€å‘è€…ç¬ƒå®šç±»å‹è½¬æ¢å¿…å®šåˆæ³•. ä¸è¿‡è¿™éƒ¨åˆ†å¼€é”€çš„å½±å“å¹¶ä¸å¤§. å¦‚æœç±»å‹è½¬æ¢åˆ¤å®šä¸ºä¸åˆæ³•, åˆ™éœ€è¦é¢å¤–çš„å¼€é”€æ¥å¤„ç†å¼‚å¸¸, æˆ‘ä»¬é€šå¸¸ä¼šæœ‰ä¸¤ç§ç±»å‹è½¬æ¢çš„æ–¹å¼, ä¸¤ç§è½¬æ¢æ–¹å¼ä¸åˆæ³•çš„å¤„ç†çš„å¼€é”€ä¸åŒ:<ul><li>ä½¿ç”¨ç±»å‹å¼ºè½¬, å³<code>var a = (someType)b</code>å½¢å¼, è¿™ç§æ–¹å¼åœ¨è½¬æ¢ä¸åˆæ³•çš„æ—¶å€™ä¼šæŠ›å‡ºå¼‚å¸¸, å¼€é”€è¾ƒå¤§.</li><li>ä½¿ç”¨<code>as</code>æ“ä½œç¬¦,å³<code>var a = b as someType</code>, è¿™ç§æ–¹å¼åœ¨è½¬æ¢ä¸åˆæ³•çš„æ—¶å€™ä¼šå°†aå­—æ®µè®¾ç½®ä¸º<code>null</code>,å¼€é”€å°. æ›´æ¨èä½¿ç”¨è¿™ç§æ–¹å¼.<br>ä¸è¿‡å¦‚æœä½ çœŸçš„ç¬ƒå®šç±»å‹è½¬æ¢ä¸ä¼šå‡ºé”™, é‚£ä¹ˆä»¥ä¸Šè¿™ä¸¤ç§ç±»å‹è½¬æ¢çš„æ–¹å¼å…¶å®å½±å“ä¸å¤§.</li></ul></li><li>æ‹†ç®±è£…ç®±é€ æˆçš„å¼€é”€, è¯·è®°ä½è¿™å¥è¯:<strong>è£…ç®±æ‹†ç®±ä¸€å®šæ˜¯ç±»å‹è½¬æ¢é€ æˆçš„, ä½†æ˜¯ç±»å‹è½¬æ¢ä¸ä¸€å®šä¼šå¯¼è‡´è£…ç®±æ‹†ç®±</strong> è£…æ‹†ç®±è¯¦è§£è¯·ç»§ç»­å¾€ä¸‹çœ‹.</li></ul><h1>å€¼ç±»å‹ä¸å¼•ç”¨ç±»å‹</h1><p>å€¼ç±»å‹åˆ›å»ºåœ¨æ ˆä¸Š, å †ç±»å‹åˆ›å»ºåœ¨å †ä¸Š è¿™å¥è¯æ˜¯ä¸å®Œå…¨å¯¹çš„, æ›´å‡†ç¡®çš„æè¿°æ˜¯: å¼•ç”¨ç±»å‹ä¸€å®šåˆ›å»ºåœ¨å †ä¸Š, å€¼ç±»å‹æ—¢å¯ä»¥åˆ›å»ºåœ¨å †ä¸Š, ä¹Ÿå¯ä»¥åˆ›å»ºåœ¨æ ˆä¸Š, å€¼ç±»å‹åˆ›å»ºåœ¨æ ˆè¿˜æ˜¯å †ä¸Šå–å†³äºå®ƒæ‰€åœ¨çš„å®¹å™¨: å¦‚æœå€¼ç±»å‹æ˜¯å¼•ç”¨ç±»å‹çš„ä¸€ä¸ªæˆå‘˜å­—æ®µ, åˆ™è¯¥å€¼ç±»å‹åˆ›å»ºåœ¨å †ä¸Š, å¦‚æœè¯¥å€¼ç±»å‹æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡(ä¸´æ—¶å˜é‡)æˆ–è€…æ˜¯ä¸€ä¸ªæ˜¯å¦å¤–ä¸€ä¸ªå€¼ç±»å‹çš„å­—æ®µæˆå‘˜çš„è¯, åˆ™åˆ›å»ºåœ¨å †ä¸Š.</p><h1>è£…ç®±æ‹†ç®±çš„å¼€é”€æ¥è‡ªå“ªé‡Œ</h1><p><strong>è£…ç®±è¿‡ç¨‹å‘ç”Ÿäº†ä»€ä¹ˆ</strong></p><ol><li>åœ¨æ‰˜ç®¡å †ä¸­åˆ†é…å†…å­˜, åˆ†é…çš„å†…å­˜é‡æ˜¯å€¼ç±»å‹å„å­—æ®µæ‰€éœ€çš„å†…å­˜é‡, è¿˜è¦åŠ ä¸Šæ‰˜ç®¡å †æ‰€æœ‰å¯¹è±¡éƒ½æœ‰çš„ä¸¤ä¸ªé¢å¤–æˆå‘˜(ç±»å‹å¯¹è±¡æŒ‡é’ˆå’ŒåŒæ­¥å—ç´¢å¼•)æ‰€éœ€çš„å†…å­˜é‡</li><li>å€¼ç±»å‹çš„å­—æ®µå¤åˆ¶åˆ°æ–°åˆ†é…çš„å †å†…å­˜</li><li>è¿”å›å¯¹è±¡åœ°å€. ç°åœ¨è¯¥åœ°å€æ˜¯å¯¹è±¡å¼•ç”¨; å€¼ç±»å‹æˆäº†å¼•ç”¨ç±»å‹</li></ol><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">object</span> obj = <span class="number">10</span>;</span><br></pre></td></tr></table></figure><p><strong>æ‹†ç®±è¿‡ç¨‹å‘ç”Ÿäº†ä»€ä¹ˆ</strong><br>è¯·åå¤é˜…è¯»å¹¶ç†è§£è¿™å¥è¯: <strong>æ‹†ç®±ä¸æ˜¯ç›´æ¥å°†è£…ç®±è¿‡ç¨‹å€’è¿‡æ¥, æ‹†ç®±è¿‡ç¨‹æœ¬èº«ä¸ä¼šå¤åˆ¶ä»»ä½•ç±»å‹, ä½†æ˜¯æ‹†ç®±è¿‡åå¾€å¾€è·Ÿéšç€ä¸€æ¬¡å­—æ®µçš„å¤åˆ¶.</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">object obj = 10; //è£…ç®±</span><br><span class="line"></span><br><span class="line">int a = (int)b // æ‹†ç®± + å­—æ®µçš„å¤åˆ¶</span><br></pre></td></tr></table></figure><p><code>(int)b</code>éƒ¨åˆ†å®Œæˆäº†æ‹†ç®±æ“ä½œ, <code>int a =</code>éƒ¨åˆ†å®Œæˆäº†å­—æ®µå¤åˆ¶æ“ä½œ, æˆ‘ä»¬åœ¨å†™ä»£ç çš„æ—¶å€™å¾ˆè‡ªç„¶è€Œç„¶åœ°ä¼šè¿™ä¹ˆå†™.</p><p>å¦å¤–ï¼Œå€¼ç±»å‹è£…ç®±åæ˜¯ä¸èƒ½æ”¹å˜å®ƒçš„å€¼çš„ï¼Œè£…ç®±åçš„å€¼å…·æœ‰æ’å®šæ€§ï¼ˆImmutableï¼‰çš„ç‰¹ç‚¹ï¼Œå¦‚æœæƒ³ç»™å¼•ç”¨ç±»å‹çš„å˜é‡èµ‹äºˆæ–°çš„å€¼ï¼Œé‚£å°±éœ€è¦å†å †ä¸Šå¦å¼€è¾Ÿæ–°çš„å†…å­˜ç©ºé—´ï¼Œä¸€æ—¦ä¸€ä¸ªå€¼ç±»å‹è¢«è£…ç®±ï¼Œå®ƒçš„å€¼å°±æ²¡æœ‰åŠæ³•æ”¹å˜äº†. çœ‹ä¸‹é¢çš„ä»£ç :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">struct ValueType</span><br><span class="line">&#123;</span><br><span class="line">    public int Value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void SomeFunc()</span><br><span class="line">&#123;</span><br><span class="line">    var value = new ValueType</span><br><span class="line">    &#123;</span><br><span class="line">        Value = 100</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    object vv = value;</span><br><span class="line">    </span><br><span class="line">    ((ValueType)vv).Value = 200; // è¿™é‡Œä¼šæŠ¥é”™Cannot modify struct member when accessed struct is not classified as a variable</span><br><span class="line"></span><br><span class="line">    var vvv = ((ValueType)vv); // ä¸ä¼šæŠ¥é”™</span><br><span class="line">    vvv.Value = 200;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°, å¦‚æœåªæ˜¯è¿›è¡Œæ‹†ç®±æ“ä½œ, æˆ‘ä»¬æ— æ³•å¯¹æ‹†ç®±åçš„å­—æ®µåšä»»ä½•ä¿®æ”¹, å¹¶æŠ¥é”™æç¤ºæ‹†ç®±åçš„å€¼æˆå‘˜å¹¶æ²¡æœ‰åˆ†ç±»ä¸ºå˜é‡, æˆ‘ä»¬å¿…é¡»å°†æ‹†ç®±åçš„æ•°æ®å¤åˆ¶ç»™ä¸€ä¸ªå€¼ç±»å‹å˜é‡, åœ¨è¿™ä¸ªå˜é‡ä¸Šè¿›è¡Œä¿®æ”¹, ä¸è¿‡è¿™ä¸ªå˜é‡æ˜¯æ‹†ç®±æ•°æ®çš„æ‹·è´, æ‹†ç®±çš„æ•°æ®æ²¡æœ‰ä»»ä½•å…³ç³». æ‰€ä»¥ä¸Šé¢æ‰è¯´<strong>æ‹†ç®±è¿‡åå¾€å¾€è·Ÿéšç€ä¸€æ¬¡å­—æ®µçš„å¤åˆ¶</strong></p><h1>åå¤åœ°æ‹†è£…ç®±</h1><p>åå¤åœ°æ‹†è£…ç®±ä¼šäº§ç”Ÿé¢å¤–çš„ILä»£ç , å¢åŠ ä»£ç ä½“ç§¯. æ›´å¤§çš„é—®é¢˜æ˜¯, é¢å¤–çš„è£…ç®±æ­¥éª¤ä¼šåœ¨æ‰˜ç®¡å †ä¸­åˆ†é…é¢å¤–çš„å¯¹è±¡, å°†æ¥å¿…é¡»å¯¹å…¶è¿›è¡Œåƒåœ¾å›æ”¶. æ‹†è£…ç®±çš„æ»¥ç”¨ä¼šä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½å’Œå†…å­˜æ¶ˆè€—.<br>å¦‚æœæˆ‘ä»¬æƒ³ä¿®æ”¹è£…ç®±åçš„å€¼ç±»å‹çš„å†…å®¹, è™½ç„¶ç¬”è€…æƒ³ä¸å‡ºå®é™…å¼€å‘ä¸­ä¼šæœ‰è¿™ç§åœºæ™¯, æˆ‘ä»¬å°±å¿…é¡»å…ˆå°†å…¶æ‹†ç®±, æ¥ç€å¤åˆ¶ç»™ä¸€ä¸ªå€¼ç±»å‹å˜é‡, ä¿®æ”¹å€¼ç±»å‹å˜é‡çš„å†…å®¹, å°†å€¼ç±»å‹å˜é‡è£…ç®±, æœ€åæŠŠæŒ‡å‘åŸæ¥è£…ç®±å€¼ç±»å‹åœ¨å †ä¸Šåœ°å€çš„å¼•ç”¨æŒ‡å‘çš„åœ°å€æ”¹ä¸ºæŒ‡å‘æ–°çš„å€¼ç±»å‹å˜é‡è£…ç®±åæ‰€åœ¨å †ä¸Šçš„åœ°å€. é‚£ä¹ˆåŸæ¥é‚£ä¸€ä¸ªè¢«è£…ç®±çš„å€¼ç±»å‹åœ¨å †ä¸Šå æ®çš„å†…å®¹ç©ºé—´å°±åºŸå¼ƒäº†, åœ¨æœªæ¥éœ€è¦è¿›è¡Œåƒåœ¾å›æ”¶. è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè£…ç®±æ‹†ç®±ä¼šå¼•èµ·GCã€‚</p><h1>å°èŠ‚</h1><p>åœ¨å®é™…å†™ä»£ç çš„è¿‡ç¨‹ä¸­, æ‹†è£…ç®±é—®é¢˜å¹¶ä¸å¸¸è§, å› ä¸ºå¤§éƒ¨åˆ†å¼€å‘è€…æƒ³éƒ½ä¸æƒ³åªä¼šæŠŠclassä¼ æ¥ä¼ å», è€Œä¸”æˆ‘ä»¬è‚¯å®šä¸ä¼šé—²å¾—å£°æ˜ä¸€ä¸ªobjectç±»å‹çš„å­—æ®µ, å´ç”¨ä¸€ä¸ªå€¼ç±»å‹çš„æ•°æ®ç»™å®ƒèµ‹å€¼. æ‰€ä»¥ç±»å‹è½¬æ¢ä¸­ä¸»è¦çš„æ€§èƒ½å¼€é”€<strong>åœ¨äºCLRä¼šç”Ÿæˆé¢å¤–ILä»£ç æ‰§è¡Œç±»å‹è½¬æ¢æ˜¯å¦åˆæ³•çš„åˆ¤æ–­é€»è¾‘</strong>(ç¨‹åºå‘˜ä¸€èˆ¬æƒ…å†µä¸‹è¿˜æ˜¯å¯ä»¥ä¿è¯ç±»å‹è½¬æ¢æ˜¯åˆæ³•çš„).</p><h1>å…¶ä»–è¦æ³¨æ„çš„ç‚¹</h1><p><strong>ç±»å‹æ£€æŸ¥ä¸­è¦æ³¨æ„çš„ç‚¹</strong><br>ä½¿ç”¨<code>is</code>æ“ä½œç¬¦å’Œ<code>.GetType()</code>æ¥å£éƒ½å¯ä»¥åšç±»å‹æ£€æŸ¥, ä½†æ˜¯ä¸¤è€…çš„å¼€é”€æ˜¯ä¸åŒçš„, æŒ‰ç…§GPTçš„è¯´æ³•, <code>is</code>æ“ä½œç¬¦çš„æ€§èƒ½å¼€é”€è¦å°äº<code>.GetType()</code>çš„å¼€é”€:</p><ul><li>ä½¿ç”¨<code>is</code>æ“ä½œç¬¦, C#ç¼–è¯‘å™¨ç”Ÿæˆç›´æ¥çš„ç±»å‹æ£€æŸ¥æŒ‡ä»¤(isinst ILæŒ‡ä»¤), æ— éœ€è§¦å‘å®Œæ•´çš„ç±»å‹å…ƒæ•°æ®åŠ è½½. <code>is</code>æ“ä½œç¬¦ä¼šåˆ©ç”¨ç±»å‹ç»§æ‰¿å…³ç³»è¿›è¡Œå¿«é€Ÿåˆ¤æ–­, æ— éœ€è·å–å®Œæ•´çš„Typeå¯¹è±¡, å€¼ç±»å‹ä¼˜åŒ–: å¦‚æœè½¬æ¢åçš„ç±»å‹æ˜¯å€¼ç±»å‹, isä¼šé¿å…è£…ç®±, å‰ææ˜¯objæ˜¯å€¼ç±»å‹ä¸”ç±»å‹å…¼å®¹</li><li>ä½¿ç”¨<code>.GetType()</code>æ—¶, ä¼šè§¦å‘å®Œæ•´ç±»å‹å…ƒæ•°æ®åŠ è½½, éœ€è¦è®¿é—®å¯¹è±¡çš„Typeå¯¹è±¡, æ¶‰åŠå…ƒæ•°æ®æŸ¥è¯¢<br>ç²¾ç¡®ç±»å‹æ¯”è¾ƒ: GetTypE()è¿”å›çš„æ˜¯å¯¹è±¡çš„å®é™…è¿è¡Œæ—¶ç±»å‹, ä¸typeof(MyType)æ¯”è¾ƒæ—¶,åªæœ‰å½“objçš„è¿è¡Œæ—¶ç±»å‹å®Œå…¨ç­‰äºMyTypeæ—¶æ‰è¿”å›true, <code>.GetType()</code>æ˜¯è™šæ–¹æ³•è°ƒç”¨, éœ€ç»è¿‡è™šæ–¹æ³•è¡¨æŸ¥æ‰¾.</li></ul><p>å½“ç„¶, <code>.GetType</code>ä¹Ÿæœ‰å…¶ç”¨æ­¦ä¹‹å¤„, å› ä¸ºåœ¨æœ‰äº›åœºæ™¯ä¸‹ç¡®å®æ˜¯éœ€è¦ç²¾ç¡®æŸ¥æ‰¾çš„, ç»§æ‰¿å…³ç³»A-&gt;B-&gt;C, Aæ˜¯åŸºç±», å¦‚æœä¼ å…¥çš„å®ä¾‹æ˜¯C, ä½¿ç”¨<code>is B</code>è¿”å›çš„ç»“æœæ˜¯true, è€Œä½¿ç”¨<code>.GetType() == typeof(B)</code> è¿”å›çš„æ˜¯false. å®é™…å¼€å‘ä¸­å¤§éƒ¨åˆ†åœºæ™¯ä¸‹<code>is</code>æ“ä½œç¬¦å°±è¶³å¤Ÿå®Œæˆéœ€æ±‚äº†.</p><p><strong>typeofã€GetType()ã€is å’Œ as è¿™å››ç§ç±»å‹åˆ¤æ–­æ“ä½œçš„å¼€é”€å¯¹æ¯”</strong></p><table><thead><tr><th>æ“ä½œ</th><th>å¼€é”€æ¥æº</th><th>é€‚ç”¨åœºæ™¯</th><th>ç¤ºä¾‹ä»£ç </th></tr></thead><tbody><tr><td>typeof(T)</td><td>âš¡ï¸ ç¼–è¯‘æ—¶é™æ€è§£æï¼ˆé›¶è¿è¡Œæ—¶å¼€é”€ï¼‰</td><td>ç¼–è¯‘æ—¶å·²çŸ¥ç±»å‹</td><td>if (type == typeof(MyClass))</td></tr><tr><td>is</td><td>âš¡ï¸ å•æ¬¡ç±»å‹æ£€æŸ¥ï¼ˆæ— è½¬æ¢ï¼‰</td><td>å®‰å…¨ç±»å‹æ£€æŸ¥</td><td>if (obj is MyClass)</td></tr><tr><td>as</td><td>âš¡ï¸ å•æ¬¡ç±»å‹æ£€æŸ¥ + è¿”å›è½¬æ¢ç»“æœ</td><td>å®‰å…¨ç±»å‹è½¬æ¢</td><td>var x = obj as MyClass;</td></tr><tr><td>GetType()</td><td>âš ï¸ è®¿é—®å¯¹è±¡ç±»å‹å¥æŸ„ + å…ƒæ•°æ®æŸ¥æ‰¾</td><td>éœ€è·å–å¯¹è±¡å®é™…è¿è¡Œæ—¶ç±»å‹</td><td>if (obj.GetType() == typeof(MyClass))</td></tr></tbody></table><p><strong>å€¼ç±»å‹ã€å¼•ç”¨ç±»å‹ä¸é—­åŒ…</strong></p><p>å› ä¸ºå€¼ç±»å‹çš„ç”Ÿå‘½å‘¨æœŸä¼šéšç€å…¶ä½œç”¨åŸŸçš„ç»“æŸè€Œé‡Šæ”¾æ‰, ä½†æ˜¯å¼•ç”¨ç±»å‹ä¸ä¼š, å¼•ç”¨ç±»å‹é‡Šæ”¾æ‰çš„åªæ˜¯æŒ‡å‘å †ä¸Šå†…å­˜ä½ç½®çš„æŒ‡é’ˆè€Œå·². æœ¬æ¥ç¬”è€…è®¡åˆ’ä½¿ç”¨é—­åŒ…çš„æ–¹å¼æŠŠä¸¤ç§ç±»å‹å¸¦å‡ºå…¶å„è‡ªçš„ä½œç”¨åŸŸ, ä¸è¿‡å®æ“ä¸‹æ¥, ä¸¤ç§ç±»å‹é‡Œé¢çš„æ•°æ®éƒ½æ˜¯æ­£å¸¸è¯»å–çš„. æ®GPTè¯´å€¼ç±»å‹çš„é—­åŒ…æ˜¯å°†æ•°æ®å¤åˆ¶äº†ä¸€ä»½ä¼ å…¥åˆ°äº†é—­åŒ…ä¸­, å› æ­¤åœ¨åŸå€¼ç±»å‹æ•°æ®ç”Ÿå‘½å‘¨æœŸå¤–æ•°æ®èƒ½æ­£ç¡®è¯»å–, è€Œå¼•ç”¨ç±»å‹åˆ™æ˜¯åœ¨å…¶ç”Ÿå‘½å‘¨æœŸç»“æŸä¹‹å, çœŸæ­£çš„æ•°æ®è¿˜éƒ½å­˜æ”¾åœ¨å †ä¸Šå‘¢æ ¹æœ¬å°±æ²¡é‡Šæ”¾æ‰å‘¢, å› æ­¤å¯ä»¥æ­£ç¡®è¯»å–, ä¸è¿‡ç¬”è€…ä¸ªäººçŒœæµ‹, å¼•ç”¨ç±»å‹æœ¬èº«(æˆ–è€…å«åˆ›å»ºåœ¨çº¿ç¨‹æ ˆä¸ŠæŒ‡å‘å †ä¸­æ•°æ®çš„æŒ‡é’ˆ)åœ¨ç”Ÿå‘½å‘¨æœŸç»“æŸåå…¶å®ä¹Ÿè¢«é‡Šæ”¾æ‰äº†, åœ¨é—­åŒ…ä¸­ä¹Ÿæ˜¯ä¼ å…¥äº†è¿™ä¸ªå¼•ç”¨ç±»å‹æœ¬èº«çš„ä¸€ä»½æ‹·è´è€Œå·². ä½†æ˜¯ç¬”è€…åœ¨è¿™é‡Œå°±ä¸æ·±ç©¶äº†.</p><h1>æ›´ä¼˜é›…çš„ç±»å‹è½¬æ¢</h1><p>æŒ‰ç…§GPTçš„è¯´æ³•, æ³›å‹æ˜¯ä¸€ç§èƒ½å¤Ÿè§„é¿ç±»å‹è½¬æ¢ã€ä¸”ä¿è¯ç±»å‹å®‰å…¨çš„åŒèµ¢æ–¹æ³•, æ³›å‹çš„ç±»å‹è½¬æ¢å¹¶ä¸æ˜¯åœ¨è¿è¡Œæ—¶åšçš„, è€Œæ˜¯åœ¨ç¼–è¯‘æ—¶ç¼–è¯‘å™¨é™é»˜åœ°è¿›è¡Œäº†ç±»å‹è½¬æ¢, å› æ­¤æ³›å‹åœ¨è¿è¡Œæ—¶æ˜¯æ²¡æœ‰é¢å¤–å¼€é”€çš„.</p><p>ä¸‹é¢çœ‹ä¸¤ç»„ä»£ç çš„å¯¹æ¯”:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">// éæ³›å‹æ¥å£</span><br><span class="line">public interface IUILogic</span><br><span class="line">&#123;</span><br><span class="line">    void OnShow(object data); // æ•°æ®ç”¨ object ä¼ é€’</span><br><span class="line">    void OnClose();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// éæ³›å‹åŸºç±»</span><br><span class="line">public abstract class BaseEUI : MonoBehaviour, IUILogic</span><br><span class="line">&#123;</span><br><span class="line">    public abstract void OnShow(object data);</span><br><span class="line">    public abstract void OnClose();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å…·ä½“ UI ç±»ï¼ˆéœ€æ‰‹åŠ¨è½¬æ¢æ•°æ®ï¼‰</span><br><span class="line">public class PlayPage : BaseEUI</span><br><span class="line">&#123;</span><br><span class="line">    public override void OnShow(object data)</span><br><span class="line">    &#123;</span><br><span class="line">        var showData = (PlayPageShowData)data; // è¿è¡Œæ—¶è½¬æ¢</span><br><span class="line">        // å®é™…é€»è¾‘...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public override void OnClose() &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// UI ç®¡ç†å™¨</span><br><span class="line">public class UIMgr</span><br><span class="line">&#123;</span><br><span class="line">    public static UIMgr Instance &#123; get; &#125; = new UIMgr();</span><br><span class="line">    private Dictionary&lt;Type, BaseEUI&gt; _uiInstances = new Dictionary&lt;Type, BaseEUI&gt;();</span><br><span class="line"></span><br><span class="line">    public void ShowUI(Type uiType, object data)</span><br><span class="line">    &#123;</span><br><span class="line">        if (_uiInstances.TryGetValue(uiType, out var ui))</span><br><span class="line">        &#123;</span><br><span class="line">            ui.OnShow(data); // éæ³›å‹è°ƒç”¨</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            var obj = Resources.Load(&quot;&quot;);</span><br><span class="line">            var go = Object.Instantiate(obj) as GameObject;</span><br><span class="line">            ui = go.AddComponent(uiType) as BaseEUI;</span><br><span class="line">            ui.OnShow(data);</span><br><span class="line">            _uiInstances.Add(uiType, ui);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è°ƒç”¨ç¤ºä¾‹</span><br><span class="line">var param = new PlayPageShowData();</span><br><span class="line">UIMgr.Instance.ShowUI(typeof(PlayPage), param); // éœ€æ˜¾å¼ä¼ é€’ Type</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">// æ³›å‹æ¥å£ï¼ˆç±»å‹å®‰å…¨ï¼‰</span><br><span class="line">public interface IUILogic&lt;TUIShowData&gt; where TUIShowData : struct</span><br><span class="line">&#123;</span><br><span class="line">    void OnShow(TUIShowData data); // æ˜ç¡®æ•°æ®ç±»å‹</span><br><span class="line">    void OnClose();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ³›å‹åŸºç±»</span><br><span class="line">public abstract class BaseEUI&lt;TUIShowData&gt; : MonoBehaviour, IUILogic&lt;TUIShowData&gt; </span><br><span class="line">    where TUIShowData : struct</span><br><span class="line">&#123;</span><br><span class="line">    public abstract void OnShow(TUIShowData data);</span><br><span class="line">    public abstract void OnClose();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å…·ä½“ UI ç±»ï¼ˆæ— éœ€æ‰‹åŠ¨è½¬æ¢æ•°æ®ï¼‰</span><br><span class="line">public class PlayPage : BaseEUI&lt;PlayPageShowData&gt;</span><br><span class="line">&#123;</span><br><span class="line">    public override void OnShow(PlayPageShowData data) // ç›´æ¥ä½¿ç”¨å…·ä½“ç±»å‹</span><br><span class="line">    &#123;</span><br><span class="line">        // ç›´æ¥è®¿é—® data çš„å­—æ®µï¼Œæ— éœ€ç±»å‹è½¬æ¢</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public override void OnClose() &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// UI ç®¡ç†å™¨ï¼ˆæ³›å‹ç‰ˆï¼‰</span><br><span class="line">public class UIMgr</span><br><span class="line">&#123;</span><br><span class="line">    public static UIMgr Instance &#123; get; &#125; = new UIMgr();</span><br><span class="line">    private Dictionary&lt;Type, object&gt; _uiInstances = new Dictionary&lt;Type, object&gt;();</span><br><span class="line"></span><br><span class="line">    // æ³›å‹æ–¹æ³•ï¼šç±»å‹å®‰å…¨ä¸”æ— è£…ç®±</span><br><span class="line">    public void ShowUI&lt;TUI, TUIShowData&gt;(TUIShowData data)</span><br><span class="line">        where TUI : BaseEUI&lt;TUIShowData&gt;, new()</span><br><span class="line">        where TUIShowData : struct</span><br><span class="line">    &#123;</span><br><span class="line">        if (_uiInstances.TryGetValue(typeof(TUI), out var ui))</span><br><span class="line">        &#123;</span><br><span class="line">            ((IUILogic&lt;TUIShowData&gt;)ui).OnShow(data); // éœ€ä¸€æ¬¡æ¥å£è½¬æ¢</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            var obj = Resources.Load(&quot;&quot;);</span><br><span class="line">            var go = Object.Instantiate(obj) as GameObject;</span><br><span class="line">            var uiLogic = go.AddComponent&lt;TUI&gt;();</span><br><span class="line">            uiLogic.OnShow(data);</span><br><span class="line">            _uiInstances.Add(typeof(TUI), uiLogic);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è°ƒç”¨ç¤ºä¾‹</span><br><span class="line">var param = new PlayPageShowData();</span><br><span class="line">UIMgr.Instance.ShowUI&lt;PlayPage, PlayPageShowData&gt;(param); // ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥</span><br></pre></td></tr></table></figure><p>å¯¹æ¯”ä¸Šé¢ä¸¤ç»„ä»£ç , éæ³›å‹æ–¹å¼æ‰“å¼€ä¸€ä¸ªUIè¦ç»è¿‡4æ¬¡ç±»å‹è½¬æ¢, è€Œä¸”è¿˜æœ‰è£…ç®±å’Œæ‹†ç®±çš„é£é™©; è€Œæ³›å‹ç‰ˆæœ¬æ‰“å¼€ä¸€ä¸ªUIåªéœ€è¦è¿›è¡Œ2æ¬¡ç±»å‹è½¬æ¢</p><p><strong>éæ³›å‹å’Œæ³›å‹æ–¹æ¡ˆå¯¹æ¯”</strong></p><table><thead><tr><th>ç‰¹æ€§</th><th>éæ³›å‹æ–¹æ¡ˆ</th><th>æ³›å‹æ–¹æ¡ˆ (IUILogic<T>)</th></tr></thead><tbody><tr><td>ç±»å‹å®‰å…¨</td><td>âŒ è¿è¡Œæ—¶å¯èƒ½ InvalidCastException</td><td>âœ”ï¸ ç¼–è¯‘æ—¶æ£€æŸ¥</td></tr><tr><td>æ•°æ®ä¼ é€’æ•ˆç‡</td><td>âš ï¸ å€¼ç±»å‹ä¼šè£…ç®±ï¼ˆstruct â†’ objectï¼‰</td><td>âœ”ï¸ æ— è£…ç®±ï¼ˆç›´æ¥ä¼ é€’ structï¼‰</td></tr><tr><td>ä»£ç å¤æ‚åº¦</td><td>âœ”ï¸ æ›´ç®€å•</td><td>âŒ éœ€è¦æ³›å‹çº¦æŸå’Œç±»å‹å‚æ•°</td></tr><tr><td>æ€§èƒ½å¼€é”€</td><td>âš ï¸ è£…ç®±/æ‹†ç®± + ç±»å‹è½¬æ¢</td><td>âš¡ï¸ æ— é¢å¤–å¼€é”€ï¼ˆé™¤å¯èƒ½çš„ as è½¬æ¢ï¼‰</td></tr><tr><td>æ‰©å±•æ€§</td><td>âŒ æ–°å¢ UI éœ€æ‰‹åŠ¨ç»´æŠ¤æ•°æ®ç±»å‹</td><td>âœ”ï¸ è‡ªåŠ¨é€‚é…ä¸åŒ TUIShowData</td></tr></tbody></table><p><strong>æ³¨æ„</strong> æ³›å‹ç¡®å®æ˜¯ä¸€ç§ååˆ†ä¼˜é›…çš„ç±»å‹è½¬æ¢æ–¹å¼, ä½†æ˜¯å¦„å›¾ä½¿ç”¨æ³›å‹æ›¿ä»£æ‰€æœ‰çš„ç±»å‹è½¬æ¢æ˜¯ä¸å¯èƒ½çš„. æ³›å‹åœ¨ä¸€å®šç¨‹åº¦ä¸Šç ´åäº†çªç ´äº†é¢å‘å¯¹è±¡çš„ç»§æ‰¿ç»“æ„çš„é™åˆ¶, ä½†æ˜¯ä½ æƒ³è¦åœ¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ä¸­ç¼–å†™éé¢å‘å¯¹è±¡çš„ä»£ç æ˜¯ååˆ†å›°éš¾çš„, çœ‹ä¸Šé¢UIMgrä»£ç çš„ä¾‹å­ä½ å°±çŸ¥é“äº†, UIMgrä½œä¸ºæ‰€æœ‰UIçš„ç®¡ç†è€…, å®ƒç®¡ç†è€…ä¸€ç±»UI, ä¸ºäº†å®ç°ç®¡ç†ä¸€ç»„å¯¹è±¡çš„æ•ˆæœ, è¿™ä¸€ç»„å¯¹è±¡åœ¨UIMgrçš„è§†è§’ä¸‹å¿…é¡»æ˜¯åŒä¸€ç§ç±»çš„, ä¹Ÿå°±æ˜¯å®ƒä»¬è¦å…·æœ‰åŒä¸€çˆ¶ç±», å› æ­¤å³ä¾¿æ³›å‹æ‰“ç ´äº†ç»§æ‰¿å…³ç³», ä½†æ˜¯åœ¨ç®¡ç†ä¸€ç»„å¯¹è±¡è¿™ç§é¢†åŸŸè¿˜æ˜¯æ— æ³•æ›¿ä»£æ™®é€šç±»å‹è½¬æ¢, æ‰€ä»¥åœ¨ç”±ä¸Šå±‚ç®¡ç†åˆ°åº•å±‚æ‰§è¡Œä¹‹é—´æœ‰ä¸€ä¸ªä¸å¯é¿å…çš„ç±»å‹è½¬æ¢, ä¸è¿‡è¿™ä¸€æ¬¡ç±»å‹è½¬æ¢æ˜¯å¿…å®šæˆåŠŸçš„, è¿™æ˜¯ç”±ä¸Šå±‚ç®¡ç†å’Œåº•å±‚å…·ä½“æ‰§è¡Œè§†è§’ä¸åŒå¯¼è‡´çš„.</p><h1>æ€»ç»“</h1><p>å› æ­¤, æ»¥ç”¨objectä½œä¸ºæ¥å£çš„å‚æ•°å¹¶ä¸æ˜¯ä¸€ç§ä¼˜é›…çš„æ–¹å¼, ç±»å‹è½¬æ¢åœ¨å®é™…å¼€å‘ä¸­ä¸å¯é¿å…, ä½†æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥é€šè¿‡æ³›å‹ç­‰æ–¹å¼å°½å¯èƒ½åœ°å‡å°‘ç±»å‹è½¬æ¢çš„å¼€é”€.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;ç±»å‹è½¬æ¢çš„å¼€é”€æ¥è‡ªå“ªé‡Œ?&lt;/h1&gt;
&lt;p&gt;ç±»å‹è½¬æ¢åœ¨æ—¶é—´å’Œç©ºé—´ä¸Šéƒ½ä¼šé€ æˆå¼€é”€, å› ä¸ºç±»å‹è½¬æ¢C#ç¼–è¯‘å™¨ä¼šç”Ÿæˆé¢å¤–çš„ç±»å‹è½¬æ¢å¤„ç†ä»£ç , å¯¼è‡´ä»£ç æ–‡ä»¶çš„ä½“ç§¯å˜å¤§. æ—¢ç„¶æœ‰é¢å¤–çš„ILä»£ç ç”Ÿæˆåˆ™å°±éœ€è¦æœ‰é¢å¤–çš„æ—¶é—´å»æ‰§è¡Œ. å¦‚æœç±»å‹è½¬æ¢ä¸­æ¶‰åŠåˆ°è£…æ‹†ç®±æ“ä½œ, åˆ™è¿˜ä¼šå¯¹è¿è¡Œæ—¶å†…å­˜äº§ç”Ÿå½±</summary>
      
    
    
    
    
    <category term="C#" scheme="https://soincredible.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>UnityUGUIæºç </title>
    <link href="https://soincredible.github.io/posts/906aab82/"/>
    <id>https://soincredible.github.io/posts/906aab82/</id>
    <published>2025-04-19T08:46:20.000Z</published>
    <updated>2025-04-27T01:30:44.577Z</updated>
    
    <content type="html"><![CDATA[<h1>UGUIçš„æ¸²æŸ“å’Œ3Dç‰©ä½“æ¸²æŸ“çš„åŒºåˆ«?</h1><p>ç¬”è€…å¸Œæœ›å„ä½è¯»è€…åŒºåˆ†ä¸¤ä¸ªæ¦‚å¿µ: æ¸²æŸ“å’Œæ¸²æŸ“æ‰€éœ€çš„æ•°æ®æ›´æ–°. Unityé¦–å…ˆæ›´æ–°å…¶è¦æ¸²æŸ“ç‰©ä½“çš„æ¸²æŸ“æ•°æ®, ç„¶åæ ¹æ®æ¸²æŸ“æ•°æ®å°†ç”»é¢æ¸²æŸ“åˆ°å±å¹•ä¸Š, ç¬”è€…åœ¨æœ€åˆæ¥è§¦è¿™éƒ¨åˆ†å†…å®¹æ—¶, æŠŠä¸¤è€…æ··ä¸ºä¸€è°ˆ, ç»™è‡ªå·±é€ æˆäº†ç†è§£ä¸Šçš„å›°éš¾, å› æ­¤åœ¨æ­¤è¯´æ˜.</p><p>UGUIçš„æ¸²æŸ“å‘ç”Ÿåœ¨æ¯ä¸€å¸§<code>CanvasUpdateRegistry</code>çš„<code>SendWillRenderCanvases()</code>æ¥å£è¢«è°ƒç”¨ä¹‹å,ä¸è¿‡æˆ‘ä»¬çœ‹ä¸åˆ°è°ƒç”¨è¯¥æ¥å£çš„ä»£ç ,çŒœæµ‹è°ƒç”¨å¤„é€šè¿‡<code>[RequireByNativeCode]</code>ç‰¹æ€§éšè—åœ¨äº†Unityæ›´åº•å±‚çš„å¼•æ“ä»£ç ä¸­. ä½†è¿™ä¸å½±å“æˆ‘ä»¬çŸ¥é“UGUIçš„æ¸²æŸ“ä½äºäº‹ä»¶æ‰§è¡Œçš„ä»€ä¹ˆä½ç½®. ä¸ºäº†çŸ¥é“è¿™å‡ ä¸ªäº‹ä»¶çš„æ‰§è¡Œé¡ºåº,å› ä¸ºè¿™äº›äº‹ä»¶æ˜¯åœ¨æ¯ä¸€å¸§éƒ½æ‰§è¡Œçš„, æ‰€ä»¥ä½¿ç”¨æ–­ç‚¹è°ƒè¯•çš„æ–¹å¼ä¸å¤ªæ–¹ä¾¿, äºæ˜¯ç¬”è€…å°è¯•ä½¿ç”¨Logæ–¹å¼è§‚å¯Ÿå‡ ä¸ªäº‹ä»¶çš„æ‰§è¡Œé¡ºåº,</p><h1>CanvasScaler</h1><p>æŒ‰ç…§æ ‡å‡†åˆ†è¾¨ç‡æ¥è®¾è®¡çš„</p><p>Unityç²’å­çš„Renderå’ŒCanvasçš„OrderInLayeræ˜¯ä¸€æ ·çš„ ç”¨æ¥å¤„ç†æ¸²æŸ“å±‚çº§çš„é—®é¢˜</p><p>å¸¸è§„æ¨¡å‹å’Œç²’å­æ»¡è¶³è°è·ç¦»æ‘„åƒæœºè¿‘è°åæ¸²æŸ“<br>åœ¨Unityä¸­åˆ›å»ºä¸€ä¸ªåœºæ™¯ï¼Œåˆ›å»ºä¸¤ä¸ªImageï¼Œç„¶ååˆ›å»ºä¸€ä¸ªSphereï¼Œå°†Sphereæ”¾ç½®åœ¨ä¸¤ä¸ªImageä¸­é—´ï¼Œä¼šå‘ç”Ÿå¥‡æ€ªçš„äº‹æƒ…<br>UIå’Œå¸¸è§„æ¨¡å‹æ»¡è¶³è°è·ç¦»æ‘„åƒæœºè¿‘è°åæ¸²æŸ“<br>UIå’Œç²’å­å°±ä¸æ»¡è¶³è°è·ç¦»æ‘„åƒæœºè¿‘è°åæ¸²æŸ“ ä¸ºä»€ä¹ˆï¼Ÿ ç»™ç²’å­ç³»ç»ŸæŒ‚è½½RectTransformå°±ä¼šè¿™æ ·<br>ç§»é™¤RectTransformåå°±æ²¡æœ‰é—®é¢˜äº† RectTransformæ”¹å˜äº†ä»€ä¹ˆï¼Ÿ<br>RectTransformç»„ä»¶ä¸Šçš„Pos Zå­—æ®µå¯ä»¥è®¾ç½®æ¸¸æˆå¯¹è±¡çš„Zè½´ä½ç½®ï¼Œä½†æ˜¯ä¸å½±å“æ˜¾ç¤ºé¡ºåºï¼Œåœ¨åŒä¸€ä¸ªCanvasç”»å¸ƒä¸­ï¼Œæ¸¸æˆå¯¹è±¡çš„æ˜¾ç¤ºé¡ºåºç”±Hierarchyè§†å›¾ä¸­çš„é¡ºåºå†³å®š<br>å³ä¾¿æ˜¯åœ¨ä¸åŒçš„Canvasä¸­æƒ³é€šè¿‡è°ƒæ•´PosZå­—æ®µä¹Ÿä¸èƒ½å½±å“æ˜¾ç¤ºé¡ºåº å¤„ç†ä¸åŒCanvasçš„æ˜¾ç¤ºé¡ºåºæ˜¯é€šè¿‡ä¿®æ”¹Canvasçš„ OrderInLayerå€¼æ¥å®ç°çš„</p><p>ç–‘æƒ‘åœºæ™¯<br>ä¸¤ä¸ªCanvasï¼Œæ¯ä¸ªCanvasä¸‹é¢éƒ½æœ‰ä¸€ä¸ªImageç»„ä»¶ï¼ŒHierarchyçª—å£ä¸­Canvas1åœ¨Canvas2ä¸Šé¢ï¼Œæ— è®ºå¦‚ä½•è°ƒæ•´Canvas1å’ŒCanvas2çš„PosZå±æ€§ï¼Œåªè¦ä¸åŠ¨Canvasçš„OrderInLayerå±æ€§ï¼ŒCanvas2å°±ä¸€ç›´ä¼šæ˜¾ç¤ºåœ¨Canvas1ä¸Šé¢<br>Canvas1<br>Canvas2</p><p>å¦‚æœåœ¨åœºæ™¯ä¸­åˆ›å»ºä¸€ä¸ªSphere 3Dç‰©ä½“ï¼Œç‰©ä½“ä¸ŠæŒ‚è½½çš„æ˜¯Transformä¸æ˜¯RectTransformï¼Œè°ƒæ•´Sphereã€Canvas1ã€Canvas2çš„PosZå±æ€§ä½¿å¾—è·ç¦»æ‘„åƒæœºæœ‰è¿œåˆ°è¿‘çš„å…³ç³»ä¸ºï¼šCanvas2ã€Sphereã€Canvas1ï¼Œä¼šå‘ç°Sphereä¼šæ½œå…¥Canvas2ä¸­ï¼Œè€ŒCanvas1æœ¬åº”è¯¥è¢«Canvas2ç›–ä½ï¼Œä½†æ˜¯ç°åœ¨ä¹Ÿä¼šåœ¨Sphereé®æŒ¡Canvas2çš„åŒºåŸŸä¸­æ˜¾ç¤ºå‡ºæ¥ï¼ŒåŸå› æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>å°±ç®—åªæœ‰ä¸€ä¸ªCanvas ä¸‹æ·»åŠ ä¸¤ä¸ªImageç»„ä»¶ï¼ŒHierarchyä¸­Image1åœ¨Image2çš„ä¸Šé¢ å°±ç®—Image1çš„PosZæ¯”Image2çš„PosZè¦å° Image1è¿˜æ˜¯åº”è¯¥è¢«Image2æŒ¡ä½ï¼Œä½†æ˜¯å°†Sphereæ”¾åœ¨ä¸¤ä¸ªImageä¸­é—´çš„æ—¶å€™ä¹Ÿä¼šå‡ºç°ä¸Šè¿°æƒ…å†µï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p><p>RectTransformçš„PosZä¸èƒ½ç”¨æ¥å¤„ç†UIå…ƒç´ ä¹‹é—´çš„å±‚çº§å…³ç³» ä½†æ˜¯å¯ä»¥ç”¨æ¥å¤„ç†UIå’Œ3Dç‰©ä½“ä¹‹é—´çš„å±‚çº§å…³ç³»</p><p>Unityæ˜¯å¦‚ä½•æ¸²æŸ“UIçš„ï¼Ÿ</p><h1>Unityçš„æ¸²æŸ“é¡ºåº</h1><p>å¦‚æœå¼€å¯äº†æ·±åº¦æµ‹è¯•æ°¸è¿œéƒ½æ˜¯ç¦»æ‘„åƒæœºè¿‘çš„ç‰©ä½“è¯¥åœ¨ç¦»æ‘„åƒæœºè¿œçš„ç‰©ä½“ä¹‹å‰</p><h1>Canvas</h1><p>Canvasç»„ä»¶æä¾›äº†ä¸€ä¸ªä¾›UIå¸ƒå±€å’Œæ¸²æŸ“çš„æŠ½è±¡ç©ºé—´ã€‚æ‰€æœ‰çš„UIå…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæŒ‚è½½æœ‰Canvasç»„ä»¶çš„GameObjectçš„å­ã€‚å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªUIå…ƒç´ çš„æ—¶å€™ï¼Œå¦‚æœåœºæ™¯ä¸­è¿˜æ²¡æœ‰ä¸€ä¸ªå¸¦æœ‰Canvasçš„ç‰©ä½“ï¼Œé‚£ä¹ˆä¸€ä¸ªCanvasçš„Objectå°†ä¼šè‡ªåŠ¨è¢«åˆ›å»ºå‡ºæ¥ã€‚</p><h2 id="å±æ€§">å±æ€§</h2><ul><li>Render Mode: UIæ¸²æŸ“åˆ°å±å¹•ä¸Šæˆ–è€…æ˜¯ä½œä¸ºä¸€ä¸ªObjectè¢«æ¸²æŸ“åˆ°3Dç©ºé—´ä¸­çš„æ–¹å¼ã€‚å…±æœ‰ä¸‰ç§é€‰é¡¹ Screen Space - Overlayï¼Œ Screen Space - Cameraå’ŒWorld Space</li><li>Pixel Pefect(Screen Space modes only): ä¸ºäº†ç²¾åº¦UIæ˜¯å¦åº”è¯¥å…³é—­æŠ—é”¯é½¿å¹¶æ¸²æŸ“</li><li>Render Camera(Screen Space - Camera mode onle): UIè¦è¢«æ¸²æŸ“åˆ°å“ªä¸ªCameraä¸Š</li><li>Sort Order: ç”¨äºæ§åˆ¶ä¸é€šè¿‡Canvasä¹‹é—´çš„ç»˜åˆ¶é¡ºåºï¼Œæ•°å€¼è¶Šå¤§ï¼Œè¯¥canvasçš„ç»˜åˆ¶ä¼˜å…ˆçº§è¶Šé«˜ï¼Œä¼šç»˜åˆ¶åœ¨å…¶ä»–Canvasçš„ä¸Šæ–¹</li><li>Plane Distance(Screen Space - Camera mode only): è¢«æ¸²æŸ“çš„UIæ”¾ç½®åœ¨æ¸²æŸ“æ‘„åƒæœºå‰çš„è·ç¦»</li><li>Event Camera(World Space mode only): ç”¨æ¥è¿è¡ŒUI Eventçš„Camera</li><li>Receives Events: UIEventæ˜¯å¦ä¼šè¢«è¯¥Canvasé©±åŠ¨ï¼Ÿ</li></ul><h2 id="ç»†èŠ‚">ç»†èŠ‚</h2><p>å¯¹äºæ‰€æœ‰çš„UIå…ƒç´ å•ä¸ªCanvaså·²ç»æ˜¯è¶³å¤Ÿçš„äº†ï¼Œä½†æ˜¯åœ¨åœºæ™¯ä¸­æ”¾ç½®å¤šä¸ªCanvasä¹Ÿæ˜¯å¯ä»¥çš„ã€‚åŒæ ·åœ°ï¼Œä½¿ç”¨åµŒå¥—Canvasä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¸€èˆ¬æˆ‘ä»¬å‡ºäºä¼˜åŒ–çš„ç›®çš„ä¼šå°†ä¸€ä¸ªCanvasè®¾ç½®ä¸ºå¦ä¸€ä¸ªCanvasçš„å­èŠ‚ç‚¹ã€‚åµŒå¥—Canvasçš„Canvasé‡‡ç”¨å’Œçˆ¶Canvasç›¸åŒçš„æ¸²æŸ“æ¨¡å¼ã€‚</p><p>ä¼ ç»Ÿæ–¹å¼ä¸­ï¼Œæ‰€æœ‰çš„UIå°±åƒå®ƒä»¬æ˜¯ç®€å•çš„å›¾å½¢è®¾è®¡ä¸€æ ·è¢«ç›´æ¥åœ°æ¸²æŸ“åˆ°äº†å±å¹•ä¸Šã€‚è¿™å°±æ˜¯è¯´ï¼Œåœ¨Cameraçš„è§†è§’ä¸‹ï¼Œå®ƒä»¬æ˜¯æ²¡æœ‰3Dç©ºé—´çš„æ¦‚å¿µçš„ã€‚Unityæ”¯æŒè¿™ç§å±å¹•ç©ºé—´çš„æ¸²æŸ“å¹¶ä¸”åŒæ—¶æ”¯æŒUIä½œä¸ºObjectè¢«æ¸²æŸ“åˆ°3Dç©ºé—´ä¸­ï¼Œè¿™å–å†³äºRender Modeçš„å€¼ã€‚</p><h2 id="Screen-Space-Overlay">Screen Space - Overlay</h2><p>è¿™ç§æ¨¡å¼ä¸‹ï¼ŒCanvasä¼šè¢«ç¼©æ”¾ä»¥é€‚åº”å±å¹•ç„¶ååœ¨æ²¡æœ‰åœºæ™¯æˆ–è€…Cameraçš„å‚ç…§ä¸‹ç›´æ¥æ¸²æŸ“å‡ºæ¥ï¼ˆUIä¼šç›´æ¥æ¸²æŸ“å‡ºæ¥ï¼Œå³ä½¿åœºæ™¯ä¸­æ ¹æœ¬å°±æ²¡æœ‰Cameraï¼‰ã€‚å¦‚æœå±å¹•çš„å°ºå¯¸æˆ–è€…åˆ†è¾¨ç‡å‘ç”Ÿäº†æ”¹å˜ï¼Œé‚£ä¹ˆUIä¼šè‡ªåŠ¨åœ°é‡æ–°ç¼©æ”¾æ¥é€‚åº”æ–°çš„å°ºå¯¸ã€‚UIä¼šç»˜åˆ¶åœ¨ä»»ä½•å…¶ä»–å›¾å½¢æ¯”å¦‚æ‘„åƒæœºè§†è§’çš„ä¸Šå±‚</p><p>æ³¨æ„ï¼šScreen Space - Overlayæ¨¡å¼ä¸‹ï¼ŒæŒ‚è½½canvasçš„èŠ‚ç‚¹å¿…é¡»æ˜¯åœ¨hierarchyçª—å£ä¸­çš„æœ€ä¸Šçº§çš„èŠ‚ç‚¹ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·ä½¿ç”¨canvasçš„è¯å¯èƒ½ä¼šå¯¼è‡´UIä»è§†é‡é‡Œæ¶ˆå¤±ã€‚è¿™æ˜¯ä»Unityå¼•æ“è®¾è®¡ä¸Šçš„å±€é™ï¼Œå› æ­¤ä¿æŒScreenSpace - Overlay canvasåœ¨hierarchyçš„æœ€é¡¶å±‚ä»¥ä¿è¯èƒ½å¤Ÿè·å¾—æœŸæœ›çš„æ•ˆæœ</p><h2 id="Screen-Space-Camera">Screen Space - Camera</h2><p>åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒCanvasä¼šè¢«æ¸²æŸ“åœ¨ä¸€ä¸ªå¹³é¢çš„ç‰©ä½“ä¸Šï¼Œè¯¥å¹³é¢è·ç¦»ç»™å®šçš„æ‘„åƒæœºæœ‰ä¸€å®šçš„è·ç¦»ï¼Œè¿™ç§æ¨¡å¼ä¸‹çš„UIæ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„å°ºå¯¸å¹¶ä¸ä¼šéšç€è·ç¦»è€Œå˜åŒ–ï¼Œå› ä¸ºå®ƒæ€»æ˜¯ä¼šé‡æ–°ç¼©æ”¾æ¥é€‚åº”Cameraçš„å¹³æˆªå¤´ä½“ä¸­ï¼Œå¦‚æœå±å¹•çš„å°ºå¯¸æˆ–è€…åˆ†è¾¨ç‡æˆ–è€…Cameraçš„å¹³æˆªå¤´ä½“å‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆè¯¥UIä¼šè‡ªåŠ¨çš„ç¼©æ”¾æ¥é€‚åº”æ”¹å˜è¯ã€‚ä»»ä½•åœ¨åœºæ™¯ä¸­çš„3Dç‰©ä½“å¦‚æœè·ç¦»æ‘„åƒæœºæ¯”è¯¥UIè¿‘çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šè¢«æ¸²æŸ“åœ¨è¯¥UIçš„å‰é¢ï¼Œè€Œåœ¨UIåé¢çš„ç‰©ä½“å°±ä¼šè¢«é®æŒ¡</p><h2 id="World-Space">World Space</h2><p>è¿™ç§æ¨¡å¼ä¸‹çš„UIä¼šæƒ³ä¸€ä¸ªå¹³é¢çš„ç‰©ä½“ä¸€æ ·è¢«æ¸²æŸ“åœ¨åœºæ™¯ä¸­ï¼Œä¸æƒ³Screen Space - Cameraä¸€æ ·ï¼Œè¿™ç§æ¨¡å¼ä¸‹çš„UIä¸éœ€è¦é¢å‘æ‘„åƒæœºå¹¶ä¸”å¯ä»¥æœå‘ä»»ä½•æ–¹å‘ï¼Œè¿™ç§æ¨¡å¼ä¸‹çš„Canvasçš„å°ºå¯¸å¯ä»¥é€šè¿‡è¯¥èŠ‚ç‚¹ä¸Šçš„RectTransformç»„ä»¶è¿›è¡Œè®¾ç½®ã€‚è€Œå®ƒçš„æ˜¾ç¤ºæ•ˆæœå–å†³äºè§‚çœ‹è§’åº¦å’Œè¯¥UIè·ç¦»Cameraçš„è·ç¦»ï¼Œå…¶ä»–åœºæ™¯ä¸­çš„ç‰©ä½“å¯ä»¥ç©¿è¿‡è¯¥UIï¼Œæˆ–è€…åœ¨å®ƒçš„å‰é¢ï¼Œæˆ–è€…åœ¨å®ƒçš„åé¢</p><h1>CanvasScaler</h1><p>Canvas Scalerç»„ä»¶ç”¨æ¥æ§åˆ¶UIå…ƒç´ åœ¨Canvasä¸Šçš„æ•´ä½“ç¼©æ”¾å’Œåƒç´ å¯†åº¦ã€‚è¿™ä¸ªç»„ä»¶ä¼šå½±å“æ‰€æœ‰çš„ä½äºè¯¥Canvasç»„ä»¶ä¸‹çš„UIå…ƒç´ ï¼ŒåŒ…æ‹¬å­—ä½“å¤§å°å’Œå›¾ç‰‡çš„è¾¹ç•Œ</p><h2 id="å±æ€§-2">å±æ€§</h2><ul><li>UIScaleMode:  å†³å®šåœ¨è¯¥Canvasä¸Šçš„UIå…ƒç´ è¯¥å¦‚ä½•è¿›è¡Œç¼©æ”¾<ul><li>ConstantPixelSize: è®©UIå…ƒç´ ä¿æŒç›¸åŒçš„åƒç´ ä¸è®ºå±å¹•çš„å°ºå¯¸<ul><li>Scale Factor: è¯¥Canvasä¸­çš„æ‰€æœ‰UIå…ƒç´ çš„ç¼©æ”¾å—è¯¥factorå½±å“</li><li>ReferencePixelsPerUnit: å¦‚æœä¸€ä¸ªspriteè¿›è¡Œäº†Pixel Per Unityçš„è®¾ç½®ï¼Œé‚£ä¹ˆåœ¨è¯¥spriteä¸­çš„ä¸€ä¸ªåƒç´ å°†ä¼šè¦†ç›–ä¸€ä¸ªå•å…ƒ</li></ul></li><li>ScaleWithScreenSize: å±å¹•çš„å°ºå¯¸è¶Šå¤§ï¼ŒUIå…ƒç´ ä¹Ÿè¶Šå¤§<ul><li>Reference Resolution: UIå¸ƒå±€æ˜¯åŸºäºæ­¤åˆ†è¾¨ç‡è®¾è®¡çš„ï¼Œå¦‚æœå±å¹•åˆ†è¾¨ç‡æ›´å¤§ï¼Œé‚£ä¹ˆUIä¼šè¢«æ”¾å¤§ï¼Œåä¹‹UIä¼šè¢«ç¼©å°</li><li>ScreenMatchMode: ä¸€ç§æ¨¡å¼ç”¨æ¥é€‚åº”ä¸åŒåˆ†è¾¨ç‡UIçš„ç¼©æ”¾æ–¹å¼<ul><li>Match Width or Height: å¦‚æœè®¾å¤‡çš„åˆ†è¾¨ç‡å’Œé»˜è®¤åˆ†è¾¨ç‡ä¸åŒ¹é…çš„è¯ï¼Œé‚£ä¹ˆæ˜¯ä¿è¯å®½å’ŒåŸåˆ†è¾¨ç‡æˆæ¯”ä¾‹è¿˜æ˜¯é«˜ä¸åŸåˆ†è¾¨ç‡æˆæ¯”ä¾‹</li><li>Expand:</li><li>Shrink:</li></ul></li><li>Match: å†³å®š</li><li>Reference Pixels Per Unit</li></ul></li><li>ConstantPhysicalSize: è®©UIå…ƒç´ ä¿æŒåŒæ ·çš„ç‰©ç†å°ºå¯¸çš„å¤§å°è€Œä¸ç®¡å±å¹•çš„å°ºå¯¸å’Œåˆ†è¾¨ç‡<ul><li>Physical Unit:</li><li>Fallback Screen DPI</li><li>Default Sprite DPI</li><li>Reference Pixels Per Unit</li></ul></li></ul></li><li>å½“Canvasçš„RenderModeè¢«è®¾ç½®ä¸ºWorldSpaceçš„æ—¶å€™<ul><li>Dynamic Pixels Per Unitï¼š è¡¨ç¤ºUIä¸­åŠ¨æ€åˆ›å»ºçš„ä½å›¾ï¼Œæ¯”å¦‚Textï¼Œä¸­å•ä¸ªå•å…ƒçš„åƒç´ æ•°é‡</li><li>Reference Pixels Per Unit:  å¦‚æœä¸€ä¸ªspriteæœ‰è¿™ä¸ªPixels Per Unityçš„è®¾ç½®ï¼Œé‚£ä¹ˆåœ¨Spriteä¸­çš„ä¸€ä¸ªåƒç´ å°†ä¼šè¦†ç›–ä¸–ç•Œåœºæ™¯ä¸­éŸ©çš„ä¸€ä¸ªå•å…ƒï¼Œå¦‚æœReference Pixel Per Unit è¢«è®¾ç½®ä¸ºäº†1ï¼Œé‚£ä¹ˆåœ¨spriteä¸­çš„Pixels Per Unitè®¾ç½®å°†ä¼šè¢«ç›´æ¥ä½¿ç”¨</li></ul></li></ul><h2 id="ç»†èŠ‚-2">ç»†èŠ‚</h2><p>å¯¹äºè¢«è®¾ç½®ä¸ºScreen Space - Overlay æˆ–è€… Screen Space - Camera çš„ Canvasï¼ŒCanvas Scaler UI çš„ Scale Mode å¯ä»¥è¢«è®¾ç½®ä¸ºConstant PixelSizeï¼Œ Scale With Screen æˆ–è€… Constant Physical Size</p><h2 id="Constant-Pixel-Size">Constant Pixel Size</h2><h2 id="Scale-With-Screen-Size">Scale With Screen Size</h2><h2 id="Constant-Physical-Size">Constant Physical Size</h2><h2 id="World-Space-2">World Space</h2><h1>CanvasGroup</h1><p>CanvasGroupç”¨æ¥æ§åˆ¶æŸäº›æ–¹é¢</p><h1>CanvasRenderer</h1><p>Canvas Renderer ç»„ä»¶å°†ä¸€ä¸ªCanvasä¸­çš„ä¸€ä¸ªå›¾åƒUIæ¸²æŸ“å‡ºæ¥ï¼Œè¯¥ç»„ä»¶éœ€è¦æŒ‚è½½åœ¨æ¯ä¸€ä¸ªéœ€è¦æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„UIç»„ä»¶ä¸Šï¼ŒCanvas Rendererç»„ä»¶æ²¡æœ‰ä»»ä½•å±æ€§æš´éœ²åœ¨inspectorçª—å£ä¸­</p><h2 id="ç»†èŠ‚-3">ç»†èŠ‚</h2><p>åœ¨Unityçš„èœå•ä¸­å¯ä»¥åˆ›å»ºçš„æ ‡å‡†çš„UIç»„ä»¶ä¸Šä¸è®ºä½ éœ€ä¸éœ€è¦éƒ½æŒ‚è½½æœ‰Canvas Rendererç»„ä»¶ï¼Œä½†æ˜¯å½“æˆ‘ä»¬å¼€å‘æˆ‘ä»¬è‡ªå®šä¹‰çš„UIç»„ä»¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å°†è¯¥ç»„ä»¶æŒ‚è½½åˆ°è‡ªå®šä¹‰UIä¸Šï¼Œå°½ç®¡åœ¨Inspectorçª—å£ä¸­æ²¡æœ‰ä»»ä½•çš„å±æ€§ï¼Œä½†æ˜¯æœ‰ä¸€äº›å±æ€§å’ŒåŠŸèƒ½è¿˜æ˜¯å¯ä»¥é€šè¿‡ä»£ç çš„å½¢å¼æ¥æ§åˆ¶</p><h1>GraphicRaycaster</h1>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;UGUIçš„æ¸²æŸ“å’Œ3Dç‰©ä½“æ¸²æŸ“çš„åŒºåˆ«?&lt;/h1&gt;
&lt;p&gt;ç¬”è€…å¸Œæœ›å„ä½è¯»è€…åŒºåˆ†ä¸¤ä¸ªæ¦‚å¿µ: æ¸²æŸ“å’Œæ¸²æŸ“æ‰€éœ€çš„æ•°æ®æ›´æ–°. Unityé¦–å…ˆæ›´æ–°å…¶è¦æ¸²æŸ“ç‰©ä½“çš„æ¸²æŸ“æ•°æ®, ç„¶åæ ¹æ®æ¸²æŸ“æ•°æ®å°†ç”»é¢æ¸²æŸ“åˆ°å±å¹•ä¸Š, ç¬”è€…åœ¨æœ€åˆæ¥è§¦è¿™éƒ¨åˆ†å†…å®¹æ—¶, æŠŠä¸¤è€…æ··ä¸ºä¸€è°ˆ, ç»™è‡ªå·±é€ æˆäº†ç†è§£ä¸Šçš„å›°éš¾, </summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Unityäº‹ä»¶æ›´æ–°é¡ºåº</title>
    <link href="https://soincredible.github.io/posts/11d7edcb/"/>
    <id>https://soincredible.github.io/posts/11d7edcb/</id>
    <published>2025-04-18T22:33:36.000Z</published>
    <updated>2025-04-27T01:30:44.577Z</updated>
    
    <content type="html"><![CDATA[<h1>Unityäº‹ä»¶æ‰§è¡Œé¡ºåºå›¾</h1><p><a href="https://docs.unity3d.com/cn/2022.3/uploads/Main/monobehaviour_flowchart.svg"></a></p><h1>Awakeã€OnDestroyã€OnEnableã€OnDisableå››è€…æ‰§è¡Œæ—¶æœºæ¢³ç†</h1><p><code>OnEnable</code>æ–¹æ³•åœ¨AddComponentã€<strong>è·Ÿéšé¢„åˆ¶ä½“å®ä¾‹åŒ–(è¿™é‡Œè¦ååˆ†æ³¨æ„æŒ‚è½½è¯¥è„šæœ¬çš„GameObjçš„avtiveçŠ¶æ€è¦æ˜¯trueçš„æƒ…å†µä¸‹æ‰ä¼šè§¦å‘!)</strong>ã€åœ¨ä»£ç ä¸­æ‰‹åŠ¨è®¾ç½®enableä¸ºtrueçš„æ—¶å€™ä¼šè°ƒç”¨.<br><code>OnDisable</code>æ–¹æ³•æ˜¯è·Ÿéšé¢„åˆ¶ä½“è¢«åˆ é™¤ã€åœ¨ä»£ç ä¸­æ‰‹åŠ¨è®¾ç½®enableä¸ºfalseçš„æ—¶å€™ä¼šè°ƒç”¨.</p><p><code>Awake</code>æ–¹æ³•åœ¨AddComponentã€<strong>è·Ÿéšé¢„åˆ¶ä½“å®ä¾‹åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨(è¿™é‡Œè¦ååˆ†æ³¨æ„æŒ‚è½½è¯¥è„šæœ¬çš„GameObjçš„avtiveçŠ¶æ€è¦æ˜¯trueçš„æƒ…å†µä¸‹æ‰ä¼šè§¦å‘!)</strong>. æ•´ä¸ªç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸåªä¼šè°ƒç”¨ä¸€æ¬¡<br><code>OnDestroy</code>æ–¹æ³•åœ¨è·Ÿéšé¢„åˆ¶ä½“è¢«åˆ é™¤çš„æ—¶å€™è°ƒç”¨. æ•´ä¸ªç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸåªä¼šè°ƒç”¨ä¸€æ¬¡ <strong>æ³¨æ„,å¦‚æœåœ¨è¿™ä¸ªé¢„åˆ¶ä½“è¢«å®ä¾‹åŒ–åˆ°é”€æ¯çš„è¿™ä¸€ç”Ÿå‘½å‘¨æœŸå†…,æŒ‚è½½è¯¥è„šæœ¬çš„èŠ‚ç‚¹çš„activeä¸€ç›´éƒ½æ˜¯false,é‚£ä¹ˆå°±ä¸ä¼šè§¦å‘Awake,ä¹Ÿä¸ä¼šè§¦å‘OnDestroy,åªè¦è¯¥èŠ‚ç‚¹è¢«activeè¿‡,å³ä¾¿è¢«é”€æ¯çš„æ—¶å€™è¯¥èŠ‚ç‚¹å¤„åœ¨not activeçŠ¶æ€,ä¹Ÿä¼šè§¦å‘OnDestroy</strong></p><ul><li><code>yield WaitForEndOfFrame</code>æ˜¯åœ¨å¹²å˜›?</li></ul><p>åœ¨éPlayModeä¸‹,æœ‰å“ªäº›ç”Ÿå‘½å‘¨æœŸå†…çš„æ–¹æ³•ä¼šè¢«æ‰§è¡Œ?<br>åœ¨Unityå¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦åœ¨ç¼–è¾‘å™¨å¯åŠ¨æ—¶æˆ–è„šæœ¬é‡æ–°ç¼–è¯‘åæ‰§è¡Œä¸€äº›æ“ä½œï¼Œä¾‹å¦‚åˆå§‹åŒ–æ•°æ®ã€æ³¨å†Œäº‹ä»¶ç­‰ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨InitializeOnLoadç‰¹æ€§æ¥å®ç°è¿™ä¸€éœ€æ±‚ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»InitializeOnLoadç‰¹æ€§çš„ç”¨æ³•ï¼Œå¹¶é€šè¿‡ä¸‰ä¸ªå®é™…æ¡ˆä¾‹æ¥å±•ç¤ºå…¶åº”ç”¨åœºæ™¯ã€‚</p><p>OnValidateæ–¹æ³•æ˜¯ä¸€ä¸ªä»…é™ç¼–è¾‘å™¨çš„å‡½æ•°ï¼Œåœ¨UnityåŠ è½½è„šæœ¬æˆ–æ£€æŸ¥å™¨ä¸­çš„å€¼æ›´æ”¹æ—¶è°ƒç”¨ã€‚å®ƒçš„è°ƒç”¨æ—¶æœºéå¸¸ç‰¹æ®Šï¼Œè¿™é‡Œæ€»ç»“ä¸€ä¸‹ã€‚</p><ol><li><p>OnValidateä¸å—æ’­æ”¾æ¨¡å¼å½±å“ï¼Œåªè¦å…¶å€¼å‘ç”Ÿå˜åŒ–ï¼Œåœ¨éæ’­æ”¾çŠ¶æ€ä¸‹ä¹Ÿä¼šè¢«è°ƒç”¨ï¼ˆå¯ä»¥ç”¨äºéæ’­æ”¾æ¨¡å¼ä¿®æ”¹å‚æ•°åæ›´æ–°ï¼‰ã€‚</p></li><li><p>ä¸å—enabledçŠ¶æ€å½±å“ï¼Œå³ä½¿å…¶æ‰€åœ¨çš„è„šæœ¬è¢«ç¦ç”¨ï¼Œä¿®æ”¹å€¼æ—¶ä¹Ÿä¼šè¢«æ­£å¸¸è°ƒç”¨ã€‚</p></li><li><p>æ›´æ”¹è„šæœ¬enabledçŠ¶æ€æ—¶ï¼Œä¼šè°ƒç”¨ä¸€æ¬¡OnValidateã€‚å¦‚æœåœ¨Play Modeï¼ŒOnValidatedçš„è°ƒç”¨æ—¶æœºåœ¨OnDisableæˆ–è€…OnEnableå‰ã€‚</p></li><li><p>æ›´æ”¹GameObject activeçŠ¶æ€ä¸ä¼šè°ƒç”¨OnValidateï¼Œåªæœ‰OnDisableå’ŒOnEnableä¼šè¢«è°ƒç”¨ã€‚</p></li><li><p>åˆå§‹åŠ è½½æ—¶ï¼Œæ— è®ºenabledçŠ¶æ€å’ŒactiveçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šè¢«è°ƒç”¨å¤šæ¬¡ã€‚å…¶è°ƒç”¨æ—¶æœºåœ¨Awakeä¹‹å‰ã€‚</p></li></ol><p>å¸¸è§ç”¨æ³•ï¼š</p><ol><li><p>ç”¨äºPlay Modeä¸‹ä¿®æ”¹å‚æ•°å€¼ï¼Œå®æ—¶æŸ¥çœ‹æ•ˆæœ</p></li><li><p>å®æ—¶æ›´æ–°èµ„äº§æ–‡ä»¶ï¼Œæ¯”å¦‚æè´¨ã€shaderç­‰</p></li></ol><h1>å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://blog.csdn.net/angry_youth/article/details/117469722">https://blog.csdn.net/angry_youth/article/details/117469722</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;Unityäº‹ä»¶æ‰§è¡Œé¡ºåºå›¾&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.unity3d.com/cn/2022.3/uploads/Main/monobehaviour_flowchart.svg&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h1&gt;Awakeã€OnDestroyã€</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>UnityShaderå®ç°æ°´çš„æ•ˆæœ</title>
    <link href="https://soincredible.github.io/posts/265490d3/"/>
    <id>https://soincredible.github.io/posts/265490d3/</id>
    <published>2025-04-18T22:28:48.000Z</published>
    <updated>2025-04-27T01:30:44.577Z</updated>
    
    
    
    
    
  </entry>
  
  <entry>
    <title>UnityShaderå®ç°è‰çš„æ•ˆæœ</title>
    <link href="https://soincredible.github.io/posts/b1964c5e/"/>
    <id>https://soincredible.github.io/posts/b1964c5e/</id>
    <published>2025-04-18T22:28:32.000Z</published>
    <updated>2025-04-27T01:30:44.577Z</updated>
    
    
    
    
    
  </entry>
  
  <entry>
    <title>UnityShaderå®ç°äº‘çš„æ•ˆæœ</title>
    <link href="https://soincredible.github.io/posts/81b49e5c/"/>
    <id>https://soincredible.github.io/posts/81b49e5c/</id>
    <published>2025-04-18T22:28:19.000Z</published>
    <updated>2025-04-27T01:30:44.577Z</updated>
    
    
    
    
    
  </entry>
  
  <entry>
    <title>UnityUGUIé—®é¢˜è®°å½•</title>
    <link href="https://soincredible.github.io/posts/2b97ac4f/"/>
    <id>https://soincredible.github.io/posts/2b97ac4f/</id>
    <published>2025-04-18T22:25:47.000Z</published>
    <updated>2025-05-07T12:15:13.507Z</updated>
    
    <content type="html"><![CDATA[<h1>ä¸ºä»€ä¹ˆä¼šæœ‰<code>LayoutRebuilder.ForceRebuildLayoutImmediate(RectTransform)</code>æ¥å£? ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸ªæ¥å£?</h1><p>æˆ‘ä»¬åœ¨æŸä¸€å¸§çš„Updateæˆ–è€…EventInputä¸­æ‰§è¡Œäº†ä¸€æ®µä»£ç , è¿™æ®µä»£ç ä¼šä¿®æ”¹æŸä¸€UGUIç»„ä»¶çš„æŸäº›å±æ€§,æˆ‘ä»¬çŸ¥é“,å½“ä¸€ä¸ªUGUIç»„ä»¶çš„å±æ€§å‘ç”Ÿå˜åŒ–æ—¶,è¿™ä¸ªUGUIç»„ä»¶ä¸‹é¢çš„æ‰€æœ‰UGUIç»„ä»¶çš„å±æ€§ä¹Ÿä¼šè¿å¸¦ç€å‘ç”Ÿå˜åŒ–. ä½†æ˜¯åœ¨ä¸€å¸§å†…,è¿™ç§å˜åŒ–ä¸æ˜¯çœŸçš„åŒæ—¶å‘ç”Ÿçš„,UGUIçš„æ•°æ®æ›´æ–°å‘ç”Ÿåœ¨<code>LateUpdate</code>ä¹‹å,<code>OnPreCull</code>ä¹‹å‰. è¿™æ˜¯ç¬”è€…è¿˜äº²è‡ªéªŒè¯çš„. å…·ä½“éªŒè¯è¿‡ç¨‹åœ¨<a href="">è¿™ç¯‡åšå®¢</a>ä¸­.ä¹Ÿå°±æ˜¯è¯´Unityä¼šå…ˆæ‰§è¡Œå®Œæ‰€æœ‰çš„ä»£ç é€»è¾‘, ç„¶åå†å»æ›´æ–°è¿™äº›UGUIç»„ä»¶çš„å±æ€§, æ‰€ä»¥åœ¨è¿™ä¸€å¸§ä¸­æˆ‘ä»¬æ‰§è¡Œçš„ä¿®æ”¹UGUIç»„ä»¶å±æ€§çš„æ“ä½œ,åªæœ‰åœ¨ä¸‹ä¸€å¸§æ—¶,æˆ‘ä»¬æ‰èƒ½å¤Ÿæ‹¿åˆ°è¿™ä¸ªç»„ä»¶ä¸‹UGUIç»„ä»¶çš„å±æ€§çš„æ­£ç¡®å€¼.<br>å¦‚æœæˆ‘ä»¬æƒ³åœ¨å½“å‰è¿™ä¸€å¸§å°±è·å¾—æ­£ç¡®çš„UGUIç»„ä»¶çš„å±æ€§,é‚£ä¹ˆ<code>LayoutRebuilder.ForceRebuildLayoutImmediate(RectTransform)</code>æ¥å£å°±æ´¾ä¸Šç”¨åœºäº†. è¿™ä¸ªæ¥å£ä¼šå¼ºåˆ¶æ›´æ–°ä¼ å…¥UGUIåŠå…¶å­UGUIçš„RectTransformç»„ä»¶çš„å±æ€§, ç„¶åæˆ‘ä»¬å°±å¯ä»¥åœ¨å½“å‰å¸§è·å¾—æ­£ç¡®çš„å±æ€§å€¼äº†. åœ¨ç¬”è€…çš„å¼€å‘ç»éªŒä¸­, è¯¥æ¥å£ä¸€èˆ¬ä¼šåœ¨ä½¿ç”¨UGUIé‡Œçš„Layoutç›¸å…³ç»„ä»¶çš„æ—¶å€™æ¯”è¾ƒå¸¸ç”¨.</p><h1>å‡ ä¸ªLayoutGroupç»„ä»¶çš„å®ç°åŸç†</h1><p>ä¸€ä¸ªä¾‹å­å°±æ˜¯è®©çˆ¶UIç»„ä»¶çš„å°ºå¯¸è·Ÿç€å­UIç»„ä»¶çš„å°ºå¯¸å˜åŒ–<br><a href="https://blog.csdn.net/yhx956058885/article/details/130729325">https://blog.csdn.net/yhx956058885/article/details/130729325</a></p><h1>Coffee UIEffectè¿™ä¸ªUIæ‰©å±•åº“ é‡Œé¢çš„UIShadowç»„ä»¶ä¸Šçš„å€¼çš„å®ç°åŸç†å’Œä¸åŒæ˜¯ä»€ä¹ˆ? Outlineå’ŒOutline8çš„åŒºåˆ«? Fitè¿˜æœ‰ä¸€ä¸ªä»€ä¹ˆå¿˜äº†çš„åŒºåˆ«?</h1><h1>Screenæ¥å£ä¸­çš„widthå’Œheight å’Œ currentResolutionçš„åŒºåˆ«?</h1><h1>è®©UIå˜ç°è‰²</h1><p>ç»™UIè¦å˜ç°çš„UIç»„ä»¶æŒ‚è½½ä¸€ä¸ªå˜ç°æè´¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;UI/Gray&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        [PerRendererData] _MainTex (&quot;Sprite Texture&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _Color (&quot;Tint&quot;, Color) = (1,1,1,1)</span><br><span class="line"></span><br><span class="line">        _StencilComp (&quot;Stencil Comparison&quot;, Float) = 8</span><br><span class="line">        _Stencil (&quot;Stencil ID&quot;, Float) = 0</span><br><span class="line">        _StencilOp (&quot;Stencil Operation&quot;, Float) = 0</span><br><span class="line">        _StencilWriteMask (&quot;Stencil Write Mask&quot;, Float) = 255</span><br><span class="line">        _StencilReadMask (&quot;Stencil Read Mask&quot;, Float) = 255</span><br><span class="line"></span><br><span class="line">        _ColorMask (&quot;Color Mask&quot;, Float) = 15</span><br><span class="line"></span><br><span class="line">        [Toggle(UNITY_UI_ALPHACLIP)] _UseUIAlphaClip (&quot;Use Alpha Clip&quot;, Float) = 0</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Queue&quot;=&quot;Transparent&quot;</span><br><span class="line">            &quot;IgnoreProjector&quot;=&quot;True&quot;</span><br><span class="line">            &quot;RenderType&quot;=&quot;Transparent&quot;</span><br><span class="line">            &quot;PreviewType&quot;=&quot;Plane&quot;</span><br><span class="line">            &quot;CanUseSpriteAtlas&quot;=&quot;True&quot;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Stencil</span><br><span class="line">        &#123;</span><br><span class="line">            Ref [_Stencil]</span><br><span class="line">            Comp [_StencilComp]</span><br><span class="line">            Pass [_StencilOp]</span><br><span class="line">            ReadMask [_StencilReadMask]</span><br><span class="line">            WriteMask [_StencilWriteMask]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Cull Off</span><br><span class="line">        Lighting Off</span><br><span class="line">        ZWrite Off</span><br><span class="line">        ZTest [unity_GUIZTestMode]</span><br><span class="line">        Blend SrcAlpha OneMinusSrcAlpha</span><br><span class="line">        ColorMask [_ColorMask]</span><br><span class="line"></span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Name &quot;Default&quot;</span><br><span class="line">        CGPROGRAM</span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line">            #pragma target 2.0</span><br><span class="line"></span><br><span class="line">            #include &quot;UnityCG.cginc&quot;</span><br><span class="line">            #include &quot;UnityUI.cginc&quot;</span><br><span class="line"></span><br><span class="line">            #pragma multi_compile __ UNITY_UI_CLIP_RECT</span><br><span class="line">            #pragma multi_compile __ UNITY_UI_ALPHACLIP</span><br><span class="line"></span><br><span class="line">            struct appdata_t</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex   : POSITION;</span><br><span class="line">                float4 color    : COLOR;</span><br><span class="line">                float2 texcoord : TEXCOORD0;</span><br><span class="line">                UNITY_VERTEX_INPUT_INSTANCE_ID</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex   : SV_POSITION;</span><br><span class="line">                fixed4 color    : COLOR;</span><br><span class="line">                float2 texcoord  : TEXCOORD0;</span><br><span class="line">                float4 worldPosition : TEXCOORD1;</span><br><span class="line">                UNITY_VERTEX_OUTPUT_STEREO</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            fixed4 _Color;</span><br><span class="line">            fixed4 _TextureSampleAdd;</span><br><span class="line">            float4 _ClipRect;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line"></span><br><span class="line">            v2f vert(appdata_t v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f OUT;</span><br><span class="line">                UNITY_SETUP_INSTANCE_ID(v);</span><br><span class="line">                UNITY_INITIALIZE_VERTEX_OUTPUT_STEREO(OUT);</span><br><span class="line">                OUT.worldPosition = v.vertex;</span><br><span class="line">                OUT.vertex = UnityObjectToClipPos(OUT.worldPosition);</span><br><span class="line"></span><br><span class="line">                OUT.texcoord = TRANSFORM_TEX(v.texcoord, _MainTex);</span><br><span class="line"></span><br><span class="line">                OUT.color = v.color * _Color;</span><br><span class="line">                return OUT;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f IN) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                half4 color = (tex2D(_MainTex, IN.texcoord) + _TextureSampleAdd) * IN.color;</span><br><span class="line"></span><br><span class="line">                #ifdef UNITY_UI_CLIP_RECT</span><br><span class="line">                color.a *= UnityGet2DClipping(IN.worldPosition.xy, _ClipRect);</span><br><span class="line">                #endif</span><br><span class="line"></span><br><span class="line">                #ifdef UNITY_UI_ALPHACLIP</span><br><span class="line">                clip (color.a - 0.001);</span><br><span class="line">                #endif</span><br><span class="line">                // è‰²å½©å˜ç°  äº®åº¦æå–çŸ©é˜µ</span><br><span class="line">                float gray = dot(color.xyz, float3(0.299, 0.587, 0.114));</span><br><span class="line">                color.xyz = float3(gray, gray, gray);</span><br><span class="line">                return color;</span><br><span class="line">            &#125;</span><br><span class="line">        ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1>UGUIå®ç°æ–‡å­—è¾¹ç¼˜å‘å…‰æ•ˆæœ</h1><h1>Unityå®ç°Textéƒ¨åˆ†åŒºåŸŸå¯å“åº”ç‚¹å‡»</h1><p>æºç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Text;</span><br><span class="line">using System.Text.RegularExpressions;</span><br><span class="line">using UnityEngine;</span><br><span class="line">using UnityEngine.EventSystems;</span><br><span class="line">using UnityEngine.UI;</span><br><span class="line"></span><br><span class="line">namespace UI.UIItems</span><br><span class="line">&#123;</span><br><span class="line">    public class HyperlinkText : Text, IPointerClickHandler</span><br><span class="line">    &#123;</span><br><span class="line">        protected override void Awake()</span><br><span class="line">        &#123;</span><br><span class="line">            Set_TextLinkFuncCB(Application.OpenURL);</span><br><span class="line">        &#125;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// è§£æå®Œæœ€ç»ˆçš„æ–‡æœ¬</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        private string m_OutputText;</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// è¶…é“¾æ¥ä¿¡æ¯åˆ—è¡¨</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        private readonly List&lt;HrefInfo_&gt; m_HrefInfos = new List&lt;HrefInfo_&gt;();</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// æ–‡æœ¬æ„é€ å™¨</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        protected static readonly StringBuilder s_TextBuilder = new StringBuilder();</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// è¶…é“¾æ¥æ­£åˆ™</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        private static readonly Regex s_HrefRegex =</span><br><span class="line">            new Regex(@&quot;&lt;a href=([^&gt;\n\s]+)&gt;(.*?)(&lt;/a&gt;)&quot;, RegexOptions.Singleline);</span><br><span class="line"></span><br><span class="line">        //</span><br><span class="line">        private static readonly Regex s_VertexFilter = new Regex(@&quot;(|[ \n\r\t]+)&quot;, RegexOptions.Singleline);</span><br><span class="line"></span><br><span class="line">        VertexHelper _toFill = null;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// æ˜¯å¦ä½¿ç”¨è¶…é“¾æ¥  é»˜è®¤æœªFalse</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        bool bool_IsLink = true;</span><br><span class="line"></span><br><span class="line">        private Action&lt;string&gt; linkFunc_Cb = null;</span><br><span class="line"></span><br><span class="line">        private RectTransform rect_Parent;</span><br><span class="line">        private RectTransform Rect_Parent</span><br><span class="line">        &#123;</span><br><span class="line">            get</span><br><span class="line">            &#123;</span><br><span class="line">                if (rect_Parent == null)</span><br><span class="line">                &#123;</span><br><span class="line">                    Transform trans = this.transform.parent != null ? this.transform.parent.transform : this.transform;</span><br><span class="line">                    rect_Parent = trans.GetComponent&lt;RectTransform&gt;();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                return rect_Parent;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //è®¾ç½® æ–‡æœ¬ è¶…é“¾æ¥çš„ç‚¹å‡»å›è°ƒäº‹ä»¶</span><br><span class="line">        public void Set_TextLinkFuncCB(Action&lt;string&gt; linkFunc_Cb)</span><br><span class="line">        &#123;</span><br><span class="line">            bool_IsLink = true;</span><br><span class="line">            if (this.linkFunc_Cb != null)</span><br><span class="line">            &#123;</span><br><span class="line">                this.linkFunc_Cb = null;</span><br><span class="line">            &#125;</span><br><span class="line">            this.linkFunc_Cb = linkFunc_Cb;</span><br><span class="line">            OnPopulateMesh(_toFill);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //å­—ç¬¦é¡¶ç‚¹æ•°</span><br><span class="line">        const int perCharVerCount = 4;</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// æ–‡æœ¬æ„é€ å™¨</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        protected static readonly StringBuilder textRebuild = new StringBuilder();</span><br><span class="line"></span><br><span class="line">        protected override void OnPopulateMesh(VertexHelper toFill)</span><br><span class="line">        &#123;</span><br><span class="line">            if (toFill == null)</span><br><span class="line">            &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            _toFill = toFill;</span><br><span class="line">            //TODO ç¼–è¾‘å™¨çŠ¶æ€ä¸‹è¿™é‡Œä¸æ‰§è¡Œï¼Œ æ–¹ä¾¿è°ƒè¯•çœ‹åˆ°æ•ˆæœç”¨</span><br><span class="line">            if (!bool_IsLink)</span><br><span class="line">            &#123;</span><br><span class="line">                m_Text = GetOutputText_Nomal(text);</span><br><span class="line">                base.OnPopulateMesh(toFill);</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            var orignText = m_Text;</span><br><span class="line">            m_OutputText = GetOutputText_Init(text);</span><br><span class="line">            m_Text = m_OutputText;</span><br><span class="line">            text = m_OutputText;</span><br><span class="line">            base.OnPopulateMesh(toFill);</span><br><span class="line">            m_Text = orignText;</span><br><span class="line">            GetOutputText(text, toFill.currentVertCount);</span><br><span class="line"></span><br><span class="line">            UIVertex vert = new UIVertex();</span><br><span class="line"></span><br><span class="line">            // å¤„ç†è¶…é“¾æ¥åŒ…å›´æ¡†</span><br><span class="line">            foreach (var hrefInfo in m_HrefInfos)</span><br><span class="line">            &#123;</span><br><span class="line">                hrefInfo.boxes.Clear();</span><br><span class="line">                if (hrefInfo.startIndex &gt;= toFill.currentVertCount)</span><br><span class="line">                &#123;</span><br><span class="line">                    continue;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                // å°†è¶…é“¾æ¥é‡Œé¢çš„æ–‡æœ¬é¡¶ç‚¹ç´¢å¼•åæ ‡åŠ å…¥åˆ°åŒ…å›´æ¡†</span><br><span class="line">                toFill.PopulateUIVertex(ref vert, hrefInfo.startIndex);</span><br><span class="line">                var pos = vert.position;</span><br><span class="line">                var bounds = new Bounds(pos, Vector3.zero);</span><br><span class="line">                Vector3 previousPos = Vector3.zero;</span><br><span class="line">                for (int i = hrefInfo.startIndex, m = hrefInfo.endIndex; i &lt; m; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    if (i &gt;= toFill.currentVertCount)</span><br><span class="line">                    &#123;</span><br><span class="line">                        break;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    toFill.PopulateUIVertex(ref vert, i);</span><br><span class="line">                    pos = vert.position;</span><br><span class="line">                    if ((i - hrefInfo.startIndex) % 4 == 1)</span><br><span class="line">                    &#123;</span><br><span class="line">                        previousPos = pos;</span><br><span class="line">                    &#125;</span><br><span class="line">                    if (previousPos != Vector3.zero &amp;&amp; (i - hrefInfo.startIndex) % 4 == 0 &amp;&amp; pos.x &lt; previousPos.x) // æ¢è¡Œé‡æ–°æ·»åŠ åŒ…å›´æ¡†</span><br><span class="line">                    &#123;</span><br><span class="line">                        hrefInfo.boxes.Add(new Rect(bounds.min, bounds.size));</span><br><span class="line">                        bounds = new Bounds(pos, Vector3.zero);</span><br><span class="line">                    &#125;</span><br><span class="line">                    else</span><br><span class="line">                    &#123;</span><br><span class="line">                        bounds.Encapsulate(pos); // æ‰©å±•åŒ…å›´æ¡†</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                hrefInfo.boxes.Add(new Rect(bounds.min, bounds.size));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            if (this.gameObject.activeInHierarchy)</span><br><span class="line">            &#123;</span><br><span class="line">                StartCoroutine(RefrehLayout());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        IEnumerator RefrehLayout()</span><br><span class="line">        &#123;</span><br><span class="line">            yield return new WaitForEndOfFrame();</span><br><span class="line">            LayoutRebuilder.ForceRebuildLayoutImmediate(Rect_Parent);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //åˆå§‹åŒ–è¶…é“¾æ¥æ–‡æœ¬ è·å–æœ€ç»ˆç»“æœçš„å®šç‚¹æ•°ç”¨</span><br><span class="line">        string GetOutputText_Init(string outputText)</span><br><span class="line">        &#123;</span><br><span class="line">            s_TextBuilder.Length = 0;</span><br><span class="line">            m_HrefInfos.Clear();</span><br><span class="line">            var indexText = 0;</span><br><span class="line">            foreach (Match match in s_HrefRegex.Matches(outputText))</span><br><span class="line">            &#123;</span><br><span class="line">                s_TextBuilder.Append(outputText.Substring(indexText, match.Index - indexText));</span><br><span class="line">                s_TextBuilder.Append(match.Groups[2].Value);</span><br><span class="line">                indexText = match.Index + match.Length;</span><br><span class="line">            &#125;</span><br><span class="line">            s_TextBuilder.Append(outputText.Substring(indexText, outputText.Length - indexText));</span><br><span class="line">            return s_TextBuilder.ToString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// è·å–è¶…é“¾æ¥è§£æåçš„æœ€åè¾“å‡ºæ–‡æœ¬</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">        string GetOutputText(string outputText, int currentVertCount)</span><br><span class="line">        &#123;</span><br><span class="line">            s_TextBuilder.Length = 0;</span><br><span class="line">            m_HrefInfos.Clear();</span><br><span class="line">            var indexText = 0;</span><br><span class="line">            int vertCount = Regex.Replace(Regex.Replace(outputText.ToString(), @&quot;\s&quot;, &quot;&quot;), @&quot;&lt;(.*?)&gt;&quot;, &quot;&quot;).Length * 4;</span><br><span class="line">            int vercCount_Offset_Start = 0;</span><br><span class="line">            int vercCount_Offset_End = 0;</span><br><span class="line">            bool isLineCup = false;</span><br><span class="line">            if (currentVertCount &gt; vertCount)</span><br><span class="line">            &#123;</span><br><span class="line">                isLineCup = true;</span><br><span class="line">                vercCount_Offset_Start = 80;</span><br><span class="line">                vercCount_Offset_End = 88;</span><br><span class="line">            &#125;</span><br><span class="line">            foreach (Match match in s_HrefRegex.Matches(outputText))</span><br><span class="line">            &#123;</span><br><span class="line">                s_TextBuilder.Append(outputText.Substring(indexText, match.Index - indexText));</span><br><span class="line">                int offset_Len = 0;</span><br><span class="line">                if (isLineCup)</span><br><span class="line">                &#123;</span><br><span class="line">                    offset_Len = (s_TextBuilder.Length - Regex.Replace(s_TextBuilder.ToString(), @&quot;&lt;(.*?)&gt;&quot;, &quot;&quot;).Length) * 4;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                s_TextBuilder.Append(&quot;&lt;i&gt;&lt;b&gt;&lt;color=#f49037&gt;&quot;);  // è¶…é“¾æ¥é¢œè‰²</span><br><span class="line"></span><br><span class="line">                var str = Regex.Replace(s_TextBuilder.ToString(), @&quot;\s&quot;, &quot;&quot;);</span><br><span class="line">                var group = match.Groups[1];</span><br><span class="line">                var hrefInfo = new HrefInfo_</span><br><span class="line">                &#123;</span><br><span class="line">                    startIndex = Regex.Replace(str, @&quot;&lt;(.*?)&gt;&quot;, &quot;&quot;).Length * 4 + vercCount_Offset_Start + offset_Len, // è¶…é“¾æ¥é‡Œçš„æ–‡æœ¬èµ·å§‹é¡¶ç‚¹ç´¢å¼•</span><br><span class="line">                    endIndex = (Regex.Replace(str, @&quot;&lt;(.*?)&gt;&quot;, &quot;&quot;).Length +</span><br><span class="line">                        Regex.Replace(Regex.Replace(match.Groups[2].ToString(), @&quot;\s&quot;, &quot;&quot;)</span><br><span class="line">                            , @&quot;&lt;(.*?)&gt;&quot;, &quot;&quot;).Length - 1) * 4 + 3 + vercCount_Offset_End + offset_Len,</span><br><span class="line">                    name = group.Value</span><br><span class="line">                &#125;;</span><br><span class="line">                m_HrefInfos.Add(hrefInfo);</span><br><span class="line">                //Debug.Log($&quot;é¡¶ç‚¹ä¿¡æ¯ï¼Œå¼€å§‹çš„ï¼š&#123;hrefInfo.startIndex&#125;ï¼Œç»“æŸçš„ï¼š&#123;hrefInfo.endIndex&#125;&quot;);</span><br><span class="line"></span><br><span class="line">                s_TextBuilder.Append(match.Groups[2].Value);</span><br><span class="line">                s_TextBuilder.Append(&quot;&lt;/color&gt;&lt;/b&gt;&lt;/i&gt;&quot;);</span><br><span class="line">                indexText = match.Index + match.Length;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            s_TextBuilder.Append(outputText.Substring(indexText, outputText.Length - indexText));</span><br><span class="line">            return s_TextBuilder.ToString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //è·å–ç¥›é™¤æ‰è¶…é“¾æ¥ ä¿ç•™æ™®é€šæ–‡æœ¬  ä¿è¯é…ç½®é‡Œè¶…é“¾æ¥æ ‡ç­¾çš„æ–‡æœ¬  åœ¨å…¶ä»–åœ°æ–¹ä¹Ÿå¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œåªæœ‰è°ƒç”¨äº†è¶…é“¾æ¥åˆå§‹åŒ–çš„  æ‰ä¼šç»™è¶…é“¾æ¥å½¢å¼çš„æ–‡æœ¬</span><br><span class="line">        string GetOutputText_Nomal(string outputText)</span><br><span class="line">        &#123;</span><br><span class="line">            s_TextBuilder.Length = 0;</span><br><span class="line">            m_HrefInfos.Clear();</span><br><span class="line">            var indexText = 0;</span><br><span class="line">            MatchCollection matchs = s_HrefRegex.Matches(outputText);</span><br><span class="line">            if (matchs.Count &lt;= 0)</span><br><span class="line">            &#123;</span><br><span class="line">                return outputText;</span><br><span class="line">            &#125;</span><br><span class="line">            foreach (Match match in matchs)</span><br><span class="line">            &#123;</span><br><span class="line">                s_TextBuilder.Append(outputText.Substring(indexText, match.Index - indexText));</span><br><span class="line">                s_TextBuilder.Append(match.Groups[2].Value);</span><br><span class="line">                indexText = match.Index + match.Length;</span><br><span class="line">            &#125;</span><br><span class="line">            s_TextBuilder.Append(outputText.Substring(indexText, outputText.Length - indexText));</span><br><span class="line">            return s_TextBuilder.ToString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void OnPointerClick(PointerEventData eventData)</span><br><span class="line">        &#123;</span><br><span class="line">            Vector2 lp;</span><br><span class="line">            RectTransformUtility.ScreenPointToLocalPointInRectangle(</span><br><span class="line">                rectTransform, eventData.position, eventData.pressEventCamera, out lp);</span><br><span class="line"></span><br><span class="line">            foreach (var hrefInfo in m_HrefInfos)</span><br><span class="line">            &#123;</span><br><span class="line">                var boxes = hrefInfo.boxes;</span><br><span class="line">                for (var i = 0; i &lt; boxes.Count; ++i)</span><br><span class="line">                &#123;</span><br><span class="line">                    if (boxes[i].Contains(lp))</span><br><span class="line">                    &#123;</span><br><span class="line">                        //Debug.Log(&quot;æŠ€èƒ½ è¶…é“¾æ¥ ç‚¹å‡»äº†ï¼š&quot; + hrefInfo.name);</span><br><span class="line">                        linkFunc_Cb?.Invoke(hrefInfo.name);</span><br><span class="line">                        return;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /// &lt;summary&gt;</span><br><span class="line">    /// è¶…é“¾æ¥ä¿¡æ¯ç±»</span><br><span class="line">    /// &lt;/summary&gt;</span><br><span class="line">    class HrefInfo_</span><br><span class="line">    &#123;</span><br><span class="line">        public int startIndex;</span><br><span class="line"></span><br><span class="line">        public int endIndex;</span><br><span class="line"></span><br><span class="line">        public string name;</span><br><span class="line"></span><br><span class="line">        public readonly List&lt;Rect&gt; boxes = new List&lt;Rect&gt;();</span><br><span class="line">    &#125;       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var terms2 = $&quot;&lt;color=#aa3900&gt;&lt;a herf=&#123;PrivacyPolicyDefine.UrlService&#125;&gt;&#123;ScriptLocalization.terms_of_use&#125;&lt;/a&gt;&lt;/color&gt;&quot;;</span><br><span class="line"></span><br><span class="line">var policy2 = $&quot;&lt;color=#aa3900&gt;&lt;a herf=&#123;PrivacyPolicyDefine.UrlPrivacy&#125;&gt;&#123;ScriptLocalization.privacy_policy&#125;&lt;/a&gt;&lt;/color&gt;&quot;;</span><br><span class="line"></span><br><span class="line">_ui.contentText.text = string.Format(ScriptLocalization.terms_policy_dlg_content, terms2, policy2);</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;ä¸ºä»€ä¹ˆä¼šæœ‰&lt;code&gt;LayoutRebuilder.ForceRebuildLayoutImmediate(RectTransform)&lt;/code&gt;æ¥å£? ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸ªæ¥å£?&lt;/h1&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨æŸä¸€å¸§çš„Updateæˆ–è€…EventInputä¸­æ‰§è¡Œäº†ä¸€æ®µä»£ç , è¿™æ®µ</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>UnityEditoråŠŸèƒ½å¼€å‘</title>
    <link href="https://soincredible.github.io/posts/2e6b555f/"/>
    <id>https://soincredible.github.io/posts/2e6b555f/</id>
    <published>2025-04-18T22:22:15.000Z</published>
    <updated>2025-04-27T01:30:44.577Z</updated>
    
    <content type="html"><![CDATA[<h1>æ‹“å±•UnityInspectorçª—å£</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Reflection;</span><br><span class="line">using UnityEditor;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">namespace DDZ</span><br><span class="line">&#123;</span><br><span class="line">    [CustomEditor(typeof(RectTransform))]</span><br><span class="line">    public class RectTransformEditor : Editor</span><br><span class="line">    &#123;</span><br><span class="line">        Color defutColor;</span><br><span class="line">        RectTransform rectTransform;</span><br><span class="line">        UIRuntimeComponents runtimeComponents;</span><br><span class="line">        Object[] components;</span><br><span class="line">        Editor rectTransformEditor;</span><br><span class="line">        static bool showCustom = true;</span><br><span class="line"></span><br><span class="line">        GUIContent toggleLabel = new GUIContent(&quot; èŠ‚ç‚¹æ”¶é›†&quot;);</span><br><span class="line">        GUIStyle style = null;</span><br><span class="line">        </span><br><span class="line">        private void OnEnable()</span><br><span class="line">        &#123;</span><br><span class="line">            //åå°„è·å–ectTransformEditor</span><br><span class="line">            var type = Assembly.GetAssembly(typeof(Editor)).GetType(&quot;UnityEditor.RectTransformEditor&quot;, false);</span><br><span class="line">            if (type==null)</span><br><span class="line">            &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            rectTransformEditor = CreateEditor(target, type);</span><br><span class="line"></span><br><span class="line">            rectTransform = (RectTransform) target;</span><br><span class="line">            if (rectTransform != null)</span><br><span class="line">            &#123;</span><br><span class="line">                defutColor = GUI.backgroundColor;</span><br><span class="line">                </span><br><span class="line">                //è·å–RuntimeComponentsç»„ä»¶</span><br><span class="line">                runtimeComponents = FindUIRuntimeComponents(rectTransform.parent);</span><br><span class="line">            </span><br><span class="line">                //æ”¶é›†èŠ‚ç‚¹ï¼Œæ·»åŠ GameObjectï¼Œå¹¶ä¸”åˆ é™¤CanvasRenderer</span><br><span class="line">                components = rectTransform.GetComponents&lt;Component&gt;();</span><br><span class="line">                var list = components.ToList();</span><br><span class="line">                list.Add(rectTransform.gameObject);</span><br><span class="line">                int len = list.Count;</span><br><span class="line">                for (int i = len - 1; i &gt;= 0; i--)</span><br><span class="line">                &#123;</span><br><span class="line">                    var component = list[i];</span><br><span class="line">                    var typeStr = component.GetType().Name;</span><br><span class="line">                    if (typeStr == &quot;CanvasRenderer&quot;)</span><br><span class="line">                    &#123;</span><br><span class="line">                        list.RemoveAt(i);</span><br><span class="line">                        break;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                components = list.ToArray();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public override void OnInspectorGUI()</span><br><span class="line">        &#123;</span><br><span class="line">            if (rectTransform == null)</span><br><span class="line">            &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (rectTransformEditor)</span><br><span class="line">            &#123;</span><br><span class="line">                rectTransformEditor.OnInspectorGUI();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            if (runtimeComponents == null)</span><br><span class="line">            &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            EditorGUILayout.Space();</span><br><span class="line">            Rect xian1 = GUILayoutUtility.GetRect(GUIContent.none, GUIStyle.none, GUILayout.Height(1));</span><br><span class="line">            Rect backgroundRect = GUILayoutUtility.GetRect(GUIContent.none, GUIStyle.none, GUILayout.Height(20));</span><br><span class="line"></span><br><span class="line">            EditorGUI.DrawRect(xian1, Color.black);</span><br><span class="line">            EditorGUI.DrawRect(backgroundRect, new Color(0.25f, 0.25f, 0.25f));</span><br><span class="line"></span><br><span class="line">            // ç»˜åˆ¶å†…å®¹åŒºåŸŸ</span><br><span class="line">            if (style==null)</span><br><span class="line">            &#123;</span><br><span class="line">                style = new GUIStyle(EditorStyles.foldout);</span><br><span class="line">                style.fontStyle = FontStyle.Bold;</span><br><span class="line">            &#125;</span><br><span class="line">            Rect contentRect = new Rect(backgroundRect.x-15 , backgroundRect.y, backgroundRect.width+20, backgroundRect.height);</span><br><span class="line">            showCustom = GUI.Toggle(contentRect, showCustom, toggleLabel,style);</span><br><span class="line"></span><br><span class="line">            if (showCustom)</span><br><span class="line">            &#123;</span><br><span class="line">                int len = components.Length;</span><br><span class="line">                for (int i = 0; i &lt; len; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    var component = components[i];</span><br><span class="line">                    var typeStr = component.GetType().Name;</span><br><span class="line">                    if (IsCollected(runtimeComponents, component))</span><br><span class="line">                    &#123;</span><br><span class="line">                        GUI.backgroundColor = Color.green;</span><br><span class="line">                    &#125;</span><br><span class="line">                    else</span><br><span class="line">                    &#123;</span><br><span class="line">                        GUI.backgroundColor = defutColor;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    if (i % 3 == 0)</span><br><span class="line">                    &#123;</span><br><span class="line">                        GUILayout.BeginHorizontal();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    if (i == len - 1)</span><br><span class="line">                    &#123;</span><br><span class="line">                        if (GUILayout.Button(typeStr, GUILayout.Width(100), GUILayout.Height(30)))</span><br><span class="line">                        &#123;</span><br><span class="line">                            OperateComponent(component);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    else</span><br><span class="line">                    &#123;</span><br><span class="line">                        if (GUILayout.Button(typeStr, GUILayout.Height(30)))</span><br><span class="line">                        &#123;</span><br><span class="line">                            OperateComponent(component);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    if (i % 3 == 2 || i == len - 1)</span><br><span class="line">                    &#123;</span><br><span class="line">                        GUILayout.EndHorizontal();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                EditorGUI.indentLevel--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void OnDisable()</span><br><span class="line">        &#123;</span><br><span class="line">            if (rectTransformEditor)</span><br><span class="line">            &#123;</span><br><span class="line">                DestroyImmediate(rectTransformEditor);</span><br><span class="line">                rectTransform = null;</span><br><span class="line">                runtimeComponents = null;</span><br><span class="line">                components = null;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        void OperateComponent(Object component)</span><br><span class="line">        &#123;</span><br><span class="line">            if (Event.current.button == 0)</span><br><span class="line">            &#123;</span><br><span class="line">                if (!Application.isPlaying)</span><br><span class="line">                &#123;</span><br><span class="line">                    if (IsCollected(runtimeComponents, component))</span><br><span class="line">                    &#123;</span><br><span class="line">                        DeleteObject(runtimeComponents, component);</span><br><span class="line">                    &#125;</span><br><span class="line">                    else</span><br><span class="line">                    &#123;</span><br><span class="line">                        AddObject(runtimeComponents, component);</span><br><span class="line">                    &#125;</span><br><span class="line">                            </span><br><span class="line">                    EditorApplication.ExecuteMenuItem(&quot;Window/General/Hierarchy&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            else if (Event.current.button == 1)</span><br><span class="line">            &#123;</span><br><span class="line">                if (IsCollected(runtimeComponents, component))</span><br><span class="line">                &#123;</span><br><span class="line">                    FindReferences(runtimeComponents, component);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        bool IsCollected(UIRuntimeComponents runtimeComponents, Object component)</span><br><span class="line">        &#123;</span><br><span class="line">            if (runtimeComponents.m_objects==null)</span><br><span class="line">            &#123;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line">            int len = runtimeComponents.m_objects.Length;</span><br><span class="line">            for (int i = 0; i &lt; len; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                if (runtimeComponents.m_objects[i] == component)</span><br><span class="line">                &#123;</span><br><span class="line">                    return true;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        void AddObject(UIRuntimeComponents runtimeComponents, Object component)</span><br><span class="line">        &#123;</span><br><span class="line">            if (runtimeComponents.m_objects==null)</span><br><span class="line">            &#123;</span><br><span class="line">                runtimeComponents.m_objects = new Object[0];</span><br><span class="line">            &#125;</span><br><span class="line">            int len = runtimeComponents.m_objects.Length;</span><br><span class="line">            for (int i = 0; i &lt; len; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                if (runtimeComponents.m_objects[i] == component)</span><br><span class="line">                &#123;</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            var list = runtimeComponents.m_objects.ToList();</span><br><span class="line">            list.Add(component);</span><br><span class="line">            runtimeComponents.m_objects = list.ToArray();</span><br><span class="line">            SavePrefab(runtimeComponents);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        void DeleteObject(UIRuntimeComponents runtimeComponents, Object component)</span><br><span class="line">        &#123;</span><br><span class="line">            var list = runtimeComponents.m_objects.ToList();</span><br><span class="line">            int len = list.Count;</span><br><span class="line">            for (int i = 0; i &lt; len; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                if (list[i] == component)</span><br><span class="line">                &#123;</span><br><span class="line">                    list.RemoveAt(i);</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            runtimeComponents.m_objects = list.ToArray();</span><br><span class="line">            if (runtimeComponents.m_objects.Length&lt;=0)</span><br><span class="line">            &#123;</span><br><span class="line">                runtimeComponents.m_objects = null;</span><br><span class="line">            &#125;</span><br><span class="line">            SavePrefab(runtimeComponents);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        void FindReferences(UIRuntimeComponents runtimeComponents, Object component)</span><br><span class="line">        &#123;</span><br><span class="line">            EditorGUIUtility.PingObject(runtimeComponents.gameObject);</span><br><span class="line">            Selection.objects = new Object[] &#123;runtimeComponents.gameObject&#125;;</span><br><span class="line"></span><br><span class="line">            var len = runtimeComponents.m_objects.Length;</span><br><span class="line">            for (int i = 0; i &lt; len; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                if (component == runtimeComponents.m_objects[i])</span><br><span class="line">                &#123;</span><br><span class="line">                    runtimeComponents.focusIndex = i;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        UIRuntimeComponents FindUIRuntimeComponents(Transform transform)</span><br><span class="line">        &#123;</span><br><span class="line">            if (transform == null)</span><br><span class="line">                return null;</span><br><span class="line"></span><br><span class="line">            var runtimeComponents = transform.GetComponent&lt;UIRuntimeComponents&gt;();</span><br><span class="line">            if (runtimeComponents != null)</span><br><span class="line">                return runtimeComponents;</span><br><span class="line"></span><br><span class="line">            return FindUIRuntimeComponents(transform.parent);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        void SavePrefab(UIRuntimeComponents runtime)</span><br><span class="line">        &#123;</span><br><span class="line">            if (runtime == null)</span><br><span class="line">            &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            GameObject save_go = runtime.gameObject;</span><br><span class="line">            var assetType = PrefabUtility.GetPrefabAssetType(runtime.gameObject);</span><br><span class="line">            if (assetType == PrefabAssetType.Regular) //å¦‚æœæ˜¯é¢„åˆ¶ä½“çš„ä¸€éƒ¨åˆ†</span><br><span class="line">            &#123;</span><br><span class="line">                save_go = PrefabUtility.GetOutermostPrefabInstanceRoot(runtime.gameObject);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (EditorUtility.IsPersistent(save_go))</span><br><span class="line">            &#123;</span><br><span class="line">                EditorUtility.SetDirty(save_go);</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                string path =</span><br><span class="line">                    AssetDatabase.GetAssetPath(PrefabUtility.GetCorrespondingObjectFromOriginalSource(save_go));</span><br><span class="line">                if (string.IsNullOrEmpty(path))</span><br><span class="line">                &#123;</span><br><span class="line">                    EditorUtility.SetDirty(save_go);</span><br><span class="line">                &#125;</span><br><span class="line">                else</span><br><span class="line">                &#123;</span><br><span class="line">                    PrefabUtility.SaveAsPrefabAssetAndConnect(save_go, path, InteractionMode.UserAction);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1>UnityEditorä¸‹çš„åŠ è½½å¼¹çª—æˆ–è€…å¼¹çª—</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">private static void ShowProgress(float progress, int total, int current)</span><br><span class="line">&#123;</span><br><span class="line">    EditorUtility.DisplayProgressBar(&quot;Searching&quot;,</span><br><span class="line">        string.Format(&quot;Checking (&#123;0&#125;/&#123;1&#125;), please wait...&quot;, current, total), progress);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EditorUtility.DisplayDialog( &quot;&quot;, &quot;Board64ä¸­ä¸å­˜åœ¨å¯¹Board100çš„ä¾èµ–&quot;, &quot;OK&quot; );</span><br></pre></td></tr></table></figure><h1>èµ„æºå¯¼å…¥ç®¡çº¿å¤„ç†</h1><h1>å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://blog.csdn.net/yx314636922/article/details/126872839">https://blog.csdn.net/yx314636922/article/details/126872839</a></li><li><a href="https://blog.csdn.net/angry_youth/article/details/117469722">https://blog.csdn.net/angry_youth/article/details/117469722</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;æ‹“å±•UnityInspectorçª—å£&lt;/h1&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span clas</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ä¹Œåˆä¹‹ä¼—</title>
    <link href="https://soincredible.github.io/posts/2ecb1e55/"/>
    <id>https://soincredible.github.io/posts/2ecb1e55/</id>
    <published>2025-04-09T12:00:31.000Z</published>
    <updated>2025-04-27T01:30:44.578Z</updated>
    
    <content type="html"><![CDATA[<h1>åº</h1><p>æˆ‘å‘ç°ï¼Œç¤¾ä¼šç»„ç»‡å°±åƒäººä½“ç»“æ„ä¸€æ ·å¤æ‚ï¼Œæˆ‘ä»¬å®Œå…¨æ— æ³•è®©å®ƒä»¬çªç„¶ç»å—æ·±åˆ»çš„å˜åŒ–ã€‚å¤§è‡ªç„¶æœ‰æ—¶æ˜¯éå¸¸æç«¯çš„ï¼Œä½†å†³ä¸åƒæˆ‘ä»¬æ‰€ç†è§£çš„é‚£æ ·ã€‚æ‰€ä»¥ï¼Œå¯¹ä¸€ä¸ªæ°‘æ—æ¥è¯´ï¼Œè¿·æ‹å¤§å˜é©æ˜¯æœ€å¯æ€•çš„äº‹æƒ…ä¹‹ä¸€ã€‚ä¸ç®¡è¿™ç§å˜é©åœ¨ç†è®ºä¸Šæ˜¾å¾—å¦‚ä½•ä¼Ÿå¤§ï¼Œåªæœ‰å½“å®ƒèƒ½ç«‹å³æ”¹å˜æ°‘æ—çš„æ·±å±‚å¿ƒç†æ—¶ï¼Œå®ƒæ‰æ˜¯æœ‰ç”¨çš„ã€‚ç„¶è€Œï¼Œåªæœ‰æ—¶é—´æ‹¥æœ‰è¿™ç§åŠ›é‡ã€‚æ”¯é…äººç±»çš„ï¼Œæ˜¯æ€æƒ³ã€æ„Ÿæƒ…å’Œä¹ ä¿—ï¼Œæ˜¯å­˜åœ¨äºæˆ‘ä»¬è‡ªèº«çš„ä¸œè¥¿ã€‚åˆ¶åº¦å’Œæ³•å¾‹æ˜¯äººä»¬å†…å¿ƒç²¾ç¥çš„è¡¨ç°å½¢å¼ï¼Œåæ˜ äº†å®ƒçš„éœ€è¦ï¼Œæ—¢ç„¶æ˜¯äººä»¬çš„å†…å¿ƒç²¾ç¥è¯ç”Ÿäº†åˆ¶åº¦å’Œæ³•å¾‹ï¼Œåˆ¶åº¦å’Œæ³•å¾‹è‡ªç„¶å°±æ— æ³•æ”¹å˜å®ƒã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;åº&lt;/h1&gt;
&lt;p&gt;æˆ‘å‘ç°ï¼Œç¤¾ä¼šç»„ç»‡å°±åƒäººä½“ç»“æ„ä¸€æ ·å¤æ‚ï¼Œæˆ‘ä»¬å®Œå…¨æ— æ³•è®©å®ƒä»¬çªç„¶ç»å—æ·±åˆ»çš„å˜åŒ–ã€‚å¤§è‡ªç„¶æœ‰æ—¶æ˜¯éå¸¸æç«¯çš„ï¼Œä½†å†³ä¸åƒæˆ‘ä»¬æ‰€ç†è§£çš„é‚£æ ·ã€‚æ‰€ä»¥ï¼Œå¯¹ä¸€ä¸ªæ°‘æ—æ¥è¯´ï¼Œè¿·æ‹å¤§å˜é©æ˜¯æœ€å¯æ€•çš„äº‹æƒ…ä¹‹ä¸€ã€‚ä¸ç®¡è¿™ç§å˜é©åœ¨ç†è®ºä¸Šæ˜¾å¾—å¦‚ä½•ä¼Ÿå¤§ï¼Œåªæœ‰å½“å®ƒèƒ½ç«‹å³æ”¹å˜æ°‘æ—çš„æ·±å±‚å¿ƒç†æ—¶ï¼Œå®ƒæ‰</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ETä¸­çš„ç½‘ç»œé€šä¿¡æ¨¡å—</title>
    <link href="https://soincredible.github.io/posts/3613bb98/"/>
    <id>https://soincredible.github.io/posts/3613bb98/</id>
    <published>2025-04-02T10:14:58.000Z</published>
    <updated>2025-05-22T01:30:50.986Z</updated>
    
    <content type="html"><![CDATA[<p>ETæ¡†æ¶ä¸­çš„åè®®å¯ä»¥åˆ†æˆä¸‰ç§ç±»å‹:</p><ul><li>å®¢æˆ·ç«¯å†…éƒ¨çš„é€šè®¯åè®®</li><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šè®¯åè®®</li><li>æœåŠ¡å™¨å†…éƒ¨çš„é€šè®¯åè®®</li></ul><p>Realm Session<br>Router Session<br>Gate Session</p><p>é€šè¿‡RootèŠ‚ç‚¹ä¸Šçš„RouterAddressComponentç»„ä»¶å¯ä»¥è·å¾—æœåŠ¡å™¨çš„åœ°å€, å¹¶å°†è¿™ä¸ªåœ°å€ç»™åˆ°Session</p><p><a href="https://blog.csdn.net/u011041241/article/details/109574509">å†…ç½‘å’Œå¤–ç½‘ä¹‹é—´çš„é€šä¿¡ï¼ˆç«¯å£æ˜ å°„åŸç†ï¼‰</a><br><a href="https://luyuhuang.tech/2020/12/09/kcp.html">KCPåè®®è¯¦è§£</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ETæ¡†æ¶ä¸­çš„åè®®å¯ä»¥åˆ†æˆä¸‰ç§ç±»å‹:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®¢æˆ·ç«¯å†…éƒ¨çš„é€šè®¯åè®®&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šè®¯åè®®&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨å†…éƒ¨çš„é€šè®¯åè®®&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Realm Session&lt;br&gt;
Router Session&lt;br&gt;
</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ETæ¡†æ¶è‡ªåŠ¨ç”Ÿæˆè„šæœ¬</title>
    <link href="https://soincredible.github.io/posts/ef16867e/"/>
    <id>https://soincredible.github.io/posts/ef16867e/</id>
    <published>2025-03-28T11:09:03.000Z</published>
    <updated>2025-04-17T05:42:38.016Z</updated>
    
    <content type="html"><![CDATA[<p>ETæ¡†æ¶ä»“åº“ä¸‹å…¶å®æ˜¯æœ‰ä¸¤ä¸ªå·¥ç¨‹çš„ï¼Œè™½ç„¶è¿™ä¸¤ä¸ªå·¥ç¨‹é‡Œé¢çš„è„šæœ¬æœ‰å¯èƒ½æ˜¯ç”¨çš„åŒä¸€ä»½</p><p>åœ¨Shareè¿™ä¸ªæ¨¡å—ä¸­<code>ETSystemGenerator.cs</code>è¿™ä¸ªè„šæœ¬é‡Œé¢ï¼</p><blockquote><p>é—®é¢˜ è¿™äº›ä»£ç è‡ªåŠ¨ç”Ÿæˆçš„æ—¶æœºæ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿ</p></blockquote><p>ç¼–è¯‘çš„æ—¶å€™è‡ªåŠ¨ç”Ÿæˆï¼Œæ— éœ€å¼€å‘è€…æ‰‹åŠ¨ç®¡ç†ETSystemGeneratorè¿™ä¸ªç±»å®ç°äº†ISourceGeneratoræ¥å£ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨Unityä¸­è‡ªåŠ¨ç”Ÿæˆè„šæœ¬çš„åŠŸèƒ½æ˜¯æ˜¯é€šè¿‡dllæ’ä»¶çš„æ–¹å¼æ¥å…¥è¿›æ¥çš„ï¼Œè¿˜å¾—çœ‹ä¸€ä¸‹æ€ä¹ˆå¯¼å‡ºdllï¼Œå¦‚æœå¯¹SourceGeneratorçš„æºç æœ‰ä¿®æ”¹ï¼Œéœ€è¦é‡æ–°å¯¼å…¥dllåˆ°Unityä¸­</p><h1>GeneratorExecutionContext</h1>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ETæ¡†æ¶ä»“åº“ä¸‹å…¶å®æ˜¯æœ‰ä¸¤ä¸ªå·¥ç¨‹çš„ï¼Œè™½ç„¶è¿™ä¸¤ä¸ªå·¥ç¨‹é‡Œé¢çš„è„šæœ¬æœ‰å¯èƒ½æ˜¯ç”¨çš„åŒä¸€ä»½&lt;/p&gt;
&lt;p&gt;åœ¨Shareè¿™ä¸ªæ¨¡å—ä¸­&lt;code&gt;ETSystemGenerator.cs&lt;/code&gt;è¿™ä¸ªè„šæœ¬é‡Œé¢ï¼&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é—®é¢˜ è¿™äº›ä»£ç è‡ªåŠ¨ç”Ÿæˆçš„æ—¶æœºæ˜¯ä»€ä¹ˆæ—¶å€™</summary>
      
    
    
    
    
  </entry>
  
</feed>
