<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>EddieLee</title>
  
  <subtitle>to infinity and beyondâœ¨ğŸ›¸.</subtitle>
  <link href="https://soincredible.github.io/atom.xml" rel="self"/>
  
  <link href="https://soincredible.github.io/"/>
  <updated>2025-05-08T03:00:00.545Z</updated>
  <id>https://soincredible.github.io/</id>
  
  <author>
    <name>Eddie Lee</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Dissecting the async methods in CSharp</title>
    <link href="https://soincredible.github.io/posts/72dba58e/"/>
    <id>https://soincredible.github.io/posts/72dba58e/</id>
    <published>2025-05-07T12:44:20.000Z</published>
    <updated>2025-05-08T03:00:00.545Z</updated>
    
    <content type="html"><![CDATA[<h1>å…³äºå¼‚æ­¥çš„å†å²</h1><p>C#å¼€å‘è€…åœ¨ç¬¬ä¸€æ¬¡æ¥è§¦å¼‚æ­¥çš„æ¦‚å¿µ, åº”è¯¥æ˜¯é€šè¿‡Taskç±»å‹. Taskæ˜¯åœ¨<code>.Net 4.0</code>çš„æ—¶å€™è¢«å¼•å…¥çš„. ä¸€ä¸ªtaskå°±æ˜¯ä¸€ä¸ªworkå•å…ƒ, ä¸”è¯¥taskæ‰¿è¯º, åœ¨è¿™ä¸ªtaskæœªæ¥å®Œæˆçš„æ—¶å€™, ä¼šå°†ç»“æœè¿”å›ç»™taskçš„è°ƒç”¨è€…. è¿™ä¸ªTaskå¯èƒ½æ˜¯ç”±IOæ“ä½œæ”¯æŒæˆ–è€…è®¡ç®—å¯†é›†å‹æ“ä½œ(è¿™æ­£å¥½å¯¹åº”äº†ç¬”è€…åœ¨åç¨‹éƒ¨åˆ†æ‰€è¯´çš„CPUå¯†é›†å‹æ“ä½œå’ŒIOå‹æ“ä½œ, Unityåç¨‹åªèƒ½ç”¨æ¥åšIOå‹çš„å¼‚æ­¥æ“ä½œ). é‡è¦çš„æ˜¯è¯¥æ“ä½œçš„ç»“æœæ˜¯è‡ªåŒ…å«çš„ï¼Œä¸”å…·æœ‰ä¸€ç­‰å…¬æ°‘èº«ä»½ã€‚ä½ å¯ä»¥è‡ªç”±ä¼ é€’è¿™ä¸ª&quot;æœªæ¥&quot;ï¼šå°†å…¶å­˜å‚¨åœ¨å˜é‡ä¸­ã€ä»æ–¹æ³•è¿”å›å®ƒã€æˆ–ä¼ é€’ç»™å…¶ä»–æ–¹æ³•ã€‚ä½ å¯ä»¥å°†ä¸¤ä¸ª&quot;æœªæ¥&quot;åˆå¹¶å½¢æˆæ–°çš„ä»»åŠ¡ï¼Œå¯ä»¥åŒæ­¥ç­‰å¾…ç»“æœï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ·»åŠ &quot;å»¶ç»­&quot;æ¥&quot;ç­‰å¾…&quot;ç»“æœã€‚ä»…å‡­ä»»åŠ¡å®ä¾‹æœ¬èº«ï¼Œä½ å°±èƒ½å†³å®šåœ¨æ“ä½œæˆåŠŸã€å¤±è´¥æˆ–è¢«å–æ¶ˆæ—¶é‡‡å–ä½•ç§å¤„ç†ã€‚</p><p>ä»»åŠ¡å¹¶è¡Œåº“ (TPL) æ”¹å˜äº†æˆ‘ä»¬å¯¹å¹¶å‘ç¼–ç¨‹çš„è®¤çŸ¥ï¼Œè€Œ C# 5 é€šè¿‡å¼•å…¥ async/await è¿›ä¸€æ­¥æ¨åŠ¨äº†è¿™ä¸€å‘å±•ã€‚async/await è®©ä»»åŠ¡çš„ç»„åˆå˜å¾—æ›´åŠ å®¹æ˜“ï¼Œå¹¶å…è®¸å¼€å‘è€…ä½¿ç”¨ç†Ÿæ‚‰çš„ä»£ç ç»“æ„ï¼Œå¦‚ try/catchã€using ç­‰ã€‚ä½†æ˜¯async/awaitä¹Ÿæœ‰å…¶å¼€é”€. è¦ç†è§£å…·ä½“å¼€é”€æ˜¯ä»€ä¹ˆ, æˆ‘ä»¬éœ€è¦æ·±å…¥åº•å±‚æœºåˆ¶ä¸­.</p><h1>å¼‚æ­¥æ–¹æ³•å†…éƒ¨</h1><p>æ™®é€šæ–¹æ³•åªæœ‰ä¸€ä¸ªå…¥å£ç‚¹å’Œä¸€ä¸ªé€€å‡ºç‚¹ï¼ˆè™½ç„¶å¯èƒ½æœ‰å¤šä¸ª return è¯­å¥ï¼Œä½†åœ¨è¿è¡Œæ—¶ï¼Œæ¯æ¬¡è°ƒç”¨ä»…æœ‰ä¸€ä¸ªå®é™…é€€å‡ºç‚¹ï¼‰ã€‚ä½† å¼‚æ­¥æ–¹æ³•ï¼ˆ*ï¼‰ å’Œ è¿­ä»£å™¨æ–¹æ³•ï¼ˆåŒ…å« yield return çš„æ–¹æ³•ï¼‰åˆ™ä¸åŒã€‚å¯¹äºå¼‚æ­¥æ–¹æ³•è€Œè¨€ï¼Œè°ƒç”¨æ–¹å‡ ä¹å¯ä»¥ç«‹å³è·å–ç»“æœï¼ˆå³ Task æˆ– Task<T>ï¼‰ï¼Œç„¶åé€šè¿‡è¿”å›çš„ä»»åŠ¡ï¼ˆTaskï¼‰æ¥ â€œawaitâ€ æ–¹æ³•çš„å®é™…æ‰§è¡Œç»“æœã€‚</p><p>ï¼ˆ*ï¼‰æˆ‘ä»¬å®šä¹‰çš„ â€œå¼‚æ­¥æ–¹æ³•â€ æ˜¯æŒ‡ç”¨ async ä¸Šä¸‹æ–‡å…³é”®å­—æ ‡è®°çš„æ–¹æ³•ã€‚è¿™å¹¶ä¸ä¸€å®šæ„å‘³ç€è¯¥æ–¹æ³•ä¼šå¼‚æ­¥æ‰§è¡Œï¼Œç”šè‡³å®Œå…¨ä¸æ„å‘³ç€å®ƒæ˜¯å¼‚æ­¥çš„ã€‚å®ƒä»…è¡¨ç¤º ç¼–è¯‘å™¨ä¼šå¯¹è¯¥æ–¹æ³•è¿›è¡ŒæŸäº›ç‰¹æ®Šè½¬æ¢ã€‚</p><p>çœ‹ä¸€ä¸‹ä¸‹é¢è¿™ä¸ªå¼‚æ­¥æ–¹æ³•:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">class StockPrices</span><br><span class="line">&#123;</span><br><span class="line">    private Dictionary&lt;string, decimal&gt; _stockPrices;</span><br><span class="line">    // è¢«æ ‡è®°äº†asyncçš„æ–¹æ³•, Compilerä¼šåœ¨èƒŒåå°†å…¶å†…éƒ¨çš„é€»è¾‘è½¬è°ƒç”¨ä¸€ä¸ªçŠ¶æ€æœº</span><br><span class="line">    // è€Œè¿™ä¸ªå¼‚æ­¥æ–¹æ³•ä¸­åŸæ¥çš„é€»è¾‘ä¼šå…¨éƒ¨è½¬ç§»åˆ°Compilerè‡ªåŠ¨ç”Ÿæˆçš„çŠ¶æ€æœºçš„MoveNextæ–¹æ³•ä¸­ </span><br><span class="line">    public async Task&lt;decimal&gt; GetStockPriceForAsync(string companyId)</span><br><span class="line">    &#123;</span><br><span class="line">        await InitializeMapIfNeededAsync();</span><br><span class="line">        _stockPrices.TryGetValue(companyId, out var result);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    // è¢«æ ‡è®°äº†asyncçš„æ–¹æ³•, Compilerä¼šåœ¨èƒŒåå°†å…¶è½¬æ¢æˆçŠ¶æ€æœº</span><br><span class="line">    // è€Œè¿™ä¸ªå¼‚æ­¥æ–¹æ³•ä¸­åŸæ¥çš„é€»è¾‘ä¼šå…¨éƒ¨è½¬ç§»åˆ°Compilerè‡ªåŠ¨ç”Ÿæˆçš„çŠ¶æ€æœºçš„MoveNextæ–¹æ³•ä¸­ </span><br><span class="line">    private async Task InitializeMapIfNeededAsync()</span><br><span class="line">    &#123;</span><br><span class="line">        if (_stockPrices != null)</span><br><span class="line">            return;</span><br><span class="line"> </span><br><span class="line">        await Task.Delay(42);</span><br><span class="line">        // Getting the stock prices from the external source and cache in memory.</span><br><span class="line">        _stockPrices = new Dictionary&lt;string, decimal&gt; &#123; &#123; &quot;MSFT&quot;, 42 &#125; &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†æ›´å¥½çš„ç†è§£ç¼–è¯‘å™¨åšäº†æˆ–è€…èƒ½åšä»€ä¹ˆ, è®©æˆ‘ä»¬å°è¯•ç€æ‰‹å†™ä¸€ä¸‹è½¬æ¢è¿‡ç¨‹</p><h1>æ‰‹åŠ¨è§£æ„å¼‚æ­¥æ–¹æ³•</h1><p>TPLï¼ˆä»»åŠ¡å¹¶è¡Œåº“ï¼‰æä¾›äº†ä¸¤å¤§æ ¸å¿ƒæ„å»ºæ¨¡å—ï¼Œå¸®åŠ©æˆ‘ä»¬æ„é€ å’Œç»„åˆä»»åŠ¡ï¼š</p><ul><li>ä»»åŠ¡å»¶ç»­ï¼ˆTask Continuationï¼‰-&gt; é€šè¿‡ <code>Task.ContinueWith</code>å®ç°</li><li>æ‰‹åŠ¨æ„å»ºä»»åŠ¡ -&gt; é€šè¿‡ <code>TaskCompletionSource&lt;T&gt;</code> ç±»å®ç°<br>ï¼ˆæ³¨ï¼šå‰è€…ç”¨äºé“¾å¼ç¼–æ’ä»»åŠ¡ï¼Œåè€…ç”¨äºæ‰‹åŠ¨æ§åˆ¶ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸã€‚ï¼‰</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">class GetStockPriceForAsync_StateMachine</span><br><span class="line">&#123;</span><br><span class="line">    enum State &#123; Start, Step1, &#125;</span><br><span class="line">    private readonly StockPrices @this;</span><br><span class="line">    private readonly string _companyId;</span><br><span class="line">    private readonly TaskCompletionSource&lt;decimal&gt; _tcs;</span><br><span class="line">    private Task _initializeMapIfNeededTask;</span><br><span class="line">    private State _state = State.Start;</span><br><span class="line"> </span><br><span class="line">    public GetStockPriceForAsync_StateMachine(StockPrices @this, string companyId)</span><br><span class="line">    &#123;</span><br><span class="line">        this.@this = @this;</span><br><span class="line">        _companyId = companyId;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public void Start()</span><br><span class="line">    &#123;</span><br><span class="line">        try</span><br><span class="line">        &#123;</span><br><span class="line">            if (_state == State.Start)</span><br><span class="line">            &#123;</span><br><span class="line">                // The code from the start of the method to the first &#x27;await&#x27;.</span><br><span class="line"> </span><br><span class="line">                if (string.IsNullOrEmpty(_companyId))</span><br><span class="line">                    throw new ArgumentNullException();</span><br><span class="line"> </span><br><span class="line">                _initializeMapIfNeededTask = @this.InitializeMapIfNeeded();</span><br><span class="line"> </span><br><span class="line">                // Update state and schedule continuation</span><br><span class="line">                _state = State.Step1;</span><br><span class="line">                _initializeMapIfNeededTask.ContinueWith(_ =&gt; Start());</span><br><span class="line">            &#125;</span><br><span class="line">            else if (_state == State.Step1)</span><br><span class="line">            &#123;</span><br><span class="line">                // Need to check the error and the cancel case first</span><br><span class="line">                if (_initializeMapIfNeededTask.Status == TaskStatus.Canceled)</span><br><span class="line">                    _tcs.SetCanceled();</span><br><span class="line">                else if (_initializeMapIfNeededTask.Status == TaskStatus.Faulted)</span><br><span class="line">                    _tcs.SetException(_initializeMapIfNeededTask.Exception.InnerException);</span><br><span class="line">                else</span><br><span class="line">                &#123;</span><br><span class="line">                    // The code between first await and the rest of the method</span><br><span class="line"> </span><br><span class="line">                    @this._store.TryGetValue(_companyId, out var result);</span><br><span class="line">                    _tcs.SetResult(result);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        catch (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            _tcs.SetException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public Task&lt;decimal&gt; Task =&gt; _tcs.Task;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">public Task&lt;decimal&gt; GetStockPriceForAsync(string companyId)</span><br><span class="line">&#123;</span><br><span class="line">    var stateMachine = new GetStockPriceForAsync_StateMachine(this, companyId);</span><br><span class="line">    stateMachine.Start();</span><br><span class="line">    return stateMachine.Task;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç è™½ç„¶å†—é•¿ï¼Œä½†é€»è¾‘ç›¸å¯¹ç›´æ¥ã€‚åŸå…ˆåœ¨ GetStockPriceForAsync ä¸­çš„æ‰€æœ‰é€»è¾‘éƒ½è¢«è½¬ç§»åˆ°äº† GetStockPriceForAsync_StateMachine.Start æ–¹æ³•ä¸­ï¼Œè¯¥æ–¹æ³•é‡‡ç”¨äº†&quot;å»¶ç»­ä¼ é€’é£æ ¼&quot;(continuation passing style)ã€‚å¼‚æ­¥è½¬æ¢çš„æ ¸å¿ƒç®—æ³•å°±æ˜¯å°†åŸå§‹æ–¹æ³•åœ¨ await è¾¹ç•Œå¤„åˆ†å‰²æˆè‹¥å¹²ä»£ç å—ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªä»£ç å—ï¼šä»æ–¹æ³•å¼€å§‹åˆ°ç¬¬ä¸€ä¸ª await ä¹‹é—´çš„ä»£ç </li><li>ç¬¬äºŒä¸ªä»£ç å—ï¼šä»ç¬¬ä¸€ä¸ª await åˆ°ç¬¬äºŒä¸ª await ä¹‹é—´çš„ä»£ç </li><li>ç¬¬ä¸‰ä¸ªä»£ç å—ï¼šä»ç¬¬äºŒä¸ª await åˆ°ç¬¬ä¸‰ä¸ª await æˆ–æ–¹æ³•ç»“æŸçš„ä»£ç  ä»¥æ­¤ç±»æ¨</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// Step 1 of the generated state machine:</span><br><span class="line"> </span><br><span class="line">if (string.IsNullOrEmpty(_companyId)) throw new ArgumentNullException();</span><br><span class="line">_initializeMapIfNeededTask = @this.InitializeMapIfNeeded();</span><br></pre></td></tr></table></figure><p>æ¯ä¸ªè¢« await çš„ä»»åŠ¡ç°åœ¨éƒ½å˜æˆäº†çŠ¶æ€æœºçš„ä¸€ä¸ªå­—æ®µï¼Œè€Œ Start æ–¹æ³•ä¼šå°†è‡ªå·±æ³¨å†Œä¸ºè¿™äº›ä»»åŠ¡çš„å»¶ç»­ï¼ˆcontinuationï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_state = State.Step1;</span><br><span class="line">_initializeMapIfNeededTask.ContinueWith(_ =&gt; Start());</span><br></pre></td></tr></table></figure><p>éšåï¼Œå½“ä»»åŠ¡å®Œæˆæ—¶ï¼ŒStartæ–¹æ³•ä¼šè¢«å›è°ƒï¼Œå¹¶é€šè¿‡æ£€æŸ¥_stateå­—æ®µæ¥ç¡®å®šå½“å‰æ‰§è¡Œé˜¶æ®µã€‚æ¥ç€ï¼ŒçŠ¶æ€æœºä¼šåˆ¤æ–­ä»»åŠ¡æ˜¯æˆåŠŸå®Œæˆã€è¢«å–æ¶ˆè¿˜æ˜¯å‡ºç°å¼‚å¸¸ã€‚å¦‚æœæ˜¯æˆåŠŸå®Œæˆçš„æƒ…å†µï¼ŒçŠ¶æ€æœºå°±ä¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªä»£ç å—ã€‚å½“æ‰€æœ‰æ“ä½œéƒ½å®Œæˆåï¼ŒçŠ¶æ€æœºä¼šè®¾ç½®TaskCompletionSource<T>å®ä¾‹çš„ç»“æœå€¼ï¼Œæ­¤æ—¶ä»GetStockPricesForAsyncè¿”å›çš„ä»»åŠ¡çŠ¶æ€å°±ä¼šå˜æ›´ä¸ºå·²å®Œæˆã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// The code between first await and the rest of the method</span><br><span class="line"> </span><br><span class="line">@this._stockPrices.TryGetValue(_companyId, out var result);</span><br><span class="line">_tcs.SetResult(result); // The caller gets the result back</span><br></pre></td></tr></table></figure><p>è¿™ç§&quot;å®ç°æ–¹å¼&quot;å­˜åœ¨å‡ ä¸ªä¸¥é‡ç¼ºé™·ï¼š</p><ul><li>å¤§é‡å †å†…å­˜åˆ†é…ï¼š<ul><li>çŠ¶æ€æœºå®ä¾‹éœ€è¦1æ¬¡å†…å­˜åˆ†é…</li><li>TaskCompletionSource<T>éœ€è¦1æ¬¡åˆ†é…</li><li>TaskCompletionSource<T>å†…éƒ¨ä»»åŠ¡éœ€è¦1æ¬¡åˆ†é…, æŒ‰ç…§GPTçš„è¯´æ³•<code>TaskCompletionSource&lt;decimal&gt;</code>å†…éƒ¨ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª<code>Task&lt;decimal&gt;</code> å®ä¾‹ï¼ˆé€šè¿‡å…¶ .Task å±æ€§è®¿é—®ï¼‰</li><li>å»¶ç»­å§”æ‰˜(delegate)éœ€è¦1æ¬¡åˆ†é…, æŒ‡çš„åº”è¯¥æ˜¯<code> _initializeMapIfNeededTask.ContinueWith(_ =&gt; Start());</code></li></ul></li><li>ç¼ºå°‘&quot;çƒ­è·¯å¾„ä¼˜åŒ–&quot;ï¼š<br>å½“è¢«ç­‰å¾…çš„ä»»åŠ¡å·²ç»å®Œæˆæ—¶ï¼Œå®Œå…¨æ²¡æœ‰å¿…è¦åˆ›å»ºå»¶ç»­å§”æ‰˜</li><li>å¯æ‰©å±•æ€§ä¸è¶³ï¼š<br>å®ç°ä¸Taskç±»ç´§å¯†è€¦åˆï¼Œå¯¼è‡´æ— æ³•ç”¨äºå…¶ä»–åœºæ™¯ï¼Œä¾‹å¦‚ï¼š<ul><li>ç­‰å¾…éTaskç±»å‹</li><li>è¿”å›éTask/Task<T>ç±»å‹</li></ul></li></ul><p>ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹ä¸€ä¸‹ä¸Šè¿°æåˆ°çš„ç¼ºé™·åœ¨çœŸæ­£çš„å¼‚æ­¥æœºåˆ¶ä¸­æ˜¯å¦‚ä½•è¢«è§£å†³çš„.</p><h1>å¼‚æ­¥æœºåˆ¶</h1><p>ç¼–è¯‘å™¨æ‰§è¡Œå¼‚æ­¥æ–¹æ³•è½¬æ¢çš„æ•´ä¸ªè¿‡ç¨‹, å…¶å®å·²ç»å’Œä¸Šé¢æˆ‘ä»¬æ‰‹åŠ¨å®ç°çš„æ–¹å¼ååˆ†æ¥è¿‘äº†. ä¸ºäº†å¾—åˆ°é¢„æœŸçš„è¡Œä¸º, ç¼–è¯‘å™¨ä¾èµ–äºä»¥ä¸‹çš„ç±»å‹:</p><ul><li>å¯¹äºä¸€ä¸ªå¼‚æ­¥æ–¹æ³•çš„ç”Ÿæˆçš„çŠ¶æ€æœº, å…¶è¡Œä¸ºä¼šåƒæ ˆå¸§ä¸€æ ·, å¹¶ä¸”è¯¥çŠ¶æ€æœºåŒ…å«åŸå§‹å¼‚æ­¥æ–¹æ³•ä¸­çš„å…¨éƒ¨é€»è¾‘</li><li><code>AsyncTaskMethodBuilder&lt;T&gt;</code>æŒæœ‰å®Œæˆçš„taskï¼ˆä¸ TaskCompletionSource<T> ç±»å‹éå¸¸ç›¸ä¼¼ï¼‰, å¹¶ä¸”ç®¡ç†çŠ¶æ€æœºçš„è½¬æ¢.</li><li><code>TaskAwaiter&lt;T&gt;</code>è´Ÿè´£åŒ…è£…task, å¹¶åœ¨éœ€è¦æ—¶è°ƒåº¦å…¶å»¶ç»­</li><li><code>MoveNetRunner</code>è´Ÿè´£åœ¨æ­£ç¡®çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­è°ƒç”¨<code>IAsyncStateMachine.MoveNext</code>æ–¹æ³•</li></ul><p>ç”Ÿæˆçš„çŠ¶æ€æœºåœ¨Debugæ¨¡å¼ä¸‹æ˜¯ä¸€ä¸ªç±», åœ¨Releaseæ¨¡å¼ä¸‹åˆ™æ˜¯ä¸€ä¸ªstruct. å…¶ä»–çš„ç±»å‹(é™¤äº†<code>MoveNextRunner</code>ç±»)åœ¨BCLä¸­å‡è¢«å®šä¹‰ä¸ºäº†struct.</p><p>ç¼–è¯‘å™¨ç”Ÿæˆçš„çŠ¶æ€æœºç±»å‹åç§°é€šå¸¸ç±»ä¼¼äº<code>&lt;YourMethodNameAsync&gt;d_1</code>, ä¸ºäº†é¿å…åç§°å†²çª, ç”Ÿæˆçš„åå­—ä¸­åŒ…å«äº†ä¸€äº›æ— æ•ˆçš„æ ‡è¯†ç¬¦å­—ç¬¦, è¿™äº›å­—ç¬¦æ— æ³•è¢«ç”¨æˆ·ç›´æ¥å®šä¹‰æˆ–å¼•ç”¨. ä½†æ˜¯ä¸ºäº†ç®€åŒ–è¯´æ˜, åœ¨åç»­çš„æ‰€æœ‰ç¤ºä¾‹ä¸­, æˆ‘ä»¬è¿˜æ˜¯å°†ä½¿ç”¨æœ‰æ•ˆçš„æ ‡è¯†ç¬¦æ¥æ›¿æ¢æ‰<code>&lt;</code>ã€<code>&gt;</code>ã€<code>_</code>è¿™äº›å­—ç¬¦, å¹¶ä¸”ä½¿ç”¨æ›´å®¹æ˜“ç†è§£çš„åå­—.</p><h1>åŸå§‹æ–¹æ³•</h1><p>åŸå§‹çš„å¼‚æ­¥æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªçŠ¶æ€æœºå®ä¾‹, ç”¨æ•è·çš„çŠ¶æ€ï¼ˆå¦‚æœæ–¹æ³•éé™æ€ï¼Œåˆ™åŒ…æ‹¬ this æŒ‡é’ˆï¼‰åˆå§‹åŒ–è¯¥å®ä¾‹, é€šè¿‡ä¼ é€’çŠ¶æ€æœºå®ä¾‹çš„å¼•ç”¨å¹¶è°ƒç”¨<code>AsyncTaskMethodBuilder&lt;T&gt;.Start</code>æ¥å¯åŠ¨æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[AsyncStateMachine(typeof(_GetStockPriceForAsync_d__1))]</span><br><span class="line">public Task&lt;decimal&gt; GetStockPriceFor(string companyId)</span><br><span class="line">&#123;</span><br><span class="line">    _GetStockPriceForAsync_d__1 _GetStockPriceFor_d__;</span><br><span class="line">    _GetStockPriceFor_d__.__this = this;</span><br><span class="line">    _GetStockPriceFor_d__.companyId = companyId;</span><br><span class="line">    _GetStockPriceFor_d__.__builder = AsyncTaskMethodBuilder&lt;decimal&gt;.Create();</span><br><span class="line">    _GetStockPriceFor_d__.__state = -1;</span><br><span class="line">    var __t__builder = _GetStockPriceFor_d__.__builder;</span><br><span class="line">    __t__builder.Start&lt;_GetStockPriceForAsync_d__1&gt;(ref _GetStockPriceFor_d__);</span><br><span class="line">    return _GetStockPriceFor_d__.__builder.Task;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼ é€’å¼•ç”¨æ˜¯ä¸€ä¸ªé‡è¦çš„ä¼˜åŒ–, å› ä¸ºä¸€ä¸ªçŠ¶æ€æœºå¾€å¾€æ˜¯ç›¸å¯¹å¤§çš„ç»“æ„(å¤§äº100bytes), å› æ­¤ä¼ é€’å¼•ç”¨ä¼šé¿å…å†—ä½™æ‹·è´.<br>çŠ¶æ€æœºä»£ç å¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">struct _GetStockPriceForAsync_d__1 : IAsyncStateMachine</span><br><span class="line">&#123;</span><br><span class="line">    public StockPrices __this;</span><br><span class="line">    public string companyId;</span><br><span class="line">    public AsyncTaskMethodBuilder&lt;decimal&gt; __builder;</span><br><span class="line">    public int __state;</span><br><span class="line">    private TaskAwaiter __task1Awaiter;</span><br><span class="line"> </span><br><span class="line">    public void MoveNext()</span><br><span class="line">    &#123;</span><br><span class="line">        decimal result;</span><br><span class="line">        try</span><br><span class="line">        &#123;</span><br><span class="line">            TaskAwaiter awaiter;</span><br><span class="line">            if (__state != 0)</span><br><span class="line">            &#123;</span><br><span class="line">                // State 1 of the generated state machine:</span><br><span class="line">                if (string.IsNullOrEmpty(companyId))</span><br><span class="line">                    throw new ArgumentNullException();</span><br><span class="line"> </span><br><span class="line">                awaiter = __this.InitializeLocalStoreIfNeededAsync().GetAwaiter();</span><br><span class="line"> </span><br><span class="line">                // Hot path optimization: if the task is completed,</span><br><span class="line">                // the state machine automatically moves to the next step</span><br><span class="line">                if (!awaiter.IsCompleted)</span><br><span class="line">                &#123;</span><br><span class="line">                    __state = 0;</span><br><span class="line">                    __task1Awaiter = awaiter;</span><br><span class="line"> </span><br><span class="line">                    // The following call will eventually cause boxing of the state machine.</span><br><span class="line">                    __builder.AwaitUnsafeOnCompleted(ref awaiter, ref this);</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                awaiter = __task1Awaiter;</span><br><span class="line">                __task1Awaiter = default(TaskAwaiter);</span><br><span class="line">                __state = -1;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            // GetResult returns void, but it&#x27;ll throw if the awaited task failed.</span><br><span class="line">            // This exception is catched later and changes the resulting task.</span><br><span class="line">            awaiter.GetResult();</span><br><span class="line">            __this._stocks.TryGetValue(companyId, out result);</span><br><span class="line">        &#125;</span><br><span class="line">        catch (Exception exception)</span><br><span class="line">        &#123;</span><br><span class="line">            // Final state: failure</span><br><span class="line">            __state = -2;</span><br><span class="line">            __builder.SetException(exception);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        // Final state: success</span><br><span class="line">        __state = -2;</span><br><span class="line">        __builder.SetResult(result);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    void IAsyncStateMachine.SetStateMachine(IAsyncStateMachine stateMachine)</span><br><span class="line">    &#123;</span><br><span class="line">        __builder.SetStateMachine(stateMachine);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆçš„çŠ¶æ€æœºä»£ç çœ‹èµ·æ¥æ¯”è¾ƒå¤æ‚, ä½†æ˜¯æœ¬è´¨ä¸Š, å®ƒå’Œæˆ‘ä»¬æ‰‹å†™çš„é‚£ä¸€ç‰ˆçš„ä»£ç æ˜¯ååˆ†ç›¸ä¼¼çš„.<br>å³ä½¿ä¸¤ä¸ªç‰ˆæœ¬ååˆ†ç›¸ä¼¼, ä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€äº›é‡è¦çš„ä¸åŒçš„.</p><ol><li>â€œHot Pathâ€ ä¼˜åŒ–</li></ol><p>ä¸åƒæˆ‘ä»¬åŸç”Ÿçš„æ–¹å¼, ç”Ÿæˆçš„çŠ¶æ€æœºçŸ¥é“ä¸€ä¸ªè¢«awaitedçš„taskå¯èƒ½å·²ç»å®Œæˆäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">awaiter = __this.InitializeLocalStoreIfNeededAsync().GetAwaiter();</span><br><span class="line"> </span><br><span class="line">// Hot path optimization: if the task is completed,</span><br><span class="line">// the state machine automatically moves to the next step</span><br><span class="line">if (!awaiter.IsCompleted)</span><br><span class="line">&#123;</span><br><span class="line">    // Irrelevant stuff</span><br><span class="line"> </span><br><span class="line">    // The following call will eventually cause boxing of the state machine.</span><br><span class="line">    __builder.AwaitUnsafeOnCompleted(ref awaiter, ref this);</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿™ä¸ªè¢«awaitçš„taskå·²ç»å®Œæˆäº†(æ— è®ºæˆåŠŸä¸å¦), çŠ¶æ€æœºä¼šå‘å‰ç›´è¡Œä¸‹ä¸€æ­¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// GetResult returns void, but it&#x27;ll throw if the awaited task failed.</span><br><span class="line">// This exception is catched later and changes the resulting task.</span><br><span class="line">awaiter.GetResult();</span><br><span class="line">__this._stocks.TryGetValue(companyId, out result);</span><br></pre></td></tr></table></figure><p>è¿™å°±æ„å‘³ç€, å¦‚æœæ‰€æœ‰awaitedçš„taskéƒ½å·²ç»å®Œæˆäº†, æ•´ä¸ªçŠ¶æ€æœºå°†åªä¼šåœç•™åœ¨æ ˆä¸Š. ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ç”šè‡³åœ¨ä»Šå¤©å¦‚æœæ‰€æœ‰awaitedçš„taskéƒ½å·²ç»å®Œæˆæˆ–è€…åŒæ­¥å®Œæˆäº†, é‚£ä¹ˆè¿™ä¸ªå¼‚æ­¥æ–¹æ³•æ˜¯å¯ä»¥åªä¼šé€ æˆå¾ˆå°çš„å†…å­˜å¼€é”€çš„. ä»…å‰©çš„å¼€é”€åªæ˜¯è¿™ä¸ªtaskæœ¬èº«.</p><ol start="2"><li>é”™è¯¯å¤„ç†</li></ol><p>å½“å‰é€»è¾‘å¹¶æœªä¸“é—¨å¤„ç†ä»»åŠ¡å¤„äºæ•…éšœçŠ¶æ€æˆ–å·²å–æ¶ˆçŠ¶æ€çš„æƒ…å†µã€‚çŠ¶æ€æœºé€šè¿‡è°ƒç”¨awaiter.GetResult()æ–¹æ³•ï¼Œå½“ä»»åŠ¡è¢«å–æ¶ˆæ—¶å°†æŠ›å‡ºTaskCancelledExceptionï¼Œè‹¥ä»»åŠ¡å¤±è´¥åˆ™æŠ›å‡ºå…¶ä»–å¼‚å¸¸ã€‚è¿™ç§è®¾è®¡ååˆ†ä¼˜é›…ï¼Œå› ä¸ºGetResult()åœ¨é”™è¯¯å¤„ç†æœºåˆ¶ä¸Šä¸task.Wait()æˆ–task.Resultæœ‰æœ¬è´¨åŒºåˆ«ã€‚</p><p>æ— è®ºæ˜¯task.Wait()è¿˜æ˜¯task.Resultï¼Œå³ä¾¿ä»»åŠ¡å› å•ä¸€å¼‚å¸¸å¯¼è‡´å¤±è´¥ï¼Œå®ƒä»¬éƒ½ä¼šæŠ›å‡ºAggregateExceptionã€‚è¿™èƒŒåçš„é€»è¾‘å¾ˆç®€å•ï¼šä»»åŠ¡ä¸ä»…å¯èƒ½ä»£è¡¨é€šå¸¸åªæœ‰å•ä¸€æ•…éšœçš„IOæ“ä½œï¼Œä¹Ÿå¯èƒ½æ˜¯å¹¶è¡Œè®¡ç®—çš„ç»“æœã€‚åè€…å¯èƒ½äº§ç”Ÿå¤šä¸ªé”™è¯¯ï¼Œè€ŒAggregateExceptionæ­£æ˜¯ä¸ºèšåˆæ‰€æœ‰é”™è¯¯è€Œè®¾è®¡ã€‚</p><p>ä½†<code>async/await</code>æ¨¡å¼ä¸“ä¸ºå¼‚æ­¥æ“ä½œè®¾è®¡ï¼Œè¿™ç±»æ“ä½œé€šå¸¸æœ€å¤šåªä¼šäº§ç”Ÿä¸€ä¸ªé”™è¯¯ã€‚å› æ­¤è¯­è¨€è®¾è®¡è€…è®¤ä¸ºï¼Œè‹¥<code>awaiter.GetResult()</code>èƒ½å¯¹AggregateExceptionè¿›è¡Œè§£åŒ…å¹¶ä»…æŠ›å‡ºé¦–ä¸ªå¼‚å¸¸ï¼Œå°†æ›´ç¬¦åˆä½¿ç”¨åœºæ™¯ã€‚è¿™ä¸€è®¾è®¡å¹¶éå®Œç¾ï¼Œæˆ‘ä»¬å°†åœ¨åç»­æ–‡ç« ä¸­çœ‹åˆ°è¿™ç§æŠ½è±¡æ–¹æ¡ˆå¯èƒ½å­˜åœ¨çš„æ¼æ´ã€‚</p><p>å¼‚æ­¥çŠ¶æ€æœºåªæ˜¯æ•´ä¸ªæ‹¼å›¾çš„ä¸€éƒ¨åˆ†ã€‚è¦å®Œæ•´ç†è§£å…¶è¿ä½œæœºåˆ¶ï¼Œæˆ‘ä»¬è¿˜éœ€äº†è§£çŠ¶æ€æœºå®ä¾‹å¦‚ä½•ä¸<code>TaskAwaiter&lt;T&gt;</code>å’Œ<code>AsyncTaskMethodBuilder&lt;T&gt;</code>è¿›è¡Œäº¤äº’ã€‚</p><h1>è¿™äº›æ¨¡å—æ˜¯å¦‚ä½•è¢«è”ç³»åˆ°ä¸€èµ·çš„å‘¢?</h1><p><a href="https://devblogs.microsoft.com/wp-content/uploads/sites/31/2019/06/Async_sequence_state_machine_thumb.png"></a></p><p>å›¾è¡¨çœ‹ä¼¼è¿‡äºå¤æ‚ï¼Œä½†æ¯ä¸ªç»„ä»¶éƒ½ç»è¿‡ç²¾å¿ƒè®¾è®¡ä¸”æ‰®æ¼”ç€é‡è¦è§’è‰²ã€‚æœ€æœ‰è¶£çš„åä½œå‘ç”Ÿåœ¨ç­‰å¾…çš„ä»»åŠ¡å°šæœªå®Œæˆæ—¶ï¼ˆå›¾ä¸­ç”¨æ£•è‰²çŸ©å½¢æ ‡è®°ï¼‰ï¼š</p><p>çŠ¶æ€æœºæ³¨å†Œä»»åŠ¡å»¶ç»­</p><p>çŠ¶æ€æœºè°ƒç”¨ <code>__builder.AwaitUnsafeOnCompleted(ref awaiter, ref this)</code>ï¼Œå°†è‡ªèº«æ³¨å†Œä¸ºä»»åŠ¡çš„å»¶ç»­ã€‚<br><code>AsyncTaskMethodBuilder</code> ç¡®ä¿ä»»åŠ¡å®Œæˆåè°ƒç”¨ <code>IAsyncStateMachine.MoveNext</code> æ–¹æ³•ï¼š<br>æ•è·å½“å‰ æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆExecutionContextï¼‰ï¼Œåˆ›å»ºä¸€ä¸ª MoveNextRunner å®ä¾‹ï¼Œå°†å…¶ä¸å½“å‰çŠ¶æ€æœºå®ä¾‹å…³è”ã€‚<br>ä» MoveNextRunner.Run åˆ›å»ºä¸€ä¸ª Action å§”æ‰˜ï¼Œç”¨äºåœ¨æ•è·çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­æ¨è¿›çŠ¶æ€æœºã€‚<br>è°ƒç”¨ TaskAwaiter.UnsafeOnCompleted(action)ï¼Œå°†ä¸Šè¿° Action å§”æ‰˜è°ƒåº¦ä¸ºç­‰å¾…ä»»åŠ¡çš„å»¶ç»­ã€‚<br>ä»»åŠ¡å®Œæˆåçš„æ¢å¤</p><p>å½“ç­‰å¾…çš„ä»»åŠ¡å®Œæˆæ—¶ï¼Œæ³¨å†Œçš„å›è°ƒï¼ˆAction å§”æ‰˜ï¼‰è¢«è§¦å‘ï¼ŒçŠ¶æ€æœºç»§ç»­æ‰§è¡Œå¼‚æ­¥æ–¹æ³•çš„ä¸‹ä¸€æ®µä»£ç å—ã€‚</p><h1>æ‰§è¡Œä¸Šä¸‹æ–‡</h1><p>é—®é¢˜ï¼šä»€ä¹ˆæ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Ÿä¸ºä½•éœ€è¦è¿™ç§å¤æ‚çš„è®¾è®¡ï¼Ÿ<br>åœ¨åŒæ­¥ä»£ç ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹é€šè¿‡ <code>çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆThread-Local Storageï¼‰</code> ç»´æŠ¤ç¯å¢ƒä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šå®‰å…¨å‡­æ®ï¼ˆå¦‚ SecurityContextï¼‰åŒºåŸŸæ€§è®¾ç½®ï¼ˆå¦‚ CultureInfoï¼‰æˆ–è€…å…¶ä»–ä¸Šä¸‹æ–‡æ•°æ®ï¼ˆå¦‚ AsyncLocal<T> çš„å€¼ï¼‰<br>å½“ä¸‰ä¸ªæ–¹æ³•åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ä¾æ¬¡è°ƒç”¨æ—¶ï¼Œè¿™äº›ä¿¡æ¯ä¼šè‡ªåŠ¨åœ¨æ–¹æ³•é—´æµåŠ¨ã€‚ä½†æ˜¯å¯¹äºå¼‚æ­¥æ–¹æ³•æ¥è¯´å°±ä¸å†æ˜¯è¿™æ ·äº†. å¼‚æ­¥æ–¹æ³•çš„æ¯ä¸ªä»£ç æ®µï¼ˆå¦‚ await å‰åçš„ä»£ç ï¼‰å¯èƒ½åœ¨ä¸åŒçº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œ<code>çº¿ç¨‹æœ¬åœ°å­˜å‚¨(Thread-Local Storage</code>å¤±æ•ˆã€‚<br>å› æ­¤æ‰§è¡Œä¸Šä¸‹æ–‡æ´¾ä¸Šç”¨åœº, å®ƒä¸º ä¸€ä¸ªé€»è¾‘æ§åˆ¶æµ ç»´æŠ¤ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå³ä½¿è¯¥æ§åˆ¶æµè·¨è¶Šå¤šçº¿ç¨‹ã€‚<br>ä¾‹å¦‚ï¼ŒTask.Run æˆ– ThreadPool.QueueUserWorkItem ä¼š è‡ªåŠ¨æ•è·è°ƒç”¨çº¿ç¨‹çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå¹¶å°†å…¶ä¸ä»»åŠ¡ç»‘å®šã€‚<br>å½“ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œè°ƒåº¦å™¨ï¼ˆå¦‚ TaskSchedulerï¼‰é€šè¿‡ ExecutionContext.Run åœ¨æ•è·çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œå§”æ‰˜ï¼Œç¡®ä¿ç¯å¢ƒä¿¡æ¯ï¼ˆå¦‚å®‰å…¨å‡­æ®ï¼‰æ— ç¼å»¶ç»­ã€‚</p><p>é€šè¿‡ä¸‹é¢è¿™ä¸ªä¾‹å­ç†è§£ä¸€ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">static Task ExecutionContextInAction()</span><br><span class="line">&#123;</span><br><span class="line">    var li = new AsyncLocal&lt;int&gt;();</span><br><span class="line">    li.Value = 42;</span><br><span class="line"> </span><br><span class="line">    return Task.Run(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        // Task.Run restores the execution context</span><br><span class="line">        Console.WriteLine(&quot;In Task.Run: &quot; + li.Value);</span><br><span class="line">    &#125;).ContinueWith(_ =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        // The continuation restores the execution context as well</span><br><span class="line">        Console.WriteLine(&quot;In Task.ContinueWith: &quot; + li.Value);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­, æ‰§è¡Œä¸Šä¸‹æ–‡é€šè¿‡<code>Task.Run</code>æµå‘äº†<code>Task.ContinueWith</code>. å› æ­¤ä¸Šé¢è¿™æ®µä»£ç çš„æ‰§è¡Œç»“æœå¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In Task.Run: 42</span><br><span class="line">In Task.ContinueWith: 42</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸æ˜¯æ‰€æœ‰åœ¨BCLä¸­çš„æ–¹æ³•éƒ½ä¼šè‡ªåŠ¨æ•è·å¹¶æ¢å¤æ‰§è¡Œä¸Šä¸‹æ–‡. ä¸¤ä¸ªä¾‹å¤–æ˜¯: <code>TaskAwaiter&lt;T&gt;.UnsafeOnCompledte</code>å’Œ<code>AsyncMethodBuilder&lt;T&gt;.AwaitUnsafeOnComplete</code>. è¿™çœ‹èµ·æ¥ååˆ†å¥‡æ€ª, è¯­è¨€è®¾è®¡è€…å†³å®šæ·»åŠ ä¸å®‰å…¨çš„æ–¹æ³•æ‰‹åŠ¨ä½¿ç”¨<code>AsyncMethodBuilder&lt;T&gt;</code>å’Œ<code>MoveNetRunner</code>è€Œä¸æ˜¯ä¾èµ–äºå†…å»ºçš„ç±»ä¼¼<code>AwaitTaskContinuation</code>è¿™æ ·çš„æœºåˆ¶é©±åŠ¨æ‰§è¡Œä¸Šä¸‹æ–‡, çŒœæµ‹è¿™æ˜¯å‡ºäºæ€§èƒ½é—®é¢˜è€ƒè™‘æˆ–è€…æ˜¯å¯¹ç°æœ‰å®ç°çš„å¦ä¸€ä¸ªå¦¥å.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">static async Task ExecutionContextInAsyncMethod()</span><br><span class="line">&#123;</span><br><span class="line">    var li = new AsyncLocal&lt;int&gt;();</span><br><span class="line">    li.Value = 42;</span><br><span class="line">    await Task.Delay(42);</span><br><span class="line"></span><br><span class="line">    // The context is implicitely captured. li.Value is 42</span><br><span class="line">    Console.WriteLine(&quot;After first await: &quot; + li.Value);</span><br><span class="line"></span><br><span class="line">    var tsk2 = Task.Yield();</span><br><span class="line">    tsk2.GetAwaiter().UnsafeOnCompleted(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        // The context is not captured: li.Value is 0</span><br><span class="line">        Console.WriteLine(&quot;Inside UnsafeOnCompleted: &quot; + li.Value);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    await tsk2;</span><br><span class="line"></span><br><span class="line">    // The context is captured: li.Value is 42</span><br><span class="line">    Console.WriteLine(&quot;After second await: &quot; + li.Value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœæ˜¯:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">After first await: 42</span><br><span class="line">Inside UnsafeOnCompleted: 0</span><br><span class="line">After second await: 42</span><br></pre></td></tr></table></figure><h1>ç»“è®º</h1><ul><li><p>å¼‚æ­¥æ–¹æ³•ï¼ˆasyncï¼‰çš„åº•å±‚è¡Œä¸ºä¸åŒæ­¥æ–¹æ³•æˆªç„¶ä¸åŒï¼Œå…¶æ ¸å¿ƒæœºåˆ¶ä¾èµ–äºç¼–è¯‘å™¨ç”Ÿæˆçš„ çŠ¶æ€æœºï¼ˆState Machineï¼‰ï¼š</p></li><li><p>ç¼–è¯‘å™¨ä¼šä¸ºæ¯ä¸ªå¼‚æ­¥æ–¹æ³•ç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„çŠ¶æ€æœºï¼Œå°†åŸæ–¹æ³•çš„å…¨éƒ¨é€»è¾‘è½¬ç§»è‡³çŠ¶æ€æœºä¸­ã€‚ çŠ¶æ€æœºè´Ÿè´£è·Ÿè¸ªæ‰§è¡Œè¿›åº¦ï¼ˆé€šè¿‡çŠ¶æ€å€¼ï¼‰ã€æŒ‚èµ·ï¼ˆawait æ—¶ï¼‰ä¸æ¢å¤ï¼ˆä»»åŠ¡å®Œæˆæ—¶ï¼‰çš„é€»è¾‘æµè½¬ã€‚</p></li><li><p>å¯¹åŒæ­¥å®Œæˆçš„æ·±åº¦ä¼˜åŒ–. è‹¥æ‰€æœ‰ç­‰å¾…çš„ä»»åŠ¡ï¼ˆawait çš„ä»»åŠ¡ï¼‰å·²åŒæ­¥å®Œæˆï¼ˆå¦‚ç¼“å­˜å‘½ä¸­ã€å†…å­˜è®¡ç®—ç­‰æ— é˜»å¡æ“ä½œï¼‰ï¼Œå¼‚æ­¥æ–¹æ³•çš„æ€§èƒ½å¼€é”€æä½ï¼Œå‡ ä¹ä¸åŒæ­¥æ–¹æ³•æ— å¼‚ã€‚<br>æ­¤ä¼˜åŒ–é¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æˆ–è°ƒåº¦ï¼Œæ˜¯å¼‚æ­¥ç¼–ç¨‹é«˜æ€§èƒ½çš„å…³é”®ä¿éšœã€‚<br>å¼‚æ­¥åœºæ™¯çš„å¤æ‚æ€§</p></li><li><p>å½“ç­‰å¾…çš„ä»»åŠ¡æœªå®Œæˆï¼ˆéœ€å¼‚æ­¥ç­‰å¾…ï¼‰æ—¶ï¼ŒçŠ¶æ€æœºä¾èµ–ä¸€ç³»åˆ—è¾…åŠ©ç±»å‹ï¼ˆå¦‚ AsyncTaskMethodBuilder<T>ã€TaskAwaiter<T>ã€MoveNextRunner ç­‰ï¼‰åä½œå®Œæˆï¼š</p><ul><li>æ³¨å†Œä»»åŠ¡å»¶ç»­ï¼ˆContinuationï¼‰ã€‚</li><li>ç»´æŠ¤æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆExecutionContextï¼‰ã€‚<br>è·¨çº¿ç¨‹è°ƒåº¦æ—¶çš„çŠ¶æ€å®‰å…¨æµè½¬ã€‚</li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;å…³äºå¼‚æ­¥çš„å†å²&lt;/h1&gt;
&lt;p&gt;C#å¼€å‘è€…åœ¨ç¬¬ä¸€æ¬¡æ¥è§¦å¼‚æ­¥çš„æ¦‚å¿µ, åº”è¯¥æ˜¯é€šè¿‡Taskç±»å‹. Taskæ˜¯åœ¨&lt;code&gt;.Net 4.0&lt;/code&gt;çš„æ—¶å€™è¢«å¼•å…¥çš„. ä¸€ä¸ªtaskå°±æ˜¯ä¸€ä¸ªworkå•å…ƒ, ä¸”è¯¥taskæ‰¿è¯º, åœ¨è¿™ä¸ªtaskæœªæ¥å®Œæˆçš„æ—¶å€™, ä¼šå°†ç»“æœè¿”å›ç»™ta</summary>
      
    
    
    
    <category term="C#" scheme="https://soincredible.github.io/categories/C/"/>
    
    
    <category term="å¼‚æ­¥" scheme="https://soincredible.github.io/tags/%E5%BC%82%E6%AD%A5/"/>
    
  </entry>
  
  <entry>
    <title>ç²¾ç»†åŒ–å®éªŒç­–ç•¥ä¸‹ä¸€ç§å¤šç­–ç•¥äº¤å‰çš„ç¾æœ¯ã€åŠ¨æ•ˆæ¡†æ¶çš„å®ç°</title>
    <link href="https://soincredible.github.io/posts/4bbdbff1/"/>
    <id>https://soincredible.github.io/posts/4bbdbff1/</id>
    <published>2025-05-01T15:07:44.000Z</published>
    <updated>2025-05-07T03:12:56.673Z</updated>
    
    <content type="html"><![CDATA[<h1>ç¬”è€…å¯¹ç²¾ç»†åŒ–å®éªŒçš„å®šä¹‰</h1><p>å½“æ¸¸æˆè¦æ–°å¢æˆ–æ”¹åŠ¨ä¸€ä¸ªåŠŸèƒ½æ—¶, å¦‚æœå¼€å‘è€…ä¸èƒ½ç¡®å…¶ä¼šå¯¹ç”¨æˆ·ä½“éªŒé€ æˆä»€ä¹ˆå½±å“, å°±ä¼šç”¨åšå®éªŒçš„æ–¹å¼å°†åŠŸèƒ½å‘å¸ƒåˆ°çº¿ä¸Š, å³å°†ç”¨æˆ·åˆ†ä¸ºå¯¹ç…§ç»„å’Œå®éªŒç»„, çœ‹ä¸¤ç»„ç”¨æˆ·çš„æ•°æ®è¡¨ç°, æ¥åˆ¤æ–­è¯¥åŠŸèƒ½çš„å¥½å. å¦‚æœå®éªŒç»„æ•°æ®å¥½äºå¯¹ç…§ç»„, åˆ™åº”ç”¨å®éªŒç»„, åä¹‹åº”ç”¨å¯¹ç…§ç»„. ä¸è®ºåº”ç”¨å“ªä¸€ç»„, æ²¡æœ‰è¢«åº”ç”¨çš„é‚£ä¸€ç»„çš„ç¡¬ç¼–ç å°±å¯ä»¥åˆ é™¤æ‰, å› æ­¤å®éªŒç»„ä¸å¯¹ç…§ç»„é€»è¾‘çš„ä»£ç åªæ˜¯ä¼šä¸´æ—¶æ’å…¥åˆ°é¡¹ç›®ä¸­, åªè¦å®éªŒåº”ç”¨äº†ä¹‹åæŠŠéåº”ç”¨å®éªŒåˆ†æ”¯çš„ä»£ç åˆ å¹²å‡€, é•¿æœŸä¸‹æ¥æ˜¯ä¸ä¼šå¯¹æ•´ä¸ªé¡¹ç›®ä»£ç ç»“æ„æœ‰ä»€ä¹ˆå½±å“. ä½†æ˜¯æˆ‘ä»¬å›¢é˜Ÿåœ¨æŒ‰ç…§ä¸Šè¿°æ¨¡å¼æ¨è¿›äº†ä¸€æ®µæ—¶é—´ä¹‹åå‘ç°äº†è¿™ç§æ¨¡å¼å­˜åœ¨é—®é¢˜, åŒä¸€ä¸ªç‰ˆæœ¬ä¸Šçº¿çš„å¤šä¸ªå®éªŒä¹‹é—´å­˜åœ¨äº¤å‰, ä¸”ä¼šå¯¹å•ä¸ªå®éªŒçš„ç»“æœäº§ç”Ÿå½±å“, è€Œä¸”æœ‰çš„å®éªŒçŸ­æœŸå†…æ˜¯å®éªŒç»„çš„æ•°æ®å¥½, è€Œé•¿æœŸåˆå˜æˆäº†å¯¹ç…§ç»„çš„æ•°æ®å¥½. å› æ­¤, æˆ‘ä»¬è®¤ä¸ºä¹‹å‰å¯¹å®éªŒæ•°æ®çš„ç»“è®ºä¸å‡†ç¡®, æˆ‘ä»¬å†³å®šå°†ä¸€æ®µå‘¨æœŸå†…æœ€æ—©çš„é‚£ä¸ªç‰ˆæœ¬çš„é¡¹ç›®çŠ¶æ€å®šä¹‰ä¸º<strong>åŸºçº¿ç»„</strong>, åœ¨è¿™ä¸€å‘¨æœŸå†…çš„æ¯ä¸ªç‰ˆæœ¬ä¼šä¸Šçº¿çš„å®éªŒéƒ½ä¸ä¼šåº”ç”¨, è€Œæ˜¯ä¼šä¸€ç›´åœ¨çº¿ä¸Šè·‘, éšç€å®éªŒè¶Šå¼€è¶Šå¤š, å®éªŒä¹‹é—´çš„äº¤å‰é—®é¢˜è¶Šæ¥è¶Šä¸¥é‡, åˆå› ä¸ºè¿™äº›å®éªŒçš„åˆ†æ”¯ä»£ç ä¸ä¼šåˆ é™¤, ä»£ç ä¹Ÿä¼šå˜å¾—è¶Šæ¥è¶Šéš¾ä»¥ç»´æŠ¤, ä¸Šè¿°è¿™ç§åœ¨ä¸€æ®µå‘¨æœŸä¸Šçº¿å¤§é‡ä¸ä¼šåº”ç”¨å®éªŒ, ä¸”å¸Œæœ›æ¯ä¸ªå®éªŒéƒ½èƒ½äº¤å‰, åœ¨ä¸€æ®µå‘¨æœŸåä¼šå½¢æˆä¸Šç™¾ã€ä¸Šåƒæ¡å®éªŒåˆ†æ”¯çš„å®éªŒ, å°±æ˜¯<strong>ç²¾ç»†åŒ–å®éªŒ</strong>, å¯¹åº”çš„, æˆ‘ä»¬å›¢é˜Ÿå°±éœ€è¦ä¸€å¥—èƒ½å¤Ÿç®¡ç†ç²¾ç»†åŒ–å®éªŒçš„æ¡†æ¶.</p><h1>ç²¾ç»†åŒ–æ¡†æ¶çš„å®ç°æ€è·¯</h1><p>æ¯ä¸ªå®éªŒèƒ½å¤Ÿäº¤å‰, æ˜¯ååˆ†ç¾å¥½çš„æ„¿æ™¯. ä½†æ˜¯, åœ¨å®é™…å¼€å‘ä¸­æˆ‘ä»¬å‘ç°, ç»å¸¸ä¼šæœ‰äº’ä¸ºäº’æ–¥å…³ç³»çš„å®éªŒå­˜åœ¨, æ¯”å¦‚ä¸¤ä¸ªå®éªŒåŒæ—¶å¯¹æ¨¡å—Aåšäº†æ”¹åŠ¨, æˆ–è€…å®éªŒä¸€å½±å“æ¨¡å—ABC, å®éªŒäºŒå½±å“æ¨¡å—ABD, è¿™ç§æƒ…å†µæ˜¯ä¸å¯é¿å…çš„, å› æ­¤, ç²¾ç»†åŒ–æ¡†æ¶è¦åšçš„äº‹æƒ…, ä¸ä»…ä»…æ˜¯é©±åŠ¨è¿™äº›å®éªŒ, è¿˜è¦åˆ¶å®šä¸€å¥—è§„èŒƒ, å¤„ç†å®éªŒä¹‹é—´çš„å†²çªé—®é¢˜.</p><p>æœ¬ç¯‡åšå®¢ç¬”è€…ä¼šä»¥UIæ¢çš®å®éªŒå’ŒåŠ¨æ•ˆæ¢çš®å®éªŒä¸ºä¾‹å­, é˜è¿°UIæ¡†æ¶ã€åŠ¨æ•ˆæ’­æ”¾æ¡†æ¶çš„å®ç°æ€è·¯, ä»¥åŠè¿™äº›æ¡†æ¶å’Œç²¾ç»†åŒ–æ¡†æ¶çš„ååŒè¿‡ç¨‹.</p><h2 id="ä»ABTestæ¡†æ¶è¯´èµ·">ä»ABTestæ¡†æ¶è¯´èµ·</h2><p>æˆ‘ä»¬æœ€åˆä½¿ç”¨çš„ABæµ‹è¯•ç³»ç»Ÿååˆ†ç®€é™‹, ABæµ‹ç³»ç»Ÿåœ¨å¯åŠ¨æ—¶ä»ç£ç›˜ä¸ŠåŠ è½½ä¸Šæ¥æ‰€æœ‰çš„ABå®éªŒä¿¡æ¯, æ ¹æ®è®¾å¤‡çš„uid, åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·è¯¥è¡¨ç°ä¸ºå¯¹ç…§ç»„è¿˜æ˜¯å®éªŒç»„æ˜¯æ ¹æ®ç”¨æˆ·ä½¿ç”¨è®¾å¤‡çš„uid, æˆ‘ä»¬åœ¨åå°é…ç½®ä¸€ä¸ªå®éªŒçš„æ—¶å€™, æœ‰å¤šå°‘ä¸ªå®éªŒç»„å°±ä¼šç”Ÿæˆå‡ ä¸ªâ€œæ¡¶â€, è¿™äº›æ¡¶é‡Œé¢è£…çš„æ˜¯ç”¨æˆ·è®¾å¤‡çš„uid, ç”¨æˆ·è®¾å¤‡å¯åŠ¨æ¸¸æˆçš„æ—¶å€™, ç¨‹åºèƒ½å¤ŸçŸ¥é“å½“å‰è®¾å¤‡åœ¨å“ªä¸ªæ¡¶é‡Œ, ä½†æ˜¯åœ¨æŸä¸€ä¸ªæ¡¶é‡Œå¹¶ä¸æ„å‘³ç€å°±ä¸€å®šè¡¨ç°ä¸ºè¿™ä¸ªæ¡¶æ‰€å¯¹åº”çš„å®éªŒç»„, è¿˜æœ‰å…¶ä»–çš„é™åˆ¶æ¡ä»¶, æ¯”å¦‚å®‰è£…ç‰ˆæœ¬å¿…é¡»å¤§äºæŸä¸€ä¸ªç‰ˆæœ¬æˆ–è€…å¿…é¡»æ˜¯æ–°ç”¨æˆ·, æˆ–è€…å¿…é¡»æ˜¯æŸä¸€å›½å®¶åœ°åŒºçš„ç­‰ç­‰. æ€»ä¹‹, ä¸šåŠ¡å±‚åªéœ€è¦æŠŠå®ƒä»¬å…³ç³»çš„å®éªŒå­—æ®µä¼ å…¥, å°±èƒ½å¤Ÿæ‹¿åˆ°å½“å‰è®¾å¤‡å¯¹åº”å®éªŒæ‰€åœ¨çš„å®éªŒç»„æ˜¯å“ªä¸€ä¸ª.</p><h2 id="ç²¾ç»†åŒ–å®éªŒæ¨¡å—ç™»åœº">ç²¾ç»†åŒ–å®éªŒæ¨¡å—ç™»åœº</h2><p>ç²¾ç»†åŒ–å®éªŒè¦åšçš„, å°±æ˜¯æŠŠABTestæ¡†æ¶å’Œä¸šåŠ¡å±‚è§£è€¦, ä½œä¸ºä¸¤è€…ä¹‹é—´çš„æ¡¥æ¢. å½“ä½ æƒ³è®©ä¸¤ä¸ªæ¨¡å—è§£è€¦æ—¶, æœ€ç›´æ¥çš„æ–¹å¼å°±æ˜¯åœ¨ä¸¤ä¸ªæ¨¡å—é€šè®¯çš„æ¥å£å¤„å¢åŠ æ¡¥æ¥å±‚, æœ‰äº†è¿™å±‚æ¡¥æ¥, ABTestä¸­åºå¤§çš„æ•°æ®ä¸è‡³äºä¸€ä¸‹å­æ¶Œå‘ä¸šåŠ¡å±‚, è€Œæ˜¯åœ¨ç²¾ç»†åŒ–å®éªŒå±‚æ•´åˆã€å¤„ç†, ç²¾ç»†åŒ–å®éªŒå±‚ä¼šæŠŠABTestä¸­å½±å“åŒä¸€ä¸ªä¸šåŠ¡çš„å®éªŒä»¬æŒ‰ç…§äººä¸ºå®šä¹‰çš„è§„åˆ™è¿›è¡Œæ•´åˆã€å†²çªå¤„ç†, ç„¶åå°†ç»“æœè½¬æ¢æˆå¯¹åº”ä¸šåŠ¡èƒ½å¤Ÿè¯†åˆ«çš„æ ¼å¼â€”â€”ç²¾ç»†åŒ–å®éªŒå±‚éœ€è¦å’Œæ¯ä¸€ä¸ªå…·ä½“çš„ä¸šåŠ¡å®šä¹‰ä¸€å¥—åè®®, è¿™å¥—åè®®èƒ½å¤Ÿæè¿°, ç»è¿‡å¤šä¸ªå®éªŒçš„å¤šé‡å½±å“, è¯¥ä¸šåŠ¡æœ€ç»ˆçš„è¡¨ç°æ•ˆæœæ˜¯æ€æ ·çš„. æˆ‘ä»¬è®¡åˆ’ä½¿ç”¨Jsonä½œä¸ºè¿™äº›å®éªŒé…ç½®çš„è½½ä½“:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;1024&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;uiTest&quot;,</span><br><span class="line">        &quot;experimentSceneType&quot;: &quot;UIStyle&quot;, </span><br><span class="line">        &quot;experimentParam&quot;: &#123;</span><br><span class="line">            &quot;group1&quot;: [</span><br><span class="line">                [</span><br><span class="line">                    &quot;homePage&quot;,</span><br><span class="line">                    1</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;playPage&quot;,</span><br><span class="line">                    1</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;resultPage&quot;,</span><br><span class="line">                    1</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;settingPage&quot;,</span><br><span class="line">                    1</span><br><span class="line">                ]</span><br><span class="line">            ],</span><br><span class="line">            &quot;group2&quot;: [</span><br><span class="line">                [</span><br><span class="line">                    &quot;homePage&quot;,</span><br><span class="line">                    2</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;playPage&quot;,</span><br><span class="line">                    2</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;resultPage&quot;,</span><br><span class="line">                    2</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;settingPage&quot;,</span><br><span class="line">                    2</span><br><span class="line">                ]</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">     &quot;1025&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;uiTest2&quot;,</span><br><span class="line">        &quot;experimentSceneType&quot;: &quot;UIStyle&quot;, </span><br><span class="line">        &quot;experimentParam&quot;: &#123;</span><br><span class="line">            &quot;group1&quot;: [</span><br><span class="line">                [</span><br><span class="line">                    &quot;homePage&quot;,</span><br><span class="line">                    1</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;playPage&quot;,</span><br><span class="line">                    2</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;resultPage&quot;,</span><br><span class="line">                    1</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;settingPage&quot;,</span><br><span class="line">                    4</span><br><span class="line">                ]</span><br><span class="line">            ],</span><br><span class="line">            &quot;group2&quot;: [</span><br><span class="line">                [</span><br><span class="line">                    &quot;homePage&quot;,</span><br><span class="line">                    2</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;playPage&quot;,</span><br><span class="line">                    3</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;resultPage&quot;,</span><br><span class="line">                    5</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;settingPage&quot;,</span><br><span class="line">                    2</span><br><span class="line">                ]</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure><p>å¯¹ä¸Šè¿°Jsonæ ¼å¼åšä¸€ä¸‹è¯´æ˜, æœ€å¤–å±‚çš„æ•°å­—ä»£è¡¨å®éªŒID, <code>name</code>æ˜¯å®éªŒå, <code>experimentSceneType</code>æ˜¯å®éªŒåœºæ™¯, <code>experimentParam</code>èƒ½å¤Ÿæè¿°å®éªŒåœºæ™¯ä¸‹çš„å®éªŒå†…å®¹, <code>group</code>ä»£è¡¨å®éªŒåˆ†ç»„, ä¸åŒå®éªŒåœºæ™¯ä¸‹<code>group</code>å­—æ®µä¸‹çš„ç»“æ„ä¸ä¸€æ ·, åœ¨<code>UIStyle</code>å®éªŒåœºæ™¯ä¸‹æ˜¯ä¸€ä¸ªåˆ—è¡¨, æ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ªUI, å’Œè¯¥UIä½¿ç”¨çš„<code>styleId</code>.</p><p>ç¨‹åºå¯åŠ¨æ—¶å¿…å®šåŠ è½½ä¸Šé¢ä¸¤ä¸ªå®éªŒ, å¹¶å‘½ä¸­å…¶ä¸­ä¸€ä¸ªå®éªŒç»„, è€Œè¿™ä¸¤ä¸ªå®éªŒæ˜¯äº’æ–¥çš„, å› æ­¤ä¼šåœ¨ç²¾ç»†åŒ–å®éªŒå±‚è¿›è¡Œå¤„ç†. å…·ä½“çš„å¤„ç†è§„åˆ™, åˆ™éœ€è¦å’Œç­–åˆ’å›¢é˜Ÿä¸€èµ·åˆ¶å®š, ç¡¬ç¼–ç è¿›ç²¾ç»†åŒ–å®éªŒæ¨¡å—ä¸­, ç­‰ä¸šåŠ¡åœºæ™¯è¶³å¤Ÿä¸°å¯Œçš„æ—¶å€™, ä¹Ÿè®¸å¯ä»¥ä»ä¸­æå–å‡ºä¸€å¥—è§„åˆ™æ¥æ”¯æŒé…ç½®. ä¸è¿‡è¿™å°±ä¸åœ¨æœ¬ç¯‡åšå®¢è¦è®¨è®ºçš„èŒƒç•´å†…äº†. æ€»ä¹‹, ç»è¿‡ç²¾ç»†åŒ–å±‚çš„å¤„ç†ä¹‹å, UIStyleå®éªŒåœºæ™¯ä¼šå¾—åˆ°ä¸€ç»„ç±»ä¼¼groupå­—æ®µå†…çš„åˆ—è¡¨, è¿™é‡Œé¢å­˜å‚¨äº†æ‰€æœ‰UIçš„styleId, UIManagerä¾§ç»´æŠ¤ç€æ¯ä¸ªUIæ¯ä¸ªstyleIdçš„æ˜ å°„å…³ç³». æœ‰ç²¾ç»†åŒ–å±‚ä¼ æ¥çš„å‚æ•°, UIManagerå°±å¯ä»¥ç»™æ¯ä¸ªUIè®¾ç½®è¿è¡Œæ—¶styleIdäº†.</p><p>æˆ‘ä»¬è®¾è®¡çš„å®éªŒè¡¨æ ¼å¦‚ä¸‹:</p><h2 id="UIæ¡†æ¶çš„é…è¡¨">UIæ¡†æ¶çš„é…è¡¨</h2><h2 id="éŸ³é¢‘æ¡†æ¶é…è¡¨">éŸ³é¢‘æ¡†æ¶é…è¡¨</h2><h2 id="åŠ¨æ•ˆé…è¡¨">åŠ¨æ•ˆé…è¡¨</h2><h2 id="å®éªŒé…ç½®">å®éªŒé…ç½®</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;ç¬”è€…å¯¹ç²¾ç»†åŒ–å®éªŒçš„å®šä¹‰&lt;/h1&gt;
&lt;p&gt;å½“æ¸¸æˆè¦æ–°å¢æˆ–æ”¹åŠ¨ä¸€ä¸ªåŠŸèƒ½æ—¶, å¦‚æœå¼€å‘è€…ä¸èƒ½ç¡®å…¶ä¼šå¯¹ç”¨æˆ·ä½“éªŒé€ æˆä»€ä¹ˆå½±å“, å°±ä¼šç”¨åšå®éªŒçš„æ–¹å¼å°†åŠŸèƒ½å‘å¸ƒåˆ°çº¿ä¸Š, å³å°†ç”¨æˆ·åˆ†ä¸ºå¯¹ç…§ç»„å’Œå®éªŒç»„, çœ‹ä¸¤ç»„ç”¨æˆ·çš„æ•°æ®è¡¨ç°, æ¥åˆ¤æ–­è¯¥åŠŸèƒ½çš„å¥½å. å¦‚æœå®éªŒç»„æ•°æ®å¥½äºå¯¹ç…§ç»„, åˆ™åº”ç”¨å®éªŒç»„</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>æ—¶åŠ¿:å‘¨æœŸæ³¢åŠ¨ä¸‹çš„å›½å®¶ã€ç¤¾ä¼šå’Œä¸ªäºº</title>
    <link href="https://soincredible.github.io/posts/1cb37a62/"/>
    <id>https://soincredible.github.io/posts/1cb37a62/</id>
    <published>2025-04-29T05:58:00.000Z</published>
    <updated>2025-05-07T03:12:56.673Z</updated>
    
    <content type="html"><![CDATA[<h1>æ—¥æœ¬å¤±è½çš„ä¸‰åå¹´</h1><p>æ—¥æœ¬è´¢å›¢</p><p>å¹¿åœºåè®®</p><p>å›½å€º</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;æ—¥æœ¬å¤±è½çš„ä¸‰åå¹´&lt;/h1&gt;
&lt;p&gt;æ—¥æœ¬è´¢å›¢&lt;/p&gt;
&lt;p&gt;å¹¿åœºåè®®&lt;/p&gt;
&lt;p&gt;å›½å€º&lt;/p&gt;
</summary>
      
    
    
    
    <category term="è¯»ä¸‡å·ä¹¦" scheme="https://soincredible.github.io/categories/%E8%AF%BB%E4%B8%87%E5%8D%B7%E4%B9%A6/"/>
    
    
    <category term="è¯»ä¹¦ç¬”è®°" scheme="https://soincredible.github.io/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>å¯¹C#ä¸­ç±»å‹è½¬æ¢å’Œæ‹†è£…ç®±çš„æ€è€ƒ</title>
    <link href="https://soincredible.github.io/posts/fad28a7c/"/>
    <id>https://soincredible.github.io/posts/fad28a7c/</id>
    <published>2025-04-26T03:18:44.000Z</published>
    <updated>2025-04-27T01:30:44.578Z</updated>
    
    <content type="html"><![CDATA[<h1>ç±»å‹è½¬æ¢çš„å¼€é”€æ¥è‡ªå“ªé‡Œ?</h1><p>ç±»å‹è½¬æ¢åœ¨æ—¶é—´å’Œç©ºé—´ä¸Šéƒ½ä¼šé€ æˆå¼€é”€, å› ä¸ºç±»å‹è½¬æ¢C#ç¼–è¯‘å™¨ä¼šç”Ÿæˆé¢å¤–çš„ç±»å‹è½¬æ¢å¤„ç†ä»£ç , å¯¼è‡´ä»£ç æ–‡ä»¶çš„ä½“ç§¯å˜å¤§. æ—¢ç„¶æœ‰é¢å¤–çš„ILä»£ç ç”Ÿæˆåˆ™å°±éœ€è¦æœ‰é¢å¤–çš„æ—¶é—´å»æ‰§è¡Œ. å¦‚æœç±»å‹è½¬æ¢ä¸­æ¶‰åŠåˆ°è£…æ‹†ç®±æ“ä½œ, åˆ™è¿˜ä¼šå¯¹è¿è¡Œæ—¶å†…å­˜äº§ç”Ÿå½±å“.</p><ul><li>CLRä¼šç”Ÿæˆé¢å¤–ILä»£ç æ‰§è¡Œç±»å‹è½¬æ¢æ˜¯å¦åˆæ³•çš„åˆ¤æ–­é€»è¾‘, è¿™éƒ¨åˆ†å¼€é”€æ˜¯ä¸å¯é¿å…çš„, å³ä¾¿å¼€å‘è€…ç¬ƒå®šç±»å‹è½¬æ¢å¿…å®šåˆæ³•. ä¸è¿‡è¿™éƒ¨åˆ†å¼€é”€çš„å½±å“å¹¶ä¸å¤§. å¦‚æœç±»å‹è½¬æ¢åˆ¤å®šä¸ºä¸åˆæ³•, åˆ™éœ€è¦é¢å¤–çš„å¼€é”€æ¥å¤„ç†å¼‚å¸¸, æˆ‘ä»¬é€šå¸¸ä¼šæœ‰ä¸¤ç§ç±»å‹è½¬æ¢çš„æ–¹å¼, ä¸¤ç§è½¬æ¢æ–¹å¼ä¸åˆæ³•çš„å¤„ç†çš„å¼€é”€ä¸åŒ:<ul><li>ä½¿ç”¨ç±»å‹å¼ºè½¬, å³<code>var a = (someType)b</code>å½¢å¼, è¿™ç§æ–¹å¼åœ¨è½¬æ¢ä¸åˆæ³•çš„æ—¶å€™ä¼šæŠ›å‡ºå¼‚å¸¸, å¼€é”€è¾ƒå¤§.</li><li>ä½¿ç”¨<code>as</code>æ“ä½œç¬¦,å³<code>var a = b as someType</code>, è¿™ç§æ–¹å¼åœ¨è½¬æ¢ä¸åˆæ³•çš„æ—¶å€™ä¼šå°†aå­—æ®µè®¾ç½®ä¸º<code>null</code>,å¼€é”€å°. æ›´æ¨èä½¿ç”¨è¿™ç§æ–¹å¼.<br>ä¸è¿‡å¦‚æœä½ çœŸçš„ç¬ƒå®šç±»å‹è½¬æ¢ä¸ä¼šå‡ºé”™, é‚£ä¹ˆä»¥ä¸Šè¿™ä¸¤ç§ç±»å‹è½¬æ¢çš„æ–¹å¼å…¶å®å½±å“ä¸å¤§.</li></ul></li><li>æ‹†ç®±è£…ç®±é€ æˆçš„å¼€é”€, è¯·è®°ä½è¿™å¥è¯:<strong>è£…ç®±æ‹†ç®±ä¸€å®šæ˜¯ç±»å‹è½¬æ¢é€ æˆçš„, ä½†æ˜¯ç±»å‹è½¬æ¢ä¸ä¸€å®šä¼šå¯¼è‡´è£…ç®±æ‹†ç®±</strong> è£…æ‹†ç®±è¯¦è§£è¯·ç»§ç»­å¾€ä¸‹çœ‹.</li></ul><h1>å€¼ç±»å‹ä¸å¼•ç”¨ç±»å‹</h1><p>å€¼ç±»å‹åˆ›å»ºåœ¨æ ˆä¸Š, å †ç±»å‹åˆ›å»ºåœ¨å †ä¸Š è¿™å¥è¯æ˜¯ä¸å®Œå…¨å¯¹çš„, æ›´å‡†ç¡®çš„æè¿°æ˜¯: å¼•ç”¨ç±»å‹ä¸€å®šåˆ›å»ºåœ¨å †ä¸Š, å€¼ç±»å‹æ—¢å¯ä»¥åˆ›å»ºåœ¨å †ä¸Š, ä¹Ÿå¯ä»¥åˆ›å»ºåœ¨æ ˆä¸Š, å€¼ç±»å‹åˆ›å»ºåœ¨æ ˆè¿˜æ˜¯å †ä¸Šå–å†³äºå®ƒæ‰€åœ¨çš„å®¹å™¨: å¦‚æœå€¼ç±»å‹æ˜¯å¼•ç”¨ç±»å‹çš„ä¸€ä¸ªæˆå‘˜å­—æ®µ, åˆ™è¯¥å€¼ç±»å‹åˆ›å»ºåœ¨å †ä¸Š, å¦‚æœè¯¥å€¼ç±»å‹æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡(ä¸´æ—¶å˜é‡)æˆ–è€…æ˜¯ä¸€ä¸ªæ˜¯å¦å¤–ä¸€ä¸ªå€¼ç±»å‹çš„å­—æ®µæˆå‘˜çš„è¯, åˆ™åˆ›å»ºåœ¨å †ä¸Š.</p><h1>è£…ç®±æ‹†ç®±çš„å¼€é”€æ¥è‡ªå“ªé‡Œ</h1><p><strong>è£…ç®±è¿‡ç¨‹å‘ç”Ÿäº†ä»€ä¹ˆ</strong></p><ol><li>åœ¨æ‰˜ç®¡å †ä¸­åˆ†é…å†…å­˜, åˆ†é…çš„å†…å­˜é‡æ˜¯å€¼ç±»å‹å„å­—æ®µæ‰€éœ€çš„å†…å­˜é‡, è¿˜è¦åŠ ä¸Šæ‰˜ç®¡å †æ‰€æœ‰å¯¹è±¡éƒ½æœ‰çš„ä¸¤ä¸ªé¢å¤–æˆå‘˜(ç±»å‹å¯¹è±¡æŒ‡é’ˆå’ŒåŒæ­¥å—ç´¢å¼•)æ‰€éœ€çš„å†…å­˜é‡</li><li>å€¼ç±»å‹çš„å­—æ®µå¤åˆ¶åˆ°æ–°åˆ†é…çš„å †å†…å­˜</li><li>è¿”å›å¯¹è±¡åœ°å€. ç°åœ¨è¯¥åœ°å€æ˜¯å¯¹è±¡å¼•ç”¨; å€¼ç±»å‹æˆäº†å¼•ç”¨ç±»å‹</li></ol><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">object</span> obj = <span class="number">10</span>;</span><br></pre></td></tr></table></figure><p><strong>æ‹†ç®±è¿‡ç¨‹å‘ç”Ÿäº†ä»€ä¹ˆ</strong><br>è¯·åå¤é˜…è¯»å¹¶ç†è§£è¿™å¥è¯: <strong>æ‹†ç®±ä¸æ˜¯ç›´æ¥å°†è£…ç®±è¿‡ç¨‹å€’è¿‡æ¥, æ‹†ç®±è¿‡ç¨‹æœ¬èº«ä¸ä¼šå¤åˆ¶ä»»ä½•ç±»å‹, ä½†æ˜¯æ‹†ç®±è¿‡åå¾€å¾€è·Ÿéšç€ä¸€æ¬¡å­—æ®µçš„å¤åˆ¶.</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">object obj = 10; //è£…ç®±</span><br><span class="line"></span><br><span class="line">int a = (int)b // æ‹†ç®± + å­—æ®µçš„å¤åˆ¶</span><br></pre></td></tr></table></figure><p><code>(int)b</code>éƒ¨åˆ†å®Œæˆäº†æ‹†ç®±æ“ä½œ, <code>int a =</code>éƒ¨åˆ†å®Œæˆäº†å­—æ®µå¤åˆ¶æ“ä½œ, æˆ‘ä»¬åœ¨å†™ä»£ç çš„æ—¶å€™å¾ˆè‡ªç„¶è€Œç„¶åœ°ä¼šè¿™ä¹ˆå†™.</p><p>å¦å¤–ï¼Œå€¼ç±»å‹è£…ç®±åæ˜¯ä¸èƒ½æ”¹å˜å®ƒçš„å€¼çš„ï¼Œè£…ç®±åçš„å€¼å…·æœ‰æ’å®šæ€§ï¼ˆImmutableï¼‰çš„ç‰¹ç‚¹ï¼Œå¦‚æœæƒ³ç»™å¼•ç”¨ç±»å‹çš„å˜é‡èµ‹äºˆæ–°çš„å€¼ï¼Œé‚£å°±éœ€è¦å†å †ä¸Šå¦å¼€è¾Ÿæ–°çš„å†…å­˜ç©ºé—´ï¼Œä¸€æ—¦ä¸€ä¸ªå€¼ç±»å‹è¢«è£…ç®±ï¼Œå®ƒçš„å€¼å°±æ²¡æœ‰åŠæ³•æ”¹å˜äº†. çœ‹ä¸‹é¢çš„ä»£ç :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">struct ValueType</span><br><span class="line">&#123;</span><br><span class="line">    public int Value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void SomeFunc()</span><br><span class="line">&#123;</span><br><span class="line">    var value = new ValueType</span><br><span class="line">    &#123;</span><br><span class="line">        Value = 100</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    object vv = value;</span><br><span class="line">    </span><br><span class="line">    ((ValueType)vv).Value = 200; // è¿™é‡Œä¼šæŠ¥é”™Cannot modify struct member when accessed struct is not classified as a variable</span><br><span class="line"></span><br><span class="line">    var vvv = ((ValueType)vv); // ä¸ä¼šæŠ¥é”™</span><br><span class="line">    vvv.Value = 200;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°, å¦‚æœåªæ˜¯è¿›è¡Œæ‹†ç®±æ“ä½œ, æˆ‘ä»¬æ— æ³•å¯¹æ‹†ç®±åçš„å­—æ®µåšä»»ä½•ä¿®æ”¹, å¹¶æŠ¥é”™æç¤ºæ‹†ç®±åçš„å€¼æˆå‘˜å¹¶æ²¡æœ‰åˆ†ç±»ä¸ºå˜é‡, æˆ‘ä»¬å¿…é¡»å°†æ‹†ç®±åçš„æ•°æ®å¤åˆ¶ç»™ä¸€ä¸ªå€¼ç±»å‹å˜é‡, åœ¨è¿™ä¸ªå˜é‡ä¸Šè¿›è¡Œä¿®æ”¹, ä¸è¿‡è¿™ä¸ªå˜é‡æ˜¯æ‹†ç®±æ•°æ®çš„æ‹·è´, æ‹†ç®±çš„æ•°æ®æ²¡æœ‰ä»»ä½•å…³ç³». æ‰€ä»¥ä¸Šé¢æ‰è¯´<strong>æ‹†ç®±è¿‡åå¾€å¾€è·Ÿéšç€ä¸€æ¬¡å­—æ®µçš„å¤åˆ¶</strong></p><h1>åå¤åœ°æ‹†è£…ç®±</h1><p>åå¤åœ°æ‹†è£…ç®±ä¼šäº§ç”Ÿé¢å¤–çš„ILä»£ç , å¢åŠ ä»£ç ä½“ç§¯. æ›´å¤§çš„é—®é¢˜æ˜¯, é¢å¤–çš„è£…ç®±æ­¥éª¤ä¼šåœ¨æ‰˜ç®¡å †ä¸­åˆ†é…é¢å¤–çš„å¯¹è±¡, å°†æ¥å¿…é¡»å¯¹å…¶è¿›è¡Œåƒåœ¾å›æ”¶. æ‹†è£…ç®±çš„æ»¥ç”¨ä¼šä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½å’Œå†…å­˜æ¶ˆè€—.<br>å¦‚æœæˆ‘ä»¬æƒ³ä¿®æ”¹è£…ç®±åçš„å€¼ç±»å‹çš„å†…å®¹, è™½ç„¶ç¬”è€…æƒ³ä¸å‡ºå®é™…å¼€å‘ä¸­ä¼šæœ‰è¿™ç§åœºæ™¯, æˆ‘ä»¬å°±å¿…é¡»å…ˆå°†å…¶æ‹†ç®±, æ¥ç€å¤åˆ¶ç»™ä¸€ä¸ªå€¼ç±»å‹å˜é‡, ä¿®æ”¹å€¼ç±»å‹å˜é‡çš„å†…å®¹, å°†å€¼ç±»å‹å˜é‡è£…ç®±, æœ€åæŠŠæŒ‡å‘åŸæ¥è£…ç®±å€¼ç±»å‹åœ¨å †ä¸Šåœ°å€çš„å¼•ç”¨æŒ‡å‘çš„åœ°å€æ”¹ä¸ºæŒ‡å‘æ–°çš„å€¼ç±»å‹å˜é‡è£…ç®±åæ‰€åœ¨å †ä¸Šçš„åœ°å€. é‚£ä¹ˆåŸæ¥é‚£ä¸€ä¸ªè¢«è£…ç®±çš„å€¼ç±»å‹åœ¨å †ä¸Šå æ®çš„å†…å®¹ç©ºé—´å°±åºŸå¼ƒäº†, åœ¨æœªæ¥éœ€è¦è¿›è¡Œåƒåœ¾å›æ”¶. è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè£…ç®±æ‹†ç®±ä¼šå¼•èµ·GCã€‚</p><h1>å°èŠ‚</h1><p>åœ¨å®é™…å†™ä»£ç çš„è¿‡ç¨‹ä¸­, æ‹†è£…ç®±é—®é¢˜å¹¶ä¸å¸¸è§, å› ä¸ºå¤§éƒ¨åˆ†å¼€å‘è€…æƒ³éƒ½ä¸æƒ³åªä¼šæŠŠclassä¼ æ¥ä¼ å», è€Œä¸”æˆ‘ä»¬è‚¯å®šä¸ä¼šé—²å¾—å£°æ˜ä¸€ä¸ªobjectç±»å‹çš„å­—æ®µ, å´ç”¨ä¸€ä¸ªå€¼ç±»å‹çš„æ•°æ®ç»™å®ƒèµ‹å€¼. æ‰€ä»¥ç±»å‹è½¬æ¢ä¸­ä¸»è¦çš„æ€§èƒ½å¼€é”€<strong>åœ¨äºCLRä¼šç”Ÿæˆé¢å¤–ILä»£ç æ‰§è¡Œç±»å‹è½¬æ¢æ˜¯å¦åˆæ³•çš„åˆ¤æ–­é€»è¾‘</strong>(ç¨‹åºå‘˜ä¸€èˆ¬æƒ…å†µä¸‹è¿˜æ˜¯å¯ä»¥ä¿è¯ç±»å‹è½¬æ¢æ˜¯åˆæ³•çš„).</p><h1>å…¶ä»–è¦æ³¨æ„çš„ç‚¹</h1><p><strong>ç±»å‹æ£€æŸ¥ä¸­è¦æ³¨æ„çš„ç‚¹</strong><br>ä½¿ç”¨<code>is</code>æ“ä½œç¬¦å’Œ<code>.GetType()</code>æ¥å£éƒ½å¯ä»¥åšç±»å‹æ£€æŸ¥, ä½†æ˜¯ä¸¤è€…çš„å¼€é”€æ˜¯ä¸åŒçš„, æŒ‰ç…§GPTçš„è¯´æ³•, <code>is</code>æ“ä½œç¬¦çš„æ€§èƒ½å¼€é”€è¦å°äº<code>.GetType()</code>çš„å¼€é”€:</p><ul><li>ä½¿ç”¨<code>is</code>æ“ä½œç¬¦, C#ç¼–è¯‘å™¨ç”Ÿæˆç›´æ¥çš„ç±»å‹æ£€æŸ¥æŒ‡ä»¤(isinst ILæŒ‡ä»¤), æ— éœ€è§¦å‘å®Œæ•´çš„ç±»å‹å…ƒæ•°æ®åŠ è½½. <code>is</code>æ“ä½œç¬¦ä¼šåˆ©ç”¨ç±»å‹ç»§æ‰¿å…³ç³»è¿›è¡Œå¿«é€Ÿåˆ¤æ–­, æ— éœ€è·å–å®Œæ•´çš„Typeå¯¹è±¡, å€¼ç±»å‹ä¼˜åŒ–: å¦‚æœè½¬æ¢åçš„ç±»å‹æ˜¯å€¼ç±»å‹, isä¼šé¿å…è£…ç®±, å‰ææ˜¯objæ˜¯å€¼ç±»å‹ä¸”ç±»å‹å…¼å®¹</li><li>ä½¿ç”¨<code>.GetType()</code>æ—¶, ä¼šè§¦å‘å®Œæ•´ç±»å‹å…ƒæ•°æ®åŠ è½½, éœ€è¦è®¿é—®å¯¹è±¡çš„Typeå¯¹è±¡, æ¶‰åŠå…ƒæ•°æ®æŸ¥è¯¢<br>ç²¾ç¡®ç±»å‹æ¯”è¾ƒ: GetTypE()è¿”å›çš„æ˜¯å¯¹è±¡çš„å®é™…è¿è¡Œæ—¶ç±»å‹, ä¸typeof(MyType)æ¯”è¾ƒæ—¶,åªæœ‰å½“objçš„è¿è¡Œæ—¶ç±»å‹å®Œå…¨ç­‰äºMyTypeæ—¶æ‰è¿”å›true, <code>.GetType()</code>æ˜¯è™šæ–¹æ³•è°ƒç”¨, éœ€ç»è¿‡è™šæ–¹æ³•è¡¨æŸ¥æ‰¾.</li></ul><p>å½“ç„¶, <code>.GetType</code>ä¹Ÿæœ‰å…¶ç”¨æ­¦ä¹‹å¤„, å› ä¸ºåœ¨æœ‰äº›åœºæ™¯ä¸‹ç¡®å®æ˜¯éœ€è¦ç²¾ç¡®æŸ¥æ‰¾çš„, ç»§æ‰¿å…³ç³»A-&gt;B-&gt;C, Aæ˜¯åŸºç±», å¦‚æœä¼ å…¥çš„å®ä¾‹æ˜¯C, ä½¿ç”¨<code>is B</code>è¿”å›çš„ç»“æœæ˜¯true, è€Œä½¿ç”¨<code>.GetType() == typeof(B)</code> è¿”å›çš„æ˜¯false. å®é™…å¼€å‘ä¸­å¤§éƒ¨åˆ†åœºæ™¯ä¸‹<code>is</code>æ“ä½œç¬¦å°±è¶³å¤Ÿå®Œæˆéœ€æ±‚äº†.</p><p><strong>typeofã€GetType()ã€is å’Œ as è¿™å››ç§ç±»å‹åˆ¤æ–­æ“ä½œçš„å¼€é”€å¯¹æ¯”</strong></p><table><thead><tr><th>æ“ä½œ</th><th>å¼€é”€æ¥æº</th><th>é€‚ç”¨åœºæ™¯</th><th>ç¤ºä¾‹ä»£ç </th></tr></thead><tbody><tr><td>typeof(T)</td><td>âš¡ï¸ ç¼–è¯‘æ—¶é™æ€è§£æï¼ˆé›¶è¿è¡Œæ—¶å¼€é”€ï¼‰</td><td>ç¼–è¯‘æ—¶å·²çŸ¥ç±»å‹</td><td>if (type == typeof(MyClass))</td></tr><tr><td>is</td><td>âš¡ï¸ å•æ¬¡ç±»å‹æ£€æŸ¥ï¼ˆæ— è½¬æ¢ï¼‰</td><td>å®‰å…¨ç±»å‹æ£€æŸ¥</td><td>if (obj is MyClass)</td></tr><tr><td>as</td><td>âš¡ï¸ å•æ¬¡ç±»å‹æ£€æŸ¥ + è¿”å›è½¬æ¢ç»“æœ</td><td>å®‰å…¨ç±»å‹è½¬æ¢</td><td>var x = obj as MyClass;</td></tr><tr><td>GetType()</td><td>âš ï¸ è®¿é—®å¯¹è±¡ç±»å‹å¥æŸ„ + å…ƒæ•°æ®æŸ¥æ‰¾</td><td>éœ€è·å–å¯¹è±¡å®é™…è¿è¡Œæ—¶ç±»å‹</td><td>if (obj.GetType() == typeof(MyClass))</td></tr></tbody></table><p><strong>å€¼ç±»å‹ã€å¼•ç”¨ç±»å‹ä¸é—­åŒ…</strong></p><p>å› ä¸ºå€¼ç±»å‹çš„ç”Ÿå‘½å‘¨æœŸä¼šéšç€å…¶ä½œç”¨åŸŸçš„ç»“æŸè€Œé‡Šæ”¾æ‰, ä½†æ˜¯å¼•ç”¨ç±»å‹ä¸ä¼š, å¼•ç”¨ç±»å‹é‡Šæ”¾æ‰çš„åªæ˜¯æŒ‡å‘å †ä¸Šå†…å­˜ä½ç½®çš„æŒ‡é’ˆè€Œå·². æœ¬æ¥ç¬”è€…è®¡åˆ’ä½¿ç”¨é—­åŒ…çš„æ–¹å¼æŠŠä¸¤ç§ç±»å‹å¸¦å‡ºå…¶å„è‡ªçš„ä½œç”¨åŸŸ, ä¸è¿‡å®æ“ä¸‹æ¥, ä¸¤ç§ç±»å‹é‡Œé¢çš„æ•°æ®éƒ½æ˜¯æ­£å¸¸è¯»å–çš„. æ®GPTè¯´å€¼ç±»å‹çš„é—­åŒ…æ˜¯å°†æ•°æ®å¤åˆ¶äº†ä¸€ä»½ä¼ å…¥åˆ°äº†é—­åŒ…ä¸­, å› æ­¤åœ¨åŸå€¼ç±»å‹æ•°æ®ç”Ÿå‘½å‘¨æœŸå¤–æ•°æ®èƒ½æ­£ç¡®è¯»å–, è€Œå¼•ç”¨ç±»å‹åˆ™æ˜¯åœ¨å…¶ç”Ÿå‘½å‘¨æœŸç»“æŸä¹‹å, çœŸæ­£çš„æ•°æ®è¿˜éƒ½å­˜æ”¾åœ¨å †ä¸Šå‘¢æ ¹æœ¬å°±æ²¡é‡Šæ”¾æ‰å‘¢, å› æ­¤å¯ä»¥æ­£ç¡®è¯»å–, ä¸è¿‡ç¬”è€…ä¸ªäººçŒœæµ‹, å¼•ç”¨ç±»å‹æœ¬èº«(æˆ–è€…å«åˆ›å»ºåœ¨çº¿ç¨‹æ ˆä¸ŠæŒ‡å‘å †ä¸­æ•°æ®çš„æŒ‡é’ˆ)åœ¨ç”Ÿå‘½å‘¨æœŸç»“æŸåå…¶å®ä¹Ÿè¢«é‡Šæ”¾æ‰äº†, åœ¨é—­åŒ…ä¸­ä¹Ÿæ˜¯ä¼ å…¥äº†è¿™ä¸ªå¼•ç”¨ç±»å‹æœ¬èº«çš„ä¸€ä»½æ‹·è´è€Œå·². ä½†æ˜¯ç¬”è€…åœ¨è¿™é‡Œå°±ä¸æ·±ç©¶äº†.</p><h1>æ›´ä¼˜é›…çš„ç±»å‹è½¬æ¢</h1><p>æŒ‰ç…§GPTçš„è¯´æ³•, æ³›å‹æ˜¯ä¸€ç§èƒ½å¤Ÿè§„é¿ç±»å‹è½¬æ¢ã€ä¸”ä¿è¯ç±»å‹å®‰å…¨çš„åŒèµ¢æ–¹æ³•, æ³›å‹çš„ç±»å‹è½¬æ¢å¹¶ä¸æ˜¯åœ¨è¿è¡Œæ—¶åšçš„, è€Œæ˜¯åœ¨ç¼–è¯‘æ—¶ç¼–è¯‘å™¨é™é»˜åœ°è¿›è¡Œäº†ç±»å‹è½¬æ¢, å› æ­¤æ³›å‹åœ¨è¿è¡Œæ—¶æ˜¯æ²¡æœ‰é¢å¤–å¼€é”€çš„.</p><p>ä¸‹é¢çœ‹ä¸¤ç»„ä»£ç çš„å¯¹æ¯”:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">// éæ³›å‹æ¥å£</span><br><span class="line">public interface IUILogic</span><br><span class="line">&#123;</span><br><span class="line">    void OnShow(object data); // æ•°æ®ç”¨ object ä¼ é€’</span><br><span class="line">    void OnClose();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// éæ³›å‹åŸºç±»</span><br><span class="line">public abstract class BaseEUI : MonoBehaviour, IUILogic</span><br><span class="line">&#123;</span><br><span class="line">    public abstract void OnShow(object data);</span><br><span class="line">    public abstract void OnClose();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å…·ä½“ UI ç±»ï¼ˆéœ€æ‰‹åŠ¨è½¬æ¢æ•°æ®ï¼‰</span><br><span class="line">public class PlayPage : BaseEUI</span><br><span class="line">&#123;</span><br><span class="line">    public override void OnShow(object data)</span><br><span class="line">    &#123;</span><br><span class="line">        var showData = (PlayPageShowData)data; // è¿è¡Œæ—¶è½¬æ¢</span><br><span class="line">        // å®é™…é€»è¾‘...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public override void OnClose() &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// UI ç®¡ç†å™¨</span><br><span class="line">public class UIMgr</span><br><span class="line">&#123;</span><br><span class="line">    public static UIMgr Instance &#123; get; &#125; = new UIMgr();</span><br><span class="line">    private Dictionary&lt;Type, BaseEUI&gt; _uiInstances = new Dictionary&lt;Type, BaseEUI&gt;();</span><br><span class="line"></span><br><span class="line">    public void ShowUI(Type uiType, object data)</span><br><span class="line">    &#123;</span><br><span class="line">        if (_uiInstances.TryGetValue(uiType, out var ui))</span><br><span class="line">        &#123;</span><br><span class="line">            ui.OnShow(data); // éæ³›å‹è°ƒç”¨</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            var obj = Resources.Load(&quot;&quot;);</span><br><span class="line">            var go = Object.Instantiate(obj) as GameObject;</span><br><span class="line">            ui = go.AddComponent(uiType) as BaseEUI;</span><br><span class="line">            ui.OnShow(data);</span><br><span class="line">            _uiInstances.Add(uiType, ui);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è°ƒç”¨ç¤ºä¾‹</span><br><span class="line">var param = new PlayPageShowData();</span><br><span class="line">UIMgr.Instance.ShowUI(typeof(PlayPage), param); // éœ€æ˜¾å¼ä¼ é€’ Type</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">// æ³›å‹æ¥å£ï¼ˆç±»å‹å®‰å…¨ï¼‰</span><br><span class="line">public interface IUILogic&lt;TUIShowData&gt; where TUIShowData : struct</span><br><span class="line">&#123;</span><br><span class="line">    void OnShow(TUIShowData data); // æ˜ç¡®æ•°æ®ç±»å‹</span><br><span class="line">    void OnClose();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ³›å‹åŸºç±»</span><br><span class="line">public abstract class BaseEUI&lt;TUIShowData&gt; : MonoBehaviour, IUILogic&lt;TUIShowData&gt; </span><br><span class="line">    where TUIShowData : struct</span><br><span class="line">&#123;</span><br><span class="line">    public abstract void OnShow(TUIShowData data);</span><br><span class="line">    public abstract void OnClose();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å…·ä½“ UI ç±»ï¼ˆæ— éœ€æ‰‹åŠ¨è½¬æ¢æ•°æ®ï¼‰</span><br><span class="line">public class PlayPage : BaseEUI&lt;PlayPageShowData&gt;</span><br><span class="line">&#123;</span><br><span class="line">    public override void OnShow(PlayPageShowData data) // ç›´æ¥ä½¿ç”¨å…·ä½“ç±»å‹</span><br><span class="line">    &#123;</span><br><span class="line">        // ç›´æ¥è®¿é—® data çš„å­—æ®µï¼Œæ— éœ€ç±»å‹è½¬æ¢</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public override void OnClose() &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// UI ç®¡ç†å™¨ï¼ˆæ³›å‹ç‰ˆï¼‰</span><br><span class="line">public class UIMgr</span><br><span class="line">&#123;</span><br><span class="line">    public static UIMgr Instance &#123; get; &#125; = new UIMgr();</span><br><span class="line">    private Dictionary&lt;Type, object&gt; _uiInstances = new Dictionary&lt;Type, object&gt;();</span><br><span class="line"></span><br><span class="line">    // æ³›å‹æ–¹æ³•ï¼šç±»å‹å®‰å…¨ä¸”æ— è£…ç®±</span><br><span class="line">    public void ShowUI&lt;TUI, TUIShowData&gt;(TUIShowData data)</span><br><span class="line">        where TUI : BaseEUI&lt;TUIShowData&gt;, new()</span><br><span class="line">        where TUIShowData : struct</span><br><span class="line">    &#123;</span><br><span class="line">        if (_uiInstances.TryGetValue(typeof(TUI), out var ui))</span><br><span class="line">        &#123;</span><br><span class="line">            ((IUILogic&lt;TUIShowData&gt;)ui).OnShow(data); // éœ€ä¸€æ¬¡æ¥å£è½¬æ¢</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            var obj = Resources.Load(&quot;&quot;);</span><br><span class="line">            var go = Object.Instantiate(obj) as GameObject;</span><br><span class="line">            var uiLogic = go.AddComponent&lt;TUI&gt;();</span><br><span class="line">            uiLogic.OnShow(data);</span><br><span class="line">            _uiInstances.Add(typeof(TUI), uiLogic);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è°ƒç”¨ç¤ºä¾‹</span><br><span class="line">var param = new PlayPageShowData();</span><br><span class="line">UIMgr.Instance.ShowUI&lt;PlayPage, PlayPageShowData&gt;(param); // ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥</span><br></pre></td></tr></table></figure><p>å¯¹æ¯”ä¸Šé¢ä¸¤ç»„ä»£ç , éæ³›å‹æ–¹å¼æ‰“å¼€ä¸€ä¸ªUIè¦ç»è¿‡4æ¬¡ç±»å‹è½¬æ¢, è€Œä¸”è¿˜æœ‰è£…ç®±å’Œæ‹†ç®±çš„é£é™©; è€Œæ³›å‹ç‰ˆæœ¬æ‰“å¼€ä¸€ä¸ªUIåªéœ€è¦è¿›è¡Œ2æ¬¡ç±»å‹è½¬æ¢</p><p><strong>éæ³›å‹å’Œæ³›å‹æ–¹æ¡ˆå¯¹æ¯”</strong></p><table><thead><tr><th>ç‰¹æ€§</th><th>éæ³›å‹æ–¹æ¡ˆ</th><th>æ³›å‹æ–¹æ¡ˆ (IUILogic<T>)</th></tr></thead><tbody><tr><td>ç±»å‹å®‰å…¨</td><td>âŒ è¿è¡Œæ—¶å¯èƒ½ InvalidCastException</td><td>âœ”ï¸ ç¼–è¯‘æ—¶æ£€æŸ¥</td></tr><tr><td>æ•°æ®ä¼ é€’æ•ˆç‡</td><td>âš ï¸ å€¼ç±»å‹ä¼šè£…ç®±ï¼ˆstruct â†’ objectï¼‰</td><td>âœ”ï¸ æ— è£…ç®±ï¼ˆç›´æ¥ä¼ é€’ structï¼‰</td></tr><tr><td>ä»£ç å¤æ‚åº¦</td><td>âœ”ï¸ æ›´ç®€å•</td><td>âŒ éœ€è¦æ³›å‹çº¦æŸå’Œç±»å‹å‚æ•°</td></tr><tr><td>æ€§èƒ½å¼€é”€</td><td>âš ï¸ è£…ç®±/æ‹†ç®± + ç±»å‹è½¬æ¢</td><td>âš¡ï¸ æ— é¢å¤–å¼€é”€ï¼ˆé™¤å¯èƒ½çš„ as è½¬æ¢ï¼‰</td></tr><tr><td>æ‰©å±•æ€§</td><td>âŒ æ–°å¢ UI éœ€æ‰‹åŠ¨ç»´æŠ¤æ•°æ®ç±»å‹</td><td>âœ”ï¸ è‡ªåŠ¨é€‚é…ä¸åŒ TUIShowData</td></tr></tbody></table><p><strong>æ³¨æ„</strong> æ³›å‹ç¡®å®æ˜¯ä¸€ç§ååˆ†ä¼˜é›…çš„ç±»å‹è½¬æ¢æ–¹å¼, ä½†æ˜¯å¦„å›¾ä½¿ç”¨æ³›å‹æ›¿ä»£æ‰€æœ‰çš„ç±»å‹è½¬æ¢æ˜¯ä¸å¯èƒ½çš„. æ³›å‹åœ¨ä¸€å®šç¨‹åº¦ä¸Šç ´åäº†çªç ´äº†é¢å‘å¯¹è±¡çš„ç»§æ‰¿ç»“æ„çš„é™åˆ¶, ä½†æ˜¯ä½ æƒ³è¦åœ¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ä¸­ç¼–å†™éé¢å‘å¯¹è±¡çš„ä»£ç æ˜¯ååˆ†å›°éš¾çš„, çœ‹ä¸Šé¢UIMgrä»£ç çš„ä¾‹å­ä½ å°±çŸ¥é“äº†, UIMgrä½œä¸ºæ‰€æœ‰UIçš„ç®¡ç†è€…, å®ƒç®¡ç†è€…ä¸€ç±»UI, ä¸ºäº†å®ç°ç®¡ç†ä¸€ç»„å¯¹è±¡çš„æ•ˆæœ, è¿™ä¸€ç»„å¯¹è±¡åœ¨UIMgrçš„è§†è§’ä¸‹å¿…é¡»æ˜¯åŒä¸€ç§ç±»çš„, ä¹Ÿå°±æ˜¯å®ƒä»¬è¦å…·æœ‰åŒä¸€çˆ¶ç±», å› æ­¤å³ä¾¿æ³›å‹æ‰“ç ´äº†ç»§æ‰¿å…³ç³», ä½†æ˜¯åœ¨ç®¡ç†ä¸€ç»„å¯¹è±¡è¿™ç§é¢†åŸŸè¿˜æ˜¯æ— æ³•æ›¿ä»£æ™®é€šç±»å‹è½¬æ¢, æ‰€ä»¥åœ¨ç”±ä¸Šå±‚ç®¡ç†åˆ°åº•å±‚æ‰§è¡Œä¹‹é—´æœ‰ä¸€ä¸ªä¸å¯é¿å…çš„ç±»å‹è½¬æ¢, ä¸è¿‡è¿™ä¸€æ¬¡ç±»å‹è½¬æ¢æ˜¯å¿…å®šæˆåŠŸçš„, è¿™æ˜¯ç”±ä¸Šå±‚ç®¡ç†å’Œåº•å±‚å…·ä½“æ‰§è¡Œè§†è§’ä¸åŒå¯¼è‡´çš„.</p><h1>æ€»ç»“</h1><p>å› æ­¤, æ»¥ç”¨objectä½œä¸ºæ¥å£çš„å‚æ•°å¹¶ä¸æ˜¯ä¸€ç§ä¼˜é›…çš„æ–¹å¼, ç±»å‹è½¬æ¢åœ¨å®é™…å¼€å‘ä¸­ä¸å¯é¿å…, ä½†æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥é€šè¿‡æ³›å‹ç­‰æ–¹å¼å°½å¯èƒ½åœ°å‡å°‘ç±»å‹è½¬æ¢çš„å¼€é”€.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;ç±»å‹è½¬æ¢çš„å¼€é”€æ¥è‡ªå“ªé‡Œ?&lt;/h1&gt;
&lt;p&gt;ç±»å‹è½¬æ¢åœ¨æ—¶é—´å’Œç©ºé—´ä¸Šéƒ½ä¼šé€ æˆå¼€é”€, å› ä¸ºç±»å‹è½¬æ¢C#ç¼–è¯‘å™¨ä¼šç”Ÿæˆé¢å¤–çš„ç±»å‹è½¬æ¢å¤„ç†ä»£ç , å¯¼è‡´ä»£ç æ–‡ä»¶çš„ä½“ç§¯å˜å¤§. æ—¢ç„¶æœ‰é¢å¤–çš„ILä»£ç ç”Ÿæˆåˆ™å°±éœ€è¦æœ‰é¢å¤–çš„æ—¶é—´å»æ‰§è¡Œ. å¦‚æœç±»å‹è½¬æ¢ä¸­æ¶‰åŠåˆ°è£…æ‹†ç®±æ“ä½œ, åˆ™è¿˜ä¼šå¯¹è¿è¡Œæ—¶å†…å­˜äº§ç”Ÿå½±</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>UnityUGUIæºç </title>
    <link href="https://soincredible.github.io/posts/906aab82/"/>
    <id>https://soincredible.github.io/posts/906aab82/</id>
    <published>2025-04-19T08:46:20.000Z</published>
    <updated>2025-04-27T01:30:44.577Z</updated>
    
    <content type="html"><![CDATA[<h1>UGUIçš„æ¸²æŸ“å’Œ3Dç‰©ä½“æ¸²æŸ“çš„åŒºåˆ«?</h1><p>ç¬”è€…å¸Œæœ›å„ä½è¯»è€…åŒºåˆ†ä¸¤ä¸ªæ¦‚å¿µ: æ¸²æŸ“å’Œæ¸²æŸ“æ‰€éœ€çš„æ•°æ®æ›´æ–°. Unityé¦–å…ˆæ›´æ–°å…¶è¦æ¸²æŸ“ç‰©ä½“çš„æ¸²æŸ“æ•°æ®, ç„¶åæ ¹æ®æ¸²æŸ“æ•°æ®å°†ç”»é¢æ¸²æŸ“åˆ°å±å¹•ä¸Š, ç¬”è€…åœ¨æœ€åˆæ¥è§¦è¿™éƒ¨åˆ†å†…å®¹æ—¶, æŠŠä¸¤è€…æ··ä¸ºä¸€è°ˆ, ç»™è‡ªå·±é€ æˆäº†ç†è§£ä¸Šçš„å›°éš¾, å› æ­¤åœ¨æ­¤è¯´æ˜.</p><p>UGUIçš„æ¸²æŸ“å‘ç”Ÿåœ¨æ¯ä¸€å¸§<code>CanvasUpdateRegistry</code>çš„<code>SendWillRenderCanvases()</code>æ¥å£è¢«è°ƒç”¨ä¹‹å,ä¸è¿‡æˆ‘ä»¬çœ‹ä¸åˆ°è°ƒç”¨è¯¥æ¥å£çš„ä»£ç ,çŒœæµ‹è°ƒç”¨å¤„é€šè¿‡<code>[RequireByNativeCode]</code>ç‰¹æ€§éšè—åœ¨äº†Unityæ›´åº•å±‚çš„å¼•æ“ä»£ç ä¸­. ä½†è¿™ä¸å½±å“æˆ‘ä»¬çŸ¥é“UGUIçš„æ¸²æŸ“ä½äºäº‹ä»¶æ‰§è¡Œçš„ä»€ä¹ˆä½ç½®. ä¸ºäº†çŸ¥é“è¿™å‡ ä¸ªäº‹ä»¶çš„æ‰§è¡Œé¡ºåº,å› ä¸ºè¿™äº›äº‹ä»¶æ˜¯åœ¨æ¯ä¸€å¸§éƒ½æ‰§è¡Œçš„, æ‰€ä»¥ä½¿ç”¨æ–­ç‚¹è°ƒè¯•çš„æ–¹å¼ä¸å¤ªæ–¹ä¾¿, äºæ˜¯ç¬”è€…å°è¯•ä½¿ç”¨Logæ–¹å¼è§‚å¯Ÿå‡ ä¸ªäº‹ä»¶çš„æ‰§è¡Œé¡ºåº,</p><h1>CanvasScaler</h1><p>æŒ‰ç…§æ ‡å‡†åˆ†è¾¨ç‡æ¥è®¾è®¡çš„</p><p>Unityç²’å­çš„Renderå’ŒCanvasçš„OrderInLayeræ˜¯ä¸€æ ·çš„ ç”¨æ¥å¤„ç†æ¸²æŸ“å±‚çº§çš„é—®é¢˜</p><p>å¸¸è§„æ¨¡å‹å’Œç²’å­æ»¡è¶³è°è·ç¦»æ‘„åƒæœºè¿‘è°åæ¸²æŸ“<br>åœ¨Unityä¸­åˆ›å»ºä¸€ä¸ªåœºæ™¯ï¼Œåˆ›å»ºä¸¤ä¸ªImageï¼Œç„¶ååˆ›å»ºä¸€ä¸ªSphereï¼Œå°†Sphereæ”¾ç½®åœ¨ä¸¤ä¸ªImageä¸­é—´ï¼Œä¼šå‘ç”Ÿå¥‡æ€ªçš„äº‹æƒ…<br>UIå’Œå¸¸è§„æ¨¡å‹æ»¡è¶³è°è·ç¦»æ‘„åƒæœºè¿‘è°åæ¸²æŸ“<br>UIå’Œç²’å­å°±ä¸æ»¡è¶³è°è·ç¦»æ‘„åƒæœºè¿‘è°åæ¸²æŸ“ ä¸ºä»€ä¹ˆï¼Ÿ ç»™ç²’å­ç³»ç»ŸæŒ‚è½½RectTransformå°±ä¼šè¿™æ ·<br>ç§»é™¤RectTransformåå°±æ²¡æœ‰é—®é¢˜äº† RectTransformæ”¹å˜äº†ä»€ä¹ˆï¼Ÿ<br>RectTransformç»„ä»¶ä¸Šçš„Pos Zå­—æ®µå¯ä»¥è®¾ç½®æ¸¸æˆå¯¹è±¡çš„Zè½´ä½ç½®ï¼Œä½†æ˜¯ä¸å½±å“æ˜¾ç¤ºé¡ºåºï¼Œåœ¨åŒä¸€ä¸ªCanvasç”»å¸ƒä¸­ï¼Œæ¸¸æˆå¯¹è±¡çš„æ˜¾ç¤ºé¡ºåºç”±Hierarchyè§†å›¾ä¸­çš„é¡ºåºå†³å®š<br>å³ä¾¿æ˜¯åœ¨ä¸åŒçš„Canvasä¸­æƒ³é€šè¿‡è°ƒæ•´PosZå­—æ®µä¹Ÿä¸èƒ½å½±å“æ˜¾ç¤ºé¡ºåº å¤„ç†ä¸åŒCanvasçš„æ˜¾ç¤ºé¡ºåºæ˜¯é€šè¿‡ä¿®æ”¹Canvasçš„ OrderInLayerå€¼æ¥å®ç°çš„</p><p>ç–‘æƒ‘åœºæ™¯<br>ä¸¤ä¸ªCanvasï¼Œæ¯ä¸ªCanvasä¸‹é¢éƒ½æœ‰ä¸€ä¸ªImageç»„ä»¶ï¼ŒHierarchyçª—å£ä¸­Canvas1åœ¨Canvas2ä¸Šé¢ï¼Œæ— è®ºå¦‚ä½•è°ƒæ•´Canvas1å’ŒCanvas2çš„PosZå±æ€§ï¼Œåªè¦ä¸åŠ¨Canvasçš„OrderInLayerå±æ€§ï¼ŒCanvas2å°±ä¸€ç›´ä¼šæ˜¾ç¤ºåœ¨Canvas1ä¸Šé¢<br>Canvas1<br>Canvas2</p><p>å¦‚æœåœ¨åœºæ™¯ä¸­åˆ›å»ºä¸€ä¸ªSphere 3Dç‰©ä½“ï¼Œç‰©ä½“ä¸ŠæŒ‚è½½çš„æ˜¯Transformä¸æ˜¯RectTransformï¼Œè°ƒæ•´Sphereã€Canvas1ã€Canvas2çš„PosZå±æ€§ä½¿å¾—è·ç¦»æ‘„åƒæœºæœ‰è¿œåˆ°è¿‘çš„å…³ç³»ä¸ºï¼šCanvas2ã€Sphereã€Canvas1ï¼Œä¼šå‘ç°Sphereä¼šæ½œå…¥Canvas2ä¸­ï¼Œè€ŒCanvas1æœ¬åº”è¯¥è¢«Canvas2ç›–ä½ï¼Œä½†æ˜¯ç°åœ¨ä¹Ÿä¼šåœ¨Sphereé®æŒ¡Canvas2çš„åŒºåŸŸä¸­æ˜¾ç¤ºå‡ºæ¥ï¼ŒåŸå› æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>å°±ç®—åªæœ‰ä¸€ä¸ªCanvas ä¸‹æ·»åŠ ä¸¤ä¸ªImageç»„ä»¶ï¼ŒHierarchyä¸­Image1åœ¨Image2çš„ä¸Šé¢ å°±ç®—Image1çš„PosZæ¯”Image2çš„PosZè¦å° Image1è¿˜æ˜¯åº”è¯¥è¢«Image2æŒ¡ä½ï¼Œä½†æ˜¯å°†Sphereæ”¾åœ¨ä¸¤ä¸ªImageä¸­é—´çš„æ—¶å€™ä¹Ÿä¼šå‡ºç°ä¸Šè¿°æƒ…å†µï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p><p>RectTransformçš„PosZä¸èƒ½ç”¨æ¥å¤„ç†UIå…ƒç´ ä¹‹é—´çš„å±‚çº§å…³ç³» ä½†æ˜¯å¯ä»¥ç”¨æ¥å¤„ç†UIå’Œ3Dç‰©ä½“ä¹‹é—´çš„å±‚çº§å…³ç³»</p><p>Unityæ˜¯å¦‚ä½•æ¸²æŸ“UIçš„ï¼Ÿ</p><h1>Unityçš„æ¸²æŸ“é¡ºåº</h1><p>å¦‚æœå¼€å¯äº†æ·±åº¦æµ‹è¯•æ°¸è¿œéƒ½æ˜¯ç¦»æ‘„åƒæœºè¿‘çš„ç‰©ä½“è¯¥åœ¨ç¦»æ‘„åƒæœºè¿œçš„ç‰©ä½“ä¹‹å‰</p><h1>Canvas</h1><p>Canvasç»„ä»¶æä¾›äº†ä¸€ä¸ªä¾›UIå¸ƒå±€å’Œæ¸²æŸ“çš„æŠ½è±¡ç©ºé—´ã€‚æ‰€æœ‰çš„UIå…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæŒ‚è½½æœ‰Canvasç»„ä»¶çš„GameObjectçš„å­ã€‚å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªUIå…ƒç´ çš„æ—¶å€™ï¼Œå¦‚æœåœºæ™¯ä¸­è¿˜æ²¡æœ‰ä¸€ä¸ªå¸¦æœ‰Canvasçš„ç‰©ä½“ï¼Œé‚£ä¹ˆä¸€ä¸ªCanvasçš„Objectå°†ä¼šè‡ªåŠ¨è¢«åˆ›å»ºå‡ºæ¥ã€‚</p><h2 id="å±æ€§">å±æ€§</h2><ul><li>Render Mode: UIæ¸²æŸ“åˆ°å±å¹•ä¸Šæˆ–è€…æ˜¯ä½œä¸ºä¸€ä¸ªObjectè¢«æ¸²æŸ“åˆ°3Dç©ºé—´ä¸­çš„æ–¹å¼ã€‚å…±æœ‰ä¸‰ç§é€‰é¡¹ Screen Space - Overlayï¼Œ Screen Space - Cameraå’ŒWorld Space</li><li>Pixel Pefect(Screen Space modes only): ä¸ºäº†ç²¾åº¦UIæ˜¯å¦åº”è¯¥å…³é—­æŠ—é”¯é½¿å¹¶æ¸²æŸ“</li><li>Render Camera(Screen Space - Camera mode onle): UIè¦è¢«æ¸²æŸ“åˆ°å“ªä¸ªCameraä¸Š</li><li>Sort Order: ç”¨äºæ§åˆ¶ä¸é€šè¿‡Canvasä¹‹é—´çš„ç»˜åˆ¶é¡ºåºï¼Œæ•°å€¼è¶Šå¤§ï¼Œè¯¥canvasçš„ç»˜åˆ¶ä¼˜å…ˆçº§è¶Šé«˜ï¼Œä¼šç»˜åˆ¶åœ¨å…¶ä»–Canvasçš„ä¸Šæ–¹</li><li>Plane Distance(Screen Space - Camera mode only): è¢«æ¸²æŸ“çš„UIæ”¾ç½®åœ¨æ¸²æŸ“æ‘„åƒæœºå‰çš„è·ç¦»</li><li>Event Camera(World Space mode only): ç”¨æ¥è¿è¡ŒUI Eventçš„Camera</li><li>Receives Events: UIEventæ˜¯å¦ä¼šè¢«è¯¥Canvasé©±åŠ¨ï¼Ÿ</li></ul><h2 id="ç»†èŠ‚">ç»†èŠ‚</h2><p>å¯¹äºæ‰€æœ‰çš„UIå…ƒç´ å•ä¸ªCanvaså·²ç»æ˜¯è¶³å¤Ÿçš„äº†ï¼Œä½†æ˜¯åœ¨åœºæ™¯ä¸­æ”¾ç½®å¤šä¸ªCanvasä¹Ÿæ˜¯å¯ä»¥çš„ã€‚åŒæ ·åœ°ï¼Œä½¿ç”¨åµŒå¥—Canvasä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¸€èˆ¬æˆ‘ä»¬å‡ºäºä¼˜åŒ–çš„ç›®çš„ä¼šå°†ä¸€ä¸ªCanvasè®¾ç½®ä¸ºå¦ä¸€ä¸ªCanvasçš„å­èŠ‚ç‚¹ã€‚åµŒå¥—Canvasçš„Canvasé‡‡ç”¨å’Œçˆ¶Canvasç›¸åŒçš„æ¸²æŸ“æ¨¡å¼ã€‚</p><p>ä¼ ç»Ÿæ–¹å¼ä¸­ï¼Œæ‰€æœ‰çš„UIå°±åƒå®ƒä»¬æ˜¯ç®€å•çš„å›¾å½¢è®¾è®¡ä¸€æ ·è¢«ç›´æ¥åœ°æ¸²æŸ“åˆ°äº†å±å¹•ä¸Šã€‚è¿™å°±æ˜¯è¯´ï¼Œåœ¨Cameraçš„è§†è§’ä¸‹ï¼Œå®ƒä»¬æ˜¯æ²¡æœ‰3Dç©ºé—´çš„æ¦‚å¿µçš„ã€‚Unityæ”¯æŒè¿™ç§å±å¹•ç©ºé—´çš„æ¸²æŸ“å¹¶ä¸”åŒæ—¶æ”¯æŒUIä½œä¸ºObjectè¢«æ¸²æŸ“åˆ°3Dç©ºé—´ä¸­ï¼Œè¿™å–å†³äºRender Modeçš„å€¼ã€‚</p><h2 id="Screen-Space-Overlay">Screen Space - Overlay</h2><p>è¿™ç§æ¨¡å¼ä¸‹ï¼ŒCanvasä¼šè¢«ç¼©æ”¾ä»¥é€‚åº”å±å¹•ç„¶ååœ¨æ²¡æœ‰åœºæ™¯æˆ–è€…Cameraçš„å‚ç…§ä¸‹ç›´æ¥æ¸²æŸ“å‡ºæ¥ï¼ˆUIä¼šç›´æ¥æ¸²æŸ“å‡ºæ¥ï¼Œå³ä½¿åœºæ™¯ä¸­æ ¹æœ¬å°±æ²¡æœ‰Cameraï¼‰ã€‚å¦‚æœå±å¹•çš„å°ºå¯¸æˆ–è€…åˆ†è¾¨ç‡å‘ç”Ÿäº†æ”¹å˜ï¼Œé‚£ä¹ˆUIä¼šè‡ªåŠ¨åœ°é‡æ–°ç¼©æ”¾æ¥é€‚åº”æ–°çš„å°ºå¯¸ã€‚UIä¼šç»˜åˆ¶åœ¨ä»»ä½•å…¶ä»–å›¾å½¢æ¯”å¦‚æ‘„åƒæœºè§†è§’çš„ä¸Šå±‚</p><p>æ³¨æ„ï¼šScreen Space - Overlayæ¨¡å¼ä¸‹ï¼ŒæŒ‚è½½canvasçš„èŠ‚ç‚¹å¿…é¡»æ˜¯åœ¨hierarchyçª—å£ä¸­çš„æœ€ä¸Šçº§çš„èŠ‚ç‚¹ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·ä½¿ç”¨canvasçš„è¯å¯èƒ½ä¼šå¯¼è‡´UIä»è§†é‡é‡Œæ¶ˆå¤±ã€‚è¿™æ˜¯ä»Unityå¼•æ“è®¾è®¡ä¸Šçš„å±€é™ï¼Œå› æ­¤ä¿æŒScreenSpace - Overlay canvasåœ¨hierarchyçš„æœ€é¡¶å±‚ä»¥ä¿è¯èƒ½å¤Ÿè·å¾—æœŸæœ›çš„æ•ˆæœ</p><h2 id="Screen-Space-Camera">Screen Space - Camera</h2><p>åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒCanvasä¼šè¢«æ¸²æŸ“åœ¨ä¸€ä¸ªå¹³é¢çš„ç‰©ä½“ä¸Šï¼Œè¯¥å¹³é¢è·ç¦»ç»™å®šçš„æ‘„åƒæœºæœ‰ä¸€å®šçš„è·ç¦»ï¼Œè¿™ç§æ¨¡å¼ä¸‹çš„UIæ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„å°ºå¯¸å¹¶ä¸ä¼šéšç€è·ç¦»è€Œå˜åŒ–ï¼Œå› ä¸ºå®ƒæ€»æ˜¯ä¼šé‡æ–°ç¼©æ”¾æ¥é€‚åº”Cameraçš„å¹³æˆªå¤´ä½“ä¸­ï¼Œå¦‚æœå±å¹•çš„å°ºå¯¸æˆ–è€…åˆ†è¾¨ç‡æˆ–è€…Cameraçš„å¹³æˆªå¤´ä½“å‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆè¯¥UIä¼šè‡ªåŠ¨çš„ç¼©æ”¾æ¥é€‚åº”æ”¹å˜è¯ã€‚ä»»ä½•åœ¨åœºæ™¯ä¸­çš„3Dç‰©ä½“å¦‚æœè·ç¦»æ‘„åƒæœºæ¯”è¯¥UIè¿‘çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šè¢«æ¸²æŸ“åœ¨è¯¥UIçš„å‰é¢ï¼Œè€Œåœ¨UIåé¢çš„ç‰©ä½“å°±ä¼šè¢«é®æŒ¡</p><h2 id="World-Space">World Space</h2><p>è¿™ç§æ¨¡å¼ä¸‹çš„UIä¼šæƒ³ä¸€ä¸ªå¹³é¢çš„ç‰©ä½“ä¸€æ ·è¢«æ¸²æŸ“åœ¨åœºæ™¯ä¸­ï¼Œä¸æƒ³Screen Space - Cameraä¸€æ ·ï¼Œè¿™ç§æ¨¡å¼ä¸‹çš„UIä¸éœ€è¦é¢å‘æ‘„åƒæœºå¹¶ä¸”å¯ä»¥æœå‘ä»»ä½•æ–¹å‘ï¼Œè¿™ç§æ¨¡å¼ä¸‹çš„Canvasçš„å°ºå¯¸å¯ä»¥é€šè¿‡è¯¥èŠ‚ç‚¹ä¸Šçš„RectTransformç»„ä»¶è¿›è¡Œè®¾ç½®ã€‚è€Œå®ƒçš„æ˜¾ç¤ºæ•ˆæœå–å†³äºè§‚çœ‹è§’åº¦å’Œè¯¥UIè·ç¦»Cameraçš„è·ç¦»ï¼Œå…¶ä»–åœºæ™¯ä¸­çš„ç‰©ä½“å¯ä»¥ç©¿è¿‡è¯¥UIï¼Œæˆ–è€…åœ¨å®ƒçš„å‰é¢ï¼Œæˆ–è€…åœ¨å®ƒçš„åé¢</p><h1>CanvasScaler</h1><p>Canvas Scalerç»„ä»¶ç”¨æ¥æ§åˆ¶UIå…ƒç´ åœ¨Canvasä¸Šçš„æ•´ä½“ç¼©æ”¾å’Œåƒç´ å¯†åº¦ã€‚è¿™ä¸ªç»„ä»¶ä¼šå½±å“æ‰€æœ‰çš„ä½äºè¯¥Canvasç»„ä»¶ä¸‹çš„UIå…ƒç´ ï¼ŒåŒ…æ‹¬å­—ä½“å¤§å°å’Œå›¾ç‰‡çš„è¾¹ç•Œ</p><h2 id="å±æ€§-2">å±æ€§</h2><ul><li>UIScaleMode:  å†³å®šåœ¨è¯¥Canvasä¸Šçš„UIå…ƒç´ è¯¥å¦‚ä½•è¿›è¡Œç¼©æ”¾<ul><li>ConstantPixelSize: è®©UIå…ƒç´ ä¿æŒç›¸åŒçš„åƒç´ ä¸è®ºå±å¹•çš„å°ºå¯¸<ul><li>Scale Factor: è¯¥Canvasä¸­çš„æ‰€æœ‰UIå…ƒç´ çš„ç¼©æ”¾å—è¯¥factorå½±å“</li><li>ReferencePixelsPerUnit: å¦‚æœä¸€ä¸ªspriteè¿›è¡Œäº†Pixel Per Unityçš„è®¾ç½®ï¼Œé‚£ä¹ˆåœ¨è¯¥spriteä¸­çš„ä¸€ä¸ªåƒç´ å°†ä¼šè¦†ç›–ä¸€ä¸ªå•å…ƒ</li></ul></li><li>ScaleWithScreenSize: å±å¹•çš„å°ºå¯¸è¶Šå¤§ï¼ŒUIå…ƒç´ ä¹Ÿè¶Šå¤§<ul><li>Reference Resolution: UIå¸ƒå±€æ˜¯åŸºäºæ­¤åˆ†è¾¨ç‡è®¾è®¡çš„ï¼Œå¦‚æœå±å¹•åˆ†è¾¨ç‡æ›´å¤§ï¼Œé‚£ä¹ˆUIä¼šè¢«æ”¾å¤§ï¼Œåä¹‹UIä¼šè¢«ç¼©å°</li><li>ScreenMatchMode: ä¸€ç§æ¨¡å¼ç”¨æ¥é€‚åº”ä¸åŒåˆ†è¾¨ç‡UIçš„ç¼©æ”¾æ–¹å¼<ul><li>Match Width or Height: å¦‚æœè®¾å¤‡çš„åˆ†è¾¨ç‡å’Œé»˜è®¤åˆ†è¾¨ç‡ä¸åŒ¹é…çš„è¯ï¼Œé‚£ä¹ˆæ˜¯ä¿è¯å®½å’ŒåŸåˆ†è¾¨ç‡æˆæ¯”ä¾‹è¿˜æ˜¯é«˜ä¸åŸåˆ†è¾¨ç‡æˆæ¯”ä¾‹</li><li>Expand:</li><li>Shrink:</li></ul></li><li>Match: å†³å®š</li><li>Reference Pixels Per Unit</li></ul></li><li>ConstantPhysicalSize: è®©UIå…ƒç´ ä¿æŒåŒæ ·çš„ç‰©ç†å°ºå¯¸çš„å¤§å°è€Œä¸ç®¡å±å¹•çš„å°ºå¯¸å’Œåˆ†è¾¨ç‡<ul><li>Physical Unit:</li><li>Fallback Screen DPI</li><li>Default Sprite DPI</li><li>Reference Pixels Per Unit</li></ul></li></ul></li><li>å½“Canvasçš„RenderModeè¢«è®¾ç½®ä¸ºWorldSpaceçš„æ—¶å€™<ul><li>Dynamic Pixels Per Unitï¼š è¡¨ç¤ºUIä¸­åŠ¨æ€åˆ›å»ºçš„ä½å›¾ï¼Œæ¯”å¦‚Textï¼Œä¸­å•ä¸ªå•å…ƒçš„åƒç´ æ•°é‡</li><li>Reference Pixels Per Unit:  å¦‚æœä¸€ä¸ªspriteæœ‰è¿™ä¸ªPixels Per Unityçš„è®¾ç½®ï¼Œé‚£ä¹ˆåœ¨Spriteä¸­çš„ä¸€ä¸ªåƒç´ å°†ä¼šè¦†ç›–ä¸–ç•Œåœºæ™¯ä¸­éŸ©çš„ä¸€ä¸ªå•å…ƒï¼Œå¦‚æœReference Pixel Per Unit è¢«è®¾ç½®ä¸ºäº†1ï¼Œé‚£ä¹ˆåœ¨spriteä¸­çš„Pixels Per Unitè®¾ç½®å°†ä¼šè¢«ç›´æ¥ä½¿ç”¨</li></ul></li></ul><h2 id="ç»†èŠ‚-2">ç»†èŠ‚</h2><p>å¯¹äºè¢«è®¾ç½®ä¸ºScreen Space - Overlay æˆ–è€… Screen Space - Camera çš„ Canvasï¼ŒCanvas Scaler UI çš„ Scale Mode å¯ä»¥è¢«è®¾ç½®ä¸ºConstant PixelSizeï¼Œ Scale With Screen æˆ–è€… Constant Physical Size</p><h2 id="Constant-Pixel-Size">Constant Pixel Size</h2><h2 id="Scale-With-Screen-Size">Scale With Screen Size</h2><h2 id="Constant-Physical-Size">Constant Physical Size</h2><h2 id="World-Space-2">World Space</h2><h1>CanvasGroup</h1><p>CanvasGroupç”¨æ¥æ§åˆ¶æŸäº›æ–¹é¢</p><h1>CanvasRenderer</h1><p>Canvas Renderer ç»„ä»¶å°†ä¸€ä¸ªCanvasä¸­çš„ä¸€ä¸ªå›¾åƒUIæ¸²æŸ“å‡ºæ¥ï¼Œè¯¥ç»„ä»¶éœ€è¦æŒ‚è½½åœ¨æ¯ä¸€ä¸ªéœ€è¦æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„UIç»„ä»¶ä¸Šï¼ŒCanvas Rendererç»„ä»¶æ²¡æœ‰ä»»ä½•å±æ€§æš´éœ²åœ¨inspectorçª—å£ä¸­</p><h2 id="ç»†èŠ‚-3">ç»†èŠ‚</h2><p>åœ¨Unityçš„èœå•ä¸­å¯ä»¥åˆ›å»ºçš„æ ‡å‡†çš„UIç»„ä»¶ä¸Šä¸è®ºä½ éœ€ä¸éœ€è¦éƒ½æŒ‚è½½æœ‰Canvas Rendererç»„ä»¶ï¼Œä½†æ˜¯å½“æˆ‘ä»¬å¼€å‘æˆ‘ä»¬è‡ªå®šä¹‰çš„UIç»„ä»¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å°†è¯¥ç»„ä»¶æŒ‚è½½åˆ°è‡ªå®šä¹‰UIä¸Šï¼Œå°½ç®¡åœ¨Inspectorçª—å£ä¸­æ²¡æœ‰ä»»ä½•çš„å±æ€§ï¼Œä½†æ˜¯æœ‰ä¸€äº›å±æ€§å’ŒåŠŸèƒ½è¿˜æ˜¯å¯ä»¥é€šè¿‡ä»£ç çš„å½¢å¼æ¥æ§åˆ¶</p><h1>GraphicRaycaster</h1>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;UGUIçš„æ¸²æŸ“å’Œ3Dç‰©ä½“æ¸²æŸ“çš„åŒºåˆ«?&lt;/h1&gt;
&lt;p&gt;ç¬”è€…å¸Œæœ›å„ä½è¯»è€…åŒºåˆ†ä¸¤ä¸ªæ¦‚å¿µ: æ¸²æŸ“å’Œæ¸²æŸ“æ‰€éœ€çš„æ•°æ®æ›´æ–°. Unityé¦–å…ˆæ›´æ–°å…¶è¦æ¸²æŸ“ç‰©ä½“çš„æ¸²æŸ“æ•°æ®, ç„¶åæ ¹æ®æ¸²æŸ“æ•°æ®å°†ç”»é¢æ¸²æŸ“åˆ°å±å¹•ä¸Š, ç¬”è€…åœ¨æœ€åˆæ¥è§¦è¿™éƒ¨åˆ†å†…å®¹æ—¶, æŠŠä¸¤è€…æ··ä¸ºä¸€è°ˆ, ç»™è‡ªå·±é€ æˆäº†ç†è§£ä¸Šçš„å›°éš¾, </summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Unityäº‹ä»¶æ›´æ–°é¡ºåº</title>
    <link href="https://soincredible.github.io/posts/11d7edcb/"/>
    <id>https://soincredible.github.io/posts/11d7edcb/</id>
    <published>2025-04-18T22:33:36.000Z</published>
    <updated>2025-04-27T01:30:44.577Z</updated>
    
    <content type="html"><![CDATA[<h1>Unityäº‹ä»¶æ‰§è¡Œé¡ºåºå›¾</h1><p><a href="https://docs.unity3d.com/cn/2022.3/uploads/Main/monobehaviour_flowchart.svg"></a></p><h1>Awakeã€OnDestroyã€OnEnableã€OnDisableå››è€…æ‰§è¡Œæ—¶æœºæ¢³ç†</h1><p><code>OnEnable</code>æ–¹æ³•åœ¨AddComponentã€<strong>è·Ÿéšé¢„åˆ¶ä½“å®ä¾‹åŒ–(è¿™é‡Œè¦ååˆ†æ³¨æ„æŒ‚è½½è¯¥è„šæœ¬çš„GameObjçš„avtiveçŠ¶æ€è¦æ˜¯trueçš„æƒ…å†µä¸‹æ‰ä¼šè§¦å‘!)</strong>ã€åœ¨ä»£ç ä¸­æ‰‹åŠ¨è®¾ç½®enableä¸ºtrueçš„æ—¶å€™ä¼šè°ƒç”¨.<br><code>OnDisable</code>æ–¹æ³•æ˜¯è·Ÿéšé¢„åˆ¶ä½“è¢«åˆ é™¤ã€åœ¨ä»£ç ä¸­æ‰‹åŠ¨è®¾ç½®enableä¸ºfalseçš„æ—¶å€™ä¼šè°ƒç”¨.</p><p><code>Awake</code>æ–¹æ³•åœ¨AddComponentã€<strong>è·Ÿéšé¢„åˆ¶ä½“å®ä¾‹åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨(è¿™é‡Œè¦ååˆ†æ³¨æ„æŒ‚è½½è¯¥è„šæœ¬çš„GameObjçš„avtiveçŠ¶æ€è¦æ˜¯trueçš„æƒ…å†µä¸‹æ‰ä¼šè§¦å‘!)</strong>. æ•´ä¸ªç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸåªä¼šè°ƒç”¨ä¸€æ¬¡<br><code>OnDestroy</code>æ–¹æ³•åœ¨è·Ÿéšé¢„åˆ¶ä½“è¢«åˆ é™¤çš„æ—¶å€™è°ƒç”¨. æ•´ä¸ªç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸåªä¼šè°ƒç”¨ä¸€æ¬¡ <strong>æ³¨æ„,å¦‚æœåœ¨è¿™ä¸ªé¢„åˆ¶ä½“è¢«å®ä¾‹åŒ–åˆ°é”€æ¯çš„è¿™ä¸€ç”Ÿå‘½å‘¨æœŸå†…,æŒ‚è½½è¯¥è„šæœ¬çš„èŠ‚ç‚¹çš„activeä¸€ç›´éƒ½æ˜¯false,é‚£ä¹ˆå°±ä¸ä¼šè§¦å‘Awake,ä¹Ÿä¸ä¼šè§¦å‘OnDestroy,åªè¦è¯¥èŠ‚ç‚¹è¢«activeè¿‡,å³ä¾¿è¢«é”€æ¯çš„æ—¶å€™è¯¥èŠ‚ç‚¹å¤„åœ¨not activeçŠ¶æ€,ä¹Ÿä¼šè§¦å‘OnDestroy</strong></p><ul><li><code>yield WaitForEndOfFrame</code>æ˜¯åœ¨å¹²å˜›?</li></ul><p>åœ¨éPlayModeä¸‹,æœ‰å“ªäº›ç”Ÿå‘½å‘¨æœŸå†…çš„æ–¹æ³•ä¼šè¢«æ‰§è¡Œ?<br>åœ¨Unityå¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦åœ¨ç¼–è¾‘å™¨å¯åŠ¨æ—¶æˆ–è„šæœ¬é‡æ–°ç¼–è¯‘åæ‰§è¡Œä¸€äº›æ“ä½œï¼Œä¾‹å¦‚åˆå§‹åŒ–æ•°æ®ã€æ³¨å†Œäº‹ä»¶ç­‰ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨InitializeOnLoadç‰¹æ€§æ¥å®ç°è¿™ä¸€éœ€æ±‚ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»InitializeOnLoadç‰¹æ€§çš„ç”¨æ³•ï¼Œå¹¶é€šè¿‡ä¸‰ä¸ªå®é™…æ¡ˆä¾‹æ¥å±•ç¤ºå…¶åº”ç”¨åœºæ™¯ã€‚</p><p>OnValidateæ–¹æ³•æ˜¯ä¸€ä¸ªä»…é™ç¼–è¾‘å™¨çš„å‡½æ•°ï¼Œåœ¨UnityåŠ è½½è„šæœ¬æˆ–æ£€æŸ¥å™¨ä¸­çš„å€¼æ›´æ”¹æ—¶è°ƒç”¨ã€‚å®ƒçš„è°ƒç”¨æ—¶æœºéå¸¸ç‰¹æ®Šï¼Œè¿™é‡Œæ€»ç»“ä¸€ä¸‹ã€‚</p><ol><li><p>OnValidateä¸å—æ’­æ”¾æ¨¡å¼å½±å“ï¼Œåªè¦å…¶å€¼å‘ç”Ÿå˜åŒ–ï¼Œåœ¨éæ’­æ”¾çŠ¶æ€ä¸‹ä¹Ÿä¼šè¢«è°ƒç”¨ï¼ˆå¯ä»¥ç”¨äºéæ’­æ”¾æ¨¡å¼ä¿®æ”¹å‚æ•°åæ›´æ–°ï¼‰ã€‚</p></li><li><p>ä¸å—enabledçŠ¶æ€å½±å“ï¼Œå³ä½¿å…¶æ‰€åœ¨çš„è„šæœ¬è¢«ç¦ç”¨ï¼Œä¿®æ”¹å€¼æ—¶ä¹Ÿä¼šè¢«æ­£å¸¸è°ƒç”¨ã€‚</p></li><li><p>æ›´æ”¹è„šæœ¬enabledçŠ¶æ€æ—¶ï¼Œä¼šè°ƒç”¨ä¸€æ¬¡OnValidateã€‚å¦‚æœåœ¨Play Modeï¼ŒOnValidatedçš„è°ƒç”¨æ—¶æœºåœ¨OnDisableæˆ–è€…OnEnableå‰ã€‚</p></li><li><p>æ›´æ”¹GameObject activeçŠ¶æ€ä¸ä¼šè°ƒç”¨OnValidateï¼Œåªæœ‰OnDisableå’ŒOnEnableä¼šè¢«è°ƒç”¨ã€‚</p></li><li><p>åˆå§‹åŠ è½½æ—¶ï¼Œæ— è®ºenabledçŠ¶æ€å’ŒactiveçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šè¢«è°ƒç”¨å¤šæ¬¡ã€‚å…¶è°ƒç”¨æ—¶æœºåœ¨Awakeä¹‹å‰ã€‚</p></li></ol><p>å¸¸è§ç”¨æ³•ï¼š</p><ol><li><p>ç”¨äºPlay Modeä¸‹ä¿®æ”¹å‚æ•°å€¼ï¼Œå®æ—¶æŸ¥çœ‹æ•ˆæœ</p></li><li><p>å®æ—¶æ›´æ–°èµ„äº§æ–‡ä»¶ï¼Œæ¯”å¦‚æè´¨ã€shaderç­‰</p></li></ol><h1>å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://blog.csdn.net/angry_youth/article/details/117469722">https://blog.csdn.net/angry_youth/article/details/117469722</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;Unityäº‹ä»¶æ‰§è¡Œé¡ºåºå›¾&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.unity3d.com/cn/2022.3/uploads/Main/monobehaviour_flowchart.svg&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h1&gt;Awakeã€OnDestroyã€</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>UnityShaderå®ç°æ°´çš„æ•ˆæœ</title>
    <link href="https://soincredible.github.io/posts/265490d3/"/>
    <id>https://soincredible.github.io/posts/265490d3/</id>
    <published>2025-04-18T22:28:48.000Z</published>
    <updated>2025-04-27T01:30:44.577Z</updated>
    
    
    
    
    
  </entry>
  
  <entry>
    <title>UnityShaderå®ç°è‰çš„æ•ˆæœ</title>
    <link href="https://soincredible.github.io/posts/b1964c5e/"/>
    <id>https://soincredible.github.io/posts/b1964c5e/</id>
    <published>2025-04-18T22:28:32.000Z</published>
    <updated>2025-04-27T01:30:44.577Z</updated>
    
    
    
    
    
  </entry>
  
  <entry>
    <title>UnityShaderå®ç°äº‘çš„æ•ˆæœ</title>
    <link href="https://soincredible.github.io/posts/81b49e5c/"/>
    <id>https://soincredible.github.io/posts/81b49e5c/</id>
    <published>2025-04-18T22:28:19.000Z</published>
    <updated>2025-04-27T01:30:44.577Z</updated>
    
    
    
    
    
  </entry>
  
  <entry>
    <title>UnityUGUIé—®é¢˜è®°å½•</title>
    <link href="https://soincredible.github.io/posts/2b97ac4f/"/>
    <id>https://soincredible.github.io/posts/2b97ac4f/</id>
    <published>2025-04-18T22:25:47.000Z</published>
    <updated>2025-05-07T12:15:13.507Z</updated>
    
    <content type="html"><![CDATA[<h1>ä¸ºä»€ä¹ˆä¼šæœ‰<code>LayoutRebuilder.ForceRebuildLayoutImmediate(RectTransform)</code>æ¥å£? ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸ªæ¥å£?</h1><p>æˆ‘ä»¬åœ¨æŸä¸€å¸§çš„Updateæˆ–è€…EventInputä¸­æ‰§è¡Œäº†ä¸€æ®µä»£ç , è¿™æ®µä»£ç ä¼šä¿®æ”¹æŸä¸€UGUIç»„ä»¶çš„æŸäº›å±æ€§,æˆ‘ä»¬çŸ¥é“,å½“ä¸€ä¸ªUGUIç»„ä»¶çš„å±æ€§å‘ç”Ÿå˜åŒ–æ—¶,è¿™ä¸ªUGUIç»„ä»¶ä¸‹é¢çš„æ‰€æœ‰UGUIç»„ä»¶çš„å±æ€§ä¹Ÿä¼šè¿å¸¦ç€å‘ç”Ÿå˜åŒ–. ä½†æ˜¯åœ¨ä¸€å¸§å†…,è¿™ç§å˜åŒ–ä¸æ˜¯çœŸçš„åŒæ—¶å‘ç”Ÿçš„,UGUIçš„æ•°æ®æ›´æ–°å‘ç”Ÿåœ¨<code>LateUpdate</code>ä¹‹å,<code>OnPreCull</code>ä¹‹å‰. è¿™æ˜¯ç¬”è€…è¿˜äº²è‡ªéªŒè¯çš„. å…·ä½“éªŒè¯è¿‡ç¨‹åœ¨<a href="">è¿™ç¯‡åšå®¢</a>ä¸­.ä¹Ÿå°±æ˜¯è¯´Unityä¼šå…ˆæ‰§è¡Œå®Œæ‰€æœ‰çš„ä»£ç é€»è¾‘, ç„¶åå†å»æ›´æ–°è¿™äº›UGUIç»„ä»¶çš„å±æ€§, æ‰€ä»¥åœ¨è¿™ä¸€å¸§ä¸­æˆ‘ä»¬æ‰§è¡Œçš„ä¿®æ”¹UGUIç»„ä»¶å±æ€§çš„æ“ä½œ,åªæœ‰åœ¨ä¸‹ä¸€å¸§æ—¶,æˆ‘ä»¬æ‰èƒ½å¤Ÿæ‹¿åˆ°è¿™ä¸ªç»„ä»¶ä¸‹UGUIç»„ä»¶çš„å±æ€§çš„æ­£ç¡®å€¼.<br>å¦‚æœæˆ‘ä»¬æƒ³åœ¨å½“å‰è¿™ä¸€å¸§å°±è·å¾—æ­£ç¡®çš„UGUIç»„ä»¶çš„å±æ€§,é‚£ä¹ˆ<code>LayoutRebuilder.ForceRebuildLayoutImmediate(RectTransform)</code>æ¥å£å°±æ´¾ä¸Šç”¨åœºäº†. è¿™ä¸ªæ¥å£ä¼šå¼ºåˆ¶æ›´æ–°ä¼ å…¥UGUIåŠå…¶å­UGUIçš„RectTransformç»„ä»¶çš„å±æ€§, ç„¶åæˆ‘ä»¬å°±å¯ä»¥åœ¨å½“å‰å¸§è·å¾—æ­£ç¡®çš„å±æ€§å€¼äº†. åœ¨ç¬”è€…çš„å¼€å‘ç»éªŒä¸­, è¯¥æ¥å£ä¸€èˆ¬ä¼šåœ¨ä½¿ç”¨UGUIé‡Œçš„Layoutç›¸å…³ç»„ä»¶çš„æ—¶å€™æ¯”è¾ƒå¸¸ç”¨.</p><h1>å‡ ä¸ªLayoutGroupç»„ä»¶çš„å®ç°åŸç†</h1><p>ä¸€ä¸ªä¾‹å­å°±æ˜¯è®©çˆ¶UIç»„ä»¶çš„å°ºå¯¸è·Ÿç€å­UIç»„ä»¶çš„å°ºå¯¸å˜åŒ–<br><a href="https://blog.csdn.net/yhx956058885/article/details/130729325">https://blog.csdn.net/yhx956058885/article/details/130729325</a></p><h1>Coffee UIEffectè¿™ä¸ªUIæ‰©å±•åº“ é‡Œé¢çš„UIShadowç»„ä»¶ä¸Šçš„å€¼çš„å®ç°åŸç†å’Œä¸åŒæ˜¯ä»€ä¹ˆ? Outlineå’ŒOutline8çš„åŒºåˆ«? Fitè¿˜æœ‰ä¸€ä¸ªä»€ä¹ˆå¿˜äº†çš„åŒºåˆ«?</h1><h1>Screenæ¥å£ä¸­çš„widthå’Œheight å’Œ currentResolutionçš„åŒºåˆ«?</h1><h1>è®©UIå˜ç°è‰²</h1><p>ç»™UIè¦å˜ç°çš„UIç»„ä»¶æŒ‚è½½ä¸€ä¸ªå˜ç°æè´¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;UI/Gray&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        [PerRendererData] _MainTex (&quot;Sprite Texture&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _Color (&quot;Tint&quot;, Color) = (1,1,1,1)</span><br><span class="line"></span><br><span class="line">        _StencilComp (&quot;Stencil Comparison&quot;, Float) = 8</span><br><span class="line">        _Stencil (&quot;Stencil ID&quot;, Float) = 0</span><br><span class="line">        _StencilOp (&quot;Stencil Operation&quot;, Float) = 0</span><br><span class="line">        _StencilWriteMask (&quot;Stencil Write Mask&quot;, Float) = 255</span><br><span class="line">        _StencilReadMask (&quot;Stencil Read Mask&quot;, Float) = 255</span><br><span class="line"></span><br><span class="line">        _ColorMask (&quot;Color Mask&quot;, Float) = 15</span><br><span class="line"></span><br><span class="line">        [Toggle(UNITY_UI_ALPHACLIP)] _UseUIAlphaClip (&quot;Use Alpha Clip&quot;, Float) = 0</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Queue&quot;=&quot;Transparent&quot;</span><br><span class="line">            &quot;IgnoreProjector&quot;=&quot;True&quot;</span><br><span class="line">            &quot;RenderType&quot;=&quot;Transparent&quot;</span><br><span class="line">            &quot;PreviewType&quot;=&quot;Plane&quot;</span><br><span class="line">            &quot;CanUseSpriteAtlas&quot;=&quot;True&quot;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Stencil</span><br><span class="line">        &#123;</span><br><span class="line">            Ref [_Stencil]</span><br><span class="line">            Comp [_StencilComp]</span><br><span class="line">            Pass [_StencilOp]</span><br><span class="line">            ReadMask [_StencilReadMask]</span><br><span class="line">            WriteMask [_StencilWriteMask]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Cull Off</span><br><span class="line">        Lighting Off</span><br><span class="line">        ZWrite Off</span><br><span class="line">        ZTest [unity_GUIZTestMode]</span><br><span class="line">        Blend SrcAlpha OneMinusSrcAlpha</span><br><span class="line">        ColorMask [_ColorMask]</span><br><span class="line"></span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Name &quot;Default&quot;</span><br><span class="line">        CGPROGRAM</span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line">            #pragma target 2.0</span><br><span class="line"></span><br><span class="line">            #include &quot;UnityCG.cginc&quot;</span><br><span class="line">            #include &quot;UnityUI.cginc&quot;</span><br><span class="line"></span><br><span class="line">            #pragma multi_compile __ UNITY_UI_CLIP_RECT</span><br><span class="line">            #pragma multi_compile __ UNITY_UI_ALPHACLIP</span><br><span class="line"></span><br><span class="line">            struct appdata_t</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex   : POSITION;</span><br><span class="line">                float4 color    : COLOR;</span><br><span class="line">                float2 texcoord : TEXCOORD0;</span><br><span class="line">                UNITY_VERTEX_INPUT_INSTANCE_ID</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex   : SV_POSITION;</span><br><span class="line">                fixed4 color    : COLOR;</span><br><span class="line">                float2 texcoord  : TEXCOORD0;</span><br><span class="line">                float4 worldPosition : TEXCOORD1;</span><br><span class="line">                UNITY_VERTEX_OUTPUT_STEREO</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            fixed4 _Color;</span><br><span class="line">            fixed4 _TextureSampleAdd;</span><br><span class="line">            float4 _ClipRect;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line"></span><br><span class="line">            v2f vert(appdata_t v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f OUT;</span><br><span class="line">                UNITY_SETUP_INSTANCE_ID(v);</span><br><span class="line">                UNITY_INITIALIZE_VERTEX_OUTPUT_STEREO(OUT);</span><br><span class="line">                OUT.worldPosition = v.vertex;</span><br><span class="line">                OUT.vertex = UnityObjectToClipPos(OUT.worldPosition);</span><br><span class="line"></span><br><span class="line">                OUT.texcoord = TRANSFORM_TEX(v.texcoord, _MainTex);</span><br><span class="line"></span><br><span class="line">                OUT.color = v.color * _Color;</span><br><span class="line">                return OUT;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f IN) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                half4 color = (tex2D(_MainTex, IN.texcoord) + _TextureSampleAdd) * IN.color;</span><br><span class="line"></span><br><span class="line">                #ifdef UNITY_UI_CLIP_RECT</span><br><span class="line">                color.a *= UnityGet2DClipping(IN.worldPosition.xy, _ClipRect);</span><br><span class="line">                #endif</span><br><span class="line"></span><br><span class="line">                #ifdef UNITY_UI_ALPHACLIP</span><br><span class="line">                clip (color.a - 0.001);</span><br><span class="line">                #endif</span><br><span class="line">                // è‰²å½©å˜ç°  äº®åº¦æå–çŸ©é˜µ</span><br><span class="line">                float gray = dot(color.xyz, float3(0.299, 0.587, 0.114));</span><br><span class="line">                color.xyz = float3(gray, gray, gray);</span><br><span class="line">                return color;</span><br><span class="line">            &#125;</span><br><span class="line">        ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1>UGUIå®ç°æ–‡å­—è¾¹ç¼˜å‘å…‰æ•ˆæœ</h1><h1>Unityå®ç°Textéƒ¨åˆ†åŒºåŸŸå¯å“åº”ç‚¹å‡»</h1><p>æºç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Text;</span><br><span class="line">using System.Text.RegularExpressions;</span><br><span class="line">using UnityEngine;</span><br><span class="line">using UnityEngine.EventSystems;</span><br><span class="line">using UnityEngine.UI;</span><br><span class="line"></span><br><span class="line">namespace UI.UIItems</span><br><span class="line">&#123;</span><br><span class="line">    public class HyperlinkText : Text, IPointerClickHandler</span><br><span class="line">    &#123;</span><br><span class="line">        protected override void Awake()</span><br><span class="line">        &#123;</span><br><span class="line">            Set_TextLinkFuncCB(Application.OpenURL);</span><br><span class="line">        &#125;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// è§£æå®Œæœ€ç»ˆçš„æ–‡æœ¬</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        private string m_OutputText;</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// è¶…é“¾æ¥ä¿¡æ¯åˆ—è¡¨</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        private readonly List&lt;HrefInfo_&gt; m_HrefInfos = new List&lt;HrefInfo_&gt;();</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// æ–‡æœ¬æ„é€ å™¨</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        protected static readonly StringBuilder s_TextBuilder = new StringBuilder();</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// è¶…é“¾æ¥æ­£åˆ™</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        private static readonly Regex s_HrefRegex =</span><br><span class="line">            new Regex(@&quot;&lt;a href=([^&gt;\n\s]+)&gt;(.*?)(&lt;/a&gt;)&quot;, RegexOptions.Singleline);</span><br><span class="line"></span><br><span class="line">        //</span><br><span class="line">        private static readonly Regex s_VertexFilter = new Regex(@&quot;(|[ \n\r\t]+)&quot;, RegexOptions.Singleline);</span><br><span class="line"></span><br><span class="line">        VertexHelper _toFill = null;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// æ˜¯å¦ä½¿ç”¨è¶…é“¾æ¥  é»˜è®¤æœªFalse</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        bool bool_IsLink = true;</span><br><span class="line"></span><br><span class="line">        private Action&lt;string&gt; linkFunc_Cb = null;</span><br><span class="line"></span><br><span class="line">        private RectTransform rect_Parent;</span><br><span class="line">        private RectTransform Rect_Parent</span><br><span class="line">        &#123;</span><br><span class="line">            get</span><br><span class="line">            &#123;</span><br><span class="line">                if (rect_Parent == null)</span><br><span class="line">                &#123;</span><br><span class="line">                    Transform trans = this.transform.parent != null ? this.transform.parent.transform : this.transform;</span><br><span class="line">                    rect_Parent = trans.GetComponent&lt;RectTransform&gt;();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                return rect_Parent;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //è®¾ç½® æ–‡æœ¬ è¶…é“¾æ¥çš„ç‚¹å‡»å›è°ƒäº‹ä»¶</span><br><span class="line">        public void Set_TextLinkFuncCB(Action&lt;string&gt; linkFunc_Cb)</span><br><span class="line">        &#123;</span><br><span class="line">            bool_IsLink = true;</span><br><span class="line">            if (this.linkFunc_Cb != null)</span><br><span class="line">            &#123;</span><br><span class="line">                this.linkFunc_Cb = null;</span><br><span class="line">            &#125;</span><br><span class="line">            this.linkFunc_Cb = linkFunc_Cb;</span><br><span class="line">            OnPopulateMesh(_toFill);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //å­—ç¬¦é¡¶ç‚¹æ•°</span><br><span class="line">        const int perCharVerCount = 4;</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// æ–‡æœ¬æ„é€ å™¨</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        protected static readonly StringBuilder textRebuild = new StringBuilder();</span><br><span class="line"></span><br><span class="line">        protected override void OnPopulateMesh(VertexHelper toFill)</span><br><span class="line">        &#123;</span><br><span class="line">            if (toFill == null)</span><br><span class="line">            &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            _toFill = toFill;</span><br><span class="line">            //TODO ç¼–è¾‘å™¨çŠ¶æ€ä¸‹è¿™é‡Œä¸æ‰§è¡Œï¼Œ æ–¹ä¾¿è°ƒè¯•çœ‹åˆ°æ•ˆæœç”¨</span><br><span class="line">            if (!bool_IsLink)</span><br><span class="line">            &#123;</span><br><span class="line">                m_Text = GetOutputText_Nomal(text);</span><br><span class="line">                base.OnPopulateMesh(toFill);</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            var orignText = m_Text;</span><br><span class="line">            m_OutputText = GetOutputText_Init(text);</span><br><span class="line">            m_Text = m_OutputText;</span><br><span class="line">            text = m_OutputText;</span><br><span class="line">            base.OnPopulateMesh(toFill);</span><br><span class="line">            m_Text = orignText;</span><br><span class="line">            GetOutputText(text, toFill.currentVertCount);</span><br><span class="line"></span><br><span class="line">            UIVertex vert = new UIVertex();</span><br><span class="line"></span><br><span class="line">            // å¤„ç†è¶…é“¾æ¥åŒ…å›´æ¡†</span><br><span class="line">            foreach (var hrefInfo in m_HrefInfos)</span><br><span class="line">            &#123;</span><br><span class="line">                hrefInfo.boxes.Clear();</span><br><span class="line">                if (hrefInfo.startIndex &gt;= toFill.currentVertCount)</span><br><span class="line">                &#123;</span><br><span class="line">                    continue;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                // å°†è¶…é“¾æ¥é‡Œé¢çš„æ–‡æœ¬é¡¶ç‚¹ç´¢å¼•åæ ‡åŠ å…¥åˆ°åŒ…å›´æ¡†</span><br><span class="line">                toFill.PopulateUIVertex(ref vert, hrefInfo.startIndex);</span><br><span class="line">                var pos = vert.position;</span><br><span class="line">                var bounds = new Bounds(pos, Vector3.zero);</span><br><span class="line">                Vector3 previousPos = Vector3.zero;</span><br><span class="line">                for (int i = hrefInfo.startIndex, m = hrefInfo.endIndex; i &lt; m; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    if (i &gt;= toFill.currentVertCount)</span><br><span class="line">                    &#123;</span><br><span class="line">                        break;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    toFill.PopulateUIVertex(ref vert, i);</span><br><span class="line">                    pos = vert.position;</span><br><span class="line">                    if ((i - hrefInfo.startIndex) % 4 == 1)</span><br><span class="line">                    &#123;</span><br><span class="line">                        previousPos = pos;</span><br><span class="line">                    &#125;</span><br><span class="line">                    if (previousPos != Vector3.zero &amp;&amp; (i - hrefInfo.startIndex) % 4 == 0 &amp;&amp; pos.x &lt; previousPos.x) // æ¢è¡Œé‡æ–°æ·»åŠ åŒ…å›´æ¡†</span><br><span class="line">                    &#123;</span><br><span class="line">                        hrefInfo.boxes.Add(new Rect(bounds.min, bounds.size));</span><br><span class="line">                        bounds = new Bounds(pos, Vector3.zero);</span><br><span class="line">                    &#125;</span><br><span class="line">                    else</span><br><span class="line">                    &#123;</span><br><span class="line">                        bounds.Encapsulate(pos); // æ‰©å±•åŒ…å›´æ¡†</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                hrefInfo.boxes.Add(new Rect(bounds.min, bounds.size));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            if (this.gameObject.activeInHierarchy)</span><br><span class="line">            &#123;</span><br><span class="line">                StartCoroutine(RefrehLayout());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        IEnumerator RefrehLayout()</span><br><span class="line">        &#123;</span><br><span class="line">            yield return new WaitForEndOfFrame();</span><br><span class="line">            LayoutRebuilder.ForceRebuildLayoutImmediate(Rect_Parent);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //åˆå§‹åŒ–è¶…é“¾æ¥æ–‡æœ¬ è·å–æœ€ç»ˆç»“æœçš„å®šç‚¹æ•°ç”¨</span><br><span class="line">        string GetOutputText_Init(string outputText)</span><br><span class="line">        &#123;</span><br><span class="line">            s_TextBuilder.Length = 0;</span><br><span class="line">            m_HrefInfos.Clear();</span><br><span class="line">            var indexText = 0;</span><br><span class="line">            foreach (Match match in s_HrefRegex.Matches(outputText))</span><br><span class="line">            &#123;</span><br><span class="line">                s_TextBuilder.Append(outputText.Substring(indexText, match.Index - indexText));</span><br><span class="line">                s_TextBuilder.Append(match.Groups[2].Value);</span><br><span class="line">                indexText = match.Index + match.Length;</span><br><span class="line">            &#125;</span><br><span class="line">            s_TextBuilder.Append(outputText.Substring(indexText, outputText.Length - indexText));</span><br><span class="line">            return s_TextBuilder.ToString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// è·å–è¶…é“¾æ¥è§£æåçš„æœ€åè¾“å‡ºæ–‡æœ¬</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">        string GetOutputText(string outputText, int currentVertCount)</span><br><span class="line">        &#123;</span><br><span class="line">            s_TextBuilder.Length = 0;</span><br><span class="line">            m_HrefInfos.Clear();</span><br><span class="line">            var indexText = 0;</span><br><span class="line">            int vertCount = Regex.Replace(Regex.Replace(outputText.ToString(), @&quot;\s&quot;, &quot;&quot;), @&quot;&lt;(.*?)&gt;&quot;, &quot;&quot;).Length * 4;</span><br><span class="line">            int vercCount_Offset_Start = 0;</span><br><span class="line">            int vercCount_Offset_End = 0;</span><br><span class="line">            bool isLineCup = false;</span><br><span class="line">            if (currentVertCount &gt; vertCount)</span><br><span class="line">            &#123;</span><br><span class="line">                isLineCup = true;</span><br><span class="line">                vercCount_Offset_Start = 80;</span><br><span class="line">                vercCount_Offset_End = 88;</span><br><span class="line">            &#125;</span><br><span class="line">            foreach (Match match in s_HrefRegex.Matches(outputText))</span><br><span class="line">            &#123;</span><br><span class="line">                s_TextBuilder.Append(outputText.Substring(indexText, match.Index - indexText));</span><br><span class="line">                int offset_Len = 0;</span><br><span class="line">                if (isLineCup)</span><br><span class="line">                &#123;</span><br><span class="line">                    offset_Len = (s_TextBuilder.Length - Regex.Replace(s_TextBuilder.ToString(), @&quot;&lt;(.*?)&gt;&quot;, &quot;&quot;).Length) * 4;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                s_TextBuilder.Append(&quot;&lt;i&gt;&lt;b&gt;&lt;color=#f49037&gt;&quot;);  // è¶…é“¾æ¥é¢œè‰²</span><br><span class="line"></span><br><span class="line">                var str = Regex.Replace(s_TextBuilder.ToString(), @&quot;\s&quot;, &quot;&quot;);</span><br><span class="line">                var group = match.Groups[1];</span><br><span class="line">                var hrefInfo = new HrefInfo_</span><br><span class="line">                &#123;</span><br><span class="line">                    startIndex = Regex.Replace(str, @&quot;&lt;(.*?)&gt;&quot;, &quot;&quot;).Length * 4 + vercCount_Offset_Start + offset_Len, // è¶…é“¾æ¥é‡Œçš„æ–‡æœ¬èµ·å§‹é¡¶ç‚¹ç´¢å¼•</span><br><span class="line">                    endIndex = (Regex.Replace(str, @&quot;&lt;(.*?)&gt;&quot;, &quot;&quot;).Length +</span><br><span class="line">                        Regex.Replace(Regex.Replace(match.Groups[2].ToString(), @&quot;\s&quot;, &quot;&quot;)</span><br><span class="line">                            , @&quot;&lt;(.*?)&gt;&quot;, &quot;&quot;).Length - 1) * 4 + 3 + vercCount_Offset_End + offset_Len,</span><br><span class="line">                    name = group.Value</span><br><span class="line">                &#125;;</span><br><span class="line">                m_HrefInfos.Add(hrefInfo);</span><br><span class="line">                //Debug.Log($&quot;é¡¶ç‚¹ä¿¡æ¯ï¼Œå¼€å§‹çš„ï¼š&#123;hrefInfo.startIndex&#125;ï¼Œç»“æŸçš„ï¼š&#123;hrefInfo.endIndex&#125;&quot;);</span><br><span class="line"></span><br><span class="line">                s_TextBuilder.Append(match.Groups[2].Value);</span><br><span class="line">                s_TextBuilder.Append(&quot;&lt;/color&gt;&lt;/b&gt;&lt;/i&gt;&quot;);</span><br><span class="line">                indexText = match.Index + match.Length;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            s_TextBuilder.Append(outputText.Substring(indexText, outputText.Length - indexText));</span><br><span class="line">            return s_TextBuilder.ToString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //è·å–ç¥›é™¤æ‰è¶…é“¾æ¥ ä¿ç•™æ™®é€šæ–‡æœ¬  ä¿è¯é…ç½®é‡Œè¶…é“¾æ¥æ ‡ç­¾çš„æ–‡æœ¬  åœ¨å…¶ä»–åœ°æ–¹ä¹Ÿå¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œåªæœ‰è°ƒç”¨äº†è¶…é“¾æ¥åˆå§‹åŒ–çš„  æ‰ä¼šç»™è¶…é“¾æ¥å½¢å¼çš„æ–‡æœ¬</span><br><span class="line">        string GetOutputText_Nomal(string outputText)</span><br><span class="line">        &#123;</span><br><span class="line">            s_TextBuilder.Length = 0;</span><br><span class="line">            m_HrefInfos.Clear();</span><br><span class="line">            var indexText = 0;</span><br><span class="line">            MatchCollection matchs = s_HrefRegex.Matches(outputText);</span><br><span class="line">            if (matchs.Count &lt;= 0)</span><br><span class="line">            &#123;</span><br><span class="line">                return outputText;</span><br><span class="line">            &#125;</span><br><span class="line">            foreach (Match match in matchs)</span><br><span class="line">            &#123;</span><br><span class="line">                s_TextBuilder.Append(outputText.Substring(indexText, match.Index - indexText));</span><br><span class="line">                s_TextBuilder.Append(match.Groups[2].Value);</span><br><span class="line">                indexText = match.Index + match.Length;</span><br><span class="line">            &#125;</span><br><span class="line">            s_TextBuilder.Append(outputText.Substring(indexText, outputText.Length - indexText));</span><br><span class="line">            return s_TextBuilder.ToString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void OnPointerClick(PointerEventData eventData)</span><br><span class="line">        &#123;</span><br><span class="line">            Vector2 lp;</span><br><span class="line">            RectTransformUtility.ScreenPointToLocalPointInRectangle(</span><br><span class="line">                rectTransform, eventData.position, eventData.pressEventCamera, out lp);</span><br><span class="line"></span><br><span class="line">            foreach (var hrefInfo in m_HrefInfos)</span><br><span class="line">            &#123;</span><br><span class="line">                var boxes = hrefInfo.boxes;</span><br><span class="line">                for (var i = 0; i &lt; boxes.Count; ++i)</span><br><span class="line">                &#123;</span><br><span class="line">                    if (boxes[i].Contains(lp))</span><br><span class="line">                    &#123;</span><br><span class="line">                        //Debug.Log(&quot;æŠ€èƒ½ è¶…é“¾æ¥ ç‚¹å‡»äº†ï¼š&quot; + hrefInfo.name);</span><br><span class="line">                        linkFunc_Cb?.Invoke(hrefInfo.name);</span><br><span class="line">                        return;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /// &lt;summary&gt;</span><br><span class="line">    /// è¶…é“¾æ¥ä¿¡æ¯ç±»</span><br><span class="line">    /// &lt;/summary&gt;</span><br><span class="line">    class HrefInfo_</span><br><span class="line">    &#123;</span><br><span class="line">        public int startIndex;</span><br><span class="line"></span><br><span class="line">        public int endIndex;</span><br><span class="line"></span><br><span class="line">        public string name;</span><br><span class="line"></span><br><span class="line">        public readonly List&lt;Rect&gt; boxes = new List&lt;Rect&gt;();</span><br><span class="line">    &#125;       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var terms2 = $&quot;&lt;color=#aa3900&gt;&lt;a herf=&#123;PrivacyPolicyDefine.UrlService&#125;&gt;&#123;ScriptLocalization.terms_of_use&#125;&lt;/a&gt;&lt;/color&gt;&quot;;</span><br><span class="line"></span><br><span class="line">var policy2 = $&quot;&lt;color=#aa3900&gt;&lt;a herf=&#123;PrivacyPolicyDefine.UrlPrivacy&#125;&gt;&#123;ScriptLocalization.privacy_policy&#125;&lt;/a&gt;&lt;/color&gt;&quot;;</span><br><span class="line"></span><br><span class="line">_ui.contentText.text = string.Format(ScriptLocalization.terms_policy_dlg_content, terms2, policy2);</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;ä¸ºä»€ä¹ˆä¼šæœ‰&lt;code&gt;LayoutRebuilder.ForceRebuildLayoutImmediate(RectTransform)&lt;/code&gt;æ¥å£? ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸ªæ¥å£?&lt;/h1&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨æŸä¸€å¸§çš„Updateæˆ–è€…EventInputä¸­æ‰§è¡Œäº†ä¸€æ®µä»£ç , è¿™æ®µ</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>UnityEditoråŠŸèƒ½å¼€å‘</title>
    <link href="https://soincredible.github.io/posts/2e6b555f/"/>
    <id>https://soincredible.github.io/posts/2e6b555f/</id>
    <published>2025-04-18T22:22:15.000Z</published>
    <updated>2025-04-27T01:30:44.577Z</updated>
    
    <content type="html"><![CDATA[<h1>æ‹“å±•UnityInspectorçª—å£</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br></pre></td><td class="code"><pre><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Reflection;</span><br><span class="line">using UnityEditor;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">namespace DDZ</span><br><span class="line">&#123;</span><br><span class="line">    [CustomEditor(typeof(RectTransform))]</span><br><span class="line">    public class RectTransformEditor : Editor</span><br><span class="line">    &#123;</span><br><span class="line">        Color defutColor;</span><br><span class="line">        RectTransform rectTransform;</span><br><span class="line">        UIRuntimeComponents runtimeComponents;</span><br><span class="line">        Object[] components;</span><br><span class="line">        Editor rectTransformEditor;</span><br><span class="line">        static bool showCustom = true;</span><br><span class="line"></span><br><span class="line">        GUIContent toggleLabel = new GUIContent(&quot; èŠ‚ç‚¹æ”¶é›†&quot;);</span><br><span class="line">        GUIStyle style = null;</span><br><span class="line">        </span><br><span class="line">        private void OnEnable()</span><br><span class="line">        &#123;</span><br><span class="line">            //åå°„è·å–ectTransformEditor</span><br><span class="line">            var type = Assembly.GetAssembly(typeof(Editor)).GetType(&quot;UnityEditor.RectTransformEditor&quot;, false);</span><br><span class="line">            if (type==null)</span><br><span class="line">            &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            rectTransformEditor = CreateEditor(target, type);</span><br><span class="line"></span><br><span class="line">            rectTransform = (RectTransform) target;</span><br><span class="line">            if (rectTransform != null)</span><br><span class="line">            &#123;</span><br><span class="line">                defutColor = GUI.backgroundColor;</span><br><span class="line">                </span><br><span class="line">                //è·å–RuntimeComponentsç»„ä»¶</span><br><span class="line">                runtimeComponents = FindUIRuntimeComponents(rectTransform.parent);</span><br><span class="line">            </span><br><span class="line">                //æ”¶é›†èŠ‚ç‚¹ï¼Œæ·»åŠ GameObjectï¼Œå¹¶ä¸”åˆ é™¤CanvasRenderer</span><br><span class="line">                components = rectTransform.GetComponents&lt;Component&gt;();</span><br><span class="line">                var list = components.ToList();</span><br><span class="line">                list.Add(rectTransform.gameObject);</span><br><span class="line">                int len = list.Count;</span><br><span class="line">                for (int i = len - 1; i &gt;= 0; i--)</span><br><span class="line">                &#123;</span><br><span class="line">                    var component = list[i];</span><br><span class="line">                    var typeStr = component.GetType().Name;</span><br><span class="line">                    if (typeStr == &quot;CanvasRenderer&quot;)</span><br><span class="line">                    &#123;</span><br><span class="line">                        list.RemoveAt(i);</span><br><span class="line">                        break;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                components = list.ToArray();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public override void OnInspectorGUI()</span><br><span class="line">        &#123;</span><br><span class="line">            if (rectTransform == null)</span><br><span class="line">            &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (rectTransformEditor)</span><br><span class="line">            &#123;</span><br><span class="line">                rectTransformEditor.OnInspectorGUI();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            if (runtimeComponents == null)</span><br><span class="line">            &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            EditorGUILayout.Space();</span><br><span class="line">            Rect xian1 = GUILayoutUtility.GetRect(GUIContent.none, GUIStyle.none, GUILayout.Height(1));</span><br><span class="line">            Rect backgroundRect = GUILayoutUtility.GetRect(GUIContent.none, GUIStyle.none, GUILayout.Height(20));</span><br><span class="line"></span><br><span class="line">            EditorGUI.DrawRect(xian1, Color.black);</span><br><span class="line">            EditorGUI.DrawRect(backgroundRect, new Color(0.25f, 0.25f, 0.25f));</span><br><span class="line"></span><br><span class="line">            // ç»˜åˆ¶å†…å®¹åŒºåŸŸ</span><br><span class="line">            if (style==null)</span><br><span class="line">            &#123;</span><br><span class="line">                style = new GUIStyle(EditorStyles.foldout);</span><br><span class="line">                style.fontStyle = FontStyle.Bold;</span><br><span class="line">            &#125;</span><br><span class="line">            Rect contentRect = new Rect(backgroundRect.x-15 , backgroundRect.y, backgroundRect.width+20, backgroundRect.height);</span><br><span class="line">            showCustom = GUI.Toggle(contentRect, showCustom, toggleLabel,style);</span><br><span class="line"></span><br><span class="line">            if (showCustom)</span><br><span class="line">            &#123;</span><br><span class="line">                int len = components.Length;</span><br><span class="line">                for (int i = 0; i &lt; len; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    var component = components[i];</span><br><span class="line">                    var typeStr = component.GetType().Name;</span><br><span class="line">                    if (IsCollected(runtimeComponents, component))</span><br><span class="line">                    &#123;</span><br><span class="line">                        GUI.backgroundColor = Color.green;</span><br><span class="line">                    &#125;</span><br><span class="line">                    else</span><br><span class="line">                    &#123;</span><br><span class="line">                        GUI.backgroundColor = defutColor;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    if (i % 3 == 0)</span><br><span class="line">                    &#123;</span><br><span class="line">                        GUILayout.BeginHorizontal();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    if (i == len - 1)</span><br><span class="line">                    &#123;</span><br><span class="line">                        if (GUILayout.Button(typeStr, GUILayout.Width(100), GUILayout.Height(30)))</span><br><span class="line">                        &#123;</span><br><span class="line">                            OperateComponent(component);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    else</span><br><span class="line">                    &#123;</span><br><span class="line">                        if (GUILayout.Button(typeStr, GUILayout.Height(30)))</span><br><span class="line">                        &#123;</span><br><span class="line">                            OperateComponent(component);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    if (i % 3 == 2 || i == len - 1)</span><br><span class="line">                    &#123;</span><br><span class="line">                        GUILayout.EndHorizontal();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                EditorGUI.indentLevel--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void OnDisable()</span><br><span class="line">        &#123;</span><br><span class="line">            if (rectTransformEditor)</span><br><span class="line">            &#123;</span><br><span class="line">                DestroyImmediate(rectTransformEditor);</span><br><span class="line">                rectTransform = null;</span><br><span class="line">                runtimeComponents = null;</span><br><span class="line">                components = null;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        void OperateComponent(Object component)</span><br><span class="line">        &#123;</span><br><span class="line">            if (Event.current.button == 0)</span><br><span class="line">            &#123;</span><br><span class="line">                if (!Application.isPlaying)</span><br><span class="line">                &#123;</span><br><span class="line">                    if (IsCollected(runtimeComponents, component))</span><br><span class="line">                    &#123;</span><br><span class="line">                        DeleteObject(runtimeComponents, component);</span><br><span class="line">                    &#125;</span><br><span class="line">                    else</span><br><span class="line">                    &#123;</span><br><span class="line">                        AddObject(runtimeComponents, component);</span><br><span class="line">                    &#125;</span><br><span class="line">                            </span><br><span class="line">                    EditorApplication.ExecuteMenuItem(&quot;Window/General/Hierarchy&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            else if (Event.current.button == 1)</span><br><span class="line">            &#123;</span><br><span class="line">                if (IsCollected(runtimeComponents, component))</span><br><span class="line">                &#123;</span><br><span class="line">                    FindReferences(runtimeComponents, component);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        bool IsCollected(UIRuntimeComponents runtimeComponents, Object component)</span><br><span class="line">        &#123;</span><br><span class="line">            if (runtimeComponents.m_objects==null)</span><br><span class="line">            &#123;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line">            int len = runtimeComponents.m_objects.Length;</span><br><span class="line">            for (int i = 0; i &lt; len; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                if (runtimeComponents.m_objects[i] == component)</span><br><span class="line">                &#123;</span><br><span class="line">                    return true;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        void AddObject(UIRuntimeComponents runtimeComponents, Object component)</span><br><span class="line">        &#123;</span><br><span class="line">            if (runtimeComponents.m_objects==null)</span><br><span class="line">            &#123;</span><br><span class="line">                runtimeComponents.m_objects = new Object[0];</span><br><span class="line">            &#125;</span><br><span class="line">            int len = runtimeComponents.m_objects.Length;</span><br><span class="line">            for (int i = 0; i &lt; len; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                if (runtimeComponents.m_objects[i] == component)</span><br><span class="line">                &#123;</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            var list = runtimeComponents.m_objects.ToList();</span><br><span class="line">            list.Add(component);</span><br><span class="line">            runtimeComponents.m_objects = list.ToArray();</span><br><span class="line">            SavePrefab(runtimeComponents);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        void DeleteObject(UIRuntimeComponents runtimeComponents, Object component)</span><br><span class="line">        &#123;</span><br><span class="line">            var list = runtimeComponents.m_objects.ToList();</span><br><span class="line">            int len = list.Count;</span><br><span class="line">            for (int i = 0; i &lt; len; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                if (list[i] == component)</span><br><span class="line">                &#123;</span><br><span class="line">                    list.RemoveAt(i);</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            runtimeComponents.m_objects = list.ToArray();</span><br><span class="line">            if (runtimeComponents.m_objects.Length&lt;=0)</span><br><span class="line">            &#123;</span><br><span class="line">                runtimeComponents.m_objects = null;</span><br><span class="line">            &#125;</span><br><span class="line">            SavePrefab(runtimeComponents);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        void FindReferences(UIRuntimeComponents runtimeComponents, Object component)</span><br><span class="line">        &#123;</span><br><span class="line">            EditorGUIUtility.PingObject(runtimeComponents.gameObject);</span><br><span class="line">            Selection.objects = new Object[] &#123;runtimeComponents.gameObject&#125;;</span><br><span class="line"></span><br><span class="line">            var len = runtimeComponents.m_objects.Length;</span><br><span class="line">            for (int i = 0; i &lt; len; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                if (component == runtimeComponents.m_objects[i])</span><br><span class="line">                &#123;</span><br><span class="line">                    runtimeComponents.focusIndex = i;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        UIRuntimeComponents FindUIRuntimeComponents(Transform transform)</span><br><span class="line">        &#123;</span><br><span class="line">            if (transform == null)</span><br><span class="line">                return null;</span><br><span class="line"></span><br><span class="line">            var runtimeComponents = transform.GetComponent&lt;UIRuntimeComponents&gt;();</span><br><span class="line">            if (runtimeComponents != null)</span><br><span class="line">                return runtimeComponents;</span><br><span class="line"></span><br><span class="line">            return FindUIRuntimeComponents(transform.parent);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        void SavePrefab(UIRuntimeComponents runtime)</span><br><span class="line">        &#123;</span><br><span class="line">            if (runtime == null)</span><br><span class="line">            &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            GameObject save_go = runtime.gameObject;</span><br><span class="line">            var assetType = PrefabUtility.GetPrefabAssetType(runtime.gameObject);</span><br><span class="line">            if (assetType == PrefabAssetType.Regular) //å¦‚æœæ˜¯é¢„åˆ¶ä½“çš„ä¸€éƒ¨åˆ†</span><br><span class="line">            &#123;</span><br><span class="line">                save_go = PrefabUtility.GetOutermostPrefabInstanceRoot(runtime.gameObject);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (EditorUtility.IsPersistent(save_go))</span><br><span class="line">            &#123;</span><br><span class="line">                EditorUtility.SetDirty(save_go);</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                string path =</span><br><span class="line">                    AssetDatabase.GetAssetPath(PrefabUtility.GetCorrespondingObjectFromOriginalSource(save_go));</span><br><span class="line">                if (string.IsNullOrEmpty(path))</span><br><span class="line">                &#123;</span><br><span class="line">                    EditorUtility.SetDirty(save_go);</span><br><span class="line">                &#125;</span><br><span class="line">                else</span><br><span class="line">                &#123;</span><br><span class="line">                    PrefabUtility.SaveAsPrefabAssetAndConnect(save_go, path, InteractionMode.UserAction);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1>UnityEditorä¸‹çš„åŠ è½½å¼¹çª—æˆ–è€…å¼¹çª—</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">private static void ShowProgress(float progress, int total, int current)</span><br><span class="line">&#123;</span><br><span class="line">    EditorUtility.DisplayProgressBar(&quot;Searching&quot;,</span><br><span class="line">        string.Format(&quot;Checking (&#123;0&#125;/&#123;1&#125;), please wait...&quot;, current, total), progress);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EditorUtility.DisplayDialog( &quot;&quot;, &quot;Board64ä¸­ä¸å­˜åœ¨å¯¹Board100çš„ä¾èµ–&quot;, &quot;OK&quot; );</span><br></pre></td></tr></table></figure><h1>èµ„æºå¯¼å…¥ç®¡çº¿å¤„ç†</h1><h1>å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://blog.csdn.net/yx314636922/article/details/126872839">https://blog.csdn.net/yx314636922/article/details/126872839</a></li><li><a href="https://blog.csdn.net/angry_youth/article/details/117469722">https://blog.csdn.net/angry_youth/article/details/117469722</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;æ‹“å±•UnityInspectorçª—å£&lt;/h1&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span clas</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ä¹Œåˆä¹‹ä¼—</title>
    <link href="https://soincredible.github.io/posts/2ecb1e55/"/>
    <id>https://soincredible.github.io/posts/2ecb1e55/</id>
    <published>2025-04-09T12:00:31.000Z</published>
    <updated>2025-04-27T01:30:44.578Z</updated>
    
    <content type="html"><![CDATA[<h1>åº</h1><p>æˆ‘å‘ç°ï¼Œç¤¾ä¼šç»„ç»‡å°±åƒäººä½“ç»“æ„ä¸€æ ·å¤æ‚ï¼Œæˆ‘ä»¬å®Œå…¨æ— æ³•è®©å®ƒä»¬çªç„¶ç»å—æ·±åˆ»çš„å˜åŒ–ã€‚å¤§è‡ªç„¶æœ‰æ—¶æ˜¯éå¸¸æç«¯çš„ï¼Œä½†å†³ä¸åƒæˆ‘ä»¬æ‰€ç†è§£çš„é‚£æ ·ã€‚æ‰€ä»¥ï¼Œå¯¹ä¸€ä¸ªæ°‘æ—æ¥è¯´ï¼Œè¿·æ‹å¤§å˜é©æ˜¯æœ€å¯æ€•çš„äº‹æƒ…ä¹‹ä¸€ã€‚ä¸ç®¡è¿™ç§å˜é©åœ¨ç†è®ºä¸Šæ˜¾å¾—å¦‚ä½•ä¼Ÿå¤§ï¼Œåªæœ‰å½“å®ƒèƒ½ç«‹å³æ”¹å˜æ°‘æ—çš„æ·±å±‚å¿ƒç†æ—¶ï¼Œå®ƒæ‰æ˜¯æœ‰ç”¨çš„ã€‚ç„¶è€Œï¼Œåªæœ‰æ—¶é—´æ‹¥æœ‰è¿™ç§åŠ›é‡ã€‚æ”¯é…äººç±»çš„ï¼Œæ˜¯æ€æƒ³ã€æ„Ÿæƒ…å’Œä¹ ä¿—ï¼Œæ˜¯å­˜åœ¨äºæˆ‘ä»¬è‡ªèº«çš„ä¸œè¥¿ã€‚åˆ¶åº¦å’Œæ³•å¾‹æ˜¯äººä»¬å†…å¿ƒç²¾ç¥çš„è¡¨ç°å½¢å¼ï¼Œåæ˜ äº†å®ƒçš„éœ€è¦ï¼Œæ—¢ç„¶æ˜¯äººä»¬çš„å†…å¿ƒç²¾ç¥è¯ç”Ÿäº†åˆ¶åº¦å’Œæ³•å¾‹ï¼Œåˆ¶åº¦å’Œæ³•å¾‹è‡ªç„¶å°±æ— æ³•æ”¹å˜å®ƒã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;åº&lt;/h1&gt;
&lt;p&gt;æˆ‘å‘ç°ï¼Œç¤¾ä¼šç»„ç»‡å°±åƒäººä½“ç»“æ„ä¸€æ ·å¤æ‚ï¼Œæˆ‘ä»¬å®Œå…¨æ— æ³•è®©å®ƒä»¬çªç„¶ç»å—æ·±åˆ»çš„å˜åŒ–ã€‚å¤§è‡ªç„¶æœ‰æ—¶æ˜¯éå¸¸æç«¯çš„ï¼Œä½†å†³ä¸åƒæˆ‘ä»¬æ‰€ç†è§£çš„é‚£æ ·ã€‚æ‰€ä»¥ï¼Œå¯¹ä¸€ä¸ªæ°‘æ—æ¥è¯´ï¼Œè¿·æ‹å¤§å˜é©æ˜¯æœ€å¯æ€•çš„äº‹æƒ…ä¹‹ä¸€ã€‚ä¸ç®¡è¿™ç§å˜é©åœ¨ç†è®ºä¸Šæ˜¾å¾—å¦‚ä½•ä¼Ÿå¤§ï¼Œåªæœ‰å½“å®ƒèƒ½ç«‹å³æ”¹å˜æ°‘æ—çš„æ·±å±‚å¿ƒç†æ—¶ï¼Œå®ƒæ‰</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ETä¸­çš„ç½‘ç»œé€šä¿¡æ¨¡å—</title>
    <link href="https://soincredible.github.io/posts/3613bb98/"/>
    <id>https://soincredible.github.io/posts/3613bb98/</id>
    <published>2025-04-02T10:14:58.000Z</published>
    <updated>2025-04-29T08:14:40.410Z</updated>
    
    <content type="html"><![CDATA[<p>Realm Session<br>Router Session<br>Gate Session</p><p>é€šè¿‡RootèŠ‚ç‚¹ä¸Šçš„RouterAddressComponentç»„ä»¶å¯ä»¥è·å¾—æœåŠ¡å™¨çš„åœ°å€, å¹¶å°†è¿™ä¸ªåœ°å€ç»™åˆ°Session</p><p><a href="https://blog.csdn.net/u011041241/article/details/109574509">å†…ç½‘å’Œå¤–ç½‘ä¹‹é—´çš„é€šä¿¡ï¼ˆç«¯å£æ˜ å°„åŸç†ï¼‰</a><br><a href="https://luyuhuang.tech/2020/12/09/kcp.html">KCPåè®®è¯¦è§£</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Realm Session&lt;br&gt;
Router Session&lt;br&gt;
Gate Session&lt;/p&gt;
&lt;p&gt;é€šè¿‡RootèŠ‚ç‚¹ä¸Šçš„RouterAddressComponentç»„ä»¶å¯ä»¥è·å¾—æœåŠ¡å™¨çš„åœ°å€, å¹¶å°†è¿™ä¸ªåœ°å€ç»™åˆ°Session&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;ht</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ETæ¡†æ¶è‡ªåŠ¨ç”Ÿæˆè„šæœ¬</title>
    <link href="https://soincredible.github.io/posts/ef16867e/"/>
    <id>https://soincredible.github.io/posts/ef16867e/</id>
    <published>2025-03-28T11:09:03.000Z</published>
    <updated>2025-04-17T05:42:38.016Z</updated>
    
    <content type="html"><![CDATA[<p>ETæ¡†æ¶ä»“åº“ä¸‹å…¶å®æ˜¯æœ‰ä¸¤ä¸ªå·¥ç¨‹çš„ï¼Œè™½ç„¶è¿™ä¸¤ä¸ªå·¥ç¨‹é‡Œé¢çš„è„šæœ¬æœ‰å¯èƒ½æ˜¯ç”¨çš„åŒä¸€ä»½</p><p>åœ¨Shareè¿™ä¸ªæ¨¡å—ä¸­<code>ETSystemGenerator.cs</code>è¿™ä¸ªè„šæœ¬é‡Œé¢ï¼</p><blockquote><p>é—®é¢˜ è¿™äº›ä»£ç è‡ªåŠ¨ç”Ÿæˆçš„æ—¶æœºæ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿ</p></blockquote><p>ç¼–è¯‘çš„æ—¶å€™è‡ªåŠ¨ç”Ÿæˆï¼Œæ— éœ€å¼€å‘è€…æ‰‹åŠ¨ç®¡ç†ETSystemGeneratorè¿™ä¸ªç±»å®ç°äº†ISourceGeneratoræ¥å£ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨Unityä¸­è‡ªåŠ¨ç”Ÿæˆè„šæœ¬çš„åŠŸèƒ½æ˜¯æ˜¯é€šè¿‡dllæ’ä»¶çš„æ–¹å¼æ¥å…¥è¿›æ¥çš„ï¼Œè¿˜å¾—çœ‹ä¸€ä¸‹æ€ä¹ˆå¯¼å‡ºdllï¼Œå¦‚æœå¯¹SourceGeneratorçš„æºç æœ‰ä¿®æ”¹ï¼Œéœ€è¦é‡æ–°å¯¼å…¥dllåˆ°Unityä¸­</p><h1>GeneratorExecutionContext</h1>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ETæ¡†æ¶ä»“åº“ä¸‹å…¶å®æ˜¯æœ‰ä¸¤ä¸ªå·¥ç¨‹çš„ï¼Œè™½ç„¶è¿™ä¸¤ä¸ªå·¥ç¨‹é‡Œé¢çš„è„šæœ¬æœ‰å¯èƒ½æ˜¯ç”¨çš„åŒä¸€ä»½&lt;/p&gt;
&lt;p&gt;åœ¨Shareè¿™ä¸ªæ¨¡å—ä¸­&lt;code&gt;ETSystemGenerator.cs&lt;/code&gt;è¿™ä¸ªè„šæœ¬é‡Œé¢ï¼&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é—®é¢˜ è¿™äº›ä»£ç è‡ªåŠ¨ç”Ÿæˆçš„æ—¶æœºæ˜¯ä»€ä¹ˆæ—¶å€™</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ETæ¡†æ¶ç´¢å¼•</title>
    <link href="https://soincredible.github.io/posts/ff09e316/"/>
    <id>https://soincredible.github.io/posts/ff09e316/</id>
    <published>2025-03-28T06:37:27.000Z</published>
    <updated>2025-04-28T01:34:28.637Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ğŸ’¡TIPS:æœ¬ç³»åˆ—åŸºäºET8.1ç‰ˆæœ¬</p></blockquote><p>æœ¬ç³»åˆ—å†…å®¹ä¼šååˆ†ç¹æ‚, å› ä¸ºä¸åªæ˜¯è®¨è®ºETçš„æ¶æ„è®¾è®¡, è¿˜æœ‰æ”¯æŒæ¡†æ¶å®ç°èƒŒåçš„æŠ€æœ¯: C#ä¸­çš„ç‰¹æ€§ã€åå°„ã€å¼‚æ­¥ã€ä»£ç æ£€æŸ¥ã€æºä»£ç ç”Ÿæˆã€å¸§åŒæ­¥çŠ¶æ€åŒæ­¥ã€ç½‘ç»œé€šä¿¡ã€KCPã€AOIç­‰å¤šä¸ªæ–¹é¢, ä¹Ÿåªæœ‰å…·å¤‡äº†è¿™äº›çŸ¥è¯†å‚¨å¤‡, æ‰èƒ½å¤Ÿæ›´å¥½çš„ç†è§£ETæ¡†æ¶.</p><ul><li><a href="https://soincredible.github.io/posts/a8cdc42b/">ETä¸­çš„å¼‚æ­¥</a></li><li><a href="https://soincredible.github.io/posts/50d23509/">å¸§åŒæ­¥ä¸çŠ¶æ€åŒæ­¥</a></li><li><a href="https://soincredible.github.io/posts/3613bb98/">ETä¸­çš„ç½‘ç»œé€šä¿¡æ¨¡å—</a></li><li><a href="https://soincredible.github.io/posts/12f854cb/">ETä¸­çš„Singleton</a></li><li><a href="https://soincredible.github.io/posts/cd96d12/">ETä¸­åå°„ä¸ç‰¹æ€§çš„ä½¿ç”¨</a></li><li><a href="https://soincredible.github.io/posts/ef16867e/">ETæ¡†æ¶è‡ªåŠ¨ç”Ÿæˆè„šæœ¬</a></li><li><a href="https://soincredible.github.io/posts/9c5dbe31/">ETæ¡†æ¶Demoå¯åŠ¨æµç¨‹æ¢³ç†</a></li></ul><p>ETä¸­çš„SceneType, å¯ä»¥è¿™æ ·ç†è§£: ä¸€ä¸ªç”±ETæ¡†æ¶å¼€å‘çš„æ¸¸æˆå°±æ˜¯ä¸€ä¸ªWorld, åœ¨è¿™ä¸ªworldä¸‹ä¼šæœ‰å„ç§ä¸ªæ ·çš„Scene, è¿™äº›Sceneæ‰®æ¼”ä¸åŒçš„è§’è‰², è¿™äº›è§’è‰²æ‰®æ¼”ä¸€èˆ¬éƒ½æ˜¯ä¸åŒçš„èŒè´£. åœ¨ETä¸­,æœ‰ä¸€ä¸ªåå«Demoçš„SceneType, è¿˜æœ‰å«Mainçš„</p><p>ç”±Worldæä¾›å„ç§åŸææ–™, ä¾›å„ä¸ªSceneä¸‹é¢çš„Entityä½¿ç”¨</p><p>æ¯ä¸€ä¸ªEntityéƒ½ä¼šæ ‡è®°è‡ªå·±è¢«åˆ›å»ºå‡ºæ¥çš„Scene<br>SceneTypeä¼šå½±å“Fiberçš„åˆ›å»º</p><p>ETä¸­çš„Entity æœ‰Childå’ŒComponentä¹‹åˆ†</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡TIPS:æœ¬ç³»åˆ—åŸºäºET8.1ç‰ˆæœ¬&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æœ¬ç³»åˆ—å†…å®¹ä¼šååˆ†ç¹æ‚, å› ä¸ºä¸åªæ˜¯è®¨è®ºETçš„æ¶æ„è®¾è®¡, è¿˜æœ‰æ”¯æŒæ¡†æ¶å®ç°èƒŒåçš„æŠ€æœ¯: C#ä¸­çš„ç‰¹æ€§ã€åå°„ã€å¼‚æ­¥ã€ä»£ç æ£€æŸ¥ã€æºä»£ç ç”Ÿæˆã€å¸§åŒæ­¥çŠ¶æ€åŒæ­¥ã€ç½‘ç»œé€šä¿¡ã€KCP</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ETæ¡†æ¶ä¸­çš„Singleton</title>
    <link href="https://soincredible.github.io/posts/12f854cb/"/>
    <id>https://soincredible.github.io/posts/12f854cb/</id>
    <published>2025-03-28T06:23:01.000Z</published>
    <updated>2025-04-21T10:33:11.365Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ç¬”è€…ä¼šæŒ‰ç…§ETä¸­æ‰€æœ‰Singletonåˆ›å»ºçš„é¡ºåˆ©ï¼Œå°è¯•æ¢³ç†ä¸€ä¸‹è®¾è®¡åˆ°çš„æ¨¡å—ã€‚</p><h1>Singletonçš„åˆ›å»º</h1><blockquote><p>ç–‘é—® å·²ç»æœ‰ä¸€ä¸ªASingletonäº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰ä¸€ä¸ªASingletonAwakeï¼Ÿ<br>æ‰€æœ‰çš„Singletonéƒ½ä¼šç»§æ‰¿ASingletonåŸºç±»ã€‚ä½†æ˜¯ä¸åŒçš„Singletonè¿˜ä¼šç»§æ‰¿ä¸åŒçš„ISingletonAwakeã€‚ ä¸€æ˜¯ä½¿ç”¨æ³›å‹ï¼ŒäºŒæ˜¯å£°æ˜å‡ ä¸ªå‚æ•°æ•°é‡ä¸åŒçš„ISingletonAwakeæ¥å£ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©å…·ä½“çš„Singletonç»§æ‰¿å“ªä¸ªæ¥å£ï¼Œä½†æ˜¯æ‰€æœ‰çš„Singletonåˆéƒ½ä¼šç»§æ‰¿ASingletonè¢«Wordä¸­çš„singletonsç®¡ç†èµ·æ¥ï¼Œç›¸å½“äºæŠŠSingletonçš„åˆå§‹åŒ–å’Œç®¡ç†çš„èŒèƒ½æ‹†åˆ†äº¤ç»™äº†ä¸¤ä¸ªè§’è‰²å»å¤„ç†ï¼Œè¿˜æ˜¯æ¯”è¾ƒå·§å¦™çš„ã€‚</p></blockquote><blockquote><p>ç–‘é—® ä¸ºä»€ä¹ˆæœ‰çš„Singletonä¼šè¢«æ‰“ä¸ŠCodeç‰¹æ€§ï¼Œæœ‰çš„ä¸ä¼šï¼Ÿ</p></blockquote><p>è™½ç„¶å¤§å®¶éƒ½æ˜¯Singletonï¼Œä½†æ˜¯å„ä¸ªSingletonä¹‹é—´çš„ä¼˜å…ˆçº§ä¸ä¸€å®šä¸€æ ·ï¼Œå•ä¾‹ä¹‹é—´ä¼šå­˜åœ¨ä¾èµ–ã€‚æ¯”å¦‚CodeLoaderã€CodeTypesè¿™ä¸¤ä¸ªå•ä¾‹ï¼Œå®ƒä»¬ä¸¤ä¸ªéœ€è¦åœ¨å…¶ä»–å•ä¾‹ä¹‹å‰å…ˆè¢«Awakeï¼Œç„¶ååœ¨CodeTypeå•ä¾‹å†…éƒ¨ï¼Œå†å»åˆ›å»ºå‡ºå…¶ä»–å•ä¾‹å‡ºæ¥ã€‚å› æ­¤ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå•ä¾‹æ²¡æœ‰è¢«æ ‡è®°ä¸ºCodeç‰¹æ€§ï¼Œé‚£ä¹ˆè¯´æ˜è¿™ä¸ªå•ä¾‹æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§æ¯”è¾ƒé«˜çš„å•ä¾‹ï¼Œå®ƒåº”è¯¥åœ¨æŸä¸€æ¯”è¾ƒæ—©çš„æ—¶åˆ»è¢«æˆ‘ä»¬å¼€å‘è€…æ‰‹åŠ¨è°ƒç”¨å¹¶åˆ›å»ºå‡ºæ¥ã€‚ä¹Ÿå°±æ˜¯ETæ¡†æ¶é€šè¿‡ç»™ä¸ç»™å•ä¾‹æ ‡è®°CodeAttributeçš„æ–¹å¼æ¥å¯¹å•ä¾‹çš„åˆ›å»ºè¿›è¡Œæ‰‹åŠ¨æˆ–è€…è‡ªåŠ¨çš„ç®¡ç†ã€‚</p><h1>World</h1><p>æ¥ç€æˆ‘ä»¬æ¥è¯´ä¸€ä¸‹Worldä¸­çš„AddSingletonæ¥å£ï¼Œè¿™ä¸ªæ¥å£ä¸ä»…ä»…æ˜¯è¢«Worldå†…éƒ¨çš„å‡ ä¸ªæ³›å‹AddSingletonæ¥å£è°ƒç”¨ï¼Œè¿˜è¢«ä¸‹é¢å‡ ä¸ªåœ°æ–¹è°ƒç”¨äº†ï¼š</p><ul><li>CodeTypes</li><li>ConfigLoader</li><li>EditorLogHelper</li></ul><h1>CodeTypes</h1><h1>ConfigLoader</h1><h1>EditorLogHelper</h1><h1>AddSingletonçš„é¡ºåº</h1><ul><li>Logger</li><li>TimeInfo</li><li>FiberManager</li><li>ResourcesComponent</li><li>CodeLoader</li><li>æ¥ç€è°ƒç”¨CodeLoaderçš„Startæ–¹æ³•åˆ›å»ºCodeTypeså•ä¾‹</li><li>æ¥ç€é€šè¿‡åå°„çš„æ–¹å¼è°ƒç”¨Entryä¸­çš„Startæ–¹æ³•åˆ›å»ºä¸‹é¢å•ä¾‹ï¼š<ul><li>IdGenerater</li><li>OpcodeType</li><li>ObjectPool</li><li>MessageQueue</li><li>NetServices</li><li>NavmeshComponent</li><li>LogMsg</li><li>ç„¶åè°ƒç”¨CodeTypeså•ä¾‹çš„CreateCodeæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ‹¿åˆ°æ‰€æœ‰è¢«æ ‡è®°äº†CodeAttributeçš„ç±»ï¼Œè‡ªåŠ¨çš„åˆ›å»ºè¿™äº›ç±»çš„å•ä¾‹ï¼š<ul><li>EntitySystemSingleton</li><li>MessageDispatcher</li><li>EventSystem</li><li>HttpDispatcher</li><li>LSEntitySystemSingleton</li><li>AIDispatcherComponent</li><li>ConsoleDispatcher</li><li>MessageSessionDispatcher</li><li>NumericWatcherComponent</li><li>UIEventComponent</li></ul></li><li>ConfigLoader</li></ul></li></ul><h1>CodeTypes</h1><h1>EventSystem</h1><p>EventSystemæ˜¯æ‰€æœ‰ä¸šåŠ¡èƒ½å¤Ÿè·‘èµ·æ¥çš„åŸºç¡€</p><p>é€šè¿‡ç»§æ‰¿InvokeHandler, åœ¨Handleæ–¹æ³•é‡Œä¼šæ“ä½œå…¶ä»–å•ä¾‹æˆ–è€…componenté‡Œé¢é¢çš„æ¥å£</p><ul><li>MessageSessionHandler MessageSessionDispatcher</li><li>MessageLocationHandler MessageDispatcherSingleton</li><li></li></ul><p>EventSystemä¸­ç»´æŠ¤äº†ä¸¤ä¸ªå­—æ®µ<code>allEvents</code>å’Œ<code>allInvokers</code><br>EventSystemåœ¨Invokeçš„æ—¶å€™ä¼šåˆå§‹åŒ–è¿™ä¸¤ä¸ªå­—æ®µçš„å†…å®¹<br>allEventså­—æ®µä¸­ è®°ä¸ºEventç‰¹æ€§çš„æ‰€æœ‰ç±»å‹ï¼Œåˆ›å»ºè¿™äº›ç±»å‹çš„å®ä¾‹ï¼Œè¢«æ ‡è®°äº†Eventç‰¹æ€§çš„ç±»å¿…é¡»è¦ç»§æ‰¿IEventæ¥å£ã€‚</p><p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.reflection.memberinfo.getcustomattributes?view=net-9.0"><code>MemberInfo.GetCustomAttributes(Type, bool);</code></a>ã€‚</p><p>çœ‹ä¸€ä¸‹AEventä¸­æä¾›äº†ä¸€ä¸ªRunæ¥å£ï¼Œ</p><p>InvokeHandlerå’ŒMessageHandlerçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</p><p>Eventå’ŒInvokerçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</p><h1>MessageHandler æ„Ÿè§‰æ˜¯å¦å¤–ä¸€å¥—é€»è¾‘</h1><h1>EntitySystemSingleton</h1><h2 id="EntitySystem">EntitySystem</h2><p>EntitySystemSingletoné‡Œé¢ç»´æŠ¤äº†ä¸€ä¸ªTypeSystemså­—æ®µ</p><p>AwakeSystemå’ŒComponentçš„IAwakeæ¥å£ä¹‹é—´çš„å…³ç³».</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æœ¬æ–‡ç¬”è€…ä¼šæŒ‰ç…§ETä¸­æ‰€æœ‰Singletonåˆ›å»ºçš„é¡ºåˆ©ï¼Œå°è¯•æ¢³ç†ä¸€ä¸‹è®¾è®¡åˆ°çš„æ¨¡å—ã€‚&lt;/p&gt;
&lt;h1&gt;Singletonçš„åˆ›å»º&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;ç–‘é—® å·²ç»æœ‰ä¸€ä¸ªASingletonäº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰ä¸€ä¸ªASingletonAwakeï¼Ÿ&lt;br&gt;
æ‰€æœ‰çš„Si</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>äº†ä¸èµ·çš„ç›–èŒ¨æ¯”</title>
    <link href="https://soincredible.github.io/posts/3941b47a/"/>
    <id>https://soincredible.github.io/posts/3941b47a/</id>
    <published>2025-03-27T12:42:13.000Z</published>
    <updated>2025-04-17T05:42:38.183Z</updated>
    
    <content type="html"><![CDATA[<p>â€œæˆ‘ä»¬è¦æ˜ç™½ï¼Œè®²äº¤æƒ…è¦åœ¨äººæ´»ç€çš„æ—¶å€™è®²ï¼Œäººæ­»å°±æ²¡æœ‰äº¤æƒ…äº†ï¼Œâ€ä»–æ„å‘³æ·±é•¿åœ°è¯´ï¼Œâ€œæˆ‘è‡ªå·±çš„åŸåˆ™æ˜¯ï¼Œäººæ­»æˆ‘å°±ä»€ä¹ˆéƒ½ä¸ç®¡äº†ã€‚â€</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;â€œæˆ‘ä»¬è¦æ˜ç™½ï¼Œè®²äº¤æƒ…è¦åœ¨äººæ´»ç€çš„æ—¶å€™è®²ï¼Œäººæ­»å°±æ²¡æœ‰äº¤æƒ…äº†ï¼Œâ€ä»–æ„å‘³æ·±é•¿åœ°è¯´ï¼Œâ€œæˆ‘è‡ªå·±çš„åŸåˆ™æ˜¯ï¼Œäººæ­»æˆ‘å°±ä»€ä¹ˆéƒ½ä¸ç®¡äº†ã€‚â€&lt;/p&gt;
</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>å¸§åŒæ­¥ä¸çŠ¶æ€åŒæ­¥</title>
    <link href="https://soincredible.github.io/posts/50d23509/"/>
    <id>https://soincredible.github.io/posts/50d23509/</id>
    <published>2025-03-26T23:52:43.000Z</published>
    <updated>2025-04-27T01:30:44.578Z</updated>
    
    <content type="html"><![CDATA[<h1>ECSæ¶æ„</h1><p>ECSæ¶æ„çœ‹èµ·æ¥å°±æ˜¯è¿™æ ·å­çš„ã€‚å…ˆæœ‰ä¸ªWorldï¼Œå®ƒæ˜¯ç³»ç»Ÿï¼ˆè¯‘æ³¨ï¼Œè¿™é‡Œçš„ç³»ç»ŸæŒ‡çš„æ˜¯ECSä¸­çš„Sï¼Œä¸æ˜¯ä¸€èˆ¬æ„ä¹‰ä¸Šçš„ç³»ç»Ÿï¼Œä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œä¸‹æ–‡ç»Ÿç§°Systemï¼‰å’Œå®ä½“(Entity)çš„é›†åˆã€‚è€Œå®ä½“å°±æ˜¯ä¸€ä¸ªIDï¼Œè¿™ä¸ªIDå¯¹åº”äº†ç»„ä»¶(Component)çš„é›†åˆã€‚ç»„ä»¶ç”¨æ¥å­˜å‚¨æ¸¸æˆçŠ¶æ€å¹¶ä¸”æ²¡æœ‰ä»»ä½•çš„è¡Œä¸º(Behavior)ã€‚Systemæœ‰è¡Œä¸ºä½†æ˜¯æ²¡æœ‰çŠ¶æ€ã€‚</p><p>æ•°æ®å’Œé€»è¾‘åˆ†ç¦», Componentä¸­åªæœ‰æ•°æ®, Systemä¸­åªæœ‰é€»è¾‘, é¦–å…ˆæœ‰ä¸€ä¸ªWorld, ç®¡ç†ç€æ‰€æœ‰çš„Entityæ˜¯Componentçš„å®¹å™¨. è¿˜æœ‰ä¸€ä¸ªEntityAdminæ¥ç®¡ç†æ‰€æœ‰çš„Entity</p><p>æ¸¸æˆä¸­ä¸åŒçš„è§’è‰²,çœ‹å¾…åŒä¸€ä¸ªEntityä¸‹åŒä¸€ä¸ªComponentæ—¶çš„è§†è§’æ˜¯ä¸ä¸€æ ·çš„,è§’è‰²å¸Œæœ›è¿™ä¸ªComponentèƒ½åšä»€ä¹ˆ,é‚£ä¹ˆè¿™ä¸ªComponentå°±çœŸçš„å¯ä»¥åšä»€ä¹ˆ, Componentè‡ªå·±èƒ½åšä»€ä¹ˆä¸æ˜¯å®ƒè‡ªå·±å†³å®šçš„, è€Œæ˜¯ç”±å…¶è§‚å¯Ÿè€…å†³å®šçš„. ä½†æ˜¯è¿™äº›è§‚å¯Ÿè€…åº”å½“åªæ˜¯ä»Componentä¸­è¯»çŠ¶æ€, è€Œä¸ä¼šä¿®æ”¹Componentä¸­çš„çŠ¶æ€, Componentä¸­çš„çŠ¶æ€éœ€è¦æœ‰ä¸“é—¨å¯¹åº”çš„Systemè¿›è¡Œä¿®æ”¹.** ç»“æœçœ‹æ¥ï¼Œæ ¹æ®ä¸»ä½“è§†è§’åŒºåˆ†æ‰€æœ‰Behaviorï¼Œè¿™æ ·æ¥æè¿°ä¸€æ£µæ ‘çš„å…¨éƒ¨è¡Œä¸ºä¼šæ›´å®¹æ˜“ï¼Œè¿™ä¸ªé“ç†åŒæ ·ä¹Ÿé€‚ç”¨äºæ¸¸æˆå¯¹è±¡(game objects)ã€‚**</p><h1>åŒæ­¥ç›¸å…³</h1><p>æœåŠ¡å™¨ä¸Šä¼šæ„å»ºä¸€ä¸ªçº¯æ•°æ®å‘çš„World,æ‰€æœ‰Playerçš„æ“ä½œéƒ½ä¼šä¸ŠæŠ¥ç»™æœåŠ¡å™¨,ä¸è¿‡ç”±äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„é€šä¿¡å­˜åœ¨å»¶è¿Ÿ,å› æ­¤å®¢æˆ·ç«¯ä¼šç°åœ¨æœ¬åœ°è¿›è¡Œæ¨¡æ‹Ÿ,åŒæ—¶å°†æ“ä½œä¸ŠæŠ¥ç»™æœåŠ¡å™¨å¹¶ç­‰å¾…ç»“æœè¿”å›,å¦‚æœæœåŠ¡å™¨è¿”å›å›æ¥çš„æ•°æ®å’Œå®¢æˆ·ç«¯æ¨¡æ‹Ÿçš„ç»“æœæ˜¯ä¸€è‡´çš„,é‚£ä¹ˆå°±å¯ä»¥ç»§ç»­ä¸‹å»,å¦åˆ™å®¢æˆ·ç«¯å°±è¦ä¼šå›é€€çŠ¶æ€ ç„¶åå®¢æˆ·ç«¯è¿›è¡Œæ—¶é—´è†¨èƒ€.</p><h1>å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://www.bilibili.com/video/BV1RR4y1V7T2?spm_id_from=333.788.videopod.sections&amp;vd_source=83f4165825ce9df46cf4fd576ccb1102">çƒŸé›¨çš„è§†é¢‘æ•™ç¨‹</a></li><li><a href="https://www.youtube.com/watch?v=W3aieHjyNvw&amp;t=2886s">å®ˆæœ›å…ˆé”‹GDCè®²åº§â€”â€”æ¶æ„è®¾è®¡å’Œç½‘ç»œåŒæ­¥</a></li><li><a href="https://www.youtube.com/watch?v=W4oZq4tn57w">å®ˆæœ›å…ˆé”‹GDCå›æ”¾ç³»ç»Ÿã€å…¨åœºæœ€ä½³</a></li><li><a href="https://mp.weixin.qq.com/s/y8-Xb0az43pmjTlBXtNhdA">https://mp.weixin.qq.com/s/y8-Xb0az43pmjTlBXtNhdA</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;ECSæ¶æ„&lt;/h1&gt;
&lt;p&gt;ECSæ¶æ„çœ‹èµ·æ¥å°±æ˜¯è¿™æ ·å­çš„ã€‚å…ˆæœ‰ä¸ªWorldï¼Œå®ƒæ˜¯ç³»ç»Ÿï¼ˆè¯‘æ³¨ï¼Œè¿™é‡Œçš„ç³»ç»ŸæŒ‡çš„æ˜¯ECSä¸­çš„Sï¼Œä¸æ˜¯ä¸€èˆ¬æ„ä¹‰ä¸Šçš„ç³»ç»Ÿï¼Œä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œä¸‹æ–‡ç»Ÿç§°Systemï¼‰å’Œå®ä½“(Entity)çš„é›†åˆã€‚è€Œå®ä½“å°±æ˜¯ä¸€ä¸ªIDï¼Œè¿™ä¸ªIDå¯¹åº”äº†ç»„ä»¶(Component)çš„</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ETä¸­çš„å¼‚æ­¥</title>
    <link href="https://soincredible.github.io/posts/a8cdc42b/"/>
    <id>https://soincredible.github.io/posts/a8cdc42b/</id>
    <published>2025-03-25T08:21:26.000Z</published>
    <updated>2025-05-08T03:05:56.332Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸æ­¢è®¨è®ºETTaskå¦‚ä½•å®ç°, æ›´æƒ³æ¢è®¨C#åº•å±‚æ˜¯å¦‚ä½•æ”¯æŒå¼‚æ­¥å®ç°çš„. å¦‚æœè¯»è€…åƒç¬”è€…ä¸€æ ·, é€šè¿‡Unityæ¥è§¦åˆ°çš„C#è¯­è¨€, å¯èƒ½å¯¹åç¨‹å’Œå¼‚æ­¥æ¦‚å¿µçš„ç†è§£ä¸Šæœ‰åå·®, <strong>å› ä¸ºæˆ‘ä»¬åœ¨Unityä¸­ä½¿ç”¨çš„åç¨‹å¹¶ä¸æ˜¯æ“ä½œç³»ç»Ÿå±‚æ¬¡ä¸‹è®¨è®ºçš„ä¸çº¿ç¨‹ã€è¿›ç¨‹ã€åç¨‹ä¸­çš„åç¨‹æ¦‚å¿µ</strong>, Unityçš„åç¨‹æ˜¯UnityåŸºäºIEnumeratorå’ŒUnityäº‹ä»¶æ›´æ–°æ¡†æ¶å®ç°çš„ä¼ªåç¨‹ã€ä¼ªå¼‚æ­¥, Unityçš„åç¨‹é™åˆ¶éå¸¸å¤š, å¦‚æœè¯»è€…å¯¹Unityçš„åç¨‹ã€IEnumeratorå’Œ<code>yield return</code>è¯­æ³•ç³–æœ‰ç–‘æƒ‘, æ¬¢è¿å‚è€ƒ<a href="https://soincredible.github.io/posts/133a9667/">è¿™ç¯‡åšå®¢</a>, å¸Œæœ›èƒ½å¸®åŠ©ä½ ç†è§£.</p><p>æœ¬ç¯‡åšå®¢é¦–å…ˆä¼šè®¨è®ºC#ä¸­å¼‚æ­¥çš„å®ç°æ€è·¯, ç„¶åä¼šè®¨è®ºETTaskçš„å®ç°æ€è·¯</p><p>å¦å¤–, å¦‚æœè¯»è€…å¯¹C#ä¸­çš„å¼‚æ­¥ä¸æ˜¯å¾ˆäº†è§£, æ¨èå…ˆçœ‹ä¸€ä¸‹ä¸‹é¢å››ç¯‡ç¿»è¯‘çš„æ–‡ç« :<br><a href="">Dissecting the async methods in C#</a><br><a href="">Extending the async methods in C#</a><br><a href="">The performance characteristics of the async methods in C#</a><br><a href="">One user scenario to rule them all</a></p><p>è¯·æ€è€ƒè¿™å¥è¯: Taskæ˜¯Task, Asyncæ˜¯Async. æœ‰Taskå¹¶ä¸ä¸€å®šæ„å‘³ç€å¼‚æ­¥æ“ä½œ, æœ‰Asyncä¹Ÿå¹¶ä¸æ„å‘³ç€ä¸€å®šæœ‰å¼‚æ­¥æ“ä½œ. ä¹Ÿå°±æ˜¯è¯´, å¹¶ä¸æ˜¯åªæœ‰åœ¨å¼‚æ­¥çš„åœºæ™¯ä¸‹æˆ‘ä»¬æ‰å¯ä»¥ä½¿ç”¨Task, Taskä¾ç„¶å¯ä»¥åœ¨åŒæ­¥åœºæ™¯ä¸‹ä½¿ç”¨, è€Œ<code>async</code>å…³é”®å­—ä¹Ÿä¸èƒ½å®Œå…¨å’Œå¼‚æ­¥ç»‘å®š, å› ä¸º<code>async</code>å…³é”®å­—çš„ä½œç”¨åªæ˜¯å‘Šè¯‰ç¼–è¯‘å™¨å¯¹è¿™ä¸ªæ–¹æ³•åšä¸€äº›ç‰¹æ®Šçš„å¤„ç†: æ¯ä¸€ä¸ªè¢«æ ‡è®°ä¸ºasyncçš„æ–¹æ³•, Compileråœ¨èƒŒåéƒ½ä¼šåœ¨å…¶å†…éƒ¨ç”Ÿæˆä¸€ä¸ªçŠ¶æ€æœº.</p><h1>ä¸€ä¸ªç±»æ˜¯å¦‚ä½•å˜å¾—å¯ä»¥è¢«awaitçš„ï¼Ÿ</h1><p>åœ¨Sergeyçš„<a href="https://devblogs.microsoft.com/premier-developer/extending-the-async-methods-in-c/">è¿™ç¯‡åšå®¢</a>ä¸­æåˆ°, å¦‚æœè¦è®©ä¸€ä¸ªç±»å˜å¾—&quot;awaitable&quot;, è¿™ä¸ªç±»å°±å¿…é¡»éµå¾ªä¸€äº›æ¨¡å¼:</p><ul><li>ç¼–è¯‘å™¨è¦èƒ½å¤Ÿæ‰¾åˆ°ä¸€ä¸ªå®ä¾‹æˆ–è€…ä¸€ä¸ªæ‰©å±•æ–¹æ³•å«åš<code>GetAwaiter</code>. è¿™ä¸ªæ–¹æ³•çš„è¿”å›ç±»å‹éœ€è¦éµå®ˆæŸäº›è¦æ±‚:</li><li>è¿™ä¸ªè¿”å›ç±»å‹éœ€è¦å®ç°<code>INoifyCompletion</code>æ¥å£</li><li>è¿™ä¸ªè¿”å›ç±»å‹éœ€è¦æœ‰<code>bool IsCompleted&#123; get; &#125;</code>å±æ€§å’Œ<code>T GetResult()</code>æ–¹æ³•</li></ul><h1>å…³äºå¼‚æ­¥å’Œå¤šçº¿ç¨‹çš„è®¨è®º</h1><p>å¼‚æ­¥æ˜¯å¼‚æ­¥, å¤šçº¿ç¨‹æ˜¯å¤šçº¿ç¨‹</p><p>å¤šçº¿ç¨‹æ˜¯çœŸçº¿ç¨‹æ¦‚å¿µèŒƒå›´å†…çš„è®®é¢˜, è€Œå¼‚æ­¥çš„è®®é¢˜ä¸æ­¢åŒ…å«çº¿ç¨‹, è¿˜åŒ…å«ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å–ç­‰å’Œç‰©ç†ç¡¬ä»¶ç›¸å…³çš„èŒƒç•´</p><p>å› ä¸ºç½‘ç»œè¯·æ±‚å’Œæ–‡ä»¶è¯»å–ç­‰ä¸ç‰©ç†ç¡¬ä»¶äº¤äº’çš„è¿‡ç¨‹å¹¶ä¸å ç”¨çº¿ç¨‹, å› æ­¤åœ¨è¿›è¡Œç±»ä¼¼æ“ä½œçš„æ—¶å€™, çº¿ç¨‹ä¸Šæ˜¯å¯ä»¥æ‰§è¡Œåˆ«çš„ä»»åŠ¡çš„. è¿™ç§æƒ…å†µæ˜¯å¼‚æ­¥</p><p>åœ¨å¤šçº¿ç¨‹çš„èŒƒç•´é‡Œ, ç”±äºå¤šä¸ªä»»åŠ¡ç¡®å®å°±æ˜¯å¹¶è¡Œåœ°æ‰§è¡Œçš„, æˆ‘ä»¬ä¹Ÿå°†å…¶çœ‹æˆäº†å¼‚æ­¥</p><p>ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯, æˆ‘ä»¬Unityå¼€å‘è€…è°ƒç”¨Unityåº•å±‚APIçš„æ—¶å€™, å°±æ‹¿ç½‘ç»œè¯·æ±‚å’ŒåŠ è½½èµ„æºæ¥è¯´, Unityéƒ½ä¼šç»™æˆ‘ä»¬æä¾›ä¸¤ç§ç±»å‹çš„æ¥å£, ä¸€ç§æ˜¯å¼‚æ­¥, ä¸€ç§æ˜¯åŒæ­¥. è¿™ä¸¤ç§æ¥å£éƒ½æ˜¯I/Oå¯†é›†å‹æ“ä½œ, å› ä¸ºUnityæ˜¯å•çº¿ç¨‹å˜›. å¦‚æœä½ å¸¸å¸¸é™·å…¥çº ç»“ç½‘ç»œå’Œèµ„æºåŠ è½½çš„å†…éƒ¨å®ç°æ˜¯æ€æ ·çš„ ä¸åˆ©äºä½ äº†è§£å¼‚æ­¥çš„æœ¬è´¨,</p><p>æ‰€ä»¥å¦„å›¾ä½¿ç”¨åç¨‹æ¥åšä¸€äº›CPUå¯†é›†å‹çš„å·¥ä½œæ˜¯æ ¹æœ¬ä¸å¯èƒ½çš„, å› ä¸ºåç¨‹æœ¬è´¨ä¸Šè¿˜æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸Š, åç¨‹åè€Œé€‚åˆé‚£äº›I/Oå¯†é›†å‹çš„æ“ä½œ, å› ä¸ºè¿™ç±»æ“ä½œå¹¶ä¸çœŸçš„ä¼šå ç”¨CPUçš„æ‰§è¡Œæ—¶é—´, è¿™æ®µæ—¶é—´çš„CPUåªæ˜¯åœ¨ç©ºè½¬è€Œå·², æˆ–è€…æˆ‘ä»¬å¸Œæœ›ä½¿ç”¨åç¨‹è¾¾æˆä¸€ç§å»¶æ—¶çš„æ•ˆæœ</p><p>yieldå’Œawaitéƒ½èƒ½å®ç°å¼‚æ­¥, åŒºåˆ«æ˜¯ä»€ä¹ˆ?</p><p>è€Œå¤šçº¿ç¨‹æˆ‘ä»¬å¾€å¾€ä¼šç”¨å¤šçº¿ç¨‹æ¥åšä¸€äº›CPUå¯†é›†å‹çš„ä»»åŠ¡, æˆ‘ä»¬ä¼šå†³å®šè¿™äº›ä»»åŠ¡çš„å…·ä½“å®ç°, æˆ–è®¸ä¼šè®©ä½ æ›´å¥½ç†è§£</p><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ è¿™ä¸ªä¾‹å­</p><p>ThreadSynchronizationContextçš„ä½œç”¨?</p><h1>C#ä¸­è¦å®ç°å¼‚æ­¥éœ€è¦å“ªäº›è§’è‰²</h1><p>YooAssetã€ETTaskã€UniTaskä¸‰è€…å¼‚æ­¥çš„å®ç°æ–¹å¼çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p><h1>SynchronizationContext</h1><p>SynchronizationContextä¸­å­˜å‚¨äº†ä¸€äº›èƒ½å¤Ÿæ ‡è¯†çº¿ç¨‹èº«ä»½çš„ä¿¡æ¯ï¼Œç°åœ¨ä½ æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œä½ å¯ä»¥é€šè¿‡<code>SynchronizationContext.Send()</code>æˆ–è€…<code>SynchronizationContext.Post</code>æ–¹æ³•æŠŠä½ è¦æ‰§è¡Œçš„è¿™ä¸ªæ–¹æ³•ä¸¢ç»™ä½ æƒ³è¦è®©ä»–æ‰§è¡Œçš„çº¿ç¨‹é‡Œé¢å»ï¼Œå¯ä»¥æŠŠä»–ç†è§£ä¸ºæ˜¯ä¸€ç§è·¨çº¿ç¨‹çš„æ–¹æ³•è°ƒç”¨çš„æ–¹å¼ã€‚<br>åœ¨ä¸€èˆ¬å•çº¿ç¨‹é‡Œï¼Œæ–¹æ³•çš„è°ƒç”¨éƒ½æ˜¯ç›´æ¥ç›´å»ï¼Œè€Œåœ¨å¤šçº¿ç¨‹é‡Œé¢ï¼Œå¯ä»¥é€šè¿‡SynchronizationContextæ¥å®ç°çº¿ç¨‹é—´çš„å‡½æ•°è°ƒç”¨ã€‚<br>è¦æ³¨æ„ä¸€ä¸‹Sendå’ŒPostçš„åŒºåˆ«ï¼Œå¦‚æœä½¿ç”¨Sendçš„æ–¹å¼æŠŠä¸€ä¸ªæ–¹æ³•ä¸¢ç»™æŸä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œå¦‚æœè¿™ä¸ªæ–¹æ³•æ°å¥½å¾ˆè€—æ—¶ï¼Œé‚£ä¹ˆå°±ä¼šå¡ä½è°ƒç”¨Sendå¤„ä¹‹åä»£ç çš„æ‰§è¡Œï¼Œè€Œå¦‚æœä½¿ç”¨Postæ–¹æ³•çš„è¯ï¼Œåˆ™ä¸ä¼šé˜»å¡è°ƒç”¨å¤„ä¹‹åä»£ç çš„æ‰§è¡Œã€‚æ ¹æ®éœ€æ±‚é€‰æ‹©ç”¨Sendè¿˜æ˜¯Postã€‚ç¤ºä¾‹å¦‚ä¸‹ğŸ‘‡ğŸ‘‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">using System.Threading;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">namespace Learn</span><br><span class="line">&#123;</span><br><span class="line">    public class LearnSynchronizationContext : MonoBehaviour</span><br><span class="line">    &#123;</span><br><span class="line">        // SynchronizationContextçš„ç†è§£å’Œä½¿ç”¨</span><br><span class="line">        private SynchronizationContext _synchronizationContext;</span><br><span class="line"></span><br><span class="line">        private Thread _thread; // æ–°å»ºä¸€ä¸ªçº¿ç¨‹ è®©ä¸Šä¸‹æ–‡æŒ‡å‘è¿™ä¸ªçº¿ç¨‹</span><br><span class="line">        </span><br><span class="line">        public void Start()</span><br><span class="line">        &#123;</span><br><span class="line">            // ä¸èƒ½æŠŠè¿™ä¸ªä¸Šä¸‹æ–‡è®¾ç½®æˆä¸»çº¿ç¨‹ å› ä¸ºä¸‹é¢çš„æµ‹è¯•ä»£ç ä¸­è¦åœ¨è¯¥ä¸Šä¸‹æ–‡çº¿ç¨‹é‡Œé¢æ‰§è¡Œwhileå¾ªç¯</span><br><span class="line">            // ä¼šå¡ä½ä¸»çº¿ç¨‹</span><br><span class="line">            // _synchronizationContext = SynchronizationContext.Current;</span><br><span class="line">            this._synchronizationContext = new SynchronizationContext();</span><br><span class="line">            </span><br><span class="line">            // _thread = new Thread(() =&gt;</span><br><span class="line">            // &#123;</span><br><span class="line">            //     this._synchronizationContext.Post(async (obj) =&gt;</span><br><span class="line">            //     &#123;</span><br><span class="line">            //         // è®©è¿™ä¸ªæ–¹æ³•æ‰§è¡Œçš„ä¹…ä¸€ç‚¹</span><br><span class="line">            //         // å‘ä¸Šä¸‹æ–‡ä¸­æŠ›å‡ºä¸€ä¸ªæ–¹æ³•   </span><br><span class="line">            //         // æ‰§è¡ŒæŸä¸ªæ–¹æ³•ï¼Œ è¿™ä¸ªæ–¹æ³•è¦æ¯”è¾ƒè€—æ—¶ä¸€ç‚¹ æ‰èƒ½çœ‹å‡ºSendå’ŒPostçš„å·®è·</span><br><span class="line">            //         await Task.Delay(1000);</span><br><span class="line">            //</span><br><span class="line">            //         var str = obj as STR;</span><br><span class="line">            //         str.number = 20000;</span><br><span class="line">            //         var threadId = Thread.CurrentThread.ManagedThreadId;</span><br><span class="line">            //         Debug.Log(&quot;æ‰§è¡Œä¸Šä¸‹æ–‡Send/Postæ–¹æ³•çš„çº¿ç¨‹IDæ˜¯: &quot; + threadId);</span><br><span class="line">            //     &#125;, str);</span><br><span class="line">            //     </span><br><span class="line">            //     Debug.Log(&quot;strå­—æ®µä¸­çš„numberæ˜¯&quot; + str.number);</span><br><span class="line">            //     var threadId = Thread.CurrentThread.ManagedThreadId;</span><br><span class="line">            //     Debug.Log(&quot;æ‰§è¡Œçº¿ç¨‹æ–¹æ³•çš„çº¿ç¨‹IDæ˜¯&quot; + threadId);</span><br><span class="line">            //     Debug.Log(&quot;æˆ‘æ˜¯è°ƒç”¨ä¸Šä¸‹æ–‡Send/Postæ–¹æ³•ä¹‹åæ‰§è¡Œçš„è¯­å¥&quot;);</span><br><span class="line">            // &#125;);</span><br><span class="line"></span><br><span class="line">            // --------------------------------------------------</span><br><span class="line">            // Send</span><br><span class="line">            // --------------------------------------------------</span><br><span class="line">            </span><br><span class="line">            _thread = new Thread(() =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                this._synchronizationContext.Send((obj) =&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    // è®©è¿™ä¸ªæ–¹æ³•æ‰§è¡Œçš„ä¹…ä¸€ç‚¹</span><br><span class="line">                    // å‘ä¸Šä¸‹æ–‡ä¸­æŠ›å‡ºä¸€ä¸ªæ–¹æ³•   </span><br><span class="line">                    // æ‰§è¡ŒæŸä¸ªæ–¹æ³•ï¼Œ è¿™ä¸ªæ–¹æ³•è¦æ¯”è¾ƒè€—æ—¶ä¸€ç‚¹ æ‰èƒ½çœ‹å‡ºSendå’ŒPostçš„å·®è·</span><br><span class="line">                    while (true)</span><br><span class="line">                    &#123;</span><br><span class="line">                        </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, null);</span><br><span class="line">                </span><br><span class="line">                var threadId = Thread.CurrentThread.ManagedThreadId;</span><br><span class="line">                Debug.Log(&quot;æ‰§è¡Œçº¿ç¨‹æ–¹æ³•çš„çº¿ç¨‹IDæ˜¯&quot; + threadId);</span><br><span class="line">                Debug.Log(&quot;æˆ‘æ˜¯è°ƒç”¨ä¸Šä¸‹æ–‡Send/Postæ–¹æ³•ä¹‹åæ‰§è¡Œçš„è¯­å¥&quot;);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            // --------------------------------------------------</span><br><span class="line">            // Post</span><br><span class="line">            // --------------------------------------------------</span><br><span class="line">            </span><br><span class="line">            // _thread = new Thread(() =&gt;</span><br><span class="line">            // &#123;</span><br><span class="line">            //     this._synchronizationContext.Post((obj) =&gt;</span><br><span class="line">            //     &#123;</span><br><span class="line">            //         // è®©è¿™ä¸ªæ–¹æ³•æ‰§è¡Œçš„ä¹…ä¸€ç‚¹</span><br><span class="line">            //         // å‘ä¸Šä¸‹æ–‡ä¸­æŠ›å‡ºä¸€ä¸ªæ–¹æ³•   </span><br><span class="line">            //         // æ‰§è¡ŒæŸä¸ªæ–¹æ³•ï¼Œ è¿™ä¸ªæ–¹æ³•è¦æ¯”è¾ƒè€—æ—¶ä¸€ç‚¹ æ‰èƒ½çœ‹å‡ºSendå’ŒPostçš„å·®è·</span><br><span class="line">            //         while (true)</span><br><span class="line">            //         &#123;</span><br><span class="line">            //             </span><br><span class="line">            //         &#125;</span><br><span class="line">            //     &#125;, str);</span><br><span class="line">            //     </span><br><span class="line">            //     Debug.Log(&quot;strå­—æ®µä¸­çš„numberæ˜¯&quot; + str.number);</span><br><span class="line">            //     var threadId = Thread.CurrentThread.ManagedThreadId;</span><br><span class="line">            //     Debug.Log(&quot;æ‰§è¡Œçº¿ç¨‹æ–¹æ³•çš„çº¿ç¨‹IDæ˜¯&quot; + threadId);</span><br><span class="line">            //     Debug.Log(&quot;æˆ‘æ˜¯è°ƒç”¨ä¸Šä¸‹æ–‡Send/Postæ–¹æ³•ä¹‹åæ‰§è¡Œçš„è¯­å¥&quot;);</span><br><span class="line">            // &#125;);</span><br><span class="line">            </span><br><span class="line">            // å¼€å§‹æ‰§è¡Œè¿™ä¸ªçº¿ç¨‹ </span><br><span class="line">            this._thread.Start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>C# ä¸­å‡ ç§å¼‚æ­¥çš„è¿”å›ç±»å‹</h1><p>C#ä¸­æœ‰ä¸‰ç§æ¯”è¾ƒå¸¸ç”¨çš„è¿”å›ç±»å‹: voidã€Task<TResult>å’ŒTask</p><h1>TaskCompletionSourceæ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>æŒ‰ç…§ç¬”è€…çš„ç†è§£ï¼ŒTaskCompletionSourceå¯ä»¥å°†ä¸€ä¸ªåŸºäºå›è°ƒçš„å¼‚æ­¥æ“ä½œè½¬æ¢æˆä¸€ä¸ªå¯ä»¥è¢«awaitçš„å¼‚æ­¥æ“ä½œã€‚</p><p>æŠ›å¼€ETçš„ä¸€ä¸ªä¾‹å­ï¼Œæ¯”å¦‚åç¨‹ åç¨‹æ˜¯ä¸å¯ä»¥è¢«awaitçš„</p><h1>ICriticalNotifyCompletion</h1><h2 id="å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£</h2><ul><li><a href="https://blog.csdn.net/q__y__L/article/details/133905192">https://blog.csdn.net/q__y__L/article/details/133905192</a></li><li><a href="https://devblogs.microsoft.com/premier-developer/dissecting-the-async-methods-in-c/">https://devblogs.microsoft.com/premier-developer/dissecting-the-async-methods-in-c/</a></li><li><a href="https://devblogs.microsoft.com/premier-developer/extending-the-async-methods-in-c/">https://devblogs.microsoft.com/premier-developer/extending-the-async-methods-in-c/</a></li><li><a href="https://devblogs.microsoft.com/premier-developer/the-performance-characteristics-of-async-methods/">https://devblogs.microsoft.com/premier-developer/the-performance-characteristics-of-async-methods/</a></li><li><a href="https://devblogs.microsoft.com/premier-developer//one-user-scenario-to-rule-them-all/">https://devblogs.microsoft.com/premier-developer//one-user-scenario-to-rule-them-all/</a></li><li><a href="https://www.cnblogs.com/liqingwen/p/6218994.html?tdsourcetag=s_pcqq_aiomsg">https://www.cnblogs.com/liqingwen/p/6218994.html?tdsourcetag=s_pcqq_aiomsg</a></li><li><a href="https://www.cnblogs.com/wwkk/p/17814057.html">https://www.cnblogs.com/wwkk/p/17814057.html</a></li><li><a href="https://blog.csdn.net/shizuguilai/article/details/121236777">https://blog.csdn.net/shizuguilai/article/details/121236777</a></li><li><a href="https://www.cnblogs.com/peterYong/p/16328187.html">https://www.cnblogs.com/peterYong/p/16328187.html</a></li><li><a href="https://learn.microsoft.com/en-us/archive/msdn-magazine/2011/february/msdn-magazine-parallel-computing-it-s-all-about-the-synchronizationcontext">https://learn.microsoft.com/en-us/archive/msdn-magazine/2011/february/msdn-magazine-parallel-computing-it-s-all-about-the-synchronizationcontext</a></li><li><a href="https://www.cnblogs.com/eventhorizon/p/15316955.html#4991898">https://www.cnblogs.com/eventhorizon/p/15316955.html#4991898</a></li><li><a href="https://www.cnblogs.com/eventhorizon/p/15824541.html">https://www.cnblogs.com/eventhorizon/p/15824541.html</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æœ¬ç¯‡åšå®¢ä¸æ­¢è®¨è®ºETTaskå¦‚ä½•å®ç°, æ›´æƒ³æ¢è®¨C#åº•å±‚æ˜¯å¦‚ä½•æ”¯æŒå¼‚æ­¥å®ç°çš„. å¦‚æœè¯»è€…åƒç¬”è€…ä¸€æ ·, é€šè¿‡Unityæ¥è§¦åˆ°çš„C#è¯­è¨€, å¯èƒ½å¯¹åç¨‹å’Œå¼‚æ­¥æ¦‚å¿µçš„ç†è§£ä¸Šæœ‰åå·®, &lt;strong&gt;å› ä¸ºæˆ‘ä»¬åœ¨Unityä¸­ä½¿ç”¨çš„åç¨‹å¹¶ä¸æ˜¯æ“ä½œç³»ç»Ÿå±‚æ¬¡ä¸‹è®¨è®ºçš„ä¸çº¿ç¨‹ã€è¿›ç¨‹ã€åç¨‹ä¸­çš„åç¨‹</summary>
      
    
    
    
    <category term="ET" scheme="https://soincredible.github.io/categories/ET/"/>
    
    
    <category term="ET" scheme="https://soincredible.github.io/tags/ET/"/>
    
  </entry>
  
  <entry>
    <title>UniTask</title>
    <link href="https://soincredible.github.io/posts/9955c97f/"/>
    <id>https://soincredible.github.io/posts/9955c97f/</id>
    <published>2025-03-20T14:03:33.000Z</published>
    <updated>2025-04-17T05:42:38.062Z</updated>
    
    <content type="html"><![CDATA[<p>ï¼ˆæ‘˜æŠ„è‡ªCLR Via C#ï¼‰å¼‚æ­¥å‡½æ•°å­˜åœ¨ä»¥ä¸‹é™åˆ¶ï¼š</p><ul><li><p>ä¸èƒ½å°†åº”ç”¨ç¨‹åºçš„Mainæ–¹æ³•è½¬å˜æˆå¼‚æ­¥å‡½æ•°ã€‚å¦å¤–æ„é€ å™¨ã€å±æ€§è®¿é—®å™¨æ–¹æ³•å’Œäº‹ä»¶è®¿é—®å™¨æ–¹æ³•ä¸èƒ½è½¬å˜æˆå¼‚æ­¥å‡½æ•°</p></li><li><p>å¼‚æ­¥å‡½æ•°ä¸èƒ½ä½¿ç”¨ä»»ä½•outæˆ–è€…refå‚æ•°</p></li><li><p>ä¸èƒ½åœ¨catchï¼Œfinallyæˆ–unsafeå—ä¸­ä½¿ç”¨awaitæ“ä½œç¬¦ï¼ˆæ³¨æ„åœ¨tryä¸­å¯ä»¥ä½¿ç”¨awaitï¼Œç¬”è€…è®°å¾—UniTaskçš„æ–‡æ¡£ä¸­è¯´è¿‡æ˜¯å¯ä»¥åœ¨try catchä¸­ä½¿ç”¨UniTaskå¹¶è¢«æ•è·çš„ï¼Œæ˜¯å› ä¸ºUniTaskå®ç°äº†è‡ªå·±çš„<code>AsyncMethodBuilderAttribute</code>å—ï¼Ÿ è®°å¾—çœ‹ä¸€ä¸‹ï¼‰ã€‚</p></li><li><p>ä¸èƒ½åœ¨awaitæ“ä½œç¬¦ä¹‹å‰è·å¾—ä¸€ä¸ªæ”¯æŒçº¿ç¨‹æ‰€æœ‰æƒæˆ–é€’å½’çš„é”ï¼Œå¹¶åœ¨awaitæ“ä½œç¬¦ä¹‹åé‡Šæ”¾å®ƒã€‚è¿™æ˜¯å› ä¸ºawaitä¹‹å‰çš„ä»£ç ç”±ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œä¹‹åçš„ä»£ç åˆ™å¯èƒ½ç”±å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚ï¼ˆä½¿ç”¨äº†awaitå°±ä¸€å®šä¼šæ¶‰åŠåˆ°å¤šçº¿ç¨‹å—ï¼Ÿé‚£UniTaskæ˜¯æ€ä¹ˆä¿è¯å®ƒä½¿ç”¨awaitçš„æ—¶å€™æ˜¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹å†…ï¼Ÿï¼‰åœ¨C#çš„lockè¯­å¥ä¸­ä½¿ç”¨awaitï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚å¦‚æœæ˜¾å¼è°ƒç”¨Monitorçš„Enterå’ŒExitæ–¹æ³•ï¼Œé‚£ä¹ˆä»£ç è™½ç„¶å¯ä»¥ç¼–è¯‘ï¼Œä½†Monitor.Exitä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡ºä¸€ä¸ªSynchronizationLockExceptionã€‚</p></li><li><p>åœ¨æŸ¥è¯¢è¡¨è¾¾å¼ä¸­ï¼Œawaitæ“ä½œç¬¦åªèƒ½åœ¨åˆå§‹fromå­å¥çš„ç¬¬ä¸€ä¸ªé›†åˆè¡¨è¾¾å¼ä¸­ä½¿ç”¨ï¼Œæˆ–è€…åœ¨joinå­å¥çš„é›†åˆè¡¨è¾¾å¼ä¸­ä½¿ç”¨ã€‚</p></li><li><p>å…³äºï¼ˆä½¿ç”¨äº†awaitå°±ä¸€å®šä¼šæ¶‰åŠåˆ°å¤šçº¿ç¨‹å—ï¼Ÿé‚£UniTaskæ˜¯æ€ä¹ˆä¿è¯å®ƒä½¿ç”¨awaitçš„æ—¶å€™æ˜¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹å†…ï¼Ÿï¼‰GPTçš„å›å¤ï¼š<br>æ˜¯çš„ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯Unityä¸“ç”¨çš„å¼‚æ­¥APIï¼ˆå¦‚UnityWebRequestï¼‰ï¼Œawaitè¿™äº›APIçš„æ“ä½œé€šå¸¸ä¼šåœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚<br>å¦‚æœå¼€å‘è€…æ˜¾å¼åˆ›å»ºTaskæˆ–Threadå¹¶awaitè¿™äº›ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡å¯èƒ½åœ¨éä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œä½†awaitåç»­çš„ä»£ç ä¾ç„¶ä¼šå›åˆ°ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚<br>å› æ­¤ï¼Œç†è§£ä¸Šå¯ä»¥ç®€åŒ–ä¸ºï¼šåªè¦ä¸æ˜¯å¼€å‘è€…ä¸»åŠ¨ä½¿ç”¨å¤šçº¿ç¨‹æœºåˆ¶ï¼Œä¸€èˆ¬æ‰€æœ‰çš„awaitæ“ä½œéƒ½ä¼šç¡®ä¿åœ¨ä¸»çº¿ç¨‹ä¸Šå®‰å…¨åœ°æ‰§è¡Œåç»­æ“ä½œã€‚</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ï¼ˆæ‘˜æŠ„è‡ªCLR Via C#ï¼‰å¼‚æ­¥å‡½æ•°å­˜åœ¨ä»¥ä¸‹é™åˆ¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¸èƒ½å°†åº”ç”¨ç¨‹åºçš„Mainæ–¹æ³•è½¬å˜æˆå¼‚æ­¥å‡½æ•°ã€‚å¦å¤–æ„é€ å™¨ã€å±æ€§è®¿é—®å™¨æ–¹æ³•å’Œäº‹ä»¶è®¿é—®å™¨æ–¹æ³•ä¸èƒ½è½¬å˜æˆå¼‚æ­¥å‡½æ•°&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¼‚æ­¥å‡½æ•°ä¸èƒ½ä½¿ç”¨ä»»ä½•outæˆ–è€…refå‚æ•°&lt;/</summary>
      
    
    
    
    
  </entry>
  
</feed>
