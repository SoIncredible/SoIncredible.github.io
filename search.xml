<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>UnrealEngineæºç </title>
      <link href="/posts/43a309b5/"/>
      <url>/posts/43a309b5/</url>
      
        <content type="html"><![CDATA[<p>è™šå¹»å¼•æ“çš„ä»£ç ä½¿ç”¨çš„æ˜¯å¤æ—©ç‰ˆæœ¬çš„C++, è·Ÿç°ä»£çš„C++æœ‰äº›è„±èŠ‚äº†, æ‰€ä»¥å¯ä»¥æŠŠè™šå¹»å¼•æ“çš„æºä»£ç ç†è§£ä¸ºæ˜¯C++çš„ä¸€ä¸ªå˜ç§</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨Unityä¸­å®ç°æ‹–æ‹½ç‰©ä½“çš„åŠŸèƒ½</title>
      <link href="/posts/aa328bbc/"/>
      <url>/posts/aa328bbc/</url>
      
        <content type="html"><![CDATA[<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.EventSystems;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">MB</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DraggableObj</span> : <span class="title">MonoBehaviour</span>, </span><br><span class="line">        <span class="title">IDragHandler</span>, <span class="title">IBeginDragHandler</span>, <span class="title">IEndDragHandler</span></span><br><span class="line">    </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">enum</span> DragState</span><br><span class="line">        &#123;</span><br><span class="line">            None,</span><br><span class="line">            Idle,</span><br><span class="line">            Dragging,</span><br><span class="line">        &#125;    </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">private</span> DragState dragState = DragState.None;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnDrag</span>(<span class="params">PointerEventData eventData</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(<span class="string">&quot;æ‹–æ‹½ä¸­...&quot;</span>);</span><br><span class="line">            RectTransformUtility.ScreenPointToLocalPointInRectangle(transform.parent.transform <span class="keyword">as</span> RectTransform, eventData.position, Camera.main, <span class="keyword">out</span> Vector2 point);</span><br><span class="line">            transform.localPosition = point;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnBeginDrag</span>(<span class="params">PointerEventData eventData</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(<span class="string">&quot;å¼€å§‹æ‹–æ‹½&quot;</span>);</span><br><span class="line">            transform.localScale = Vector3.one * <span class="number">1.5f</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnEndDrag</span>(<span class="params">PointerEventData eventData</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(<span class="string">&quot;æ‹–æ‹½ç»“æŸ...&quot;</span>);</span><br><span class="line">            transform.localScale = Vector3.one;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å°†ä¸Šé¢çš„é€»è¾‘è¿›ä¸€æ­¥æŠ½è±¡ä¸€ä¸‹, æŠŠæ¯ä¸ªæ¥å£å†…çš„è¡Œä¸ºæŠ½ç¦»å‡ºæ¥, ä½œä¸ºä¸€ä¸ªaction, åœ¨åˆé€‚çš„æ—¶æœºä¼ è¿›å».</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>FigmaAPIé˜…è¯»</title>
      <link href="/posts/8d32db40/"/>
      <url>/posts/8d32db40/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.figma.com/developers/api#intro">https://www.figma.com/developers/api#intro</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Unityæºç é˜…è¯»</title>
      <link href="/posts/4d404b8c/"/>
      <url>/posts/4d404b8c/</url>
      
        <content type="html"><![CDATA[<p>Unityä¸­æœ‰ä¸€ç§<code>.bindings </code>æ ¼å¼çš„æ–‡ä»¶, è¿™ç±»æ–‡ä»¶ç»è¿‡æŸç§å¤„ç†ä¼šè½¬æ¢ä¸ºC#æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line">C++RAW</span><br><span class="line"></span><br><span class="line">#include &quot;UnityPrefix.h&quot;</span><br><span class="line">#include &quot;Configuration/UnityConfigure.h&quot;</span><br><span class="line">#include &quot;Runtime/Mono/MonoBehaviour.h&quot;</span><br><span class="line">#include &quot;Runtime/UI/Canvas.h&quot;</span><br><span class="line">#include &quot;Runtime/UI/UIStructs.h&quot;</span><br><span class="line">#include &quot;Runtime/UI/BatchGenerator.h&quot;</span><br><span class="line"></span><br><span class="line">#if ENABLE_PROFILER</span><br><span class="line">#include &quot;Modules/Profiler/Public/ProfilerImpl.h&quot;</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">CSRAW</span><br><span class="line">using System;</span><br><span class="line">using UnityEngine;</span><br><span class="line">using Object = UnityEngine.Object;</span><br><span class="line"></span><br><span class="line">namespace UnityEngine</span><br><span class="line">&#123;</span><br><span class="line">    ENUM RenderMode</span><br><span class="line">        ScreenSpaceOverlay = 0,</span><br><span class="line">        ScreenSpaceCamera = 1,</span><br><span class="line">        WorldSpace = 2</span><br><span class="line">    END</span><br><span class="line"></span><br><span class="line">    [Flags]</span><br><span class="line">    ENUM AdditionalCanvasShaderChannels</span><br><span class="line">        None = 0,</span><br><span class="line">        TexCoord1 = 1 &lt;&lt; 0,</span><br><span class="line">        TexCoord2 = 1 &lt;&lt; 1,</span><br><span class="line">        TexCoord3 = 1 &lt;&lt; 2,</span><br><span class="line">        Normal = 1 &lt;&lt; 3,</span><br><span class="line">        Tangent = 1 &lt;&lt; 4,</span><br><span class="line">    END</span><br><span class="line"></span><br><span class="line">    // CanvasRenderer is the C++ rendering backend for the UI system.</span><br><span class="line">    [RequireComponent(typeof(RectTransform))]</span><br><span class="line">    [NativeClass(&quot;UI::Canvas&quot;)]</span><br><span class="line">    CLASS Canvas : Behaviour</span><br><span class="line"></span><br><span class="line">        AUTO_PROP RenderMode renderMode GetRenderMode SetRenderMode</span><br><span class="line">        AUTO_PROP bool isRootCanvas GetIsRootCanvas</span><br><span class="line">        AUTO_PTR_PROP Camera worldCamera GetCamera SetCamera</span><br><span class="line">        AUTO_PROP Rect pixelRect GetPixelRect</span><br><span class="line">        AUTO_PROP float scaleFactor GetScaleFactor SetScaleFactor</span><br><span class="line">        AUTO_PROP float referencePixelsPerUnit GetReferencePixelsPerUnit SetReferencePixelsPerUnit</span><br><span class="line">        AUTO_PROP bool overridePixelPerfect GetOverridePixelPerfect SetOverridePixelPerfect</span><br><span class="line">        AUTO_PROP bool pixelPerfect GetPixelPerfect SetPixelPerfect</span><br><span class="line">        AUTO_PROP float planeDistance GetPlaneDistance SetPlaneDistance</span><br><span class="line"></span><br><span class="line">        AUTO_PROP int renderOrder GetRenderOrder</span><br><span class="line"></span><br><span class="line">        AUTO_PROP bool overrideSorting GetOverrideSorting SetOverrideSorting</span><br><span class="line">        AUTO_PROP int sortingOrder GetSortingOrder SetSortingOrder</span><br><span class="line">        AUTO_PROP int targetDisplay GetTargetDisplay SetTargetDisplay</span><br><span class="line"></span><br><span class="line">        OBSOLETE warning Setting normalizedSize via a int is not supported. Please use normalizedSortingGridSize</span><br><span class="line">        AUTO_PROP int sortingGridNormalizedSize GetSortingBucketNormalizedSize SetSortingBucketNormalizedSize</span><br><span class="line"></span><br><span class="line">        AUTO_PROP float normalizedSortingGridSize GetSortingBucketNormalizedSize SetSortingBucketNormalizedSize</span><br><span class="line"></span><br><span class="line">        AUTO_PROP int sortingLayerID GetSortingLayerID SetSortingLayerID</span><br><span class="line">        AUTO_PROP int cachedSortingLayerValue GetCachedSortingLayerValue</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        AUTO_PROP AdditionalCanvasShaderChannels additionalShaderChannels GetAdditionalShaderChannels SetAdditionalShaderChannels</span><br><span class="line"></span><br><span class="line">        CUSTOM_PROP string sortingLayerName</span><br><span class="line">        &#123;</span><br><span class="line">            return scripting_string_new(self-&gt;GetSortingLayerName());</span><br><span class="line">        &#125;</span><br><span class="line">        &#123;</span><br><span class="line">            self-&gt;SetSortingLayerName(value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        CUSTOM_PROP Canvas rootCanvas</span><br><span class="line">        &#123;</span><br><span class="line">            UI::Canvas* root = self-&gt;GetRootCanvas();</span><br><span class="line">            return Scripting::ScriptingWrapperFor(root == NULL ? self : root);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        CUSTOM static Material GetDefaultCanvasMaterial()</span><br><span class="line">        &#123;</span><br><span class="line">            return Scripting::ScriptingWrapperFor(UI::GetDefaultUIMaterial());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        CUSTOM static Material GetETC1SupportedCanvasMaterial()</span><br><span class="line">        &#123;</span><br><span class="line">            return Scripting::ScriptingWrapperFor(UI::GetETC1SupportedCanvasMaterial());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        OBSOLETE warning Shared default material now used for text and general UI elements, call Canvas.GetDefaultCanvasMaterial()</span><br><span class="line">        CUSTOM static Material GetDefaultCanvasTextMaterial()</span><br><span class="line">        &#123;</span><br><span class="line">            return Scripting::ScriptingWrapperFor(UI::GetDefaultUIMaterial());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        CSRAW</span><br><span class="line">        public delegate void WillRenderCanvases();</span><br><span class="line">        public static event WillRenderCanvases willRenderCanvases;</span><br><span class="line">        [RequiredByNativeCode]</span><br><span class="line">        private static void SendWillRenderCanvases() &#123; if (willRenderCanvases != null) willRenderCanvases(); &#125;</span><br><span class="line">        public static void ForceUpdateCanvases() &#123; SendWillRenderCanvases(); &#125;</span><br><span class="line">    END</span><br><span class="line"></span><br><span class="line">    CLASS UISystemProfilerApi</span><br><span class="line">        C++RAW</span><br><span class="line">        enum SampleType &#123; Layout, Render &#125;;</span><br><span class="line">        ENUM SampleType</span><br><span class="line">            Layout,</span><br><span class="line">            Render,</span><br><span class="line">        END</span><br><span class="line">        CUSTOM static public void BeginSample(SampleType type)</span><br><span class="line">        &#123;</span><br><span class="line">#if ENABLE_PROFILER</span><br><span class="line">            if (UnityProfilerPerThread::ms_InstanceTLS != NULL)</span><br><span class="line">            &#123;</span><br><span class="line">                ProfilerInformation&amp; profilerInfo = *profiler_get_info_for_name(type == Layout ? &quot;Layout&quot; : &quot;Render&quot;, type == Layout ? kProfilerUISystemLayout : kProfilerUISystemRender);</span><br><span class="line">                PROFILER_BEGIN(profilerInfo, NULL);</span><br><span class="line">            &#125;</span><br><span class="line">#endif // ENABLE_PROFILER</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        CUSTOM static public void EndSample(SampleType type)</span><br><span class="line">        &#123;</span><br><span class="line">#if ENABLE_PROFILER</span><br><span class="line">            if (UnityProfilerPerThread::ms_InstanceTLS != NULL)</span><br><span class="line">            &#123;</span><br><span class="line">                ProfilerInformation&amp; profilerInfo = *profiler_get_info_for_name(type == Layout ? &quot;Layout&quot; : &quot;Render&quot;, type == Layout ? kProfilerUISystemLayout : kProfilerUISystemRender);</span><br><span class="line">                PROFILER_END(profilerInfo);</span><br><span class="line">            &#125;</span><br><span class="line">#endif // ENABLE_PROFILER</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        CUSTOM static public void AddMarker(string name, Object obj)</span><br><span class="line">        &#123;</span><br><span class="line">#if ENABLE_PROFILER &amp;&amp; UNITY_EDITOR</span><br><span class="line">            InstanceID instanceID = InstanceID_None;</span><br><span class="line">            std::string nameStr(name);</span><br><span class="line">            if (!obj.IsNull() &amp;&amp; Thread::CurrentThreadIsMainThread())</span><br><span class="line">            &#123;</span><br><span class="line">                instanceID =  obj-&gt;GetInstanceID();</span><br><span class="line">                nameStr += &quot; &quot;;</span><br><span class="line">                nameStr += obj-&gt;GetName();</span><br><span class="line">            &#125;</span><br><span class="line">            UI::GetCanvasManager().AddMarker(nameStr.c_str(), instanceID);</span><br><span class="line">#endif // ENABLE_PROFILER</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    END</span><br><span class="line"></span><br><span class="line">    CSRAW</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>UnityUGUIè§£æ„(äºŒ)-EventSystem</title>
      <link href="/posts/28d70de0/"/>
      <url>/posts/28d70de0/</url>
      
        <content type="html"><![CDATA[<h1>GraphicRaycaster</h1><p>ä¸ºä»€ä¹ˆåœ¨åˆ›å»ºCanvasèŠ‚ç‚¹çš„æ—¶å€™, éƒ½è¦GrapihcRaycasterä¼šè‡ªåŠ¨åˆ›å»º<br>GrapihcRaycasterç»„ä»¶ä¸æ˜¯å¿…é¡»çš„, åˆ é™¤æ‰ä¹‹åè¿™ä¸ªCanvaså°±ä¸èƒ½å“åº”ç‚¹å‡»äº†.</p><p>è¦çœ‹æ˜ç™½ä¸‹é¢è¿™æ®µé€»è¾‘æ˜¯åœ¨å¹²ä»€ä¹ˆ</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="built_in">bool</span> <span class="title">Raycast</span>(<span class="params">Vector2 sp, Camera eventCamera</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!isActiveAndEnabled)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> t = transform;</span><br><span class="line">    <span class="keyword">var</span> components = ListPool&lt;Component&gt;.Get();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">bool</span> ignoreParentGroups = <span class="literal">false</span>;</span><br><span class="line">    <span class="built_in">bool</span> continueTraversal = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (t != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        t.GetComponents(components);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; components.Count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> canvas = components[i] <span class="keyword">as</span> Canvas;</span><br><span class="line">            <span class="keyword">if</span> (canvas != <span class="literal">null</span> &amp;&amp; canvas.overrideSorting)</span><br><span class="line">                continueTraversal = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> filter = components[i] <span class="keyword">as</span> ICanvasRaycastFilter;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (filter == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> raycastValid = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> <span class="keyword">group</span> = components[i] <span class="keyword">as</span> CanvasGroup;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">group</span> != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (!<span class="keyword">group</span>.enabled)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (ignoreParentGroups == <span class="literal">false</span> &amp;&amp; <span class="keyword">group</span>.ignoreParentGroups)</span><br><span class="line">                &#123;</span><br><span class="line">                    ignoreParentGroups = <span class="literal">true</span>;</span><br><span class="line">                    raycastValid = filter.IsRaycastLocationValid(sp, eventCamera);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (!ignoreParentGroups)</span><br><span class="line">                    raycastValid = filter.IsRaycastLocationValid(sp, eventCamera);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                raycastValid = filter.IsRaycastLocationValid(sp, eventCamera);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!raycastValid)</span><br><span class="line">            &#123;</span><br><span class="line">                ListPool&lt;Component&gt;.Release(components);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        t = continueTraversal ? t.parent : <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ListPool&lt;Component&gt;.Release(components);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>EventSystemçš„è§¦å‘æœºç†</h1><p>ä¾èµ–Raycastç»™çš„ä¸€äº›æ•°æ®, ç”¨è¿™äº›æ•°æ®æ‰¾åˆ°Raycastå‘½ä¸­çš„gameobject, æ‰¾åˆ°è¿™äº›gameObjectä¸Šçš„Handlerç»„ä»¶, è§¦å‘è¿™äº›Handler.</p><p>ä¸ç®¡å¸‚é¢ä¸Šçš„UnityUIçš„æ–¹æ¡ˆ(æ¯”å¦‚FGUI)å¤šç‚«é…·, æœ€ç»ˆåˆ°Unityä¸­éƒ½æ˜¯è¦èµ°UGUIçš„åº•å±‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Actoræ¨¡å‹</title>
      <link href="/posts/d6fe94a3/"/>
      <url>/posts/d6fe94a3/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>è¿‘æœŸå­¦å‰ä»–å¿ƒå¾—</title>
      <link href="/posts/5b1bb5d7/"/>
      <url>/posts/5b1bb5d7/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>UnityUGUIè§£æ„(ä¸€)â€”â€”RectTransform</title>
      <link href="/posts/67d7d086/"/>
      <url>/posts/67d7d086/</url>
      
        <content type="html"><![CDATA[<p>RectTransformç»§æ‰¿è‡ªTransform, å¹¶æ²¡æœ‰åŒ…å«åœ¨UGUIä½“ç³»é‡Œé¢, ä½†æ˜¯RectTransformçš„å­—æ®µç»å¤§å¤šæ•°æƒ…å†µä¸‹åªåœ¨UGUIä½“ç³»ä¸­æ‰æœ‰æ„ä¹‰.  å› æ­¤æˆ‘ä»¬å¯ä»¥å°†RectTransformçœ‹ä½œæ˜¯Unity UGUIçš„ä¸€éƒ¨åˆ†, å¹¶ä¸”å°†å…¶ä½œä¸ºUGUIç³»åˆ—ä¸­é¦–ä¸ªåˆ†æçš„å¯¹è±¡.</p><h1>é”šç‚¹(Anchor)ä¸ä¸­å¿ƒç‚¹(Pivot)</h1><h2 id="é”šç‚¹Anchor">é”šç‚¹Anchor</h2><p>è¿™ä¸ªAnchorå¹¶ä¸æ˜¯ç›´æ¥å‚ä¸ä½ç½®ä¿¡æ¯è¿ç®—çš„æ•°æ®, Unityä¼šå…ˆæ ¹æ®è¿™ä¸ªä¿¡æ¯è®¡ç®—å‡ºä¸€ä¸ªanchorReferencePosition, å†ç”¨è¿™ä¸ªå€¼è¿›è¡Œå…¶ä»–çš„è¿ç®—.<br>åœ¨Unityä¸­ é”šç‚¹æ˜¯å¯ä»¥è‡³å¤šè¢«åˆ†æˆå››ä¸ªè§’çš„, å¹¶ä¸æ˜¯ä¸€ä¸ªç‚¹. è€Œåœ¨è®¡ç®—ä¸€ä¸ªRectTransformä¸­çš„ä¸€äº›å±æ€§æ—¶éœ€è¦æŠŠé”šç‚¹ä½œä¸ºä¸€ä¸ª&quot;ç‚¹&quot; å‚ä¸è¿ç®—, ä½œä¸ºå››ä¸ªè§’ä¸é‡åˆçš„æƒ…å†µ, éœ€è¦æœ‰ä¸€ä¸ªAnchor Reference Positionæ¥ä½œä¸ºé”šç‚¹,<br>Anchor Reference Positionçš„è®¡ç®—å…¬å¼å¦‚ä¸‹:<br>$$ AnchorReferencePosition_x = (1 - pivot_x) \times x_0 + pivot_x \times x_1 $$<br>$$ AnchorReferencePosition_y = (1 - pivot_y) \times y_0 + pivot_y \times y_1 $$<br>å…¶ä¸­ (x0, y0)ä»£è¡¨çš„æ˜¯AnchorMinåœ¨è¯¥RectTransformçš„çˆ¶èŠ‚ç‚¹ä¸­çš„ä½ç½®, (x1, y1)ä»£è¡¨çš„æ˜¯AnchorMaxåœ¨è¯¥RectTransformçš„çˆ¶èŠ‚ç‚¹ä¸­çš„ä½ç½®, (pivotx, pivoty)æŒ‡çš„æ˜¯ä¸­å¿ƒç‚¹çš„å½’ä¸€åŒ–ä½ç½®åæ ‡</p><p>æœ‰ä¸€ä¸ªæ¦‚å¿µå«AnchoredPosition, è¿™ä¸ªå€¼çš„å«ä¹‰æ˜¯Pivotç‚¹ç›¸å¯¹äº<code>Anchor Reference Position</code>çš„è·ç¦», å½“é”šç‚¹çš„å››ä¸ªè§’æ²¡æœ‰é‡åˆåœ¨ä¸€ç‚¹æ—¶, æˆ‘ä»¬å¯èƒ½ä¼šä»¥ä¸ºAnchor Reference Position</p><p>AnchoredPositionå’ŒLocal Positionçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?<br>åœ¨Transform(éRectTransform)ä½“ç³»ä¸­, å­ç‰©ä½“çš„localPositionåªèƒ½é€šè¿‡è°ƒæ•´å…¶å’Œçˆ¶ç‰©ä½“çš„ç›¸å¯¹ä½ç½®æ¥å®ç°å˜åŒ–, åœ¨RectTransformä½“ç³»ä¸‹, å­ç‰©ä½“çš„localPositioné™¤äº†å—ç›¸å¯¹ä½ç½®çš„å½±å“, è¿˜ä¸çˆ¶ç‰©ä½“çš„widthã€å­ç‰©ä½“æœ¬èº«çš„pivotæœ‰å…³</p><h1>RectTransformä¸­çš„å­—æ®µ</h1><blockquote><p>ğŸ’¡æœ¬æ–‡æˆ‘ä»¬åªè®¨è®ºRectTransformä¸­æœ‰è€ŒTransformä¸­æ²¡æœ‰çš„å­—æ®µ</p></blockquote><ul><li>rect Rect æ³¨æ„RectTransformä¸­çš„rectæˆå‘˜ä¸æ”¯æŒç›´æ¥ä¿®æ”¹æ³¨æ„ä»¥ä¸Šå­—æ®µéƒ½æ˜¯ä¸å¯ä»¥é€šè¿‡RectTransformæ“ä½œå…¶å€¼çš„., å› ä¸ºæ²¡æœ‰setå±æ€§, å¤–éƒ¨æ²¡æœ‰å¯¹å®ƒçš„è®¿é—®æƒé™<ul><li>xMin, ä»£è¡¨çš„æ˜¯rectå›´æˆçŸ©å½¢åŒºåŸŸçš„å·¦ä¸‹è§’çš„æ¨ªåæ ‡å€¼, åæ ‡ç³»åŸç‚¹æ˜¯è¿™ä¸ªrectå›´æˆçš„çŸ©å½¢åŒºåŸŸçš„ä¸­å¿ƒç‚¹,</li><li>yMin, ä»£è¡¨çš„æ˜¯rectå›´æˆçŸ©å½¢åŒºåŸŸçš„å·¦ä¸‹è§’çš„çºµåæ ‡å€¼, åæ ‡ç³»åŸç‚¹æ˜¯è¿™ä¸ªrectå›´æˆçš„çŸ©å½¢åŒºåŸŸçš„ä¸­å¿ƒç‚¹,</li><li>mHeight, è¿™ä¸ªrectå›´æˆçŸ©å½¢çš„é«˜</li><li>mWidth, è¿™ä¸ªrectå›´æˆçŸ©å½¢çš„å®½</li></ul></li><li>anchorMin Vector2 ä»¥å½“å‰RectTransformçš„çˆ¶èŠ‚ç‚¹çš„rectçš„å·¦ä¸‹è§’ä¸ºåæ ‡åŸç‚¹, é”šç‚¹å·¦ä¸‹è§’çš„å½’ä¸€åŒ–ä½ç½®åæ ‡</li><li>anchorMax Vector2 ä»¥å½“å‰RectTransformçš„çˆ¶èŠ‚ç‚¹çš„rectçš„å·¦ä¸‹è§’ä¸ºåæ ‡åŸç‚¹, é”šç‚¹å³ä¸Šè§’çš„å½’ä¸€åŒ–ä½ç½®åæ ‡</li><li>sizeDelta Vector2 å½“é”šç‚¹å››è§’é‡åˆæ—¶, sizeDelta.x=rect.width=(offsetMax-offsetMin).x, sizeDelta.y=rect.height=(offsetMax-offsetMin).y å½“ä¸é‡åˆæ—¶ sizeDelta.x=(offsetMax-offsetMin).x, sizeDelta.y=(offsetMax-offsetMin).y</li><li>offsetMin Vector2 æŒ‡é”šç‚¹å·¦ä¸‹è§’ä¸rectçš„å·¦ä¸‹è§’çš„åç§»å€¼ ä»¥å½“å‰RectTransformçš„çˆ¶èŠ‚ç‚¹çš„rectçš„å·¦ä¸‹è§’ä¸ºåæ ‡åŸç‚¹</li><li>offsetMax Vector2  æŒ‡é”šç‚¹å³ä¸Šè§’ä¸rectçš„å³ä¸Šè§’çš„åç§»å€¼ ä»¥å½“å‰RectTransformçš„çˆ¶èŠ‚ç‚¹çš„rectçš„å·¦ä¸‹è§’ä¸ºåæ ‡åŸç‚¹</li><li>anchoredPosition Vector2</li><li>anchoredPosition3D Vector3 åŒ…å«anchoredPositionçš„xyåˆ†é‡, å¢åŠ äº†zåˆ†é‡ ä¸€èˆ¬ç”¨ä¸åˆ°<br>localPositionçš„å«ä¹‰æ˜¯å½“å‰RectTransformçš„pivotç›¸å¯¹äºè¯¥RectTransformçš„çˆ¶èŠ‚ç‚¹rectçš„ä¸­å¿ƒç‚¹çš„ä½ç½®, ç”±äºå¯ä»¥è°ƒæ•´çˆ¶èŠ‚ç‚¹çš„rect, æ‰€ä»¥å¯ä»¥é—´æ¥å½±å“å­ç‰©ä½“çš„localPositionå±æ€§, è€Œæˆ‘ä¹Ÿå¯ä»¥è®©rectçš„ç»å¯¹ä½ç½®ä¸å˜ é€šè¿‡æ”¹å˜pivotçš„ä½ç½®æ¥å½±å“localPositionçš„å€¼, è¿™åœ¨Transform(éRectTransform)ä½“ç³»ä¸‹æ˜¯ä¸å¤ªå¯èƒ½åšåˆ°çš„,</li></ul><p>é”šç‚¹(Anchor)æè¿°çš„æ˜¯å½“å‰UIèŠ‚ç‚¹å’Œå…¶çˆ¶èŠ‚ç‚¹çš„ä½ç½®å…³ç³», é”šç‚¹è™½ç„¶å«ç‚¹, ä½†æ˜¯ä¼šå­˜åœ¨é”šç‚¹çš„å››ä¸ªè§’æ²¡æœ‰é‡åˆçš„æƒ…å†µ. åªä¸è¿‡é”šç‚¹çš„å››è§’é‡åˆæ—¶anchor reference positionå’Œè¯¥ç‚¹é‡åˆäº†è€Œå·² unityä¼šè®¡ç®—å‡ºä¸€ä¸ªanchor reference point, å’Œpivotåšè¿ç®—å¾—åˆ°anchored position<br>ä¸­å¿ƒç‚¹(Pivot)æè¿°çš„æ˜¯å½“å‰UIèŠ‚ç‚¹çš„è½´å¿ƒä½ç½® ä¸çˆ¶èŠ‚ç‚¹æ— å…³</p><h1>IDragHandler</h1><p>åœ¨æ­¤çŒœæµ‹ , IDragHandlerçš„ç”Ÿæ•ˆé€»è¾‘æ˜¯ä»€ä¹ˆ</p><p>æ¯ä¸€å¸§ Unityéƒ½ä¼šä»æ‘„åƒæœºå‡ºå‘ç”Ÿæˆä¸€ä¸ªå°„çº¿ ç”±ä½ çš„pointeræŠ•å°„åˆ°åœºæ™¯ä¸­çš„gameObjectä¸Š, æ¯ä¸€å¸§ä½ éƒ½ä¼šæ‹¿åˆ°è¿™äº›ä¿¡æ¯ æ‹¿åˆ°è¿™äº›ç‰©ä½“, æŸ¥çœ‹è¿™äº›ç‰©ä½“ä¸ŠæŒ‚è½½çš„ç»„ä»¶æœ‰æ²¡æœ‰å®ç°IDragHandleræ¥å£, å¦‚æœæœ‰, å‡ºå‘è¿™ä¸ªIDragHnaderçš„fafa</p><p>åœ¨Unityæºç ä¸­ æœ localIdentifierInFile</p><p>BuildSerialization.cpp</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">ConvertSceneObjectsToInstanceIDBuildRemap</span><span class="params">(<span class="type">const</span> core::string&amp; path, <span class="type">const</span> WriteDataArray&amp; sceneObjects, InstanceIDBuildRemap&amp; output)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> pathIndex = <span class="built_in">GetPersistentManager</span>().<span class="built_in">GetSerializedFileIndexFromPath</span>(path);</span><br><span class="line"></span><br><span class="line">    output.<span class="built_in">reserve</span>(output.<span class="built_in">size</span>() + sceneObjects.<span class="built_in">size</span>());</span><br><span class="line">    <span class="keyword">for</span> (WriteDataArray::const_iterator i = sceneObjects.<span class="built_in">begin</span>(); i != sceneObjects.<span class="built_in">end</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">Assert</span>(i-&gt;localIdentifierInFile != <span class="number">0</span>);</span><br><span class="line">        output.<span class="built_in">push_unsorted</span>(i-&gt;instanceID, <span class="built_in">SerializedObjectIdentifier</span>(pathIndex, i-&gt;localIdentifierInFile));</span><br><span class="line">    &#125;</span><br><span class="line">    output.<span class="built_in">sort</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ResourceManager.cppä¸­çš„void BuiltinResourceManager::InitializeResources()æ–¹æ³•</p><p>ä¸‹é¢è¿™æ®µä»£ç , æ¨æµ‹åº”è¯¥æ˜¯Unityç»™èµ„äº§ç”ŸæˆFileIdçš„é€»è¾‘<br>æ˜å¤©éªŒè¯ä¸€ä¸‹ å¯¹äºå¤§éƒ¨åˆ†çš„FBXä¸­çš„meshèµ„æº, ä»–ä»¬åº”è¯¥éƒ½æ˜¯å«åŒæ ·çš„åå­—, åˆå› ä¸ºä»–ä»¬éƒ½æ˜¯mesh, æ‰€ä»¥ä¼ å…¥çš„å‚æ•°ä¸€æ ·, æ‰€ä»¥åœ¨metaæ–‡ä»¶ä¸­, ä½ å¯ä»¥çœ‹åˆ°, å³ä¾¿æ˜¯å¼•ç”¨äº†ä¸åŒçš„fbxçš„mesh, å˜çš„åªæœ‰guid, fileidéƒ½æ˜¯ä¸€æ ·äº†<br>æ˜å¤©éªŒè¯ä¸€ä¸‹, ä¸¤ä¸ªmeshåä¸ä¸€æ ·çš„fbx, åº”è¯¥fileIdå°±ä¼šä¸ä¸€æ ·, è€Œä¸”æ”¹äº†meshçš„åå­—, fileIdçš„åå­—ä¹Ÿå°±ä¼šè·Ÿç€å˜</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CSharpåˆé›†</title>
      <link href="/posts/d97e22f1/"/>
      <url>/posts/d97e22f1/</url>
      
        <content type="html"><![CDATA[<p>CSharpé—®é¢˜æ‚è®°<br><a href="20505312">CSharpå‰ä¼ </a><br>CSharpä¸­çš„å§”æ‰˜<br>CSharpä¸­çš„CancellationToken<br>CSharpä¸­çš„Task<br>Dissecting-the-async-methods-in-CSharp<br>Extending-the-asynce-methods-in-CSharp-è¯‘</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ä»£ç çƒ­æ›´æ–°åˆé›†</title>
      <link href="/posts/99b1bffa/"/>
      <url>/posts/99b1bffa/</url>
      
        <content type="html"><![CDATA[<h1>XLuaã€ILRuntimeã€HybridCLRçƒ­æ›´åŸç†</h1>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CSharpå‰ä¼ </title>
      <link href="/posts/20505312/"/>
      <url>/posts/20505312/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ã€ŠCLR via C#ã€‹è¿™æœ¬ä¹¦å¸®åŠ©è¯»è€…å»ºç«‹èµ·äº†C#çš„çŸ¥è¯†æ¡†æ¶, æ˜¯ç¬”è€…èŒä¸šç”Ÿæ¶¯ä¸­åŠŸä¸å¯æ²¡çš„å¥½ä¹¦, ä¸è¿‡æœ¬ä¹¦çš„ä½œè€…Jeffrey <a href="http://xn--Richter-oc5k144o.Net">Richteræ˜¯ä»¥.Net</a> Frameworkæ¡†æ¶åœ¨Windowså¹³å°è¿›è¡Œå¼€å‘çš„è§†è§’ä¸Šä»‹ç».Netçš„ä¸€äº›ç‰¹æ€§çš„, è€Œç¬”è€…ä½œä¸ºä¸€ä¸ªUnityå…¥é—¨C#çš„åŠåŠå­åœ¨æœ€åˆé˜…è¯»æœ¬ä¹¦çš„å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…æ˜¯æ²¡æœ‰çœŸæ­£ç†è§£.Netçš„æ ¸å¿ƒç‰¹æ€§çš„. åœ¨æœ¬ç¯‡åšå®¢ä¸­, ç¬”è€…å°è¯•åŸºäºè¿™æœ¬ä¹¦, åŠ ä¸Šç¬”è€…å¯¹Unityçš„ç†è§£, ç«™åœ¨Unityå¼€å‘è€…çš„è§†è§’ä¸Š, è¯ é‡Š.Netä¸­çš„ä¸€äº›å…³é”®æ€§æ¦‚å¿µ.</p></blockquote><h1>.NETå¾€äº‹</h1><p>åœ¨ã€ŠCLR via C#ã€‹<a href="http://xn--1jq840bfog6d140aln3a9iqxvd2rli4epa472o.Net">è¿™æœ¬ä¹¦é‡Œé¢å¹¶æ²¡æœ‰è¯¦ç»†è§£é‡Š.Net</a>ã€.NetCoreã€.Net Standardã€.Net Frameworkä¸€ç³»åˆ—çš„æ¦‚å¿µ, ä¹‹æ‰€ä»¥æœ‰è¿™ä¹ˆå¤šçš„æ¦‚å¿µ, ä¹Ÿæ˜¯æœ‰å†å²åŸå› çš„, äº†è§£.Netçš„å‘å±•å²èƒ½å¸®æˆ‘ä»¬æ›´å¥½åœ°ç†è§£è¿™äº›æ¦‚å¿µã€<br>.Netæ˜¯.Net C#æ˜¯C#, .Netæ˜¯ä¸€å¥—æ”¯æŒC#ä»£ç è¿è¡Œçš„æ¡†æ¶ä½“ç³», é™¤æ­¤ä¹‹å¤–.Netè¿˜æ”¯æŒF#ã€VBç­‰è¯­è¨€</p><p>.Net Frameworkã€ .NetCoreã€ .Netè¿™ä¸‰è€…æ˜¯å¯¹åŒä¸€ä¸ªå¯¹è±¡åœ¨ä¸åŒå‘å±•æ—¶æœŸçš„ä¸åŒç§°è°“, è¿™ä¸€å¯¹è±¡åœ¨ä¸åŒå‘å±•æ—¶æœŸå…·æœ‰ä¸åŒçš„ç‰¹ç‚¹.<br>ä»–ä»¬æ˜¯åŒç§æ¦‚å¿µçš„ä¸åŒå½¢æ€</p><h2 id="Net-Frameworkæ—¶æœŸ">.Net Frameworkæ—¶æœŸ</h2><p>æ—©æœŸçš„.Netåªèƒ½è¿è¡Œåœ¨<br>æ­¤æ—¶çš„.Netåªèƒ½å¤Ÿè¿è¡Œåœ¨Windowsä¸Š, è€Œä¸”C#ä»£ç çš„è¿è¡Œæ–¹å¼æ˜¯JITæ¨¡å¼</p><h2 id="Monoçš„å‡ºç°">Monoçš„å‡ºç°</h2><p>ç”±äº.Netå®Œå…¨é—­æº, æœ‰ä¸€ç¾¤äººä»é›¶æ‰‹æ“äº†ä¸€ä¸ª, ä½¿ç”¨ä½“éªŒè·Ÿ.Netä¸€æ¨¡ä¸€æ ·çš„Mono, è€Œä¸”è¿˜æ”¯æŒè·¨å¹³å°, å°±è·Ÿæ±‰å ¡ç‹å’Œè‚¯å¾·åŸºä¸€æ ·, éƒ½æ˜¯æ±‰å ¡è–¯æ¡, åƒèµ·æ¥å¤§åŒå°å¼‚, ä½†æ˜¯åšæ³•åŸæ–™å¯èƒ½å®Œå…¨ä¸åŒ, ä¹Ÿå°±æ˜¯è¯´, Monoå’Œ.Netå¯èƒ½åº•å±‚å®ç°ä¸ä¸€æ ·, ä½†æ˜¯ä¸Šå±‚è¦å®ç°çš„åŠŸèƒ½æ˜¯å®Œå…¨ä¸€æ ·çš„: ä¸ºC#(ç¬”è€…è¿™é‡Œå°±åªè¯´C#äº†)æä¾›ä¸€å¥—èƒ½å¤Ÿæ­£ç¡®è¿è¡Œçš„ç¯å¢ƒ, çŸ¥é“è¿™ä¸ªå°±è¡Œäº†.</p><h2 id="Net-Coreæ˜¯å•¥">.Net Coreæ˜¯å•¥</h2><p>.Net Coreåœ¨åŸæ¥.NetFrameworkçš„åŸºç¡€ä¸Š, å¢åŠ äº†å¯¹äºè·¨å¹³å°çš„æ”¯æŒ</p><h2 id="Net-æ˜¯å•¥">.Net æ˜¯å•¥</h2><p><a href="http://xn--6kqv66j.Net">è‡³äº.Net</a>, æ˜¯ç›®å‰çš„å¤§ä¸€ç»ŸçŠ¶æ€, é‡Œé¢</p><p>ç»è¿‡ä¸€æ®µæ—¶é—´çš„æ¼”å˜, .Net <a href="http://xn--Core-ts5fw5zn9ou7k.Net">Coreå°±å˜æˆäº†.Net</a></p><table><thead><tr><th>ç»„ä»¶åç§°</th><th>ä½œç”¨</th><th>è¯´æ˜</th><th></th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>CoreCLR / .NET Runtime</td><td>æ‰˜ç®¡è¿è¡Œæ—¶/è™šæ‹Ÿæœºï¼Œè´Ÿè´£æ‰§è¡ŒILï¼Œä¸­é—´è¯­è¨€JITï¼ŒGC</td><td><a href="https://github.com/dotnet/runtime%EF%BC%88%E5%B7%B2%E5%BC%80%E6%BA%90%EF%BC%89">https://github.com/dotnet/runtimeï¼ˆå·²å¼€æºï¼‰</a></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>CoreFX / åŸºç±»åº“ï¼ˆBase Class Library, BCLï¼‰</td><td>å¸¸ç”¨ç³»ç»ŸAPIï¼šIOã€ç½‘ç»œã€é›†åˆã€å­—ç¬¦ä¸²ç­‰</td><td>ç°ä»£å«runtimeä¸­çš„â€œlibrariesâ€</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td><a href="http://ASP.NET">ASP.NET</a> Core</td><td>Webå¼€å‘æ¡†æ¶</td><td>æ”¯æŒWebæœåŠ¡å™¨ã€APIã€MVCã€Blazorã€SignalRã€gRPCç­‰å¹³å°</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Entity Framework Core</td><td>å¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆORMï¼‰æ•°æ®åº“ç»„ä»¶</td><td>æ”¯æŒSQLServerã€SQLiteã€MySQLç­‰ä¸»æµæ•°æ®åº“</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>WinFormsã€WPFï¼ˆWindows Onlyï¼‰</td><td>æ¡Œé¢GUIå¼€å‘</td><td>.NET 5+æ”¯æŒåŸºæœ¬ç§»æ¤ï¼Œä½†ä»…é™Windows</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>MSBuild</td><td>æ„å»ºç³»ç»Ÿ</td><td>dotnet build å°±æ˜¯ç”¨çš„è¿™ä¸ª</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Roslyn</td><td>C#ã€VB.NETç¼–è¯‘å™¨å’Œä»£ç åˆ†æå™¨</td><td><a href="https://github.com/dotnet/roslyn">https://github.com/dotnet/roslyn</a></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>NuGet</td><td>åŒ…ç®¡ç†å·¥å…·</td><td>åœ¨çº¿/æœ¬åœ°åŒ…ç®¡ç†</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>CLI</td><td>å‘½ä»¤è¡Œå·¥å…·ï¼ˆdotnetï¼‰</td><td>åŒ…æ‹¬dotnetã€dotnet buildã€dotnet runç­‰åŸºç¡€å‘½ä»¤</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><h2 id="Monoæ˜¯å•¥">Monoæ˜¯å•¥</h2><p>Mono é¡¹ç›®å§‹äº 2001 å¹´ï¼Œç”± Ximian å…¬å¸çš„åˆ›å§‹äºº Miguel de Icaza é¢†å¯¼ã€‚Ximian æ˜¯ä¸€å®¶ä¸“æ³¨äº Linux å’Œå¼€æºè½¯ä»¶çš„å…¬å¸ã€‚Miguel de Icaza <a href="http://xn--4gqvd70lutrsxi5wc1t2biya.NET">çš„ç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ª.NET</a> æ¡†æ¶çš„å¼€æºå®ç°ï¼Œä»¥ä¾¿åœ¨ Linux ä¸Šè¿è¡Œã€‚</p><p>.NET æ¡†æ¶æœ€åˆç”±å¾®è½¯å¼€å‘ï¼Œä¸»è¦ç”¨äºæ„å»º Windows åº”ç”¨ç¨‹åºã€‚<a href="http://xn--6kqu55g.NET">ç”±äº.NET</a> æ¡†æ¶çš„é—­æºæ€§ï¼Œå®ƒæ— æ³•ç›´æ¥åœ¨å…¶ä»–æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œã€‚Mono é¡¹ç›®çš„å‡ºç°æ‰“ç ´äº†è¿™ä¸€é™åˆ¶ï¼Œ<a href="http://xn--2rq350b.NET">ä½¿å¾—.NET</a> å¼€å‘è€…çš„ä»£ç èƒ½å¤Ÿåœ¨å¤šç§å¹³å°ä¸Šè¿è¡Œã€‚</p><p>éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒMono é¡¹ç›®å¾—åˆ°äº†å¹¿æ³›çš„ç¤¾åŒºæ”¯æŒï¼Œå¹¶ä¸”ä¸æ–­å‘å±•å’Œå®Œå–„ã€‚å®ƒæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬ C#ã€Visual <a href="http://Basic.NET">Basic.NET</a> å’Œ F#ï¼Œ<a href="http://xn--phqsk73ztrc71ev35bpf9a.NET">å¹¶ä¸”å®ç°äº†è®¸å¤š.NET</a> æ¡†æ¶çš„åŠŸèƒ½ã€‚Mono <a href="http://xn--fiqqezet6cs0gs0ag5r80qxpgh48a7jsgeb81q2u9fc90a.NET">é¡¹ç›®åœ¨å¼€æºç¤¾åŒºä¸­çš„æˆåŠŸä¹Ÿä¿ƒè¿›äº†.NET</a> æŠ€æœ¯åœ¨é Windows å¹³å°ä¸Šçš„æ™®åŠã€‚</p><p><a href="http://xn--xft85uwsaj08j.xn--Net-6g3ei87f2r7a.Net">è¿˜æœ‰å°±æ˜¯.Netå‡çº§æ˜¯.Net</a> C# languageå‡çº§æ˜¯language<br>ä¸€èˆ¬æ¥è¯´, å…ˆæ˜¯C#çš„è¯­è¨€æœ‰æ›´æ–°, å¿…é¡»æ–°å¢äº†æŸç§è¯­æ³•æˆ–è€…è¯­è¨€ç‰¹æ€§ é‚£ä¹ˆé…å¥—çš„.Netä¸­å°±éœ€è¦æ”¯æŒèƒ½å¤Ÿè¯†åˆ«å¹¶é©±åŠ¨è¿™äº›è¯­æ³•, å› æ­¤ä¸€èˆ¬C#æœ‰æ–°ç‰¹æ€§å¢åŠ å¯¹åº”çš„.Netä¹Ÿæœ‰æ–°çš„å‡çº§</p><p>è¯´ç™½äº† .Netã€.NetCoreã€.NetFrameworkã€Monoæ¯ä¸€ä¸ªéƒ½æ˜¯ä¸€å¥—è®©C#ä»£ç èƒ½å¤Ÿè¿è¡Œè·‘èµ·æ¥çš„å¹³å°. è¿™å°±å¥½æ¯”å„å®¶è™šæ‹Ÿæœºå¹³å°, è€ŒC#å°±åƒæ˜¯ä½ åœ¨å¾®è½¯å®˜ç½‘ä¸Šä¸‹è½½çš„Windowsæ“ä½œç³»ç»Ÿçš„é•œåƒæ–‡ä»¶, ä½ å¯ä»¥å°†è¿™ä¸ªé•œåƒæ–‡ä»¶æŒ‚è½½åœ¨VMWareå¹³å°ä¸Š, ä¹Ÿå¯ä»¥æŒ‚è½½åœ¨Parallel Desktopå¹³å°ä¸Š, å³ä¾¿å¹³å°çš„åº•å±‚å®ç°ä¸åŒ, ä½†æ˜¯å› ä¸ºå®ƒä»¬éƒ½éµå¾ªåŒæ ·çš„è§„èŒƒ, å› æ­¤åŒæ ·çš„ä¸€æ“ä½œç³»ç»Ÿé•œåƒæ–‡ä»¶å¯ä»¥è·‘åœ¨ä¸åŒçš„è™šæ‹Ÿæœºå¹³å°ä¸Š, è¿™äº›å¹³å°éµå¾ªçš„è§„èŒƒ, ç±»æ¯”åˆ°.Netä¸­ä¹Ÿå°±æ˜¯<code>.Net Standard</code></p><h2 id="Net-Standard">.Net Standard</h2><p>.Net Standard æ˜¯é’ˆå¯¹å¤šä¸ª .Netå®ç°æ¨å‡ºçš„ä¸€å¥—æ­£å¼çš„.Net APIè§„èŒƒ. æ¨å‡º.NetStandardçš„èƒŒååŠ¨æœºæ˜¯è¦æé«˜.Netç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€è‡´æ€§.<br>ç”±ä¸Šé¢çš„é™ˆè¿°å¯çŸ¥, .Netæœ‰å¾ˆå¤šçš„å®ç°, ä¸ºäº†èƒ½å¤Ÿè®©ä¸åŒå®ç°çš„.Netèƒ½å¤ŸååŒå·¥ä½œ, .Net Standardå‡ºç°äº†. æ¯”å¦‚åœ¨Unityå¼€å‘ä¸­, ä½ éœ€è¦ä½¿ç”¨ä¸€ä¸ªæ‰˜ç®¡çš„dll, è¿™ä¸ªdllä½¿ç”¨.Netç¯å¢ƒå¼€å‘, è€ŒUnityæ˜¯Monoç¯å¢ƒ, ä¸ºäº†è®©dllä¸­çš„ä»£ç èƒ½å¤Ÿå’ŒUnityä¸­çš„ä»£ç æ­£ç¡®ååŒ, <a href="http://xn--Unitydll-b50n2ky0c413fdixom8b6r7cmhhzivd30a.Net">åªéœ€è¦è®©Unityå’Œdlléµå¾ªåŒæ ·çš„.Net</a> Standardç‰ˆæœ¬å°±å¯ä»¥äº†. åœ¨Unityçš„BuildSettingsä¸­çš„APICompatibilityLevelå°±æ˜¯è¿™ä¸ªä½œç”¨, ä¸åŒçš„Unityç‰ˆæœ¬å¯ä»¥å¯¹æ ‡çš„.Netç‰ˆæœ¬ä¹Ÿä¸å¤ªä¸€æ ·. æ¯”å¦‚åœ¨<code>2020.3.48</code>ç‰ˆæœ¬ä¸­, <code>API Compatibility Level</code>çš„é€‰é¡¹æ˜¯<code>.Net 4.X</code>å’Œ<code>.Net Standard 2.0</code>, è€Œåœ¨<code>2022.3.15</code>ç‰ˆæœ¬ä¸­, <code>API Compatibility Level</code>çš„é€‰é¡¹åˆ™å˜æˆäº†<code>.Net Standard 2.1</code>å’Œ<code>.Net Framework</code>. æ‰€ä»¥è¿™ä¹ˆä¸€çœ‹ä½ æ‰€ä½¿ç”¨çš„æ’ä»¶å¿…é¡»è¦æœ‰<code>API Compatibility Level</code>ç›¸å¯¹åº”çš„ç‰ˆæœ¬æ‰èƒ½å¤Ÿåœ¨Unityä¸­ä½¿ç”¨.<br><a href="http://xn--zbs584j.Net">è¯´å›.Net</a>, .Net5é‡‡ç”¨çš„ä¸åŒçš„æ–¹æ³•æ¥å»ºç«‹ä¸€è‡´æ€§, <a href="http://xn--ghqe42iv2dxrl2vvsdhtrtvcvrs3cu50i0xyjnofs9cchveoes67a.Net">è¿™ç§æ–°æ–¹æ³•åœ¨å¾ˆå¤šæƒ…å†µä¸‹éƒ½ä¸éœ€è¦ä½¿ç”¨åˆ°.Net</a> Standard.</p><p>ä½ çš„Unityå·¥ç¨‹ï¼Œå…è®¸ä»£ç èƒ½ç”¨ï¼ˆå…¼å®¹ï¼‰çš„ .NETï¼ˆæˆ–Monoï¼‰APIé›†åˆçš„æ ‡å‡†ç¨‹åº¦ã€‚</p><p>Unityçš„è„šæœ¬è¿è¡Œç¯å¢ƒï¼ˆScripting Backendï¼‰æ˜¯åŸºäºMonoï¼ˆæˆ–IL2CPPï¼‰æ¥å®ç°C#ç¯å¢ƒçš„ï¼›<br>ä½†Monoå’Œå¾®è½¯å®˜æ–¹.NETå®ç°çš„API/æ ‡å‡†å¹¶ä¸æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œæœ‰æ–°æœ‰æ—§ã€æœ‰å…¨æœ‰æ®‹ï¼›<br>API Compatibility Levelï¼Œå°±æ˜¯è®©ä½ æŒ‡å®šç”¨å“ªä¸€å¥—æ ‡å‡†çš„APIæ¥å£å­é›†ï¼š<br>æ¯”å¦‚ï¼š.NET 2.0 Subset<br>åˆæ¯”å¦‚ï¼š.NET 4.x / .NET Standard 2.0<br>æˆ–è€…æ›´é«˜ï¼ˆéšç€Unityç‰ˆæœ¬æ¼”è¿›è€Œå˜åŒ–ï¼‰<br>è¿™äº›é€‰é¡¹ï¼Œ<a href="http://xn--Unity-fg1hjcs88bgjegyy9a11h01wpp1glkcu71cohh804h.NET">å®é™…ä¸ŠèƒŒåå¯¹åº”ç€ä¸€ç»„Unityå®šåˆ¶çš„.NET</a> Base Class Library (BCL)ï¼Œå†³å®šä½ åœ¨C#è„šæœ¬é‡Œèƒ½ä¸èƒ½å¼•ç”¨ã€ç¼–è¯‘ã€åå°„ã€è°ƒç”¨æŸäº›æ ‡å‡†åº“åŠŸèƒ½ã€‚</p><p>æ–°é¡¹ç›®ï¼šä¼˜å…ˆé€‰â€œ.NET 4.xâ€æˆ–â€œ.NET Standard 2.0â€ã€‚<br>é¡¹ç›®ä¸­æœ‰ç°ä»£C#è¯­æ³•ï¼ˆå¦‚async/awaitã€LINQç­‰ï¼‰ï¼šå¿…é¡»é€‰æ–°æ ‡å‡†ã€‚<br>åšæ’ä»¶/SDKè·¨Unityå…¼å®¹ï¼šä¼˜å…ˆè€ƒè™‘â€œ.NET Standard 2.0â€ã€‚<br>æœ‰è€DLLã€Asset Storeèµ„äº§åªæ”¯æŒ2.0ï¼Œä¸”ä¸æƒ³å‡çº§ï¼šä¸´æ—¶ç”¨â€œ.NET 2.0â€ã€‚<br>æ‰‹æœºç‰ˆæœ¬æåº¦ç²¾ç®€ã€è¿½æ±‚æœ€å°åŒ…ä½“ï¼šç”¨Subsetï¼Œä½†å¾ˆå°‘æœ‰è¿™ç§æç«¯éœ€æ±‚ã€‚</p><h1>ä¸€ä¸ªC#å·¥ç¨‹ä½¿ç”¨çš„.Netç‰ˆæœ¬æ€ä¹ˆçœ‹?</h1><p>æ³¨æ„.Netç‰ˆæœ¬å’ŒC#LanguageVersionæ˜¯ä¸¤ä¸ªä¸œè¥¿,<br>å¯¹äºä½¿ç”¨Rideråˆ›å»ºçš„C#é¡¹ç›®,</p><p>Unityçš„.NetVersionèƒ½ä¸èƒ½æ”¹?</p><h1>ä¸€ä¸ªC#å·¥ç¨‹ä½¿ç”¨çš„.Netç‰ˆæœ¬æ€ä¹ˆä¿®æ”¹?</h1><h1>C#é¡¹ç›®çš„ç»„ç»‡ç»“æ„</h1><h1>Unityé¡¹ç›®çš„ä»£ç ç»„ç»‡ç»“æ„</h1><h2 id="sln-csproj-dll-asmdef-pdbçš„åŒºåˆ«å’Œè”ç³»">.sln .csproj .dll .asmdef .pdbçš„åŒºåˆ«å’Œè”ç³»</h2><h2 id="dll">.dll</h2><p>å¦‚æœä½ çš„C#é¡¹ç›®é€‰æ‹©çš„æ˜¯ClassLibrary, é‚£ä¹ˆæ„å»ºè¿™ä¸ªC#é¡¹ç›®çš„æ—¶å€™, æ„å»ºç»“æœå°±æ˜¯.dll,<br><a href="https://github.com/shimat/opencvsharp/releases">è¿™æ˜¯C#ç‰ˆæœ¬çš„OpenCVåº“</a>, ä¸‹è½½ä»–çš„releaseä½ ä¼šå‘ç°,é‡Œé¢è¿˜å¸¦ä¸€ä¸ªpdbæ–‡ä»¶.<br>.sln æ˜¯<br>.csproj ä¸€ä¸ªslnä¸‹ä¼šæœ‰å¤šä¸ªcsproj<br>.asmdef è¿™æ˜¯Unityä¸­çš„ä¸€ä¸ªæ¦‚å¿µ, æ¯åˆ›å»ºä¸€ä¸ªasmdef, Unityéƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆè¿™ä¸ªasmdefå¯¹åº”çš„csproj<br>.dll dllä¸€èˆ¬æœ‰ä¸¤ç§: ä½¿ç”¨C#ç¼–è¯‘ç”Ÿæˆçš„dll, è¿™ç±»dllå±äºæ‰˜ç®¡ç±»dll, å¯¼å…¥Unityèƒ½å¤Ÿç›´æ¥è¢«Unityç¼–è¯‘å™¨è¯†åˆ«; è¿˜æœ‰ä¸€ç±»æ˜¯ä½¿ç”¨c/c++ç­‰éæ‰˜ç®¡ç±»è¯­è¨€ç¼–è¯‘ç”Ÿæˆçš„dll, è¿™ç±»dlléœ€è¦C#å…·æœ‰èƒ½å¤Ÿè°ƒç”¨åŸç”Ÿ(native)ä»£ç çš„èƒ½åŠ›, éœ€è¦ä½¿ç”¨<code>[DLLImport]</code>å±æ€§æ¥å¯¼å…¥æ–¹æ³•</p><p>å¯¹äºç®€å•çš„é¡¹ç›® å®Œå…¨æ²¡å¿…è¦åˆ›å»ºsln ä½†æ˜¯åƒRiderã€Visual Studioè¿™äº›IDEæ˜¯æ²¡æœ‰æä¾›åªåˆ›å»ºcsprojçš„é€‰é¡¹çš„, è¿™å°±æœ‰ç‚¹å¤§æå°ç”¨äº† æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨å‘½ä»¤è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dotnet new console</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ„å»ºåæ˜¯ä¸€ä¸ªdll</span></span><br><span class="line">dotnet new classlib</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼åªåˆ›å»ºcsproj, ç„¶åä½¿ç”¨Rideræˆ–è€…VSæ‰“å¼€è¿™ä¸ªcsproj, å°±å¯ä»¥ç»•è¿‡ç”Ÿæˆslnæ–‡ä»¶<br>.slnï¼ˆSolutionï¼‰æ–‡ä»¶æ˜¯ Visual Studio/VS Code/Coderush Rider ç­‰IDEç”¨æ¥ç®¡ç†ä¸€ç»„ç›¸å…³é¡¹ç›®ï¼ˆ.csprojï¼‰çš„å®¹å™¨ã€‚æ¯”å¦‚ä½ è¦åšå¤§å‹æ¶æ„ã€åŒ…æ‹¬å¤šä¸ªç±»åº“ã€åº”ç”¨ï¼Œä»¥åŠå•å…ƒæµ‹è¯•é¡¹ç›®æ—¶ï¼Œ.slnæ–‡ä»¶å¯ä»¥ç»Ÿä¸€ç®¡ç†å®ƒä»¬çš„ä¾èµ–ä¸ç»“æ„ã€‚<br>ä½†æ˜¯ï¼Œå°é¡¹ç›®ã€å•ä¸ªé¡¹ç›®æ—¶ï¼Œå®Œå…¨å¯ä»¥ä¸å»º .slnï¼Œåªç”¨ä¸€ä¸ª csproj æ–‡ä»¶ç…§æ ·ç¼–è¯‘ã€è¿è¡Œã€å¼€å‘ï¼ˆå¦‚å‘½ä»¤è¡Œä¸‹dotnet build XX.csprojï¼ŒVS Code ä¹Ÿèƒ½ç›´æ¥æ‰“å¼€ï¼‰ã€‚<br>å®ä¾‹1ï¼šä½ åœ¨ä»»æ„æ–‡ä»¶å¤¹é‡Œæ–°å»ºdotnet new consoleï¼Œå®ƒä¼šåˆ›å»ºProgram.cså’ŒXX.csprojï¼Œæ²¡æœ‰.slnï¼Œä¹Ÿèƒ½æ­£å¸¸dotnet run/buildã€‚<br>åªæœ‰éœ€è¦ç®¡ç†å¤šä¸ªé¡¹ç›®ï¼ˆæ¯”å¦‚å¼•ç”¨ç±»åº“æˆ–æµ‹è¯•å·¥ç¨‹ç­‰ï¼‰ï¼Œç”¨.slnä¼šæ›´æ–¹ä¾¿ã€‚</p><p>pdb æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>PDBï¼ˆProgram Databaseï¼‰æ˜¯Windows/Visual Studioç¯å¢ƒä¸‹çš„â€œç¨‹åºæ•°æ®åº“â€æ–‡ä»¶ã€‚<br>å†…å®¹ï¼šä¸»è¦å­˜å‚¨äº†å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆexe/dllç­‰ï¼‰çš„è°ƒè¯•ä¿¡æ¯ï¼Œå¦‚ï¼š<br>æºæ–‡ä»¶å/è·¯å¾„<br>è¡Œå·<br>å±€éƒ¨å˜é‡ã€å‡½æ•°å‚æ•°å<br>ç±»å‹ä¿¡æ¯<br>ç¬¦å·è¡¨ã€æ–­ç‚¹ç­‰ä¿¡æ¯<br>ç›®çš„æ˜¯ï¼šè¿›è¡Œè°ƒè¯•æ—¶ï¼ŒIDE/è°ƒè¯•å™¨èƒ½è¿˜åŸæºä»£ç å¯¹åº”å…³ç³»ã€æ ˆã€å˜é‡åç­‰ï¼Œæ˜¯â€œè°ƒè¯•è¾…åŠ©æ–‡ä»¶â€ã€‚<br>3. dll å’Œ pdb çš„å…³ç³»</p><p>å½“ä½ ç”¨ Visual Studio ç¼–è¯‘ä¸€ä¸ª dll æ—¶ï¼ˆDebug æ¨¡å¼ï¼‰ï¼Œé€šå¸¸ä¼šç”ŸæˆåŒåçš„ pdb æ–‡ä»¶ã€‚<br>è¿™ä¸ª dll æ–‡ä»¶æ˜¯çœŸæ­£çš„åŠ¨æ€åº“ï¼Œpdb æ–‡ä»¶ä¸ç»™ç¨‹åºåŠ è½½ï¼Œåªåœ¨è°ƒè¯•/åˆ†ææ—¶è®©å¼€å‘è€…ç”¨ã€‚<br>æ²¡æœ‰ pdbï¼Œå‘å¸ƒçš„ dll ä¾ç„¶å¯ä»¥è¿è¡Œï¼Œåªæ˜¯è°ƒè¯•éš¾åº¦å¤§ã€‚</p><h1>C#ä»£ç æ˜¯æ€ä¹ˆè·‘èµ·æ¥çš„?</h1><p>åœ¨ã€ŠCLR via C#ã€‹ä¸­, ä½œè€…åªæåŠäº†JIT, å› ä¸ºAOTæ–¹å¼æ˜¯åœ¨2022å¹´åœ¨.Net7å‘å¸ƒçš„, æœ¬ä¹¦çš„æˆä¹¦æ—¶é—´åº”è¯¥æ˜¯2014å¹´, æ²¡æœ‰æåŠAOTä¹Ÿæ˜¯å¾ˆæ­£å¸¸çš„</p><h2 id="JITæ¨¡å¼">JITæ¨¡å¼</h2><p>åœ¨Unityä¸­, è¿™å¯¹åº”çš„å°±æ˜¯Monoçš„æ„å»ºæ–¹å¼</p><p>JITæ–¹å¼æ‰“åŒ…, åœ¨æ‰“åŒ…é˜¶æ®µ, æˆ‘ä»¬ç¼–å†™çš„C#ä»£ç ä¼šè¢«ç¼–è¯‘æˆIL, æ‰“å…¥ä¸€ä¸ª.dllçš„æ–‡ä»¶, è¿™å°±æ˜¯Monoçš„æ‰“åŒ…æ–¹å¼, ä½¿ç”¨è¿™ç§æ–¹å¼æ‰“çš„åŒ…, åŒ…ä½“å°, ä½†æ˜¯ç”±äºå…¶ä»£ç ä¸æ˜¯åŸç”Ÿçš„, æ‰€ä»¥è¿è¡Œæ—¶éœ€è¦ä¾èµ–CLRå°†ILä»£ç ç¼–è¯‘æˆåŸç”Ÿä»£ç æ‰§è¡Œ, æ¯”èµ·AOTæ–¹å¼ åœ¨å¯åŠ¨æ—¶é—´ä¸Šä¼šä¹…ä¸€ç‚¹, å› ä¸ºéœ€è¦ç¼–è¯‘, ä½†æ˜¯åªè¦ç¼–è¯‘äº†ä¸€æ¬¡ä¹‹å, æ‰§è¡Œæ•ˆç‡å’ŒAOTæ˜¯æ²¡ä»€ä¹ˆåŒºåˆ«çš„</p><p>ç¬”è€…è®¤ä¸ºåœ¨ä¸€å¼€å§‹.Netå¯èƒ½å°±åªæ”¯æŒJITçš„æ–¹å¼æ‰§è¡ŒC#ä»£ç , è€ŒAOTå’Œè§£é‡Šå™¨æ–¹å¼åˆ™æ˜¯è·¨å¹³å°çš„æ¦‚å¿µå¼•å…¥åˆ°.Netä¸­å, æ‰å‡ºç°çš„æ¦‚å¿µ.</p><p>éšç€.Netæ”¯æŒè·¨å¹³å°. æƒ³è¦åœ¨MacOSã€iOSä¸Šè¿è¡Œ.Netç¨‹åº, ä½¿ç”¨JITçš„æ–¹å¼å°±ä¸è¡Œäº†, å› ä¸ºè‹¹æœæ˜¯ä¸å…è®¸ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€åŠ è½½ä»£ç çš„, æ‰€æœ‰ä»£ç å¿…é¡»è¢«ç¼–è¯‘æˆæœºå™¨ç åŸç”Ÿåœ°æ‰§è¡Œ. è¿™å°±æ˜¯AOTæ¨¡å¼</p><h2 id="AOTæ¨¡å¼">AOTæ¨¡å¼</h2><p>å¾®è½¯æ˜¯åœ¨.Net7ç‰ˆæœ¬ä¸­å®ç°äº†AOTåŠŸèƒ½.</p><p>åœ¨Unityä¸­, è¿™å¯¹åº”çš„å°±æ˜¯IL2CPPçš„æ„å»ºæ–¹å¼</p><p>æˆ‘ä»¬å°±æ‹¿Unityå¼€å‘ä¸¾ä¾‹å­, å¦‚æœä½¿ç”¨AOTçš„æ–¹å¼æ‰“åŒ…, é‚£ä¹ˆåœ¨æ‰“åŒ…é˜¶æ®µ, æˆ‘ä»¬ç¼–å†™çš„C#ä»£ç å°±ä¼šå…¨éƒ¨è¢«ç¼–è¯‘æˆæœºå™¨ç , ä¹Ÿå°±æ˜¯.soæ–‡ä»¶, è¿™ç§ä»£ç å°±æ˜¯åŸç”Ÿçš„ä»£ç , ä¸¢åˆ°æœºå™¨ä¸Šå°±å°±èƒ½ç«‹åˆ»è¿è¡Œ, ä¸éœ€è¦ç¼–è¯‘, ä½†æ˜¯æœºå™¨ç éƒ½æ˜¯01, å­˜å‚¨æ•ˆç‡ä½, ç”±æˆ‘ä»¬çš„C#è„šæœ¬è½¬æˆæœºå™¨ç ä¼šé€ æˆä»£ç è†¨èƒ€, å¬èµ·æ¥æ˜¯ä¸æ˜¯å¾ˆåƒIL2CPP?</p><p>é‚£åœ¨AOTæ¨å‡ºä¹‹å‰, Unityæ˜¯æ€ä¹ˆå®ç°åœ¨iOSå¹³å°ä¸Šå‘å¸ƒçš„å‘¢? Monoæ˜¯ä¸“é—¨æä¾›äº†</p><h1>ä»£ç çƒ­æ›´</h1><h2 id="Interpreteræ¨¡å¼">Interpreteræ¨¡å¼</h2><p>è§£é‡Šå™¨, ç¬”è€…ç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™ä¸ªæ¦‚å¿µå‡ºç°åœ¨C#ä¸­æ—¶, æ˜¯éå¸¸ç–‘æƒ‘çš„, å› ä¸ºç¬”è€…ç†è§£çš„è§£é‡Šå™¨, æ˜¯åƒPythoné‚£ç§è§£é‡Šå‹è¯­è¨€æ‰ä¼šä½¿ç”¨åˆ°çš„ä¸œè¥¿, è€ŒC#ä½œä¸ºä¸€ä¸ªç¼–è¯‘å‹è¯­è¨€, å…¶å®C#å¹¶ä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„ç¼–è¯‘å‹è¯­è¨€, å› ä¸ºC#æ˜¯å…ˆç¼–è¯‘æˆILä¸­é—´è¯­è¨€, ç„¶ååœ¨è¿è¡Œæ—¶é€šè¿‡JITCompilerå°†ä¸­é—´è¯­è¨€ç¼–è¯‘æˆæœºå™¨ç æ‰§è¡Œçš„æ–¹å¼.</p><p>ä¹Ÿå°±æ˜¯, C#ä¸è§£é‡Šå‹è¯­è¨€é‚£æ ·ç›´æ¥è§£é‡Šæºä»£ç æ‰§è¡Œ, ä¹Ÿä¸åƒC++é‚£æ ·ä¸€æ¬¡æ€§æŠŠæºä»£ç ç¼–è¯‘æˆæœºå™¨ç æ‰§è¡Œ.</p><p>è§£é‡Šå™¨æ¨¡å¼å¯ä»¥ç†è§£ä¸ºæ˜¯åœ¨Unityå¼€å‘ä¸­ä»£ç çƒ­æ›´æ–°åœºæ™¯ä¸‹, ä¸šå†…å¼€å‘è€…ä¸ºäº†èƒ½å¤Ÿæ‰§è¡Œçƒ­æ›´ä»£ç (dll)è€Œå¼€å‘çš„ä¸€ç§è¿·ä½ ç‰ˆçš„CLR(è™šæ‹Ÿæœº).<br>æˆ‘å†ç†è§£ä¸€ä¸‹è§£é‡Šå™¨çš„è§’è‰², è§£é‡Šå™¨å°±æ˜¯åœ¨AOTæ‰“åŒ…æ–¹å¼ä¸‹, ä¸»åŒ…çš„.Netçš„è™šæ‹Ÿæœºè¢«å‰”é™¤ä¸§å¤±äº†è§£æç¼–è¯‘IL(dll)çš„èƒ½åŠ›, éœ€è¦ä¸€ä¸ªè¿·ä½ ç‰ˆçš„è™šæ‹Ÿæœº(ä¹Ÿå°±æ˜¯è§£é‡Šå™¨)æ¥æ‰§è¡ŒILä»£ç </p><h1>JITå’Œè§£é‡Šå™¨çš„åŒºåˆ«æ˜¯å•¥å‘¢? ä¸éƒ½æ˜¯è¿è¡Œæ—¶ç¼–è¯‘ä»£ç å˜›?</h1><p>JITæ–¹å¼æ˜¯æœ‰å®Œæ•´çš„Monoæˆ–è€…CLRè™šæ‹Ÿæœºçš„æœºåˆ¶, è€Œè§£é‡Šå™¨åˆ™æ˜¯ä¸€ç§é’ˆå¯¹Unityçƒ­æ›´åœºæ™¯ä¸‹çš„è¿·ä½ ç‰ˆè™šæ‹Ÿæœºæœºåˆ¶.</p><h2 id="Luaã€XLua">Luaã€XLua</h2><h2 id="ILRuntime">ILRuntime</h2><h2 id="HybridCLR">HybridCLR</h2><h1>C#çš„æ‰§è¡Œæœºåˆ¶</h1><p>C#ä»£ç ä¼šè¢«ç¼–è¯‘æˆILè¯­è¨€, åœ¨è¿è¡Œçš„æ—¶å€™, é€šè¿‡ä¸€ä¸ªInterpreter(è§£é‡Šå™¨)é€è¡Œè§£é‡ŠILæŒ‡ä»¤è¿è¡Œ<br>åœ¨IOSä¸Š, æ˜¯ä¸å…è®¸JITçš„æ–¹å¼è¿è¡Œä»£ç çš„, åªèƒ½ä½¿ç”¨AOTçš„æ–¹å¼è¿è¡Œ<br>åœ¨Androidç­‰å…¶ä»–è®¾å¤‡ä¸ŠAOTå’ŒJITéƒ½æ˜¯å¯ä»¥çš„</p><h1>å¦‚ä»Šè¡Œä¸šå†…ä¸»æµçš„çƒ­æ›´æ–¹æ¡ˆç©¶ç«Ÿæ˜¯æ€ä¹ˆå½¢æˆçš„?</h1><ul><li>ç”±äºIOSå¯¹äºJITçš„é™åˆ¶, å¯¼è‡´ä¸»åŒ…å¿…é¡»ä½¿ç”¨AOTçš„æ–¹å¼æ‰“åŒ…, <a href="http://xn--AOT-0y9d42pwx1aclan9eb47e78s.Net">è€ŒAOTæ‰“åŒ…ä¼šç›´æ¥æŠŠ.Net</a> Monoè™šæ‹Ÿæœºå‰”é™¤æ‰, å°†C#ç›´æ¥è½¬æˆC++åŸç”Ÿä»£ç . è¿™å°±ä¼šå¯¼è‡´ä¸»åŒ…ä¸å…·å¤‡è¯†åˆ«dllèƒ½åŠ›</li><li>æ¥ç€, ç”±äºå„ä¸ªæ“ä½œç³»ç»Ÿå¹³å°å¯¹äºåŸç”Ÿä»£ç çš„åŠ¨æ€åŠ è½½æ˜¯æœ‰é™åˆ¶çš„ï¼ˆæ¯”å¦‚ dlopen åŠ æ–° so/dllï¼‰, æ‰€ä»¥æƒ³è¦åœ¨è¿è¡Œæ—¶åŠ¨æ€çš„åŠ è½½ä¸€æ®µé€»è¾‘è¿›æ¥, åªèƒ½ä½¿ç”¨éåŸç”Ÿä»£ç , äºæ˜¯çƒ­æ›´é€šå¸¸é€‰æ‹©DLLï¼ˆILï¼‰</li><li>è¦è®©åº•åŒ…èƒ½è®¤è¯†å’Œè¿è¡Œâ€œçƒ­æ›´dllâ€é‡Œçš„ C# ä»£ç ï¼Œå°±å¾—æœ‰.NETè™šæ‹Ÿæœºã€‚ä½†AOTæ‰“åŒ…è®©è™šæ‹Ÿæœºç›¸å…³èƒ½åŠ›è¢«ç§»é™¤/é˜‰å‰²ï¼Œä¸è®¤dllã€‚ ä½†æ˜¯è™šæ‹Ÿæœºåœ¨AOTæ‰“åŒ…çš„æ—¶å€™å·²ç»å‡ ä¹è¢«å®Œå…¨å‰”é™¤æ‰äº†, å› æ­¤æˆ‘ä»¬å¿…é¡»è®©å®ƒæ¢å¤è¯†åˆ«dllçš„åŠŸèƒ½,</li><li>è¦æƒ³æ¢å¤è¯†åˆ«dllçš„èƒ½åŠ›ï¼Œå°±å¾—é›†æˆæ–°çš„è™šæ‹Ÿæœºæˆ–è§£é‡Šèƒ½åŠ›ï¼ˆæ¯”å¦‚ILRuntime/HybridCLRï¼‰ã€‚HybridCLRçš„æ„ä¹‰å°±æ˜¯è®©AOTåŒ…æ¢å¤å……åˆ†ç”šè‡³å¾ˆå¤§ç¨‹åº¦åŸç”Ÿçš„DLLè¯†åˆ«/è¿è¡Œèƒ½åŠ›ã€‚è¿™å°±æ˜¯HybridCLRæ‰€åšçš„äº‹æƒ…åœ¨AOTæ‰“åŒ…æ¨¡å¼å‰”é™¤æ‰Monoè™šæ‹Ÿæœºè¯†åˆ«dllä»£ç èƒ½åŠ›çš„æƒ…å†µä¸‹, é‡å†™AOTçš„æ‰“åŒ…æ–¹å¼, è®©å…¶ä¿ç•™èƒ½å¤Ÿè¯†åˆ«dllä»£ç çš„èƒ½åŠ›.</li></ul><h1>ä»£ç çƒ­æ›´æ–°</h1><p>ä¸ºä»€ä¹ˆä»£ç çƒ­æ›´æ–°éƒ½é€‰æ‹©ä½¿ç”¨JIT(å°†çƒ­æ›´ä»£ç ç¼–è¯‘æˆdll)çš„æ–¹å¼, è€Œä¸é€‰æ‹©AOTåŸç”Ÿæ–¹å¼å‘¢?</p><h1>çƒ­æ›´çš„ä»£ç å’Œçƒ­æ›´çš„èµ„æº å“ªä¸ªåº”è¯¥å…ˆåŠ è½½?</h1><p>çƒ­æ›´ä»£ç çš„è°ƒç”¨æ–¹å¼<br>æœ‰ä¸€ç§å¾ˆå–å·§çš„æ–¹å¼åŠ è½½çƒ­æ›´ä»£ç , é‚£å°±æ˜¯æŠŠçƒ­æ›´ä»£ç æŒ‚è½½åˆ°æŸä¸€ä¸ªé¢„åˆ¶ä½“ä¸Š, é€šè¿‡Unityçš„Awakeæ–¹æ³•è°ƒç”¨çƒ­æ›´ä»£ç çš„å…¥å£<br>AOTç¨‹åºé›† å°±æ˜¯åº•åŒ…ç¨‹åºé›† AOTæ˜¯ä¸€ç§ä»£ç ç¼–è¯‘æ–¹å¼ å®ƒä¼š</p><p>ä»€ä¹ˆæ˜¯streaming path? ä»€ä¹ˆæ˜¯persistent path?</p><h1>ä¸€äº›Unityä¸­æ— æ³•å†…ç½®çš„dllçš„å¤„ç†</h1><p><a href="https://blog.csdn.net/lanchunhui/article/details/53239441">https://blog.csdn.net/lanchunhui/article/details/53239441</a></p><p><a href="https://zh.wikipedia.org/zh-hans/%E6%AD%A3%E6%80%81%E5%88%86%E5%B8%83">https://zh.wikipedia.org/zh-hans/æ­£æ€åˆ†å¸ƒ</a></p><p><a href="https://blog.csdn.net/qq_17347313/article/details/106995687">https://blog.csdn.net/qq_17347313/article/details/106995687</a><br>C#ä¸­æ­£æ€åˆ†å¸ƒçš„ç¬¬ä¸‰æ–¹åº“</p><h1>æ­£æ€åˆ†å¸ƒ</h1><h2 id="æ ‡å‡†æ­£æ€åˆ†å¸ƒ">æ ‡å‡†æ­£æ€åˆ†å¸ƒ</h2><h1>æ­£åæ€åˆ†å¸ƒ</h1><h1>ç´¯ç§¯åˆ†å¸ƒå‡½æ•°</h1><h1>å‚è€ƒ</h1><ul><li><a href="https://www.cnblogs.com/SunSpring/p/15047424.html">.net æ¸©æ•…çŸ¥æ–°ï¼šã€2ã€‘ .Net Framework ã€.Net ã€ .NET Standardçš„æ¦‚å¿µä¸åŒºåˆ«</a></li><li><a href="https://blog.csdn.net/codywangziham01/article/details/123689658">AOT å’Œ JITã€ IL2CPPå’ŒMonoã€ CLRã€ ILRuntimeçƒ­æ›´æ–°åŸç†</a></li><li><a href="https://www.cnblogs.com/fly-100/p/4594380.html">Unityè·¨å¹³å°åŸç†</a></li><li><a href="https://zhuanlan.zhihu.com/p/88692056">Unityä»å‘å¸ƒåˆ°æµè¡Œç»å†äº†ä»€ä¹ˆé‡å¤§å˜åŒ–ï¼ˆ2ï¼‰</a></li><li><a href="https://blog.csdn.net/gz_huangzl/article/details/52486255">Unityå°†æ¥æ—¶ï¼šIL2CPPæ˜¯ä»€ä¹ˆï¼Ÿæœ‰äº†Monoä¸ºä»€ä¹ˆè¿˜éœ€è¦IL2CPP?</a></li><li><a href="https://blog.csdn.net/Funniyuan/article/details/136002603">.NET å‘å±•å†ç¨‹ä¸æœªæ¥</a></li><li><a href="https://my.oschina.net/emacs_9244658/blog/18230886">Mono è½¯ä»¶å‘å±•å†ç¨‹è¯¦è§£</a></li><li><a href="https://www.cnblogs.com/willick/p/15038133.html">.NET çš„å‘å±•ç®€å²</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>äººæ€§çš„å¼±ç‚¹</title>
      <link href="/posts/109e75d5/"/>
      <url>/posts/109e75d5/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>UnityEditorå¼€å‘ä¸­Singletonçš„è®¾è®¡</title>
      <link href="/posts/1477ebaf/"/>
      <url>/posts/1477ebaf/</url>
      
        <content type="html"><![CDATA[<h1>åœ¨Editorä¸‹åˆ›å»ºå•ä¾‹</h1><p>çµæ„Ÿæ¥è‡ªUnityçš„<a href="https://sites.google.com/view/monkey-user-guide/getting-started">MonKeyæ’ä»¶</a></p><h2 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</h2><p>æˆ‘æœ‰ä¸€äº›ç”±<code>ScriptableObject</code>ã€<code>json</code>æˆ–è€…åˆ«çš„æ ¼å¼ç»„ç»‡çš„ä¸€ç»„æ•°æ®, æˆ‘å¸Œæœ›åœ¨Editoræ¨¡å¼ä¸‹å¼€å‘ä¸€å¥—å·¥å…·, èƒ½è®©æˆ‘å¯¹è¿™ä¸€ç»„æ•°æ®è¿›è¡Œå¢åˆ æ”¹æŸ¥, æ ¹æ®MVCæ¶æ„çš„æ€æƒ³, å¿…é¡»æœ‰ä¸€ä¸ª<code>Manager</code>æ¥ç»´æŠ¤è¿™ä¸€ç»„æ•°æ®çš„å¢åˆ æ”¹æŸ¥, å¹¶ä¸”è¯¥<code>Manager</code>çš„ç”Ÿå‘½å‘¨æœŸéœ€è¦å’ŒUnity Editorçš„ç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´.</p><h2 id="å…³é”®è§’è‰²">å…³é”®è§’è‰²</h2><ul><li><a href="https://docs.unity3d.com/ScriptReference/InitializeOnLoadAttribute.html"><code>InitializeOnLoad</code></a>å±æ€§, æ ¹æ®å®˜æ–¹çš„æè¿°, è¯¥å±æ€§ä¼šåœ¨UnityEditoræ‰“å¼€å’Œä»£ç é‡æ–°ç¼–è¯‘çš„æ—¶å€™åˆå§‹åŒ–Editorè„šæœ¬. ä½ éœ€è¦ç»™è¿™ä¸ªEditorè„šæœ¬æä¾›ä¸€ä¸ªé™æ€çš„æ„é€ å‡½æ•°, <strong>æ³¨æ„</strong> å®˜æ–¹æåˆ°äº† åº”è¯¥é¿å…åœ¨InitialzeOnLoadä¸­è¿›è¡Œèµ„äº§åŠ è½½çš„æ“ä½œ, å› ä¸ºInitialzeOnLoadæ˜¯åœ¨èµ„äº§å¯¼å…¥å®Œæˆå‰è¢«è°ƒç”¨çš„, è¯¥æ“ä½œæœ‰å¯èƒ½ä¼šå¯¼è‡´èµ„äº§åŠ è½½å¤±è´¥. è¦åœ¨éœ€è¦è¿›è¡Œèµ„äº§æ“ä½œçš„åŸŸé‡è½½åè¿›è¡Œåˆå§‹åŒ–, å¯ä»¥ä½¿ç”¨<code>AssetPostprocessor.OnPostprocessAllAssets</code>å›è°ƒ. ä½†Unity2020ç‰ˆæœ¬ä¸­æ˜¯æ²¡æœ‰è¿™ä¸ªæ¥å£çš„, è¯¥å›è°ƒæ”¯æŒæ‰€æœ‰èµ„äº§æ“ä½œ, å¹¶æœ‰ä¸€ä¸ªå‚æ•°æç¤ºæ˜¯å¦è¿›è¡Œäº†åŸŸé‡è½½. Unityä¸èƒ½ä¿è¯ å› æ­¤ä½¿ç”¨æ‡’æ±‰æ¨¡å¼, å°†åœ¨åˆå§‹åŒ–æ“ä½œä¸­ä¸èƒ½åŠ è½½èµ„æºçš„æ“ä½œå˜ä¸ºäº†åœ¨åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ä¸èƒ½è®¿é—®Instanceçš„æ“ä½œ, å°†åŠ è½½èµ„æºçš„æ“ä½œæ”¾åœ¨é¦–æ¬¡è®¿é—®Instanceä¹‹å å¯¹äºä¸€ä¸ªEditorå•ä¾‹, å¦‚æœè¯¥å•ä¾‹éœ€è¦åšä¸€äº›åŠ è½½æ“ä½œ, é‚£ä¹ˆå°±è®©è¿™ä¸ªå•ä¾‹å®ç°IAssetProcessæ¥å£,</li></ul><p>EditorSingletonçš„å®ç°</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> UnityEditorå¼€å‘ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>UnityUGUITextå®ç°æè¾¹</title>
      <link href="/posts/9125ebdc/"/>
      <url>/posts/9125ebdc/</url>
      
        <content type="html"><![CDATA[<h1>é€šè¿‡é¡¶ç‚¹æ–¹å¼å®ç°æè¾¹</h1><h2 id="UGUIä¸­è‡ªå¸¦çš„Outline">UGUIä¸­è‡ªå¸¦çš„Outline</h2><h1>é€šè¿‡Shaderæ–¹å¼å®ç°æè¾¹</h1>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>UnityUGUIè§£æ„</title>
      <link href="/posts/e0e34b4b/"/>
      <url>/posts/e0e34b4b/</url>
      
        <content type="html"><![CDATA[<h1>å¼•å­â€”â€”UGUIä¸­çš„Textå¦‚ä½•è¢«ç»˜åˆ¶åˆ°å±å¹•ä¸Š?</h1><p>å‚ä¸ç»˜åˆ¶Textçš„è§’è‰²:</p><ul><li>VertexHelper</li><li>TextGenerator</li><li>Fontå’ŒFontData</li><li>BaseMeshEffect</li></ul><p>è¿™æ˜¯å­—ä½“ä½¿ç”¨çš„Shader</p><figure class="highlight plaintext"><figcaption><span>Shader</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">// Unity built-in shader source. Copyright (c) 2016 Unity Technologies. MIT license (see license.txt)</span><br><span class="line"></span><br><span class="line">Shader &quot;GUI/Text Shader&quot; &#123;</span><br><span class="line">    Properties &#123;</span><br><span class="line">        _MainTex (&quot;Font Texture&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _Color (&quot;Text Color&quot;, Color) = (1,1,1,1)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    SubShader &#123;</span><br><span class="line"></span><br><span class="line">        Tags &#123;</span><br><span class="line">            &quot;Queue&quot;=&quot;Transparent&quot;</span><br><span class="line">            &quot;IgnoreProjector&quot;=&quot;True&quot;</span><br><span class="line">            &quot;RenderType&quot;=&quot;Transparent&quot;</span><br><span class="line">            &quot;PreviewType&quot;=&quot;Plane&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        Lighting Off Cull Off ZTest Always ZWrite Off</span><br><span class="line">        Blend SrcAlpha OneMinusSrcAlpha</span><br><span class="line"></span><br><span class="line">        Pass &#123;</span><br><span class="line">            CGPROGRAM</span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line">            #pragma multi_compile _ UNITY_SINGLE_PASS_STEREO STEREO_INSTANCING_ON STEREO_MULTIVIEW_ON</span><br><span class="line">            #include &quot;UnityCG.cginc&quot;</span><br><span class="line"></span><br><span class="line">            struct appdata_t &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                fixed4 color : COLOR;</span><br><span class="line">                float2 texcoord : TEXCOORD0;</span><br><span class="line">                UNITY_VERTEX_INPUT_INSTANCE_ID</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f &#123;</span><br><span class="line">                float4 vertex : SV_POSITION;</span><br><span class="line">                fixed4 color : COLOR;</span><br><span class="line">                float2 texcoord : TEXCOORD0;</span><br><span class="line">                UNITY_VERTEX_OUTPUT_STEREO</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            uniform float4 _MainTex_ST;</span><br><span class="line">            uniform fixed4 _Color;</span><br><span class="line"></span><br><span class="line">            v2f vert (appdata_t v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                UNITY_SETUP_INSTANCE_ID(v);</span><br><span class="line">                UNITY_INITIALIZE_VERTEX_OUTPUT_STEREO(o);</span><br><span class="line">                o.vertex = UnityObjectToClipPos(v.vertex);</span><br><span class="line">                o.color = v.color * _Color;</span><br><span class="line">                o.texcoord = TRANSFORM_TEX(v.texcoord,_MainTex);</span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag (v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                fixed4 col = i.color;</span><br><span class="line">                col.a *= tex2D(_MainTex, i.texcoord).a;</span><br><span class="line">                return col;</span><br><span class="line">            &#125;</span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™æ˜¯æ‰€æœ‰çš„UGUIé»˜è®¤ä½¿ç”¨çš„Shader</p><figure class="highlight plaintext"><figcaption><span>Shader</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">// Unity built-in shader source. Copyright (c) 2016 Unity Technologies. MIT license (see license.txt)</span><br><span class="line"></span><br><span class="line">Shader &quot;UI/Default&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        [PerRendererData] _MainTex (&quot;Sprite Texture&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _Color (&quot;Tint&quot;, Color) = (1,1,1,1)</span><br><span class="line"></span><br><span class="line">        _StencilComp (&quot;Stencil Comparison&quot;, Float) = 8</span><br><span class="line">        _Stencil (&quot;Stencil ID&quot;, Float) = 0</span><br><span class="line">        _StencilOp (&quot;Stencil Operation&quot;, Float) = 0</span><br><span class="line">        _StencilWriteMask (&quot;Stencil Write Mask&quot;, Float) = 255</span><br><span class="line">        _StencilReadMask (&quot;Stencil Read Mask&quot;, Float) = 255</span><br><span class="line"></span><br><span class="line">        _ColorMask (&quot;Color Mask&quot;, Float) = 15</span><br><span class="line"></span><br><span class="line">        [Toggle(UNITY_UI_ALPHACLIP)] _UseUIAlphaClip (&quot;Use Alpha Clip&quot;, Float) = 0</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Queue&quot;=&quot;Transparent&quot;</span><br><span class="line">            &quot;IgnoreProjector&quot;=&quot;True&quot;</span><br><span class="line">            &quot;RenderType&quot;=&quot;Transparent&quot;</span><br><span class="line">            &quot;PreviewType&quot;=&quot;Plane&quot;</span><br><span class="line">            &quot;CanUseSpriteAtlas&quot;=&quot;True&quot;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Stencil</span><br><span class="line">        &#123;</span><br><span class="line">            Ref [_Stencil]</span><br><span class="line">            Comp [_StencilComp]</span><br><span class="line">            Pass [_StencilOp]</span><br><span class="line">            ReadMask [_StencilReadMask]</span><br><span class="line">            WriteMask [_StencilWriteMask]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Cull Off</span><br><span class="line">        Lighting Off</span><br><span class="line">        ZWrite Off</span><br><span class="line">        ZTest [unity_GUIZTestMode]</span><br><span class="line">        Blend One OneMinusSrcAlpha</span><br><span class="line">        ColorMask [_ColorMask]</span><br><span class="line"></span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Name &quot;Default&quot;</span><br><span class="line">        CGPROGRAM</span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line">            #pragma target 2.0</span><br><span class="line"></span><br><span class="line">            #include &quot;UnityCG.cginc&quot;</span><br><span class="line">            #include &quot;UnityUI.cginc&quot;</span><br><span class="line"></span><br><span class="line">            #pragma multi_compile_local _ UNITY_UI_CLIP_RECT</span><br><span class="line">            #pragma multi_compile_local _ UNITY_UI_ALPHACLIP</span><br><span class="line"></span><br><span class="line">            struct appdata_t</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex   : POSITION;</span><br><span class="line">                float4 color    : COLOR;</span><br><span class="line">                float2 texcoord : TEXCOORD0;</span><br><span class="line">                UNITY_VERTEX_INPUT_INSTANCE_ID</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex   : SV_POSITION;</span><br><span class="line">                fixed4 color    : COLOR;</span><br><span class="line">                float2 texcoord  : TEXCOORD0;</span><br><span class="line">                float4 worldPosition : TEXCOORD1;</span><br><span class="line">                float4  mask : TEXCOORD2;</span><br><span class="line">                UNITY_VERTEX_OUTPUT_STEREO</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            fixed4 _Color;</span><br><span class="line">            fixed4 _TextureSampleAdd;</span><br><span class="line">            float4 _ClipRect;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line">            float _UIMaskSoftnessX;</span><br><span class="line">            float _UIMaskSoftnessY;</span><br><span class="line"></span><br><span class="line">            v2f vert(appdata_t v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f OUT;</span><br><span class="line">                UNITY_SETUP_INSTANCE_ID(v);</span><br><span class="line">                UNITY_INITIALIZE_VERTEX_OUTPUT_STEREO(OUT);</span><br><span class="line">                float4 vPosition = UnityObjectToClipPos(v.vertex);</span><br><span class="line">                OUT.worldPosition = v.vertex;</span><br><span class="line">                OUT.vertex = vPosition;</span><br><span class="line"></span><br><span class="line">                float2 pixelSize = vPosition.w;</span><br><span class="line">                pixelSize /= float2(1, 1) * abs(mul((float2x2)UNITY_MATRIX_P, _ScreenParams.xy));</span><br><span class="line"></span><br><span class="line">                float4 clampedRect = clamp(_ClipRect, -2e10, 2e10);</span><br><span class="line">                float2 maskUV = (v.vertex.xy - clampedRect.xy) / (clampedRect.zw - clampedRect.xy);</span><br><span class="line">                OUT.texcoord = TRANSFORM_TEX(v.texcoord.xy, _MainTex);</span><br><span class="line">                OUT.mask = float4(v.vertex.xy * 2 - clampedRect.xy - clampedRect.zw, 0.25 / (0.25 * half2(_UIMaskSoftnessX, _UIMaskSoftnessY) + abs(pixelSize.xy)));</span><br><span class="line"></span><br><span class="line">                OUT.color = v.color * _Color;</span><br><span class="line">                return OUT;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f IN) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                half4 color = IN.color * (tex2D(_MainTex, IN.texcoord) + _TextureSampleAdd);</span><br><span class="line"></span><br><span class="line">                #ifdef UNITY_UI_CLIP_RECT</span><br><span class="line">                half2 m = saturate((_ClipRect.zw - _ClipRect.xy - abs(IN.mask.xy)) * IN.mask.zw);</span><br><span class="line">                color.a *= m.x * m.y;</span><br><span class="line">                #endif</span><br><span class="line"></span><br><span class="line">                #ifdef UNITY_UI_ALPHACLIP</span><br><span class="line">                clip (color.a - 0.001);</span><br><span class="line">                #endif</span><br><span class="line"></span><br><span class="line">                color.rgb *= color.a;</span><br><span class="line"></span><br><span class="line">                return color;</span><br><span class="line">            &#125;</span><br><span class="line">        ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://docs.unity3d.com/2022.3/Documentation/ScriptReference/TextGenerator.html">Unity TextGenerator API</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>çº¿æ€§ä»£æ•°åœ¨æ¸¸æˆå¼€å‘ä¸­çš„åº”ç”¨</title>
      <link href="/posts/fd0318d/"/>
      <url>/posts/fd0318d/</url>
      
        <content type="html"><![CDATA[<h1>åˆ¤æ–­ä¸€ä¸ªå‘é‡ä¸åæ ‡è½´çš„é‡åˆåº¦</h1><p>å‘é‡ä¸æ¯ä¸ªåæ ‡è½´å‘é‡è¿›è¡Œç‚¹ç§¯, æ³¨æ„è¿™é‡Œè¦æ±‚å‚ä¸è¿ç®—çš„æ‰€æœ‰å‘é‡éƒ½æ˜¯å½’ä¸€åŒ–çš„, ç‚¹ç§¯ç»“æœä¼šå¾—åˆ°ä¸€ä¸ªå¸¸æ•°, å¯¹è¿™ä¸ªå¸¸æ•°å–ç»å¯¹å€¼, ç»“æœè¶Šå¤§ä»£è¡¨ä¸è¯¥å‘¨å‘é‡è¶Šé‡åˆ, å¸¸æ•°çš„æ­£è´Ÿä»£è¡¨çš„æ˜¯ä¸åæ ‡è½´çš„æ­£æ–¹å‘è¿˜æ˜¯è´Ÿæ–¹å‘é‡åˆåº¦æ›´é«˜.</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CSharpä¸­çš„CancellationToken</title>
      <link href="/posts/7331d0f1/"/>
      <url>/posts/7331d0f1/</url>
      
        <content type="html"><![CDATA[<h1>å‚è€ƒèµ„æ–™</h1><p><a href="https://medium.com/@mitesh_shah/a-deep-dive-into-c-s-cancellationtoken-44bc7664555f">A Deep Dive into C#â€™s CancellationToken</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SVNâ€”â€”SubVersionå­¦ä¹ è®°å½•</title>
      <link href="/posts/fb782408/"/>
      <url>/posts/fb782408/</url>
      
        <content type="html"><![CDATA[<p>SVNä¸­çš„ä¸¤ç§å†²çª</p><h2 id="1-æ–‡ä»¶å†²çªï¼ˆfile-conflictï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ">1. æ–‡ä»¶å†²çªï¼ˆfile conflictï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul><li><strong>æ–‡ä»¶å†²çª</strong>æŒ‡çš„æ˜¯ï¼š<br>å¤šäººå¯¹<strong>åŒä¸€ä¸ªæ–‡ä»¶çš„åŒä¸€ä¸ªéƒ¨åˆ†</strong>è¿›è¡Œäº†ä¸åŒä¿®æ”¹ã€‚</li><li>ä¾‹å¦‚ï¼šä½ å’ŒåŒäº‹åŒæ—¶ç¼–è¾‘Â <code>a.txt</code>Â çš„ç¬¬5è¡Œå†…å®¹ï¼Œæäº¤æ›´æ–°æ—¶å°±ä¼šå‘ç”Ÿæ–‡ä»¶å†²çªã€‚</li></ul><h3 id="å¸¸è§è¡¨ç°">å¸¸è§è¡¨ç°</h3><ul><li>SVN ä¼šæŠŠæœ‰å†²çªçš„éƒ¨åˆ†æ’å…¥ä¸€äº›Â <code>&lt;&lt;&lt;&lt;&lt;&lt;&lt;</code>ã€<code>=======</code>ã€<code>&gt;&gt;&gt;&gt;&gt;&gt;&gt;</code>Â æ ‡è®°ï¼Œç­‰ä½ æ‰‹åŠ¨åˆå¹¶/é€‰æ‹©ã€‚</li><li>ä½ éœ€è¦æ‰“å¼€æ–‡ä»¶åˆå¹¶æˆ–ç›´æ¥é‡æ–°ç¼–è¾‘ã€‚</li></ul><hr><h2 id="2-æ ‘å†²çªï¼ˆtree-conflictï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ">2. æ ‘å†²çªï¼ˆtree conflictï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul><li><strong>æ ‘å†²çª</strong>æ˜¯ SVN 1.6 åŠä»¥åçš„æ¦‚å¿µã€‚</li><li>æ‰€è°“â€œæ ‘â€å…¶å®æŒ‡<strong>ç›®å½•ç»“æ„/æ–‡ä»¶ç»“æ„ï¼ˆä¸æ˜¯æ ‘çŠ¶æ§ä»¶ï¼Œä¹Ÿä¸æ˜¯æ•°æ®ç»“æ„çš„æ ‘ï¼Œè€Œæ˜¯æ•´ä¸ªé¡¹ç›®çš„æ–‡ä»¶ã€æ–‡ä»¶å¤¹ç»„æˆçš„ç›®å½•æ ‘ï¼‰</strong>ã€‚</li><li><strong>æ ‘å†²çªå‡ºç°åœ¨ï¼š</strong><br>é’ˆå¯¹ç›®å½•ç»“æ„æ“ä½œï¼ˆå¦‚æ–‡ä»¶/æ–‡ä»¶å¤¹çš„æ–°å¢ã€é‡å‘½åã€åˆ é™¤ã€ç§»åŠ¨ï¼‰æ—¶ï¼Œä¸åŒäººå¯¹åŒä¸€éƒ¨åˆ†ç›®å½•æ ‘åšäº†<strong>ç»“æ„æ€§å˜åŒ–</strong>ï¼Œå¹¶å‘ç”Ÿäº†å†²çªã€‚</li></ul><h3 id="å…¸å‹ä¾‹å­">å…¸å‹ä¾‹å­</h3><ol><li><strong>ä½ åˆ é™¤äº†æŸä¸ªæ–‡ä»¶/æ–‡ä»¶å¤¹ï¼ŒåŒäº‹ä¿®æ”¹äº†è¿™ä¸ªæ–‡ä»¶</strong><ul><li>ä½ åˆ äº†<code>A/B/C.cs</code>ï¼ŒåŒäº‹è¿˜åœ¨åŒä¸€ç‰ˆæœ¬ä¸Šç¼–è¾‘<code>C.cs</code>ï¼Œä½ ä»¬éƒ½æäº¤ï¼Œç„¶åæ›´æ–°ã€‚ä½ å°±ä¼šé‡åˆ°<code>tree conflict</code>ã€‚</li></ul></li><li><strong>ä¸€æ–¹ç§»åŠ¨/é‡å‘½åç›®å½•ï¼Œå¦ä¸€æ–¹åœ¨åŸåœ°æ–°å»ºæˆ–ä¿®æ”¹æ–‡ä»¶</strong></li><li><strong>çˆ¶ç›®å½•è¢«åˆ é™¤ã€å­æ–‡ä»¶è¢«ä¿®æ”¹æˆ–åä¹‹</strong></li><li><strong>ä»»ä½•ç›®å½•æˆ–è€…æ–‡ä»¶åœ¨ç»“æ„ä¸Šå‘ç”Ÿå˜åŒ–ï¼Œè€Œéå†…å®¹ä¿®æ”¹</strong></li></ol><h1>SVNæ’¤å›æŸä¸€æ¬¡æäº¤</h1><p>ä½ æƒ³æ’¤é”€130æ¬¡æäº¤çš„å†…å®¹ï¼ˆå¯èƒ½æ­¤åè¿˜æœ‰131ã€132ã€133â€¦çš„æ­£å¸¸æäº¤ï¼‰ï¼Œåªæ’¤é”€è¿™æ¬¡çš„å†…å®¹ï¼Œå…¶åçš„å˜åŠ¨ç»§ç»­å­˜åœ¨ã€‚<br>æ“ä½œå‘½ä»¤</p><p>svn merge -c -130 ä½ çš„å·¥ä½œå‰¯æœ¬ç›®å½•<br>svn commit -m â€œæ’¤é”€r130æäº¤å†…å®¹â€<br>-cå‚æ•°åé¢åŠ ä¸Šè´Ÿå·-130ï¼Œè¡¨ç¤ºâ€œæ’¤é”€ r130â€çš„å˜æ›´ã€‚<br>æ‰§è¡Œåè®°å¾—åˆ°å·¥ä½œå‰¯æœ¬çœ‹ä¸‹å˜åŠ¨ï¼Œå†commitã€‚<br>ä¸¾ä¾‹</p><p>å¦‚ä½ çš„é¡¹ç›®åœ°å€ä¸ºhttp://xxx.com/svn/project/trunkï¼Œä½ åœ¨trunkç›®å½•ä¸‹ï¼š</p><p>svn merge -c -130 .<br>svn commit -m â€œæ’¤é”€ç¬¬130æ¬¡æäº¤â€</p><h1>SVNæŸ¥çœ‹å½“å‰Revision</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn info</span><br></pre></td></tr></table></figure><h1>å†™ä¸€ä¸ªå¯ä»¥æŸ¥è¯¢å½“å¤©æäº¤è®°å½•çš„shellè„šæœ¬</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">  </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç”¨æ³•: ./svn_tag_summary.sh /path/to/your/svn/working_copy</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SVN_PATH=&quot;$1&quot;</span><br><span class="line"></span><br><span class="line">AUTHOR=&quot;liyinuo@tuyoogame.com&quot;</span><br><span class="line"></span><br><span class="line">TODAY=$(date +&quot;%Y-%m-%d&quot;)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">if [[ ! -d &quot;$SVN_PATH/.svn&quot; ]]; then</span><br><span class="line"></span><br><span class="line">echo &quot;è·¯å¾„ $SVN_PATH ä¸æ˜¯svnä»“åº“&quot;</span><br><span class="line"></span><br><span class="line">exit 1</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">cd &quot;$SVN_PATH&quot; || exit 1</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–ä»Šå¤©è¯¥ä½œè€…çš„æäº¤è®°å½•</span></span><br><span class="line"></span><br><span class="line">svn log -r &#123;$&#123;TODAY&#125;T00:00:00&#125;:&#123;$&#123;TODAY&#125;T23:59:59&#125; --search &quot;$AUTHOR&quot; --verbose --xml &gt; __svn_today.xml</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">if ! grep -q &quot;&lt;logentry&quot; __svn_today.xml; then</span><br><span class="line"></span><br><span class="line">echo &quot;æ²¡æœ‰ä»Šå¤©ä½œè€… $AUTHOR çš„æäº¤è®°å½•&quot;</span><br><span class="line"></span><br><span class="line">rm -f __svn_today.xml</span><br><span class="line"></span><br><span class="line">exit 0</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å–æ‰€æœ‰ commit message</span></span><br><span class="line"></span><br><span class="line">msgs=$(xmllint --xpath &#x27;//logentry[author=&quot;&#x27;$AUTHOR&#x27;&quot;]/msg/text()&#x27; __svn_today.xml 2&gt;/dev/null | grep -v &#x27;^$&#x27;)</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å„åˆ†ç±»å­—ç¬¦ä¸²</span></span><br><span class="line"></span><br><span class="line">feat_msgs=&quot;&quot;</span><br><span class="line"></span><br><span class="line">fix_msgs=&quot;&quot;</span><br><span class="line"></span><br><span class="line">refactor_msgs=&quot;&quot;</span><br><span class="line"></span><br><span class="line">docs_msgs=&quot;&quot;</span><br><span class="line"></span><br><span class="line">test_msgs=&quot;&quot;</span><br><span class="line"></span><br><span class="line">chore_msgs=&quot;&quot;</span><br><span class="line"></span><br><span class="line">other_msgs=&quot;&quot;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">while IFS= read -r line; do</span><br><span class="line"></span><br><span class="line">if [[ &quot;$line&quot; =~ ^\[feat\][[:space:]]*[:ï¼š]? ]]; then</span><br><span class="line"></span><br><span class="line">feat_msgs=&quot;$&#123;feat_msgs&#125;$&#123;line&#125;&quot;$&#x27;\n&#x27;</span><br><span class="line"></span><br><span class="line">elif [[ &quot;$line&quot; =~ ^\[fix\][[:space:]]*[:ï¼š]? ]]; then</span><br><span class="line"></span><br><span class="line">fix_msgs=&quot;$&#123;fix_msgs&#125;$&#123;line&#125;&quot;$&#x27;\n&#x27;</span><br><span class="line"></span><br><span class="line">elif [[ &quot;$line&quot; =~ ^\[refactor\][[:space:]]*[:ï¼š]? ]]; then</span><br><span class="line"></span><br><span class="line">refactor_msgs=&quot;$&#123;refactor_msgs&#125;$&#123;line&#125;&quot;$&#x27;\n&#x27;</span><br><span class="line"></span><br><span class="line">elif [[ &quot;$line&quot; =~ ^\[docs\][[:space:]]*[:ï¼š]? ]]; then</span><br><span class="line"></span><br><span class="line">docs_msgs=&quot;$&#123;docs_msgs&#125;$&#123;line&#125;&quot;$&#x27;\n&#x27;</span><br><span class="line"></span><br><span class="line">elif [[ &quot;$line&quot; =~ ^\[test\][[:space:]]*[:ï¼š]? ]]; then</span><br><span class="line"></span><br><span class="line">test_msgs=&quot;$&#123;test_msgs&#125;$&#123;line&#125;&quot;$&#x27;\n&#x27;</span><br><span class="line"></span><br><span class="line">elif [[ &quot;$line&quot; =~ ^\[chore\][[:space:]]*[:ï¼š]? ]]; then</span><br><span class="line"></span><br><span class="line">chore_msgs=&quot;$&#123;chore_msgs&#125;$&#123;line&#125;&quot;$&#x27;\n&#x27;</span><br><span class="line"></span><br><span class="line">else</span><br><span class="line"></span><br><span class="line">other_msgs=&quot;$&#123;other_msgs&#125;$&#123;line&#125;&quot;$&#x27;\n&#x27;</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">done &lt;&lt;&lt; &quot;$msgs&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;ä½œè€…: $AUTHOR ä»Šå¤©çš„æäº¤åˆ†ç±»å¦‚ä¸‹ï¼š&quot;</span><br><span class="line"></span><br><span class="line">echo</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">if [ -n &quot;$feat_msgs&quot; ]; then</span><br><span class="line"></span><br><span class="line">echo &quot;---------------- [feat] ----------------&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;$feat_msgs&quot;</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">if [ -n &quot;$fix_msgs&quot; ]; then</span><br><span class="line"></span><br><span class="line">echo &quot;---------------- [fix] ----------------&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;$fix_msgs&quot;</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">if [ -n &quot;$refactor_msgs&quot; ]; then</span><br><span class="line"></span><br><span class="line">echo &quot;---------------- [refactor] ----------------&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;$refactor_msgs&quot;</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">if [ -n &quot;$docs_msgs&quot; ]; then</span><br><span class="line"></span><br><span class="line">echo &quot;---------------- [docs] ----------------&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;$docs_msgs&quot;</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">if [ -n &quot;$test_msgs&quot; ]; then</span><br><span class="line"></span><br><span class="line">echo &quot;---------------- [test] ----------------&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;$test_msgs&quot;</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">if [ -n &quot;$chore_msgs&quot; ]; then</span><br><span class="line"></span><br><span class="line">echo &quot;---------------- [chore] ----------------&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;$chore_msgs&quot;</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">if [ -n &quot;$other_msgs&quot; ]; then</span><br><span class="line"></span><br><span class="line">echo &quot;---------------- [other] ----------------&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;$other_msgs&quot;</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">rm -f __svn_today.xml</span><br></pre></td></tr></table></figure><h3 id="1-SVN-åˆ é™¤ä¸€ä¸ªæ–‡ä»¶åå¦‚ä½•ç”¨å‘½ä»¤è¡Œæäº¤è¿™ä¸ªä¿®æ”¹">1. SVN åˆ é™¤ä¸€ä¸ªæ–‡ä»¶åå¦‚ä½•ç”¨å‘½ä»¤è¡Œæäº¤è¿™ä¸ªä¿®æ”¹</h3><p>åˆ é™¤æ–‡ä»¶åï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š</p><h4 id="ï¼ˆ1ï¼‰åˆ é™¤æ–‡ä»¶">ï¼ˆ1ï¼‰åˆ é™¤æ–‡ä»¶</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">svn delete æ–‡ä»¶å</span><br><span class="line"># æ¯”å¦‚</span><br><span class="line">svn delete test.txt</span><br></pre></td></tr></table></figure><p>æˆ–è€…ç›´æ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn del test.txt</span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ2ï¼‰æäº¤åˆ é™¤æ“ä½œ">ï¼ˆ2ï¼‰æäº¤åˆ é™¤æ“ä½œ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn commit -m &quot;åˆ é™¤äº†test.txtæ–‡ä»¶&quot;</span><br></pre></td></tr></table></figure><hr><h3 id="2-SVN-ä½¿ç”¨å‘½ä»¤è¡Œ-Add-to-working-copy">2. SVN ä½¿ç”¨å‘½ä»¤è¡Œ Add to working copy</h3><p>å¦‚æœæ‚¨æƒ³å°†æŸä¸ªæ–‡ä»¶æˆ–ç›®å½•æ·»åŠ åˆ°æ‚¨çš„å·¥ä½œå‰¯æœ¬ï¼ˆworking copyï¼‰ï¼Œå³åŒ…å«åˆ°ç‰ˆæœ¬æ§åˆ¶ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><h4 id="ï¼ˆ1ï¼‰æ·»åŠ æ–‡ä»¶æˆ–ç›®å½•">ï¼ˆ1ï¼‰æ·»åŠ æ–‡ä»¶æˆ–ç›®å½•</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">svn add æ–‡ä»¶åæˆ–ç›®å½•å</span><br><span class="line"># æ¯”å¦‚</span><br><span class="line">svn add newfile.txt</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯æ–°æ–‡ä»¶å¤¹ï¼Œå¯ä»¥é€’å½’æ·»åŠ å†…éƒ¨å…¨éƒ¨æ–°æ–‡ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn add newfolder --force</span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ2ï¼‰æäº¤æ·»åŠ æ“ä½œ">ï¼ˆ2ï¼‰æäº¤æ·»åŠ æ“ä½œ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn commit -m &quot;æ·»åŠ äº†æ–°æ–‡ä»¶ï¼ˆæˆ–æ–‡ä»¶å¤¹ï¼‰&quot;</span><br></pre></td></tr></table></figure><hr><h3 id="æ€»ç»“">æ€»ç»“</h3><ul><li><p><strong>åˆ é™¤åæäº¤ï¼š</strong></p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">svn delete æ–‡ä»¶</span><br><span class="line">svn commit -m &quot;è¯´æ˜&quot;</span><br></pre></td></tr></table></figure></li><li><p><strong>æ–°å¢åæäº¤ï¼š</strong></p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">svn add æ–‡ä»¶</span><br><span class="line">svn commit -m &quot;è¯´æ˜&quot;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç‰ˆæœ¬ç®¡ç†å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SVN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¨‹åºå‘˜è¶…å¼ºå¤§è„‘</title>
      <link href="/posts/823ad99a/"/>
      <url>/posts/823ad99a/</url>
      
        <content type="html"><![CDATA[<h1>å‰–æç¨‹åºè®¾è®¡ä¹‹æƒ‘</h1><h2 id="é˜…è¯»ä»£ç ä¸­é‡åˆ°çš„ä¸‰ç§å›°æƒ‘">é˜…è¯»ä»£ç ä¸­é‡åˆ°çš„ä¸‰ç§å›°æƒ‘</h2><ul><li>ç¼ºä¹çŸ¥è¯†, ä¸äº†è§£æ­£åœ¨é˜…è¯»çš„ç¼–ç¨‹è¯­è¨€ã€ç®—æ³•æˆ–é¢†åŸŸ.</li><li>ç¼ºä¹ä¿¡æ¯, æ— æ³•è·å¾—ç†è§£ä»£ç æ‰€éœ€çš„å…¨éƒ¨ä¿¡æ¯, å°¤å…¶æ˜¯å¦‚ä»Šçš„ä»£ç ç»å¸¸ä½¿ç”¨å„ç§åº“ã€æ¨¡å—æˆ–åŒ…, æƒ³è¯»æ‡‚ä»£ç å°±éœ€è¦æ£€ç´¢å¤§é‡ä¿¡æ¯, è€Œåœ¨æ”¶é›†æ–°ä¿¡æ¯çš„åŒæ—¶è¿˜ä¸èƒ½å¿˜è®°åŸæœ¬åº”è¯¥å®Œæˆçš„ä»»åŠ¡. ä»£ç ä¸­çœ‹åˆ°ä¸€ä¸ªæ¥å£ä¸æ¸…æ¥šä»–çš„ä½œç”¨æ˜¯å±äºç¼ºä¹ä¿¡æ¯</li><li>ç¼ºä¹åŠ å·¥èƒ½åŠ›, ä»£ç æœ‰æ—¶è¿‡äºå¤æ‚, è¶…å‡ºäº†å¤§è„‘çš„åŠ å·¥èƒ½åŠ›.</li></ul><h2 id="å½±å“ç¨‹åºè®¾è®¡çš„ä¸åŒè®¤çŸ¥è¿‡ç¨‹">å½±å“ç¨‹åºè®¾è®¡çš„ä¸åŒè®¤çŸ¥è¿‡ç¨‹</h2><ul><li>é•¿æ—¶è®°å¿†(long-term memory), å¯ä»¥æ— é™æœŸå­˜å‚¨æ‰€æœ‰è®°å¿†, ç¼ºä¹çŸ¥è¯†æ„å‘³ç€é•¿æ—¶è®°å¿†ä¸­ç¼ºå°‘è¶³å¤Ÿçš„ç›¸å…³äº‹å®. é•¿æ—¶è®°å¿†ä¼šå­˜å‚¨å‡ ç±»ç›¸å…³çš„ç¼–ç¨‹ä¿¡æ¯, ä¾‹å¦‚æˆåŠŸè¿ç”¨æŸç§ç¼–ç¨‹æŠ€å·§çš„è®°å¿†ã€Javaå…³é”®å­—çš„å«ä¹‰ã€è‹±è¯­å•è¯çš„å«ä¹‰æˆ–è€…Javaä¸­intå‹å˜é‡çš„æœ€å¤§å€¼(2147483647).</li><li>çŸ­æ—¶è®°å¿†(short-term memory), å¤§è„‘è·å–çš„ä¿¡æ¯æš‚æ—¶å­˜å‚¨äºçŸ­æ—¶è®°å¿†, å¤§è„‘æ¥å—å¤–éƒ¨çš„ä¿¡æ¯æ—¶, ä¸ä¼šç›´æ¥è¿›å…¥é•¿æ—¶è®°å¿†, è€Œæ˜¯é¦–å…ˆè¿›å…¥å®¹é‡æœ‰é™çš„çŸ­æ—¶è®°å¿†. çŸ­æ—¶è®°å¿†çš„å®¹é‡ä¼—è¯´çº·çº­, ä½†æ˜¯å¤§å¤šæ•°ç§‘å­¦å®¶è®¤ä¸ºè¿™ç§è®°å¿†åªèƒ½å­˜å‚¨å°‘é‡çš„ä¿¡æ¯å…ƒç´ , é€šå¸¸ä¸ä¼šè¶…è¿‡12ä¸ª. ä¾‹å¦‚, åœ¨é˜…è¯»ç¨‹åºæ—¶, å¤§è„‘ä¼šæŠŠç¨‹åºä½¿ç”¨çš„å…³é”®å­—ã€å˜é‡åå’Œæ•°æ®ç»“æ„æš‚æ—¶ä¿å­˜åœ¨çŸ­æ—¶è®°å¿†ä¸­.</li><li>å·¥ä½œè®°å¿†(working memory), å¦‚æœæŠŠé•¿æ—¶è®°å¿†æ¯”åšç¡¬ç›˜, çŸ­æ—¶è®°å¿†æ¯”åšå†…å­˜, é‚£ä¹ˆå·¥ä½œè®°å¿†å°±ç›¸å½“äºå¤§è„‘çš„â€œå¤„ç†å™¨â€. åœ¨é˜…è¯»ä»£ç çš„è¿‡ç¨‹ä¸­, å¤§è„‘è¿˜ä¼šè¿›è¡Œæ›´å¤šçš„æ´»åŠ¨. ç¨‹åºå‘˜ä¼šå°è¯•å¿ƒç®—å¹¶æ¢³ç†ä»£ç çš„æ‰§è¡Œç»“æœ, è¿™ä¸ªè¿‡ç¨‹ç§°ä¸º<strong>è¿½è¸ª</strong>, ä¹Ÿå°±æ˜¯åœ¨è„‘æµ·é‡Œç¼–è¯‘å¹¶æ‰§è¡Œä»£ç . å¤§è„‘å†…éƒ¨ç”¨äºè¿½è¸ªä»¥åŠè¿›è¡Œå…¶ä»–å¤æ‚è®¤çŸ¥æ´»åŠ¨çš„æœºåˆ¶ç§°ä¸ºå·¥ä½œè®°å¿†, è¿™ç§è®°å¿†ç›¸å½“äºè®¡ç®—æœºç”¨æ¥æ‰§è¡Œè®¡ç®—ä»»åŠ¡çš„å¤„ç†å™¨. å¦‚æœå¤§è„‘æ„Ÿè§‰éœ€è¦å€ŸåŠ©å¤–éƒ¨åª’ä»‹æ¥å­˜å‚¨ä¿¡æ¯, åˆ™å¯èƒ½æ„å‘³ç€å·¥ä½œè®°å¿†çš„è´Ÿæ‹…è¿‡é‡, éš¾ä»¥åŠ å·¥æ›´å¤šçš„ä¿¡æ¯.</li></ul><p>é•¿æ—¶è®°å¿†ã€çŸ­æ—¶è®°å¿†ã€å·¥ä½œè®°å¿†è¿™ä¸‰ç§è®¤çŸ¥è¿‡ç¨‹åœ¨é˜…è¯»ä»£ç çš„è¿‡ç¨‹ä¸­éƒ½ä¼šå‚ä¸ã€ç›¸è¾…ç›¸æˆ.</p><img src="/posts/823ad99a/image.png" class=""><h1>å°èŠ‚</h1><ul><li>ç¼ºä¹çŸ¥è¯†ä¼šå½±å“é•¿æ—¶è®°å¿†.</li><li>ç¼ºä¹ä¿¡æ¯ä¼šå½±å“çŸ­æ—¶è®°å¿†.</li><li>ç¼ºä¹åŠ å·¥èƒ½åŠ›ä¼šå½±å“å·¥ä½œè®°å¿†.</li></ul><h1>å¿«é€Ÿé˜…è¯»ä»£ç </h1><p>æé«˜å¿«é€ŸæŸ¥æ‰¾ç›¸å…³ä¿¡æ¯çš„èƒ½åŠ›æœ‰åŠ©äºå‡å°‘åå¤æµè§ˆä»£ç çš„æ¬¡æ•°. å¦‚æœä»£ç é˜…è¯»æ°´å¹³å¾ˆé«˜, é‚£ä¹ˆè¿˜å¯ä»¥é™ä½æµè§ˆä»£ç ä»¥æŸ¥æ‰¾å…¶ä»–ä¿¡æ¯çš„é¢‘ç‡. èŠ±åœ¨é˜…è¯»ä»£ç æ–¹é¢çš„æ—¶é—´è¶Šå°‘, ç•™ç»™ä¿®å¤é”™è¯¯æˆ–è€…æ·»åŠ æ–°åŠŸèƒ½çš„æ—¶é—´å°±è¶Šå¤š, ç¨‹åºå‘˜çš„æ•ˆç‡å› è€Œè¶Šé«˜.</p><h2 id="å¿«é€Ÿé˜…è¯»ä»£ç ">å¿«é€Ÿé˜…è¯»ä»£ç </h2><h2 id="å¼¥è¡¥è®°å¿†å®¹é‡ä¸è¶³çš„çŸ­æ¿">å¼¥è¡¥è®°å¿†å®¹é‡ä¸è¶³çš„çŸ­æ¿</h2><p>æ—¢ç„¶ç¼ºä¹ä¿¡æ¯ä¼šå½±å“çŸ­æ—¶è®°å¿†, å› ä¸ºçŸ­æ—¶è®°å¿†çš„å®¹é‡ååˆ†æœ‰é™. æƒ³åˆ°æå‡çŸ­æ—¶è®°å¿†çš„å®¹é‡å¹¶ä¸å®¹æ˜“, æˆ‘ä»¬æ›´åº”è¯¥å»æé«˜è‡ªå·±æŠŠé›¶æ•£çš„å°å—å˜æˆç»„å—(chunk), è™½ç„¶æˆ‘ä»¬èƒ½å¤ŸæŒæœ‰çš„ä¿¡æ¯ç´ æ²¡æœ‰å˜, ä½†æ˜¯å•ä¸ªä¿¡æ¯å…ƒç´ åŒ…å«çš„å†…å®¹æ›´ä¸°å¯Œ, æ›´é›†æˆ, æ›´æ¨¡å—åŒ–</p><h2 id="çœ‹åˆ°çš„ä»£ç æ¯”è¯»åˆ°çš„ä»£ç å¤š">çœ‹åˆ°çš„ä»£ç æ¯”è¯»åˆ°çš„ä»£ç å¤š</h2>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CSharpä¸­çš„å§”æ‰˜</title>
      <link href="/posts/4f9ac505/"/>
      <url>/posts/4f9ac505/</url>
      
        <content type="html"><![CDATA[<h1>å§”æ‰˜</h1><p>ä¸€ç¯‡å¾ˆå¥½çš„åšå®¢https://www.cnblogs.com/skysoot/archive/2012/04/05/2433639.html</p><p>C#ä¸­çš„å§”æ‰˜ç±»ä¼¼äºCæˆ–C++ä¸­çš„å‡½æ•°æŒ‡é’ˆã€‚å§”æ‰˜æ˜¯å­˜æœ‰å¯¹æŸä¸ªæ–¹æ³•çš„å¼•ç”¨çš„ä¸€ç§å¼•ç”¨ç±»å‹å˜é‡ï¼Œå¼•ç”¨å¯åœ¨è¿è¡Œæ—¶è¢«æ”¹å˜ã€‚</p><p>å§”æ‰˜ç‰¹åˆ«ç”¨äºå®ç°äº‹ä»¶å’Œå›è°ƒæ–¹æ³•ã€‚æ‰€æœ‰çš„å§”æ‰˜éƒ½æ´¾ç”Ÿè‡ª<code>System.Delegate</code>ç±»ã€‚</p><h2 id="ä»å®é™…é—®é¢˜å‡ºå‘æ¥ç†è§£å§”æ‰˜">ä»å®é™…é—®é¢˜å‡ºå‘æ¥ç†è§£å§”æ‰˜</h2><h3 id="å°†æ–¹æ³•ä½œä¸ºæ–¹æ³•çš„å‚æ•°">å°†æ–¹æ³•ä½œä¸ºæ–¹æ³•çš„å‚æ•°</h3><p>è¿™ä¸ªæ ‡é¢˜éå¸¸åœ°æ‹—å£ï¼Œä½†æˆ‘ä»¬å…ˆä¸ç®¡å®ƒï¼Œæ¥çœ‹ä¸¤ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GreetPeople</span>(<span class="params"><span class="built_in">string</span> name</span>)</span>&#123;</span><br><span class="line">EnglishGreeting(name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">EnglishGreeting</span>(<span class="params"><span class="built_in">string</span> name</span>)</span>&#123;</span><br><span class="line">  Console.WriteLine(<span class="string">&quot;Good Moring,&quot;</span> + name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆä¸ç®¡è¿™ä¸¤ä¸ªæ–¹æ³•æœ‰æ²¡æœ‰å®é™…çš„æ„ä¹‰ï¼Œæˆ‘ä»¬ç°åœ¨æƒ³é€šè¿‡è¿™ä¸¤ä¸ªæ–¹æ³•æ¥å‘æŸäººé—®å¥½ï¼Œå½“ä¼ å…¥æŸäººçš„å§“åæ—¶ï¼Œæ¯”å¦‚è¯´&quot;Joe&quot;è¿›å»çš„æ—¶å€™ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­å°†è°ƒç”¨EnglishGreetingæ–¹æ³•ï¼Œå†æ¬¡ä¼ é€’nameå‚æ•°ï¼ŒEnglishGreetingæ–¹æ³•åˆ™ç”¨äºå‘å±å¹•è¾“å‡º&quot;Good Moring, Joe&quot;ã€‚</p><p>é‚£ä¹ˆç°åœ¨ï¼Œå‡è®¾è¿™ä¸ªç¨‹åºè¦è¿›è¡Œå…¨çƒåŒ–äº†ï¼Œæˆ‘ä½œä¸ºä¸€ä¸ªä¸­å›½äººï¼Œæˆ‘ä¸ç†è§£&quot;Good Moring&quot;æ˜¯ä»€ä¹ˆæ„æ€ï¼Œé‚£æˆ‘å°±åªèƒ½å†åŠ ä¸€ä¸ªä¸­æ–‡çš„é—®å€™æ–¹æ³•ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ChineseGreeting</span>(<span class="params"><span class="built_in">string</span> name</span>)</span>&#123;</span><br><span class="line">Console.WriteLine(<span class="string">&quot;æ—©ä¸Šå¥½ï¼Œ&quot;</span>+name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™GreetPeopleä¹Ÿéœ€è¦æ”¹ä¸€ä¸‹äº†ï¼Œä¸ç„¶å¦‚ä½•åˆ¤æ–­åˆ°åº•ç”¨å“ªä¸ªç‰ˆæœ¬çš„Greetingé—®å€™æ–¹æ³•åˆé€‚å‘¢ï¼Ÿå½“ç„¶åœ¨è¿›è¡Œè¿™ä¸ªä¹‹å‰ï¼Œæˆ‘ä»¬æœ€å¥½å†å®šä¹‰ä¸€ä¸ªæšä¸¾ä½œä¸ºåˆ¤æ–­çš„ä¾æ®ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> Language&#123;</span><br><span class="line">English, Chinese</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GreetPeople</span>(<span class="params"><span class="built_in">string</span> name, Language lang</span>)</span>&#123;</span><br><span class="line"><span class="keyword">switch</span>(lang)&#123;</span><br><span class="line"><span class="keyword">case</span> Language.English:</span><br><span class="line">EnglishGreeting(name);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> Language.Chinese:</span><br><span class="line">    ChineseGreeting(name);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>OKï¼Œå°½ç®¡è¿™æ ·è§£å†³äº†é—®é¢˜ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•çš„å¯æ‰©å±•æ€§å¤ªå·®äº†ï¼Œå¦‚æœä¹‹åæˆ‘ä»¬è¿˜è¦å†æ·»åŠ éŸ©æ–‡ç‰ˆã€æ—¥æ–‡ç‰ˆï¼Œæˆ‘ä»¬å°±ä¸å¾—ä¸åå¤ä¿®æ”¹æšä¸¾å’ŒGreetPeopleçš„æ–¹æ³•ï¼Œæ¥é€‚åº”æ–°çš„éœ€æ±‚ã€‚</p><p>é‚£ä¹ˆåœ¨è€ƒè™‘æ–°çš„è§£å†³æ–¹æ¡ˆä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹GreetPeopleçš„æ–¹æ³•ç­¾åï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GreetPeople</span>(<span class="params"><span class="built_in">string</span> name, Language lang</span>)</span>;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åªçœ‹<code>string name</code>ï¼Œåœ¨è¿™é‡Œï¼Œstringæ˜¯å‚æ•°ç±»å‹ï¼Œnameæ˜¯å‚æ•°å˜é‡ï¼Œå½“æˆ‘ä»¬èµ‹ç»™nameå­—ç¬¦ä¸²&quot;Joe&quot;æ—¶ï¼Œä»–å°±ä»£è¡¨äº†&quot;Joe&quot;è¿™ä¸ªå€¼ï¼›å½“æˆ‘ä»¬èµ‹ç»™ä»–&quot;å‘¨æ°ä¼¦&quot;æ—¶ï¼Œå®ƒåˆä»£è¡¨ç€&quot;å‘¨æ°ä¼¦&quot;è¿™ä¸ªå€¼ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä½“å†…å¯¹è¿™ä¸ªnameè¿›è¡Œå…¶ä»–çš„æ“ä½œã€‚</p><p>é‚£æˆ‘ä»¬å†ä»”ç»†æƒ³ä¸€æƒ³ï¼Œå‡å¦‚GreetPeopleæ–¹æ³•å¯ä»¥æ¥å—ä¸€ä¸ªå‚æ•°å˜é‡ï¼Œè¿™ä¸ªå˜é‡å¯ä»¥ä»£è¡¨å¦ä¸€ä¸ªæ–¹æ³•ï¼Œå½“æˆ‘ä»¬ç»™è¿™ä¸ªå˜é‡èµ‹å€¼EnglishGreetingçš„æ—¶å€™å®ƒä»£è¡¨ç€EnglishGreeting()è¿™ä¸ªæ–¹æ³•ï¼›å½“æˆ‘ä»¬ç»™å®ƒèµ‹å€¼ChineseGreetingçš„æ—¶å€™ï¼Œå®ƒåˆä»£è¡¨ç€ChineseGreeting()çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªå‚æ•°å˜é‡å‘½åä¸ºMakeGreetingï¼Œé‚£ä¹ˆä¸æ˜¯å¯ä»¥å¦‚åŒç»™nameèµ‹å€¼çš„æ—¶å€™ä¸€æ ·ï¼Œåœ¨è°ƒç”¨Greet People()æ–¹æ³•çš„æ—¶å€™ï¼Œç»™è¿™ä¸ªMakeGreetingå‚æ•°ä¹Ÿé™„ä¸Šå€¼ä¹ˆï¼Œç„¶åæˆ‘ä»¬åœ¨æ–¹æ³•ä½“å†…ï¼Œä¹Ÿå¯ä»¥åƒä½¿ç”¨åˆ«çš„å‚æ•°ä¸€æ ·ä½¿ç”¨MakeGreetingã€‚ä½†æ˜¯ï¼Œç”±äºMakeGreetingä»£è¡¨ç€ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒçš„ä½¿ç”¨æ–¹å¼åº”è¯¥å’Œå®ƒè¢«èµ‹çš„æ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œæ¯”å¦‚<code>MakeGreeting(name)</code>ï¼›</p><p>å¥½äº†ï¼Œæœ‰äº†æ€è·¯äº†ï¼Œæˆ‘ä»¬ç°åœ¨å°±æ¥æ”¹æ”¹GreetPeople()æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥æ˜¯è¿™ä¸ªæ ·å­ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GreetPeople</span>(<span class="params"><span class="built_in">string</span> name, *** MakeGreeting</span>)</span>&#123;</span><br><span class="line">MakeGreeting(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ° ***ï¼Œè¿™ä¸ªä½ç½®é€šå¸¸æ”¾ç½®çš„åº”è¯¥æ˜¯å‚æ•°çš„ç±»å‹ï¼Œä½†æ˜¯åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä»…ä»…æƒ³åˆ°çš„æ˜¯åº”è¯¥æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”æŒ‰ç…§è¿™ä¸ªæ€è·¯å»æ”¹å†™GreetPeopleæ–¹æ³•ï¼Œç°åœ¨å°±å‡ºç°äº†ä¸€ä¸ªå¤§é—®é¢˜ï¼šè¿™ä¸ªä»£è¡¨ç€æ–¹æ³•çš„MakeGreetingå‚æ•°åº”è¯¥æ˜¯ä»€ä¹ˆç±»å‹çš„ï¼Ÿ</p><p>**è¯´æ˜ï¼š**è¿™é‡Œå·²ç»ä¸å†éœ€è¦æšä¸¾äº†ï¼Œå› ä¸ºåœ¨ç»™MakeGreetingèµ‹å€¼çš„æ—¶å€™åŠ¨æ€åœ°å†³å®šä½¿ç”¨å“ªä¸ªæ–¹æ³•ï¼Œæ˜¯ChineseGreetingè¿˜æ˜¯EnglishGreetingï¼Œè€Œåœ¨è¿™ä¸¤ä¸ªæ–¹æ³•å†…éƒ¨ï¼Œå·²ç»å¯¹ä½¿ç”¨GroodMoringè¿˜æ˜¯æ—©ä¸Šå¥½åšäº†åŒºåˆ†ã€‚</p><p>ä¸‹é¢å°±è¯¥å§”æ‰˜å‡ºåœºäº†ï¼š</p><p>æˆ‘ä»¬MakeGreetingä»£è¡¨çš„ä¸¤ä¸ªæ–¹æ³•çš„ç­¾åå¦‚ä¸‹ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">EnglishGreeting</span>(<span class="params"><span class="built_in">string</span> name</span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">chineseGreeting</span>(<span class="params"><span class="built_in">string</span> name</span>)</span>;</span><br></pre></td></tr></table></figure><p>å¦‚åŒ<code>name</code>å¯ä»¥æ¥å—stringç±»å‹çš„æ•°æ®ä¸€æ ·ï¼ŒMakeGreetingå®ƒä¹Ÿä»£è¡¨ç€æ¥å—ç›¸åŒçš„ä¸€ç±»æ•°æ®ï¼Œå†è¿›ä¸€æ­¥è®²ï¼Œå°±æ˜¯MakeGreetingä»£è¡¨äº†å‚æ•°ç±»å‹å’Œè¿”å›ç±»å‹éƒ½ç›¸åŒçš„ä¸€ç±»æ–¹æ³•ã€‚æœ¬ä¾‹ä¸­å§”æ‰˜çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">GreetingDelegate</span>(<span class="params"><span class="built_in">string</span> name</span>)</span>;</span><br></pre></td></tr></table></figure><p>ä¸ä¸Šé¢EnglishGreeting()æ–¹æ³•çš„ç­¾åå¯¹æ¯”ä¸€ä¸‹ï¼Œå‡ºäº†åŠ å…¥delegateå…³é”®å­—ä»¥å¤–ï¼Œå…¶ä»–çš„éƒ¨åˆ†éƒ½æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œé‚£ä¹ˆå†æ¬¡è°ƒç”¨GreetPeopleæ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">Greetingdelegate</span>(<span class="params"><span class="built_in">string</span> name</span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GreetPeople</span>(<span class="params"><span class="built_in">string</span> name, Greetingdelegate MakeGreeting</span>)</span>&#123;</span><br><span class="line">MakeGreeting(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å§”æ‰˜Greeting Delegatå‡ºç°çš„ä½ç½®å’Œstringç›¸åŒï¼Œstringæ˜¯ä¸€ä¸ªç±»å‹ï¼ŒGreeting Delegateä¹Ÿæ˜¯ä¸€ä¸ªç±»å‹ï¼Œæˆ–è€…è¯´æ˜¯ä¸€ä¸ªç±»ã€‚ä½†æ˜¯å§”æ‰˜çš„å£°æ˜æ–¹å¼å’Œç±»å®Œå…¨ä¸åŒã€‚å®é™…ä¸Šï¼Œå§”æ‰˜åœ¨ç¼–è¯‘çš„æ—¶å€™ç¡®å®ä¼šè¢«ç¼–è¯‘æˆç±»ã€‚å› ä¸ºDelegateæ˜¯ä¸€ä¸ªç±»ï¼Œæ‰€ä»¥åœ¨ä»»ä½•å¯ä»¥å£°æ˜ç±»çš„åœ°æ–¹éƒ½å¯ä»¥å£°æ˜å§”æ‰˜ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä»£ç ã€‚</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">GreetingDelegate</span>(<span class="params"><span class="built_in">string</span> name</span>)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">EnglishGreeting</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Good Morning, &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ChineseGreeting</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æ—©ä¸Šå¥½, &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">GreetPeople</span>(<span class="params"><span class="built_in">string</span> name, GreetingDelegate MakeGreeting</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        MakeGreeting(name);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        GreetPeople(<span class="string">&quot;Joe&quot;</span>, EnglishGreeting);</span><br><span class="line">        GreetPeople(<span class="string">&quot;å‘¨æ°ä¼¦&quot;</span>, ChineseGreeting);</span><br><span class="line">        Console.ReadLine();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“åˆæ¸¸æˆå¼€å‘ä¸­çš„å®é™…åº”ç”¨ï¼Œæˆ‘ä»¬ç»å¸¸è®²å§”æ‰˜å’Œå•ä¾‹æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼ç­‰è®¾è®¡æ¨¡å¼ç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ï¼Œä¸‹é¢æˆ‘å°†å°è¯•æŠ½è±¡å‡ºä¸€ä¸ªäº‹ä»¶ä¸­å¿ƒçš„ç±»ï¼Œå®ƒä¸“é—¨è´Ÿè´£å¤„ç†å„ç§å§”æ‰˜äº‹ä»¶ï¼Œç”±äºåœ¨ä¸€ä¸ªæ¸¸æˆè¿›ç¨‹ä¸­åªä¼šæœ‰ä¸€ä¸ª<strong>äº‹ä»¶å¤„ç†ä¸­å¿ƒ</strong>ï¼Œæ‰€ä»¥æˆ‘è¦å°†å®ƒè®¾è®¡æˆ<a href="http://soincredible777.com.cn/posts/279644bd/">å•ä¾‹æ¨¡å¼</a>ã€‚</p><p><strong>æˆ‘ä»¬ç°åœ¨å¯¹å§”æ‰˜åšä¸€ä¸ªæ€»ç»“ï¼šå§”æ‰˜æ˜¯ä¸€ä¸ªç±»ï¼Œå®ƒå®šä¹‰äº†æ–¹æ³•çš„ç±»å‹ï¼Œä½¿å¾—å¯ä»¥å°†æ–¹æ³•ä½œä¸ºå¦ä¸€ä¸ªæ–¹æ³•çš„å‚æ•°æ¥è¿›è¡Œä¼ é€’ï¼Œè¿™ç§å°†æ–¹æ³•åŠ¨æ€åœ°èµ‹ç»™å‚æ•°çš„åšæ³•ï¼Œå¯ä»¥é¿å…åœ¨ç¨‹åºä¸­å¤§é‡åœ°ä½¿ç”¨if-else(switch)è¯­å¥ï¼ŒåŒæ—¶ä½¿å¾—ç¨‹åºå…·æœ‰æ›´å¥½çš„å¯æ‰©å±•æ€§ã€‚</strong></p><h2 id="å£°æ˜å§”æ‰˜">å£°æ˜å§”æ‰˜</h2><p>å§”æ‰˜å£°æ˜å†³å®šäº†å¯ç”±è¯¥å§”æ‰˜å¼•ç”¨çš„æ–¹æ³•ã€‚å§”æ‰˜å¯æŒ‡å‘ä¸€ä¸ªä¸å…¶å…·æœ‰ç›¸åŒæ ‡ç­¾çš„æ–¹æ³•ã€‚</p><p>å‡è®¾æœ‰ä¸€ä¸ªå§”æ‰˜ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="built_in">int</span> <span class="title">MyDelegate</span>(<span class="params"><span class="built_in">string</span> s</span>)</span>;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„å§”æ‰˜å¯è¢«ç”¨äºå¼•ç”¨ä»»ä½•ä¸€ä¸ªå¸¦æœ‰ä¸€ä¸ªå•ä¸€çš„stringå‚æ•°çš„æ–¹æ³•ï¼Œå¹¶è¿”å›ä¸€ä¸ªint ç±»å‹çš„å˜é‡ã€‚</p><p>å£°æ˜å§”æ‰˜çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">delegate</span> &lt;<span class="keyword">return</span> type&gt;&lt;<span class="built_in">delegate</span>-name&gt;&lt;parameter list&gt;</span><br></pre></td></tr></table></figure><h2 id="å®ä¾‹åŒ–å§”æ‰˜">å®ä¾‹åŒ–å§”æ‰˜</h2><p>ä¸€æ—¦å£°æ˜äº†å§”æ‰˜ç±»å‹ï¼Œå§”æ‰˜å¯¹è±¡å°±å¿…é¡»ä½¿ç”¨newå…³é”®å­—æ¥åˆ›å»ºï¼Œå¹¶ä¸”ä¸ä¸€ä¸ªç‰¹å®šçš„æ–¹æ³•æœ‰å…³ï¼Œå½“å§”æ‰˜åˆ›å»ºæ—¶ï¼Œä¼ é€’åˆ°newè¯­å¥çš„å‚æ•°å°±åƒæ–¹æ³•è°ƒç”¨ä¸€æ ·ä¹¦å†™ï¼Œä½†æ˜¯ä¸å¸¦æœ‰å‚æ•°ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">printString</span>(<span class="params"><span class="built_in">string</span> s</span>)</span>;</span><br><span class="line">pringString ps1 = <span class="keyword">new</span> printString(WriteToScreen);</span><br><span class="line">printString ps2 = <span class="keyword">new</span> printString(WriteToFile);</span><br></pre></td></tr></table></figure><p>ä¸‹é¢çš„å®ä¾‹æ¼”ç¤ºäº†å§”æ‰˜çš„å£°æ˜ã€å®ä¾‹åŒ–å’Œä½¿ç”¨ï¼Œè¯¥å§”æ‰˜å¯ç”¨äºå¼•ç”¨å¸¦æœ‰ä¸€ä¸ªæ•´å½¢å‚æ•°çš„æ–¹æ³•ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ•´å‹å€¼ã€‚</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">delegate</span> <span class="built_in">int</span> <span class="title">NumberChanger</span>(<span class="params"><span class="built_in">int</span> n</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DelegateAppl</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">TestDelegate</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">int</span> num = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">AddNum</span>(<span class="params"><span class="built_in">int</span> p</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            num += p;</span><br><span class="line">            <span class="keyword">return</span> num;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">MultNum</span>(<span class="params"><span class="built_in">int</span> q</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            num *= q;</span><br><span class="line">            <span class="keyword">return</span> num;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">getNum</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> num;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            NumberChanger nc1 = <span class="keyword">new</span> NumberChanger(AddNum);</span><br><span class="line">            NumberChanger nc2 = <span class="keyword">new</span> NumberChanger(MultNum);</span><br><span class="line">            nc1(<span class="number">25</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Value of Num: &#123;0&#125;&quot;</span>, getNum());</span><br><span class="line">            nc2(<span class="number">5</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Value of Num: &#123;0&#125;&quot;</span>, getNum());</span><br><span class="line">            Console.ReadKey();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ä¸Šé¢ä»£ç è¢«ç¼–è¯‘å’Œæ‰§è¡Œçš„æ—¶å€™ï¼Œå®ƒä¼šäº§ç”Ÿå¦‚ä¸‹ç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Value of Num: 35</span><br><span class="line">Value of Num: 175</span><br></pre></td></tr></table></figure><p><strong>è¡¥å……ï¼š</strong></p><ol><li>å§”æ‰˜é‡Œé¢å­˜å‚¨çš„æ–¹æ³•å¯ä»¥æ˜¯é™æ€æ–¹æ³•ä¹Ÿå¯ä»¥æ˜¯éé™æ€çš„æ–¹æ³•ã€‚</li><li>å½“å£°æ˜çš„å§”æ‰˜åŒ…å«è¿”å›å€¼çš„æ—¶å€™ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨Invokeæ–¹æ³•ï¼Œå¦åˆ™åªä¼šå¾—åˆ°æœ€åä¸€ä¸ªæ–¹æ³•çš„ç»“æœã€‚</li><li>å®šä¹‰å§”æ‰˜ä¸å®šä¹‰æ–¹æ³•ç›¸æ¯”ï¼Œä¸€æ˜¯æ²¡æœ‰æ–¹æ³•ä½“ï¼Œè€Œæ˜¯å¤šç”¨äº†delegateä¿®é¥°ã€‚</li></ol><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="built_in">int</span> <span class="title">MyDelegate</span>(<span class="params"><span class="built_in">int</span> a, <span class="built_in">int</span> b</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">Test1</span>(<span class="params"><span class="built_in">int</span> a, <span class="built_in">int</span> b</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> a * b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">Test2</span>(<span class="params"><span class="built_in">int</span> a, <span class="built_in">int</span> b</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Program program = <span class="keyword">new</span> Program();</span><br><span class="line">        MyDelegate myDelegate = <span class="keyword">new</span> MyDelegate(program.Test1);</span><br><span class="line">        myDelegate += program.Test2;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// å°†delegateå­˜æ”¾åˆ°ä¸€ä¸ªæ•°ç»„ä¸­æ‰èƒ½ä¾æ¬¡è·å–æ¯ä¸€ä¸ªæ–¹æ³•çš„è¿”å›å€¼ã€‚</span></span><br><span class="line">        Delegate[] delegates = myDelegate.GetInvocationList();</span><br><span class="line">        <span class="keyword">foreach</span> (MyDelegate item <span class="keyword">in</span> delegates)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(item(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Console.ReadKey();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å§”æ‰˜çš„å¤šæ’­-Multicasting-of-a-Delegate">å§”æ‰˜çš„å¤šæ’­(Multicasting of a Delegate)</h2><p>å§”æ‰˜å¯¹è±¡å¯ä»¥ä½¿ç”¨&quot;+â€œè¿ç®—ç¬¦è¿›è¡Œåˆå¹¶ã€‚ä¸€ä¸ªåˆå¹¶å§”æ‰˜è°ƒç”¨å®ƒæ‰€åˆå¹¶çš„ä¸¤ä¸ªå§”æ‰˜ã€‚åªæœ‰ç›¸åŒç±»å‹çš„å§”æ‰˜å¯ä»¥è¢«åˆå¹¶ã€‚â€-&quot;è¿ç®—ç¬¦å¯ç”¨äºä»åˆå¹¶çš„å§”æ‰˜ä¸­ç§»é™¤ç»„ä»¶å§”æ‰˜ã€‚</p><p>ä½¿ç”¨å§”æ‰˜çš„è¿™ä¸ªç‰¹ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå§”æ‰˜è¢«è°ƒç”¨æ—¶è¦è°ƒç”¨çš„æ–¹æ³•çš„è°ƒç”¨åˆ—è¡¨ï¼Œè¿™ç§è¡Œä¸ºè¢«ç§°ä¸ºå§”æ‰˜çš„å¤šæ’­(multicasting)ï¼Œä¹Ÿå«ç»„æ’­ã€‚ä¸‹é¢çš„ç¨‹åºæ¼”ç¤ºäº†å§”æ‰˜çš„å¤šæ’­ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">delegate</span> <span class="built_in">int</span> <span class="title">NumberChanger</span>(<span class="params"><span class="built_in">int</span> n</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DelegateAppl</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">testdelegate</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">int</span> num = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">AddNum</span>(<span class="params"><span class="built_in">int</span> p</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            num += p;</span><br><span class="line">            <span class="keyword">return</span> num;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">MultNum</span>(<span class="params"><span class="built_in">int</span> q</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            num *= q;</span><br><span class="line">            <span class="keyword">return</span> num;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">getNum</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> num;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            NumberChanger nc;</span><br><span class="line">            NumberChanger nc1 = <span class="keyword">new</span> NumberChanger(AddNum);</span><br><span class="line">            NumberChanger nc2 = <span class="keyword">new</span> NumberChanger(MultNum);</span><br><span class="line"></span><br><span class="line">            nc = nc1;</span><br><span class="line">            nc += nc2;</span><br><span class="line">            nc += AddNum;</span><br><span class="line">            nc(<span class="number">5</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Value of Num: &#123;0&#125;&quot;</span>, getNum());</span><br><span class="line">            Console.ReadKey();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å§”æ‰˜çš„ç”¨é€”">å§”æ‰˜çš„ç”¨é€”</h2><p>ä¸‹é¢å®é™…æ¼”ç¤ºäº†å§”æ‰˜çš„ç”¨æ³•ï¼Œå§”æ‰˜<code>printString</code>å¯ç”¨äºå¼•ç”¨å¸¦æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºè¾“å…¥çš„æ–¹æ³•ï¼Œå¹¶ä¸è¿”å›ä»»ä½•ä¸œè¥¿ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªå§”æ‰˜æ¥è°ƒç”¨ä¸¤ä¸ªæ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªæŠŠå­—ç¬¦ä¸²æ‰“å°åˆ°æ§åˆ¶å°ï¼Œç¬¬äºŒä¸ªæŠŠå­—ç¬¦ä¸²æ‰“å°åˆ°æ–‡ä»¶ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DelegateAppl</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">PrintString</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> FileStream fs;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> StreamWriter sw;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">printString</span>(<span class="params"><span class="built_in">string</span> s</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">WriteToScreen</span>(<span class="params"><span class="built_in">string</span> str</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;The String is:&#123;0&#125;&quot;</span>, str);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">WriteToFile</span>(<span class="params"><span class="built_in">string</span> s</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            fs = <span class="keyword">new</span> FileStream(<span class="string">&quot;./message.txt&quot;</span>, FileMode.Append, FileAccess.Write);</span><br><span class="line">            sw = <span class="keyword">new</span> StreamWriter(fs);</span><br><span class="line">            sw.WriteLine(s);</span><br><span class="line">            sw.Flush();</span><br><span class="line">            sw.Close();</span><br><span class="line">            fs.Close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sendString</span>(<span class="params">printString ps</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            ps(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            printString ps1 = <span class="keyword">new</span> printString(WriteToScreen);</span><br><span class="line">            printString ps2 = <span class="keyword">new</span> printString(WriteToFile);</span><br><span class="line">            sendString(ps1);</span><br><span class="line">            sendString(ps2);</span><br><span class="line">            Console.ReadKey();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>äº‹ä»¶</h1><p>äº‹ä»¶åŸºæœ¬ä¸Šè¯´æ˜¯ä¸€ä¸ªç”¨æˆ·çš„æ“ä½œï¼Œæ¯”å¦‚æŒ‰é”®ã€ç‚¹å‡»ã€é¼ æ ‡ç§»åŠ¨ç­‰ç­‰ï¼Œæˆ–è€…æ˜¯ä¸€äº›æç¤ºä¿¡æ¯ï¼Œå¦‚ç³»ç»Ÿç”Ÿæˆçš„é€šçŸ¥ã€‚åº”ç”¨ç¨‹åºéœ€è¦åœ¨äº‹ä»¶å‘ç”Ÿæ—¶å“åº”äº‹ä»¶ï¼Œæ¯”å¦‚ä¸­æ–­ã€‚</p><p>C#ä¸­ä½¿ç”¨äº‹ä»¶æœºåˆ¶å®ç°çº¿ç¨‹é—´çš„é€šä¿¡ã€‚</p><p>äº‹ä»¶æ˜¯ä¸€ä¸ªå—é™åˆ¶çš„å§”æ‰˜ï¼Œå…ˆçœ‹å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">MyDelegate</span>()</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">MyDelegateClass</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> MyDelegate? myDelegate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (myDelegate != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            myDelegate();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Test</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        MyDelegateClass delegateClass = <span class="keyword">new</span> MyDelegateClass();</span><br><span class="line">        delegateClass.myDelegate += Run;</span><br><span class="line">        delegateClass.myDelegate.Invoke();</span><br><span class="line">        delegateClass.Test();</span><br><span class="line">        delegateClass.myDelegate = <span class="keyword">new</span> MyDelegate(Run);</span><br><span class="line">        delegateClass.myDelegate();</span><br><span class="line"></span><br><span class="line">        Console.ReadKey();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Run</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Running.......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç è¿è¡Œæ—¶æ²¡æœ‰é—®é¢˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨MyDelegateClassä¸­å£°æ˜çš„å§”æ‰˜ï¼Œæ—¢å¯ä»¥åœ¨å½“å‰ç±»ä¸­æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨å…¶ä»–çš„ç±»ä¸­æ‰§è¡Œï¼Œè¿˜å¯ä»¥åœ¨å…¶ä»–çš„ç±»ä¸­é‡æ–°èµ‹å€¼åå†è¢«è°ƒç”¨æ‰§è¡Œã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹äº‹ä»¶å£°æ˜çš„æƒ…å†µï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">MyDelegate</span>()</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">MyDelegateClass</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">event</span> MyDelegate? myDelegate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (myDelegate != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            myDelegate();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Test</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        MyDelegateClass delegateClass = <span class="keyword">new</span> MyDelegateClass();</span><br><span class="line">        delegateClass.myDelegate += Run;</span><br><span class="line">        delegateClass.myDelegate.Invoke();</span><br><span class="line">        delegateClass.Test();</span><br><span class="line">        delegateClass.myDelegate = <span class="keyword">new</span> MyDelegate(Run);</span><br><span class="line">        delegateClass.myDelegate();</span><br><span class="line"></span><br><span class="line">        Console.ReadKey();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Run</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Running.......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°å£°æ˜äº‹ä»¶å…¶å®å°±æ˜¯åœ¨å£°æ˜å§”æ‰˜å˜é‡çš„æ¡ä»¶ä¸‹ï¼Œåªç”¨äº†ä¸ª<code>event</code>ä¿®é¥°è€Œå·²ï¼Œå³<code>myDelegate</code>ç°åœ¨æ˜¯ä¸€ä¸ªäº‹ä»¶å˜é‡ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå§”æ‰˜å˜é‡äº†ï¼Œæˆ‘ä»¬å‘ç°å®ƒä»ç„¶èƒ½åœ¨å½“å‰ç±»ä¸­è¢«æ‰§è¡Œï¼Œä½†æ˜¯åœ¨å¦å¤–çš„ä¸€ä¸ªç±»ä¸­ï¼Œæ—¢ä¸èƒ½è¢«ç›´æ¥è°ƒç”¨æ‰§è¡Œï¼Œä¹Ÿä¸èƒ½è¢«é‡æ–°èµ‹å€¼äº†ï¼Œåªèƒ½é€šè¿‡<code>+=</code>æˆ–è€…<code>-=</code>æ¥å¢å‡å‡½æ•°ï¼Œè¿™å°±æ˜¯äº‹ä»¶å­˜åœ¨çš„å¿…è¦ï¼Œå› ä¸ºäº‹ä»¶çš„è¿™ä¸¤ä¸ªé™åˆ¶æ¡ä»¶ï¼Œåœ¨æŸç§ç¨‹åº¦ä¸Šä¼šæ›´å®‰å…¨ã€‚</p><p>**ç–‘é—®ï¼š**å¦‚æœæˆ‘åœ¨ç±»ä¸­å£°æ˜äº†ä¸€ä¸ªå§”æ‰˜ï¼Œé‚£ä¹ˆåœ¨å®ä¾‹åŒ–è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œæˆ‘å¹¶æ²¡æœ‰æ˜¾å¼åœ°ç»™ç»™è¿™ä¸ªå§”æ‰˜èµ‹å€¼ï¼Œ<s>ä¸ºä»€ä¹ˆä¸ä¼šæŠ¥é”™å‘¢</s>ï¼Ÿä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨Mainå‡½æ•°ä¸­å®ä¾‹åŒ–ä¸€ä¸ªå§”æ‰˜ï¼Œä¸ç»™ä»–èµ‹å€¼çš„è¯ï¼Œå°±ä¼šæŠ¥é”™ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p><p>ä¸‹é¢çš„ä»£ç ç»™å‡ºäº†ç­”æ¡ˆï¼Œä¸Šé¢è¯´çš„ä¸¤ç§æƒ…å†µéƒ½ä¼šæŠ¥é”™çš„ï¼Œä½†æ˜¯åœ¨å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™è¿˜éœ€è¦æ‰‹åŠ¨åœ°åŠ ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶ï¼Œåˆ¤æ–­å®ä¾‹åŒ–çš„å¯¹è±¡ä¸­çš„å§”æ‰˜æ˜¯ä¸æ˜¯ç©ºçš„ã€‚</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">MyDelegate</span>()</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">MyDelegateClass</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">protected</span> MyDelegate? myDelegate;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RegitserDelegate</span>(<span class="params">MyDelegate mmm</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        myDelegate += mmm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">InvokeDelegate</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (myDelegate == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;å§”æ‰˜æ˜¯ç©ºçš„ï¼ä¸èƒ½è°ƒç”¨ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            myDelegate.Invoke();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Run</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Running.......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Func</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        MyDelegateClass delegateClass = <span class="keyword">new</span> MyDelegateClass();</span><br><span class="line">        delegateClass.InvokeDelegate();</span><br><span class="line">        MyDelegate mm = <span class="keyword">new</span> MyDelegate(MyDelegateClass.Run);</span><br><span class="line">        delegateClass.RegitserDelegate(mm);</span><br><span class="line">        delegateClass.InvokeDelegate();</span><br><span class="line">        Console.ReadKey();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ä¸­ç”¨åˆ°äº†ä¸€äº›è®¿é—®ä¿®é¥°ç¬¦</p><ul><li><code>public</code>: å…¬æœ‰è®¿é—®ï¼Œä¸å—ä»»ä½•é™åˆ¶</li><li><code>private</code>: ç§æœ‰è®¿é—®ï¼Œåªé™äºæœ¬ç±»æˆå‘˜è®¿é—®ï¼Œå­ç±»ã€å®ä¾‹éƒ½ä¸èƒ½è®¿é—®</li><li><code>protected</code>: ä¿æŠ¤è®¿é—®ï¼Œåªé™äºæœ¬ç±»å’Œå­ç±»è®¿é—®ï¼Œå®ä¾‹ä¸èƒ½è®¿é—®</li><li><code>internal</code>: å†…éƒ¨è®¿é—®ï¼Œ åªé™äºæœ¬é¡¹ç›®å†…è®¿é—®ï¼Œå…¶ä»–ä¸èƒ½è®¿é—®</li></ul><p>**TIPSï¼š**åœ¨è®¡ç®—æœºç§‘å­¦é¢†åŸŸï¼Œ<code>å£°æ˜(Decalration)</code>æŒ‡çš„æ˜¯å‘ç¼–è¯‘å™¨è¯´æ˜ä¸€ä¸ªå˜é‡æˆ–è€…å‡½æ•°ä¿¡æ¯ï¼ŒåŒ…æ´»ï¼šåå­—ã€ç±»å‹ã€åˆå§‹å€¼ç­‰ç­‰ï¼Œå³å£°æ˜å˜é‡ã€å‡½æ•°çš„å±æ€§ç»†èŠ‚ï¼›è€Œ<code>å®šä¹‰(Definition)</code>åˆ™æŒ‡æ˜å˜é‡ã€å‡½æ•°å­˜å‚¨åœ¨å“ªé‡Œï¼Œå½“å®šä¹‰å‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿä¸ºå˜é‡æˆ–è€…å‡½æ•°åˆ†é…å†…å­˜å•å…ƒã€‚</p><h2 id="é€šè¿‡äº‹ä»¶ä½¿ç”¨å§”æ‰˜">é€šè¿‡äº‹ä»¶ä½¿ç”¨å§”æ‰˜</h2><p>äº‹ä»¶åœ¨ç±»ä¸­å£°æ˜ä¸”ç”Ÿæˆï¼Œä¸”é€šè¿‡ä½¿ç”¨åŒä¸€ä¸ªç±»æˆ–è€…å…¶ä»–ç±»ä¸­çš„å§”æ‰˜ä¸äº‹ä»¶å¤„ç†ç¨‹åºå…³è”ã€‚åŒ…å«äº‹ä»¶çš„ç±»ç”¨äºå‘å¸ƒäº‹ä»¶ï¼Œå®ƒè¢«ç§°ä¸ºå‘å¸ƒå™¨(publisher)ç±»ã€‚å…¶ä»–æ¥å—è¯¥äº‹ä»¶çš„ç±»è¢«ç§°ä¸ºè®¢é˜…å™¨(subscriber)ç±»ã€‚äº‹ä»¶ä½¿ç”¨å‘å¸ƒ-è®¢é˜…(publisher-subscriber)æ¨¡å‹ã€‚</p><p>å‘å¸ƒå™¨(publisher)æ˜¯ä¸€ä¸ªåŒ…å«äº‹ä»¶å’Œå§”æ‰˜å®šä¹‰çš„å¯¹è±¡ã€‚äº‹ä»¶å’Œå§”æ‰˜ä¹‹é—´çš„è”ç³»ä¹Ÿå®šä¹‰åœ¨è¿™ä¸ªå¯¹è±¡ä¸­ã€‚å‘å¸ƒå™¨ç±»çš„å¯¹è±¡è°ƒç”¨è¿™ä¸ªäº‹ä»¶ï¼Œå¹¶é€šçŸ¥å…¶ä»–çš„å¯¹è±¡ã€‚</p><p>è®¢é˜…å™¨(subscriber)æ˜¯ä¸€ä¸ªæ¥å—äº‹ä»¶å¹¶æä¾›äº‹ä»¶å¤„ç†ç¨‹åºçš„å¯¹è±¡ã€‚åœ¨å‘å¸ƒå™¨ç±»ä¸­çš„å§”æ‰˜è°ƒç”¨è®¢é˜…å™¨ç±»ä¸­ã€‚</p><h2 id="å£°æ˜äº‹ä»¶-Event">å£°æ˜äº‹ä»¶(Event)</h2><p>åœ¨ç±»çš„å†…éƒ¨å£°æ˜äº‹ä»¶ï¼Œé¦–å…ˆå¿…é¡»å£°æ˜è¯¥äº‹ä»¶çš„å§”æ‰˜ç±»å‹ã€‚å¦‚ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">BoilerLogHandler</span>(<span class="params"><span class="built_in">string</span> status</span>)</span>;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œå£°æ˜äº‹ä»¶æœ¬èº«ï¼Œä½¿ç”¨eventå…³é”®å­—ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">event</span> BoilerLogHandler BoilerEventLog;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç å®šä¹‰äº†ä¸€ä¸ªåä¸ºBoilerLogHandlerçš„å§”æ‰˜å’Œä¸€ä¸ªåä¸ºBoilerEventLogçš„äº‹ä»¶ï¼Œè¯¥äº‹ä»¶åœ¨ç”Ÿæˆçš„æ—¶å€™ä¼šè°ƒç”¨å§”æ‰˜ã€‚</p><h2 id="å®ä¾‹">å®ä¾‹</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">SimpleEvent</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/******å‘å¸ƒå™¨ç±»*******/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EventTest</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">int</span> <span class="keyword">value</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">NumManipulationHandler</span>()</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">event</span> NumManipulationHandler ChangeNum;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnNumChanged</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (ChangeNum != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                ChangeNum(); <span class="comment">// äº‹ä»¶è¢«è§¦å‘</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">&quot;Event not fire&quot;</span>);</span><br><span class="line">                Console.ReadKey();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">EventTest</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">int</span> n = <span class="number">5</span>;</span><br><span class="line">            SetValue(<span class="number">5</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetValue</span>(<span class="params"><span class="built_in">int</span> n</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">value</span> != n)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">value</span> = n;</span><br><span class="line">                OnNumChanged();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/********è®¢é˜…å™¨ç±»********/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">subscribEvent</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printf</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;event fire&quot;</span>);</span><br><span class="line">            Console.ReadKey();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/********è§¦å‘********/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MainClass</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            EventTest e = <span class="keyword">new</span> EventTest(); <span class="comment">// å®ä¾‹åŒ–å¯¹è±¡ï¼Œç¬¬ä¸€æ¬¡æ²¡æœ‰è§¦å‘äº‹ä»¶</span></span><br><span class="line">            subscribEvent v = <span class="keyword">new</span> subscribEvent();</span><br><span class="line">            e.ChangeNum += <span class="keyword">new</span> EventTest.NumManipulationHandler(v.printf); <span class="comment">// æ³¨å†Œ</span></span><br><span class="line">            e.SetValue(<span class="number">7</span>);</span><br><span class="line">            e.SetValue(<span class="number">11</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å°æ•…äº‹ï¼š">å°æ•…äº‹ï¼š</h2><p>æ›¾ç».NETåªæœ‰ä¸€ä¸ªDelegateï¼Œåˆ«äººæƒ³è¦ä½¿ç”¨å§”æ‰˜çš„æ—¶å€™ï¼Œå¿…é¡»ä½¿ç”¨delegateå…³é”®å­—æ¥å®šä¹‰ä¸€ä¸ªå§”æ‰˜ï¼Œä½†æ˜¯è¿™æ ·æœ‰ä¸€ä¸ªå¼Šç«¯ï¼Œé‚£å°±æ˜¯delegateå¯ä»¥ä½¿ç”¨<code>=</code>å°†æ‰€æœ‰å·²ç»è®¢é˜…çš„å–æ¶ˆï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>+</code>å’Œ<code>-</code>å¯¹è®¢é˜…è¿›è¡Œåˆå¹¶å’Œåˆ é™¤ï¼Œåªä¿ç•™<code>=</code>ä¹‹åçš„æ–°çš„è®¢é˜…ï¼Œè¿™å°±ç»™äº†çŠ¯ç½ªåˆ†å­å¯ä¹˜ä¹‹æœºã€‚æ‰€ä»¥eventåº”è¿è€Œç”Ÿï¼Œeventæ˜¯ä¸€ç§ç‰¹æ®Šçš„å§”æ‰˜ï¼Œå®ƒåªèƒ½ä½¿ç”¨<code>+=</code>ã€<code>-=</code>ï¼Œè€Œä¸èƒ½ç›´æ¥ä½¿ç”¨<code>=</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œeventåœ¨å®šä¹‰ç±»ï¼ˆå‘å¸ƒè€…ï¼‰ä¸­æ˜¯å¯ä»¥ç›´æ¥<code>=</code>çš„ï¼Œä½†æ˜¯åœ¨å…¶ä»–ç±»ä¸­ï¼ˆè®¢é˜…è€…ï¼‰å°±åªèƒ½ä½¿ç”¨<code>+=</code>ã€<code>-=</code>äº†ï¼Œä¹Ÿå°±æ˜¯è¯´å‘å¸ƒè€…å‘å¸ƒäº†ä¸€ä¸ªäº‹ä»¶ä¹‹åï¼Œè®¢é˜…è€…é’ˆå¯¹ä»–åªèƒ½è¿›è¡Œè‡ªèº«çš„è®¢é˜…å’Œå–æ¶ˆã€‚ä½†æ˜¯åœ¨äº‹ä»¶å‘å¸ƒå’Œè®¢é˜…çš„è¿‡ç¨‹ä¸­ï¼Œå®šä¹‰äº‹ä»¶çš„åŸå‹å§”æ‰˜ç±»å‹å¸¸å¸¸æ˜¯ä¸€ä»¶é‡å¤æ€§çš„å·¥ä½œã€‚æ‰€ä»¥<code>Event Handler</code>åº”è¿è€Œç”Ÿï¼Œå®ƒçš„å‡ºç°å°±æ˜¯ä¸ºäº†é¿å…è¿™ç§é‡å¤æ€§çš„å·¥ä½œï¼Œå¹¶å»ºè®®å°½é‡ä½¿ç”¨è¯¥ç±»å‹ä½œä¸ºäº‹ä»¶çš„åŸå‹ã€‚</p><p>ä¸‹é¢æ˜¯EvenHandlerçš„å®ä¾‹ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TeacherArgs</span> : <span class="title">EventArgs</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Teacher</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">event</span> EventHandler acthandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Teacher</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;è€å¸ˆæ¥äº†&quot;</span>);</span><br><span class="line">        TeacherArgs args = <span class="keyword">new</span> TeacherArgs() &#123; Name = Name &#125;;</span><br><span class="line">        acthandler(<span class="literal">null</span>, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HeadArgs</span> : <span class="title">EventArgs</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> MedalCount &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Headmaster</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> MedalCount;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">event</span> EventHandler actHandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Headmaster</span>(<span class="params"><span class="built_in">string</span> name, <span class="built_in">int</span> medalCount</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = name;</span><br><span class="line">        MedalCount = medalCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æ ¡é•¿æ¥äº†&quot;</span>);</span><br><span class="line">        HeadArgs args = <span class="keyword">new</span> HeadArgs() &#123; Name = Name, MedalCount = MedalCount &#125;;</span><br><span class="line">        actHandler(<span class="literal">null</span>, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Students</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Action_Teacher</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        TeacherArgs args = e <span class="keyword">as</span> TeacherArgs;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;å…¨ä½“èµ·ç«‹ï¼Œå–Šï¼š&#123;0&#125;å¥½ï¼&quot;</span>, args.Name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Action_Master</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        HeadArgs args = e <span class="keyword">as</span> HeadArgs;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;å…¨ä½“èµ·ç«‹ï¼Œå–Šï¼š&#123;0&#125;å¥½&quot;</span>, args.Name);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æ ¡é•¿è·å¥–æ•°ä¸ºï¼š&#123;0&#125;&quot;</span>, args.MedalCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Action_Monitor</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        MonitorArgs args = e <span class="keyword">as</span> MonitorArgs;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;ç­é•¿æ¥äº†ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•å‚æ•°&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MonitorArgs</span> : <span class="title">EventArgs</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Monitor</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">event</span> EventHandler actHandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;ç­é•¿æ¥äº†ï¼Œä½†æ˜¯ä»€ä¹ˆå‚æ•°éƒ½æ²¡æœ‰&quot;</span>);</span><br><span class="line">        MonitorArgs args = <span class="keyword">new</span> MonitorArgs() &#123; &#125;;</span><br><span class="line">        actHandler(<span class="literal">null</span>, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Students students = <span class="keyword">new</span> Students();</span><br><span class="line">        Headmaster headmaster = <span class="keyword">new</span> Headmaster(<span class="string">&quot;å­™æ ¡é•¿&quot;</span>, <span class="number">10</span>);</span><br><span class="line">        Teacher teacher = <span class="keyword">new</span> Teacher(<span class="string">&quot;åˆ˜è€å¸ˆ&quot;</span>);</span><br><span class="line">        Monitor monitor = <span class="keyword">new</span> Monitor();</span><br><span class="line">        headmaster.actHandler += students.Action_Master;</span><br><span class="line">        teacher.acthandler += students.Action_Teacher;</span><br><span class="line">        monitor.actHandler += students.Action_Monitor;</span><br><span class="line">        teacher.Come();</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        headmaster.Come();</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        monitor.Come();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>**æ€»ç»“ï¼š**ä½¿ç”¨EventHandlerå¯ä»¥</p><ol><li>æ ‡å‡†åŒ–</li><li>å¯ä»¥çœç•¥å®šä¹‰å§”æ‰˜è¿™ä¸€æ­¥ï¼Œä¸å¿…å®šä¹‰å¤šä¸ªä¸åŒç±»å‹çš„å§”æ‰˜</li><li>æ­é…EventArgsï¼Œå¯ä»¥ä¼ é€’å¤šä¸ªä¿¡æ¯</li></ol><p>ä¸‹é¢çš„ä»£ç æ˜¯ä¸ä½¿ç”¨EventHandlerçš„å®ç°ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Diagnostics.Metrics;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">TeacherDelegate</span>(<span class="params"><span class="built_in">string</span> name</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">HeadMasterDelegate</span>(<span class="params"><span class="built_in">string</span> name, <span class="built_in">int</span> medalCount</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">MonitorDelegate</span>()</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Teacher</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> Name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">event</span> TeacherDelegate acthandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Teacher</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;è€å¸ˆæ¥äº†&quot;</span>);</span><br><span class="line">        acthandler(Name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Headmaster</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> Name;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> MedalCount;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">event</span> HeadMasterDelegate actHandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Headmaster</span>(<span class="params"><span class="built_in">string</span> name, <span class="built_in">int</span> medalCount</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = name;</span><br><span class="line">        MedalCount = medalCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æ ¡é•¿æ¥äº†&quot;</span>);</span><br><span class="line">        actHandler(Name, MedalCount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Monitor</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">event</span> MonitorDelegate actHandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;ç­é•¿æ¥äº†ï¼Œä½†æ˜¯ä»€ä¹ˆå‚æ•°éƒ½æ²¡æœ‰&quot;</span>);</span><br><span class="line">        actHandler();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Students</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Action_Teacher</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;å…¨ä½“èµ·ç«‹ï¼Œå–Šï¼š&#123;0&#125;å¥½ï¼&quot;</span>, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Action_Master</span>(<span class="params"><span class="built_in">string</span> name, <span class="built_in">int</span> medalCount</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;å…¨ä½“èµ·ç«‹ï¼Œå–Šï¼š&#123;0&#125;å¥½&quot;</span>, name);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æ ¡é•¿è·å¥–æ•°ä¸ºï¼š&#123;0&#125;&quot;</span>, medalCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Action_Monitor</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;ç­é•¿æ¥äº†ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•å‚æ•°&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Students students = <span class="keyword">new</span> Students();</span><br><span class="line">        Headmaster headmaster = <span class="keyword">new</span> Headmaster(<span class="string">&quot;å­™æ ¡é•¿&quot;</span>, <span class="number">10</span>);</span><br><span class="line">        Teacher teacher = <span class="keyword">new</span> Teacher(<span class="string">&quot;åˆ˜è€å¸ˆ&quot;</span>);</span><br><span class="line">        Monitor monitor = <span class="keyword">new</span> Monitor();</span><br><span class="line">        headmaster.actHandler += students.Action_Master;</span><br><span class="line">        teacher.acthandler += students.Action_Teacher;</span><br><span class="line">        monitor.actHandler += students.Action_Monitor;</span><br><span class="line">        teacher.Come();</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        headmaster.Come();</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        monitor.Come();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­å›åˆ°å°æ•…äº‹ï¼šåœ¨è¿™ä¸ªæ•…äº‹ä¸­ï¼ŒDelegateæ˜¯è€å¤§å“¥ï¼Œä½†æ˜¯EventHandleræ˜¯eventçš„å°å¼Ÿï¼Œè€å¤§å“¥ä¸å¤ªé«˜å…´äº†ï¼Œè¯´æˆ‘ä¹Ÿè¦æœ‰å°å¼Ÿï¼Œä½†æ›´é‡è¦çš„åŸå› æ˜¯æ¯æ¬¡å®šä¹‰Delegateä¹Ÿæ˜¯å¾ˆéº»çƒ¦çš„ï¼Œæ‰€ä»¥Actionåº”è¿è€Œç”Ÿï¼ŒActionæ˜¯ç³»ç»Ÿé¢„å®šä¹‰çš„ä¸€ç§å§”æ‰˜ï¼Œæ²¡æœ‰<strong>è¿”å›å€¼</strong>ï¼Œå‚æ•°åœ¨<code>&lt;&gt;</code>ä¸­ä¼ å…¥ï¼Œä¸‹é¢å°±æ˜¯ä½¿ç”¨Actionçš„æ–¹æ³•æ¥å®ç°ä¸Šé¢çš„ä»£ç ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Teacher</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> Name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Action&lt;<span class="built_in">string</span>&gt; acthandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Teacher</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;è€å¸ˆæ¥äº†&quot;</span>);</span><br><span class="line">        acthandler(Name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Headmaster</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> Name;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> MedalCount;</span><br><span class="line">    <span class="keyword">public</span> Action&lt;<span class="built_in">string</span>, <span class="built_in">int</span>&gt; actHandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Headmaster</span>(<span class="params"><span class="built_in">string</span> name, <span class="built_in">int</span> medalCount</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = name;</span><br><span class="line">        MedalCount = medalCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æ ¡é•¿æ¥äº†&quot;</span>);</span><br><span class="line">        actHandler(Name, MedalCount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Monitor</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Action actHandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;ç­é•¿æ¥äº†ï¼Œä½†æ˜¯ä»€ä¹ˆå‚æ•°éƒ½æ²¡æœ‰&quot;</span>);</span><br><span class="line">        actHandler();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Students</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Action_Teacher</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;å…¨ä½“èµ·ç«‹ï¼Œå–Šï¼š&#123;0&#125;å¥½ï¼&quot;</span>, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Action_Master</span>(<span class="params"><span class="built_in">string</span> name, <span class="built_in">int</span> medalCount</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;å…¨ä½“èµ·ç«‹ï¼Œå–Šï¼š&#123;0&#125;å¥½&quot;</span>, name);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æ ¡é•¿è·å¥–æ•°ä¸ºï¼š&#123;0&#125;&quot;</span>, medalCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Action_Monitor</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;ç­é•¿æ¥äº†ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•å‚æ•°&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Students students = <span class="keyword">new</span> Students();</span><br><span class="line">        Headmaster headmaster = <span class="keyword">new</span> Headmaster(<span class="string">&quot;å­™æ ¡é•¿&quot;</span>, <span class="number">10</span>);</span><br><span class="line">        Teacher teacher = <span class="keyword">new</span> Teacher(<span class="string">&quot;åˆ˜è€å¸ˆ&quot;</span>);</span><br><span class="line">        Monitor monitor = <span class="keyword">new</span> Monitor();</span><br><span class="line">        headmaster.actHandler += students.Action_Master;</span><br><span class="line">        teacher.acthandler += students.Action_Teacher;</span><br><span class="line">        monitor.actHandler += students.Action_Monitor;</span><br><span class="line">        teacher.Come();</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        headmaster.Come();</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        monitor.Come();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢è¿™æ®µä»£ç æ˜¯ç”¨Funcçš„æ–¹å¼å®ç°çš„ï¼ŒFun<code>&lt;&gt;</code>ä¸­æ¯”æ³¨å†Œçš„å‡½æ•°çš„å‚æ•°å¤š1ä¸ªï¼Œæœ€åä¸€ä¸ªæ˜¯å‚æ•°æ˜¯å‡½æ•°çš„è¿”å›ç±»å‹ã€‚</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Teacher</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> Name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Func&lt;<span class="built_in">string</span>, <span class="built_in">bool</span>&gt; acthandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Teacher</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;è€å¸ˆæ¥äº†&quot;</span>);</span><br><span class="line">        acthandler(Name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Headmaster</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> Name;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> MedalCount;</span><br><span class="line">    <span class="keyword">public</span> Func&lt;<span class="built_in">string</span>, <span class="built_in">int</span>, <span class="built_in">bool</span>&gt; actHandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Headmaster</span>(<span class="params"><span class="built_in">string</span> name, <span class="built_in">int</span> medalCount</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Name = name;</span><br><span class="line">        MedalCount = medalCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æ ¡é•¿æ¥äº†&quot;</span>);</span><br><span class="line">        actHandler(Name, MedalCount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Monitor</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Func&lt;<span class="built_in">bool</span>&gt; actHandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Come</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;ç­é•¿æ¥äº†ï¼Œä½†æ˜¯ä»€ä¹ˆå‚æ•°éƒ½æ²¡æœ‰&quot;</span>);</span><br><span class="line">        actHandler();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Students</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Action_Teacher</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;å…¨ä½“èµ·ç«‹ï¼Œå–Šï¼š&#123;0&#125;å¥½ï¼&quot;</span>, name);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Action_Master</span>(<span class="params"><span class="built_in">string</span> name, <span class="built_in">int</span> medalCount</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;å…¨ä½“èµ·ç«‹ï¼Œå–Šï¼š&#123;0&#125;å¥½&quot;</span>, name);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æ ¡é•¿è·å¥–æ•°ä¸ºï¼š&#123;0&#125;&quot;</span>, medalCount);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Action_Monitor</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;ç­é•¿æ¥äº†ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•å‚æ•°&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Students students = <span class="keyword">new</span> Students();</span><br><span class="line">        Headmaster headmaster = <span class="keyword">new</span> Headmaster(<span class="string">&quot;å­™æ ¡é•¿&quot;</span>, <span class="number">10</span>);</span><br><span class="line">        Teacher teacher = <span class="keyword">new</span> Teacher(<span class="string">&quot;åˆ˜è€å¸ˆ&quot;</span>);</span><br><span class="line">        Monitor monitor = <span class="keyword">new</span> Monitor();</span><br><span class="line">        headmaster.actHandler += students.Action_Master;</span><br><span class="line">        teacher.acthandler += students.Action_Teacher;</span><br><span class="line">        monitor.actHandler += students.Action_Monitor;</span><br><span class="line">        teacher.Come();</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        headmaster.Come();</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        monitor.Come();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>å†™ä¸€ä¸ªå¸¦æœ‰äº‹ä»¶ä¸­å¿ƒçš„å‘å¸ƒã€è®¢é˜…ç³»ç»Ÿ</h1><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Runtime.CompilerServices;</span><br><span class="line"><span class="keyword">using</span> Microsoft.VisualBasic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerState</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">PlayerDeath</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;ç©å®¶æ­»äº¡ï¼å‘äº‹ä»¶ä¸­å¿ƒå‘é€æ¶ˆæ¯ï¼&quot;</span>);</span><br><span class="line">        MessageCenter.Instance.SendMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AudioManager</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> AudioManager Instance = <span class="keyword">new</span> AudioManager();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">AudioManager</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æˆ‘æ˜¯AudioManagerï¼Œæˆ‘å·²ç»åˆ›å»ºå®Œæ¯•ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">PlayDeathAudio</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æ‰§è¡Œæ­»äº¡éŸ³æ•ˆ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DataManager</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> DataManager Instance = <span class="keyword">new</span> DataManager();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">DataManager</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æˆ‘æ˜¯DataManagerï¼Œæˆ‘å·²ç»åˆ›å»ºå®Œæ¯•ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ResetData</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;ç©å®¶æ­»äº¡ï¼Œæ‰§è¡Œæ•°æ®é‡åˆ¶&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EnenyManager</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> EnenyManager Instance = <span class="keyword">new</span> EnenyManager();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">EnenyManager</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æˆ‘æ˜¯EnemyManagerï¼Œæˆ‘å·²ç»åˆ›å»ºå®Œæˆï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">EnemyVictory</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;ç©å®¶æ­»äº¡ï¼Œæ•Œäººèƒœåˆ©ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MessageCenter</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œæ˜¯äº‹ä»¶ä¸­å¿ƒï¼Œå¤„ç†æ¸¸æˆä¸­å„ç±»äº‹ä»¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> MessageCenter Instance = <span class="keyword">new</span> MessageCenter();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MessageCenter</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æ„é€ å‡½æ•°ä½¿ç”¨privateå…³é”®å­—å°±å¯ä»¥é¿å…åœ¨åˆ«çš„ç±»ä¸­ä½¿ç”¨newå®ä¾‹åŒ–å¯¹è±¡äº†</span></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;æˆ‘æ˜¯äº‹ä»¶ä¸­å¿ƒï¼Œæˆ‘å·²ç»åˆå§‹åŒ–å®Œæˆï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">PlayerDeathDelegate</span>()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> PlayerDeathDelegate DeathDelegate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SendMessage</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (DeathDelegate == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;å§”æ‰˜æ˜¯ç©ºçš„ï¼æ²¡æœ‰ä»€ä¹ˆå¥½æ‰§è¡Œçš„ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            DeathDelegate.Invoke();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Register</span>(<span class="params">PlayerDeathDelegate deathDelegate</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        DeathDelegate += deathDelegate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameStart</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        PlayerState player = <span class="keyword">new</span> PlayerState();</span><br><span class="line">        <span class="comment">// æ¸¸æˆå¼€å§‹åè¦å…ˆå°†å‡½æ•°æ³¨å†Œåˆ°äº‹ä»¶ä¸­å¿ƒå»</span></span><br><span class="line">        MessageCenter.Instance.Register(AudioManager.Instance.PlayDeathAudio);</span><br><span class="line">        MessageCenter.Instance.Register(DataManager.Instance.ResetData);</span><br><span class="line">        MessageCenter.Instance.Register(EnenyManager.Instance.EnemyVictory);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        player.PlayerDeath();</span><br><span class="line"></span><br><span class="line">        Console.ReadKey();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç è¿˜ä¸å¤Ÿå®Œå–„ï¼Œæ¯”å¦‚ç°åœ¨åªæ˜¯å¤„ç†äº†ç©å®¶æ­»äº¡è¿™ä¸€ç§äº‹ä»¶ï¼Œé‚£å¦‚ä½•å¤„ç†ç©å®¶å…¶ä»–çŠ¶æ€çš„äº‹ä»¶å‘¢ï¼Ÿè¿˜æœ‰å¦‚æœä¸æ˜¯ç©å®¶ï¼Œæ˜¯åˆ«çš„ä»€ä¹ˆæ¯”å¦‚å®ç‰©ã€ä½¿ç”¨è¯æ°´ç­‰ç­‰å„ç§çš„å§”æ‰˜ï¼Œè¯¥æ€ä¹ˆå®ç°ï¼Ÿè¿™éƒ½æ˜¯åè¯äº†ï¼Œå§”æ‰˜çš„å­¦ä¹ åˆ°æ­¤å¯ä»¥å…ˆå‘Šä¸€æ®µè½äº†ã€‚</p><h1>é¡¹ç›®ä¸­çš„æŒ‰é’®å“åº”ç‚¹å‡»äº‹ä»¶çš„æ–¹æ³•</h1><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ButtonUI</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Button btn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UI.Extension;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ButtonPage</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> ButtonUI _ui;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        _ui = gameObject.GetComponent&lt;ButtonUI&gt;();</span><br><span class="line">        _ui.btn.onClick.AddListener(OnBtnClicked);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnBtnClicked</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;æˆ‘è¢«ç‚¹å‡»äº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>PhysXç¬”è®°</title>
      <link href="/posts/6f4ce0cc/"/>
      <url>/posts/6f4ce0cc/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ProjectO</title>
      <link href="/posts/8a8aad75/"/>
      <url>/posts/8a8aad75/</url>
      
        <content type="html"><![CDATA[<h1>ç´¢å¼•</h1><p><a href="https://soincredible.github.io/posts/20505312">ä»£ç çƒ­æ›´æ–°</a><br><a href="https://soincredible.github.io/posts/ae5b3442">èµ„æºåŠ è½½</a><br><a href="https://soincredible.github.io/posts/ff09e316">ETæ¡†æ¶8.1</a><br><a href="https://soincredible.github.io/posts/6f4ce0cc">ç‰©ç†æ¨¡æ‹Ÿ</a><br><a href="">åŠ¨ç”»</a><br><a href="">æŠ€èƒ½ç¼–è¾‘å™¨</a><br><a href="">æ•°æ®åº“MongoDB</a><br><a href="">æ¸²æŸ“</a></p><p>OWä¸­çš„è‹±é›„è§’è‰²å’Œè¿è½½ç›®æ ‡ä¹‹é—´æ˜¯å­˜åœ¨ç¢°æ’çš„, è¿è½½ç›®æ ‡å’Œç”Ÿå‘½ä¹‹æ ‘ä¹‹é—´ å¦‚æœç”Ÿå‘½ä¹‹æ ‘ç”Ÿæˆåœ¨åœ°ä¸Šè¿è½½ç›®æ ‡ä¸ä¼šå’Œæ ‘å‘ç”Ÿç¢°æ’ ç”Ÿæˆåœ¨è½¦ä¸Šå°±ä¼šæœ‰ç¢°æ’ è§’è‰²å’Œç”Ÿå‘½ä¹‹æ ‘æœ‰ç¢°æ’</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>The performance characteristics of async methods in C#</title>
      <link href="/posts/4b84508e/"/>
      <url>/posts/4b84508e/</url>
      
        <content type="html"><![CDATA[<p>åœ¨æœ€è¿‘çš„ä¸¤ç¯‡åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ·±å…¥æ¢è®¨äº†C#å¼‚æ­¥æ–¹æ³•çš„å†…éƒ¨å®ç°æœºåˆ¶ï¼Œå¹¶è¯¦ç»†åˆ†æäº†C#ç¼–è¯‘å™¨æä¾›çš„æ‰©å±•ç‚¹å¦‚ä½•è°ƒæ•´å¼‚æ­¥æ–¹æ³•çš„è¡Œä¸ºã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†é‡ç‚¹ç ”ç©¶å¼‚æ­¥æ–¹æ³•çš„æ€§èƒ½ç‰¹å¾ã€‚</p><p>æ­£å¦‚æœ¬ç³»åˆ—ç¬¬ä¸€ç¯‡æ–‡ç« æ‰€è¿°ï¼Œç¼–è¯‘å™¨è¿›è¡Œäº†å¤§é‡è½¬æ¢å·¥ä½œï¼Œä½¿å¼‚æ­¥ç¼–ç¨‹ä½“éªŒå‡ ä¹ä¸åŒæ­¥ç¼–ç¨‹æ— å¼‚ã€‚ä½†ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œç¼–è¯‘å™¨éœ€è¦åˆ›å»ºçŠ¶æ€æœºå®ä¾‹ã€å°†å…¶ä¼ é€’ç»™å¼‚æ­¥æ–¹æ³•ç”Ÿæˆå™¨ã€è°ƒç”¨ä»»åŠ¡ç­‰å¾…å™¨ç­‰ã€‚æ˜¾ç„¶ï¼Œæ‰€æœ‰è¿™äº›é€»è¾‘éƒ½ä¼šå¸¦æ¥æ€§èƒ½å¼€é”€ï¼Œä½†å…·ä½“ä»£ä»·æœ‰å¤šå¤§å‘¢ï¼Ÿ</p><p>åœ¨TPLï¼ˆä»»åŠ¡å¹¶è¡Œåº“ï¼‰å‡ºç°ä¹‹å‰ï¼Œå¼‚æ­¥æ“ä½œé€šå¸¸ç²’åº¦è¾ƒç²—ï¼Œå› æ­¤å…¶å¼€é”€å¾€å¾€å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ä½†åœ¨ç°ä»£åº”ç”¨ä¸­ï¼Œå³ä½¿ç›¸å¯¹ç®€å•çš„ç¨‹åºæ¯ç§’ä¹Ÿå¯èƒ½æ‰§è¡Œæˆç™¾ä¸Šåƒæ¬¡å¼‚æ­¥æ“ä½œã€‚TPLè™½ç„¶é’ˆå¯¹è¿™ç§å·¥ä½œè´Ÿè½½è¿›è¡Œäº†ä¼˜åŒ–è®¾è®¡ï¼Œä½†å®ƒå¹¶éé­”æ³•ï¼Œä»ç„¶å­˜åœ¨ä¸€å®šå¼€é”€ã€‚</p><p>ä¸ºäº†å‡†ç¡®æµ‹é‡å¼‚æ­¥æ–¹æ³•çš„å¼€é”€ï¼Œæˆ‘ä»¬å°†å¯¹é¦–ç¯‡åšå®¢ä¸­çš„ç¤ºä¾‹è¿›è¡Œé€‚å½“è°ƒæ•´åä½œä¸ºæµ‹è¯•åŸºå‡†ã€‚</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">StockPrices</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">int</span> Count = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">private</span> List&lt;(<span class="built_in">string</span> name, <span class="built_in">decimal</span> price)&gt; _stockPricesCache;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Async version</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;<span class="built_in">decimal</span>&gt; <span class="title">GetStockPriceForAsync</span>(<span class="params"><span class="built_in">string</span> companyId</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> InitializeMapIfNeededAsync();</span><br><span class="line">        <span class="keyword">return</span> DoGetPriceFromCache(companyId);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Sync version that calls async init</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">decimal</span> <span class="title">GetStockPriceFor</span>(<span class="params"><span class="built_in">string</span> companyId</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        InitializeMapIfNeededAsync().GetAwaiter().GetResult();</span><br><span class="line">        <span class="keyword">return</span> DoGetPriceFromCache(companyId);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Purely sync version</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">decimal</span> <span class="title">GetPriceFromCacheFor</span>(<span class="params"><span class="built_in">string</span> companyId</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        InitializeMapIfNeeded();</span><br><span class="line">        <span class="keyword">return</span> DoGetPriceFromCache(companyId);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="built_in">decimal</span> <span class="title">DoGetPriceFromCache</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> kvp <span class="keyword">in</span> _stockPricesCache)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (kvp.name == name)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> kvp.price;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> InvalidOperationException(<span class="string">$&quot;Can&#x27;t find price for &#x27;<span class="subst">&#123;name&#125;</span>&#x27;.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    [<span class="meta">MethodImpl(MethodImplOptions.NoInlining)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">InitializeMapIfNeeded</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Similar initialization logic.</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">async</span> Task <span class="title">InitializeMapIfNeededAsync</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_stockPricesCache != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">await</span> Task.Delay(<span class="number">42</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Getting the stock prices from the external source.</span></span><br><span class="line">        <span class="comment">// Generate 1000 items to make cache hit somewhat expensive</span></span><br><span class="line">        _stockPricesCache = Enumerable.Range(<span class="number">1</span>, Count)</span><br><span class="line">            .Select(n =&gt; (name: n.ToString(), price: (<span class="built_in">decimal</span>)n))</span><br><span class="line">            .ToList();</span><br><span class="line">        _stockPricesCache.Add((name: <span class="string">&quot;MSFT&quot;</span>, price: <span class="number">42</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>C#ä¸­çš„Task</title>
      <link href="/posts/323f6783/"/>
      <url>/posts/323f6783/</url>
      
        <content type="html"><![CDATA[<h1>å…³äºTaskScheduler</h1><p>TaskScheduleræ˜¯C#<code>System.Threading.Tasks</code>å‘½åç©ºé—´ä¸‹çš„ä¸€ä¸ªæŠ½è±¡ç±», åœ¨<code>.Net Framework 4.8</code>ä¸­C#å†…ç½®äº†ä¸‰ä¸ªTaskSchedulerçš„æ´¾ç”Ÿç±»: <code>ConcurrentExclusiveScheduler</code>ã€<code>SynchronizationContextTaskScheduler</code>ã€<code>ThreadPoolTaskScheduler</code>.</p><p>å…¶ä¸­çš„<code>ThreadPoolTaskScheduler</code>, è¢«è®¾ç½®ä¸ºäº†Default TaskScheduler</p><h1>ExecutionContext</h1><p>æ‰§è¡Œä¸Šä¸‹æ–‡,</p><h1>StackCrawlMark</h1><h1>å…³äºThread</h1><h1>è°ƒç”¨Task.Runçš„æ—¶å€™ å‘ç”Ÿäº†ä»€ä¹ˆ</h1>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Extending the asynce methods in CSharp(è¯‘)</title>
      <link href="/posts/40aca622/"/>
      <url>/posts/40aca622/</url>
      
        <content type="html"><![CDATA[<p>é¦–å…ˆè¦ææ¸…æ¥š, ä¸ºä»€ä¹ˆè¦å®ç°æˆ‘ä»¬è‡ªå·±çš„å¼‚æ­¥, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Taskæ¥å®Œæˆæˆ‘ä»¬çš„å¼‚æ­¥æ“ä½œ, æˆ‘ä»¬å°†éœ€è¦å¼‚æ­¥çš„æ“ä½œç”¨TaskåŒ…è£…, Task(Awaiter)ä½•æ—¶ç»“æŸã€å¦‚ä½•è°ƒåº¦éƒ½æ˜¯TaskScheduleråšçš„, æˆ‘ä»¬æ²¡æœ‰å¤ªå¤šæƒé™å¹²é¢„ æˆ‘ä»¬èƒ½åšçš„åªæ˜¯å‘Šè¯‰Task ç­‰ä½ çš„ä»»åŠ¡å®Œæˆä¹‹å ä½ éœ€è¦è°ƒç”¨stateMachinerçš„MoveNextæ–¹æ³•, å¦‚æœæˆ‘è¦å®ç°è‡ªå·±çš„ç±»ä¼¼ETTaskçš„åŠŸèƒ½, æˆ‘å¸Œæœ›æˆ‘èƒ½è‡ªå·±å†³å®šå¦‚ä½•è°ƒåº¦è¿™äº›ETTask, è¦ä¸ç„¶å®ç°è‡ªå·±çš„ETTaskçš„æ„ä¹‰å°±æ²¡æœ‰äº†. C#ä¸­å¼‚æ­¥æ“ä½œåˆ°è¿™é‡Œå°±å·²ç»æ­ç¤ºåœ°æ¯”è¾ƒæ¸…æ¥šäº†, åªæ˜¯Taskçš„è°ƒåº¦ç›®å‰å¯¹æˆ‘ä»¬æ¥è¯´è¿˜æ˜¯é»‘ç›’, æœ€å¥½å®ƒä¹Ÿåªæ˜¯é»‘ç›’</p><p>å› æ­¤, åœ¨ç¬”è€…çœ‹æ¥, è¦å®ç°è‡ªå·±çš„å¼‚æ­¥, å°±æ˜¯è¦å®ç°å¦‚ä½•è°ƒåº¦è¿™äº›å¼‚æ­¥æ“ä½œ, å³æˆ‘ä»¬è¦å®ç°TaskSchedulerçš„åŠŸèƒ½.</p><p>æˆ‘ä»¬ä½¿ç”¨TaskåŒ…è£…ä¸€äº›æ“ä½œ, è¿™äº›æ“ä½œå¯èƒ½æ˜¯<code>ComputeBound</code>ç±»å‹æˆ–è€…<code>IOBound</code>ç±»å‹, ä¹Ÿå¯èƒ½åªæ˜¯ä¸€ä¸ªå»¶æ—¶<code>Task.Delay</code>æ“ä½œ, ç”šè‡³å¯èƒ½å°±æ˜¯ä¸€ä¸ªç®€å•çš„åŒæ­¥æ–¹æ³•. ä¸è®ºæ˜¯ä»€ä¹ˆæ“ä½œ, ä½ åªè¦å°†è¯¥æ“ä½œä½¿ç”¨TaskåŒ…è£…, å¹¶ä¸”è°ƒç”¨äº†è¯¥Task, é‚£ä¹ˆä½ å°±å¯ä»¥é€šè¿‡è·å–<code>Task.GetAwaiter()</code>æ¥å£è·å–åˆ°è¯¥Taskçš„Awaiter, ç„¶åé€šè¿‡è°ƒç”¨Awaiter.IsCompleteæ¥åˆ¤æ–­åŒ…è£…è¿›è¯¥Taskçš„æ“ä½œæœ‰æ²¡æœ‰å®Œæˆ.</p><p>æˆ‘ä»¬å¸Œæœ›çš„æ˜¯Taskå¯ä»¥è¢«await, é‚£ä¹ˆTaskä¸­å°±è¦æœ‰ä¸€ä¸ª<code>GetAwaiter()</code>æ–¹æ³•<br>é‚£ä¹ˆtaskçš„GetAwaiteræ–¹æ³•è¿”å›å›æ¥çš„æ˜¯ä¸€ä¸ªTaskAwaiterç±»å‹<br>æ‰€ä»¥æ˜¯TaskAwaiterç±»å‹å®ç°äº†INotifyCompletionæ¥å£ã€ ä¸”TaskAwaiterä¸­æœ‰<code>bool IsComplete &#123;get;&#125;</code>å±æ€§å’Œ<code>T GetResult()</code>æ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public static async Task Foo()</span><br><span class="line">&#123;</span><br><span class="line">    var lazy = new Lazy&lt;int&gt;(() =&gt; 42);</span><br><span class="line">    var result = await lazy;</span><br><span class="line">    Console.WriteLine(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­() =&gt; 42 çš„å«ä¹‰<br>()ï¼šè¡¨ç¤ºä¸€ä¸ªæ²¡æœ‰å‚æ•°çš„åŒ¿åæ–¹æ³•ï¼ˆç±»ä¼¼æ— å‚å‡½æ•°ï¼‰ã€‚</p><p>=&gt;ï¼šLambda è¿ç®—ç¬¦ï¼Œåˆ†éš”å‚æ•°å’Œæ–¹æ³•ä½“ã€‚</p><p>42ï¼šæ–¹æ³•çš„è¿”å›å€¼ï¼ˆæ­¤å¤„ç›´æ¥è¿”å›å¸¸é‡å€¼ 42ï¼‰ã€‚</p><p>Lazy<T> çš„æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ª Func<T> å§”æ‰˜ï¼ˆå³ä¸€ä¸ªæ— å‚ä¸”è¿”å› T ç±»å‹çš„æ–¹æ³•ï¼‰ã€‚Lambda è¡¨è¾¾å¼ () =&gt; 42 æ­£å¥½åŒ¹é…è¿™ä¸ªå§”æ‰˜ç±»å‹ï¼š</p><p>Func<int> çš„ç­¾åæ˜¯ int Func()ï¼Œè€Œ () =&gt; 42 æ˜¯ä¸€ä¸ªæ— å‚ä¸”è¿”å› int çš„è¡¨è¾¾å¼ã€‚</p><p>å› æ­¤ï¼Œä»£ç å¯ä»¥ç®€åŒ–ä¸º Lambda å½¢å¼ï¼Œè€Œä¸éœ€è¦æ˜¾å¼å®šä¹‰ä¸€ä¸ªå•ç‹¬çš„æ–¹æ³•ã€‚</p><p>åœ¨ä¹‹å‰çš„åšå®¢æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†C#ç¼–è¯‘å™¨å¦‚ä½•è½¬æ¢å¼‚æ­¥æ–¹æ³•ã€‚æœ¬æ–‡å°†é‡ç‚¹ä»‹ç»C#ç¼–è¯‘å™¨æä¾›çš„æ‰©å±•ç‚¹ï¼Œç”¨äºè‡ªå®šä¹‰å¼‚æ­¥æ–¹æ³•çš„è¡Œä¸ºã€‚</p><p>æœ‰ä¸‰ç§æ–¹å¼å¯ä»¥æ§åˆ¶å¼‚æ­¥æ–¹æ³•çš„è¿è¡Œæœºåˆ¶ï¼š</p><ul><li>åœ¨System.Runtime.CompilerServiceså‘½åç©ºé—´ä¸­æä¾›è‡ªå®šä¹‰çš„å¼‚æ­¥æ–¹æ³•ç”Ÿæˆå™¨</li><li>ä½¿ç”¨è‡ªå®šä¹‰ä»»åŠ¡ç­‰å¾…å™¨</li><li>å®šä¹‰è‡ªå·±çš„ç±»ä»»åŠ¡ç±»å‹</li></ul><h1>System.Runtime.CompilerServiceså‘½åç©ºé—´ä¸­çš„è‡ªå®šä¹‰ç±»å‹</h1><p>æ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æ‰€äº†è§£çš„ï¼ŒC#ç¼–è¯‘å™¨å°†å¼‚æ­¥æ–¹æ³•è½¬æ¢ä¸ºä¸€ä¸ªç”Ÿæˆçš„çŠ¶æ€æœºï¼Œè¯¥çŠ¶æ€æœºä¾èµ–äºä¸€äº›é¢„å®šä¹‰ç±»å‹ã€‚ä½†C#ç¼–è¯‘å™¨å¹¶ä¸è¦æ±‚è¿™äº›å·²çŸ¥ç±»å‹å¿…é¡»æ¥è‡ªç‰¹å®šç¨‹åºé›†ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨é¡¹ç›®ä¸­æä¾›è‡ªå·±çš„AsyncVoidMethodBuilderå®ç°ï¼ŒC#ç¼–è¯‘å™¨ä¼šå°†å¼‚æ­¥æœºåˆ¶&quot;ç»‘å®š&quot;åˆ°æ‚¨çš„è‡ªå®šä¹‰ç±»å‹ã€‚</p><p>è¿™æ˜¯æ¢ç´¢åº•å±‚è½¬æ¢åŸç†å’Œäº†è§£è¿è¡Œæ—¶æƒ…å†µçš„ç»ä½³æ–¹å¼ï¼š</p><p>å¿…é¡»è¦æ³¨æ„, è¿™ç§æ–¹å¼ä½ å¿…é¡»å°†ä½ çš„builderå®šä¹‰åœ¨<code>System.Runtime.CompilerServices</code>å‘½åç©ºé—´ä¸‹</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">System.Runtime.CompilerServices</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// AsyncVoidMethodBuilder.cs in your project</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AsyncVoidMethodBuilder</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">AsyncVoidMethodBuilder</span>()</span></span><br><span class="line">            =&gt; Console.WriteLine(<span class="string">&quot;.ctor&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AsyncVoidMethodBuilder <span class="title">Create</span>()</span></span><br><span class="line">            =&gt; <span class="keyword">new</span> AsyncVoidMethodBuilder();</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetResult</span>()</span> =&gt; Console.WriteLine(<span class="string">&quot;SetResult&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Start</span>&lt;<span class="title">TStateMachine</span>&gt;(<span class="params"><span class="keyword">ref</span> TStateMachine stateMachine</span>)</span></span><br><span class="line"><span class="function">            <span class="keyword">where</span> TStateMachine : IAsyncStateMachine</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Start&quot;</span>);</span><br><span class="line">            stateMachine.MoveNext();</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetStateMachine</span>(<span class="params">IAsyncStateMachine stateMachine</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetException</span>(<span class="params">Exception exception</span>)</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AwaitOnCompleted</span>&lt;<span class="title">TAwaiter</span>, <span class="title">TStateMachine</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="keyword">ref</span> TAwaiter awaiter, <span class="keyword">ref</span> TStateMachine stateMachine</span>)</span></span><br><span class="line"><span class="function">            <span class="keyword">where</span> TAwaiter : INotifyCompletion</span></span><br><span class="line"><span class="function">            <span class="keyword">where</span> TStateMachine : IAsyncStateMachine</span></span><br><span class="line">        &#123;</span><br><span class="line">            stateMachine.MoveNext();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AwaitUnsafeOnCompleted</span>&lt;<span class="title">TAwaiter</span>, <span class="title">TStateMachine</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="keyword">ref</span> TAwaiter awaiter, <span class="keyword">ref</span> TStateMachine stateMachine</span>)</span></span><br><span class="line"><span class="function">            <span class="keyword">where</span> TAwaiter : ICriticalNotifyCompletion</span></span><br><span class="line"><span class="function">            <span class="keyword">where</span> TStateMachine : IAsyncStateMachine</span></span><br><span class="line">        &#123;</span><br><span class="line">            stateMachine.MoveNext();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨, ä½ é¡¹ç›®ä¸­æ‰€æœ‰çš„å¼‚æ­¥æ–¹æ³•éƒ½ä¼šä½¿ç”¨è¿™ä¸ªè‡ªå®šä¹‰ç‰ˆæœ¬çš„<code>AsyncVoidMethodBuilder</code>. æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„å¼‚æ­¥æ–¹æ³•ç®€å•æµ‹è¯•ä¸€ä¸‹:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RunAsyncVoid</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(<span class="string">&quot;Before VoidAsync&quot;</span>);</span><br><span class="line">    VoidAsync();</span><br><span class="line">    Console.WriteLine(<span class="string">&quot;After VoidAsync&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">async</span> <span class="keyword">void</span> <span class="title">VoidAsync</span>()</span> &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœæ˜¯:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Before VoidAsync</span><br><span class="line">.ctor</span><br><span class="line">Start</span><br><span class="line">SetResult</span><br><span class="line">After VoidAsync</span><br></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥å®ç° UnsafeAwaitOnComplete æ–¹æ³•æ¥æµ‹è¯•å¸¦æœ‰ await å­å¥çš„å¼‚æ­¥æ–¹æ³•åœ¨è¿”å›æœªå®Œæˆä»»åŠ¡æ—¶çš„è¡Œä¸ºã€‚å®Œæ•´ç¤ºä¾‹å¯ä»¥åœ¨ GitHub ä¸Šæ‰¾åˆ°ã€‚</p><p>è¦ä¿®æ”¹ async Task å’Œ async Task<T> æ–¹æ³•çš„è¡Œä¸ºï¼Œæ‚¨éœ€è¦æä¾›è‡ªå·±çš„ AsyncTaskMethodBuilder å’Œ AsyncTaskMethodBuilder<T> å®ç°ã€‚å®Œæ•´çš„å®ç°ç¤ºä¾‹å¯ä»¥åœ¨æˆ‘çš„ GitHub é¡¹ç›® EduAsync(*) ä¸­æ‰¾åˆ°ï¼Œåˆ†åˆ«å¯¹åº”æ–‡ä»¶ AsyncTaskBuilder.cs å’Œ AsyncTaskMethodBuilderOfT.csã€‚</p><h1>Custom awaiters</h1><p>å‰é¢çš„ç¤ºä¾‹å±äº&quot;é»‘å®¢æ‰‹æ®µ&quot;ï¼Œå¹¶ä¸é€‚åˆç”Ÿäº§ç¯å¢ƒã€‚è™½ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼å­¦ä¹ å¼‚æ­¥æœºåˆ¶ï¼Œä½†æ‚¨è‚¯å®šä¸å¸Œæœ›åœ¨è‡ªå·±çš„ä»£ç åº“ä¸­çœ‹åˆ°è¿™æ ·çš„ä»£ç ã€‚C# è¯­è¨€è®¾è®¡è€…åœ¨ç¼–è¯‘å™¨ä¸­å†…ç½®äº†æ­£ç¡®çš„æ‰©å±•ç‚¹ï¼Œå…è®¸åœ¨å¼‚æ­¥æ–¹æ³•ä¸­&quot;await&quot;ä¸åŒçš„ç±»å‹ã€‚</p><p>è¦ä½¿æŸä¸ªç±»å‹æˆä¸º&quot;å¯ç­‰å¾…çš„&quot;ï¼ˆå³å¯ä»¥åœ¨ await è¡¨è¾¾å¼ä¸­ä½¿ç”¨ï¼‰ï¼Œè¯¥ç±»å‹éœ€è¦éµå¾ªç‰¹å®šæ¨¡å¼ï¼š</p><p>ç¼–è¯‘å™¨å¿…é¡»èƒ½å¤Ÿæ‰¾åˆ°ä¸€ä¸ªåä¸º GetAwaiter çš„å®ä¾‹æ–¹æ³•æˆ–æ‰©å±•æ–¹æ³•ã€‚è¯¥æ–¹æ³•çš„è¿”å›ç±»å‹éœ€è¦æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š</p><ul><li>å¿…é¡»å®ç° INotifyCompletion æ¥å£</li><li>å¿…é¡»åŒ…å« bool IsCompleted {get;} å±æ€§</li><li>å¿…é¡»æä¾› T GetResult() æ–¹æ³•</li></ul><p>è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥è½»æ˜“çš„å°†<code>Lazy&lt;T&gt;</code>å˜å¾—awaitable:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> LazyAwaiter&lt;T&gt; : INotifyCompletion</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> Lazy&lt;T&gt; _lazy;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LazyAwaiter</span>(<span class="params">Lazy&lt;T&gt; lazy</span>)</span> =&gt; _lazy = lazy;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">GetResult</span>()</span> =&gt; _lazy.Value;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> IsCompleted =&gt; <span class="literal">true</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnCompleted</span>(<span class="params">Action continuation</span>)</span> &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">LazyAwaiterExtensions</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="title">LazyAwaiter</span>&lt;<span class="title">T</span>&gt; <span class="title">GetAwaiter</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="keyword">this</span> Lazy&lt;T&gt; lazy</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LazyAwaiter&lt;T&gt;(lazy);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">async</span> Task <span class="title">Foo</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> lazy = <span class="keyword">new</span> Lazy&lt;<span class="built_in">int</span>&gt;(() =&gt; <span class="number">42</span>);</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">await</span> lazy;</span><br><span class="line">    Console.WriteLine(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç¤ºä¾‹å¯èƒ½çœ‹èµ·æ¥æœ‰äº›åˆ»æ„ï¼Œä½†è¿™ç§æ‰©å±•æœºåˆ¶å®é™…ä¸Šéå¸¸å®ç”¨ï¼Œå¹¶ä¸”å·²è¢«å¹¿æ³›åº”ç”¨ã€‚ä¾‹å¦‚ï¼š</p><p>.NET çš„ Reactive Extensions å°±æä¾›äº†è‡ªå®šä¹‰ç­‰å¾…å™¨ï¼Œå…è®¸åœ¨å¼‚æ­¥æ–¹æ³•ä¸­ç­‰å¾… IObservable<T> å®ä¾‹</p><p>åŸºç¡€ç±»åº“(BCL)æœ¬èº«ä¹ŸåŒ…å«å¤šä¸ªå®ç°ï¼š</p><p>YieldAwaitableï¼ˆç”± Task.Yield ä½¿ç”¨ï¼‰</p><p>HopToThreadPoolAwaitable</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> HopToThreadPoolAwaitable : INotifyCompletion</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> HopToThreadPoolAwaitable <span class="title">GetAwaiter</span>()</span> =&gt; <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> IsCompleted =&gt; <span class="literal">false</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnCompleted</span>(<span class="params">Action continuation</span>)</span> =&gt; Task.Run(continuation);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetResult</span>()</span> &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹å•å…ƒæµ‹è¯•å±•ç¤ºäº†æœ€åä¸€ä¸ªç­‰å¾…å™¨çš„å®é™…åº”ç”¨ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Test</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task <span class="title">Test</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> testThreadId = Thread.CurrentThread.ManagedThreadId;</span><br><span class="line">    <span class="keyword">await</span> Sample();</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">async</span> Task <span class="title">Sample</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Assert.AreEqual(Thread.CurrentThread.ManagedThreadId, testThreadId);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">await</span> <span class="literal">default</span>(HopToThreadPoolAwaitable);</span><br><span class="line">        Assert.AreNotEqual(Thread.CurrentThread.ManagedThreadId, testThreadId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»»ä½•å¼‚æ­¥æ–¹æ³•çš„ç¬¬ä¸€éƒ¨åˆ†ï¼ˆåœ¨é¦–ä¸ª await è¯­å¥ä¹‹å‰ï¼‰éƒ½ä¼šåŒæ­¥æ‰§è¡Œã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ç§æœºåˆ¶éå¸¸é€‚åˆç”¨äºç«‹å³è¿›è¡Œå‚æ•°éªŒè¯ï¼Œä½†æœ‰æ—¶æˆ‘ä»¬éœ€è¦ç¡®ä¿æ–¹æ³•ä½“ä¸ä¼šé˜»å¡è°ƒç”¨è€…çº¿ç¨‹ã€‚HopToThreadPoolAwaitable çš„ä½œç”¨å°±æ˜¯ç¡®ä¿æ–¹æ³•çš„å‰©ä½™éƒ¨åˆ†åœ¨çº¿ç¨‹æ± çº¿ç¨‹è€Œéè°ƒç”¨è€…çº¿ç¨‹ä¸­æ‰§è¡Œã€‚</p><h1>Task-Like Types</h1><p>è‡ªå®šä¹‰ç­‰å¾…å™¨ï¼ˆcustom awaitersï¼‰ä»æ”¯æŒ async/await çš„ç¼–è¯‘å™¨æœ€åˆç‰ˆæœ¬ï¼ˆå³ C# 5ï¼‰å°±å·²å­˜åœ¨ã€‚è¿™ç§æ‰©å±•æœºåˆ¶è™½ç„¶å¾ˆæœ‰ç”¨ï¼Œä½†å­˜åœ¨é™åˆ¶â€”â€”æ‰€æœ‰å¼‚æ­¥æ–¹æ³•éƒ½å¿…é¡»è¿”å› voidã€Task æˆ– Task<T>ã€‚ä» C# 7.2 å¼€å§‹ï¼Œç¼–è¯‘å™¨å¼€å§‹æ”¯æŒç±»ä»»åŠ¡ç±»å‹ã€‚</p><p>ç±»ä»»åŠ¡ç±»å‹æ˜¯æŒ‡å…·æœ‰å…³è”æ„å»ºå™¨ç±»å‹çš„ç±»æˆ–ç»“æ„ä½“ï¼Œè¯¥æ„å»ºå™¨ç±»å‹é€šè¿‡ AsyncMethodBuilderAttribute(**) æ ‡è¯†ã€‚è¦ä½¿ç±»ä»»åŠ¡ç±»å‹çœŸæ­£æœ‰ç”¨ï¼Œå®ƒå¿…é¡»æ»¡è¶³å‰ä¸€èŠ‚æè¿°çš„&quot;å¯ç­‰å¾…&quot;æ¡ä»¶ã€‚æœ¬è´¨ä¸Šï¼Œç±»ä»»åŠ¡ç±»å‹æ•´åˆäº†å‰æ–‡æ‰€è¿°çš„ä¸¤ç§æ‰©å±•æœºåˆ¶ï¼Œå¹¶å°†ç¬¬ä¸€ç§æ–¹å¼è½¬åŒ–ä¸ºå®˜æ–¹æ”¯æŒæ–¹æ¡ˆã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®šä¹‰ä¸ºç»“æ„ä½“çš„è‡ªå®šä¹‰ç±»ä»»åŠ¡ç±»å‹ç®€å•ç¤ºä¾‹ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">TaskLikeMethodBuilder</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TaskLikeMethodBuilder</span>()</span></span><br><span class="line">        =&gt; Console.WriteLine(<span class="string">&quot;.ctor&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TaskLikeMethodBuilder <span class="title">Create</span>()</span></span><br><span class="line">        =&gt; <span class="keyword">new</span> TaskLikeMethodBuilder();</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetResult</span>()</span> =&gt; Console.WriteLine(<span class="string">&quot;SetResult&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Start</span>&lt;<span class="title">TStateMachine</span>&gt;(<span class="params"><span class="keyword">ref</span> TStateMachine stateMachine</span>)</span></span><br><span class="line"><span class="function">        <span class="keyword">where</span> TStateMachine : IAsyncStateMachine</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Start&quot;</span>);</span><br><span class="line">        stateMachine.MoveNext();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> TaskLike Task =&gt; <span class="literal">default</span>(TaskLike);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// AwaitOnCompleted, AwaitUnsafeOnCompleted, SetException </span></span><br><span class="line">    <span class="comment">// and SetStateMachine are empty</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">[<span class="meta">System.Runtime.CompilerServices.AsyncMethodBuilder(typeof(TaskLikeMethodBuilder))</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> TaskLike</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> TaskLikeAwaiter <span class="title">GetAwaiter</span>()</span> =&gt; <span class="literal">default</span>(TaskLikeAwaiter);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> TaskLikeAwaiter : INotifyCompletion</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetResult</span>()</span> &#123; &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> IsCompleted =&gt; <span class="literal">true</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnCompleted</span>(<span class="params">Action continuation</span>)</span> &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰è¿”å›ç±»ä»»åŠ¡ç±»å‹ï¼ˆTaskLikeï¼‰çš„æ–¹æ³•ï¼Œç”šè‡³å¯ä»¥åœ¨æ–¹æ³•ä½“å†…ä½¿ç”¨ä¸åŒçš„ç±»ä»»åŠ¡ç±»å‹ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">async</span> TaskLike <span class="title">FooAsync</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">await</span> Task.Yield();</span><br><span class="line">    <span class="keyword">await</span> <span class="literal">default</span>(TaskLike);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¼•å…¥ç±»ä»»åŠ¡ç±»å‹ï¼ˆtask-like typesï¼‰çš„ä¸»è¦ç›®çš„æ˜¯å‡å°‘å¼‚æ­¥æ“ä½œçš„å¼€é”€ã€‚æ¯ä¸ªè¿”å› Task<T> çš„å¼‚æ­¥æ“ä½œè‡³å°‘ä¼šåœ¨æ‰˜ç®¡å †ä¸Šåˆ†é…ä¸€ä¸ªå¯¹è±¡â€”â€”å³ä»»åŠ¡æœ¬èº«ã€‚å¯¹äºç»å¤§å¤šæ•°åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œè¿™å®Œå…¨ä¸æ˜¯é—®é¢˜ï¼Œå°¤å…¶æ˜¯å¤„ç†ç²—ç²’åº¦å¼‚æ­¥æ“ä½œæ—¶ã€‚ä½†å¯¹äºåŸºç¡€è®¾æ–½çº§åˆ«çš„ä»£ç ï¼ˆæ¯ç§’å¯èƒ½æ¶‰åŠæ•°åƒä¸ªå°å‹ä»»åŠ¡ï¼‰è€Œè¨€ï¼Œæƒ…å†µåˆ™ä¸åŒã€‚åœ¨è¿™ç±»åœºæ™¯ä¸‹ï¼Œå‡å°‘æ¯æ¬¡è°ƒç”¨çš„å†…å­˜åˆ†é…å¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½ã€‚</p><h1>å¼‚æ­¥æ¨¡å¼æ‰©å±•åŸºç¡€</h1><p>C# ç¼–è¯‘å™¨ä¸ºæ‰©å±•å¼‚æ­¥æ–¹æ³•æä¾›äº†å¤šç§æ–¹å¼ï¼š</p><ul><li>ä¿®æ”¹ç°æœ‰åŸºäº Task çš„å¼‚æ­¥æ–¹æ³•, é€šè¿‡æä¾›è‡ªå®šä¹‰çš„ AsyncTaskMethodBuilder ç±»å‹å®ç°æ¥æ”¹å˜è¡Œä¸º</li><li>å®ç°&quot;å¯ç­‰å¾…æ¨¡å¼&quot;, é€šè¿‡å®ç° â€œawaitable patternâ€ ä½¿ç±»å‹æ”¯æŒ await æ“ä½œ</li><li>æ„å»ºè‡ªå®šä¹‰ç±»ä»»åŠ¡ç±»å‹ï¼ˆC# 7+ï¼‰, ä» C# 7 å¼€å§‹æ”¯æŒåˆ›å»ºè‡ªå·±çš„ç±»ä»»åŠ¡ç±»å‹</li></ul><h1>æ‰©å±•é˜…è¯»</h1><p>[æ·±åº¦è§£æ C# å¼‚æ­¥æ–¹æ³•](Dissecting the async methods in C#)</p><p>[EduAsync ä»£ç åº“ï¼ˆGitHubï¼‰](EduAsync repo on github)</p><p>[ç±»ä»»åŠ¡ç±»å‹è¯¦è§£](Task-like types)</p><p>ä¸‹ä¸€ç¯‡åšå®¢, æˆ‘ä»¬å°†æ¢è®¨å¼‚æ­¥æ–¹æ³•çš„æ€§èƒ½ç‰¹å¾ï¼Œå¹¶åˆ†ææ–°å‹å€¼ç±»å‹ System.ValueTask å¦‚ä½•å½±å“æ€§èƒ½è¡¨ç°ã€‚</p><h1>å­¦ä»¥è‡´ç”¨</h1><p>å°†Unityå¼‚æ­¥æ“ä½œç±»å‹å˜å¾—å¯ä»¥await<br>ç¬”è€…ä»Šå¤©æ‰¾åˆ°çš„åº”ç”¨åœºæ™¯: åœ¨Unityä¸­, å¦‚æœä½ åœ¨Editoræ¨¡å¼ä¸‹æ‰§è¡ŒæŸäº›å¼‚æ­¥æ“ä½œ, ä½ æ˜¯æ²¡æœ‰åŠæ³•é€šè¿‡MonoBehaviourå¼€å¯åç¨‹æ¥é©±åŠ¨å¼‚æ­¥æ“ä½œçš„, å½“ç„¶æœ‰ä¸€äº›å¥‡æŠ€æ·«å·§, æ¯”å¦‚I2é‚£ä¸ªå¤šè¯­è¨€æ’ä»¶, ç¬”è€…è®°å¾—å¥½åƒæ˜¯é€šè¿‡åœ¨åœºæ™¯ä¸­åˆ›å»ºä¸€ä¸ªæŒ‚åœ¨äº†å…¶å¼‚æ­¥æ“ä½œçš„MonoBehaviourçš„èŠ‚ç‚¹, åœ¨é‚£ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œå¼‚æ­¥æ“ä½œ, ä½†æ˜¯ç¬”è€…è§‰å¾—è¿˜æ˜¯ä¸å¤ªä¼˜é›…, éœ€è¦Unityåç¨‹é©±åŠ¨çš„å¼‚æ­¥æ“ä½œå˜æˆå¯ä»¥è¢«Task awaitçš„æ“ä½œ.</p><p>ä»£ç å¦‚ä¸‹:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> UnityWebRequestAsyncOperationAwaiter : ICriticalNotifyCompletion</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> UnityWebRequestAsyncOperation _asyncOperation;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UnityWebRequestAsyncOperationAwaiter</span>(<span class="params">UnityWebRequestAsyncOperation asyncOperation</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _asyncOperation = asyncOperation;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnCompleted</span>(<span class="params">Action continuation</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _asyncOperation.completed += _ =&gt; continuation();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UnsafeOnCompleted</span>(<span class="params">Action continuation</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _asyncOperation.completed += _ =&gt; continuation();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GetResult</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_asyncOperation.webRequest.result != UnityWebRequest.Result.Success)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnityWebRequestException(_asyncOperation.webRequest);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> IsCompleted =&gt; _asyncOperation.isDone;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UnityWebRequestException</span> : <span class="title">Exception</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UnityWebRequestException</span>(<span class="params">UnityWebRequest request</span>) </span></span><br><span class="line"><span class="function">        : <span class="title">base</span>(<span class="params"><span class="string">$&quot;Error: <span class="subst">&#123;request.error&#125;</span>\nURL: <span class="subst">&#123;request.url&#125;</span>&quot;</span></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">UnityWebRequestAsyncOperationExtensions</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> UnityWebRequestAsyncOperationAwaiter <span class="title">GetAwaiter</span>(<span class="params"><span class="keyword">this</span> UnityWebRequestAsyncOperation asyncOperation</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UnityWebRequestAsyncOperationAwaiter(asyncOperation);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">AIDebugger</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Command(<span class="string">&quot;SetAIMatch&quot;</span>, QuickName = <span class="string">&quot;è®¾ç½®åŒ¹é…AI&quot;</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SetAIMatch</span>(<span class="params">[CommandParameter(<span class="string">&quot;æ˜¯å¦å¼€å¯AIåŒ¹é…&quot;</span></span>)]<span class="built_in">bool</span> enableAI)</span></span><br><span class="line">    &#123;</span><br><span class="line">        AIMatchDebugger.PostRequest(UserData.Instance.userId, enableAI);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AIMatchDebugger</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;UI Elements&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> InputField userIdInput;</span><br><span class="line">    <span class="keyword">public</span> Toggle needAIToggle;</span><br><span class="line">    <span class="keyword">public</span> Toggle needAIOnlyToggle;</span><br><span class="line">    <span class="keyword">public</span> Button submitButton;</span><br><span class="line">    <span class="keyword">public</span> Text statusText;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Header(<span class="string">&quot;Server Config&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">const</span> <span class="built_in">string</span> serverURL = <span class="string">&quot;http://fhdz3dfzwss.nalrer.cn:8016/gtest/dizhu/aiMatch&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        submitButton.onClick.AddListener(SubmitForm);</span><br><span class="line">        LoadDefaultValues();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">LoadDefaultValues</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        userIdInput.text = <span class="string">&quot;72087&quot;</span>;</span><br><span class="line">        needAIToggle.isOn = <span class="literal">true</span>;</span><br><span class="line">        needAIOnlyToggle.isOn = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SubmitForm</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// PostRequest();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">async</span> Task <span class="title">PostRequest</span>(<span class="params"><span class="built_in">int</span> userId, <span class="built_in">bool</span> enableAI</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// å‡†å¤‡è¡¨å•æ•°æ®</span></span><br><span class="line">            WWWForm form = <span class="keyword">new</span> WWWForm();</span><br><span class="line">            form.AddField(<span class="string">&quot;userId&quot;</span>, userId.ToString());</span><br><span class="line">            form.AddField(<span class="string">&quot;needAI&quot;</span>, enableAI ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">            form.AddField(<span class="string">&quot;needAIOnly&quot;</span>, enableAI ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            QDebug.Log(<span class="string">&quot;è¯·æ±‚å‘å‡ºå»äº†&quot;</span>);</span><br><span class="line">            <span class="comment">// å‘é€è¯·æ±‚</span></span><br><span class="line">            <span class="keyword">using</span> (UnityWebRequest www = UnityWebRequest.Post(serverURL, form))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">await</span> www.SendWebRequest();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (www.result != UnityWebRequest.Result.Success)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// statusText.text = $&quot;Error: &#123;www.error&#125;&quot;;</span></span><br><span class="line">                    QDebug.LogError(www.error);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// statusText.text = &quot;ä¿®æ”¹æˆåŠŸ&quot;;</span></span><br><span class="line">                    QDebug.Log(<span class="string">&quot;Form upload complete!&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            QDebug.LogError(<span class="string">&quot;å‘ç”Ÿå¼‚å¸¸äº†&quot;</span>);</span><br><span class="line">            <span class="keyword">throw</span>; <span class="comment">// TODO handle exception</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>æ€»ç»“</h1><p>ç¬”è€…æš‚ä¸”è®¤ä¸ºç¬¬ä¸‰ç§ Task-Like Typesæ˜¯å½“å‰ä¸»æµçš„C#ä¸­å®ç°è‡ªå®šä¹‰å¼‚æ­¥çš„æ–¹å¼. æƒ³è¦ç”¨è¿™ç§æ–¹å¼å®ç°å¼‚æ­¥, ä½ éœ€è¦:</p><p>ä½ æœ‰å¾ˆå¤šçš„æ“ä½œ, æ— è®ºæ˜¯C#æä¾›ç»™ä½ çš„Taskè¿˜æ˜¯ä½ è‡ªå·±åŸºäºC#å®ç°çš„ç±»Taskéƒ½æ˜¯æŠŠä½ æƒ³è¦ç”¨å¼‚æ­¥æ–¹å¼æ‰§è¡Œçš„æ“ä½œåŒ…è£…èµ·æ¥.</p><p>æ„å»ºè‡ªå·±çš„å¼‚æ­¥æœ‰ä¸‰ä¸ªé‡è¦è§’è‰²:</p><ul><li>è‡ªå·±çš„AsyncMethodBuilder</li><li>è‡ªå·±çš„Awaiter</li><li>è‡ªå·±çš„TaskLikeç±»å‹ è¿™é‡Œæ³¨æ„<code>awaiter</code>æ˜¯<code>awaiter</code>, <code>tasklike</code>æ˜¯<code>tasklike</code>, ä½†æ˜¯ETTaskå°†æ—¢æ˜¯tasklikeåˆæ˜¯awaiter</li></ul><ol><li>æœ‰ä¸€ä¸ªåä¸º<code>TaskLikeMethodBuilder</code>çš„method builder, è¿™ä¸ªBuilderé‡Œé¢éœ€è¦å¦‚ä¸‹æ¥å£<ul><li>public static TaskLikeMethodBuilder <strong>Create</strong>()æ¥å£</li><li>public void <strong>Start</strong><TStateMachine>(ref TStateMachine stateMachine) where TStateMachine : IAsyncStateMachineæ¥å£</li><li>public void <strong>SetException</strong>(Exception e)æ¥å£</li><li>public void <strong>SetResult</strong>() æ¥å£</li><li>public void <strong>AwaitOnCompleted</strong>&lt;TAwaiter, TStateMachine&gt;(<br>ref TAwaiter awaiter, ref TStateMachine stateMachine)<br>where TAwaiter : INotifyCompletion<br>where TStateMachine : IAsyncStateMachine æ¥å£</li><li>public void <strong>AwaitUnsafeOnCompleted</strong>&lt;TAwaiter, TStateMachine&gt;(<br>ref TAwaiter awaiter, ref TStateMachine stateMachine)<br>where TAwaiter : ICriticalNotifyCompletion<br>where TStateMachine : IAsyncStateMachine æ¥å£</li><li>public void <strong>SetStateMachine</strong>(IAsyncStateMachine stateMachine) æ¥å£</li><li>public TaskLike <strong>Task</strong> // åå­—å¿…é¡»æ˜¯Task</li></ul></li><li>æœ‰ä¸€ä¸ªå®ç°äº†ICriticalNotifyCompletionæ¥å£çš„ç±»<ul><li>OnCompleted(Action continuation)</li><li>UnsafeOnCompleted(Action continuation)</li></ul></li><li>ä¸€ä¸ªTasklikeç±»<ul><li>æœ‰ä¸€ä¸ªGetAwaiter</li><li>GetResult()æ¥å£</li><li>IsCompletedå±æ€§ æ³¨æ„å¿…é¡»æ˜¯å±æ€§(Property)</li></ul></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Dissecting the async methods in CSharp</title>
      <link href="/posts/72dba58e/"/>
      <url>/posts/72dba58e/</url>
      
        <content type="html"><![CDATA[<h1>å…³äºå¼‚æ­¥çš„å†å²</h1><p>C#å¼€å‘è€…åœ¨ç¬¬ä¸€æ¬¡æ¥è§¦å¼‚æ­¥çš„æ¦‚å¿µ, åº”è¯¥æ˜¯é€šè¿‡Taskç±»å‹. Taskæ˜¯åœ¨<code>.Net 4.0</code>çš„æ—¶å€™è¢«å¼•å…¥çš„. ä¸€ä¸ªtaskå°±æ˜¯ä¸€ä¸ªworkå•å…ƒ, ä¸”è¯¥taskæ‰¿è¯º, åœ¨è¿™ä¸ªtaskæœªæ¥å®Œæˆçš„æ—¶å€™, ä¼šå°†ç»“æœè¿”å›ç»™taskçš„è°ƒç”¨è€…. è¿™ä¸ªTaskå¯èƒ½æ˜¯ç”±IOæ“ä½œæ”¯æŒæˆ–è€…è®¡ç®—å¯†é›†å‹æ“ä½œ(è¿™æ­£å¥½å¯¹åº”äº†ç¬”è€…åœ¨åç¨‹éƒ¨åˆ†æ‰€è¯´çš„CPUå¯†é›†å‹æ“ä½œå’ŒIOå‹æ“ä½œ, Unityåç¨‹åªèƒ½ç”¨æ¥åšIOå‹çš„å¼‚æ­¥æ“ä½œ). é‡è¦çš„æ˜¯è¯¥æ“ä½œçš„ç»“æœæ˜¯è‡ªåŒ…å«çš„ï¼Œä¸”å…·æœ‰ä¸€ç­‰å…¬æ°‘èº«ä»½ã€‚ä½ å¯ä»¥è‡ªç”±ä¼ é€’è¿™ä¸ª&quot;æœªæ¥&quot;ï¼šå°†å…¶å­˜å‚¨åœ¨å˜é‡ä¸­ã€ä»æ–¹æ³•è¿”å›å®ƒã€æˆ–ä¼ é€’ç»™å…¶ä»–æ–¹æ³•ã€‚ä½ å¯ä»¥å°†ä¸¤ä¸ª&quot;æœªæ¥&quot;åˆå¹¶å½¢æˆæ–°çš„ä»»åŠ¡ï¼Œå¯ä»¥åŒæ­¥ç­‰å¾…ç»“æœï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ·»åŠ &quot;å»¶ç»­&quot;æ¥&quot;ç­‰å¾…&quot;ç»“æœã€‚ä»…å‡­ä»»åŠ¡å®ä¾‹æœ¬èº«ï¼Œä½ å°±èƒ½å†³å®šåœ¨æ“ä½œæˆåŠŸã€å¤±è´¥æˆ–è¢«å–æ¶ˆæ—¶é‡‡å–ä½•ç§å¤„ç†ã€‚</p><p>ä»»åŠ¡å¹¶è¡Œåº“ (TPL) æ”¹å˜äº†æˆ‘ä»¬å¯¹å¹¶å‘ç¼–ç¨‹çš„è®¤çŸ¥ï¼Œè€Œ C# 5 é€šè¿‡å¼•å…¥ async/await è¿›ä¸€æ­¥æ¨åŠ¨äº†è¿™ä¸€å‘å±•ã€‚async/await è®©ä»»åŠ¡çš„ç»„åˆå˜å¾—æ›´åŠ å®¹æ˜“ï¼Œå¹¶å…è®¸å¼€å‘è€…ä½¿ç”¨ç†Ÿæ‚‰çš„ä»£ç ç»“æ„ï¼Œå¦‚ try/catchã€using ç­‰ã€‚ä½†æ˜¯async/awaitä¹Ÿæœ‰å…¶å¼€é”€. è¦ç†è§£å…·ä½“å¼€é”€æ˜¯ä»€ä¹ˆ, æˆ‘ä»¬éœ€è¦æ·±å…¥åº•å±‚æœºåˆ¶ä¸­.</p><h1>å¼‚æ­¥æ–¹æ³•å†…éƒ¨</h1><p>æ™®é€šæ–¹æ³•åªæœ‰ä¸€ä¸ªå…¥å£ç‚¹å’Œä¸€ä¸ªé€€å‡ºç‚¹ï¼ˆè™½ç„¶å¯èƒ½æœ‰å¤šä¸ª return è¯­å¥ï¼Œä½†åœ¨è¿è¡Œæ—¶ï¼Œæ¯æ¬¡è°ƒç”¨ä»…æœ‰ä¸€ä¸ªå®é™…é€€å‡ºç‚¹ï¼‰ã€‚ä½† å¼‚æ­¥æ–¹æ³•ï¼ˆ*ï¼‰ å’Œ è¿­ä»£å™¨æ–¹æ³•ï¼ˆåŒ…å« yield return çš„æ–¹æ³•ï¼‰åˆ™ä¸åŒã€‚å¯¹äºå¼‚æ­¥æ–¹æ³•è€Œè¨€ï¼Œè°ƒç”¨æ–¹å‡ ä¹å¯ä»¥ç«‹å³è·å–ç»“æœï¼ˆå³ Task æˆ– Task<T>ï¼‰ï¼Œç„¶åé€šè¿‡è¿”å›çš„ä»»åŠ¡ï¼ˆTaskï¼‰æ¥ â€œawaitâ€ æ–¹æ³•çš„å®é™…æ‰§è¡Œç»“æœã€‚</p><p>ï¼ˆ*ï¼‰æˆ‘ä»¬å®šä¹‰çš„ â€œå¼‚æ­¥æ–¹æ³•â€ æ˜¯æŒ‡ç”¨ async ä¸Šä¸‹æ–‡å…³é”®å­—æ ‡è®°çš„æ–¹æ³•ã€‚è¿™å¹¶ä¸ä¸€å®šæ„å‘³ç€è¯¥æ–¹æ³•ä¼šå¼‚æ­¥æ‰§è¡Œï¼Œç”šè‡³å®Œå…¨ä¸æ„å‘³ç€å®ƒæ˜¯å¼‚æ­¥çš„ã€‚å®ƒä»…è¡¨ç¤º ç¼–è¯‘å™¨ä¼šå¯¹è¯¥æ–¹æ³•è¿›è¡ŒæŸäº›ç‰¹æ®Šè½¬æ¢ã€‚</p><p>çœ‹ä¸€ä¸‹ä¸‹é¢è¿™ä¸ªå¼‚æ­¥æ–¹æ³•:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">StockPrices</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">decimal</span>&gt; _stockPrices;</span><br><span class="line">    <span class="comment">// è¢«æ ‡è®°äº†asyncçš„æ–¹æ³•, Compilerä¼šåœ¨èƒŒåå°†å…¶å†…éƒ¨çš„é€»è¾‘è½¬è°ƒç”¨ä¸€ä¸ªçŠ¶æ€æœº</span></span><br><span class="line">    <span class="comment">// è€Œè¿™ä¸ªå¼‚æ­¥æ–¹æ³•ä¸­åŸæ¥çš„é€»è¾‘ä¼šå…¨éƒ¨è½¬ç§»åˆ°Compilerè‡ªåŠ¨ç”Ÿæˆçš„çŠ¶æ€æœºçš„MoveNextæ–¹æ³•ä¸­ </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;<span class="built_in">decimal</span>&gt; <span class="title">GetStockPriceForAsync</span>(<span class="params"><span class="built_in">string</span> companyId</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> InitializeMapIfNeededAsync();</span><br><span class="line">        _stockPrices.TryGetValue(companyId, <span class="keyword">out</span> <span class="keyword">var</span> result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// è¢«æ ‡è®°äº†asyncçš„æ–¹æ³•, Compilerä¼šåœ¨èƒŒåå°†å…¶è½¬æ¢æˆçŠ¶æ€æœº</span></span><br><span class="line">    <span class="comment">// è€Œè¿™ä¸ªå¼‚æ­¥æ–¹æ³•ä¸­åŸæ¥çš„é€»è¾‘ä¼šå…¨éƒ¨è½¬ç§»åˆ°Compilerè‡ªåŠ¨ç”Ÿæˆçš„çŠ¶æ€æœºçš„MoveNextæ–¹æ³•ä¸­ </span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">async</span> Task <span class="title">InitializeMapIfNeededAsync</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_stockPrices != <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">await</span> Task.Delay(<span class="number">42</span>);</span><br><span class="line">        <span class="comment">// Getting the stock prices from the external source and cache in memory.</span></span><br><span class="line">        _stockPrices = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">decimal</span>&gt; &#123; &#123; <span class="string">&quot;MSFT&quot;</span>, <span class="number">42</span> &#125; &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><blockquote><p>ä¸Šé¢è¿™æ®µä»£ç ä¸­çš„ä¸¤ä¸ªæ–¹æ³•éƒ½ä½¿ç”¨äº†<code>async</code>æ ‡è®°, åˆ°å¤´æ¥éƒ½åªæ˜¯ä¸ºäº†<code>await Task.Delay(42)</code>è¿™ä¸€è¡Œä»£ç æœåŠ¡çš„.<br>ä¸ºäº†æ›´å¥½çš„ç†è§£ç¼–è¯‘å™¨åšäº†æˆ–è€…èƒ½åšä»€ä¹ˆ, è®©æˆ‘ä»¬å°è¯•ç€æ‰‹å†™ä¸€ä¸‹è½¬æ¢è¿‡ç¨‹</p></blockquote></blockquote><h1>æ‰‹åŠ¨è§£æ„å¼‚æ­¥æ–¹æ³•</h1><p>TPLï¼ˆä»»åŠ¡å¹¶è¡Œåº“ï¼‰æä¾›äº†ä¸¤å¤§æ ¸å¿ƒæ„å»ºæ¨¡å—ï¼Œå¸®åŠ©æˆ‘ä»¬æ„é€ å’Œç»„åˆä»»åŠ¡ï¼š</p><ul><li>ä»»åŠ¡å»¶ç»­ï¼ˆTask Continuationï¼‰-&gt; é€šè¿‡ <code>Task.ContinueWith</code>å®ç°</li><li>æ‰‹åŠ¨æ„å»ºä»»åŠ¡ -&gt; é€šè¿‡ <code>TaskCompletionSource&lt;T&gt;</code> ç±»å®ç°<br>ï¼ˆæ³¨ï¼šå‰è€…ç”¨äºé“¾å¼ç¼–æ’ä»»åŠ¡ï¼Œåè€…ç”¨äºæ‰‹åŠ¨æ§åˆ¶ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸã€‚ï¼‰</li></ul><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">GetStockPriceForAsync_StateMachine</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">enum</span> State &#123; Start, Step1, &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> StockPrices @this;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> <span class="built_in">string</span> _companyId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> TaskCompletionSource&lt;<span class="built_in">decimal</span>&gt; _tcs;</span><br><span class="line">    <span class="keyword">private</span> Task _initializeMapIfNeededTask;</span><br><span class="line">    <span class="keyword">private</span> State _state = State.Start;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GetStockPriceForAsync_StateMachine</span>(<span class="params">StockPrices @<span class="keyword">this</span>, <span class="built_in">string</span> companyId</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.@this = @this;</span><br><span class="line">        _companyId = companyId;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (_state == State.Start)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// The code from the start of the method to the first &#x27;await&#x27;.</span></span><br><span class="line"> </span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(_companyId))</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException();</span><br><span class="line"> </span><br><span class="line">                _initializeMapIfNeededTask = @this.InitializeMapIfNeeded();</span><br><span class="line"> </span><br><span class="line">                <span class="comment">// Update state and schedule continuation</span></span><br><span class="line">                _state = State.Step1;</span><br><span class="line">                _initializeMapIfNeededTask.ContinueWith(_ =&gt; Start());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (_state == State.Step1)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// Need to check the error and the cancel case first</span></span><br><span class="line">                <span class="keyword">if</span> (_initializeMapIfNeededTask.Status == TaskStatus.Canceled)</span><br><span class="line">                    _tcs.SetCanceled();</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (_initializeMapIfNeededTask.Status == TaskStatus.Faulted)</span><br><span class="line">                    _tcs.SetException(_initializeMapIfNeededTask.Exception.InnerException);</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// The code between first await and the rest of the method</span></span><br><span class="line"> </span><br><span class="line">                    @this._stockPrices.TryGetValue(_companyId, <span class="keyword">out</span> <span class="keyword">var</span> result);</span><br><span class="line">                    _tcs.SetResult(result);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            _tcs.SetException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> Task&lt;<span class="built_in">decimal</span>&gt; Task =&gt; _tcs.Task;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">decimal</span>&gt; <span class="title">GetStockPriceForAsync</span>(<span class="params"><span class="built_in">string</span> companyId</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> stateMachine = <span class="keyword">new</span> GetStockPriceForAsync_StateMachine(<span class="keyword">this</span>, companyId);</span><br><span class="line">    stateMachine.Start();</span><br><span class="line">    <span class="keyword">return</span> stateMachine.Task;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç è™½ç„¶å†—é•¿ï¼Œä½†é€»è¾‘ç›¸å¯¹ç›´æ¥ã€‚åŸå…ˆåœ¨ GetStockPriceForAsync ä¸­çš„æ‰€æœ‰é€»è¾‘éƒ½è¢«è½¬ç§»åˆ°äº† GetStockPriceForAsync_StateMachine.Start æ–¹æ³•ä¸­ï¼Œè¯¥æ–¹æ³•é‡‡ç”¨äº†&quot;å»¶ç»­ä¼ é€’é£æ ¼&quot;(continuation passing style)ã€‚å¼‚æ­¥è½¬æ¢çš„æ ¸å¿ƒç®—æ³•å°±æ˜¯å°†åŸå§‹æ–¹æ³•åœ¨ await è¾¹ç•Œå¤„åˆ†å‰²æˆè‹¥å¹²ä»£ç å—ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªä»£ç å—ï¼šä»æ–¹æ³•å¼€å§‹åˆ°ç¬¬ä¸€ä¸ª await ä¹‹é—´çš„ä»£ç </li><li>ç¬¬äºŒä¸ªä»£ç å—ï¼šä»ç¬¬ä¸€ä¸ª await åˆ°ç¬¬äºŒä¸ª await ä¹‹é—´çš„ä»£ç </li><li>ç¬¬ä¸‰ä¸ªä»£ç å—ï¼šä»ç¬¬äºŒä¸ª await åˆ°ç¬¬ä¸‰ä¸ª await æˆ–æ–¹æ³•ç»“æŸçš„ä»£ç  ä»¥æ­¤ç±»æ¨</li></ul><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Step 1 of the generated state machine:</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(_companyId)) <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException();</span><br><span class="line">_initializeMapIfNeededTask = @this.InitializeMapIfNeeded();</span><br></pre></td></tr></table></figure><p>æ¯ä¸ªè¢« await çš„ä»»åŠ¡ç°åœ¨éƒ½å˜æˆäº†çŠ¶æ€æœºçš„ä¸€ä¸ªå­—æ®µï¼Œè€Œ Start æ–¹æ³•ä¼šå°†è‡ªå·±æ³¨å†Œä¸ºè¿™äº›ä»»åŠ¡çš„å»¶ç»­ï¼ˆcontinuationï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_state = State.Step1;</span><br><span class="line">_initializeMapIfNeededTask.ContinueWith(_ =&gt; Start());</span><br></pre></td></tr></table></figure><p>éšåï¼Œå½“ä»»åŠ¡å®Œæˆæ—¶ï¼ŒStartæ–¹æ³•ä¼šè¢«å›è°ƒï¼Œå¹¶é€šè¿‡æ£€æŸ¥_stateå­—æ®µæ¥ç¡®å®šå½“å‰æ‰§è¡Œé˜¶æ®µã€‚æ¥ç€ï¼ŒçŠ¶æ€æœºä¼šåˆ¤æ–­ä»»åŠ¡æ˜¯æˆåŠŸå®Œæˆã€è¢«å–æ¶ˆè¿˜æ˜¯å‡ºç°å¼‚å¸¸ã€‚å¦‚æœæ˜¯æˆåŠŸå®Œæˆçš„æƒ…å†µï¼ŒçŠ¶æ€æœºå°±ä¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªä»£ç å—ã€‚å½“æ‰€æœ‰æ“ä½œéƒ½å®Œæˆåï¼ŒçŠ¶æ€æœºä¼šè®¾ç½®TaskCompletionSource<T>å®ä¾‹çš„ç»“æœå€¼ï¼Œæ­¤æ—¶ä»GetStockPricesForAsyncè¿”å›çš„ä»»åŠ¡çŠ¶æ€å°±ä¼šå˜æ›´ä¸ºå·²å®Œæˆã€‚</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The code between first await and the rest of the method</span></span><br><span class="line"> </span><br><span class="line">@this._stockPrices.TryGetValue(_companyId, <span class="keyword">out</span> <span class="keyword">var</span> result);</span><br><span class="line">_tcs.SetResult(result); <span class="comment">// The caller gets the result back</span></span><br></pre></td></tr></table></figure><p>è¿™ç§&quot;å®ç°æ–¹å¼&quot;å­˜åœ¨å‡ ä¸ªä¸¥é‡ç¼ºé™·ï¼š</p><ul><li>å¤§é‡å †å†…å­˜åˆ†é…ï¼š<ul><li>çŠ¶æ€æœºå®ä¾‹éœ€è¦1æ¬¡å†…å­˜åˆ†é…</li><li>TaskCompletionSource<T>éœ€è¦1æ¬¡åˆ†é…</li><li>TaskCompletionSource<T>å†…éƒ¨ä»»åŠ¡éœ€è¦1æ¬¡åˆ†é…, æŒ‰ç…§GPTçš„è¯´æ³•<code>TaskCompletionSource&lt;decimal&gt;</code>å†…éƒ¨ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª<code>Task&lt;decimal&gt;</code> å®ä¾‹ï¼ˆé€šè¿‡å…¶ .Task å±æ€§è®¿é—®ï¼‰</li><li>å»¶ç»­å§”æ‰˜(delegate)éœ€è¦1æ¬¡åˆ†é…, æŒ‡çš„åº”è¯¥æ˜¯<code> _initializeMapIfNeededTask.ContinueWith(_ =&gt; Start());</code></li></ul></li><li>ç¼ºå°‘&quot;çƒ­è·¯å¾„ä¼˜åŒ–&quot;ï¼š<br>å½“è¢«ç­‰å¾…çš„ä»»åŠ¡å·²ç»å®Œæˆæ—¶ï¼Œå®Œå…¨æ²¡æœ‰å¿…è¦åˆ›å»ºå»¶ç»­å§”æ‰˜</li><li>å¯æ‰©å±•æ€§ä¸è¶³ï¼š<br>å®ç°ä¸Taskç±»ç´§å¯†è€¦åˆï¼Œå¯¼è‡´æ— æ³•ç”¨äºå…¶ä»–åœºæ™¯ï¼Œä¾‹å¦‚ï¼š<ul><li>ç­‰å¾…éTaskç±»å‹</li><li>è¿”å›éTask/Task<T>ç±»å‹</li></ul></li></ul><p>ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹ä¸€ä¸‹ä¸Šè¿°æåˆ°çš„ç¼ºé™·åœ¨çœŸæ­£çš„å¼‚æ­¥æœºåˆ¶ä¸­æ˜¯å¦‚ä½•è¢«è§£å†³çš„.</p><h1>å¼‚æ­¥æœºåˆ¶</h1><p>ç¼–è¯‘å™¨æ‰§è¡Œå¼‚æ­¥æ–¹æ³•è½¬æ¢çš„æ•´ä¸ªè¿‡ç¨‹, å…¶å®å·²ç»å’Œä¸Šé¢æˆ‘ä»¬æ‰‹åŠ¨å®ç°çš„æ–¹å¼ååˆ†æ¥è¿‘äº†. ä¸ºäº†å¾—åˆ°é¢„æœŸçš„è¡Œä¸º, ç¼–è¯‘å™¨ä¾èµ–äºä»¥ä¸‹çš„ç±»å‹:</p><ul><li>å¯¹äºä¸€ä¸ªå¼‚æ­¥æ–¹æ³•çš„ç”Ÿæˆçš„çŠ¶æ€æœº, å…¶è¡Œä¸ºä¼šåƒæ ˆå¸§ä¸€æ ·, å¹¶ä¸”è¯¥çŠ¶æ€æœºåŒ…å«åŸå§‹å¼‚æ­¥æ–¹æ³•ä¸­çš„å…¨éƒ¨é€»è¾‘</li><li><code>AsyncTaskMethodBuilder&lt;T&gt;</code>æŒæœ‰å®Œæˆçš„taskï¼ˆä¸ TaskCompletionSource<T> ç±»å‹éå¸¸ç›¸ä¼¼ï¼‰, å¹¶ä¸”ç®¡ç†çŠ¶æ€æœºçš„è½¬æ¢.</li><li><code>TaskAwaiter&lt;T&gt;</code>è´Ÿè´£åŒ…è£…task, å¹¶åœ¨éœ€è¦æ—¶è°ƒåº¦å…¶å»¶ç»­</li><li><code>MoveNetRunner</code>è´Ÿè´£åœ¨æ­£ç¡®çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­è°ƒç”¨<code>IAsyncStateMachine.MoveNext</code>æ–¹æ³•</li></ul><p>ç”Ÿæˆçš„çŠ¶æ€æœºåœ¨Debugæ¨¡å¼ä¸‹æ˜¯ä¸€ä¸ªç±», åœ¨Releaseæ¨¡å¼ä¸‹åˆ™æ˜¯ä¸€ä¸ªstruct. å…¶ä»–çš„ç±»å‹(é™¤äº†<code>MoveNextRunner</code>ç±»)åœ¨BCLä¸­å‡è¢«å®šä¹‰ä¸ºäº†struct.</p><p>ç¼–è¯‘å™¨ç”Ÿæˆçš„çŠ¶æ€æœºç±»å‹åç§°é€šå¸¸ç±»ä¼¼äº<code>&lt;YourMethodNameAsync&gt;d_1</code>, ä¸ºäº†é¿å…åç§°å†²çª, ç”Ÿæˆçš„åå­—ä¸­åŒ…å«äº†ä¸€äº›æ— æ•ˆçš„æ ‡è¯†ç¬¦å­—ç¬¦, è¿™äº›å­—ç¬¦æ— æ³•è¢«ç”¨æˆ·ç›´æ¥å®šä¹‰æˆ–å¼•ç”¨. ä½†æ˜¯ä¸ºäº†ç®€åŒ–è¯´æ˜, åœ¨åç»­çš„æ‰€æœ‰ç¤ºä¾‹ä¸­, æˆ‘ä»¬è¿˜æ˜¯å°†ä½¿ç”¨æœ‰æ•ˆçš„æ ‡è¯†ç¬¦æ¥æ›¿æ¢æ‰<code>&lt;</code>ã€<code>&gt;</code>ã€<code>_</code>è¿™äº›å­—ç¬¦, å¹¶ä¸”ä½¿ç”¨æ›´å®¹æ˜“ç†è§£çš„åå­—.</p><h1>åŸå§‹æ–¹æ³•</h1><p>åŸå§‹çš„å¼‚æ­¥æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªçŠ¶æ€æœºå®ä¾‹, ç”¨æ•è·çš„çŠ¶æ€ï¼ˆå¦‚æœæ–¹æ³•éé™æ€ï¼Œåˆ™åŒ…æ‹¬ this æŒ‡é’ˆï¼‰åˆå§‹åŒ–è¯¥å®ä¾‹, é€šè¿‡ä¼ é€’çŠ¶æ€æœºå®ä¾‹çš„å¼•ç”¨å¹¶è°ƒç”¨<code>AsyncTaskMethodBuilder&lt;T&gt;.Start</code>æ¥å¯åŠ¨æ‰§è¡Œ</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">AsyncStateMachine(typeof(_GetStockPriceForAsync_d__1))</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">decimal</span>&gt; <span class="title">GetStockPriceFor</span>(<span class="params"><span class="built_in">string</span> companyId</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    _GetStockPriceForAsync_d__1 _GetStockPriceFor_d__;</span><br><span class="line">    _GetStockPriceFor_d__.__this = <span class="keyword">this</span>;</span><br><span class="line">    _GetStockPriceFor_d__.companyId = companyId;</span><br><span class="line">    _GetStockPriceFor_d__.__builder = AsyncTaskMethodBuilder&lt;<span class="built_in">decimal</span>&gt;.Create();</span><br><span class="line">    _GetStockPriceFor_d__.__state = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">var</span> __t__builder = _GetStockPriceFor_d__.__builder;</span><br><span class="line">    __t__builder.Start&lt;_GetStockPriceForAsync_d__1&gt;(<span class="keyword">ref</span> _GetStockPriceFor_d__);</span><br><span class="line">    <span class="keyword">return</span> _GetStockPriceFor_d__.__builder.Task;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼ é€’å¼•ç”¨æ˜¯ä¸€ä¸ªé‡è¦çš„ä¼˜åŒ–, å› ä¸ºä¸€ä¸ªçŠ¶æ€æœºå¾€å¾€æ˜¯ç›¸å¯¹å¤§çš„ç»“æ„(å¤§äº100bytes), å› æ­¤ä¼ é€’å¼•ç”¨ä¼šé¿å…å†—ä½™æ‹·è´.<br>çŠ¶æ€æœºä»£ç å¦‚ä¸‹:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> _GetStockPriceForAsync_d__1 : IAsyncStateMachine</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> StockPrices __this;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> companyId;</span><br><span class="line">    <span class="keyword">public</span> AsyncTaskMethodBuilder&lt;<span class="built_in">decimal</span>&gt; __builder;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> __state;</span><br><span class="line">    <span class="keyword">private</span> TaskAwaiter __task1Awaiter;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MoveNext</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">decimal</span> result;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            TaskAwaiter awaiter;</span><br><span class="line">            <span class="keyword">if</span> (__state != <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// State 1 of the generated state machine:</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(companyId))</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException();</span><br><span class="line"> </span><br><span class="line">                awaiter = __this.InitializeLocalStoreIfNeededAsync().GetAwaiter();</span><br><span class="line"> </span><br><span class="line">                <span class="comment">// Hot path optimization: if the task is completed,</span></span><br><span class="line">                <span class="comment">// the state machine automatically moves to the next step</span></span><br><span class="line">                <span class="keyword">if</span> (!awaiter.IsCompleted)</span><br><span class="line">                &#123;</span><br><span class="line">                    __state = <span class="number">0</span>;</span><br><span class="line">                    __task1Awaiter = awaiter;</span><br><span class="line"> </span><br><span class="line">                    <span class="comment">// The following call will eventually cause boxing of the state machine.</span></span><br><span class="line">                    __builder.AwaitUnsafeOnCompleted(<span class="keyword">ref</span> awaiter, <span class="keyword">ref</span> <span class="keyword">this</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                awaiter = __task1Awaiter;</span><br><span class="line">                __task1Awaiter = <span class="literal">default</span>(TaskAwaiter);</span><br><span class="line">                __state = <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">            <span class="comment">// GetResult returns void, but it&#x27;ll throw if the awaited task failed.</span></span><br><span class="line">            <span class="comment">// This exception is catched later and changes the resulting task.</span></span><br><span class="line">            awaiter.GetResult();</span><br><span class="line">            __this._stocks.TryGetValue(companyId, <span class="keyword">out</span> result);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception exception)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Final state: failure</span></span><br><span class="line">            __state = <span class="number">-2</span>;</span><br><span class="line">            __builder.SetException(exception);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Final state: success</span></span><br><span class="line">        __state = <span class="number">-2</span>;</span><br><span class="line">        __builder.SetResult(result);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">void</span> IAsyncStateMachine.SetStateMachine(IAsyncStateMachine stateMachine)</span><br><span class="line">    &#123;</span><br><span class="line">        __builder.SetStateMachine(stateMachine);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆçš„çŠ¶æ€æœºä»£ç çœ‹èµ·æ¥æ¯”è¾ƒå¤æ‚, ä½†æ˜¯æœ¬è´¨ä¸Š, å®ƒå’Œæˆ‘ä»¬æ‰‹å†™çš„é‚£ä¸€ç‰ˆçš„ä»£ç æ˜¯ååˆ†ç›¸ä¼¼çš„.<br>å³ä½¿ä¸¤ä¸ªç‰ˆæœ¬ååˆ†ç›¸ä¼¼, ä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€äº›é‡è¦çš„ä¸åŒçš„.</p><ol><li>â€œHot Pathâ€ ä¼˜åŒ–</li></ol><p>ä¸åƒæˆ‘ä»¬åŸç”Ÿçš„æ–¹å¼, ç”Ÿæˆçš„çŠ¶æ€æœºçŸ¥é“ä¸€ä¸ªè¢«awaitedçš„taskå¯èƒ½å·²ç»å®Œæˆäº†</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">awaiter = __this.InitializeLocalStoreIfNeededAsync().GetAwaiter();</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Hot path optimization: if the task is completed,</span></span><br><span class="line"><span class="comment">// the state machine automatically moves to the next step</span></span><br><span class="line"><span class="keyword">if</span> (!awaiter.IsCompleted)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Irrelevant stuff</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// The following call will eventually cause boxing of the state machine.</span></span><br><span class="line">    __builder.AwaitUnsafeOnCompleted(<span class="keyword">ref</span> awaiter, <span class="keyword">ref</span> <span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿™ä¸ªè¢«awaitçš„taskå·²ç»å®Œæˆäº†(æ— è®ºæˆåŠŸä¸å¦), çŠ¶æ€æœºä¼šå‘å‰ç›´è¡Œä¸‹ä¸€æ­¥</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GetResult returns void, but it&#x27;ll throw if the awaited task failed.</span></span><br><span class="line"><span class="comment">// This exception is catched later and changes the resulting task.</span></span><br><span class="line">awaiter.GetResult();</span><br><span class="line">__this._stocks.TryGetValue(companyId, <span class="keyword">out</span> result);</span><br></pre></td></tr></table></figure><p>è¿™å°±æ„å‘³ç€, å¦‚æœæ‰€æœ‰awaitedçš„taskéƒ½å·²ç»å®Œæˆäº†, æ•´ä¸ªçŠ¶æ€æœºå°†åªä¼šåœç•™åœ¨æ ˆä¸Š. ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ç”šè‡³åœ¨ä»Šå¤©å¦‚æœæ‰€æœ‰awaitedçš„taskéƒ½å·²ç»å®Œæˆæˆ–è€…åŒæ­¥å®Œæˆäº†, é‚£ä¹ˆè¿™ä¸ªå¼‚æ­¥æ–¹æ³•æ˜¯å¯ä»¥åªä¼šé€ æˆå¾ˆå°çš„å†…å­˜å¼€é”€çš„. ä»…å‰©çš„å¼€é”€åªæ˜¯è¿™ä¸ªtaskæœ¬èº«.</p><ol start="2"><li>é”™è¯¯å¤„ç†</li></ol><p>å½“å‰é€»è¾‘å¹¶æœªä¸“é—¨å¤„ç†ä»»åŠ¡å¤„äºæ•…éšœçŠ¶æ€æˆ–å·²å–æ¶ˆçŠ¶æ€çš„æƒ…å†µã€‚çŠ¶æ€æœºé€šè¿‡è°ƒç”¨awaiter.GetResult()æ–¹æ³•ï¼Œå½“ä»»åŠ¡è¢«å–æ¶ˆæ—¶å°†æŠ›å‡ºTaskCancelledExceptionï¼Œè‹¥ä»»åŠ¡å¤±è´¥åˆ™æŠ›å‡ºå…¶ä»–å¼‚å¸¸ã€‚è¿™ç§è®¾è®¡ååˆ†ä¼˜é›…ï¼Œå› ä¸ºGetResult()åœ¨é”™è¯¯å¤„ç†æœºåˆ¶ä¸Šä¸task.Wait()æˆ–task.Resultæœ‰æœ¬è´¨åŒºåˆ«ã€‚</p><p>æ— è®ºæ˜¯task.Wait()è¿˜æ˜¯task.Resultï¼Œå³ä¾¿ä»»åŠ¡å› å•ä¸€å¼‚å¸¸å¯¼è‡´å¤±è´¥ï¼Œå®ƒä»¬éƒ½ä¼šæŠ›å‡ºAggregateExceptionã€‚è¿™èƒŒåçš„é€»è¾‘å¾ˆç®€å•ï¼šä»»åŠ¡ä¸ä»…å¯èƒ½ä»£è¡¨é€šå¸¸åªæœ‰å•ä¸€æ•…éšœçš„IOæ“ä½œï¼Œä¹Ÿå¯èƒ½æ˜¯å¹¶è¡Œè®¡ç®—çš„ç»“æœã€‚åè€…å¯èƒ½äº§ç”Ÿå¤šä¸ªé”™è¯¯ï¼Œè€ŒAggregateExceptionæ­£æ˜¯ä¸ºèšåˆæ‰€æœ‰é”™è¯¯è€Œè®¾è®¡ã€‚</p><p>ä½†<code>async/await</code>æ¨¡å¼ä¸“ä¸ºå¼‚æ­¥æ“ä½œè®¾è®¡ï¼Œè¿™ç±»æ“ä½œé€šå¸¸æœ€å¤šåªä¼šäº§ç”Ÿä¸€ä¸ªé”™è¯¯ã€‚å› æ­¤è¯­è¨€è®¾è®¡è€…è®¤ä¸ºï¼Œè‹¥<code>awaiter.GetResult()</code>èƒ½å¯¹AggregateExceptionè¿›è¡Œè§£åŒ…å¹¶ä»…æŠ›å‡ºé¦–ä¸ªå¼‚å¸¸ï¼Œå°†æ›´ç¬¦åˆä½¿ç”¨åœºæ™¯ã€‚è¿™ä¸€è®¾è®¡å¹¶éå®Œç¾ï¼Œæˆ‘ä»¬å°†åœ¨åç»­æ–‡ç« ä¸­çœ‹åˆ°è¿™ç§æŠ½è±¡æ–¹æ¡ˆå¯èƒ½å­˜åœ¨çš„æ¼æ´ã€‚</p><p>å¼‚æ­¥çŠ¶æ€æœºåªæ˜¯æ•´ä¸ªæ‹¼å›¾çš„ä¸€éƒ¨åˆ†ã€‚è¦å®Œæ•´ç†è§£å…¶è¿ä½œæœºåˆ¶ï¼Œæˆ‘ä»¬è¿˜éœ€äº†è§£çŠ¶æ€æœºå®ä¾‹å¦‚ä½•ä¸<code>TaskAwaiter&lt;T&gt;</code>å’Œ<code>AsyncTaskMethodBuilder&lt;T&gt;</code>è¿›è¡Œäº¤äº’ã€‚</p><h1>è¿™äº›æ¨¡å—æ˜¯å¦‚ä½•è¢«è”ç³»åˆ°ä¸€èµ·çš„å‘¢?</h1><p><a href="https://devblogs.microsoft.com/wp-content/uploads/sites/31/2019/06/Async_sequence_state_machine_thumb.png"></a></p><p>å›¾è¡¨çœ‹ä¼¼è¿‡äºå¤æ‚ï¼Œä½†æ¯ä¸ªç»„ä»¶éƒ½ç»è¿‡ç²¾å¿ƒè®¾è®¡ä¸”æ‰®æ¼”ç€é‡è¦è§’è‰²ã€‚æœ€æœ‰è¶£çš„åä½œå‘ç”Ÿåœ¨ç­‰å¾…çš„ä»»åŠ¡å°šæœªå®Œæˆæ—¶ï¼ˆå›¾ä¸­ç”¨æ£•è‰²çŸ©å½¢æ ‡è®°ï¼‰ï¼š</p><p>çŠ¶æ€æœºæ³¨å†Œä»»åŠ¡å»¶ç»­</p><ul><li>çŠ¶æ€æœºè°ƒç”¨ <code>__builder.AwaitUnsafeOnCompleted(ref awaiter, ref this)</code>ï¼Œå°†è‡ªèº«æ³¨å†Œä¸ºä»»åŠ¡çš„å»¶ç»­ã€‚</li><li><code>AsyncTaskMethodBuilder</code> ç¡®ä¿ä»»åŠ¡å®Œæˆåè°ƒç”¨ <code>IAsyncStateMachine.MoveNext</code> æ–¹æ³•(è¯‘æ³¨:è¿™å¥è¯çš„æ„æ€æ˜¯è¯´, åªè¦ä½ , æ›´å‡†ç¡®åœ°è¯´è¿™æ®µä»£ç æ˜¯ç¼–è¯‘å™¨ç”Ÿæˆçš„, è°ƒç”¨äº†<code>AwaitUnsafeOnCompleted</code>æ¥å£, é‚£ä¹ˆç¼–è¯‘å™¨å°±èƒ½ä¿è¯ä»»åŠ¡å®Œæˆåä¼šè°ƒç”¨<code>IAsyncStateMachine.MoveNext</code>æ–¹æ³•äº†)ï¼š<ul><li>æ•è·å½“å‰ æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆExecutionContextï¼‰ï¼Œåˆ›å»ºä¸€ä¸ª MoveNextRunner å®ä¾‹ï¼Œå°†å…¶ä¸å½“å‰çŠ¶æ€æœºå®ä¾‹å…³è”ã€‚</li><li>ä»<code>MoveNextRunner.Run</code>åˆ›å»ºä¸€ä¸ª Action å§”æ‰˜ï¼Œç”¨äºåœ¨æ•è·çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­æ¨è¿›çŠ¶æ€æœºã€‚è°ƒç”¨ TaskAwaiter.UnsafeOnCompleted(action)ï¼Œå°†ä¸Šè¿° Action å§”æ‰˜è°ƒåº¦ä¸ºç­‰å¾…ä»»åŠ¡çš„å»¶ç»­(è¯‘æ³¨: å¯ä»¥å»çœ‹ä¸€ä¸‹C#æºç ä¸­çš„<code>MoveNextRunner</code>å’Œ<code>AsyncMethodBuilderCore</code>çš„å®ç°, å…¶ä¸­æ¸…æ™°åœ°å±•ç¤ºäº†å¦‚ä½•æ•è·å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡ã€å°†<code>IAsyncStateMachine.MoveNext</code>æ–¹æ³•å’Œæ‰§è¡Œä¸Šä¸‹æ–‡ä¸€èµ·åŒ…è£…è¿›<code>MoveNextRunner.Run</code>ç”Ÿæˆçš„Actionä¸­)ã€‚<br>å½“ç­‰å¾…çš„ä»»åŠ¡å®Œæˆæ—¶ï¼Œæ³¨å†Œçš„å›è°ƒï¼ˆAction å§”æ‰˜ï¼‰è¢«è§¦å‘ï¼ŒçŠ¶æ€æœºç»§ç»­æ‰§è¡Œå¼‚æ­¥æ–¹æ³•çš„ä¸‹ä¸€æ®µä»£ç å—ã€‚</li></ul></li></ul><p>è¿™å¼ æ—¶åºå›¾ä¸­<code>AsyncTaskMethodBuilder</code>çš„<code>Start</code>æ–¹æ³•çš„å…·ä½“å®ç°åœ¨ä¸Šé¢ç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç ä¸­ä½“ç°, ç¬”è€…æŠŠè¿™éƒ¨åˆ†ä»£ç è´´åˆ°ä¸‹é¢:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span>Initiates the builder&#x27;s execution with the associated state machine.<span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;TStateMachine&quot;&gt;</span>Specifies the type of the state machine.<span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;stateMachine&quot;&gt;</span>The state machine instance, passed by reference.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">[<span class="meta">SecuritySafeCritical</span>]</span><br><span class="line">[<span class="meta">DebuggerStepThrough</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Start</span>&lt;<span class="title">TStateMachine</span>&gt;(<span class="params"><span class="keyword">ref</span> TStateMachine stateMachine</span>) <span class="keyword">where</span> TStateMachine : IAsyncStateMachine</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// See comment on AsyncMethodBuilderCore.Start</span></span><br><span class="line">    <span class="comment">// AsyncMethodBuilderCore.Start(ref stateMachine);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (stateMachine == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;stateMachine&quot;</span>);</span><br><span class="line">    Contract.EndContractBlock();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Run the MoveNext method within a copy-on-write ExecutionContext scope.</span></span><br><span class="line">    <span class="comment">// This allows us to undo any ExecutionContext changes made in MoveNext,</span></span><br><span class="line">    <span class="comment">// so that they won&#x27;t &quot;leak&quot; out of the first await.</span></span><br><span class="line"></span><br><span class="line">    ExecutionContextSwitcher ecs = <span class="literal">default</span>(ExecutionContextSwitcher);</span><br><span class="line">    RuntimeHelpers.PrepareConstrainedRegions();</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        ExecutionContext.EstablishCopyOnWriteScope(<span class="keyword">ref</span> ecs);</span><br><span class="line">        stateMachine.MoveNext();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span></span><br><span class="line">    &#123;</span><br><span class="line">        ecs.Undo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®å°±æ˜¯è°ƒç”¨äº†çŠ¶æ€æœºçš„MoveNextæ–¹æ³•, ç„¶åå›åˆ°ç¼–è¯‘å™¨ä¸ºæˆ‘ä»¬ç”Ÿæˆçš„ä»£ç ä¸­, åœ¨çŠ¶æ€æœºçš„MoveNextæ–¹æ³•é‡Œ, è°ƒç”¨äº†<code> __builder.AwaitUnsafeOnCompleted(ref awaiter, ref this);</code>æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>AsyncTaskMethodBuilder</code>ä¸­çš„<code>AwaitUnsafeOnCompleted</code>çš„å…·ä½“å®ç°:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> Schedules the specified state machine to be pushed forward when the specified awaiter completes.</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;TAwaiter&quot;&gt;</span>Specifies the type of the awaiter.<span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;TStateMachine&quot;&gt;</span>Specifies the type of the state machine.<span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;awaiter&quot;&gt;</span>The awaiter.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;stateMachine&quot;&gt;</span>The state machine.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment">// çŠ¶æ€æœºè°ƒç”¨ `__builder.AwaitUnsafeOnCompleted(ref awaiter, ref this)`ï¼Œå°†è‡ªèº«æ³¨å†Œä¸ºä»»åŠ¡çš„å»¶ç»­ã€‚</span></span><br><span class="line">[<span class="meta">SecuritySafeCritical</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AwaitUnsafeOnCompleted</span>&lt;<span class="title">TAwaiter</span>, <span class="title">TStateMachine</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">ref</span> TAwaiter awaiter, <span class="keyword">ref</span> TStateMachine stateMachine</span>)</span></span><br><span class="line"><span class="function">    <span class="keyword">where</span> TAwaiter : ICriticalNotifyCompletion</span></span><br><span class="line"><span class="function">    <span class="keyword">where</span> TStateMachine : IAsyncStateMachine</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æ•è·å½“å‰ æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆExecutionContextï¼‰ï¼Œåˆ›å»ºä¸€ä¸ª MoveNextRunner å®ä¾‹ï¼Œå°†å…¶ä¸å½“å‰çŠ¶æ€æœºå®ä¾‹å…³è”ã€‚</span></span><br><span class="line">        AsyncMethodBuilderCore.MoveNextRunner runnerToInitialize = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">var</span> continuation = m_coreState.GetCompletionAction(AsyncCausalityTracer.LoggingOn ? <span class="keyword">this</span>.Task : <span class="literal">null</span>, <span class="keyword">ref</span> runnerToInitialize);</span><br><span class="line">        Contract.Assert(continuation != <span class="literal">null</span>, <span class="string">&quot;GetCompletionAction should always return a valid action.&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If this is our first await, such that we&#x27;ve not yet boxed the state machine, do so now.</span></span><br><span class="line">        <span class="keyword">if</span> (m_coreState.m_stateMachine == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Force the Task to be initialized prior to the first suspending await so </span></span><br><span class="line">            <span class="comment">// that the original stack-based builder has a reference to the right Task.</span></span><br><span class="line">            <span class="keyword">var</span> builtTask = <span class="keyword">this</span>.Task;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Box the state machine, then tell the boxed instance to call back into its own builder,</span></span><br><span class="line">            <span class="comment">// so we can cache the boxed reference.</span></span><br><span class="line">            Contract.Assert(!Object.ReferenceEquals((<span class="built_in">object</span>)stateMachine, (<span class="built_in">object</span>)stateMachine), <span class="string">&quot;Expected an unboxed state machine reference&quot;</span>);</span><br><span class="line">            <span class="comment">// æ•è·å½“å‰ æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆExecutionContextï¼‰ï¼Œåˆ›å»ºä¸€ä¸ª MoveNextRunner å®ä¾‹ï¼Œå°†å…¶ä¸å½“å‰çŠ¶æ€æœºå®ä¾‹å…³è”ã€‚ è¿™è¡Œä»£ç å†…éƒ¨å°†ä¼ å…¥çš„stateMachineä¼ é€’ç»™MoveNextRunnerçš„StateMachine</span></span><br><span class="line">            m_coreState.PostBoxInitialization(stateMachine, runnerToInitialize, builtTask);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è°ƒç”¨ TaskAwaiter.UnsafeOnCompleted(action)ï¼Œå°†ä¸Šè¿° Action å§”æ‰˜è°ƒåº¦ä¸ºç­‰å¾…ä»»åŠ¡çš„å»¶ç»­ã€‚</span></span><br><span class="line">        awaiter.UnsafeOnCompleted(continuation);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception e)</span><br><span class="line">    &#123;</span><br><span class="line">        AsyncMethodBuilderCore.ThrowAsync(e, targetContext: <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸‹å°±å’Œæ—¶åºå›¾ä¸­çš„å†…å®¹å¯¹ä¸Šäº†:<br><code>var continuation = m_coreState.GetCompletionAction(AsyncCausalityTracer.LoggingOn ? this.Task : null, ref runnerToInitialize);</code> å¯¹åº”äº†æ—¶åºå›¾ä¸­<code>MoveNextRunner</code>éƒ¨åˆ†.</p><p><code>awaiter.UnsafeOnCompleted(continuation);</code>å¯¹åº”äº†æ—¶åºå›¾ä¸­çš„<code>TaskAwaiter</code>éƒ¨åˆ†, å½“è¿™ä¸ªawaiter completeäº†ä¹‹å, å°±ä¼šè§¦å‘ä¼ å…¥çš„continuation, ä¹Ÿå°±æ˜¯stateMachineçš„<code>MoveNext</code>. æ•´ä¸ªæµç¨‹å°±è·‘é€šäº†.</p><p>åœ¨æˆ‘ä»¬ç¤ºä¾‹ä¸­è¿™ä¸ªAwaiteræ˜¯ä¸€ä¸ª<code>TaskAwaiter</code>, å…¶<code>UnsafeOnCompleted</code>æ¥å£çš„å®ç°å¦‚ä¸‹:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span>Schedules the continuation onto the <span class="doctag">&lt;see cref=&quot;System.Threading.Tasks.Task&quot;/&gt;</span> associated with this <span class="doctag">&lt;see cref=&quot;TaskAwaiter&quot;/&gt;</span>.<span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;continuation&quot;&gt;</span>The action to invoke when the await operation completes.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;exception cref=&quot;System.ArgumentNullException&quot;&gt;</span>The <span class="doctag">&lt;paramref name=&quot;continuation&quot;/&gt;</span> argument is null (Nothing in Visual Basic).<span class="doctag">&lt;/exception&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;exception cref=&quot;System.InvalidOperationException&quot;&gt;</span>The awaiter was not properly initialized.<span class="doctag">&lt;/exception&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;remarks&gt;</span>This method is intended for compiler user rather than use directly in code.<span class="doctag">&lt;/remarks&gt;</span></span></span><br><span class="line">[<span class="meta">SecurityCritical</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UnsafeOnCompleted</span>(<span class="params">Action continuation</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    OnCompletedInternal(m_task, continuation, continueOnCapturedContext:<span class="literal">true</span>, flowExecutionContext:<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">OnCompletedInternal</span>(<span class="params">Task task, Action continuation, <span class="built_in">bool</span> continueOnCapturedContext, <span class="built_in">bool</span> flowExecutionContext</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (continuation == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;continuation&quot;</span>);</span><br><span class="line">    StackCrawlMark stackMark = StackCrawlMark.LookForMyCaller;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If TaskWait* ETW events are enabled, trace a beginning event for this await</span></span><br><span class="line">    <span class="comment">// and set up an ending event to be traced when the asynchronous await completes.</span></span><br><span class="line">    <span class="keyword">if</span> ( TplEtwProvider.Log.IsEnabled() || Task.s_asyncDebuggingEnabled)</span><br><span class="line">    &#123;</span><br><span class="line">        continuation = OutputWaitEtwEvents(task, continuation);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the continuation onto the awaited task.</span></span><br><span class="line">    task.SetContinuationForAwait(continuation, continueOnCapturedContext, flowExecutionContext, <span class="keyword">ref</span> stackMark);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>C#æºç çœ‹åˆ°è¿™é‡Œå…¶å®å°±å·®ä¸å¤šäº†, å†å¾€ä¸‹çœ‹è°ƒç”¨å¯¹äºC#çš„ä½¿ç”¨è€…æ„ä¹‰å°±ä¸æ˜¯å¾ˆå¤§äº†.</p><h1>æ‰§è¡Œä¸Šä¸‹æ–‡</h1><p>é—®é¢˜ï¼šä»€ä¹ˆæ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Ÿä¸ºä½•éœ€è¦è¿™ç§å¤æ‚çš„è®¾è®¡ï¼Ÿ<br>åœ¨åŒæ­¥ä»£ç ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹é€šè¿‡ <code>çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆThread-Local Storageï¼‰</code> ç»´æŠ¤ç¯å¢ƒä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šå®‰å…¨å‡­æ®ï¼ˆå¦‚ SecurityContextï¼‰åŒºåŸŸæ€§è®¾ç½®ï¼ˆå¦‚ CultureInfoï¼‰æˆ–è€…å…¶ä»–ä¸Šä¸‹æ–‡æ•°æ®ï¼ˆå¦‚ AsyncLocal<T> çš„å€¼ï¼‰<br>å½“ä¸‰ä¸ªæ–¹æ³•åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ä¾æ¬¡è°ƒç”¨æ—¶ï¼Œè¿™äº›ä¿¡æ¯ä¼šè‡ªåŠ¨åœ¨æ–¹æ³•é—´æµåŠ¨ã€‚ä½†æ˜¯å¯¹äºå¼‚æ­¥æ–¹æ³•æ¥è¯´å°±ä¸å†æ˜¯è¿™æ ·äº†. å¼‚æ­¥æ–¹æ³•çš„æ¯ä¸ªä»£ç æ®µï¼ˆå¦‚ await å‰åçš„ä»£ç ï¼‰å¯èƒ½åœ¨ä¸åŒçº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œ<code>çº¿ç¨‹æœ¬åœ°å­˜å‚¨(Thread-Local Storage)</code>å¤±æ•ˆã€‚<br>å› æ­¤æ‰§è¡Œä¸Šä¸‹æ–‡æ´¾ä¸Šç”¨åœº, å®ƒä¸º ä¸€ä¸ªé€»è¾‘æ§åˆ¶æµ ç»´æŠ¤ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå³ä½¿è¯¥æ§åˆ¶æµè·¨è¶Šå¤šçº¿ç¨‹ã€‚<br>ä¾‹å¦‚ï¼ŒTask.Run æˆ– ThreadPool.QueueUserWorkItem ä¼š è‡ªåŠ¨æ•è·è°ƒç”¨çº¿ç¨‹çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå¹¶å°†å…¶ä¸ä»»åŠ¡ç»‘å®šã€‚<br>å½“ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œè°ƒåº¦å™¨ï¼ˆå¦‚ TaskSchedulerï¼‰é€šè¿‡ ExecutionContext.Run åœ¨æ•è·çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œå§”æ‰˜ï¼Œç¡®ä¿ç¯å¢ƒä¿¡æ¯ï¼ˆå¦‚å®‰å…¨å‡­æ®ï¼‰æ— ç¼å»¶ç»­ã€‚</p><p>é€šè¿‡ä¸‹é¢è¿™ä¸ªä¾‹å­ç†è§£ä¸€ä¸‹:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> Task <span class="title">ExecutionContextInAction</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> li = <span class="keyword">new</span> AsyncLocal&lt;<span class="built_in">int</span>&gt;();</span><br><span class="line">    li.Value = <span class="number">42</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> Task.Run(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Task.Run restores the execution context</span></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;In Task.Run: &quot;</span> + li.Value);</span><br><span class="line">    &#125;).ContinueWith(_ =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// The continuation restores the execution context as well</span></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;In Task.ContinueWith: &quot;</span> + li.Value);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­, æ‰§è¡Œä¸Šä¸‹æ–‡é€šè¿‡<code>Task.Run</code>æµå‘äº†<code>Task.ContinueWith</code>. å› æ­¤ä¸Šé¢è¿™æ®µä»£ç çš„æ‰§è¡Œç»“æœå¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In Task.Run: 42</span><br><span class="line">In Task.ContinueWith: 42</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸æ˜¯æ‰€æœ‰åœ¨BCLä¸­çš„æ–¹æ³•éƒ½ä¼šè‡ªåŠ¨æ•è·å¹¶æ¢å¤æ‰§è¡Œä¸Šä¸‹æ–‡. ä¸¤ä¸ªä¾‹å¤–æ˜¯: <code>TaskAwaiter&lt;T&gt;.UnsafeOnCompledte</code>å’Œ<code>AsyncMethodBuilder&lt;T&gt;.AwaitUnsafeOnComplete</code>. è¿™çœ‹èµ·æ¥ååˆ†å¥‡æ€ª, è¯­è¨€è®¾è®¡è€…å†³å®šæ·»åŠ ä¸å®‰å…¨çš„æ–¹æ³•æ‰‹åŠ¨ä½¿ç”¨<code>AsyncMethodBuilder&lt;T&gt;</code>å’Œ<code>MoveNetRunner</code>è€Œä¸æ˜¯ä¾èµ–äºå†…å»ºçš„ç±»ä¼¼<code>AwaitTaskContinuation</code>è¿™æ ·çš„æœºåˆ¶é©±åŠ¨æ‰§è¡Œä¸Šä¸‹æ–‡, çŒœæµ‹è¿™æ˜¯å‡ºäºæ€§èƒ½é—®é¢˜è€ƒè™‘æˆ–è€…æ˜¯å¯¹ç°æœ‰å®ç°çš„å¦ä¸€ä¸ªå¦¥å.</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">async</span> Task <span class="title">ExecutionContextInAsyncMethod</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> li = <span class="keyword">new</span> AsyncLocal&lt;<span class="built_in">int</span>&gt;();</span><br><span class="line">    li.Value = <span class="number">42</span>;</span><br><span class="line">    <span class="keyword">await</span> Task.Delay(<span class="number">42</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The context is implicitely captured. li.Value is 42</span></span><br><span class="line">    Console.WriteLine(<span class="string">&quot;After first await: &quot;</span> + li.Value);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> tsk2 = Task.Yield();</span><br><span class="line">    tsk2.GetAwaiter().UnsafeOnCompleted(() =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// The context is not captured: li.Value is 0</span></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Inside UnsafeOnCompleted: &quot;</span> + li.Value);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> tsk2;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The context is captured: li.Value is 42</span></span><br><span class="line">    Console.WriteLine(<span class="string">&quot;After second await: &quot;</span> + li.Value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœæ˜¯:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">After first await: 42</span><br><span class="line">Inside UnsafeOnCompleted: 0</span><br><span class="line">After second await: 42</span><br></pre></td></tr></table></figure><h1>ç»“è®º</h1><ul><li><p>å¼‚æ­¥æ–¹æ³•ï¼ˆasyncï¼‰çš„åº•å±‚è¡Œä¸ºä¸åŒæ­¥æ–¹æ³•æˆªç„¶ä¸åŒï¼Œå…¶æ ¸å¿ƒæœºåˆ¶ä¾èµ–äºç¼–è¯‘å™¨ç”Ÿæˆçš„ çŠ¶æ€æœºï¼ˆState Machineï¼‰ï¼š</p></li><li><p>ç¼–è¯‘å™¨ä¼šä¸ºæ¯ä¸ªå¼‚æ­¥æ–¹æ³•ç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„çŠ¶æ€æœºï¼Œå°†åŸæ–¹æ³•çš„å…¨éƒ¨é€»è¾‘è½¬ç§»è‡³çŠ¶æ€æœºä¸­ã€‚ çŠ¶æ€æœºè´Ÿè´£è·Ÿè¸ªæ‰§è¡Œè¿›åº¦ï¼ˆé€šè¿‡çŠ¶æ€å€¼ï¼‰ã€æŒ‚èµ·ï¼ˆawait æ—¶ï¼‰ä¸æ¢å¤ï¼ˆä»»åŠ¡å®Œæˆæ—¶ï¼‰çš„é€»è¾‘æµè½¬ã€‚</p></li><li><p>å¯¹åŒæ­¥å®Œæˆçš„æ·±åº¦ä¼˜åŒ–. è‹¥æ‰€æœ‰ç­‰å¾…çš„ä»»åŠ¡ï¼ˆawait çš„ä»»åŠ¡ï¼‰å·²åŒæ­¥å®Œæˆï¼ˆå¦‚ç¼“å­˜å‘½ä¸­ã€å†…å­˜è®¡ç®—ç­‰æ— é˜»å¡æ“ä½œï¼‰ï¼Œå¼‚æ­¥æ–¹æ³•çš„æ€§èƒ½å¼€é”€æä½ï¼Œå‡ ä¹ä¸åŒæ­¥æ–¹æ³•æ— å¼‚ã€‚<br>æ­¤ä¼˜åŒ–é¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æˆ–è°ƒåº¦ï¼Œæ˜¯å¼‚æ­¥ç¼–ç¨‹é«˜æ€§èƒ½çš„å…³é”®ä¿éšœã€‚<br>å¼‚æ­¥åœºæ™¯çš„å¤æ‚æ€§</p></li><li><p>å½“ç­‰å¾…çš„ä»»åŠ¡æœªå®Œæˆï¼ˆéœ€å¼‚æ­¥ç­‰å¾…ï¼‰æ—¶ï¼ŒçŠ¶æ€æœºä¾èµ–ä¸€ç³»åˆ—è¾…åŠ©ç±»å‹ï¼ˆå¦‚ AsyncTaskMethodBuilder<T>ã€TaskAwaiter<T>ã€MoveNextRunner ç­‰ï¼‰åä½œå®Œæˆï¼š</p><ul><li>æ³¨å†Œä»»åŠ¡å»¶ç»­ï¼ˆContinuationï¼‰ã€‚</li><li>ç»´æŠ¤æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆExecutionContextï¼‰ã€‚<br>è·¨çº¿ç¨‹è°ƒåº¦æ—¶çš„çŠ¶æ€å®‰å…¨æµè½¬ã€‚</li></ul></li></ul><p>é€šè¿‡SharpLab, æˆ‘ä»¬ç”Ÿæˆäº†æœ¬ç¯‡ç¤ºä¾‹ä¸­æ‰€æœ‰çš„ç»ç¼–è¯‘å™¨å¤„ç†è¿‡çš„å¼‚æ­¥ä»£ç :</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"><span class="keyword">using</span> System.Reflection;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.CompilerServices;</span><br><span class="line"><span class="keyword">using</span> System.Security;</span><br><span class="line"><span class="keyword">using</span> System.Security.Permissions;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"></span><br><span class="line">[<span class="meta">assembly: CompilationRelaxations(8)</span>]</span><br><span class="line">[<span class="meta">assembly: RuntimeCompatibility(WrapNonExceptionThrows = true)</span>]</span><br><span class="line">[<span class="meta">assembly: Debuggable(DebuggableAttribute.DebuggingModes.Default | DebuggableAttribute.DebuggingModes.IgnoreSymbolStoreSequencePoints | DebuggableAttribute.DebuggingModes.EnableEditAndContinue | DebuggableAttribute.DebuggingModes.DisableOptimizations)</span>]</span><br><span class="line">[<span class="meta">assembly: SecurityPermission(SecurityAction.RequestMinimum, SkipVerification = true)</span>]</span><br><span class="line">[<span class="meta">assembly: AssemblyVersion(<span class="string">&quot;0.0.0.0&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">module: UnverifiableCode</span>]</span><br><span class="line">[<span class="meta">module: RefSafetyRules(11)</span>]</span><br><span class="line"></span><br><span class="line">[<span class="meta">NullableContext(1)</span>]</span><br><span class="line">[<span class="meta">Nullable(0)</span>]</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">StockPrices</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">CompilerGenerated</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">sealed</span> <span class="keyword">class</span> &lt;<span class="title">GetStockPriceForAsync</span>&gt;<span class="title">d__1</span> : <span class="title">IAsyncStateMachine</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> &lt;&gt;<span class="number">1</span>__state;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">Nullable(0)</span>]</span><br><span class="line">        <span class="keyword">public</span> AsyncTaskMethodBuilder&lt;<span class="built_in">decimal</span>&gt; &lt;&gt;t__builder;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">Nullable(0)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> companyId;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">Nullable(0)</span>]</span><br><span class="line">        <span class="keyword">public</span> StockPrices &lt;&gt;<span class="number">4</span>__this;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">decimal</span> &lt;result&gt;<span class="number">5</span>__1;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> TaskAwaiter &lt;&gt;u__1;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">MoveNext</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">int</span> num = &lt;&gt;<span class="number">1</span>__state;</span><br><span class="line">            <span class="built_in">decimal</span> result;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                TaskAwaiter awaiter;</span><br><span class="line">                <span class="keyword">if</span> (num != <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    awaiter = &lt;&gt;<span class="number">4</span>__this.InitializeMapIfNeededAsync().GetAwaiter();</span><br><span class="line">                    <span class="keyword">if</span> (!awaiter.IsCompleted)</span><br><span class="line">                    &#123;</span><br><span class="line">                        num = (&lt;&gt;<span class="number">1</span>__state = <span class="number">0</span>);</span><br><span class="line">                        &lt;&gt;u__1 = awaiter;</span><br><span class="line">                        &lt;GetStockPriceForAsync&gt;d__1 stateMachine = <span class="keyword">this</span>;</span><br><span class="line">                        &lt;&gt;t__builder.AwaitUnsafeOnCompleted(<span class="keyword">ref</span> awaiter, <span class="keyword">ref</span> stateMachine);</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    awaiter = &lt;&gt;u__1;</span><br><span class="line">                    &lt;&gt;u__1 = <span class="literal">default</span>(TaskAwaiter);</span><br><span class="line">                    num = (&lt;&gt;<span class="number">1</span>__state = <span class="number">-1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                awaiter.GetResult();</span><br><span class="line">                &lt;&gt;<span class="number">4</span>__this._stockPrices.TryGetValue(companyId, <span class="keyword">out</span> &lt;result&gt;<span class="number">5</span>__1);</span><br><span class="line">                result = &lt;result&gt;<span class="number">5</span>__1;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception exception)</span><br><span class="line">            &#123;</span><br><span class="line">                &lt;&gt;<span class="number">1</span>__state = <span class="number">-2</span>;</span><br><span class="line">                &lt;&gt;t__builder.SetException(exception);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            &lt;&gt;<span class="number">1</span>__state = <span class="number">-2</span>;</span><br><span class="line">            &lt;&gt;t__builder.SetResult(result);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">void</span> IAsyncStateMachine.MoveNext()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//ILSpy generated this explicit interface implementation from .override directive in MoveNext</span></span><br><span class="line">            <span class="keyword">this</span>.MoveNext();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DebuggerHidden</span>]</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SetStateMachine</span>(<span class="params">IAsyncStateMachine stateMachine</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">void</span> IAsyncStateMachine.SetStateMachine(IAsyncStateMachine stateMachine)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//ILSpy generated this explicit interface implementation from .override directive in SetStateMachine</span></span><br><span class="line">            <span class="keyword">this</span>.SetStateMachine(stateMachine);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    [<span class="meta">CompilerGenerated</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">sealed</span> <span class="keyword">class</span> &lt;<span class="title">InitializeMapIfNeededAsync</span>&gt;<span class="title">d__2</span> : <span class="title">IAsyncStateMachine</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> &lt;&gt;<span class="number">1</span>__state;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> AsyncTaskMethodBuilder &lt;&gt;t__builder;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">Nullable(0)</span>]</span><br><span class="line">        <span class="keyword">public</span> StockPrices &lt;&gt;<span class="number">4</span>__this;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> TaskAwaiter &lt;&gt;u__1;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">MoveNext</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">int</span> num = &lt;&gt;<span class="number">1</span>__state;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                TaskAwaiter awaiter;</span><br><span class="line">                <span class="keyword">if</span> (num == <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    awaiter = &lt;&gt;u__1;</span><br><span class="line">                    &lt;&gt;u__1 = <span class="literal">default</span>(TaskAwaiter);</span><br><span class="line">                    num = (&lt;&gt;<span class="number">1</span>__state = <span class="number">-1</span>);</span><br><span class="line">                    <span class="keyword">goto</span> IL_007c;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (&lt;&gt;<span class="number">4</span>__this._stockPrices == <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    awaiter = Task.Delay(<span class="number">42</span>).GetAwaiter();</span><br><span class="line">                    <span class="keyword">if</span> (!awaiter.IsCompleted)</span><br><span class="line">                    &#123;</span><br><span class="line">                        num = (&lt;&gt;<span class="number">1</span>__state = <span class="number">0</span>);</span><br><span class="line">                        &lt;&gt;u__1 = awaiter;</span><br><span class="line">                        &lt;InitializeMapIfNeededAsync&gt;d__2 stateMachine = <span class="keyword">this</span>;</span><br><span class="line">                        &lt;&gt;t__builder.AwaitUnsafeOnCompleted(<span class="keyword">ref</span> awaiter, <span class="keyword">ref</span> stateMachine);</span><br><span class="line">                        <span class="comment">// ä»è¿™é‡Œè¿”å›å›å»å¹²å˜›äº†å‘¢?</span></span><br><span class="line">                        <span class="comment">// ç¨‹åºä¼šç»§ç»­æ‰§è¡Œä¸‹é¢çš„è¯­å¥</span></span><br><span class="line">                        <span class="comment">// Task(Awaiter)ä½•æ—¶ç»“æŸã€å¦‚ä½•è°ƒåº¦éƒ½æ˜¯TaskScheduleråšçš„, æˆ‘ä»¬æ²¡æœ‰å¤ªå¤šæƒé™å¹²é¢„ æˆ‘ä»¬èƒ½åšçš„åªæ˜¯</span></span><br><span class="line">                        <span class="comment">// å‘Šè¯‰Task ç­‰ä½ çš„ä»»åŠ¡å®Œæˆä¹‹å ä½ éœ€è¦è°ƒç”¨stateMachinerçš„MoveNextæ–¹æ³•</span></span><br><span class="line">                        <span class="comment">// å¦‚æœæˆ‘è¦å®ç°è‡ªå·±çš„ç±»ä¼¼ETTaskçš„åŠŸèƒ½, æˆ‘å¸Œæœ›æˆ‘èƒ½è‡ªå·±å†³å®šå¦‚ä½•è°ƒåº¦è¿™äº›ETTask, è¦ä¸ç„¶å®ç°è‡ªå·±çš„ETTaskçš„æ„ä¹‰å°±æ²¡æœ‰äº†.</span></span><br><span class="line">                        <span class="comment">// C#ä¸­å¼‚æ­¥æ“ä½œåˆ°è¿™é‡Œå°±å·²ç»æ­ç¤ºåœ°æ¯”è¾ƒæ¸…æ¥šäº†, åªæ˜¯Taskçš„è°ƒåº¦ç›®å‰å¯¹æˆ‘ä»¬æ¥è¯´è¿˜æ˜¯é»‘ç›’, æœ€å¥½å®ƒä¹Ÿåªæ˜¯é»‘ç›’</span></span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">goto</span> IL_007c;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">goto</span> end_IL_0007;</span><br><span class="line">                IL_007c:</span><br><span class="line">                awaiter.GetResult();</span><br><span class="line">                StockPrices stockPrices = &lt;&gt;<span class="number">4</span>__this;</span><br><span class="line">                Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">decimal</span>&gt; dictionary = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">decimal</span>&gt;();</span><br><span class="line">                dictionary.Add(<span class="string">&quot;MSFT&quot;</span>, <span class="number">42</span>m);</span><br><span class="line">                stockPrices._stockPrices = dictionary;</span><br><span class="line">                end_IL_0007:;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception exception)</span><br><span class="line">            &#123;</span><br><span class="line">                &lt;&gt;<span class="number">1</span>__state = <span class="number">-2</span>;</span><br><span class="line">                &lt;&gt;t__builder.SetException(exception);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            &lt;&gt;<span class="number">1</span>__state = <span class="number">-2</span>;</span><br><span class="line">            &lt;&gt;t__builder.SetResult();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">void</span> IAsyncStateMachine.MoveNext()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//ILSpy generated this explicit interface implementation from .override directive in MoveNext</span></span><br><span class="line">            <span class="keyword">this</span>.MoveNext();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DebuggerHidden</span>]</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SetStateMachine</span>(<span class="params">IAsyncStateMachine stateMachine</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">void</span> IAsyncStateMachine.SetStateMachine(IAsyncStateMachine stateMachine)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//ILSpy generated this explicit interface implementation from .override directive in SetStateMachine</span></span><br><span class="line">            <span class="keyword">this</span>.SetStateMachine(stateMachine);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">decimal</span>&gt; _stockPrices;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">AsyncStateMachine(typeof(&lt;GetStockPriceForAsync&gt;d__1))</span>]</span><br><span class="line">    [<span class="meta">DebuggerStepThrough</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Task&lt;<span class="built_in">decimal</span>&gt; <span class="title">GetStockPriceForAsync</span>(<span class="params"><span class="built_in">string</span> companyId</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        &lt;GetStockPriceForAsync&gt;d__1 stateMachine = <span class="keyword">new</span> &lt;GetStockPriceForAsync&gt;d__1();</span><br><span class="line">        stateMachine.&lt;&gt;t__builder = AsyncTaskMethodBuilder&lt;<span class="built_in">decimal</span>&gt;.Create();</span><br><span class="line">        stateMachine.&lt;&gt;<span class="number">4</span>__this = <span class="keyword">this</span>;</span><br><span class="line">        stateMachine.companyId = companyId;</span><br><span class="line">        stateMachine.&lt;&gt;<span class="number">1</span>__state = <span class="number">-1</span>;</span><br><span class="line">        stateMachine.&lt;&gt;t__builder.Start(<span class="keyword">ref</span> stateMachine);</span><br><span class="line">        <span class="keyword">return</span> stateMachine.&lt;&gt;t__builder.Task;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">AsyncStateMachine(typeof(&lt;InitializeMapIfNeededAsync&gt;d__2))</span>]</span><br><span class="line">    [<span class="meta">DebuggerStepThrough</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> Task <span class="title">InitializeMapIfNeededAsync</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        &lt;InitializeMapIfNeededAsync&gt;d__2 stateMachine = <span class="keyword">new</span> &lt;InitializeMapIfNeededAsync&gt;d__2();</span><br><span class="line">        stateMachine.&lt;&gt;t__builder = AsyncTaskMethodBuilder.Create();</span><br><span class="line">        stateMachine.&lt;&gt;<span class="number">4</span>__this = <span class="keyword">this</span>;</span><br><span class="line">        stateMachine.&lt;&gt;<span class="number">1</span>__state = <span class="number">-1</span>;</span><br><span class="line">        stateMachine.&lt;&gt;t__builder.Start(<span class="keyword">ref</span> stateMachine); <span class="comment">// è¿™é‡Œé¢ä¼šç¬¬ä¸€æ¬¡è°ƒç”¨StateMachineçš„MoveNextæ–¹æ³•</span></span><br><span class="line">        <span class="keyword">return</span> stateMachine.&lt;&gt;t__builder.Task; <span class="comment">// ä¼šç«‹åˆ»è¿”å›Taskå›å» </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> C# </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼‚æ­¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç²¾ç»†åŒ–å®éªŒç­–ç•¥ä¸‹ä¸€ç§å¤šç­–ç•¥äº¤å‰çš„ç¾æœ¯ã€åŠ¨æ•ˆæ¡†æ¶çš„å®ç°</title>
      <link href="/posts/4bbdbff1/"/>
      <url>/posts/4bbdbff1/</url>
      
        <content type="html"><![CDATA[<h1>ç¬”è€…å¯¹ç²¾ç»†åŒ–å®éªŒçš„å®šä¹‰</h1><p>å½“æ¸¸æˆè¦æ–°å¢æˆ–æ”¹åŠ¨ä¸€ä¸ªåŠŸèƒ½æ—¶, å¦‚æœå¼€å‘è€…ä¸èƒ½ç¡®å…¶ä¼šå¯¹ç”¨æˆ·ä½“éªŒé€ æˆä»€ä¹ˆå½±å“, å°±ä¼šç”¨åšå®éªŒçš„æ–¹å¼å°†åŠŸèƒ½å‘å¸ƒåˆ°çº¿ä¸Š, å³å°†ç”¨æˆ·åˆ†ä¸ºå¯¹ç…§ç»„å’Œå®éªŒç»„, çœ‹ä¸¤ç»„ç”¨æˆ·çš„æ•°æ®è¡¨ç°, æ¥åˆ¤æ–­è¯¥åŠŸèƒ½çš„å¥½å. å¦‚æœå®éªŒç»„æ•°æ®å¥½äºå¯¹ç…§ç»„, åˆ™åº”ç”¨å®éªŒç»„, åä¹‹åº”ç”¨å¯¹ç…§ç»„. ä¸è®ºåº”ç”¨å“ªä¸€ç»„, æ²¡æœ‰è¢«åº”ç”¨çš„é‚£ä¸€ç»„çš„ç¡¬ç¼–ç å°±å¯ä»¥åˆ é™¤æ‰, å› æ­¤å®éªŒç»„ä¸å¯¹ç…§ç»„é€»è¾‘çš„ä»£ç åªæ˜¯ä¼šä¸´æ—¶æ’å…¥åˆ°é¡¹ç›®ä¸­, åªè¦å®éªŒåº”ç”¨äº†ä¹‹åæŠŠéåº”ç”¨å®éªŒåˆ†æ”¯çš„ä»£ç åˆ å¹²å‡€, é•¿æœŸä¸‹æ¥æ˜¯ä¸ä¼šå¯¹æ•´ä¸ªé¡¹ç›®ä»£ç ç»“æ„æœ‰ä»€ä¹ˆå½±å“. ä½†æ˜¯æˆ‘ä»¬å›¢é˜Ÿåœ¨æŒ‰ç…§ä¸Šè¿°æ¨¡å¼æ¨è¿›äº†ä¸€æ®µæ—¶é—´ä¹‹åå‘ç°äº†è¿™ç§æ¨¡å¼å­˜åœ¨é—®é¢˜, åŒä¸€ä¸ªç‰ˆæœ¬ä¸Šçº¿çš„å¤šä¸ªå®éªŒä¹‹é—´å­˜åœ¨äº¤å‰, ä¸”ä¼šå¯¹å•ä¸ªå®éªŒçš„ç»“æœäº§ç”Ÿå½±å“, è€Œä¸”æœ‰çš„å®éªŒçŸ­æœŸå†…æ˜¯å®éªŒç»„çš„æ•°æ®å¥½, è€Œé•¿æœŸåˆå˜æˆäº†å¯¹ç…§ç»„çš„æ•°æ®å¥½. å› æ­¤, æˆ‘ä»¬è®¤ä¸ºä¹‹å‰å¯¹å®éªŒæ•°æ®çš„ç»“è®ºä¸å‡†ç¡®, æˆ‘ä»¬å†³å®šå°†ä¸€æ®µå‘¨æœŸå†…æœ€æ—©çš„é‚£ä¸ªç‰ˆæœ¬çš„é¡¹ç›®çŠ¶æ€å®šä¹‰ä¸º<strong>åŸºçº¿ç»„</strong>, åœ¨è¿™ä¸€å‘¨æœŸå†…çš„æ¯ä¸ªç‰ˆæœ¬ä¼šä¸Šçº¿çš„å®éªŒéƒ½ä¸ä¼šåº”ç”¨, è€Œæ˜¯ä¼šä¸€ç›´åœ¨çº¿ä¸Šè·‘, éšç€å®éªŒè¶Šå¼€è¶Šå¤š, å®éªŒä¹‹é—´çš„äº¤å‰é—®é¢˜è¶Šæ¥è¶Šä¸¥é‡, åˆå› ä¸ºè¿™äº›å®éªŒçš„åˆ†æ”¯ä»£ç ä¸ä¼šåˆ é™¤, ä»£ç ä¹Ÿä¼šå˜å¾—è¶Šæ¥è¶Šéš¾ä»¥ç»´æŠ¤, ä¸Šè¿°è¿™ç§åœ¨ä¸€æ®µå‘¨æœŸä¸Šçº¿å¤§é‡ä¸ä¼šåº”ç”¨å®éªŒ, ä¸”å¸Œæœ›æ¯ä¸ªå®éªŒéƒ½èƒ½äº¤å‰, åœ¨ä¸€æ®µå‘¨æœŸåä¼šå½¢æˆä¸Šç™¾ã€ä¸Šåƒæ¡å®éªŒåˆ†æ”¯çš„å®éªŒ, å°±æ˜¯<strong>ç²¾ç»†åŒ–å®éªŒ</strong>, å¯¹åº”çš„, æˆ‘ä»¬å›¢é˜Ÿå°±éœ€è¦ä¸€å¥—èƒ½å¤Ÿç®¡ç†ç²¾ç»†åŒ–å®éªŒçš„æ¡†æ¶.</p><h1>ç²¾ç»†åŒ–æ¡†æ¶çš„å®ç°æ€è·¯</h1><p>æ¯ä¸ªå®éªŒèƒ½å¤Ÿäº¤å‰, æ˜¯ååˆ†ç¾å¥½çš„æ„¿æ™¯. ä½†æ˜¯, åœ¨å®é™…å¼€å‘ä¸­æˆ‘ä»¬å‘ç°, ç»å¸¸ä¼šæœ‰äº’ä¸ºäº’æ–¥å…³ç³»çš„å®éªŒå­˜åœ¨, æ¯”å¦‚ä¸¤ä¸ªå®éªŒåŒæ—¶å¯¹æ¨¡å—Aåšäº†æ”¹åŠ¨, æˆ–è€…å®éªŒä¸€å½±å“æ¨¡å—ABC, å®éªŒäºŒå½±å“æ¨¡å—ABD, è¿™ç§æƒ…å†µæ˜¯ä¸å¯é¿å…çš„, å› æ­¤, ç²¾ç»†åŒ–æ¡†æ¶è¦åšçš„äº‹æƒ…, ä¸ä»…ä»…æ˜¯é©±åŠ¨è¿™äº›å®éªŒ, è¿˜è¦åˆ¶å®šä¸€å¥—è§„èŒƒ, å¤„ç†å®éªŒä¹‹é—´çš„å†²çªé—®é¢˜.</p><p>æœ¬ç¯‡åšå®¢ç¬”è€…ä¼šä»¥UIæ¢çš®å®éªŒå’ŒåŠ¨æ•ˆæ¢çš®å®éªŒä¸ºä¾‹å­, é˜è¿°UIæ¡†æ¶ã€åŠ¨æ•ˆæ’­æ”¾æ¡†æ¶çš„å®ç°æ€è·¯, ä»¥åŠè¿™äº›æ¡†æ¶å’Œç²¾ç»†åŒ–æ¡†æ¶çš„ååŒè¿‡ç¨‹.</p><h2 id="ä»ABTestæ¡†æ¶è¯´èµ·">ä»ABTestæ¡†æ¶è¯´èµ·</h2><p>æˆ‘ä»¬æœ€åˆä½¿ç”¨çš„ABæµ‹è¯•ç³»ç»Ÿååˆ†ç®€é™‹, ABæµ‹ç³»ç»Ÿåœ¨å¯åŠ¨æ—¶ä»ç£ç›˜ä¸ŠåŠ è½½ä¸Šæ¥æ‰€æœ‰çš„ABå®éªŒä¿¡æ¯, æ ¹æ®è®¾å¤‡çš„uid, åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·è¯¥è¡¨ç°ä¸ºå¯¹ç…§ç»„è¿˜æ˜¯å®éªŒç»„æ˜¯æ ¹æ®ç”¨æˆ·ä½¿ç”¨è®¾å¤‡çš„uid, æˆ‘ä»¬åœ¨åå°é…ç½®ä¸€ä¸ªå®éªŒçš„æ—¶å€™, æœ‰å¤šå°‘ä¸ªå®éªŒç»„å°±ä¼šç”Ÿæˆå‡ ä¸ªâ€œæ¡¶â€, è¿™äº›æ¡¶é‡Œé¢è£…çš„æ˜¯ç”¨æˆ·è®¾å¤‡çš„uid, ç”¨æˆ·è®¾å¤‡å¯åŠ¨æ¸¸æˆçš„æ—¶å€™, ç¨‹åºèƒ½å¤ŸçŸ¥é“å½“å‰è®¾å¤‡åœ¨å“ªä¸ªæ¡¶é‡Œ, ä½†æ˜¯åœ¨æŸä¸€ä¸ªæ¡¶é‡Œå¹¶ä¸æ„å‘³ç€å°±ä¸€å®šè¡¨ç°ä¸ºè¿™ä¸ªæ¡¶æ‰€å¯¹åº”çš„å®éªŒç»„, è¿˜æœ‰å…¶ä»–çš„é™åˆ¶æ¡ä»¶, æ¯”å¦‚å®‰è£…ç‰ˆæœ¬å¿…é¡»å¤§äºæŸä¸€ä¸ªç‰ˆæœ¬æˆ–è€…å¿…é¡»æ˜¯æ–°ç”¨æˆ·, æˆ–è€…å¿…é¡»æ˜¯æŸä¸€å›½å®¶åœ°åŒºçš„ç­‰ç­‰. æ€»ä¹‹, ä¸šåŠ¡å±‚åªéœ€è¦æŠŠå®ƒä»¬å…³ç³»çš„å®éªŒå­—æ®µä¼ å…¥, å°±èƒ½å¤Ÿæ‹¿åˆ°å½“å‰è®¾å¤‡å¯¹åº”å®éªŒæ‰€åœ¨çš„å®éªŒç»„æ˜¯å“ªä¸€ä¸ª.</p><h2 id="ç²¾ç»†åŒ–å®éªŒæ¨¡å—ç™»åœº">ç²¾ç»†åŒ–å®éªŒæ¨¡å—ç™»åœº</h2><p>ç²¾ç»†åŒ–å®éªŒè¦åšçš„, å°±æ˜¯æŠŠABTestæ¡†æ¶å’Œä¸šåŠ¡å±‚è§£è€¦, ä½œä¸ºä¸¤è€…ä¹‹é—´çš„æ¡¥æ¢. å½“ä½ æƒ³è®©ä¸¤ä¸ªæ¨¡å—è§£è€¦æ—¶, æœ€ç›´æ¥çš„æ–¹å¼å°±æ˜¯åœ¨ä¸¤ä¸ªæ¨¡å—é€šè®¯çš„æ¥å£å¤„å¢åŠ æ¡¥æ¥å±‚, æœ‰äº†è¿™å±‚æ¡¥æ¥, ABTestä¸­åºå¤§çš„æ•°æ®ä¸è‡³äºä¸€ä¸‹å­æ¶Œå‘ä¸šåŠ¡å±‚, è€Œæ˜¯åœ¨ç²¾ç»†åŒ–å®éªŒå±‚æ•´åˆã€å¤„ç†, ç²¾ç»†åŒ–å®éªŒå±‚ä¼šæŠŠABTestä¸­å½±å“åŒä¸€ä¸ªä¸šåŠ¡çš„å®éªŒä»¬æŒ‰ç…§äººä¸ºå®šä¹‰çš„è§„åˆ™è¿›è¡Œæ•´åˆã€å†²çªå¤„ç†, ç„¶åå°†ç»“æœè½¬æ¢æˆå¯¹åº”ä¸šåŠ¡èƒ½å¤Ÿè¯†åˆ«çš„æ ¼å¼â€”â€”ç²¾ç»†åŒ–å®éªŒå±‚éœ€è¦å’Œæ¯ä¸€ä¸ªå…·ä½“çš„ä¸šåŠ¡å®šä¹‰ä¸€å¥—åè®®, è¿™å¥—åè®®èƒ½å¤Ÿæè¿°, ç»è¿‡å¤šä¸ªå®éªŒçš„å¤šé‡å½±å“, è¯¥ä¸šåŠ¡æœ€ç»ˆçš„è¡¨ç°æ•ˆæœæ˜¯æ€æ ·çš„. æˆ‘ä»¬è®¡åˆ’ä½¿ç”¨Jsonä½œä¸ºè¿™äº›å®éªŒé…ç½®çš„è½½ä½“:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;1024&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;uiTest&quot;,</span><br><span class="line">        &quot;experimentSceneType&quot;: &quot;UIStyle&quot;, </span><br><span class="line">        &quot;experimentParam&quot;: &#123;</span><br><span class="line">            &quot;group1&quot;: [</span><br><span class="line">                [</span><br><span class="line">                    &quot;homePage&quot;,</span><br><span class="line">                    1</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;playPage&quot;,</span><br><span class="line">                    1</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;resultPage&quot;,</span><br><span class="line">                    1</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;settingPage&quot;,</span><br><span class="line">                    1</span><br><span class="line">                ]</span><br><span class="line">            ],</span><br><span class="line">            &quot;group2&quot;: [</span><br><span class="line">                [</span><br><span class="line">                    &quot;homePage&quot;,</span><br><span class="line">                    2</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;playPage&quot;,</span><br><span class="line">                    2</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;resultPage&quot;,</span><br><span class="line">                    2</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;settingPage&quot;,</span><br><span class="line">                    2</span><br><span class="line">                ]</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">     &quot;1025&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &quot;uiTest2&quot;,</span><br><span class="line">        &quot;experimentSceneType&quot;: &quot;UIStyle&quot;, </span><br><span class="line">        &quot;experimentParam&quot;: &#123;</span><br><span class="line">            &quot;group1&quot;: [</span><br><span class="line">                [</span><br><span class="line">                    &quot;homePage&quot;,</span><br><span class="line">                    1</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;playPage&quot;,</span><br><span class="line">                    2</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;resultPage&quot;,</span><br><span class="line">                    1</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;settingPage&quot;,</span><br><span class="line">                    4</span><br><span class="line">                ]</span><br><span class="line">            ],</span><br><span class="line">            &quot;group2&quot;: [</span><br><span class="line">                [</span><br><span class="line">                    &quot;homePage&quot;,</span><br><span class="line">                    2</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;playPage&quot;,</span><br><span class="line">                    3</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;resultPage&quot;,</span><br><span class="line">                    5</span><br><span class="line">                ],</span><br><span class="line">                [</span><br><span class="line">                    &quot;settingPage&quot;,</span><br><span class="line">                    2</span><br><span class="line">                ]</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure><p>å¯¹ä¸Šè¿°Jsonæ ¼å¼åšä¸€ä¸‹è¯´æ˜, æœ€å¤–å±‚çš„æ•°å­—ä»£è¡¨å®éªŒID, <code>name</code>æ˜¯å®éªŒå, <code>experimentSceneType</code>æ˜¯å®éªŒåœºæ™¯, <code>experimentParam</code>èƒ½å¤Ÿæè¿°å®éªŒåœºæ™¯ä¸‹çš„å®éªŒå†…å®¹, <code>group</code>ä»£è¡¨å®éªŒåˆ†ç»„, ä¸åŒå®éªŒåœºæ™¯ä¸‹<code>group</code>å­—æ®µä¸‹çš„ç»“æ„ä¸ä¸€æ ·, åœ¨<code>UIStyle</code>å®éªŒåœºæ™¯ä¸‹æ˜¯ä¸€ä¸ªåˆ—è¡¨, æ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ªUI, å’Œè¯¥UIä½¿ç”¨çš„<code>styleId</code>.</p><p>ç¨‹åºå¯åŠ¨æ—¶å¿…å®šåŠ è½½ä¸Šé¢ä¸¤ä¸ªå®éªŒ, å¹¶å‘½ä¸­å…¶ä¸­ä¸€ä¸ªå®éªŒç»„, è€Œè¿™ä¸¤ä¸ªå®éªŒæ˜¯äº’æ–¥çš„, å› æ­¤ä¼šåœ¨ç²¾ç»†åŒ–å®éªŒå±‚è¿›è¡Œå¤„ç†. å…·ä½“çš„å¤„ç†è§„åˆ™, åˆ™éœ€è¦å’Œç­–åˆ’å›¢é˜Ÿä¸€èµ·åˆ¶å®š, ç¡¬ç¼–ç è¿›ç²¾ç»†åŒ–å®éªŒæ¨¡å—ä¸­, ç­‰ä¸šåŠ¡åœºæ™¯è¶³å¤Ÿä¸°å¯Œçš„æ—¶å€™, ä¹Ÿè®¸å¯ä»¥ä»ä¸­æå–å‡ºä¸€å¥—è§„åˆ™æ¥æ”¯æŒé…ç½®. ä¸è¿‡è¿™å°±ä¸åœ¨æœ¬ç¯‡åšå®¢è¦è®¨è®ºçš„èŒƒç•´å†…äº†. æ€»ä¹‹, ç»è¿‡ç²¾ç»†åŒ–å±‚çš„å¤„ç†ä¹‹å, UIStyleå®éªŒåœºæ™¯ä¼šå¾—åˆ°ä¸€ç»„ç±»ä¼¼groupå­—æ®µå†…çš„åˆ—è¡¨, è¿™é‡Œé¢å­˜å‚¨äº†æ‰€æœ‰UIçš„styleId, UIManagerä¾§ç»´æŠ¤ç€æ¯ä¸ªUIæ¯ä¸ªstyleIdçš„æ˜ å°„å…³ç³». æœ‰ç²¾ç»†åŒ–å±‚ä¼ æ¥çš„å‚æ•°, UIManagerå°±å¯ä»¥ç»™æ¯ä¸ªUIè®¾ç½®è¿è¡Œæ—¶styleIdäº†.</p><p>æˆ‘ä»¬è®¾è®¡çš„å®éªŒè¡¨æ ¼å¦‚ä¸‹:</p><h2 id="UIæ¡†æ¶çš„é…è¡¨">UIæ¡†æ¶çš„é…è¡¨</h2><h2 id="éŸ³é¢‘æ¡†æ¶é…è¡¨">éŸ³é¢‘æ¡†æ¶é…è¡¨</h2><h2 id="åŠ¨æ•ˆé…è¡¨">åŠ¨æ•ˆé…è¡¨</h2><h2 id="å®éªŒé…ç½®">å®éªŒé…ç½®</h2>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ—¶åŠ¿:å‘¨æœŸæ³¢åŠ¨ä¸‹çš„å›½å®¶ã€ç¤¾ä¼šå’Œä¸ªäºº</title>
      <link href="/posts/1cb37a62/"/>
      <url>/posts/1cb37a62/</url>
      
        <content type="html"><![CDATA[<h1>æ—¥æœ¬å¤±è½çš„ä¸‰åå¹´</h1><p>æ—¥æœ¬è´¢å›¢</p><p>å¹¿åœºåè®®</p><p>å›½å€º</p>]]></content>
      
      
      <categories>
          
          <category> è¯»ä¸‡å·ä¹¦ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¯»ä¹¦ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¯¹C#ä¸­ç±»å‹è½¬æ¢å’Œæ‹†è£…ç®±çš„æ€è€ƒ</title>
      <link href="/posts/fad28a7c/"/>
      <url>/posts/fad28a7c/</url>
      
        <content type="html"><![CDATA[<h1>ç±»å‹è½¬æ¢çš„å¼€é”€æ¥è‡ªå“ªé‡Œ?</h1><p>ç±»å‹è½¬æ¢åœ¨æ—¶é—´å’Œç©ºé—´ä¸Šéƒ½ä¼šé€ æˆå¼€é”€, å› ä¸ºç±»å‹è½¬æ¢C#ç¼–è¯‘å™¨ä¼šç”Ÿæˆé¢å¤–çš„ç±»å‹è½¬æ¢å¤„ç†ä»£ç , å¯¼è‡´ä»£ç æ–‡ä»¶çš„ä½“ç§¯å˜å¤§. æ—¢ç„¶æœ‰é¢å¤–çš„ILä»£ç ç”Ÿæˆåˆ™å°±éœ€è¦æœ‰é¢å¤–çš„æ—¶é—´å»æ‰§è¡Œ. å¦‚æœç±»å‹è½¬æ¢ä¸­æ¶‰åŠåˆ°è£…æ‹†ç®±æ“ä½œ, åˆ™è¿˜ä¼šå¯¹è¿è¡Œæ—¶å†…å­˜äº§ç”Ÿå½±å“.</p><ul><li>CLRä¼šç”Ÿæˆé¢å¤–ILä»£ç æ‰§è¡Œç±»å‹è½¬æ¢æ˜¯å¦åˆæ³•çš„åˆ¤æ–­é€»è¾‘, è¿™éƒ¨åˆ†å¼€é”€æ˜¯ä¸å¯é¿å…çš„, å³ä¾¿å¼€å‘è€…ç¬ƒå®šç±»å‹è½¬æ¢å¿…å®šåˆæ³•. ä¸è¿‡è¿™éƒ¨åˆ†å¼€é”€çš„å½±å“å¹¶ä¸å¤§. å¦‚æœç±»å‹è½¬æ¢åˆ¤å®šä¸ºä¸åˆæ³•, åˆ™éœ€è¦é¢å¤–çš„å¼€é”€æ¥å¤„ç†å¼‚å¸¸, æˆ‘ä»¬é€šå¸¸ä¼šæœ‰ä¸¤ç§ç±»å‹è½¬æ¢çš„æ–¹å¼, ä¸¤ç§è½¬æ¢æ–¹å¼ä¸åˆæ³•çš„å¤„ç†çš„å¼€é”€ä¸åŒ:<ul><li>ä½¿ç”¨ç±»å‹å¼ºè½¬, å³<code>var a = (someType)b</code>å½¢å¼, è¿™ç§æ–¹å¼åœ¨è½¬æ¢ä¸åˆæ³•çš„æ—¶å€™ä¼šæŠ›å‡ºå¼‚å¸¸, å¼€é”€è¾ƒå¤§.</li><li>ä½¿ç”¨<code>as</code>æ“ä½œç¬¦,å³<code>var a = b as someType</code>, è¿™ç§æ–¹å¼åœ¨è½¬æ¢ä¸åˆæ³•çš„æ—¶å€™ä¼šå°†aå­—æ®µè®¾ç½®ä¸º<code>null</code>,å¼€é”€å°. æ›´æ¨èä½¿ç”¨è¿™ç§æ–¹å¼.<br>ä¸è¿‡å¦‚æœä½ çœŸçš„ç¬ƒå®šç±»å‹è½¬æ¢ä¸ä¼šå‡ºé”™, é‚£ä¹ˆä»¥ä¸Šè¿™ä¸¤ç§ç±»å‹è½¬æ¢çš„æ–¹å¼å…¶å®å½±å“ä¸å¤§.</li></ul></li><li>æ‹†ç®±è£…ç®±é€ æˆçš„å¼€é”€, è¯·è®°ä½è¿™å¥è¯:<strong>è£…ç®±æ‹†ç®±ä¸€å®šæ˜¯ç±»å‹è½¬æ¢é€ æˆçš„, ä½†æ˜¯ç±»å‹è½¬æ¢ä¸ä¸€å®šä¼šå¯¼è‡´è£…ç®±æ‹†ç®±</strong> è£…æ‹†ç®±è¯¦è§£è¯·ç»§ç»­å¾€ä¸‹çœ‹.</li></ul><h1>å€¼ç±»å‹ä¸å¼•ç”¨ç±»å‹</h1><p>å€¼ç±»å‹åˆ›å»ºåœ¨æ ˆä¸Š, å †ç±»å‹åˆ›å»ºåœ¨å †ä¸Š è¿™å¥è¯æ˜¯ä¸å®Œå…¨å¯¹çš„, æ›´å‡†ç¡®çš„æè¿°æ˜¯: å¼•ç”¨ç±»å‹ä¸€å®šåˆ›å»ºåœ¨å †ä¸Š, å€¼ç±»å‹æ—¢å¯ä»¥åˆ›å»ºåœ¨å †ä¸Š, ä¹Ÿå¯ä»¥åˆ›å»ºåœ¨æ ˆä¸Š, å€¼ç±»å‹åˆ›å»ºåœ¨æ ˆè¿˜æ˜¯å †ä¸Šå–å†³äºå®ƒæ‰€åœ¨çš„å®¹å™¨: å¦‚æœå€¼ç±»å‹æ˜¯å¼•ç”¨ç±»å‹çš„ä¸€ä¸ªæˆå‘˜å­—æ®µ, åˆ™è¯¥å€¼ç±»å‹åˆ›å»ºåœ¨å †ä¸Š, å¦‚æœè¯¥å€¼ç±»å‹æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡(ä¸´æ—¶å˜é‡)æˆ–è€…æ˜¯ä¸€ä¸ªæ˜¯å¦å¤–ä¸€ä¸ªå€¼ç±»å‹çš„å­—æ®µæˆå‘˜çš„è¯, åˆ™åˆ›å»ºåœ¨å †ä¸Š.</p><h1>è£…ç®±æ‹†ç®±çš„å¼€é”€æ¥è‡ªå“ªé‡Œ</h1><p><strong>è£…ç®±è¿‡ç¨‹å‘ç”Ÿäº†ä»€ä¹ˆ</strong></p><ol><li>åœ¨æ‰˜ç®¡å †ä¸­åˆ†é…å†…å­˜, åˆ†é…çš„å†…å­˜é‡æ˜¯å€¼ç±»å‹å„å­—æ®µæ‰€éœ€çš„å†…å­˜é‡, è¿˜è¦åŠ ä¸Šæ‰˜ç®¡å †æ‰€æœ‰å¯¹è±¡éƒ½æœ‰çš„ä¸¤ä¸ªé¢å¤–æˆå‘˜(ç±»å‹å¯¹è±¡æŒ‡é’ˆå’ŒåŒæ­¥å—ç´¢å¼•)æ‰€éœ€çš„å†…å­˜é‡</li><li>å€¼ç±»å‹çš„å­—æ®µå¤åˆ¶åˆ°æ–°åˆ†é…çš„å †å†…å­˜</li><li>è¿”å›å¯¹è±¡åœ°å€. ç°åœ¨è¯¥åœ°å€æ˜¯å¯¹è±¡å¼•ç”¨; å€¼ç±»å‹æˆäº†å¼•ç”¨ç±»å‹</li></ol><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">object</span> obj = <span class="number">10</span>;</span><br></pre></td></tr></table></figure><p><strong>æ‹†ç®±è¿‡ç¨‹å‘ç”Ÿäº†ä»€ä¹ˆ</strong><br>è¯·åå¤é˜…è¯»å¹¶ç†è§£è¿™å¥è¯: <strong>æ‹†ç®±ä¸æ˜¯ç›´æ¥å°†è£…ç®±è¿‡ç¨‹å€’è¿‡æ¥, æ‹†ç®±è¿‡ç¨‹æœ¬èº«ä¸ä¼šå¤åˆ¶ä»»ä½•ç±»å‹, ä½†æ˜¯æ‹†ç®±è¿‡åå¾€å¾€è·Ÿéšç€ä¸€æ¬¡å­—æ®µçš„å¤åˆ¶.</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">object obj = 10; //è£…ç®±</span><br><span class="line"></span><br><span class="line">int a = (int)b // æ‹†ç®± + å­—æ®µçš„å¤åˆ¶</span><br></pre></td></tr></table></figure><p><code>(int)b</code>éƒ¨åˆ†å®Œæˆäº†æ‹†ç®±æ“ä½œ, <code>int a =</code>éƒ¨åˆ†å®Œæˆäº†å­—æ®µå¤åˆ¶æ“ä½œ, æˆ‘ä»¬åœ¨å†™ä»£ç çš„æ—¶å€™å¾ˆè‡ªç„¶è€Œç„¶åœ°ä¼šè¿™ä¹ˆå†™.</p><p>å¦å¤–ï¼Œå€¼ç±»å‹è£…ç®±åæ˜¯ä¸èƒ½æ”¹å˜å®ƒçš„å€¼çš„ï¼Œè£…ç®±åçš„å€¼å…·æœ‰æ’å®šæ€§ï¼ˆImmutableï¼‰çš„ç‰¹ç‚¹ï¼Œå¦‚æœæƒ³ç»™å¼•ç”¨ç±»å‹çš„å˜é‡èµ‹äºˆæ–°çš„å€¼ï¼Œé‚£å°±éœ€è¦å†å †ä¸Šå¦å¼€è¾Ÿæ–°çš„å†…å­˜ç©ºé—´ï¼Œä¸€æ—¦ä¸€ä¸ªå€¼ç±»å‹è¢«è£…ç®±ï¼Œå®ƒçš„å€¼å°±æ²¡æœ‰åŠæ³•æ”¹å˜äº†. çœ‹ä¸‹é¢çš„ä»£ç :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">struct ValueType</span><br><span class="line">&#123;</span><br><span class="line">    public int Value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void SomeFunc()</span><br><span class="line">&#123;</span><br><span class="line">    var value = new ValueType</span><br><span class="line">    &#123;</span><br><span class="line">        Value = 100</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    object vv = value;</span><br><span class="line">    </span><br><span class="line">    ((ValueType)vv).Value = 200; // è¿™é‡Œä¼šæŠ¥é”™Cannot modify struct member when accessed struct is not classified as a variable</span><br><span class="line"></span><br><span class="line">    var vvv = ((ValueType)vv); // ä¸ä¼šæŠ¥é”™</span><br><span class="line">    vvv.Value = 200;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°, å¦‚æœåªæ˜¯è¿›è¡Œæ‹†ç®±æ“ä½œ, æˆ‘ä»¬æ— æ³•å¯¹æ‹†ç®±åçš„å­—æ®µåšä»»ä½•ä¿®æ”¹, å¹¶æŠ¥é”™æç¤ºæ‹†ç®±åçš„å€¼æˆå‘˜å¹¶æ²¡æœ‰åˆ†ç±»ä¸ºå˜é‡, æˆ‘ä»¬å¿…é¡»å°†æ‹†ç®±åçš„æ•°æ®å¤åˆ¶ç»™ä¸€ä¸ªå€¼ç±»å‹å˜é‡, åœ¨è¿™ä¸ªå˜é‡ä¸Šè¿›è¡Œä¿®æ”¹, ä¸è¿‡è¿™ä¸ªå˜é‡æ˜¯æ‹†ç®±æ•°æ®çš„æ‹·è´, æ‹†ç®±çš„æ•°æ®æ²¡æœ‰ä»»ä½•å…³ç³». æ‰€ä»¥ä¸Šé¢æ‰è¯´<strong>æ‹†ç®±è¿‡åå¾€å¾€è·Ÿéšç€ä¸€æ¬¡å­—æ®µçš„å¤åˆ¶</strong></p><h1>åå¤åœ°æ‹†è£…ç®±</h1><p>åå¤åœ°æ‹†è£…ç®±ä¼šäº§ç”Ÿé¢å¤–çš„ILä»£ç , å¢åŠ ä»£ç ä½“ç§¯. æ›´å¤§çš„é—®é¢˜æ˜¯, é¢å¤–çš„è£…ç®±æ­¥éª¤ä¼šåœ¨æ‰˜ç®¡å †ä¸­åˆ†é…é¢å¤–çš„å¯¹è±¡, å°†æ¥å¿…é¡»å¯¹å…¶è¿›è¡Œåƒåœ¾å›æ”¶. æ‹†è£…ç®±çš„æ»¥ç”¨ä¼šä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½å’Œå†…å­˜æ¶ˆè€—.<br>å¦‚æœæˆ‘ä»¬æƒ³ä¿®æ”¹è£…ç®±åçš„å€¼ç±»å‹çš„å†…å®¹, è™½ç„¶ç¬”è€…æƒ³ä¸å‡ºå®é™…å¼€å‘ä¸­ä¼šæœ‰è¿™ç§åœºæ™¯, æˆ‘ä»¬å°±å¿…é¡»å…ˆå°†å…¶æ‹†ç®±, æ¥ç€å¤åˆ¶ç»™ä¸€ä¸ªå€¼ç±»å‹å˜é‡, ä¿®æ”¹å€¼ç±»å‹å˜é‡çš„å†…å®¹, å°†å€¼ç±»å‹å˜é‡è£…ç®±, æœ€åæŠŠæŒ‡å‘åŸæ¥è£…ç®±å€¼ç±»å‹åœ¨å †ä¸Šåœ°å€çš„å¼•ç”¨æŒ‡å‘çš„åœ°å€æ”¹ä¸ºæŒ‡å‘æ–°çš„å€¼ç±»å‹å˜é‡è£…ç®±åæ‰€åœ¨å †ä¸Šçš„åœ°å€. é‚£ä¹ˆåŸæ¥é‚£ä¸€ä¸ªè¢«è£…ç®±çš„å€¼ç±»å‹åœ¨å †ä¸Šå æ®çš„å†…å®¹ç©ºé—´å°±åºŸå¼ƒäº†, åœ¨æœªæ¥éœ€è¦è¿›è¡Œåƒåœ¾å›æ”¶. è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè£…ç®±æ‹†ç®±ä¼šå¼•èµ·GCã€‚</p><h1>å°èŠ‚</h1><p>åœ¨å®é™…å†™ä»£ç çš„è¿‡ç¨‹ä¸­, æ‹†è£…ç®±é—®é¢˜å¹¶ä¸å¸¸è§, å› ä¸ºå¤§éƒ¨åˆ†å¼€å‘è€…æƒ³éƒ½ä¸æƒ³åªä¼šæŠŠclassä¼ æ¥ä¼ å», è€Œä¸”æˆ‘ä»¬è‚¯å®šä¸ä¼šé—²å¾—å£°æ˜ä¸€ä¸ªobjectç±»å‹çš„å­—æ®µ, å´ç”¨ä¸€ä¸ªå€¼ç±»å‹çš„æ•°æ®ç»™å®ƒèµ‹å€¼. æ‰€ä»¥ç±»å‹è½¬æ¢ä¸­ä¸»è¦çš„æ€§èƒ½å¼€é”€<strong>åœ¨äºCLRä¼šç”Ÿæˆé¢å¤–ILä»£ç æ‰§è¡Œç±»å‹è½¬æ¢æ˜¯å¦åˆæ³•çš„åˆ¤æ–­é€»è¾‘</strong>(ç¨‹åºå‘˜ä¸€èˆ¬æƒ…å†µä¸‹è¿˜æ˜¯å¯ä»¥ä¿è¯ç±»å‹è½¬æ¢æ˜¯åˆæ³•çš„).</p><h1>å…¶ä»–è¦æ³¨æ„çš„ç‚¹</h1><p><strong>ç±»å‹æ£€æŸ¥ä¸­è¦æ³¨æ„çš„ç‚¹</strong><br>ä½¿ç”¨<code>is</code>æ“ä½œç¬¦å’Œ<code>.GetType()</code>æ¥å£éƒ½å¯ä»¥åšç±»å‹æ£€æŸ¥, ä½†æ˜¯ä¸¤è€…çš„å¼€é”€æ˜¯ä¸åŒçš„, æŒ‰ç…§GPTçš„è¯´æ³•, <code>is</code>æ“ä½œç¬¦çš„æ€§èƒ½å¼€é”€è¦å°äº<code>.GetType()</code>çš„å¼€é”€:</p><ul><li>ä½¿ç”¨<code>is</code>æ“ä½œç¬¦, C#ç¼–è¯‘å™¨ç”Ÿæˆç›´æ¥çš„ç±»å‹æ£€æŸ¥æŒ‡ä»¤(isinst ILæŒ‡ä»¤), æ— éœ€è§¦å‘å®Œæ•´çš„ç±»å‹å…ƒæ•°æ®åŠ è½½. <code>is</code>æ“ä½œç¬¦ä¼šåˆ©ç”¨ç±»å‹ç»§æ‰¿å…³ç³»è¿›è¡Œå¿«é€Ÿåˆ¤æ–­, æ— éœ€è·å–å®Œæ•´çš„Typeå¯¹è±¡, å€¼ç±»å‹ä¼˜åŒ–: å¦‚æœè½¬æ¢åçš„ç±»å‹æ˜¯å€¼ç±»å‹, isä¼šé¿å…è£…ç®±, å‰ææ˜¯objæ˜¯å€¼ç±»å‹ä¸”ç±»å‹å…¼å®¹</li><li>ä½¿ç”¨<code>.GetType()</code>æ—¶, ä¼šè§¦å‘å®Œæ•´ç±»å‹å…ƒæ•°æ®åŠ è½½, éœ€è¦è®¿é—®å¯¹è±¡çš„Typeå¯¹è±¡, æ¶‰åŠå…ƒæ•°æ®æŸ¥è¯¢<br>ç²¾ç¡®ç±»å‹æ¯”è¾ƒ: GetTypE()è¿”å›çš„æ˜¯å¯¹è±¡çš„å®é™…è¿è¡Œæ—¶ç±»å‹, ä¸typeof(MyType)æ¯”è¾ƒæ—¶,åªæœ‰å½“objçš„è¿è¡Œæ—¶ç±»å‹å®Œå…¨ç­‰äºMyTypeæ—¶æ‰è¿”å›true, <code>.GetType()</code>æ˜¯è™šæ–¹æ³•è°ƒç”¨, éœ€ç»è¿‡è™šæ–¹æ³•è¡¨æŸ¥æ‰¾.</li></ul><p>å½“ç„¶, <code>.GetType</code>ä¹Ÿæœ‰å…¶ç”¨æ­¦ä¹‹å¤„, å› ä¸ºåœ¨æœ‰äº›åœºæ™¯ä¸‹ç¡®å®æ˜¯éœ€è¦ç²¾ç¡®æŸ¥æ‰¾çš„, ç»§æ‰¿å…³ç³»A-&gt;B-&gt;C, Aæ˜¯åŸºç±», å¦‚æœä¼ å…¥çš„å®ä¾‹æ˜¯C, ä½¿ç”¨<code>is B</code>è¿”å›çš„ç»“æœæ˜¯true, è€Œä½¿ç”¨<code>.GetType() == typeof(B)</code> è¿”å›çš„æ˜¯false. å®é™…å¼€å‘ä¸­å¤§éƒ¨åˆ†åœºæ™¯ä¸‹<code>is</code>æ“ä½œç¬¦å°±è¶³å¤Ÿå®Œæˆéœ€æ±‚äº†.</p><p><strong>typeofã€GetType()ã€is å’Œ as è¿™å››ç§ç±»å‹åˆ¤æ–­æ“ä½œçš„å¼€é”€å¯¹æ¯”</strong></p><table><thead><tr><th>æ“ä½œ</th><th>å¼€é”€æ¥æº</th><th>é€‚ç”¨åœºæ™¯</th><th>ç¤ºä¾‹ä»£ç </th></tr></thead><tbody><tr><td>typeof(T)</td><td>âš¡ï¸ ç¼–è¯‘æ—¶é™æ€è§£æï¼ˆé›¶è¿è¡Œæ—¶å¼€é”€ï¼‰</td><td>ç¼–è¯‘æ—¶å·²çŸ¥ç±»å‹</td><td>if (type == typeof(MyClass))</td></tr><tr><td>is</td><td>âš¡ï¸ å•æ¬¡ç±»å‹æ£€æŸ¥ï¼ˆæ— è½¬æ¢ï¼‰</td><td>å®‰å…¨ç±»å‹æ£€æŸ¥</td><td>if (obj is MyClass)</td></tr><tr><td>as</td><td>âš¡ï¸ å•æ¬¡ç±»å‹æ£€æŸ¥ + è¿”å›è½¬æ¢ç»“æœ</td><td>å®‰å…¨ç±»å‹è½¬æ¢</td><td>var x = obj as MyClass;</td></tr><tr><td>GetType()</td><td>âš ï¸ è®¿é—®å¯¹è±¡ç±»å‹å¥æŸ„ + å…ƒæ•°æ®æŸ¥æ‰¾</td><td>éœ€è·å–å¯¹è±¡å®é™…è¿è¡Œæ—¶ç±»å‹</td><td>if (obj.GetType() == typeof(MyClass))</td></tr></tbody></table><p><strong>å€¼ç±»å‹ã€å¼•ç”¨ç±»å‹ä¸é—­åŒ…</strong></p><p>å› ä¸ºå€¼ç±»å‹çš„ç”Ÿå‘½å‘¨æœŸä¼šéšç€å…¶ä½œç”¨åŸŸçš„ç»“æŸè€Œé‡Šæ”¾æ‰, ä½†æ˜¯å¼•ç”¨ç±»å‹ä¸ä¼š, å¼•ç”¨ç±»å‹é‡Šæ”¾æ‰çš„åªæ˜¯æŒ‡å‘å †ä¸Šå†…å­˜ä½ç½®çš„æŒ‡é’ˆè€Œå·². æœ¬æ¥ç¬”è€…è®¡åˆ’ä½¿ç”¨é—­åŒ…çš„æ–¹å¼æŠŠä¸¤ç§ç±»å‹å¸¦å‡ºå…¶å„è‡ªçš„ä½œç”¨åŸŸ, ä¸è¿‡å®æ“ä¸‹æ¥, ä¸¤ç§ç±»å‹é‡Œé¢çš„æ•°æ®éƒ½æ˜¯æ­£å¸¸è¯»å–çš„. æ®GPTè¯´å€¼ç±»å‹çš„é—­åŒ…æ˜¯å°†æ•°æ®å¤åˆ¶äº†ä¸€ä»½ä¼ å…¥åˆ°äº†é—­åŒ…ä¸­, å› æ­¤åœ¨åŸå€¼ç±»å‹æ•°æ®ç”Ÿå‘½å‘¨æœŸå¤–æ•°æ®èƒ½æ­£ç¡®è¯»å–, è€Œå¼•ç”¨ç±»å‹åˆ™æ˜¯åœ¨å…¶ç”Ÿå‘½å‘¨æœŸç»“æŸä¹‹å, çœŸæ­£çš„æ•°æ®è¿˜éƒ½å­˜æ”¾åœ¨å †ä¸Šå‘¢æ ¹æœ¬å°±æ²¡é‡Šæ”¾æ‰å‘¢, å› æ­¤å¯ä»¥æ­£ç¡®è¯»å–, ä¸è¿‡ç¬”è€…ä¸ªäººçŒœæµ‹, å¼•ç”¨ç±»å‹æœ¬èº«(æˆ–è€…å«åˆ›å»ºåœ¨çº¿ç¨‹æ ˆä¸ŠæŒ‡å‘å †ä¸­æ•°æ®çš„æŒ‡é’ˆ)åœ¨ç”Ÿå‘½å‘¨æœŸç»“æŸåå…¶å®ä¹Ÿè¢«é‡Šæ”¾æ‰äº†, åœ¨é—­åŒ…ä¸­ä¹Ÿæ˜¯ä¼ å…¥äº†è¿™ä¸ªå¼•ç”¨ç±»å‹æœ¬èº«çš„ä¸€ä»½æ‹·è´è€Œå·². ä½†æ˜¯ç¬”è€…åœ¨è¿™é‡Œå°±ä¸æ·±ç©¶äº†.</p><h1>æ›´ä¼˜é›…çš„ç±»å‹è½¬æ¢</h1><p>æŒ‰ç…§GPTçš„è¯´æ³•, æ³›å‹æ˜¯ä¸€ç§èƒ½å¤Ÿè§„é¿ç±»å‹è½¬æ¢ã€ä¸”ä¿è¯ç±»å‹å®‰å…¨çš„åŒèµ¢æ–¹æ³•, æ³›å‹çš„ç±»å‹è½¬æ¢å¹¶ä¸æ˜¯åœ¨è¿è¡Œæ—¶åšçš„, è€Œæ˜¯åœ¨ç¼–è¯‘æ—¶ç¼–è¯‘å™¨é™é»˜åœ°è¿›è¡Œäº†ç±»å‹è½¬æ¢, å› æ­¤æ³›å‹åœ¨è¿è¡Œæ—¶æ˜¯æ²¡æœ‰é¢å¤–å¼€é”€çš„.</p><p>ä¸‹é¢çœ‹ä¸¤ç»„ä»£ç çš„å¯¹æ¯”:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éæ³›å‹æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IUILogic</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnShow</span>(<span class="params"><span class="built_in">object</span> data</span>)</span>; <span class="comment">// æ•°æ®ç”¨ object ä¼ é€’</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnClose</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éæ³›å‹åŸºç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">BaseEUI</span> : <span class="title">MonoBehaviour</span>, <span class="title">IUILogic</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">OnShow</span>(<span class="params"><span class="built_in">object</span> data</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">OnClose</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“ UI ç±»ï¼ˆéœ€æ‰‹åŠ¨è½¬æ¢æ•°æ®ï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayPage</span> : <span class="title">BaseEUI</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnShow</span>(<span class="params"><span class="built_in">object</span> data</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> showData = (PlayPageShowData)data; <span class="comment">// è¿è¡Œæ—¶è½¬æ¢</span></span><br><span class="line">        <span class="comment">// å®é™…é€»è¾‘...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnClose</span>()</span> &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UI ç®¡ç†å™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UIMgr</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UIMgr Instance &#123; <span class="keyword">get</span>; &#125; = <span class="keyword">new</span> UIMgr();</span><br><span class="line">    <span class="keyword">private</span> Dictionary&lt;Type, BaseEUI&gt; _uiInstances = <span class="keyword">new</span> Dictionary&lt;Type, BaseEUI&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShowUI</span>(<span class="params">Type uiType, <span class="built_in">object</span> data</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_uiInstances.TryGetValue(uiType, <span class="keyword">out</span> <span class="keyword">var</span> ui))</span><br><span class="line">        &#123;</span><br><span class="line">            ui.OnShow(data); <span class="comment">// éæ³›å‹è°ƒç”¨</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> obj = Resources.Load(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> go = Object.Instantiate(obj) <span class="keyword">as</span> GameObject;</span><br><span class="line">            ui = go.AddComponent(uiType) <span class="keyword">as</span> BaseEUI;</span><br><span class="line">            ui.OnShow(data);</span><br><span class="line">            _uiInstances.Add(uiType, ui);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">var</span> param = <span class="keyword">new</span> PlayPageShowData();</span><br><span class="line">UIMgr.Instance.ShowUI(<span class="keyword">typeof</span>(PlayPage), param); <span class="comment">// éœ€æ˜¾å¼ä¼ é€’ Type</span></span><br></pre></td></tr></table></figure><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³›å‹æ¥å£ï¼ˆç±»å‹å®‰å…¨ï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IUILogic</span>&lt;<span class="title">TUIShowData</span>&gt; <span class="keyword">where</span> <span class="title">TUIShowData</span> : <span class="title">struct</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnShow</span>(<span class="params">TUIShowData data</span>)</span>; <span class="comment">// æ˜ç¡®æ•°æ®ç±»å‹</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnClose</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³›å‹åŸºç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">BaseEUI</span>&lt;<span class="title">TUIShowData</span>&gt; : <span class="title">MonoBehaviour</span>, <span class="title">IUILogic</span>&lt;<span class="title">TUIShowData</span>&gt; </span><br><span class="line">    <span class="keyword">where</span> <span class="title">TUIShowData</span> : <span class="title">struct</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">OnShow</span>(<span class="params">TUIShowData data</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">OnClose</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“ UI ç±»ï¼ˆæ— éœ€æ‰‹åŠ¨è½¬æ¢æ•°æ®ï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayPage</span> : <span class="title">BaseEUI</span>&lt;<span class="title">PlayPageShowData</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnShow</span>(<span class="params">PlayPageShowData data</span>) <span class="comment">// ç›´æ¥ä½¿ç”¨å…·ä½“ç±»å‹</span></span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ç›´æ¥è®¿é—® data çš„å­—æ®µï¼Œæ— éœ€ç±»å‹è½¬æ¢</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnClose</span>()</span> &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UI ç®¡ç†å™¨ï¼ˆæ³›å‹ç‰ˆï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UIMgr</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UIMgr Instance &#123; <span class="keyword">get</span>; &#125; = <span class="keyword">new</span> UIMgr();</span><br><span class="line">    <span class="keyword">private</span> Dictionary&lt;Type, <span class="built_in">object</span>&gt; _uiInstances = <span class="keyword">new</span> Dictionary&lt;Type, <span class="built_in">object</span>&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³›å‹æ–¹æ³•ï¼šç±»å‹å®‰å…¨ä¸”æ— è£…ç®±</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShowUI</span>&lt;<span class="title">TUI</span>, <span class="title">TUIShowData</span>&gt;(<span class="params">TUIShowData data</span>)</span></span><br><span class="line"><span class="function">        <span class="keyword">where</span> TUI : BaseEUI&lt;TUIShowData&gt;, <span class="keyword">new</span>()</span></span><br><span class="line"><span class="function">        <span class="keyword">where</span> TUIShowData : <span class="keyword">struct</span></span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (_uiInstances.TryGetValue(<span class="keyword">typeof</span>(TUI), <span class="keyword">out</span> <span class="keyword">var</span> ui))</span><br><span class="line">        &#123;</span><br><span class="line">            ((IUILogic&lt;TUIShowData&gt;)ui).OnShow(data); <span class="comment">// éœ€ä¸€æ¬¡æ¥å£è½¬æ¢</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> obj = Resources.Load(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> go = Object.Instantiate(obj) <span class="keyword">as</span> GameObject;</span><br><span class="line">            <span class="keyword">var</span> uiLogic = go.AddComponent&lt;TUI&gt;();</span><br><span class="line">            uiLogic.OnShow(data);</span><br><span class="line">            _uiInstances.Add(<span class="keyword">typeof</span>(TUI), uiLogic);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">var</span> param = <span class="keyword">new</span> PlayPageShowData();</span><br><span class="line">UIMgr.Instance.ShowUI&lt;PlayPage, PlayPageShowData&gt;(param); <span class="comment">// ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥</span></span><br></pre></td></tr></table></figure><p>å¯¹æ¯”ä¸Šé¢ä¸¤ç»„ä»£ç , éæ³›å‹æ–¹å¼æ‰“å¼€ä¸€ä¸ªUIè¦ç»è¿‡4æ¬¡ç±»å‹è½¬æ¢, è€Œä¸”è¿˜æœ‰è£…ç®±å’Œæ‹†ç®±çš„é£é™©; è€Œæ³›å‹ç‰ˆæœ¬æ‰“å¼€ä¸€ä¸ªUIåªéœ€è¦è¿›è¡Œ2æ¬¡ç±»å‹è½¬æ¢</p><p><strong>éæ³›å‹å’Œæ³›å‹æ–¹æ¡ˆå¯¹æ¯”</strong></p><table><thead><tr><th>ç‰¹æ€§</th><th>éæ³›å‹æ–¹æ¡ˆ</th><th>æ³›å‹æ–¹æ¡ˆ (IUILogic<T>)</th></tr></thead><tbody><tr><td>ç±»å‹å®‰å…¨</td><td>âŒ è¿è¡Œæ—¶å¯èƒ½ InvalidCastException</td><td>âœ”ï¸ ç¼–è¯‘æ—¶æ£€æŸ¥</td></tr><tr><td>æ•°æ®ä¼ é€’æ•ˆç‡</td><td>âš ï¸ å€¼ç±»å‹ä¼šè£…ç®±ï¼ˆstruct â†’ objectï¼‰</td><td>âœ”ï¸ æ— è£…ç®±ï¼ˆç›´æ¥ä¼ é€’ structï¼‰</td></tr><tr><td>ä»£ç å¤æ‚åº¦</td><td>âœ”ï¸ æ›´ç®€å•</td><td>âŒ éœ€è¦æ³›å‹çº¦æŸå’Œç±»å‹å‚æ•°</td></tr><tr><td>æ€§èƒ½å¼€é”€</td><td>âš ï¸ è£…ç®±/æ‹†ç®± + ç±»å‹è½¬æ¢</td><td>âš¡ï¸ æ— é¢å¤–å¼€é”€ï¼ˆé™¤å¯èƒ½çš„ as è½¬æ¢ï¼‰</td></tr><tr><td>æ‰©å±•æ€§</td><td>âŒ æ–°å¢ UI éœ€æ‰‹åŠ¨ç»´æŠ¤æ•°æ®ç±»å‹</td><td>âœ”ï¸ è‡ªåŠ¨é€‚é…ä¸åŒ TUIShowData</td></tr></tbody></table><p><strong>æ³¨æ„</strong> æ³›å‹ç¡®å®æ˜¯ä¸€ç§ååˆ†ä¼˜é›…çš„ç±»å‹è½¬æ¢æ–¹å¼, ä½†æ˜¯å¦„å›¾ä½¿ç”¨æ³›å‹æ›¿ä»£æ‰€æœ‰çš„ç±»å‹è½¬æ¢æ˜¯ä¸å¯èƒ½çš„. æ³›å‹åœ¨ä¸€å®šç¨‹åº¦ä¸Šç ´åäº†çªç ´äº†é¢å‘å¯¹è±¡çš„ç»§æ‰¿ç»“æ„çš„é™åˆ¶, ä½†æ˜¯ä½ æƒ³è¦åœ¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ä¸­ç¼–å†™éé¢å‘å¯¹è±¡çš„ä»£ç æ˜¯ååˆ†å›°éš¾çš„, çœ‹ä¸Šé¢UIMgrä»£ç çš„ä¾‹å­ä½ å°±çŸ¥é“äº†, UIMgrä½œä¸ºæ‰€æœ‰UIçš„ç®¡ç†è€…, å®ƒç®¡ç†è€…ä¸€ç±»UI, ä¸ºäº†å®ç°ç®¡ç†ä¸€ç»„å¯¹è±¡çš„æ•ˆæœ, è¿™ä¸€ç»„å¯¹è±¡åœ¨UIMgrçš„è§†è§’ä¸‹å¿…é¡»æ˜¯åŒä¸€ç§ç±»çš„, ä¹Ÿå°±æ˜¯å®ƒä»¬è¦å…·æœ‰åŒä¸€çˆ¶ç±», å› æ­¤å³ä¾¿æ³›å‹æ‰“ç ´äº†ç»§æ‰¿å…³ç³», ä½†æ˜¯åœ¨ç®¡ç†ä¸€ç»„å¯¹è±¡è¿™ç§é¢†åŸŸè¿˜æ˜¯æ— æ³•æ›¿ä»£æ™®é€šç±»å‹è½¬æ¢, æ‰€ä»¥åœ¨ç”±ä¸Šå±‚ç®¡ç†åˆ°åº•å±‚æ‰§è¡Œä¹‹é—´æœ‰ä¸€ä¸ªä¸å¯é¿å…çš„ç±»å‹è½¬æ¢, ä¸è¿‡è¿™ä¸€æ¬¡ç±»å‹è½¬æ¢æ˜¯å¿…å®šæˆåŠŸçš„, è¿™æ˜¯ç”±ä¸Šå±‚ç®¡ç†å’Œåº•å±‚å…·ä½“æ‰§è¡Œè§†è§’ä¸åŒå¯¼è‡´çš„.</p><h1>æ€»ç»“</h1><p>å› æ­¤, æ»¥ç”¨objectä½œä¸ºæ¥å£çš„å‚æ•°å¹¶ä¸æ˜¯ä¸€ç§ä¼˜é›…çš„æ–¹å¼, ç±»å‹è½¬æ¢åœ¨å®é™…å¼€å‘ä¸­ä¸å¯é¿å…, ä½†æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥é€šè¿‡æ³›å‹ç­‰æ–¹å¼å°½å¯èƒ½åœ°å‡å°‘ç±»å‹è½¬æ¢çš„å¼€é”€.</p>]]></content>
      
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UnityUGUIæºç </title>
      <link href="/posts/906aab82/"/>
      <url>/posts/906aab82/</url>
      
        <content type="html"><![CDATA[<h1>UGUIçš„æ¸²æŸ“å’Œ3Dç‰©ä½“æ¸²æŸ“çš„åŒºåˆ«?</h1><p>ç¬”è€…å¸Œæœ›å„ä½è¯»è€…åŒºåˆ†ä¸¤ä¸ªæ¦‚å¿µ: æ¸²æŸ“å’Œæ¸²æŸ“æ‰€éœ€çš„æ•°æ®æ›´æ–°. Unityé¦–å…ˆæ›´æ–°å…¶è¦æ¸²æŸ“ç‰©ä½“çš„æ¸²æŸ“æ•°æ®, ç„¶åæ ¹æ®æ¸²æŸ“æ•°æ®å°†ç”»é¢æ¸²æŸ“åˆ°å±å¹•ä¸Š, ç¬”è€…åœ¨æœ€åˆæ¥è§¦è¿™éƒ¨åˆ†å†…å®¹æ—¶, æŠŠä¸¤è€…æ··ä¸ºä¸€è°ˆ, ç»™è‡ªå·±é€ æˆäº†ç†è§£ä¸Šçš„å›°éš¾, å› æ­¤åœ¨æ­¤è¯´æ˜.</p><p>UGUIçš„æ¸²æŸ“å‘ç”Ÿåœ¨æ¯ä¸€å¸§<code>CanvasUpdateRegistry</code>çš„<code>SendWillRenderCanvases()</code>æ¥å£è¢«è°ƒç”¨ä¹‹å,ä¸è¿‡æˆ‘ä»¬çœ‹ä¸åˆ°è°ƒç”¨è¯¥æ¥å£çš„ä»£ç ,çŒœæµ‹è°ƒç”¨å¤„é€šè¿‡<code>[RequireByNativeCode]</code>ç‰¹æ€§éšè—åœ¨äº†Unityæ›´åº•å±‚çš„å¼•æ“ä»£ç ä¸­. ä½†è¿™ä¸å½±å“æˆ‘ä»¬çŸ¥é“UGUIçš„æ¸²æŸ“ä½äºäº‹ä»¶æ‰§è¡Œçš„ä»€ä¹ˆä½ç½®. ä¸ºäº†çŸ¥é“è¿™å‡ ä¸ªäº‹ä»¶çš„æ‰§è¡Œé¡ºåº,å› ä¸ºè¿™äº›äº‹ä»¶æ˜¯åœ¨æ¯ä¸€å¸§éƒ½æ‰§è¡Œçš„, æ‰€ä»¥ä½¿ç”¨æ–­ç‚¹è°ƒè¯•çš„æ–¹å¼ä¸å¤ªæ–¹ä¾¿, äºæ˜¯ç¬”è€…å°è¯•ä½¿ç”¨Logæ–¹å¼è§‚å¯Ÿå‡ ä¸ªäº‹ä»¶çš„æ‰§è¡Œé¡ºåº,</p><h1>CanvasScaler</h1><p>æŒ‰ç…§æ ‡å‡†åˆ†è¾¨ç‡æ¥è®¾è®¡çš„</p><p>Unityç²’å­çš„Renderå’ŒCanvasçš„OrderInLayeræ˜¯ä¸€æ ·çš„ ç”¨æ¥å¤„ç†æ¸²æŸ“å±‚çº§çš„é—®é¢˜</p><p>å¸¸è§„æ¨¡å‹å’Œç²’å­æ»¡è¶³è°è·ç¦»æ‘„åƒæœºè¿‘è°åæ¸²æŸ“<br>åœ¨Unityä¸­åˆ›å»ºä¸€ä¸ªåœºæ™¯ï¼Œåˆ›å»ºä¸¤ä¸ªImageï¼Œç„¶ååˆ›å»ºä¸€ä¸ªSphereï¼Œå°†Sphereæ”¾ç½®åœ¨ä¸¤ä¸ªImageä¸­é—´ï¼Œä¼šå‘ç”Ÿå¥‡æ€ªçš„äº‹æƒ…<br>UIå’Œå¸¸è§„æ¨¡å‹æ»¡è¶³è°è·ç¦»æ‘„åƒæœºè¿‘è°åæ¸²æŸ“<br>UIå’Œç²’å­å°±ä¸æ»¡è¶³è°è·ç¦»æ‘„åƒæœºè¿‘è°åæ¸²æŸ“ ä¸ºä»€ä¹ˆï¼Ÿ ç»™ç²’å­ç³»ç»ŸæŒ‚è½½RectTransformå°±ä¼šè¿™æ ·<br>ç§»é™¤RectTransformåå°±æ²¡æœ‰é—®é¢˜äº† RectTransformæ”¹å˜äº†ä»€ä¹ˆï¼Ÿ<br>RectTransformç»„ä»¶ä¸Šçš„Pos Zå­—æ®µå¯ä»¥è®¾ç½®æ¸¸æˆå¯¹è±¡çš„Zè½´ä½ç½®ï¼Œä½†æ˜¯ä¸å½±å“æ˜¾ç¤ºé¡ºåºï¼Œåœ¨åŒä¸€ä¸ªCanvasç”»å¸ƒä¸­ï¼Œæ¸¸æˆå¯¹è±¡çš„æ˜¾ç¤ºé¡ºåºç”±Hierarchyè§†å›¾ä¸­çš„é¡ºåºå†³å®š<br>å³ä¾¿æ˜¯åœ¨ä¸åŒçš„Canvasä¸­æƒ³é€šè¿‡è°ƒæ•´PosZå­—æ®µä¹Ÿä¸èƒ½å½±å“æ˜¾ç¤ºé¡ºåº å¤„ç†ä¸åŒCanvasçš„æ˜¾ç¤ºé¡ºåºæ˜¯é€šè¿‡ä¿®æ”¹Canvasçš„ OrderInLayerå€¼æ¥å®ç°çš„</p><p>ç–‘æƒ‘åœºæ™¯<br>ä¸¤ä¸ªCanvasï¼Œæ¯ä¸ªCanvasä¸‹é¢éƒ½æœ‰ä¸€ä¸ªImageç»„ä»¶ï¼ŒHierarchyçª—å£ä¸­Canvas1åœ¨Canvas2ä¸Šé¢ï¼Œæ— è®ºå¦‚ä½•è°ƒæ•´Canvas1å’ŒCanvas2çš„PosZå±æ€§ï¼Œåªè¦ä¸åŠ¨Canvasçš„OrderInLayerå±æ€§ï¼ŒCanvas2å°±ä¸€ç›´ä¼šæ˜¾ç¤ºåœ¨Canvas1ä¸Šé¢<br>Canvas1<br>Canvas2</p><p>å¦‚æœåœ¨åœºæ™¯ä¸­åˆ›å»ºä¸€ä¸ªSphere 3Dç‰©ä½“ï¼Œç‰©ä½“ä¸ŠæŒ‚è½½çš„æ˜¯Transformä¸æ˜¯RectTransformï¼Œè°ƒæ•´Sphereã€Canvas1ã€Canvas2çš„PosZå±æ€§ä½¿å¾—è·ç¦»æ‘„åƒæœºæœ‰è¿œåˆ°è¿‘çš„å…³ç³»ä¸ºï¼šCanvas2ã€Sphereã€Canvas1ï¼Œä¼šå‘ç°Sphereä¼šæ½œå…¥Canvas2ä¸­ï¼Œè€ŒCanvas1æœ¬åº”è¯¥è¢«Canvas2ç›–ä½ï¼Œä½†æ˜¯ç°åœ¨ä¹Ÿä¼šåœ¨Sphereé®æŒ¡Canvas2çš„åŒºåŸŸä¸­æ˜¾ç¤ºå‡ºæ¥ï¼ŒåŸå› æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>å°±ç®—åªæœ‰ä¸€ä¸ªCanvas ä¸‹æ·»åŠ ä¸¤ä¸ªImageç»„ä»¶ï¼ŒHierarchyä¸­Image1åœ¨Image2çš„ä¸Šé¢ å°±ç®—Image1çš„PosZæ¯”Image2çš„PosZè¦å° Image1è¿˜æ˜¯åº”è¯¥è¢«Image2æŒ¡ä½ï¼Œä½†æ˜¯å°†Sphereæ”¾åœ¨ä¸¤ä¸ªImageä¸­é—´çš„æ—¶å€™ä¹Ÿä¼šå‡ºç°ä¸Šè¿°æƒ…å†µï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p><p>RectTransformçš„PosZä¸èƒ½ç”¨æ¥å¤„ç†UIå…ƒç´ ä¹‹é—´çš„å±‚çº§å…³ç³» ä½†æ˜¯å¯ä»¥ç”¨æ¥å¤„ç†UIå’Œ3Dç‰©ä½“ä¹‹é—´çš„å±‚çº§å…³ç³»</p><p>Unityæ˜¯å¦‚ä½•æ¸²æŸ“UIçš„ï¼Ÿ</p><h1>Unityçš„æ¸²æŸ“é¡ºåº</h1><p>å¦‚æœå¼€å¯äº†æ·±åº¦æµ‹è¯•æ°¸è¿œéƒ½æ˜¯ç¦»æ‘„åƒæœºè¿‘çš„ç‰©ä½“è¯¥åœ¨ç¦»æ‘„åƒæœºè¿œçš„ç‰©ä½“ä¹‹å‰</p><h1>Canvas</h1><p>Canvasç»„ä»¶æä¾›äº†ä¸€ä¸ªä¾›UIå¸ƒå±€å’Œæ¸²æŸ“çš„æŠ½è±¡ç©ºé—´ã€‚æ‰€æœ‰çš„UIå…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæŒ‚è½½æœ‰Canvasç»„ä»¶çš„GameObjectçš„å­ã€‚å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªUIå…ƒç´ çš„æ—¶å€™ï¼Œå¦‚æœåœºæ™¯ä¸­è¿˜æ²¡æœ‰ä¸€ä¸ªå¸¦æœ‰Canvasçš„ç‰©ä½“ï¼Œé‚£ä¹ˆä¸€ä¸ªCanvasçš„Objectå°†ä¼šè‡ªåŠ¨è¢«åˆ›å»ºå‡ºæ¥ã€‚</p><h2 id="å±æ€§">å±æ€§</h2><ul><li>Render Mode: UIæ¸²æŸ“åˆ°å±å¹•ä¸Šæˆ–è€…æ˜¯ä½œä¸ºä¸€ä¸ªObjectè¢«æ¸²æŸ“åˆ°3Dç©ºé—´ä¸­çš„æ–¹å¼ã€‚å…±æœ‰ä¸‰ç§é€‰é¡¹ Screen Space - Overlayï¼Œ Screen Space - Cameraå’ŒWorld Space</li><li>Pixel Pefect(Screen Space modes only): ä¸ºäº†ç²¾åº¦UIæ˜¯å¦åº”è¯¥å…³é—­æŠ—é”¯é½¿å¹¶æ¸²æŸ“</li><li>Render Camera(Screen Space - Camera mode onle): UIè¦è¢«æ¸²æŸ“åˆ°å“ªä¸ªCameraä¸Š</li><li>Sort Order: ç”¨äºæ§åˆ¶ä¸é€šè¿‡Canvasä¹‹é—´çš„ç»˜åˆ¶é¡ºåºï¼Œæ•°å€¼è¶Šå¤§ï¼Œè¯¥canvasçš„ç»˜åˆ¶ä¼˜å…ˆçº§è¶Šé«˜ï¼Œä¼šç»˜åˆ¶åœ¨å…¶ä»–Canvasçš„ä¸Šæ–¹</li><li>Plane Distance(Screen Space - Camera mode only): è¢«æ¸²æŸ“çš„UIæ”¾ç½®åœ¨æ¸²æŸ“æ‘„åƒæœºå‰çš„è·ç¦»</li><li>Event Camera(World Space mode only): ç”¨æ¥è¿è¡ŒUI Eventçš„Camera</li><li>Receives Events: UIEventæ˜¯å¦ä¼šè¢«è¯¥Canvasé©±åŠ¨ï¼Ÿ</li></ul><h2 id="ç»†èŠ‚">ç»†èŠ‚</h2><p>å¯¹äºæ‰€æœ‰çš„UIå…ƒç´ å•ä¸ªCanvaså·²ç»æ˜¯è¶³å¤Ÿçš„äº†ï¼Œä½†æ˜¯åœ¨åœºæ™¯ä¸­æ”¾ç½®å¤šä¸ªCanvasä¹Ÿæ˜¯å¯ä»¥çš„ã€‚åŒæ ·åœ°ï¼Œä½¿ç”¨åµŒå¥—Canvasä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¸€èˆ¬æˆ‘ä»¬å‡ºäºä¼˜åŒ–çš„ç›®çš„ä¼šå°†ä¸€ä¸ªCanvasè®¾ç½®ä¸ºå¦ä¸€ä¸ªCanvasçš„å­èŠ‚ç‚¹ã€‚åµŒå¥—Canvasçš„Canvasé‡‡ç”¨å’Œçˆ¶Canvasç›¸åŒçš„æ¸²æŸ“æ¨¡å¼ã€‚</p><p>ä¼ ç»Ÿæ–¹å¼ä¸­ï¼Œæ‰€æœ‰çš„UIå°±åƒå®ƒä»¬æ˜¯ç®€å•çš„å›¾å½¢è®¾è®¡ä¸€æ ·è¢«ç›´æ¥åœ°æ¸²æŸ“åˆ°äº†å±å¹•ä¸Šã€‚è¿™å°±æ˜¯è¯´ï¼Œåœ¨Cameraçš„è§†è§’ä¸‹ï¼Œå®ƒä»¬æ˜¯æ²¡æœ‰3Dç©ºé—´çš„æ¦‚å¿µçš„ã€‚Unityæ”¯æŒè¿™ç§å±å¹•ç©ºé—´çš„æ¸²æŸ“å¹¶ä¸”åŒæ—¶æ”¯æŒUIä½œä¸ºObjectè¢«æ¸²æŸ“åˆ°3Dç©ºé—´ä¸­ï¼Œè¿™å–å†³äºRender Modeçš„å€¼ã€‚</p><h2 id="Screen-Space-Overlay">Screen Space - Overlay</h2><p>è¿™ç§æ¨¡å¼ä¸‹ï¼ŒCanvasä¼šè¢«ç¼©æ”¾ä»¥é€‚åº”å±å¹•ç„¶ååœ¨æ²¡æœ‰åœºæ™¯æˆ–è€…Cameraçš„å‚ç…§ä¸‹ç›´æ¥æ¸²æŸ“å‡ºæ¥ï¼ˆUIä¼šç›´æ¥æ¸²æŸ“å‡ºæ¥ï¼Œå³ä½¿åœºæ™¯ä¸­æ ¹æœ¬å°±æ²¡æœ‰Cameraï¼‰ã€‚å¦‚æœå±å¹•çš„å°ºå¯¸æˆ–è€…åˆ†è¾¨ç‡å‘ç”Ÿäº†æ”¹å˜ï¼Œé‚£ä¹ˆUIä¼šè‡ªåŠ¨åœ°é‡æ–°ç¼©æ”¾æ¥é€‚åº”æ–°çš„å°ºå¯¸ã€‚UIä¼šç»˜åˆ¶åœ¨ä»»ä½•å…¶ä»–å›¾å½¢æ¯”å¦‚æ‘„åƒæœºè§†è§’çš„ä¸Šå±‚</p><p>æ³¨æ„ï¼šScreen Space - Overlayæ¨¡å¼ä¸‹ï¼ŒæŒ‚è½½canvasçš„èŠ‚ç‚¹å¿…é¡»æ˜¯åœ¨hierarchyçª—å£ä¸­çš„æœ€ä¸Šçº§çš„èŠ‚ç‚¹ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·ä½¿ç”¨canvasçš„è¯å¯èƒ½ä¼šå¯¼è‡´UIä»è§†é‡é‡Œæ¶ˆå¤±ã€‚è¿™æ˜¯ä»Unityå¼•æ“è®¾è®¡ä¸Šçš„å±€é™ï¼Œå› æ­¤ä¿æŒScreenSpace - Overlay canvasåœ¨hierarchyçš„æœ€é¡¶å±‚ä»¥ä¿è¯èƒ½å¤Ÿè·å¾—æœŸæœ›çš„æ•ˆæœ</p><h2 id="Screen-Space-Camera">Screen Space - Camera</h2><p>åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒCanvasä¼šè¢«æ¸²æŸ“åœ¨ä¸€ä¸ªå¹³é¢çš„ç‰©ä½“ä¸Šï¼Œè¯¥å¹³é¢è·ç¦»ç»™å®šçš„æ‘„åƒæœºæœ‰ä¸€å®šçš„è·ç¦»ï¼Œè¿™ç§æ¨¡å¼ä¸‹çš„UIæ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„å°ºå¯¸å¹¶ä¸ä¼šéšç€è·ç¦»è€Œå˜åŒ–ï¼Œå› ä¸ºå®ƒæ€»æ˜¯ä¼šé‡æ–°ç¼©æ”¾æ¥é€‚åº”Cameraçš„å¹³æˆªå¤´ä½“ä¸­ï¼Œå¦‚æœå±å¹•çš„å°ºå¯¸æˆ–è€…åˆ†è¾¨ç‡æˆ–è€…Cameraçš„å¹³æˆªå¤´ä½“å‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆè¯¥UIä¼šè‡ªåŠ¨çš„ç¼©æ”¾æ¥é€‚åº”æ”¹å˜è¯ã€‚ä»»ä½•åœ¨åœºæ™¯ä¸­çš„3Dç‰©ä½“å¦‚æœè·ç¦»æ‘„åƒæœºæ¯”è¯¥UIè¿‘çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šè¢«æ¸²æŸ“åœ¨è¯¥UIçš„å‰é¢ï¼Œè€Œåœ¨UIåé¢çš„ç‰©ä½“å°±ä¼šè¢«é®æŒ¡</p><h2 id="World-Space">World Space</h2><p>è¿™ç§æ¨¡å¼ä¸‹çš„UIä¼šæƒ³ä¸€ä¸ªå¹³é¢çš„ç‰©ä½“ä¸€æ ·è¢«æ¸²æŸ“åœ¨åœºæ™¯ä¸­ï¼Œä¸æƒ³Screen Space - Cameraä¸€æ ·ï¼Œè¿™ç§æ¨¡å¼ä¸‹çš„UIä¸éœ€è¦é¢å‘æ‘„åƒæœºå¹¶ä¸”å¯ä»¥æœå‘ä»»ä½•æ–¹å‘ï¼Œè¿™ç§æ¨¡å¼ä¸‹çš„Canvasçš„å°ºå¯¸å¯ä»¥é€šè¿‡è¯¥èŠ‚ç‚¹ä¸Šçš„RectTransformç»„ä»¶è¿›è¡Œè®¾ç½®ã€‚è€Œå®ƒçš„æ˜¾ç¤ºæ•ˆæœå–å†³äºè§‚çœ‹è§’åº¦å’Œè¯¥UIè·ç¦»Cameraçš„è·ç¦»ï¼Œå…¶ä»–åœºæ™¯ä¸­çš„ç‰©ä½“å¯ä»¥ç©¿è¿‡è¯¥UIï¼Œæˆ–è€…åœ¨å®ƒçš„å‰é¢ï¼Œæˆ–è€…åœ¨å®ƒçš„åé¢</p><h1>CanvasScaler</h1><p>Canvas Scalerç»„ä»¶ç”¨æ¥æ§åˆ¶UIå…ƒç´ åœ¨Canvasä¸Šçš„æ•´ä½“ç¼©æ”¾å’Œåƒç´ å¯†åº¦ã€‚è¿™ä¸ªç»„ä»¶ä¼šå½±å“æ‰€æœ‰çš„ä½äºè¯¥Canvasç»„ä»¶ä¸‹çš„UIå…ƒç´ ï¼ŒåŒ…æ‹¬å­—ä½“å¤§å°å’Œå›¾ç‰‡çš„è¾¹ç•Œ</p><h2 id="å±æ€§-2">å±æ€§</h2><ul><li>UIScaleMode:  å†³å®šåœ¨è¯¥Canvasä¸Šçš„UIå…ƒç´ è¯¥å¦‚ä½•è¿›è¡Œç¼©æ”¾<ul><li>ConstantPixelSize: è®©UIå…ƒç´ ä¿æŒç›¸åŒçš„åƒç´ ä¸è®ºå±å¹•çš„å°ºå¯¸<ul><li>Scale Factor: è¯¥Canvasä¸­çš„æ‰€æœ‰UIå…ƒç´ çš„ç¼©æ”¾å—è¯¥factorå½±å“</li><li>ReferencePixelsPerUnit: å¦‚æœä¸€ä¸ªspriteè¿›è¡Œäº†Pixel Per Unityçš„è®¾ç½®ï¼Œé‚£ä¹ˆåœ¨è¯¥spriteä¸­çš„ä¸€ä¸ªåƒç´ å°†ä¼šè¦†ç›–ä¸€ä¸ªå•å…ƒ</li></ul></li><li>ScaleWithScreenSize: å±å¹•çš„å°ºå¯¸è¶Šå¤§ï¼ŒUIå…ƒç´ ä¹Ÿè¶Šå¤§<ul><li>Reference Resolution: UIå¸ƒå±€æ˜¯åŸºäºæ­¤åˆ†è¾¨ç‡è®¾è®¡çš„ï¼Œå¦‚æœå±å¹•åˆ†è¾¨ç‡æ›´å¤§ï¼Œé‚£ä¹ˆUIä¼šè¢«æ”¾å¤§ï¼Œåä¹‹UIä¼šè¢«ç¼©å°</li><li>ScreenMatchMode: ä¸€ç§æ¨¡å¼ç”¨æ¥é€‚åº”ä¸åŒåˆ†è¾¨ç‡UIçš„ç¼©æ”¾æ–¹å¼<ul><li>Match Width or Height: å¦‚æœè®¾å¤‡çš„åˆ†è¾¨ç‡å’Œé»˜è®¤åˆ†è¾¨ç‡ä¸åŒ¹é…çš„è¯ï¼Œé‚£ä¹ˆæ˜¯ä¿è¯å®½å’ŒåŸåˆ†è¾¨ç‡æˆæ¯”ä¾‹è¿˜æ˜¯é«˜ä¸åŸåˆ†è¾¨ç‡æˆæ¯”ä¾‹</li><li>Expand:</li><li>Shrink:</li></ul></li><li>Match: å†³å®š</li><li>Reference Pixels Per Unit</li></ul></li><li>ConstantPhysicalSize: è®©UIå…ƒç´ ä¿æŒåŒæ ·çš„ç‰©ç†å°ºå¯¸çš„å¤§å°è€Œä¸ç®¡å±å¹•çš„å°ºå¯¸å’Œåˆ†è¾¨ç‡<ul><li>Physical Unit:</li><li>Fallback Screen DPI</li><li>Default Sprite DPI</li><li>Reference Pixels Per Unit</li></ul></li></ul></li><li>å½“Canvasçš„RenderModeè¢«è®¾ç½®ä¸ºWorldSpaceçš„æ—¶å€™<ul><li>Dynamic Pixels Per Unitï¼š è¡¨ç¤ºUIä¸­åŠ¨æ€åˆ›å»ºçš„ä½å›¾ï¼Œæ¯”å¦‚Textï¼Œä¸­å•ä¸ªå•å…ƒçš„åƒç´ æ•°é‡</li><li>Reference Pixels Per Unit:  å¦‚æœä¸€ä¸ªspriteæœ‰è¿™ä¸ªPixels Per Unityçš„è®¾ç½®ï¼Œé‚£ä¹ˆåœ¨Spriteä¸­çš„ä¸€ä¸ªåƒç´ å°†ä¼šè¦†ç›–ä¸–ç•Œåœºæ™¯ä¸­éŸ©çš„ä¸€ä¸ªå•å…ƒï¼Œå¦‚æœReference Pixel Per Unit è¢«è®¾ç½®ä¸ºäº†1ï¼Œé‚£ä¹ˆåœ¨spriteä¸­çš„Pixels Per Unitè®¾ç½®å°†ä¼šè¢«ç›´æ¥ä½¿ç”¨</li></ul></li></ul><h2 id="ç»†èŠ‚-2">ç»†èŠ‚</h2><p>å¯¹äºè¢«è®¾ç½®ä¸ºScreen Space - Overlay æˆ–è€… Screen Space - Camera çš„ Canvasï¼ŒCanvas Scaler UI çš„ Scale Mode å¯ä»¥è¢«è®¾ç½®ä¸ºConstant PixelSizeï¼Œ Scale With Screen æˆ–è€… Constant Physical Size</p><h2 id="Constant-Pixel-Size">Constant Pixel Size</h2><h2 id="Scale-With-Screen-Size">Scale With Screen Size</h2><h2 id="Constant-Physical-Size">Constant Physical Size</h2><h2 id="World-Space-2">World Space</h2><h1>CanvasGroup</h1><p>CanvasGroupç”¨æ¥æ§åˆ¶æŸäº›æ–¹é¢</p><h1>CanvasRenderer</h1><p>Canvas Renderer ç»„ä»¶å°†ä¸€ä¸ªCanvasä¸­çš„ä¸€ä¸ªå›¾åƒUIæ¸²æŸ“å‡ºæ¥ï¼Œè¯¥ç»„ä»¶éœ€è¦æŒ‚è½½åœ¨æ¯ä¸€ä¸ªéœ€è¦æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„UIç»„ä»¶ä¸Šï¼ŒCanvas Rendererç»„ä»¶æ²¡æœ‰ä»»ä½•å±æ€§æš´éœ²åœ¨inspectorçª—å£ä¸­</p><h2 id="ç»†èŠ‚-3">ç»†èŠ‚</h2><p>åœ¨Unityçš„èœå•ä¸­å¯ä»¥åˆ›å»ºçš„æ ‡å‡†çš„UIç»„ä»¶ä¸Šä¸è®ºä½ éœ€ä¸éœ€è¦éƒ½æŒ‚è½½æœ‰Canvas Rendererç»„ä»¶ï¼Œä½†æ˜¯å½“æˆ‘ä»¬å¼€å‘æˆ‘ä»¬è‡ªå®šä¹‰çš„UIç»„ä»¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å°†è¯¥ç»„ä»¶æŒ‚è½½åˆ°è‡ªå®šä¹‰UIä¸Šï¼Œå°½ç®¡åœ¨Inspectorçª—å£ä¸­æ²¡æœ‰ä»»ä½•çš„å±æ€§ï¼Œä½†æ˜¯æœ‰ä¸€äº›å±æ€§å’ŒåŠŸèƒ½è¿˜æ˜¯å¯ä»¥é€šè¿‡ä»£ç çš„å½¢å¼æ¥æ§åˆ¶</p><h1>GraphicRaycaster</h1><h1>å‚è€ƒèµ„æ–™</h1><ul><li><a href="http://warmcat.org/chai/blog/?p=4414#more-4414">ã€UGUIæºç åˆ†æã€‘ç›®å½•</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Unityäº‹ä»¶æ›´æ–°é¡ºåº</title>
      <link href="/posts/11d7edcb/"/>
      <url>/posts/11d7edcb/</url>
      
        <content type="html"><![CDATA[<h1>Unityäº‹ä»¶æ‰§è¡Œé¡ºåºå›¾</h1><p><a href="https://docs.unity3d.com/cn/2022.3/uploads/Main/monobehaviour_flowchart.svg"></a></p><h1>Awakeã€OnDestroyã€OnEnableã€OnDisableå››è€…æ‰§è¡Œæ—¶æœºæ¢³ç†</h1><p><code>OnEnable</code>æ–¹æ³•åœ¨AddComponentã€<strong>è·Ÿéšé¢„åˆ¶ä½“å®ä¾‹åŒ–(è¿™é‡Œè¦ååˆ†æ³¨æ„æŒ‚è½½è¯¥è„šæœ¬çš„GameObjçš„avtiveçŠ¶æ€è¦æ˜¯trueçš„æƒ…å†µä¸‹æ‰ä¼šè§¦å‘!)</strong>ã€åœ¨ä»£ç ä¸­æ‰‹åŠ¨è®¾ç½®enableä¸ºtrueçš„æ—¶å€™ä¼šè°ƒç”¨.<br><code>OnDisable</code>æ–¹æ³•æ˜¯è·Ÿéšé¢„åˆ¶ä½“è¢«åˆ é™¤ã€åœ¨ä»£ç ä¸­æ‰‹åŠ¨è®¾ç½®enableä¸ºfalseçš„æ—¶å€™ä¼šè°ƒç”¨.</p><p><code>Awake</code>æ–¹æ³•åœ¨AddComponentã€<strong>è·Ÿéšé¢„åˆ¶ä½“å®ä¾‹åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨(è¿™é‡Œè¦ååˆ†æ³¨æ„æŒ‚è½½è¯¥è„šæœ¬çš„GameObjçš„avtiveçŠ¶æ€è¦æ˜¯trueçš„æƒ…å†µä¸‹æ‰ä¼šè§¦å‘!)</strong>. æ•´ä¸ªç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸåªä¼šè°ƒç”¨ä¸€æ¬¡<br><code>OnDestroy</code>æ–¹æ³•åœ¨è·Ÿéšé¢„åˆ¶ä½“è¢«åˆ é™¤çš„æ—¶å€™è°ƒç”¨. æ•´ä¸ªç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸåªä¼šè°ƒç”¨ä¸€æ¬¡ <strong>æ³¨æ„,å¦‚æœåœ¨è¿™ä¸ªé¢„åˆ¶ä½“è¢«å®ä¾‹åŒ–åˆ°é”€æ¯çš„è¿™ä¸€ç”Ÿå‘½å‘¨æœŸå†…,æŒ‚è½½è¯¥è„šæœ¬çš„èŠ‚ç‚¹çš„activeä¸€ç›´éƒ½æ˜¯false,é‚£ä¹ˆå°±ä¸ä¼šè§¦å‘Awake,ä¹Ÿä¸ä¼šè§¦å‘OnDestroy,åªè¦è¯¥èŠ‚ç‚¹è¢«activeè¿‡,å³ä¾¿è¢«é”€æ¯çš„æ—¶å€™è¯¥èŠ‚ç‚¹å¤„åœ¨not activeçŠ¶æ€,ä¹Ÿä¼šè§¦å‘OnDestroy</strong></p><ul><li><p>ExecuteAlways Propertyçš„ä½¿ç”¨ <a href="https://blog.csdn.net/alexhu2010q/article/details/105437083">https://blog.csdn.net/alexhu2010q/article/details/105437083</a></p></li><li><p><code>yield WaitForEndOfFrame</code>æ˜¯åœ¨å¹²å˜›?</p></li></ul><p>åœ¨éPlayModeä¸‹,æœ‰å“ªäº›ç”Ÿå‘½å‘¨æœŸå†…çš„æ–¹æ³•ä¼šè¢«æ‰§è¡Œ?<br>åœ¨Unityå¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦åœ¨ç¼–è¾‘å™¨å¯åŠ¨æ—¶æˆ–è„šæœ¬é‡æ–°ç¼–è¯‘åæ‰§è¡Œä¸€äº›æ“ä½œï¼Œä¾‹å¦‚åˆå§‹åŒ–æ•°æ®ã€æ³¨å†Œäº‹ä»¶ç­‰ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨InitializeOnLoadç‰¹æ€§æ¥å®ç°è¿™ä¸€éœ€æ±‚ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»InitializeOnLoadç‰¹æ€§çš„ç”¨æ³•ï¼Œå¹¶é€šè¿‡ä¸‰ä¸ªå®é™…æ¡ˆä¾‹æ¥å±•ç¤ºå…¶åº”ç”¨åœºæ™¯ã€‚</p><p>OnValidateæ–¹æ³•æ˜¯ä¸€ä¸ªä»…é™ç¼–è¾‘å™¨çš„å‡½æ•°ï¼Œåœ¨UnityåŠ è½½è„šæœ¬æˆ–æ£€æŸ¥å™¨ä¸­çš„å€¼æ›´æ”¹æ—¶è°ƒç”¨ã€‚å®ƒçš„è°ƒç”¨æ—¶æœºéå¸¸ç‰¹æ®Šï¼Œè¿™é‡Œæ€»ç»“ä¸€ä¸‹ã€‚</p><ol><li><p>OnValidateä¸å—æ’­æ”¾æ¨¡å¼å½±å“ï¼Œåªè¦å…¶å€¼å‘ç”Ÿå˜åŒ–ï¼Œåœ¨éæ’­æ”¾çŠ¶æ€ä¸‹ä¹Ÿä¼šè¢«è°ƒç”¨ï¼ˆå¯ä»¥ç”¨äºéæ’­æ”¾æ¨¡å¼ä¿®æ”¹å‚æ•°åæ›´æ–°ï¼‰ã€‚</p></li><li><p>ä¸å—enabledçŠ¶æ€å½±å“ï¼Œå³ä½¿å…¶æ‰€åœ¨çš„è„šæœ¬è¢«ç¦ç”¨ï¼Œä¿®æ”¹å€¼æ—¶ä¹Ÿä¼šè¢«æ­£å¸¸è°ƒç”¨ã€‚</p></li><li><p>æ›´æ”¹è„šæœ¬enabledçŠ¶æ€æ—¶ï¼Œä¼šè°ƒç”¨ä¸€æ¬¡OnValidateã€‚å¦‚æœåœ¨Play Modeï¼ŒOnValidatedçš„è°ƒç”¨æ—¶æœºåœ¨OnDisableæˆ–è€…OnEnableå‰ã€‚</p></li><li><p>æ›´æ”¹GameObject activeçŠ¶æ€ä¸ä¼šè°ƒç”¨OnValidateï¼Œåªæœ‰OnDisableå’ŒOnEnableä¼šè¢«è°ƒç”¨ã€‚</p></li><li><p>åˆå§‹åŠ è½½æ—¶ï¼Œæ— è®ºenabledçŠ¶æ€å’ŒactiveçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šè¢«è°ƒç”¨å¤šæ¬¡ã€‚å…¶è°ƒç”¨æ—¶æœºåœ¨Awakeä¹‹å‰ã€‚</p></li></ol><p>å¸¸è§ç”¨æ³•ï¼š</p><ol><li><p>ç”¨äºPlay Modeä¸‹ä¿®æ”¹å‚æ•°å€¼ï¼Œå®æ—¶æŸ¥çœ‹æ•ˆæœ</p></li><li><p>å®æ—¶æ›´æ–°èµ„äº§æ–‡ä»¶ï¼Œæ¯”å¦‚æè´¨ã€shaderç­‰</p></li></ol><h1>å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://blog.csdn.net/angry_youth/article/details/117469722">https://blog.csdn.net/angry_youth/article/details/117469722</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>UnityShaderå®ç°æ°´çš„æ•ˆæœ</title>
      <link href="/posts/265490d3/"/>
      <url>/posts/265490d3/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>UnityShaderå®ç°è‰çš„æ•ˆæœ</title>
      <link href="/posts/b1964c5e/"/>
      <url>/posts/b1964c5e/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>UnityShaderå®ç°äº‘çš„æ•ˆæœ</title>
      <link href="/posts/81b49e5c/"/>
      <url>/posts/81b49e5c/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>UnityUGUIé—®é¢˜è®°å½•</title>
      <link href="/posts/2b97ac4f/"/>
      <url>/posts/2b97ac4f/</url>
      
        <content type="html"><![CDATA[<h1>ä¸ºä»€ä¹ˆä¼šæœ‰<code>LayoutRebuilder.ForceRebuildLayoutImmediate(RectTransform)</code>æ¥å£? ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸ªæ¥å£?</h1><p>æˆ‘ä»¬åœ¨æŸä¸€å¸§çš„Updateæˆ–è€…EventInputä¸­æ‰§è¡Œäº†ä¸€æ®µä»£ç , è¿™æ®µä»£ç ä¼šä¿®æ”¹æŸä¸€UGUIç»„ä»¶çš„æŸäº›å±æ€§,æˆ‘ä»¬çŸ¥é“,å½“ä¸€ä¸ªUGUIç»„ä»¶çš„å±æ€§å‘ç”Ÿå˜åŒ–æ—¶,è¿™ä¸ªUGUIç»„ä»¶ä¸‹é¢çš„æ‰€æœ‰UGUIç»„ä»¶çš„å±æ€§ä¹Ÿä¼šè¿å¸¦ç€å‘ç”Ÿå˜åŒ–. ä½†æ˜¯åœ¨ä¸€å¸§å†…,è¿™ç§å˜åŒ–ä¸æ˜¯çœŸçš„åŒæ—¶å‘ç”Ÿçš„,UGUIçš„æ•°æ®æ›´æ–°å‘ç”Ÿåœ¨<code>LateUpdate</code>ä¹‹å,<code>OnPreCull</code>ä¹‹å‰. è¿™æ˜¯ç¬”è€…è¿˜äº²è‡ªéªŒè¯çš„. å…·ä½“éªŒè¯è¿‡ç¨‹åœ¨<a href="">è¿™ç¯‡åšå®¢</a>ä¸­.ä¹Ÿå°±æ˜¯è¯´Unityä¼šå…ˆæ‰§è¡Œå®Œæ‰€æœ‰çš„ä»£ç é€»è¾‘, ç„¶åå†å»æ›´æ–°è¿™äº›UGUIç»„ä»¶çš„å±æ€§, æ‰€ä»¥åœ¨è¿™ä¸€å¸§ä¸­æˆ‘ä»¬æ‰§è¡Œçš„ä¿®æ”¹UGUIç»„ä»¶å±æ€§çš„æ“ä½œ,åªæœ‰åœ¨ä¸‹ä¸€å¸§æ—¶,æˆ‘ä»¬æ‰èƒ½å¤Ÿæ‹¿åˆ°è¿™ä¸ªç»„ä»¶ä¸‹UGUIç»„ä»¶çš„å±æ€§çš„æ­£ç¡®å€¼.<br>å¦‚æœæˆ‘ä»¬æƒ³åœ¨å½“å‰è¿™ä¸€å¸§å°±è·å¾—æ­£ç¡®çš„UGUIç»„ä»¶çš„å±æ€§,é‚£ä¹ˆ<code>LayoutRebuilder.ForceRebuildLayoutImmediate(RectTransform)</code>æ¥å£å°±æ´¾ä¸Šç”¨åœºäº†. è¿™ä¸ªæ¥å£ä¼šå¼ºåˆ¶æ›´æ–°ä¼ å…¥UGUIåŠå…¶å­UGUIçš„RectTransformç»„ä»¶çš„å±æ€§, ç„¶åæˆ‘ä»¬å°±å¯ä»¥åœ¨å½“å‰å¸§è·å¾—æ­£ç¡®çš„å±æ€§å€¼äº†. åœ¨ç¬”è€…çš„å¼€å‘ç»éªŒä¸­, è¯¥æ¥å£ä¸€èˆ¬ä¼šåœ¨ä½¿ç”¨UGUIé‡Œçš„Layoutç›¸å…³ç»„ä»¶çš„æ—¶å€™æ¯”è¾ƒå¸¸ç”¨.</p><h1>ä¸ºä»€ä¹ˆForceRebuildLayoutImmediateå¼€é”€ååˆ†å¤§</h1><h1>å‡ ä¸ªLayoutGroupç»„ä»¶çš„å®ç°åŸç†</h1><p>ä¸€ä¸ªä¾‹å­å°±æ˜¯è®©çˆ¶UIç»„ä»¶çš„å°ºå¯¸è·Ÿç€å­UIç»„ä»¶çš„å°ºå¯¸å˜åŒ–<br><a href="https://blog.csdn.net/yhx956058885/article/details/130729325">https://blog.csdn.net/yhx956058885/article/details/130729325</a></p><h1>Coffee UIEffectè¿™ä¸ªUIæ‰©å±•åº“ é‡Œé¢çš„UIShadowç»„ä»¶ä¸Šçš„å€¼çš„å®ç°åŸç†å’Œä¸åŒæ˜¯ä»€ä¹ˆ? Outlineå’ŒOutline8çš„åŒºåˆ«? Fitè¿˜æœ‰ä¸€ä¸ªä»€ä¹ˆå¿˜äº†çš„åŒºåˆ«?</h1><h1>Screenæ¥å£ä¸­çš„widthå’Œheight å’Œ currentResolutionçš„åŒºåˆ«?</h1><h1>è®©UIå˜ç°è‰²</h1><p>ç»™UIè¦å˜ç°çš„UIç»„ä»¶æŒ‚è½½ä¸€ä¸ªå˜ç°æè´¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;UI/Gray&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        [PerRendererData] _MainTex (&quot;Sprite Texture&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _Color (&quot;Tint&quot;, Color) = (1,1,1,1)</span><br><span class="line"></span><br><span class="line">        _StencilComp (&quot;Stencil Comparison&quot;, Float) = 8</span><br><span class="line">        _Stencil (&quot;Stencil ID&quot;, Float) = 0</span><br><span class="line">        _StencilOp (&quot;Stencil Operation&quot;, Float) = 0</span><br><span class="line">        _StencilWriteMask (&quot;Stencil Write Mask&quot;, Float) = 255</span><br><span class="line">        _StencilReadMask (&quot;Stencil Read Mask&quot;, Float) = 255</span><br><span class="line"></span><br><span class="line">        _ColorMask (&quot;Color Mask&quot;, Float) = 15</span><br><span class="line"></span><br><span class="line">        [Toggle(UNITY_UI_ALPHACLIP)] _UseUIAlphaClip (&quot;Use Alpha Clip&quot;, Float) = 0</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Queue&quot;=&quot;Transparent&quot;</span><br><span class="line">            &quot;IgnoreProjector&quot;=&quot;True&quot;</span><br><span class="line">            &quot;RenderType&quot;=&quot;Transparent&quot;</span><br><span class="line">            &quot;PreviewType&quot;=&quot;Plane&quot;</span><br><span class="line">            &quot;CanUseSpriteAtlas&quot;=&quot;True&quot;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Stencil</span><br><span class="line">        &#123;</span><br><span class="line">            Ref [_Stencil]</span><br><span class="line">            Comp [_StencilComp]</span><br><span class="line">            Pass [_StencilOp]</span><br><span class="line">            ReadMask [_StencilReadMask]</span><br><span class="line">            WriteMask [_StencilWriteMask]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Cull Off</span><br><span class="line">        Lighting Off</span><br><span class="line">        ZWrite Off</span><br><span class="line">        ZTest [unity_GUIZTestMode]</span><br><span class="line">        Blend SrcAlpha OneMinusSrcAlpha</span><br><span class="line">        ColorMask [_ColorMask]</span><br><span class="line"></span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Name &quot;Default&quot;</span><br><span class="line">        CGPROGRAM</span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line">            #pragma target 2.0</span><br><span class="line"></span><br><span class="line">            #include &quot;UnityCG.cginc&quot;</span><br><span class="line">            #include &quot;UnityUI.cginc&quot;</span><br><span class="line"></span><br><span class="line">            #pragma multi_compile __ UNITY_UI_CLIP_RECT</span><br><span class="line">            #pragma multi_compile __ UNITY_UI_ALPHACLIP</span><br><span class="line"></span><br><span class="line">            struct appdata_t</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex   : POSITION;</span><br><span class="line">                float4 color    : COLOR;</span><br><span class="line">                float2 texcoord : TEXCOORD0;</span><br><span class="line">                UNITY_VERTEX_INPUT_INSTANCE_ID</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex   : SV_POSITION;</span><br><span class="line">                fixed4 color    : COLOR;</span><br><span class="line">                float2 texcoord  : TEXCOORD0;</span><br><span class="line">                float4 worldPosition : TEXCOORD1;</span><br><span class="line">                UNITY_VERTEX_OUTPUT_STEREO</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            fixed4 _Color;</span><br><span class="line">            fixed4 _TextureSampleAdd;</span><br><span class="line">            float4 _ClipRect;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line"></span><br><span class="line">            v2f vert(appdata_t v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f OUT;</span><br><span class="line">                UNITY_SETUP_INSTANCE_ID(v);</span><br><span class="line">                UNITY_INITIALIZE_VERTEX_OUTPUT_STEREO(OUT);</span><br><span class="line">                OUT.worldPosition = v.vertex;</span><br><span class="line">                OUT.vertex = UnityObjectToClipPos(OUT.worldPosition);</span><br><span class="line"></span><br><span class="line">                OUT.texcoord = TRANSFORM_TEX(v.texcoord, _MainTex);</span><br><span class="line"></span><br><span class="line">                OUT.color = v.color * _Color;</span><br><span class="line">                return OUT;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f IN) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                half4 color = (tex2D(_MainTex, IN.texcoord) + _TextureSampleAdd) * IN.color;</span><br><span class="line"></span><br><span class="line">                #ifdef UNITY_UI_CLIP_RECT</span><br><span class="line">                color.a *= UnityGet2DClipping(IN.worldPosition.xy, _ClipRect);</span><br><span class="line">                #endif</span><br><span class="line"></span><br><span class="line">                #ifdef UNITY_UI_ALPHACLIP</span><br><span class="line">                clip (color.a - 0.001);</span><br><span class="line">                #endif</span><br><span class="line">                // è‰²å½©å˜ç°  äº®åº¦æå–çŸ©é˜µ</span><br><span class="line">                float gray = dot(color.xyz, float3(0.299, 0.587, 0.114));</span><br><span class="line">                color.xyz = float3(gray, gray, gray);</span><br><span class="line">                return color;</span><br><span class="line">            &#125;</span><br><span class="line">        ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1>UGUIå®ç°æ–‡å­—è¾¹ç¼˜å‘å…‰æ•ˆæœ</h1><h1>Unityå®ç°Textéƒ¨åˆ†åŒºåŸŸå¯å“åº”ç‚¹å‡»</h1><p>æºç </p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> System.Text.RegularExpressions;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.EventSystems;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">UI.UIItems</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HyperlinkText</span> : <span class="title">Text</span>, <span class="title">IPointerClickHandler</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Set_TextLinkFuncCB(Application.OpenURL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> è§£æå®Œæœ€ç»ˆçš„æ–‡æœ¬</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">string</span> m_OutputText;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> è¶…é“¾æ¥ä¿¡æ¯åˆ—è¡¨</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> List&lt;HrefInfo_&gt; m_HrefInfos = <span class="keyword">new</span> List&lt;HrefInfo_&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> æ–‡æœ¬æ„é€ å™¨</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">readonly</span> StringBuilder s_TextBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> è¶…é“¾æ¥æ­£åˆ™</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> Regex s_HrefRegex =</span><br><span class="line">            <span class="keyword">new</span> Regex(<span class="string">@&quot;&lt;a href=([^&gt;\n\s]+)&gt;(.*?)(&lt;/a&gt;)&quot;</span>, RegexOptions.Singleline);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> Regex s_VertexFilter = <span class="keyword">new</span> Regex(<span class="string">@&quot;(|[ \n\r\t]+)&quot;</span>, RegexOptions.Singleline);</span><br><span class="line"></span><br><span class="line">        VertexHelper _toFill = <span class="literal">null</span>;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> æ˜¯å¦ä½¿ç”¨è¶…é“¾æ¥  é»˜è®¤æœªFalse</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="built_in">bool</span> bool_IsLink = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Action&lt;<span class="built_in">string</span>&gt; linkFunc_Cb = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> RectTransform rect_Parent;</span><br><span class="line">        <span class="keyword">private</span> RectTransform Rect_Parent</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (rect_Parent == <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    Transform trans = <span class="keyword">this</span>.transform.parent != <span class="literal">null</span> ? <span class="keyword">this</span>.transform.parent.transform : <span class="keyword">this</span>.transform;</span><br><span class="line">                    rect_Parent = trans.GetComponent&lt;RectTransform&gt;();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> rect_Parent;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½® æ–‡æœ¬ è¶…é“¾æ¥çš„ç‚¹å‡»å›è°ƒäº‹ä»¶</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Set_TextLinkFuncCB</span>(<span class="params">Action&lt;<span class="built_in">string</span>&gt; linkFunc_Cb</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            bool_IsLink = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.linkFunc_Cb != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">this</span>.linkFunc_Cb = <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span>.linkFunc_Cb = linkFunc_Cb;</span><br><span class="line">            OnPopulateMesh(_toFill);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å­—ç¬¦é¡¶ç‚¹æ•°</span></span><br><span class="line">        <span class="keyword">const</span> <span class="built_in">int</span> perCharVerCount = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> æ–‡æœ¬æ„é€ å™¨</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">readonly</span> StringBuilder textRebuild = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnPopulateMesh</span>(<span class="params">VertexHelper toFill</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (toFill == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            _toFill = toFill;</span><br><span class="line">            <span class="comment">//TODO ç¼–è¾‘å™¨çŠ¶æ€ä¸‹è¿™é‡Œä¸æ‰§è¡Œï¼Œ æ–¹ä¾¿è°ƒè¯•çœ‹åˆ°æ•ˆæœç”¨</span></span><br><span class="line">            <span class="keyword">if</span> (!bool_IsLink)</span><br><span class="line">            &#123;</span><br><span class="line">                m_Text = GetOutputText_Nomal(text);</span><br><span class="line">                <span class="keyword">base</span>.OnPopulateMesh(toFill);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> orignText = m_Text;</span><br><span class="line">            m_OutputText = GetOutputText_Init(text);</span><br><span class="line">            m_Text = m_OutputText;</span><br><span class="line">            text = m_OutputText;</span><br><span class="line">            <span class="keyword">base</span>.OnPopulateMesh(toFill);</span><br><span class="line">            m_Text = orignText;</span><br><span class="line">            GetOutputText(text, toFill.currentVertCount);</span><br><span class="line"></span><br><span class="line">            UIVertex vert = <span class="keyword">new</span> UIVertex();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¤„ç†è¶…é“¾æ¥åŒ…å›´æ¡†</span></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> hrefInfo <span class="keyword">in</span> m_HrefInfos)</span><br><span class="line">            &#123;</span><br><span class="line">                hrefInfo.boxes.Clear();</span><br><span class="line">                <span class="keyword">if</span> (hrefInfo.startIndex &gt;= toFill.currentVertCount)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å°†è¶…é“¾æ¥é‡Œé¢çš„æ–‡æœ¬é¡¶ç‚¹ç´¢å¼•åæ ‡åŠ å…¥åˆ°åŒ…å›´æ¡†</span></span><br><span class="line">                toFill.PopulateUIVertex(<span class="keyword">ref</span> vert, hrefInfo.startIndex);</span><br><span class="line">                <span class="keyword">var</span> pos = vert.position;</span><br><span class="line">                <span class="keyword">var</span> bounds = <span class="keyword">new</span> Bounds(pos, Vector3.zero);</span><br><span class="line">                Vector3 previousPos = Vector3.zero;</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = hrefInfo.startIndex, m = hrefInfo.endIndex; i &lt; m; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (i &gt;= toFill.currentVertCount)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    toFill.PopulateUIVertex(<span class="keyword">ref</span> vert, i);</span><br><span class="line">                    pos = vert.position;</span><br><span class="line">                    <span class="keyword">if</span> ((i - hrefInfo.startIndex) % <span class="number">4</span> == <span class="number">1</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        previousPos = pos;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (previousPos != Vector3.zero &amp;&amp; (i - hrefInfo.startIndex) % <span class="number">4</span> == <span class="number">0</span> &amp;&amp; pos.x &lt; previousPos.x) <span class="comment">// æ¢è¡Œé‡æ–°æ·»åŠ åŒ…å›´æ¡†</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        hrefInfo.boxes.Add(<span class="keyword">new</span> Rect(bounds.min, bounds.size));</span><br><span class="line">                        bounds = <span class="keyword">new</span> Bounds(pos, Vector3.zero);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        bounds.Encapsulate(pos); <span class="comment">// æ‰©å±•åŒ…å›´æ¡†</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                hrefInfo.boxes.Add(<span class="keyword">new</span> Rect(bounds.min, bounds.size));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.gameObject.activeInHierarchy)</span><br><span class="line">            &#123;</span><br><span class="line">                StartCoroutine(RefrehLayout());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">IEnumerator <span class="title">RefrehLayout</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title">WaitForEndOfFrame</span>()</span>;</span><br><span class="line">            LayoutRebuilder.ForceRebuildLayoutImmediate(Rect_Parent);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–è¶…é“¾æ¥æ–‡æœ¬ è·å–æœ€ç»ˆç»“æœçš„å®šç‚¹æ•°ç”¨</span></span><br><span class="line">        <span class="function"><span class="built_in">string</span> <span class="title">GetOutputText_Init</span>(<span class="params"><span class="built_in">string</span> outputText</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            s_TextBuilder.Length = <span class="number">0</span>;</span><br><span class="line">            m_HrefInfos.Clear();</span><br><span class="line">            <span class="keyword">var</span> indexText = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">foreach</span> (Match match <span class="keyword">in</span> s_HrefRegex.Matches(outputText))</span><br><span class="line">            &#123;</span><br><span class="line">                s_TextBuilder.Append(outputText.Substring(indexText, match.Index - indexText));</span><br><span class="line">                s_TextBuilder.Append(match.Groups[<span class="number">2</span>].Value);</span><br><span class="line">                indexText = match.Index + match.Length;</span><br><span class="line">            &#125;</span><br><span class="line">            s_TextBuilder.Append(outputText.Substring(indexText, outputText.Length - indexText));</span><br><span class="line">            <span class="keyword">return</span> s_TextBuilder.ToString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> è·å–è¶…é“¾æ¥è§£æåçš„æœ€åè¾“å‡ºæ–‡æœ¬</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="built_in">string</span> <span class="title">GetOutputText</span>(<span class="params"><span class="built_in">string</span> outputText, <span class="built_in">int</span> currentVertCount</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            s_TextBuilder.Length = <span class="number">0</span>;</span><br><span class="line">            m_HrefInfos.Clear();</span><br><span class="line">            <span class="keyword">var</span> indexText = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">int</span> vertCount = Regex.Replace(Regex.Replace(outputText.ToString(), <span class="string">@&quot;\s&quot;</span>, <span class="string">&quot;&quot;</span>), <span class="string">@&quot;&lt;(.*?)&gt;&quot;</span>, <span class="string">&quot;&quot;</span>).Length * <span class="number">4</span>;</span><br><span class="line">            <span class="built_in">int</span> vercCount_Offset_Start = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">int</span> vercCount_Offset_End = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">bool</span> isLineCup = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (currentVertCount &gt; vertCount)</span><br><span class="line">            &#123;</span><br><span class="line">                isLineCup = <span class="literal">true</span>;</span><br><span class="line">                vercCount_Offset_Start = <span class="number">80</span>;</span><br><span class="line">                vercCount_Offset_End = <span class="number">88</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">foreach</span> (Match match <span class="keyword">in</span> s_HrefRegex.Matches(outputText))</span><br><span class="line">            &#123;</span><br><span class="line">                s_TextBuilder.Append(outputText.Substring(indexText, match.Index - indexText));</span><br><span class="line">                <span class="built_in">int</span> offset_Len = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span> (isLineCup)</span><br><span class="line">                &#123;</span><br><span class="line">                    offset_Len = (s_TextBuilder.Length - Regex.Replace(s_TextBuilder.ToString(), <span class="string">@&quot;&lt;(.*?)&gt;&quot;</span>, <span class="string">&quot;&quot;</span>).Length) * <span class="number">4</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                s_TextBuilder.Append(<span class="string">&quot;&lt;i&gt;&lt;b&gt;&lt;color=#f49037&gt;&quot;</span>);  <span class="comment">// è¶…é“¾æ¥é¢œè‰²</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> str = Regex.Replace(s_TextBuilder.ToString(), <span class="string">@&quot;\s&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">                <span class="keyword">var</span> <span class="keyword">group</span> = match.Groups[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">var</span> hrefInfo = <span class="keyword">new</span> HrefInfo_</span><br><span class="line">                &#123;</span><br><span class="line">                    startIndex = Regex.Replace(str, <span class="string">@&quot;&lt;(.*?)&gt;&quot;</span>, <span class="string">&quot;&quot;</span>).Length * <span class="number">4</span> + vercCount_Offset_Start + offset_Len, <span class="comment">// è¶…é“¾æ¥é‡Œçš„æ–‡æœ¬èµ·å§‹é¡¶ç‚¹ç´¢å¼•</span></span><br><span class="line">                    endIndex = (Regex.Replace(str, <span class="string">@&quot;&lt;(.*?)&gt;&quot;</span>, <span class="string">&quot;&quot;</span>).Length +</span><br><span class="line">                        Regex.Replace(Regex.Replace(match.Groups[<span class="number">2</span>].ToString(), <span class="string">@&quot;\s&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">                            , <span class="string">@&quot;&lt;(.*?)&gt;&quot;</span>, <span class="string">&quot;&quot;</span>).Length - <span class="number">1</span>) * <span class="number">4</span> + <span class="number">3</span> + vercCount_Offset_End + offset_Len,</span><br><span class="line">                    name = <span class="keyword">group</span>.Value</span><br><span class="line">                &#125;;</span><br><span class="line">                m_HrefInfos.Add(hrefInfo);</span><br><span class="line">                <span class="comment">//Debug.Log($&quot;é¡¶ç‚¹ä¿¡æ¯ï¼Œå¼€å§‹çš„ï¼š&#123;hrefInfo.startIndex&#125;ï¼Œç»“æŸçš„ï¼š&#123;hrefInfo.endIndex&#125;&quot;);</span></span><br><span class="line"></span><br><span class="line">                s_TextBuilder.Append(match.Groups[<span class="number">2</span>].Value);</span><br><span class="line">                s_TextBuilder.Append(<span class="string">&quot;&lt;/color&gt;&lt;/b&gt;&lt;/i&gt;&quot;</span>);</span><br><span class="line">                indexText = match.Index + match.Length;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            s_TextBuilder.Append(outputText.Substring(indexText, outputText.Length - indexText));</span><br><span class="line">            <span class="keyword">return</span> s_TextBuilder.ToString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–ç¥›é™¤æ‰è¶…é“¾æ¥ ä¿ç•™æ™®é€šæ–‡æœ¬  ä¿è¯é…ç½®é‡Œè¶…é“¾æ¥æ ‡ç­¾çš„æ–‡æœ¬  åœ¨å…¶ä»–åœ°æ–¹ä¹Ÿå¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œåªæœ‰è°ƒç”¨äº†è¶…é“¾æ¥åˆå§‹åŒ–çš„  æ‰ä¼šç»™è¶…é“¾æ¥å½¢å¼çš„æ–‡æœ¬</span></span><br><span class="line">        <span class="function"><span class="built_in">string</span> <span class="title">GetOutputText_Nomal</span>(<span class="params"><span class="built_in">string</span> outputText</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            s_TextBuilder.Length = <span class="number">0</span>;</span><br><span class="line">            m_HrefInfos.Clear();</span><br><span class="line">            <span class="keyword">var</span> indexText = <span class="number">0</span>;</span><br><span class="line">            MatchCollection matchs = s_HrefRegex.Matches(outputText);</span><br><span class="line">            <span class="keyword">if</span> (matchs.Count &lt;= <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> outputText;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">foreach</span> (Match match <span class="keyword">in</span> matchs)</span><br><span class="line">            &#123;</span><br><span class="line">                s_TextBuilder.Append(outputText.Substring(indexText, match.Index - indexText));</span><br><span class="line">                s_TextBuilder.Append(match.Groups[<span class="number">2</span>].Value);</span><br><span class="line">                indexText = match.Index + match.Length;</span><br><span class="line">            &#125;</span><br><span class="line">            s_TextBuilder.Append(outputText.Substring(indexText, outputText.Length - indexText));</span><br><span class="line">            <span class="keyword">return</span> s_TextBuilder.ToString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnPointerClick</span>(<span class="params">PointerEventData eventData</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Vector2 lp;</span><br><span class="line">            RectTransformUtility.ScreenPointToLocalPointInRectangle(</span><br><span class="line">                rectTransform, eventData.position, eventData.pressEventCamera, <span class="keyword">out</span> lp);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> hrefInfo <span class="keyword">in</span> m_HrefInfos)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> boxes = hrefInfo.boxes;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; boxes.Count; ++i)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (boxes[i].Contains(lp))</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">//Debug.Log(&quot;æŠ€èƒ½ è¶…é“¾æ¥ ç‚¹å‡»äº†ï¼š&quot; + hrefInfo.name);</span></span><br><span class="line">                        linkFunc_Cb?.Invoke(hrefInfo.name);</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> è¶…é“¾æ¥ä¿¡æ¯ç±»</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">class</span> <span class="title">HrefInfo_</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> startIndex;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> endIndex;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">readonly</span> List&lt;Rect&gt; boxes = <span class="keyword">new</span> List&lt;Rect&gt;();</span><br><span class="line">    &#125;       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> terms2 = <span class="string">$&quot;&lt;color=#aa3900&gt;&lt;a herf=<span class="subst">&#123;PrivacyPolicyDefine.UrlService&#125;</span>&gt;<span class="subst">&#123;ScriptLocalization.terms_of_use&#125;</span>&lt;/a&gt;&lt;/color&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> policy2 = <span class="string">$&quot;&lt;color=#aa3900&gt;&lt;a herf=<span class="subst">&#123;PrivacyPolicyDefine.UrlPrivacy&#125;</span>&gt;<span class="subst">&#123;ScriptLocalization.privacy_policy&#125;</span>&lt;/a&gt;&lt;/color&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">_ui.contentText.text = <span class="built_in">string</span>.Format(ScriptLocalization.terms_policy_dlg_content, terms2, policy2);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>UnityEditoråŠŸèƒ½å¼€å‘</title>
      <link href="/posts/2e6b555f/"/>
      <url>/posts/2e6b555f/</url>
      
        <content type="html"><![CDATA[<h1>GUIã€EditorGUIã€GUILayoutã€EditorGUILayoutã€EditorGUIUtilityã€GUIUtility</h1><p>GUIé™„å¸¦çš„è¿˜æœ‰GUIGroupã€GUIStyleç­‰ EditorGUIå¥½åƒæ²¡æœ‰?<br>åœ¨UnityEditorå¼€å‘ä¸­ä¸‹é¢è¿™äº›ç±»å‹éƒ½æ˜¯å¯ä»¥ç”¨çš„<br><a href="https://docs.unity3d.com/ScriptReference/GUI.html">https://docs.unity3d.com/ScriptReference/GUI.html</a><br><a href="https://docs.unity3d.com/ScriptReference/GUIContent.html">https://docs.unity3d.com/ScriptReference/GUIContent.html</a><br><a href="https://docs.unity3d.com/ScriptReference/GUISkin.html">https://docs.unity3d.com/ScriptReference/GUISkin.html</a><br><a href="https://docs.unity3d.com/ScriptReference/GUIStyle.html">https://docs.unity3d.com/ScriptReference/GUIStyle.html</a><br><a href="https://docs.unity3d.com/ScriptReference/EditorGUI.html">https://docs.unity3d.com/ScriptReference/EditorGUI.html</a><br><a href="https://docs.unity3d.com/ScriptReference/EditorStyles.html">https://docs.unity3d.com/ScriptReference/EditorStyles.html</a></p><h1>EditorToolBar</h1><h1>EditorApplication</h1><h1>åœ¨Editorä¸‹ä½¿ç”¨å¼‚æ­¥</h1><h2 id="å¤šçº¿ç¨‹æ–¹å¼">å¤šçº¿ç¨‹æ–¹å¼</h2><p>æ’ä»¶Figma Convert Unityä¸­å°±ä½¿ç”¨äº†å¤šçº¿ç¨‹çš„æ–¹å¼</p><h2 id="ä½¿ç”¨åç¨‹">ä½¿ç”¨åç¨‹</h2><p>Unityæä¾›çš„ä¸€äº›è¿è¡Œæ—¶I/Oå‘çš„æ“ä½œ, å¯ä»¥é€šè¿‡ä½¿å…¶æ”¯æŒawaitçš„æ–¹å¼åœ¨Editoræ¨¡å¼ä¸‹ä½¿ç”¨</p><h1>æ‹“å±•UnityInspectorçª—å£</h1><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Reflection;</span><br><span class="line"><span class="keyword">using</span> UnityEditor;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DDZ</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">CustomEditor(typeof(RectTransform))</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RectTransformEditor</span> : <span class="title">Editor</span></span><br><span class="line">    &#123;</span><br><span class="line">        Color defutColor;</span><br><span class="line">        RectTransform rectTransform;</span><br><span class="line">        UIRuntimeComponents runtimeComponents;</span><br><span class="line">        Object[] components;</span><br><span class="line">        Editor rectTransformEditor;</span><br><span class="line">        <span class="keyword">static</span> <span class="built_in">bool</span> showCustom = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        GUIContent toggleLabel = <span class="keyword">new</span> GUIContent(<span class="string">&quot; èŠ‚ç‚¹æ”¶é›†&quot;</span>);</span><br><span class="line">        GUIStyle style = <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnEnable</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//åå°„è·å–ectTransformEditor</span></span><br><span class="line">            <span class="keyword">var</span> type = Assembly.GetAssembly(<span class="keyword">typeof</span>(Editor)).GetType(<span class="string">&quot;UnityEditor.RectTransformEditor&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">            <span class="keyword">if</span> (type==<span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            rectTransformEditor = CreateEditor(target, type);</span><br><span class="line"></span><br><span class="line">            rectTransform = (RectTransform) target;</span><br><span class="line">            <span class="keyword">if</span> (rectTransform != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                defutColor = GUI.backgroundColor;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">//è·å–RuntimeComponentsç»„ä»¶</span></span><br><span class="line">                runtimeComponents = FindUIRuntimeComponents(rectTransform.parent);</span><br><span class="line">            </span><br><span class="line">                <span class="comment">//æ”¶é›†èŠ‚ç‚¹ï¼Œæ·»åŠ GameObjectï¼Œå¹¶ä¸”åˆ é™¤CanvasRenderer</span></span><br><span class="line">                components = rectTransform.GetComponents&lt;Component&gt;();</span><br><span class="line">                <span class="keyword">var</span> list = components.ToList();</span><br><span class="line">                list.Add(rectTransform.gameObject);</span><br><span class="line">                <span class="built_in">int</span> len = list.Count;</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = len - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">var</span> component = list[i];</span><br><span class="line">                    <span class="keyword">var</span> typeStr = component.GetType().Name;</span><br><span class="line">                    <span class="keyword">if</span> (typeStr == <span class="string">&quot;CanvasRenderer&quot;</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        list.RemoveAt(i);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                components = list.ToArray();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnInspectorGUI</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (rectTransform == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (rectTransformEditor)</span><br><span class="line">            &#123;</span><br><span class="line">                rectTransformEditor.OnInspectorGUI();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (runtimeComponents == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            EditorGUILayout.Space();</span><br><span class="line">            Rect xian1 = GUILayoutUtility.GetRect(GUIContent.none, GUIStyle.none, GUILayout.Height(<span class="number">1</span>));</span><br><span class="line">            Rect backgroundRect = GUILayoutUtility.GetRect(GUIContent.none, GUIStyle.none, GUILayout.Height(<span class="number">20</span>));</span><br><span class="line"></span><br><span class="line">            EditorGUI.DrawRect(xian1, Color.black);</span><br><span class="line">            EditorGUI.DrawRect(backgroundRect, <span class="keyword">new</span> Color(<span class="number">0.25f</span>, <span class="number">0.25f</span>, <span class="number">0.25f</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ç»˜åˆ¶å†…å®¹åŒºåŸŸ</span></span><br><span class="line">            <span class="keyword">if</span> (style==<span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                style = <span class="keyword">new</span> GUIStyle(EditorStyles.foldout);</span><br><span class="line">                style.fontStyle = FontStyle.Bold;</span><br><span class="line">            &#125;</span><br><span class="line">            Rect contentRect = <span class="keyword">new</span> Rect(backgroundRect.x<span class="number">-15</span> , backgroundRect.y, backgroundRect.width+<span class="number">20</span>, backgroundRect.height);</span><br><span class="line">            showCustom = GUI.Toggle(contentRect, showCustom, toggleLabel,style);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (showCustom)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">int</span> len = components.Length;</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">var</span> component = components[i];</span><br><span class="line">                    <span class="keyword">var</span> typeStr = component.GetType().Name;</span><br><span class="line">                    <span class="keyword">if</span> (IsCollected(runtimeComponents, component))</span><br><span class="line">                    &#123;</span><br><span class="line">                        GUI.backgroundColor = Color.green;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        GUI.backgroundColor = defutColor;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (i % <span class="number">3</span> == <span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        GUILayout.BeginHorizontal();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (i == len - <span class="number">1</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">if</span> (GUILayout.Button(typeStr, GUILayout.Width(<span class="number">100</span>), GUILayout.Height(<span class="number">30</span>)))</span><br><span class="line">                        &#123;</span><br><span class="line">                            OperateComponent(component);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">if</span> (GUILayout.Button(typeStr, GUILayout.Height(<span class="number">30</span>)))</span><br><span class="line">                        &#123;</span><br><span class="line">                            OperateComponent(component);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (i % <span class="number">3</span> == <span class="number">2</span> || i == len - <span class="number">1</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        GUILayout.EndHorizontal();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                EditorGUI.indentLevel--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnDisable</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (rectTransformEditor)</span><br><span class="line">            &#123;</span><br><span class="line">                DestroyImmediate(rectTransformEditor);</span><br><span class="line">                rectTransform = <span class="literal">null</span>;</span><br><span class="line">                runtimeComponents = <span class="literal">null</span>;</span><br><span class="line">                components = <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">OperateComponent</span>(<span class="params">Object component</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Event.current.button == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (!Application.isPlaying)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (IsCollected(runtimeComponents, component))</span><br><span class="line">                    &#123;</span><br><span class="line">                        DeleteObject(runtimeComponents, component);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        AddObject(runtimeComponents, component);</span><br><span class="line">                    &#125;</span><br><span class="line">                            </span><br><span class="line">                    EditorApplication.ExecuteMenuItem(<span class="string">&quot;Window/General/Hierarchy&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (Event.current.button == <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (IsCollected(runtimeComponents, component))</span><br><span class="line">                &#123;</span><br><span class="line">                    FindReferences(runtimeComponents, component);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="built_in">bool</span> <span class="title">IsCollected</span>(<span class="params">UIRuntimeComponents runtimeComponents, Object component</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (runtimeComponents.m_objects==<span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">int</span> len = runtimeComponents.m_objects.Length;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (runtimeComponents.m_objects[i] == component)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">AddObject</span>(<span class="params">UIRuntimeComponents runtimeComponents, Object component</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (runtimeComponents.m_objects==<span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                runtimeComponents.m_objects = <span class="keyword">new</span> Object[<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">int</span> len = runtimeComponents.m_objects.Length;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (runtimeComponents.m_objects[i] == component)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">var</span> list = runtimeComponents.m_objects.ToList();</span><br><span class="line">            list.Add(component);</span><br><span class="line">            runtimeComponents.m_objects = list.ToArray();</span><br><span class="line">            SavePrefab(runtimeComponents);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">DeleteObject</span>(<span class="params">UIRuntimeComponents runtimeComponents, Object component</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> list = runtimeComponents.m_objects.ToList();</span><br><span class="line">            <span class="built_in">int</span> len = list.Count;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (list[i] == component)</span><br><span class="line">                &#123;</span><br><span class="line">                    list.RemoveAt(i);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            runtimeComponents.m_objects = list.ToArray();</span><br><span class="line">            <span class="keyword">if</span> (runtimeComponents.m_objects.Length&lt;=<span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                runtimeComponents.m_objects = <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            SavePrefab(runtimeComponents);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">FindReferences</span>(<span class="params">UIRuntimeComponents runtimeComponents, Object component</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            EditorGUIUtility.PingObject(runtimeComponents.gameObject);</span><br><span class="line">            Selection.objects = <span class="keyword">new</span> Object[] &#123;runtimeComponents.gameObject&#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> len = runtimeComponents.m_objects.Length;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (component == runtimeComponents.m_objects[i])</span><br><span class="line">                &#123;</span><br><span class="line">                    runtimeComponents.focusIndex = i;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">UIRuntimeComponents <span class="title">FindUIRuntimeComponents</span>(<span class="params">Transform transform</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (transform == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> runtimeComponents = transform.GetComponent&lt;UIRuntimeComponents&gt;();</span><br><span class="line">            <span class="keyword">if</span> (runtimeComponents != <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">return</span> runtimeComponents;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> FindUIRuntimeComponents(transform.parent);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">SavePrefab</span>(<span class="params">UIRuntimeComponents runtime</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (runtime == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            GameObject save_go = runtime.gameObject;</span><br><span class="line">            <span class="keyword">var</span> assetType = PrefabUtility.GetPrefabAssetType(runtime.gameObject);</span><br><span class="line">            <span class="keyword">if</span> (assetType == PrefabAssetType.Regular) <span class="comment">//å¦‚æœæ˜¯é¢„åˆ¶ä½“çš„ä¸€éƒ¨åˆ†</span></span><br><span class="line">            &#123;</span><br><span class="line">                save_go = PrefabUtility.GetOutermostPrefabInstanceRoot(runtime.gameObject);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (EditorUtility.IsPersistent(save_go))</span><br><span class="line">            &#123;</span><br><span class="line">                EditorUtility.SetDirty(save_go);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">string</span> path =</span><br><span class="line">                    AssetDatabase.GetAssetPath(PrefabUtility.GetCorrespondingObjectFromOriginalSource(save_go));</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(path))</span><br><span class="line">                &#123;</span><br><span class="line">                    EditorUtility.SetDirty(save_go);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    PrefabUtility.SaveAsPrefabAssetAndConnect(save_go, path, InteractionMode.UserAction);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1>UnityEditorä¸‹çš„åŠ è½½å¼¹çª—æˆ–è€…å¼¹çª—</h1><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ShowProgress</span>(<span class="params"><span class="built_in">float</span> progress, <span class="built_in">int</span> total, <span class="built_in">int</span> current</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    EditorUtility.DisplayProgressBar(<span class="string">&quot;Searching&quot;</span>,</span><br><span class="line">        <span class="built_in">string</span>.Format(<span class="string">&quot;Checking (&#123;0&#125;/&#123;1&#125;), please wait...&quot;</span>, current, total), progress);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EditorUtility.DisplayDialog( <span class="string">&quot;&quot;</span>, <span class="string">&quot;Board64ä¸­ä¸å­˜åœ¨å¯¹Board100çš„ä¾èµ–&quot;</span>, <span class="string">&quot;OK&quot;</span> );</span><br></pre></td></tr></table></figure><h1>èµ„æºå¯¼å…¥ç®¡çº¿å¤„ç†</h1><h1>Unity å†…å»ºå›¾æ ‡åˆ—è¡¨</h1><p>é€šè¿‡<code>EditorGUIUtility.FindTexture</code>æ¥å£å¯ä»¥æ‹¿åˆ°UnityEditorä¸­å†…ç½®çš„å›¾æ ‡</p><p><a href="https://www.cnblogs.com/CloudLiu/p/9957335.html">https://www.cnblogs.com/CloudLiu/p/9957335.html</a></p><h1>åœ¨Sceneçª—å£ä¸­æ·»åŠ æŒ‰é’®</h1><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEditor;</span><br><span class="line"></span><br><span class="line">[<span class="meta">CustomEditor(typeof(Particle2DUGUI))</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Particle2DUGUIEditor</span> : <span class="title">Editor</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnInspectorGUI</span>()</span>&#123;</span><br><span class="line">Particle2DUGUI particle2D = target <span class="keyword">as</span> Particle2DUGUI;</span><br><span class="line">EditorGUILayout.Space();</span><br><span class="line"></span><br><span class="line">Color c = GUI.backgroundColor;</span><br><span class="line"><span class="keyword">if</span>(particle2D.material==<span class="literal">null</span>)&#123;</span><br><span class="line">GUI.backgroundColor =  Color.red;</span><br><span class="line">EditorGUILayout.TextArea(<span class="string">&quot;Error: Material is NULL&quot;</span>);</span><br><span class="line">GUI.backgroundColor =  c;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(particle2D.mainTexture==<span class="literal">null</span>)&#123;</span><br><span class="line">GUI.backgroundColor =  Color.red;</span><br><span class="line">EditorGUILayout.TextArea(<span class="string">&quot;Error: Texture is NULL&quot;</span>);</span><br><span class="line">GUI.backgroundColor =  c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">serializedObject.Update();</span><br><span class="line">EditorGUILayout.PropertyField(serializedObject.FindProperty(<span class="string">&quot;m_Material&quot;</span>), <span class="literal">true</span>);</span><br><span class="line">EditorGUILayout.PropertyField(serializedObject.FindProperty(<span class="string">&quot;m_Color&quot;</span>), <span class="literal">true</span>);</span><br><span class="line">EditorGUILayout.PropertyField(serializedObject.FindProperty(<span class="string">&quot;speedScale&quot;</span>), <span class="literal">true</span>);</span><br><span class="line">EditorGUILayout.PropertyField(serializedObject.FindProperty(<span class="string">&quot;playOnAwake&quot;</span>), <span class="literal">true</span>);</span><br><span class="line"><span class="keyword">if</span>(particle2D.playOnAwake)&#123;</span><br><span class="line">EditorGUILayout.PropertyField(serializedObject.FindProperty(<span class="string">&quot;delayPlay&quot;</span>), <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!particle2D.configValues.isLooop)&#123;</span><br><span class="line">EditorGUILayout.PropertyField(serializedObject.FindProperty(<span class="string">&quot;autoRemove&quot;</span>), <span class="literal">true</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">EditorGUILayout.PropertyField(serializedObject.FindProperty(<span class="string">&quot;prewarm&quot;</span>), <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line">EditorGUILayout.PropertyField(serializedObject.FindProperty(<span class="string">&quot;simulationSpace&quot;</span>), <span class="literal">true</span>);</span><br><span class="line">EditorGUILayout.PropertyField(serializedObject.FindProperty(<span class="string">&quot;rectTransAutosize&quot;</span>), <span class="literal">true</span>);</span><br><span class="line">EditorGUILayout.Space();</span><br><span class="line">EditorGUILayout.PropertyField(serializedObject.FindProperty(<span class="string">&quot;effectConfig&quot;</span>), <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">c = GUI.backgroundColor;</span><br><span class="line">GUI.backgroundColor =  Color.yellow;</span><br><span class="line">EditorGUILayout.TextArea(<span class="string">&quot;Support: Pex Or Plist config File.&quot;</span>);</span><br><span class="line"></span><br><span class="line">GUI.backgroundColor =  Color.green;</span><br><span class="line"><span class="keyword">if</span>(particle2D.effectConfig!=<span class="literal">null</span>)&#123;</span><br><span class="line">EditorGUILayout.BeginHorizontal();</span><br><span class="line"><span class="keyword">if</span>(GUILayout.Button(<span class="string">&quot;Load From Config&quot;</span>,GUILayout.Height(<span class="number">24</span>)))&#123;</span><br><span class="line">particle2D.ReadConfig();</span><br><span class="line">particle2D.ResetParticle();</span><br><span class="line">&#125;</span><br><span class="line">EditorGUILayout.EndHorizontal();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">GUI.enabled = <span class="literal">false</span>;</span><br><span class="line">GUILayout.Button(<span class="string">&quot;Load From Config&quot;</span>,GUILayout.Height(<span class="number">24</span>));</span><br><span class="line">GUI.enabled = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">GUI.backgroundColor = c;</span><br><span class="line"></span><br><span class="line">EditorGUILayout.PropertyField(serializedObject.FindProperty(<span class="string">&quot;configValues&quot;</span>),<span class="literal">true</span>);</span><br><span class="line">serializedObject.ApplyModifiedProperties();</span><br><span class="line"></span><br><span class="line">c = GUI.backgroundColor;</span><br><span class="line">GUI.backgroundColor =  Color.green;</span><br><span class="line">EditorGUILayout.BeginHorizontal();</span><br><span class="line"><span class="keyword">if</span>(GUILayout.Button(<span class="string">&quot;Refresh&quot;</span>,GUILayout.Height(<span class="number">32</span>)))&#123;</span><br><span class="line">particle2D.ResetParticle();</span><br><span class="line">&#125;</span><br><span class="line">EditorGUILayout.EndHorizontal();</span><br><span class="line">GUI.backgroundColor = c;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!Application.isPlaying &amp;&amp; Selection.activeObject==particle2D.gameObject)&#123;</span><br><span class="line"><span class="keyword">if</span>(particle2D.configValues!=<span class="literal">null</span> &amp;&amp; particle2D.Emitter!=<span class="literal">null</span> &amp;&amp; particle2D.configValues.maxParticles!=particle2D.Emitter.capacity)&#123;</span><br><span class="line">particle2D.ResetParticle();</span><br><span class="line">&#125;</span><br><span class="line">EditorUtility.SetDirty (particle2D);</span><br><span class="line">HandleUtility.Repaint();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnSceneGUI</span>()</span>&#123;</span><br><span class="line">Particle2DUGUI particle2D = target <span class="keyword">as</span> Particle2DUGUI;</span><br><span class="line"></span><br><span class="line">Handles.BeginGUI();</span><br><span class="line">GUI.backgroundColor =  Color.green;</span><br><span class="line">GUILayout.BeginArea(<span class="keyword">new</span> Rect(<span class="number">5</span>,<span class="number">5</span>,<span class="number">60</span>,<span class="number">130</span>));</span><br><span class="line"><span class="keyword">if</span> (GUILayout.Button(<span class="string">&quot;Play&quot;</span>,GUILayout.Width(<span class="number">60</span>),GUILayout.Height(<span class="number">30</span>)))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(particle2D.Emitter!=<span class="literal">null</span>) &#123;</span><br><span class="line">particle2D.Emitter.Play();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">particle2D.ResetParticle();</span><br><span class="line">&#125;</span><br><span class="line">particle2D.OnRebuildRequested();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (GUILayout.Button(<span class="string">&quot;Stop&quot;</span>,GUILayout.Width(<span class="number">60</span>),GUILayout.Height(<span class="number">30</span>)))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(particle2D.Emitter!=<span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(particle2D.Emitter!=<span class="literal">null</span>) &#123;</span><br><span class="line">particle2D.Emitter.Stop(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (GUILayout.Button(<span class="string">&quot;Clear&quot;</span>,GUILayout.Width(<span class="number">60</span>),GUILayout.Height(<span class="number">30</span>)))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(particle2D.Emitter!=<span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(particle2D.Emitter!=<span class="literal">null</span>) &#123;</span><br><span class="line">particle2D.Emitter.Stop(<span class="literal">true</span>);</span><br><span class="line">particle2D.OnRebuildRequested();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">GUILayout.EndArea();</span><br><span class="line">Handles.EndGUI();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnEnable</span>()</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!Application.isPlaying)&#123;</span><br><span class="line">Particle2DUGUI particle2D = target <span class="keyword">as</span> Particle2DUGUI;</span><br><span class="line"><span class="keyword">if</span>(particle2D!=<span class="literal">null</span> &amp;&amp; Selection.activeGameObject == particle2D.gameObject &amp;&amp; particle2D.playOnAwake) &#123;</span><br><span class="line"><span class="keyword">if</span>(particle2D.Emitter!=<span class="literal">null</span>) &#123;</span><br><span class="line">particle2D.Emitter.Play();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(particle2D.configValues==<span class="literal">null</span>) particle2D.configValues = <span class="keyword">new</span> Particle2DConfig();</span><br><span class="line"><span class="keyword">if</span>(particle2D.configValues!=<span class="literal">null</span> &amp;&amp; particle2D.configValues.texture==<span class="literal">null</span>)&#123;</span><br><span class="line"><span class="comment">//show default texture</span></span><br><span class="line">Object[] unityAssets = AssetDatabase.LoadAllAssetsAtPath(<span class="string">&quot;Resources/unity_builtin_extra&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(Object obj <span class="keyword">in</span> unityAssets)&#123;</span><br><span class="line"><span class="keyword">if</span>(obj.name.Equals(<span class="string">&quot;Default-Particle&quot;</span>))&#123;</span><br><span class="line">particle2D.configValues.texture = obj <span class="keyword">as</span> Texture;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">particle2D.ResetParticle();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnDisable</span>()</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!Application.isPlaying)&#123;</span><br><span class="line">Particle2DUGUI particle2D = target <span class="keyword">as</span> Particle2DUGUI;</span><br><span class="line"><span class="keyword">if</span>(particle2D!=<span class="literal">null</span> &amp;&amp; Selection.activeGameObject != particle2D.gameObject &amp;&amp; particle2D.Emitter!=<span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(particle2D.Emitter!=<span class="literal">null</span>) &#123;</span><br><span class="line">particle2D.Emitter.Stop(<span class="literal">true</span>);</span><br><span class="line">particle2D.OnRebuildRequested();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[<span class="meta">MenuItem(<span class="string">&quot;Particle2D/Particle2D UGUI&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">CreateParticle2DSystem</span>()</span>&#123;</span><br><span class="line">GameObject go = <span class="keyword">new</span> GameObject(<span class="string">&quot;Particle2D UGUI&quot;</span>);</span><br><span class="line">Particle2DUGUI ugui = go.AddComponent&lt;Particle2DUGUI&gt;();</span><br><span class="line">GameObject canvas = GameObject.Find(<span class="string">&quot;Canvas&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(canvas)&#123;</span><br><span class="line">go.transform.SetParent(canvas.transform);</span><br><span class="line">go.transform.localScale = Vector3.one;</span><br><span class="line">go.transform.localPosition = Vector3.zero;</span><br><span class="line">&#125;</span><br><span class="line">MonoScript ms = MonoScript.FromMonoBehaviour(ugui);</span><br><span class="line"><span class="built_in">string</span> filePath = AssetDatabase.GetAssetPath( ms );</span><br><span class="line">filePath = filePath.Substring(<span class="number">0</span>,filePath.LastIndexOf(<span class="string">&quot;Scripts/Particle2DUGUI.cs&quot;</span>));</span><br><span class="line">filePath += <span class="string">&quot;Materials/UGUI_Additive.mat&quot;</span>;</span><br><span class="line">Material mat = AssetDatabase.LoadAssetAtPath&lt;Material&gt;(filePath);</span><br><span class="line">ugui.material = mat;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>åœ¨PlayæŒ‰é’®æ—è¾¹æ·»åŠ æŒ‰é’®</h1><p>TEngine</p><h1>å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://blog.csdn.net/yx314636922/article/details/126872839">https://blog.csdn.net/yx314636922/article/details/126872839</a></li><li><a href="https://blog.csdn.net/angry_youth/article/details/117469722">https://blog.csdn.net/angry_youth/article/details/117469722</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> UnityEditorå¼€å‘ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ä¹Œåˆä¹‹ä¼—</title>
      <link href="/posts/2ecb1e55/"/>
      <url>/posts/2ecb1e55/</url>
      
        <content type="html"><![CDATA[<h1>åº</h1><p>æˆ‘å‘ç°ï¼Œç¤¾ä¼šç»„ç»‡å°±åƒäººä½“ç»“æ„ä¸€æ ·å¤æ‚ï¼Œæˆ‘ä»¬å®Œå…¨æ— æ³•è®©å®ƒä»¬çªç„¶ç»å—æ·±åˆ»çš„å˜åŒ–ã€‚å¤§è‡ªç„¶æœ‰æ—¶æ˜¯éå¸¸æç«¯çš„ï¼Œä½†å†³ä¸åƒæˆ‘ä»¬æ‰€ç†è§£çš„é‚£æ ·ã€‚æ‰€ä»¥ï¼Œå¯¹ä¸€ä¸ªæ°‘æ—æ¥è¯´ï¼Œè¿·æ‹å¤§å˜é©æ˜¯æœ€å¯æ€•çš„äº‹æƒ…ä¹‹ä¸€ã€‚ä¸ç®¡è¿™ç§å˜é©åœ¨ç†è®ºä¸Šæ˜¾å¾—å¦‚ä½•ä¼Ÿå¤§ï¼Œåªæœ‰å½“å®ƒèƒ½ç«‹å³æ”¹å˜æ°‘æ—çš„æ·±å±‚å¿ƒç†æ—¶ï¼Œå®ƒæ‰æ˜¯æœ‰ç”¨çš„ã€‚ç„¶è€Œï¼Œåªæœ‰æ—¶é—´æ‹¥æœ‰è¿™ç§åŠ›é‡ã€‚æ”¯é…äººç±»çš„ï¼Œæ˜¯æ€æƒ³ã€æ„Ÿæƒ…å’Œä¹ ä¿—ï¼Œæ˜¯å­˜åœ¨äºæˆ‘ä»¬è‡ªèº«çš„ä¸œè¥¿ã€‚åˆ¶åº¦å’Œæ³•å¾‹æ˜¯äººä»¬å†…å¿ƒç²¾ç¥çš„è¡¨ç°å½¢å¼ï¼Œåæ˜ äº†å®ƒçš„éœ€è¦ï¼Œæ—¢ç„¶æ˜¯äººä»¬çš„å†…å¿ƒç²¾ç¥è¯ç”Ÿäº†åˆ¶åº¦å’Œæ³•å¾‹ï¼Œåˆ¶åº¦å’Œæ³•å¾‹è‡ªç„¶å°±æ— æ³•æ”¹å˜å®ƒã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ETä¸­çš„ç½‘ç»œé€šä¿¡æ¨¡å—</title>
      <link href="/posts/3613bb98/"/>
      <url>/posts/3613bb98/</url>
      
        <content type="html"><![CDATA[<p>ETæ¡†æ¶ä¸­çš„åè®®å¯ä»¥åˆ†æˆä¸‰ç§ç±»å‹:</p><ul><li>å®¢æˆ·ç«¯å†…éƒ¨çš„é€šè®¯åè®®</li><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šè®¯åè®®</li><li>æœåŠ¡å™¨å†…éƒ¨çš„é€šè®¯åè®®</li></ul><p>ETä¸­è´Ÿè´£æ¨¡å—é—´é€šä¿¡çš„ç»„ä»¶æœ‰å“ªäº›?</p><p>ClientSenderComponent</p><p>ProcessInnerSender<br>ProcessOuterSender<br>Session</p><p>MessageSender</p><p>MessageLocationSenderComponent<br>MessageLocationSenderOneType<br>MessageLocationSender</p><p>çœ‹èµ·æ¥æœ‰å¾ˆå¤šSender, å¯ä»¥å½’æ ¹ç»“åº•åªæœ‰ProcessInnerSenderå’ŒMessageQueueSingletonè¿™å‡ ä¸ªSender</p><p>Realm Session<br>Router Session<br>Gate Session</p><p>é€šè¿‡RootèŠ‚ç‚¹ä¸Šçš„RouterAddressComponentç»„ä»¶å¯ä»¥è·å¾—æœåŠ¡å™¨çš„åœ°å€, å¹¶å°†è¿™ä¸ªåœ°å€ç»™åˆ°Session</p><p><a href="https://blog.csdn.net/u011041241/article/details/109574509">å†…ç½‘å’Œå¤–ç½‘ä¹‹é—´çš„é€šä¿¡ï¼ˆç«¯å£æ˜ å°„åŸç†ï¼‰</a><br><a href="https://luyuhuang.tech/2020/12/09/kcp.html">KCPåè®®è¯¦è§£</a><br><a href="https://blog.csdn.net/Q540670228/article/details/123385080?spm=1001.2014.3001.5502">Unity+ET6.0ç½‘ç»œæ¡†æ¶çš„ç½‘ç»œå¼€å‘åŸºç¡€ç†è®º</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ETæ¡†æ¶è‡ªåŠ¨ç”Ÿæˆè„šæœ¬</title>
      <link href="/posts/ef16867e/"/>
      <url>/posts/ef16867e/</url>
      
        <content type="html"><![CDATA[<p>ETæ¡†æ¶ä»“åº“ä¸‹å…¶å®æ˜¯æœ‰ä¸¤ä¸ªå·¥ç¨‹çš„ï¼Œè™½ç„¶è¿™ä¸¤ä¸ªå·¥ç¨‹é‡Œé¢çš„è„šæœ¬æœ‰å¯èƒ½æ˜¯ç”¨çš„åŒä¸€ä»½</p><p>åœ¨Shareè¿™ä¸ªæ¨¡å—ä¸­<code>ETSystemGenerator.cs</code>è¿™ä¸ªè„šæœ¬é‡Œé¢ï¼</p><blockquote><p>é—®é¢˜ è¿™äº›ä»£ç è‡ªåŠ¨ç”Ÿæˆçš„æ—¶æœºæ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿ</p></blockquote><p>ç¼–è¯‘çš„æ—¶å€™è‡ªåŠ¨ç”Ÿæˆï¼Œæ— éœ€å¼€å‘è€…æ‰‹åŠ¨ç®¡ç†ETSystemGeneratorè¿™ä¸ªç±»å®ç°äº†ISourceGeneratoræ¥å£ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨Unityä¸­è‡ªåŠ¨ç”Ÿæˆè„šæœ¬çš„åŠŸèƒ½æ˜¯æ˜¯é€šè¿‡dllæ’ä»¶çš„æ–¹å¼æ¥å…¥è¿›æ¥çš„ï¼Œè¿˜å¾—çœ‹ä¸€ä¸‹æ€ä¹ˆå¯¼å‡ºdllï¼Œå¦‚æœå¯¹SourceGeneratorçš„æºç æœ‰ä¿®æ”¹ï¼Œéœ€è¦é‡æ–°å¯¼å…¥dllåˆ°Unityä¸­</p><h1>GeneratorExecutionContext</h1>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ETæ¡†æ¶ç´¢å¼•</title>
      <link href="/posts/ff09e316/"/>
      <url>/posts/ff09e316/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ğŸ’¡TIPS:æœ¬ç³»åˆ—åŸºäºET8.1ç‰ˆæœ¬</p></blockquote><p>æœ¬ç³»åˆ—å†…å®¹ä¼šååˆ†ç¹æ‚, å› ä¸ºä¸åªæ˜¯è®¨è®ºETçš„æ¶æ„è®¾è®¡, è¿˜æœ‰æ”¯æŒæ¡†æ¶å®ç°èƒŒåçš„æŠ€æœ¯: C#ä¸­çš„ç‰¹æ€§ã€åå°„ã€å¼‚æ­¥ã€ä»£ç æ£€æŸ¥ã€æºä»£ç ç”Ÿæˆã€å¸§åŒæ­¥çŠ¶æ€åŒæ­¥ã€ç½‘ç»œé€šä¿¡ã€KCPã€AOIç­‰å¤šä¸ªæ–¹é¢, ä¹Ÿåªæœ‰å…·å¤‡äº†è¿™äº›çŸ¥è¯†å‚¨å¤‡, æ‰èƒ½å¤Ÿæ›´å¥½çš„ç†è§£ETæ¡†æ¶.</p><ul><li><a href="https://soincredible.github.io/posts/a8cdc42b/">ETä¸­çš„å¼‚æ­¥</a></li><li><a href="https://soincredible.github.io/posts/50d23509/">å¸§åŒæ­¥ä¸çŠ¶æ€åŒæ­¥</a></li><li><a href="https://soincredible.github.io/posts/3613bb98/">ETä¸­çš„ç½‘ç»œé€šä¿¡æ¨¡å—</a></li><li><a href="https://soincredible.github.io/posts/12f854cb/">ETä¸­çš„Singleton</a></li><li><a href="https://soincredible.github.io/posts/cd96d12/">ETä¸­åå°„ä¸ç‰¹æ€§çš„ä½¿ç”¨</a></li><li><a href="https://soincredible.github.io/posts/ef16867e/">ETæ¡†æ¶è‡ªåŠ¨ç”Ÿæˆè„šæœ¬</a></li><li><a href="https://soincredible.github.io/posts/9c5dbe31/">ETæ¡†æ¶Demoå¯åŠ¨æµç¨‹æ¢³ç†</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ETæ¡†æ¶ä¸­çš„Singleton</title>
      <link href="/posts/12f854cb/"/>
      <url>/posts/12f854cb/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡ç¬”è€…ä¼šæŒ‰ç…§ETä¸­æ‰€æœ‰Singletonåˆ›å»ºçš„é¡ºåˆ©ï¼Œå°è¯•æ¢³ç†ä¸€ä¸‹è®¾è®¡åˆ°çš„æ¨¡å—ã€‚</p><h1>Singletonçš„åˆ›å»º</h1><blockquote><p>ç–‘é—® å·²ç»æœ‰ä¸€ä¸ªASingletonäº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰ä¸€ä¸ªASingletonAwakeï¼Ÿ<br>æ‰€æœ‰çš„Singletonéƒ½ä¼šç»§æ‰¿ASingletonåŸºç±»ã€‚ä½†æ˜¯ä¸åŒçš„Singletonè¿˜ä¼šç»§æ‰¿ä¸åŒçš„ISingletonAwakeã€‚ ä¸€æ˜¯ä½¿ç”¨æ³›å‹ï¼ŒäºŒæ˜¯å£°æ˜å‡ ä¸ªå‚æ•°æ•°é‡ä¸åŒçš„ISingletonAwakeæ¥å£ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©å…·ä½“çš„Singletonç»§æ‰¿å“ªä¸ªæ¥å£ï¼Œä½†æ˜¯æ‰€æœ‰çš„Singletonåˆéƒ½ä¼šç»§æ‰¿ASingletonè¢«Wordä¸­çš„singletonsç®¡ç†èµ·æ¥ï¼Œç›¸å½“äºæŠŠSingletonçš„åˆå§‹åŒ–å’Œç®¡ç†çš„èŒèƒ½æ‹†åˆ†äº¤ç»™äº†ä¸¤ä¸ªè§’è‰²å»å¤„ç†ï¼Œè¿˜æ˜¯æ¯”è¾ƒå·§å¦™çš„ã€‚</p></blockquote><blockquote><p>ç–‘é—® ä¸ºä»€ä¹ˆæœ‰çš„Singletonä¼šè¢«æ‰“ä¸ŠCodeç‰¹æ€§ï¼Œæœ‰çš„ä¸ä¼šï¼Ÿ</p></blockquote><p>è™½ç„¶å¤§å®¶éƒ½æ˜¯Singletonï¼Œä½†æ˜¯å„ä¸ªSingletonä¹‹é—´çš„ä¼˜å…ˆçº§ä¸ä¸€å®šä¸€æ ·ï¼Œå•ä¾‹ä¹‹é—´ä¼šå­˜åœ¨ä¾èµ–ã€‚æ¯”å¦‚CodeLoaderã€CodeTypesè¿™ä¸¤ä¸ªå•ä¾‹ï¼Œå®ƒä»¬ä¸¤ä¸ªéœ€è¦åœ¨å…¶ä»–å•ä¾‹ä¹‹å‰å…ˆè¢«Awakeï¼Œç„¶ååœ¨CodeTypeå•ä¾‹å†…éƒ¨ï¼Œå†å»åˆ›å»ºå‡ºå…¶ä»–å•ä¾‹å‡ºæ¥ã€‚å› æ­¤ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå•ä¾‹æ²¡æœ‰è¢«æ ‡è®°ä¸ºCodeç‰¹æ€§ï¼Œé‚£ä¹ˆè¯´æ˜è¿™ä¸ªå•ä¾‹æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§æ¯”è¾ƒé«˜çš„å•ä¾‹ï¼Œå®ƒåº”è¯¥åœ¨æŸä¸€æ¯”è¾ƒæ—©çš„æ—¶åˆ»è¢«æˆ‘ä»¬å¼€å‘è€…æ‰‹åŠ¨è°ƒç”¨å¹¶åˆ›å»ºå‡ºæ¥ã€‚ä¹Ÿå°±æ˜¯ETæ¡†æ¶é€šè¿‡ç»™ä¸ç»™å•ä¾‹æ ‡è®°CodeAttributeçš„æ–¹å¼æ¥å¯¹å•ä¾‹çš„åˆ›å»ºè¿›è¡Œæ‰‹åŠ¨æˆ–è€…è‡ªåŠ¨çš„ç®¡ç†ã€‚</p><h1>World</h1><p>æ¥ç€æˆ‘ä»¬æ¥è¯´ä¸€ä¸‹Worldä¸­çš„AddSingletonæ¥å£ï¼Œè¿™ä¸ªæ¥å£ä¸ä»…ä»…æ˜¯è¢«Worldå†…éƒ¨çš„å‡ ä¸ªæ³›å‹AddSingletonæ¥å£è°ƒç”¨ï¼Œè¿˜è¢«ä¸‹é¢å‡ ä¸ªåœ°æ–¹è°ƒç”¨äº†ï¼š</p><ul><li>CodeTypes</li><li>ConfigLoader</li><li>EditorLogHelper</li></ul><h1>CodeTypes</h1><h1>ConfigLoader</h1><h1>EditorLogHelper</h1><h1>AddSingletonçš„é¡ºåº</h1><ul><li>Logger</li><li>TimeInfo</li><li>FiberManager</li><li>ResourcesComponent</li><li>CodeLoader</li><li>æ¥ç€è°ƒç”¨CodeLoaderçš„Startæ–¹æ³•åˆ›å»ºCodeTypeså•ä¾‹</li><li>æ¥ç€é€šè¿‡åå°„çš„æ–¹å¼è°ƒç”¨Entryä¸­çš„Startæ–¹æ³•åˆ›å»ºä¸‹é¢å•ä¾‹ï¼š<ul><li>IdGenerater</li><li>OpcodeType</li><li>ObjectPool</li><li>MessageQueue</li><li>NetServices</li><li>NavmeshComponent</li><li>LogMsg</li><li>ç„¶åè°ƒç”¨CodeTypeså•ä¾‹çš„CreateCodeæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ‹¿åˆ°æ‰€æœ‰è¢«æ ‡è®°äº†CodeAttributeçš„ç±»ï¼Œè‡ªåŠ¨çš„åˆ›å»ºè¿™äº›ç±»çš„å•ä¾‹ï¼š<ul><li>EntitySystemSingleton</li><li>MessageDispatcher</li><li>EventSystem</li><li>HttpDispatcher</li><li>LSEntitySystemSingleton</li><li>AIDispatcherComponent</li><li>ConsoleDispatcher</li><li>MessageSessionDispatcher</li><li>NumericWatcherComponent</li><li>UIEventComponent</li></ul></li><li>ConfigLoader</li></ul></li></ul><h1>CodeTypes</h1><h1>EventSystem</h1><p>EventSystemæ˜¯æ‰€æœ‰ä¸šåŠ¡èƒ½å¤Ÿè·‘èµ·æ¥çš„åŸºç¡€</p><p>é€šè¿‡ç»§æ‰¿InvokeHandler, åœ¨Handleæ–¹æ³•é‡Œä¼šæ“ä½œå…¶ä»–å•ä¾‹æˆ–è€…componenté‡Œé¢é¢çš„æ¥å£</p><ul><li>MessageSessionHandler MessageSessionDispatcher</li><li>MessageLocationHandler MessageDispatcherSingleton</li><li></li></ul><p>EventSystemä¸­ç»´æŠ¤äº†ä¸¤ä¸ªå­—æ®µ<code>allEvents</code>å’Œ<code>allInvokers</code><br>EventSystemåœ¨Invokeçš„æ—¶å€™ä¼šåˆå§‹åŒ–è¿™ä¸¤ä¸ªå­—æ®µçš„å†…å®¹<br>allEventså­—æ®µä¸­ è®°ä¸ºEventç‰¹æ€§çš„æ‰€æœ‰ç±»å‹ï¼Œåˆ›å»ºè¿™äº›ç±»å‹çš„å®ä¾‹ï¼Œè¢«æ ‡è®°äº†Eventç‰¹æ€§çš„ç±»å¿…é¡»è¦ç»§æ‰¿IEventæ¥å£ã€‚</p><p><a href="https://learn.microsoft.com/en-us/dotnet/api/system.reflection.memberinfo.getcustomattributes?view=net-9.0"><code>MemberInfo.GetCustomAttributes(Type, bool);</code></a>ã€‚</p><p>çœ‹ä¸€ä¸‹AEventä¸­æä¾›äº†ä¸€ä¸ªRunæ¥å£ï¼Œ</p><p>InvokeHandlerå’ŒMessageHandlerçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</p><p>Eventå’ŒInvokerçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</p><h1>MessageHandler æ„Ÿè§‰æ˜¯å¦å¤–ä¸€å¥—é€»è¾‘</h1><h1>EntitySystemSingleton</h1><h2 id="EntitySystem">EntitySystem</h2><p>EntitySystemSingletoné‡Œé¢ç»´æŠ¤äº†ä¸€ä¸ªTypeSystemså­—æ®µ</p><p>AwakeSystemå’ŒComponentçš„IAwakeæ¥å£ä¹‹é—´çš„å…³ç³».</p><h1></h1><p>ProcessInnerSenderã€MailBoxComponentã€MessageDispatcherSingletonã€MessageHandler</p><h1></h1><p>EntitySystemSingletonã€IUpdateSystem</p><h1></h1><p>EventSystemSingletonã€AEventã€AInvokeHandler</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>äº†ä¸èµ·çš„ç›–èŒ¨æ¯”</title>
      <link href="/posts/3941b47a/"/>
      <url>/posts/3941b47a/</url>
      
        <content type="html"><![CDATA[<p>â€œæˆ‘ä»¬è¦æ˜ç™½ï¼Œè®²äº¤æƒ…è¦åœ¨äººæ´»ç€çš„æ—¶å€™è®²ï¼Œäººæ­»å°±æ²¡æœ‰äº¤æƒ…äº†ï¼Œâ€ä»–æ„å‘³æ·±é•¿åœ°è¯´ï¼Œâ€œæˆ‘è‡ªå·±çš„åŸåˆ™æ˜¯ï¼Œäººæ­»æˆ‘å°±ä»€ä¹ˆéƒ½ä¸ç®¡äº†ã€‚â€</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å¸§åŒæ­¥ä¸çŠ¶æ€åŒæ­¥</title>
      <link href="/posts/50d23509/"/>
      <url>/posts/50d23509/</url>
      
        <content type="html"><![CDATA[<h1>ECSæ¶æ„</h1><p>ECSæ¶æ„çœ‹èµ·æ¥å°±æ˜¯è¿™æ ·å­çš„ã€‚å…ˆæœ‰ä¸ªWorldï¼Œå®ƒæ˜¯ç³»ç»Ÿï¼ˆè¯‘æ³¨ï¼Œè¿™é‡Œçš„ç³»ç»ŸæŒ‡çš„æ˜¯ECSä¸­çš„Sï¼Œä¸æ˜¯ä¸€èˆ¬æ„ä¹‰ä¸Šçš„ç³»ç»Ÿï¼Œä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œä¸‹æ–‡ç»Ÿç§°Systemï¼‰å’Œå®ä½“(Entity)çš„é›†åˆã€‚è€Œå®ä½“å°±æ˜¯ä¸€ä¸ªIDï¼Œè¿™ä¸ªIDå¯¹åº”äº†ç»„ä»¶(Component)çš„é›†åˆã€‚ç»„ä»¶ç”¨æ¥å­˜å‚¨æ¸¸æˆçŠ¶æ€å¹¶ä¸”æ²¡æœ‰ä»»ä½•çš„è¡Œä¸º(Behavior)ã€‚Systemæœ‰è¡Œä¸ºä½†æ˜¯æ²¡æœ‰çŠ¶æ€ã€‚</p><p>æ•°æ®å’Œé€»è¾‘åˆ†ç¦», Componentä¸­åªæœ‰æ•°æ®, Systemä¸­åªæœ‰é€»è¾‘, é¦–å…ˆæœ‰ä¸€ä¸ªWorld, ç®¡ç†ç€æ‰€æœ‰çš„Entityæ˜¯Componentçš„å®¹å™¨. è¿˜æœ‰ä¸€ä¸ªEntityAdminæ¥ç®¡ç†æ‰€æœ‰çš„Entity</p><p>æ¸¸æˆä¸­ä¸åŒçš„è§’è‰²,çœ‹å¾…åŒä¸€ä¸ªEntityä¸‹åŒä¸€ä¸ªComponentæ—¶çš„è§†è§’æ˜¯ä¸ä¸€æ ·çš„,è§’è‰²å¸Œæœ›è¿™ä¸ªComponentèƒ½åšä»€ä¹ˆ,é‚£ä¹ˆè¿™ä¸ªComponentå°±çœŸçš„å¯ä»¥åšä»€ä¹ˆ, Componentè‡ªå·±èƒ½åšä»€ä¹ˆä¸æ˜¯å®ƒè‡ªå·±å†³å®šçš„, è€Œæ˜¯ç”±å…¶è§‚å¯Ÿè€…å†³å®šçš„. ä½†æ˜¯è¿™äº›è§‚å¯Ÿè€…åº”å½“åªæ˜¯ä»Componentä¸­è¯»çŠ¶æ€, è€Œä¸ä¼šä¿®æ”¹Componentä¸­çš„çŠ¶æ€, Componentä¸­çš„çŠ¶æ€éœ€è¦æœ‰ä¸“é—¨å¯¹åº”çš„Systemè¿›è¡Œä¿®æ”¹.** ç»“æœçœ‹æ¥ï¼Œæ ¹æ®ä¸»ä½“è§†è§’åŒºåˆ†æ‰€æœ‰Behaviorï¼Œè¿™æ ·æ¥æè¿°ä¸€æ£µæ ‘çš„å…¨éƒ¨è¡Œä¸ºä¼šæ›´å®¹æ˜“ï¼Œè¿™ä¸ªé“ç†åŒæ ·ä¹Ÿé€‚ç”¨äºæ¸¸æˆå¯¹è±¡(game objects)ã€‚**</p><h1>åŒæ­¥ç›¸å…³</h1><p>æœåŠ¡å™¨ä¸Šä¼šæ„å»ºä¸€ä¸ªçº¯æ•°æ®å‘çš„World,æ‰€æœ‰Playerçš„æ“ä½œéƒ½ä¼šä¸ŠæŠ¥ç»™æœåŠ¡å™¨,ä¸è¿‡ç”±äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„é€šä¿¡å­˜åœ¨å»¶è¿Ÿ,å› æ­¤å®¢æˆ·ç«¯ä¼šç°åœ¨æœ¬åœ°è¿›è¡Œæ¨¡æ‹Ÿ,åŒæ—¶å°†æ“ä½œä¸ŠæŠ¥ç»™æœåŠ¡å™¨å¹¶ç­‰å¾…ç»“æœè¿”å›,å¦‚æœæœåŠ¡å™¨è¿”å›å›æ¥çš„æ•°æ®å’Œå®¢æˆ·ç«¯æ¨¡æ‹Ÿçš„ç»“æœæ˜¯ä¸€è‡´çš„,é‚£ä¹ˆå°±å¯ä»¥ç»§ç»­ä¸‹å»,å¦åˆ™å®¢æˆ·ç«¯å°±è¦ä¼šå›é€€çŠ¶æ€ ç„¶åå®¢æˆ·ç«¯è¿›è¡Œæ—¶é—´è†¨èƒ€.</p><h1>å¸§åŒæ­¥</h1><p>å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘å‡ºæŒ‡ä»¤åéœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´æ‰èƒ½æ”¶åˆ°æœåŠ¡å™¨é‚£è¾¹çš„ç­”å¤, åœ¨å®¢æˆ·ç«¯ç­‰çš„è¿™æ®µæ—¶é—´é‡Œ, ä¸èƒ½è®©ç©å®¶å¹²ç­‰ç€å•Š,</p><h1>å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://www.bilibili.com/video/BV1RR4y1V7T2?spm_id_from=333.788.videopod.sections&amp;vd_source=83f4165825ce9df46cf4fd576ccb1102">çƒŸé›¨çš„è§†é¢‘æ•™ç¨‹</a></li><li><a href="https://www.youtube.com/watch?v=W3aieHjyNvw&amp;t=2886s">å®ˆæœ›å…ˆé”‹GDCè®²åº§â€”â€”æ¶æ„è®¾è®¡å’Œç½‘ç»œåŒæ­¥</a></li><li><a href="https://www.youtube.com/watch?v=W4oZq4tn57w">å®ˆæœ›å…ˆé”‹GDCå›æ”¾ç³»ç»Ÿã€å…¨åœºæœ€ä½³</a></li><li><a href="https://mp.weixin.qq.com/s/y8-Xb0az43pmjTlBXtNhdA">https://mp.weixin.qq.com/s/y8-Xb0az43pmjTlBXtNhdA</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ETä¸­çš„å¼‚æ­¥</title>
      <link href="/posts/a8cdc42b/"/>
      <url>/posts/a8cdc42b/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢ä¸æ­¢è®¨è®ºETTaskå¦‚ä½•å®ç°, æ›´æƒ³æ¢è®¨C#åº•å±‚æ˜¯å¦‚ä½•æ”¯æŒå¼‚æ­¥å®ç°çš„. å¦‚æœè¯»è€…åƒç¬”è€…ä¸€æ ·, é€šè¿‡Unityæ¥è§¦åˆ°çš„C#è¯­è¨€, å¯èƒ½å¯¹åç¨‹å’Œå¼‚æ­¥æ¦‚å¿µçš„ç†è§£ä¸Šæœ‰åå·®, <strong>å› ä¸ºæˆ‘ä»¬åœ¨Unityä¸­ä½¿ç”¨çš„åç¨‹å¹¶ä¸æ˜¯æ“ä½œç³»ç»Ÿå±‚æ¬¡ä¸‹è®¨è®ºçš„ä¸çº¿ç¨‹ã€è¿›ç¨‹ã€åç¨‹ä¸­çš„åç¨‹æ¦‚å¿µ</strong>, Unityçš„åç¨‹æ˜¯UnityåŸºäºIEnumeratorå’ŒUnityäº‹ä»¶æ›´æ–°æ¡†æ¶å®ç°çš„ä¼ªåç¨‹ã€ä¼ªå¼‚æ­¥, Unityçš„åç¨‹é™åˆ¶éå¸¸å¤š, å¦‚æœè¯»è€…å¯¹Unityçš„åç¨‹ã€IEnumeratorå’Œ<code>yield return</code>è¯­æ³•ç³–æœ‰ç–‘æƒ‘, æ¬¢è¿å‚è€ƒ<a href="https://soincredible.github.io/posts/133a9667/">IEnumeratorä¸IEnumerableè¾¨æ</a>å’Œ<a href="https://soincredible.github.io/posts/83d7c4e7/">å…³äºåç¨‹</a>è¿™ä¸¤ç¯‡åšå®¢, å¸Œæœ›èƒ½å¸®åŠ©ä½ ç†è§£.</p><p>æœ¬ç¯‡åšå®¢é¦–å…ˆä¼šè®¨è®ºC#ä¸­å¼‚æ­¥çš„å®ç°æ€è·¯, ç„¶åä¼šè®¨è®ºETTaskçš„å®ç°æ€è·¯, UniTaskå’ŒYooAssetä¸­çš„å¼‚æ­¥ä¹Ÿåœ¨æœ¬ç³»åˆ—çš„è®¨è®ºä¹‹ä¸­.<br><a href="https://soincredible.github.io/posts/323f6783/">å¯¹Taskçš„æ¦‚è¿°</a></p><p>å¦å¤–, å¦‚æœè¯»è€…å¯¹C#ä¸­çš„å¼‚æ­¥ä¸æ˜¯å¾ˆäº†è§£, æ¨èå…ˆçœ‹ä¸€ä¸‹ä¸‹é¢äº”ç¯‡ç¿»è¯‘çš„æ–‡ç« :<br><a href="https://soincredible.github.io/posts/72dba58e">Dissecting the async methods in C#</a><br><a href="https://soincredible.github.io/posts/40aca622/">Extending the async methods in C#</a><br><a href="">The performance characteristics of the async methods in C#</a><br><a href="">One user scenario to rule them all</a><br><a href="https://soincredible.github.io/posts/7331d0f1">A Deep Dive into C#'s Cancellation</a></p><p>åœ¨ç†è§£äº†ä¸Šé¢åšå®¢ä¸­çš„å†…å®¹å, è¯·æ€è€ƒè¿™å¥è¯: Taskæ˜¯Task, Asyncæ˜¯Async. æœ‰Taskå¹¶ä¸ä¸€å®šæ„å‘³ç€å¼‚æ­¥æ“ä½œ, æœ‰Asyncä¹Ÿå¹¶ä¸æ„å‘³ç€ä¸€å®šæœ‰å¼‚æ­¥æ“ä½œ. ä¹Ÿå°±æ˜¯è¯´, å¹¶ä¸æ˜¯åªæœ‰åœ¨å¼‚æ­¥çš„åœºæ™¯ä¸‹æˆ‘ä»¬æ‰å¯ä»¥ä½¿ç”¨Task, Taskä¾ç„¶å¯ä»¥åœ¨åŒæ­¥åœºæ™¯ä¸‹ä½¿ç”¨, è€Œ<code>async</code>å…³é”®å­—ä¹Ÿä¸èƒ½å®Œå…¨å’Œå¼‚æ­¥ç»‘å®š, å› ä¸º<code>async</code>å…³é”®å­—çš„ä½œç”¨åªæ˜¯å‘Šè¯‰ç¼–è¯‘å™¨å¯¹è¿™ä¸ªæ–¹æ³•åšä¸€äº›ç‰¹æ®Šçš„å¤„ç†: æ¯ä¸€ä¸ªè¢«æ ‡è®°ä¸ºasyncçš„æ–¹æ³•, Compileråœ¨èƒŒåéƒ½ä¼šåœ¨å…¶å†…éƒ¨ç”Ÿæˆä¸€ä¸ªçŠ¶æ€æœº.</p><h1>ä¸ºä»€ä¹ˆETæ¡†æ¶è¦è®¾è®¡è‡ªå·±çš„å¼‚æ­¥è¿”å›ç±»å‹? å’ŒTaskç›¸æ¯”, ETè‡ªå·±è®¾è®¡çš„å¼‚æ­¥è¿”å›ç±»å‹æœ‰å“ªäº›ä¼˜åŠ¿.</h1><blockquote><p>âš ï¸Taskæœ‰å†·çƒ­ä¹‹åˆ†<br>å†·ä»»åŠ¡ï¼ˆCold Taskï¼‰ä¸ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œå¿…é¡»æ˜¾å¼è°ƒç”¨ Start()ã€RunSynchronously() æˆ–é€šè¿‡ä»»åŠ¡è°ƒåº¦å™¨è§¦å‘ã€‚<br>çƒ­ä»»åŠ¡ï¼ˆHot Taskï¼‰æ— éœ€æ‰‹åŠ¨å¯åŠ¨ï¼Œä»»åŠ¡åœ¨è¢«åˆ›å»ºæ—¶å·²ç»å¤„äº Running çŠ¶æ€ã€‚</p></blockquote><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> s = Func2();</span><br><span class="line">    s.Start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">async</span> Task <span class="title">Func2</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">await</span> Task.Delay(<span class="number">42</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç è¿è¡Œä¼šæŠ¥é”™:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">InvalidOperationException: Start may not be called on a promise-style task.</span><br></pre></td></tr></table></figure><p>å› ä¸ºsæ˜¯ä¸€ä¸ªçƒ­ä»»åŠ¡, åœ¨è¿”å›è¯¥ä»»åŠ¡æ—¶å·²ç»éšå¼Startäº†, ä¸å¿…è°ƒç”¨Startæ¥å£. æˆ–è€…å°±æŒ‰ç…§å®ƒçš„æŠ¥é”™ä¿¡æ¯ç†è§£, é€šè¿‡éç›´æ¥è°ƒç”¨Taskæ„é€ æ–¹æ³•æ‹¿åˆ°çš„Taskå®ä¾‹éƒ½æ˜¯<code>promise-style</code>çš„, è¿™ç§Taskéƒ½ä¸èƒ½è°ƒç”¨Start.</p><p>ETä½œè€…çŒ«å¤§è¯´: ETTaskè¯´è‡ªå·±æ˜¯å•çº¿ç¨‹çš„, ä¸æ”¯æŒå¤šçº¿ç¨‹, ä¸åƒTaskè¦æ”¯æŒå¤šçº¿ç¨‹ ETTaskåšäº†ä»€ä¹ˆ?</p><p>è¯·è¯»è€…ä»¬æƒ³ä¸€æƒ³, è‡ªå·±åœ¨ç”¨Taskçš„æ—¶å€™, ä»æ¥æ²¡æœ‰è°ƒç”¨è¿‡<code>TaskAwaiter</code>æˆ–è€…è¯´<code>AsyncTaskMethodBuilder</code>çš„SetResultæ¥å£å§? è¿™æ˜¯å› ä¸ºæœ‰TaskSchedulerçš„å­˜åœ¨, åœ¨èƒŒåæœ‰ä¸€å¥—è‡ªå·±çš„è°ƒåº¦æœºåˆ¶.<br>ä¸€ä¸ªè¿”å›ç±»å‹ä¸ºTaskçš„æ–¹æ³•, è¿”å›çš„æ˜¯ä¸€ä¸ªçƒ­ä»»åŠ¡, è¯¥ä»»åŠ¡åœ¨è¢«åˆ›å»ºå‡ºæ¥çš„é‚£ä¸€åˆ»å°±å·²ç»è¦ç»™åˆ°<code>TaskScheduler</code>è¿›è¡Œç®¡ç†äº†<br>Taskå¯èƒ½ä¸€å±‚ä¸€å±‚åœ°åµŒå¥—ä¸Šæ¥, åœ¨ä¸šåŠ¡ä½¿ç”¨ä¸Š, å¼€å‘è€…æœ€åº•å±‚ä¸€èˆ¬<code>Task.Run()</code>æˆ–è€…<code>Task.Delay</code>è¿™æ ·çš„æ¥å£, ä¸Šå±‚çš„è¿™äº›Task, è¯¥ä»»åŠ¡åœ¨è¢«åˆ›å»ºå‡ºæ¥çš„é‚£ä¸€åˆ»å°±å·²ç»è¦ç»™åˆ°<code>TaskScheduler</code>è¿›è¡Œç®¡ç†äº†, Taskå¦‚ä½•è°ƒåº¦å®Œå…¨ä¸å—æˆ‘ä»¬å¼€å‘è€…çš„æ§åˆ¶, æˆ‘ä»¬æ¥å›æƒ³ä¸€ä¸‹æˆ‘ä»¬æ˜¯åœ¨å“ªä¸€æ­¥å°†æ§åˆ¶æƒè½¬äº¤ç»™TaskSchedulerçš„.</p><p>ç”±äºTaskç”±TaskSchedulerè°ƒåº¦, æˆ‘ä»¬æ— æ³•æ§åˆ¶, æœ‰å¯èƒ½æ¶‰åŠåˆ°å¤šçº¿ç¨‹ã€å‡ºç°ä¸Šä¸‹æ–‡è·¨çº¿ç¨‹ä¼ é€’çš„å¼€é”€, å› æ­¤ETTaskçš„ç›®æ ‡æ˜¯è‡ªä¸»æ§åˆ¶è°ƒåº¦ã€å•çº¿ç¨‹ä½œä¸š, ä½ å¯ä»¥è¿™ä¹ˆç†è§£Taskæ˜¯C#çš„TaskScheduler, æ¥è°ƒç”¨SetResult, æ—¢ç„¶ETTaskå†³å®šä½¿ç”¨è‡ªå·±çš„å¼‚æ­¥æœºåˆ¶, é‚£ä¹ˆå°±éœ€è¦è‡ªå·±å®ç°ä¸€ä¸ªåƒTaskSchedulerä¸€æ ·çš„è°ƒåº¦æœºåˆ¶, åœ¨<code>ProcessInnerSender</code>ç»„ä»¶ä¸­, å°±æœ‰ä¸€å¥—ETTaskçš„è°ƒåº¦æœºåˆ¶, æœ‰ä¸€ä¸ªrequestCallback</p><p>ETæ¡†æ¶ä¸­ä¸€å…±å®ç°äº†ä¸‰ç§ç”¨äºå¼‚æ­¥æ“ä½œçš„è¿”å›ç±»å‹:<code>ETVoid</code>ã€<code>ETTask</code>å’Œ<code>ETTask&lt;T&gt;</code></p><blockquote><p>ğŸ’¡ETTaskæ—¢æ˜¯Awaiteråˆæ˜¯å¯ä»¥è¢«awaitçš„TaskLikeç±»å‹, å¸Œæœ›ä¸è¦å¯¹å„ä½åˆšæ¥è§¦å¼‚æ­¥æˆ–ETçš„è¯»è€…é€ æˆå›°æ‰°</p></blockquote><h1>ä¸ºä»€ä¹ˆETTaské‡Œé¢æœ‰ä¸€ä¸ª<code>Coroutine</code>æ–¹æ³•, å®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆ?</h1><h1>SynchronizationContext</h1><p>SynchronizationContextå’ŒExecutionContextæœ‰ä»€ä¹ˆè”ç³»å—?<br>SynchronizationContextä¸­å­˜å‚¨äº†ä¸€äº›èƒ½å¤Ÿæ ‡è¯†çº¿ç¨‹èº«ä»½çš„ä¿¡æ¯ï¼Œç°åœ¨ä½ æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œä½ å¯ä»¥é€šè¿‡<code>SynchronizationContext.Send()</code>æˆ–è€…<code>SynchronizationContext.Post</code>æ–¹æ³•æŠŠä½ è¦æ‰§è¡Œçš„è¿™ä¸ªæ–¹æ³•ä¸¢ç»™ä½ æƒ³è¦è®©ä»–æ‰§è¡Œçš„çº¿ç¨‹é‡Œé¢å»ï¼Œå¯ä»¥æŠŠä»–ç†è§£ä¸ºæ˜¯ä¸€ç§è·¨çº¿ç¨‹çš„æ–¹æ³•è°ƒç”¨çš„æ–¹å¼ã€‚<br>åœ¨ä¸€èˆ¬å•çº¿ç¨‹é‡Œï¼Œæ–¹æ³•çš„è°ƒç”¨éƒ½æ˜¯ç›´æ¥ç›´å»ï¼Œè€Œåœ¨å¤šçº¿ç¨‹é‡Œé¢ï¼Œå¯ä»¥é€šè¿‡SynchronizationContextæ¥å®ç°çº¿ç¨‹é—´çš„å‡½æ•°è°ƒç”¨ã€‚<br>è¦æ³¨æ„ä¸€ä¸‹Sendå’ŒPostçš„åŒºåˆ«ï¼Œå¦‚æœä½¿ç”¨Sendçš„æ–¹å¼æŠŠä¸€ä¸ªæ–¹æ³•ä¸¢ç»™æŸä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œå¦‚æœè¿™ä¸ªæ–¹æ³•æ°å¥½å¾ˆè€—æ—¶ï¼Œé‚£ä¹ˆå°±ä¼šå¡ä½è°ƒç”¨Sendå¤„ä¹‹åä»£ç çš„æ‰§è¡Œï¼Œè€Œå¦‚æœä½¿ç”¨Postæ–¹æ³•çš„è¯ï¼Œåˆ™ä¸ä¼šé˜»å¡è°ƒç”¨å¤„ä¹‹åä»£ç çš„æ‰§è¡Œã€‚æ ¹æ®éœ€æ±‚é€‰æ‹©ç”¨Sendè¿˜æ˜¯Postã€‚ç¤ºä¾‹å¦‚ä¸‹ğŸ‘‡ğŸ‘‡</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Threading;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Learn</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LearnSynchronizationContext</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// SynchronizationContextçš„ç†è§£å’Œä½¿ç”¨</span></span><br><span class="line">        <span class="keyword">private</span> SynchronizationContext _synchronizationContext;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Thread _thread; <span class="comment">// æ–°å»ºä¸€ä¸ªçº¿ç¨‹ è®©ä¸Šä¸‹æ–‡æŒ‡å‘è¿™ä¸ªçº¿ç¨‹</span></span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// ä¸èƒ½æŠŠè¿™ä¸ªä¸Šä¸‹æ–‡è®¾ç½®æˆä¸»çº¿ç¨‹ å› ä¸ºä¸‹é¢çš„æµ‹è¯•ä»£ç ä¸­è¦åœ¨è¯¥ä¸Šä¸‹æ–‡çº¿ç¨‹é‡Œé¢æ‰§è¡Œwhileå¾ªç¯</span></span><br><span class="line">            <span class="comment">// ä¼šå¡ä½ä¸»çº¿ç¨‹</span></span><br><span class="line">            <span class="comment">// _synchronizationContext = SynchronizationContext.Current;</span></span><br><span class="line">            <span class="keyword">this</span>._synchronizationContext = <span class="keyword">new</span> SynchronizationContext();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// _thread = new Thread(() =&gt;</span></span><br><span class="line">            <span class="comment">// &#123;</span></span><br><span class="line">            <span class="comment">//     this._synchronizationContext.Post(async (obj) =&gt;</span></span><br><span class="line">            <span class="comment">//     &#123;</span></span><br><span class="line">            <span class="comment">//         // è®©è¿™ä¸ªæ–¹æ³•æ‰§è¡Œçš„ä¹…ä¸€ç‚¹</span></span><br><span class="line">            <span class="comment">//         // å‘ä¸Šä¸‹æ–‡ä¸­æŠ›å‡ºä¸€ä¸ªæ–¹æ³•   </span></span><br><span class="line">            <span class="comment">//         // æ‰§è¡ŒæŸä¸ªæ–¹æ³•ï¼Œ è¿™ä¸ªæ–¹æ³•è¦æ¯”è¾ƒè€—æ—¶ä¸€ç‚¹ æ‰èƒ½çœ‹å‡ºSendå’ŒPostçš„å·®è·</span></span><br><span class="line">            <span class="comment">//         await Task.Delay(1000);</span></span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">            <span class="comment">//         var str = obj as STR;</span></span><br><span class="line">            <span class="comment">//         str.number = 20000;</span></span><br><span class="line">            <span class="comment">//         var threadId = Thread.CurrentThread.ManagedThreadId;</span></span><br><span class="line">            <span class="comment">//         Debug.Log(&quot;æ‰§è¡Œä¸Šä¸‹æ–‡Send/Postæ–¹æ³•çš„çº¿ç¨‹IDæ˜¯: &quot; + threadId);</span></span><br><span class="line">            <span class="comment">//     &#125;, str);</span></span><br><span class="line">            <span class="comment">//     </span></span><br><span class="line">            <span class="comment">//     Debug.Log(&quot;strå­—æ®µä¸­çš„numberæ˜¯&quot; + str.number);</span></span><br><span class="line">            <span class="comment">//     var threadId = Thread.CurrentThread.ManagedThreadId;</span></span><br><span class="line">            <span class="comment">//     Debug.Log(&quot;æ‰§è¡Œçº¿ç¨‹æ–¹æ³•çš„çº¿ç¨‹IDæ˜¯&quot; + threadId);</span></span><br><span class="line">            <span class="comment">//     Debug.Log(&quot;æˆ‘æ˜¯è°ƒç”¨ä¸Šä¸‹æ–‡Send/Postæ–¹æ³•ä¹‹åæ‰§è¡Œçš„è¯­å¥&quot;);</span></span><br><span class="line">            <span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// --------------------------------------------------</span></span><br><span class="line">            <span class="comment">// Send</span></span><br><span class="line">            <span class="comment">// --------------------------------------------------</span></span><br><span class="line">            </span><br><span class="line">            _thread = <span class="keyword">new</span> Thread(() =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">this</span>._synchronizationContext.Send((obj) =&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// è®©è¿™ä¸ªæ–¹æ³•æ‰§è¡Œçš„ä¹…ä¸€ç‚¹</span></span><br><span class="line">                    <span class="comment">// å‘ä¸Šä¸‹æ–‡ä¸­æŠ›å‡ºä¸€ä¸ªæ–¹æ³•   </span></span><br><span class="line">                    <span class="comment">// æ‰§è¡ŒæŸä¸ªæ–¹æ³•ï¼Œ è¿™ä¸ªæ–¹æ³•è¦æ¯”è¾ƒè€—æ—¶ä¸€ç‚¹ æ‰èƒ½çœ‹å‡ºSendå’ŒPostçš„å·®è·</span></span><br><span class="line">                    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="literal">null</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">var</span> threadId = Thread.CurrentThread.ManagedThreadId;</span><br><span class="line">                Debug.Log(<span class="string">&quot;æ‰§è¡Œçº¿ç¨‹æ–¹æ³•çš„çº¿ç¨‹IDæ˜¯&quot;</span> + threadId);</span><br><span class="line">                Debug.Log(<span class="string">&quot;æˆ‘æ˜¯è°ƒç”¨ä¸Šä¸‹æ–‡Send/Postæ–¹æ³•ä¹‹åæ‰§è¡Œçš„è¯­å¥&quot;</span>);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// --------------------------------------------------</span></span><br><span class="line">            <span class="comment">// Post</span></span><br><span class="line">            <span class="comment">// --------------------------------------------------</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// _thread = new Thread(() =&gt;</span></span><br><span class="line">            <span class="comment">// &#123;</span></span><br><span class="line">            <span class="comment">//     this._synchronizationContext.Post((obj) =&gt;</span></span><br><span class="line">            <span class="comment">//     &#123;</span></span><br><span class="line">            <span class="comment">//         // è®©è¿™ä¸ªæ–¹æ³•æ‰§è¡Œçš„ä¹…ä¸€ç‚¹</span></span><br><span class="line">            <span class="comment">//         // å‘ä¸Šä¸‹æ–‡ä¸­æŠ›å‡ºä¸€ä¸ªæ–¹æ³•   </span></span><br><span class="line">            <span class="comment">//         // æ‰§è¡ŒæŸä¸ªæ–¹æ³•ï¼Œ è¿™ä¸ªæ–¹æ³•è¦æ¯”è¾ƒè€—æ—¶ä¸€ç‚¹ æ‰èƒ½çœ‹å‡ºSendå’ŒPostçš„å·®è·</span></span><br><span class="line">            <span class="comment">//         while (true)</span></span><br><span class="line">            <span class="comment">//         &#123;</span></span><br><span class="line">            <span class="comment">//             </span></span><br><span class="line">            <span class="comment">//         &#125;</span></span><br><span class="line">            <span class="comment">//     &#125;, str);</span></span><br><span class="line">            <span class="comment">//     </span></span><br><span class="line">            <span class="comment">//     Debug.Log(&quot;strå­—æ®µä¸­çš„numberæ˜¯&quot; + str.number);</span></span><br><span class="line">            <span class="comment">//     var threadId = Thread.CurrentThread.ManagedThreadId;</span></span><br><span class="line">            <span class="comment">//     Debug.Log(&quot;æ‰§è¡Œçº¿ç¨‹æ–¹æ³•çš„çº¿ç¨‹IDæ˜¯&quot; + threadId);</span></span><br><span class="line">            <span class="comment">//     Debug.Log(&quot;æˆ‘æ˜¯è°ƒç”¨ä¸Šä¸‹æ–‡Send/Postæ–¹æ³•ä¹‹åæ‰§è¡Œçš„è¯­å¥&quot;);</span></span><br><span class="line">            <span class="comment">// &#125;);</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å¼€å§‹æ‰§è¡Œè¿™ä¸ªçº¿ç¨‹ </span></span><br><span class="line">            <span class="keyword">this</span>._thread.Start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>TaskCompletionSourceæ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>æŒ‰ç…§ç¬”è€…çš„ç†è§£ï¼ŒTaskCompletionSourceå¯ä»¥å°†ä¸€ä¸ªåŸºäºå›è°ƒçš„å¼‚æ­¥æ“ä½œè½¬æ¢æˆä¸€ä¸ªå¯ä»¥è¢«awaitçš„å¼‚æ­¥æ“ä½œã€‚</p><h1>ETTaskä¸UniTaskå¯¹æ¯”</h1><h1>æ‰©å±•</h1><ul><li><a href="https://soincredible.github.io/posts/ae5b3442">YooAssetèµ„æºå¼‚æ­¥åŠ è½½æœºåˆ¶</a></li></ul><h2 id="å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£</h2><ul><li><a href="https://blog.csdn.net/q__y__L/article/details/133905192">C#ä¸­çš„TaskCompletionSource</a></li><li><a href="https://devblogs.microsoft.com/premier-developer/dissecting-the-async-methods-in-c/">Dissecting the async methods in C#</a></li><li><a href="https://devblogs.microsoft.com/premier-developer/extending-the-async-methods-in-c/">Extending the async methods in C#</a></li><li><a href="https://devblogs.microsoft.com/premier-developer/">The performance characteristics of async methods in C#</a>the-performance-characteristics-of-async-methods/</li><li><a href="https://devblogs.microsoft.com/premier-developer//one-user-scenario-to-rule-them-all/">One user scenario to rule them all</a></li><li><a href="https://www.cnblogs.com/liqingwen/p/6218994.html?">async çš„ä¸‰å¤§è¿”å›ç±»å‹</a>tdsourcetag=s_pcqq_aiomsg</li><li><a href="https://www.cnblogs.com/wwkk/p/17814057.html">C# SynchronizationContextå’ŒExecutionContextä½¿ç”¨æ€»ç»“</a></li><li><a href="https://blog.csdn.net/shizuguilai/article/details/121236777">è¯¦è§£ SynchronizationContext</a></li><li><a href="https://www.cnblogs.com/peterYong/p/16328187.html">SynchronizationContext</a></li><li><a href="https://learn.microsoft.com/en-us/archive/msdn-magazine/2011/february/">Parallel Computing - Itâ€™s All About the SynchronizationContext</a>msdn-magazine-parallel-computing-it-s-all-about-the-synchronizationcontext</li><li><a href="https://www.cnblogs.com/eventhorizon/p/15316955.html#4991898">æ¦‚è¿° .NET 6 ThreadPool å®ç°</a></li><li><a href="https://www.cnblogs.com/eventhorizon/p/15824541.html">.NET Task æ­ç§˜ï¼ˆ1ï¼‰ï¼šä»€ä¹ˆæ˜¯Task</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ET </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ET </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UniTask</title>
      <link href="/posts/9955c97f/"/>
      <url>/posts/9955c97f/</url>
      
        <content type="html"><![CDATA[<p>ï¼ˆæ‘˜æŠ„è‡ªCLR Via C#ï¼‰å¼‚æ­¥å‡½æ•°å­˜åœ¨ä»¥ä¸‹é™åˆ¶ï¼š</p><ul><li><p>ä¸èƒ½å°†åº”ç”¨ç¨‹åºçš„Mainæ–¹æ³•è½¬å˜æˆå¼‚æ­¥å‡½æ•°ã€‚å¦å¤–æ„é€ å™¨ã€å±æ€§è®¿é—®å™¨æ–¹æ³•å’Œäº‹ä»¶è®¿é—®å™¨æ–¹æ³•ä¸èƒ½è½¬å˜æˆå¼‚æ­¥å‡½æ•°</p></li><li><p>å¼‚æ­¥å‡½æ•°ä¸èƒ½ä½¿ç”¨ä»»ä½•outæˆ–è€…refå‚æ•°</p></li><li><p>ä¸èƒ½åœ¨catchï¼Œfinallyæˆ–unsafeå—ä¸­ä½¿ç”¨awaitæ“ä½œç¬¦ï¼ˆæ³¨æ„åœ¨tryä¸­å¯ä»¥ä½¿ç”¨awaitï¼Œç¬”è€…è®°å¾—UniTaskçš„æ–‡æ¡£ä¸­è¯´è¿‡æ˜¯å¯ä»¥åœ¨try catchä¸­ä½¿ç”¨UniTaskå¹¶è¢«æ•è·çš„ï¼Œæ˜¯å› ä¸ºUniTaskå®ç°äº†è‡ªå·±çš„<code>AsyncMethodBuilderAttribute</code>å—ï¼Ÿ è®°å¾—çœ‹ä¸€ä¸‹ï¼‰ã€‚</p></li><li><p>ä¸èƒ½åœ¨awaitæ“ä½œç¬¦ä¹‹å‰è·å¾—ä¸€ä¸ªæ”¯æŒçº¿ç¨‹æ‰€æœ‰æƒæˆ–é€’å½’çš„é”ï¼Œå¹¶åœ¨awaitæ“ä½œç¬¦ä¹‹åé‡Šæ”¾å®ƒã€‚è¿™æ˜¯å› ä¸ºawaitä¹‹å‰çš„ä»£ç ç”±ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œä¹‹åçš„ä»£ç åˆ™å¯èƒ½ç”±å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚ï¼ˆä½¿ç”¨äº†awaitå°±ä¸€å®šä¼šæ¶‰åŠåˆ°å¤šçº¿ç¨‹å—ï¼Ÿé‚£UniTaskæ˜¯æ€ä¹ˆä¿è¯å®ƒä½¿ç”¨awaitçš„æ—¶å€™æ˜¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹å†…ï¼Ÿï¼‰åœ¨C#çš„lockè¯­å¥ä¸­ä½¿ç”¨awaitï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚å¦‚æœæ˜¾å¼è°ƒç”¨Monitorçš„Enterå’ŒExitæ–¹æ³•ï¼Œé‚£ä¹ˆä»£ç è™½ç„¶å¯ä»¥ç¼–è¯‘ï¼Œä½†Monitor.Exitä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡ºä¸€ä¸ªSynchronizationLockExceptionã€‚</p></li><li><p>åœ¨æŸ¥è¯¢è¡¨è¾¾å¼ä¸­ï¼Œawaitæ“ä½œç¬¦åªèƒ½åœ¨åˆå§‹fromå­å¥çš„ç¬¬ä¸€ä¸ªé›†åˆè¡¨è¾¾å¼ä¸­ä½¿ç”¨ï¼Œæˆ–è€…åœ¨joinå­å¥çš„é›†åˆè¡¨è¾¾å¼ä¸­ä½¿ç”¨ã€‚</p></li><li><p>å…³äºï¼ˆä½¿ç”¨äº†awaitå°±ä¸€å®šä¼šæ¶‰åŠåˆ°å¤šçº¿ç¨‹å—ï¼Ÿé‚£UniTaskæ˜¯æ€ä¹ˆä¿è¯å®ƒä½¿ç”¨awaitçš„æ—¶å€™æ˜¯åœ¨åŒä¸€ä¸ªçº¿ç¨‹å†…ï¼Ÿï¼‰GPTçš„å›å¤ï¼š<br>æ˜¯çš„ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯Unityä¸“ç”¨çš„å¼‚æ­¥APIï¼ˆå¦‚UnityWebRequestï¼‰ï¼Œawaitè¿™äº›APIçš„æ“ä½œé€šå¸¸ä¼šåœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚<br>å¦‚æœå¼€å‘è€…æ˜¾å¼åˆ›å»ºTaskæˆ–Threadå¹¶awaitè¿™äº›ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡å¯èƒ½åœ¨éä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œä½†awaitåç»­çš„ä»£ç ä¾ç„¶ä¼šå›åˆ°ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚<br>å› æ­¤ï¼Œç†è§£ä¸Šå¯ä»¥ç®€åŒ–ä¸ºï¼šåªè¦ä¸æ˜¯å¼€å‘è€…ä¸»åŠ¨ä½¿ç”¨å¤šçº¿ç¨‹æœºåˆ¶ï¼Œä¸€èˆ¬æ‰€æœ‰çš„awaitæ“ä½œéƒ½ä¼šç¡®ä¿åœ¨ä¸»çº¿ç¨‹ä¸Šå®‰å…¨åœ°æ‰§è¡Œåç»­æ“ä½œã€‚</p></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ETæ¡†æ¶Demoå¯åŠ¨æµç¨‹æ¢³ç†</title>
      <link href="/posts/9c5dbe31/"/>
      <url>/posts/9c5dbe31/</url>
      
        <content type="html"><![CDATA[<h1>ETå®¢æˆ·ç«¯å¯åŠ¨æµç¨‹æ¢³ç†</h1><p>å¯åŠ¨æ—¶, å®¢æˆ·ç«¯åªæœ‰ä¸€ä¸ªFiber</p><p>æˆ‘ä»¬å°±ä»<code>Entry.cs</code>è„šæœ¬ä¸­<code>StartAsync</code>æ–¹æ³•çš„æœ€åä¸€è¡Œ<code>FiberManager.Create</code>æ–¹æ³•å¼€å§‹çœ‹å§ï¼Œè¿™ä¸ªæ–¹æ³•å†…éƒ¨æœ‰å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fiber.ThreadSynchronizationContext.Post(<span class="keyword">async</span> () =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> EventSystem.Instance.Invoke&lt;FiberInit, ETTask&gt;((<span class="built_in">long</span>)sceneType, <span class="keyword">new</span> FiberInit() &#123;Fiber = fiber&#125;);</span><br><span class="line">        tcs.SetResult(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception e)</span><br><span class="line">    &#123;</span><br><span class="line">        Log.Error(<span class="string">$&quot;init fiber fail: <span class="subst">&#123;sceneType&#125;</span> <span class="subst">&#123;e&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ä¼šé€šè¿‡<code>EventSystem</code>è§¦å‘å‚æ•°ä¸º<code>FiberInit</code>ã€<code>SceneTypeä¸ºMainï¼ˆå› ä¸ºè°ƒç”¨FiberManager.Createæ–¹æ³•çš„Entryä¼ è¿›æ¥çš„SceneTypeå°±æ˜¯Main)</code>çš„InvokeHandlerçš„<code>Handler</code>æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯<code>FiberInit_Main.cs</code>è„šæœ¬ä¸­çš„çš„<code>Handle</code>æ–¹æ³•ï¼Œå¹¶ä¸”å°†<code>FiberInit</code>å‚æ•°ä¼ é€’åˆ°äº†è¿™ä¸ªæ–¹æ³•å†…ã€‚</p><p>å› ä¸ºæˆ‘ä»¬è¿™é‡Œå…³å¿ƒçš„æ˜¯å®¢æˆ·ç«¯éƒ¨åˆ†ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹<code>await EventSystem.Instance.PublishAsync(root, new EntryEvent3());</code>è¿™ä¸€è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¼šé€šè¿‡<code>EventSystem</code>è§¦å‘å‚æ•°æ˜¯<code>EntryEvent3</code>ã€<code>SceneTypeæ˜¯Main</code>çš„Eventçš„<code>Run</code>æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯<code>EntryEvent3_InitClient</code>ä¸­çš„<code>Run</code>æ–¹æ³•ã€‚</p><p>æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œåœ¨è¯¥æ–¹æ³•å†…å…ˆæ˜¯ç»™ä¼ è¿›æ¥çš„è¿™ä¸ª<code>Scene</code>ç±»å‹çš„rootå­—æ®µæ·»åŠ äº†ä¸€äº›Component: <code>GlobalComponent</code>ã€<code>UIGlobalComponent</code>ã€<code>UIComponent</code>ã€<code>ResourcesLoaderComponent</code>ã€<code>PlayerComponent</code>ã€<code>CurrentScenesComponent</code>ã€‚ç„¶åæ ¹æ®åŠ è½½çš„<code>GlobalConfig</code>ä¸­çš„<code>AppType</code>å­—æ®µä¿®æ”¹äº†ä¼ è¿›æ¥çš„<code>root</code>å‚æ•°çš„<code>SceneType</code>å­—æ®µï¼Œåœ¨<code>Demo</code>ä¸­è¯¥å­—æ®µå°±æ˜¯<code>Demo</code>ã€‚æ¥ç€è°ƒç”¨äº†<code>await EventSystem.Instance.PublishAsync(root, new AppStartInitFinish());</code>è¿™ä¸€è¡Œï¼Œä¹Ÿå°±æ˜¯é€šè¿‡<code>EventSystem</code>è§¦å‘å‚æ•°æ˜¯<code>AppStartInitFinish</code>ã€<code>SceneTypeæ˜¯Demo</code>çš„Eventçš„<code>Run</code>æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯<code>AppStartInitFinish_CreateLoginUI.cs</code>ä¸­çš„<code>Run</code>æ–¹æ³•ã€‚</p><p>åˆ°äº†<code>AppStartInitFinish_CreateLoginUI.cs</code>è¿™é‡Œå°±ä¸éœ€è¦è¯´å¤ªå¤šäº†ï¼Œé¡ºç€ä»£ç è°ƒç”¨è·¯å¾„ç‚¹ä¸‹å»å°±èƒ½æ‰¾åˆ°<code>UILoginEvent.cs</code>è¿™ä¸ªè„šæœ¬ä¸­çš„<code>OnCreate</code>æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•çš„<code>ui.AddComponent&lt;UILoginComponent&gt;();</code>è¿™ä¸€è¡Œè§¦å‘äº†<code>UILoginComponentSystem</code>ä¸­çš„<code>Awake</code>æ–¹æ³•ï¼Œåœ¨è¿™ä¸ª<code>Awake</code>æ–¹æ³•ä¸­ï¼Œç»™ç™»å½•æŒ‰é’®æ³¨å†Œäº†<code>OnLogin</code>æ–¹æ³•ã€‚ç”±<code>OnLogin</code>æ–¹æ³•æˆ‘ä»¬æ‰§è¡Œåˆ°äº†<code>LoginHelper.cs</code>è„šæœ¬ä¸­çš„<code>Login</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¦æ±‚ä½ ä¼ ä¸€ä¸ªç±»å‹ä¸º<code>Scene</code>çš„å­—æ®µï¼Œè¿™ä¸ªå­—æ®µå°±æ˜¯ä»æˆ‘ä»¬æœ€ä¸€å¼€å§‹è¯´çš„<code>Entry.cs</code>è„šæœ¬ä¸­<code>StartAsync</code>æ–¹æ³•çš„æœ€åä¸€è¡Œ<code>FiberManager.Create</code>æ–¹æ³•åˆ›å»ºçš„é‚£ä¸ªFiberé‡Œé¢çš„<code>Root</code>å­—æ®µã€‚<strong><code>LoginHelper.cs</code>è„šæœ¬ä¸­çš„<code>Login</code>æ–¹æ³•ä¸­æ‰§è¡Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ç™»å½•è¯·æ±‚ï¼Œå¹¶ç­‰å¾…æœåŠ¡å™¨çš„å›åº”ç»§ç»­æ‰§è¡Œä¹‹åçš„é€»è¾‘</strong>ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸€è¡Œ<code>long playerId = await clientSenderComponent.LoginAsync(account, password);</code>ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œå®¢æˆ·ç«¯æ‰€æœ‰è¯¥åšçš„äº‹æƒ…å°±éƒ½åšå®Œäº†ï¼Œç°åœ¨å®¢æˆ·ç«¯å·²ç»æŠŠè¯·æ±‚å‘é€ç»™äº†æœåŠ¡ç«¯ï¼Œç­‰å¾…ç€æœåŠ¡ç«¯çš„ç­”å¤ã€‚</p><p>æ‰€æœ‰çš„Sceneéƒ½æ˜¯ç”±Fiberåˆ›å»ºå‡ºæ¥çš„ åœ¨å®¢æˆ·ç«¯æœ‰ä¸¤ä¸ªSceneæˆ–è€…å«Fiberåœ¨è·‘ä¸€ä¸ªæ˜¯Main å¦ä¸€ä¸ªæ˜¯NetClient<br>åœ¨ClientSenderComponentSystemçš„LoginAsyncæ–¹æ³•ä¸­, åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„Fiber, è¿™ä¸ªFiberåˆ›å»ºå, <code>FiberInit_NetClient</code>è¢«è§¦å‘</p><p>è‹¥ä¸€ä¸ªEntityä¸ŠæŒ‚è½½äº†ä¸€ä¸ªProcessInnerSenderç»„ä»¶, é‚£ä¹ˆå®ƒå°±å…·å¤‡äº†å‘å…¶ä»–Fiberå‘é€æ¶ˆæ¯çš„èƒ½åŠ›</p><h1>ETæœåŠ¡ç«¯å¯åŠ¨æµç¨‹æ¢³ç†</h1><p>æœåŠ¡ç«¯çš„å‡ ä¸ªè§’è‰²</p><ul><li>Router</li><li>Realm</li><li>Gate æœ€ç»ˆå¤„ç†ç©å®¶æ•°æ®çš„å°±æ˜¯Gate</li></ul><p>æˆ‘ä»¬å›åˆ°<code>FiberInit_Main.cs</code>è¿™ä¸ªè„šæœ¬ï¼Œè¿™æ¬¡æˆ‘ä»¬è¦ä»¥<code>EntryEvent2</code>ä¸ºçº¿ç´¢æ¥çœ‹ä¸€ä¸‹æœåŠ¡ç«¯çš„å¯åŠ¨æµç¨‹ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å‚æ•°ä¸º<code>EntryEvent2</code>ã€<code>SecneTypeä¸ºMain</code>çš„<code>AEvent</code>ï¼Œä¹Ÿå°±æ˜¯<code>EntryEvent2_InitServer</code>ã€‚ç¬”è€…ç›´æ¥æŠŠè¯¥ç±»çš„Runæ–¹æ³•è´´åœ¨è¿™é‡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">protected override async ETTask Run(Scene root, EntryEvent2 args)</span><br><span class="line">&#123;</span><br><span class="line">    switch (Options.Instance.AppType)</span><br><span class="line">    &#123;</span><br><span class="line">        case AppType.Server:</span><br><span class="line">        &#123;</span><br><span class="line">            // AppType çš„é»˜è®¤å€¼å°±æ˜¯Server</span><br><span class="line">            int process = root.Fiber.Process;</span><br><span class="line">            StartProcessConfig startProcessConfig = StartProcessConfigCategory.Instance.Get(process);</span><br><span class="line">            if (startProcessConfig.Port != 0)</span><br><span class="line">            &#123;</span><br><span class="line">                await FiberManager.Instance.Create(SchedulerType.ThreadPool, ConstFiberId.NetInner, 0, SceneType.NetInner, &quot;NetInner&quot;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // æ ¹æ®é…ç½®åˆ›å»ºçº¤ç¨‹</span><br><span class="line">            // åº”è¯¥æ˜¯ä¼šåˆ›å»º12ä¸ªScene è¿™äº›Sceneä¸­æœ‰é‡å¤çš„</span><br><span class="line">            var processScenes = StartSceneConfigCategory.Instance.GetByProcess(process);</span><br><span class="line">            foreach (StartSceneConfig startConfig in processScenes)</span><br><span class="line">            &#123;</span><br><span class="line">                await FiberManager.Instance.Create(SchedulerType.ThreadPool, startConfig.Id, startConfig.Zone, startConfig.Type, startConfig.Name);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        case AppType.Watcher:</span><br><span class="line">        &#123;</span><br><span class="line">            root.AddComponent&lt;WatcherComponent&gt;();</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        case AppType.GameTool:</span><br><span class="line">        &#123;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (Options.Instance.Console == 1)</span><br><span class="line">    &#123;</span><br><span class="line">        root.AddComponent&lt;ConsoleComponent&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>ETæœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯çš„é€šä¿¡æµç¨‹</h1><p>æˆ‘ä»¬å·²ç»çŸ¥é“äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å„è‡ªçš„å¯åŠ¨æµç¨‹äº†ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ˜¯ä»å“ªé‡Œå»ºç«‹èµ·çš„è¿æ¥å‘¢ï¼Ÿ<br>å°±çœ‹ä¸€ä¸‹ å®¢æˆ·ç«¯æ€ä¹ˆçŸ¥é“å¾€å“ªä¸ªIPåœ°å€å‘è¯·æ±‚</p><p>ç°åœ¨è®©æˆ‘ä»¬å›åˆ°<code>LoginHelper.cs</code>è„šæœ¬ä¸­çš„<code>Login</code>æ–¹æ³•çš„<code>long playerId = await clientSenderComponent.LoginAsync(account, password);</code>è¿™ä¸€è¡Œã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è¦çœ‹ä¸€ä¸‹ï¼Œå®¢æˆ·ç«¯æ˜¯æ€ä¹ˆæŠŠæ¶ˆæ¯å‘å‡ºå»çš„ï¼ŒæœåŠ¡ç«¯æ˜¯æ€ä¹ˆæ¥æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯ã€å¤„ç†å®¢æˆ·ç«¯çš„æ¶ˆæ¯ç„¶åè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„æ¶ˆæ¯æ˜¯æ€ä¹ˆå¤„ç†çš„ä»¥åŠå®¢æˆ·ç«¯å¤„ç†å®ŒæœåŠ¡å™¨è¿”å›çš„æ¶ˆæ¯ä¹‹ååˆåšäº†ä»€ä¹ˆã€‚æœ¬å°èŠ‚æ¶‰åŠåˆ°éƒ¨åˆ†ETæ¡†æ¶å±‚é¢çš„å®ç°ã€‚</p><p>æµç¨‹<br>å®¢æˆ·ç«¯å‘èµ·è¿æ¥è¯·æ±‚-&gt;RouteræœåŠ¡å™¨è¿”å›Realmåœ°å€-&gt;å®¢æˆ·ç«¯æ ¹æ®Realmåœ°å€å‘æœåŠ¡å™¨å‘é€ç”³è¯·-&gt;</p><h1>EnterMap</h1><p>æ‰€æœ‰</p><h1>ETä¸­çš„é…ç½®è¡¨</h1><ul><li>StartProcessConfig</li><li>StartMachineConfig</li><li>StartSceneConfig</li><li>StartZoneConfig</li></ul><hr><p>åŸºæœ¬çš„ç»§æ‰¿ç»“æ„</p><ul><li><p>ETTask<T></p></li><li><p>ETTask</p></li><li><p>Object</p><ul><li>SystemObject é€»è¾‘ä½“ è¿™äº›SystemObjectçœ‹èµ·æ¥éƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€äº›è„šæœ¬ï¼Œæ˜¯å¦‚ä½•åšåˆ°çš„ï¼Ÿ<ul><li>AwakeSystem<T> : ISystemType</li><li>AwakeSystem&lt;T,A&gt; : ISystemType</li><li>AwakeSystem&lt;T,A,B&gt; : ISystemType</li><li>AwakeSystem&lt;T,A,B,C&gt; : ISystemType</li><li>AwakeSystem&lt;T,A,B,C,D&gt; : ISystemType</li><li>DeserializeSystem<T> : ISystemType</li><li>DestroySystem<T> : ISystemType</li><li>GetComponentSysSystem<T> : ISystemType</li><li>LSRollbackSystem<T> : ISystemType</li><li>LSUpdateSystem<T> : ISystemType</li><li>LateUPdateSystem<T> : ISystemType</li><li>SerializeSystem<T> : ISystemType</li><li>UpdateSystem<T> : ISystemType<ul><li>ç»§æ‰¿è‡ªUpdateSystemçš„ç±»ä¸€å…±æœ‰15ä¸ª çœ‹èµ·æ¥éƒ½æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„</li></ul></li></ul></li><li>DisposeObject<ul><li>Entity å®ä½“ç»„ä»¶éƒ½ç»§æ‰¿è¿™ä¸ªç±»<ul><li>Component</li><li>Scene : IScene</li><li>ClientSenderComponent</li><li>MailBoxComponent æŒ‚ä¸Šè¿™ä¸ªç»„ä»¶è¡¨ç¤ºè¯¥Entityæ˜¯ä¸€ä¸ªActor,æ¥æ”¶çš„æ¶ˆæ¯å°†ä¼šé˜Ÿåˆ—å¤„ç†</li><li>TimerComponent</li><li>MoveComponent : IAwake, IDestroy</li><li>GameObjectComponent : IAwake, IDestroy</li><li>NetComponent</li></ul></li><li>ASingleton<ul><li>Singleton<T><ul><li>CodeLoader</li><li>CodeTypes ç»´æŠ¤ç€æ‰€æœ‰è¢«æ ‡è®°äº†<code>EntitySystemAttribute</code>å±æ€§çš„ç±»å’Œæ–¹æ³•ï¼Ÿ</li><li>EntitySystemSingleton é‡Œé¢ç»´æŠ¤ç€æ‰€æœ‰ç»§æ‰¿è‡ª<code>ISystemType</code>æ¥å£çš„çš„ç±»å‹,æˆ–è€…è¯´ï¼Œè¢«æ ‡è®°ä¸º<code>EntitySystemAttribute</code>å±æ€§çš„ç±»å‹</li><li>EventSystem ç»´æŠ¤ç€allInvokersã€allEvents</li><li>MessageDispatcher : ISingleAwake</li><li>MessageSessionDispatcher</li><li>TimeInfo</li></ul></li></ul></li></ul></li><li>ProtoObject : ISupportInitialize ç»§æ‰¿è¯¥æ¥å£èƒ½å¤Ÿå®ç°åºåˆ—åŒ–Bson<ul><li>MessageObject : IMessage</li></ul></li><li>HandlerObject<ul><li>AAIHanddler</li><li>AInvokeHandler<A><ul><li>MailBoxType_OrderedMessageHandler</li><li>ATimer<ul><li>MoveTimer</li></ul></li></ul></li><li>AInvokeHandler&lt;A,T&gt;</li><li>MessageHandler&lt;E,Message&gt;<ul><li>C2M_PathfindingResultHandler</li></ul></li><li>MessageHandler&lt;E,Request,Response&gt;</li><li>MessageLocationHandler&lt;E,Message&gt;</li><li>MessageLocationHandler&lt;E,Request,Response&gt;</li><li>MessageSessionHandler<Message></li><li>MessageSessionHandler&lt;Request,Response&gt;</li></ul></li></ul></li><li><p>AEvent&lt;S,A&gt; : IEvent</p><ul><li>ChangePosition_SyncGameObjectPos</li></ul></li><li><p>AChanel</p><ul><li>KChannel</li><li>TChannel</li><li>WChannel</li></ul></li><li><p>AService</p><ul><li>KService</li><li>TService</li><li>WService</li></ul></li><li><p>IKcpTransport</p><ul><li>TcpTransport</li><li>UdpTransport</li></ul></li><li><p>Fiber</p></li><li><p>TypeSystems</p></li><li><p>OneTypeSystems é‡Œé¢ç»´æŠ¤ç€æ‰€æœ‰ç»§æ‰¿è‡ª<code>SystemObject</code>åŸºç±»çš„ç±»å‹</p></li></ul><p>BaseAttribute (ææ¸…æ¥šè¿™äº›Attributeçš„å«ä¹‰)</p><ul><li>AIHandlerAttribute</li><li>CodeAttribute</li><li>ConfigAttribute</li><li>ConsoleHandlerAttribute</li><li>EnableClassAttribute</li><li>EntitySystemAttribute</li><li>EntitySystemOfAttribute</li><li>EventAttribute</li><li>HttpHandlerAttribute</li><li>InvokeAttribute</li><li>LSEntitySystemAttribute</li><li>LSEntitySystemOfAttribute</li><li>MessageAttribute</li><li>MessageHandlerAttribute<ul><li>MessageLocationHandlerAttribute</li></ul></li><li>MessageSessionHandlerAttribute</li><li>NumericWatcherAttribute</li><li>ResponseTypeAttribute</li><li>UIEventAttribute</li></ul><p>EntitySystemSingleton</p><h1>interface</h1><ul><li>ISystemType<ul><li>IAwakeSystem</li><li>IAwakeSystem<A></li><li>IAwakeSystem&lt;A,B&gt;</li><li>IAwakeSystem&lt;A,B,C&gt;</li><li>IAwakeSystem&lt;A,B,C,D&gt;</li><li>IDeserializeSystem</li><li>IGetComponentSysSystem</li><li>ILSRollbackSystem</li><li>ILSUpdateSystem</li><li>ILateUpdateSystem</li><li>ISerializeSystem</li><li>IUpdateSystem</li></ul></li><li>IInvokeçš„ç»§æ‰¿ç±»çš„æ•°é‡å’ŒInvokerå±æ€§çš„æ ‡è®°æ•°é‡æ˜¯ä¸€æ ·å¤šçš„,æ‰€æœ‰çš„Invokerè¢«EventSystemä¸­çš„allInvokersç®¡ç†ï¼ŒallInvokeræ ¹æ®Invokerå±æ€§åŠ å…¥å­—å…¸ä¸­</li><li>IAwake</li><li>IAwake<A></li><li>IAwake&lt;A,B&gt;</li><li>IAwake&lt;A,B,C&gt;</li><li>IAwake&lt;A,B,C,D&gt;</li><li>IUpdate</li><li>ISerialize</li><li>IScene</li><li>IMessage</li><li>IRequest</li><li>IResponse</li><li>ISingletonAwake</li><li>ISingletonawake<A></li><li>ISingletonAwake&lt;A,B&gt;</li><li>ISingletonAwake&lt;A,B,C&gt;</li></ul><p>ç¯å¢ƒä¸ºET8.1çš„Demoï¼Œæ¢³ç†ç‚¹å‡»åœ°æ¿æ§åˆ¶è§’è‰²ç§»åŠ¨çš„å…¨æµç¨‹</p><p>å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡ç«¯çš„æ¶ˆæ¯ä½“æ˜¯<code>C2M_PathfindingResult</code></p><p>æœåŠ¡ç«¯è¿”å›ç»™å®¢æˆ·ç«¯çš„æ¶ˆæ¯ä½“æ˜¯<code>C2M_PathfindingResult</code></p><p>è´Ÿè´£å‘é€æ¶ˆæ¯ä½“çš„ç±»æ˜¯ProcessInnerSenderï¼Œä½†æ˜¯å°†æ¶ˆæ¯ä½“ä¼ é€’ç»™ProcessInnerSenderä¹‹å‰ï¼Œéœ€è¦å…ˆç”¨A2NetClient_Messageç±»åŒ…è£…ä¸€ä¸‹ï¼Œé€šè¿‡ProcessInnerSenderç±»ï¼Œå°†è¦å‘é€çš„æ¶ˆæ¯ä½“è£…è½½åˆ°MessageQueueä¸­</p><p>ProcessInnerSenderSystemè„šæœ¬ä¸­çš„Replyæ–¹æ³•</p><p>MessageQueueè´Ÿè´£å„ä¸ªçº¤ç¨‹ä¹‹é—´çš„é€šè®¯ï¼Œåœ¨è¿™ä¸ªDemoä¸­çœ‹èµ·æ¥å¹¶æ²¡æœ‰åŒºåˆ†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼Œæˆ–è€…è¯´å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åœ¨ä¸¤ä¸ªä¸åŒçš„çº¤ç¨‹ä¸­ï¼Œæ¨¡æ‹Ÿäº†æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åˆ†ç¦»çš„æ•ˆæœã€‚</p><p>MessageObjectæ˜¯çº¤ç¨‹ï¼ˆå®¢æˆ·ç«¯ã€æœåŠ¡ç«¯ï¼‰ä¹‹é—´é€šä¿¡çš„æ¶ˆæ¯ä½“ï¼Œ</p><p>SystemObject<br>AwakeSystem<br>UpdateSystem</p><h1>ICriticalNotifyCompletionæ¥å£çš„ä½œç”¨</h1><p>åœ¨Initçš„Updateä¸­æ‰§è¡Œç€</p><p>FiberManager.Instance.Update()<br>- this.mainThreadScheduler.Update()<br>-  fiber.Update();<br>- this.EntitySystem.Update();<br>- iUpdateSystem.Run(component); -&gt; ç»§æ‰¿IUpdateSystemæ¥å£çš„UpdateSystemä¸­å®ç°äº†è¯¥Runæ–¹æ³•<br>- this.Update((T)o); -&gt; å†ç”±ç»§æ‰¿äº†UpdateSystemçš„å¯¹è±¡å®ç°Updateæ–¹æ³•</p><p>PathfindComponnetSystem</p><p>å¯»è·¯ç®—æ³•çš„å®ç°æ˜¯åœ¨MoveHelperä¸­çš„FindPathMoveToAsyncä¸­ï¼Œè¯¥æ–¹æ³•ç”±C2M_PathfindingResultHandlerä¸­çš„Runæ–¹æ³•è°ƒç”¨ï¼Œè¿™äº›ç»§æ‰¿è‡ªMessageLocationHandlerçš„Runæ–¹æ³•ç»Ÿä¸€ç”±MessageLocationHandlerçš„Handleæ–¹æ³•è°ƒç”¨ï¼ŒHandleæ–¹æ³•åˆç”±MessageDispatcherä¸­çš„Handleè°ƒç”¨</p><p>é©±åŠ¨å®¢æˆ·ç«¯Unitç§»åŠ¨çš„é€»è¾‘çœ‹èµ·æ¥åœ¨<code>MoveComponentSystem</code>ç±»ä¸­çš„<code>MoveForward</code>æ–¹æ³•ä¸­,è¯¥æ–¹æ³•ç”±MoveTimerç±»ä¸­çš„Runæ–¹æ³•è°ƒç”¨</p><p>çœŸæ­£åœ¨å‰ç«¯åšè¡¨ç°çš„æ˜¯é€šè¿‡<code>ChangePosition_SyncGameObjectPos</code>ç±»</p><h2 id="FiberManager">FiberManager</h2><p>è¿™æ˜¯ETä¸­ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æ¨¡å—,</p><p>åœ¨<code>CodeTypes</code>è„šæœ¬çš„Awakeæ–¹æ³•ä¸­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public void Awake(Assembly[] assemblies)</span><br><span class="line">&#123;</span><br><span class="line">    Dictionary&lt;string, Type&gt; addTypes = AssemblyHelper.GetAssemblyTypes(assemblies);</span><br><span class="line">    foreach ((string fullName, Type type) in addTypes)</span><br><span class="line">    &#123;</span><br><span class="line">        this.allTypes[fullName] = type;</span><br><span class="line">        </span><br><span class="line">        if (type.IsAbstract)</span><br><span class="line">        &#123;</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // è®°å½•æ‰€æœ‰çš„æœ‰BaseAttributeæ ‡è®°çš„çš„ç±»å‹</span><br><span class="line">        object[] objects = type.GetCustomAttributes(typeof(BaseAttribute), true);</span><br><span class="line"></span><br><span class="line">        foreach (object o in objects)</span><br><span class="line">        &#123;</span><br><span class="line">            this.types.Add(o.GetType(), type);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>CodeLoaderä¸­çš„Startæ–¹æ³•å¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">public void Start()</span><br><span class="line">&#123;</span><br><span class="line">    if (!Define.IsEditor)</span><br><span class="line">    &#123;</span><br><span class="line">        byte[] modelAssBytes = this.dlls[&quot;Unity.Model.dll&quot;].bytes;</span><br><span class="line">        byte[] modelPdbBytes = this.dlls[&quot;Unity.Model.pdb&quot;].bytes;</span><br><span class="line">        byte[] modelViewAssBytes = this.dlls[&quot;Unity.ModelView.dll&quot;].bytes;</span><br><span class="line">        byte[] modelViewPdbBytes = this.dlls[&quot;Unity.ModelView.pdb&quot;].bytes;</span><br><span class="line">        // å¦‚æœéœ€è¦æµ‹è¯•ï¼Œå¯æ›¿æ¢æˆä¸‹é¢æ³¨é‡Šçš„ä»£ç ç›´æ¥åŠ è½½Assets/Bundles/Code/Unity.Model.dll.bytesï¼Œä½†çœŸæ­£æ‰“åŒ…æ—¶å¿…é¡»ä½¿ç”¨ä¸Šé¢çš„ä»£ç </span><br><span class="line">        //modelAssBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, &quot;Unity.Model.dll.bytes&quot;));</span><br><span class="line">        //modelPdbBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, &quot;Unity.Model.pdb.bytes&quot;));</span><br><span class="line">        //modelViewAssBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, &quot;Unity.ModelView.dll.bytes&quot;));</span><br><span class="line">        //modelViewPdbBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, &quot;Unity.ModelView.pdb.bytes&quot;));</span><br><span class="line"></span><br><span class="line">        if (Define.EnableIL2CPP)</span><br><span class="line">        &#123;</span><br><span class="line">            foreach (var kv in this.aotDlls)</span><br><span class="line">            &#123;</span><br><span class="line">                TextAsset textAsset = kv.Value;</span><br><span class="line">                RuntimeApi.LoadMetadataForAOTAssembly(textAsset.bytes, HomologousImageMode.SuperSet);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        this.modelAssembly = Assembly.Load(modelAssBytes, modelPdbBytes);</span><br><span class="line">        this.modelViewAssembly = Assembly.Load(modelViewAssBytes, modelViewPdbBytes);</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        if (this.enableDll)</span><br><span class="line">        &#123;</span><br><span class="line">            byte[] modelAssBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, &quot;Unity.Model.dll.bytes&quot;));</span><br><span class="line">            byte[] modelPdbBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, &quot;Unity.Model.pdb.bytes&quot;));</span><br><span class="line">            byte[] modelViewAssBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, &quot;Unity.ModelView.dll.bytes&quot;));</span><br><span class="line">            byte[] modelViewPdbBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, &quot;Unity.ModelView.pdb.bytes&quot;));</span><br><span class="line">            this.modelAssembly = Assembly.Load(modelAssBytes, modelPdbBytes);</span><br><span class="line">            this.modelViewAssembly = Assembly.Load(modelViewAssBytes, modelViewPdbBytes);</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            Assembly[] assemblies = AppDomain.CurrentDomain.GetAssemblies();</span><br><span class="line">            foreach (Assembly ass in assemblies)</span><br><span class="line">            &#123;</span><br><span class="line">                string name = ass.GetName().Name;</span><br><span class="line">                if (name == &quot;Unity.Model&quot;)</span><br><span class="line">                &#123;</span><br><span class="line">                    this.modelAssembly = ass;</span><br><span class="line">                &#125;</span><br><span class="line">                else if (name == &quot;Unity.ModelView&quot;)</span><br><span class="line">                &#123;</span><br><span class="line">                    this.modelViewAssembly = ass;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                if (this.modelAssembly != null &amp;&amp; this.modelViewAssembly != null)</span><br><span class="line">                &#123;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    (Assembly hotfixAssembly, Assembly hotfixViewAssembly) = this.LoadHotfix();</span><br><span class="line"></span><br><span class="line">    World.Instance.AddSingleton&lt;CodeTypes, Assembly[]&gt;(new[]</span><br><span class="line">    &#123;</span><br><span class="line">        typeof (World).Assembly, typeof (Init).Assembly, this.modelAssembly, this.modelViewAssembly, hotfixAssembly,</span><br><span class="line">        hotfixViewAssembly</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    IStaticMethod start = new StaticMethod(this.modelAssembly, &quot;ET.Entry&quot;, &quot;Start&quot;);</span><br><span class="line">    start.Run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ æ˜¯Editoræ¨¡å¼ä¸‹çš„è¯,ä½ åº”è¯¥ä¼šèµ°åˆ°<code>this.enableDll</code>ä¸ºtrueçš„åˆ†æ”¯<br>é€šè¿‡æ‰§è¡ŒCodeLoaderä¸­çš„Startæ–¹æ³•,è¢«éå†åˆ°çš„ç¨‹åºé›†æœ‰<code>World</code>ç±»æ‰€åœ¨çš„ç¨‹åºé›†<code>Unity.Core</code>ã€<code>Init</code>ç±»æ‰€åœ¨çš„ç¨‹åºé›†<code>Unity.Loader</code>ã€modelAssemBly<code>Unity.Model</code>,modelViewAssembly<code>Unity.ModelView</code>,hotfixAssembly<code>Unity.Hotfix</code>,hotfixViewAssembly<code>Unity.HotfixView</code></p><p>ä»£å…¥ä¸€ä¸‹å°±æ˜¯,é€šè¿‡AddSingletonæ–¹æ³•,åˆ›å»ºäº†CodeTypeså®ä¾‹,å¹¶å°†ä¸Šé¢æåˆ°çš„ç¨‹åºé›†ä½œä¸ºå‚æ•°ä¼ å…¥CodeTypeçš„Awakeæ–¹æ³•ä¸­.</p><p>ç„¶ååœ¨modelAssembly<code>Unity.Model</code>ä¸­,æ‰¾åˆ°<code>ET.Entry</code>ç±»ä¸­çš„Startæ–¹æ³•,å¹¶æ‰§è¡Œè¯¥æ–¹æ³•,ç„¶ååœ¨è¯¥æ–¹æ³•ä¸­,æ‰§è¡Œäº†<code>CodeTypes.Instance.CreateCode</code>æ–¹æ³•,è¯¥æ–¹æ³•ä¼šåœ¨ä¸Šé¢æ”¶é›†åˆ°çš„ç¨‹åºé›†ä¸­,æ‰¾åˆ°æ‰€æœ‰è¢«æ ‡è®°äº†CodeAttributeå±æ€§çš„ç±»,å¹¶å°†è¿™äº›ç±»å®ä¾‹åŒ–å‡ºæ¥,è¿™äº›ç±»åˆ†åˆ«æ˜¯</p><ul><li>EntitySystemSingleton</li><li>MessageDispatcher MessagePatcherä¸­çš„Awakeæ–¹æ³•ä¸­å®ä¾‹åŒ–äº†æ‰€æœ‰è¢«æ ‡è®°ä¸ºMessageHandlerAttributeå±æ€§çš„ç±»</li><li>EventSystem</li><li>HttpDispatcher</li><li>LSEntitySystemSingleton</li><li>AIDispatcherComponent</li><li>ConsoleDispatcher</li><li>MessageSessionDispatcher</li><li>NumericWatcherComponent</li><li>UIEventComponent<br>ä¹Ÿå°±æ˜¯è¯´,ä¸Šé¢è¿™åä¸ªç±»,é€šè¿‡æ‰§è¡ŒETçš„Entryæ–¹æ³•ä¹‹åå°±å·²ç»è¢«åˆ›å»ºå‡ºæ¥äº†.</li></ul><h1>é¡¹ç›®ç»„ç»‡</h1><p>åŸºæœ¬ä¸Šé‡è¦çš„è„šæœ¬éƒ½æ˜¯åœ¨Unityå·¥ç¨‹ä¸‹é¢,åœ¨ET.slnè§†è§’ä¸‹,çœ‹åˆ°çš„Unityå¤–é¢å‡ ä¸ªç›®å½•ä¸‹æœ‰å¾ˆå¤šä»£ç ,è¿™äº›ä»£ç éƒ½æ˜¯ç±»ä¼¼è¶…é“¾æ¥çš„ä¸œè¥¿è¿æ¥åˆ°Unityå·¥ç¨‹ä¸­çš„.</p><p>ETä¸­çš„HotFixã€HotFixViewã€Modelã€ModelViewå››ä¸ªç¨‹åºé›†éƒ½æ˜¯ä»¥dllçš„æ–¹å¼åŠ è½½åˆ°å†…å­˜ä¸­è¿è¡Œçš„ï¼Œå› æ­¤å¦‚æœä½ ä¿®æ”¹äº†è¿™å››ä¸ªç¨‹åºé›†é‡Œé¢çš„ä»£ç ï¼Œä½ å¯èƒ½éœ€è¦é‡æ–°éå†ä¸€ä¸‹æ‰èƒ½æŠŠæ›´æ–°çš„å†…å®¹æ”¾è¿›ç¨‹åºé›†ä¸­ã€‚</p><h1></h1><h1>å‚è€ƒèµ„æ–™</h1><p><a href="https://www.bilibili.com/video/BV1rhYyeKExP/?spm_id_from=333.337.search-card.all.click&amp;vd_source=83f4165825ce9df46cf4fd576ccb1102">ET8æ¡†æ¶çš„è®²è§£è§†é¢‘</a><br><a href="https://blog.csdn.net/Q540670228/article/details/123385080?spm=1001.2014.3001.5502">ä¸€ç¯‡å°†æœåŠ¡å™¨æ¶æ„å†å²çš„åšå®¢</a><br><a href="https://et-framework.cn/d/2067-fiber">ä¸€ç¯‡ä»‹ç»C#å’ŒETå¼‚æ­¥æ–¹æ³•çš„å¸–å­</a></p>]]></content>
      
      
      <categories>
          
          <category> ET </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ET </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>YooAsset</title>
      <link href="/posts/ae5b3442/"/>
      <url>/posts/ae5b3442/</url>
      
        <content type="html"><![CDATA[<h1>èµ„æºä¿¡æ¯çƒ­æ›´æ–°æµç¨‹</h1><ul><li>æ¸¸æˆå¯åŠ¨</li><li>è·å–å½“å‰èµ„æºçš„Manifestä¿¡æ¯</li><li>è·å–è¿œç«¯æœ€æ–°çš„Manifestçš„ä¿¡æ¯</li><li>æ¯”è¾ƒå½“å‰å’Œè¿œç«¯Manifestçš„ä¿¡æ¯ï¼Œå¦‚æœå¯ä»¥æ›´æ–°ï¼Œåˆ™éœ€è¦æ›´æ–°åˆ°æœ€æ–°çš„Manifest</li><li>åˆ›å»ºResourcePackageï¼Œæ ¹æ®æœ€æ–°çš„Manifeståˆ›å»ºè¿è¡Œæ—¶çš„AssetSystem</li></ul><p>åˆ†å¸§åŠ è½½æ˜¯ä»€ä¹ˆæ„æ€?</p><p>Persistentä¸‹çš„<br>BuildinRoot-&gt; streamingAssets/YooAssetSettingsData.Setting.DefaultYooFolderName<br>BuildinPackageRoot<br>SandboxRoot-&gt;UnityEngine.Application.persistentDataPath, YooAssetSettingsData.Setting.DefaultYooFolderName<br>SandboxPackageRoot</p><p>ManifestFileName PackageManifest<br>DefaultYooFolderName yoo</p><h1>å¯åŠ¨æµç¨‹</h1><p>å¯åŠ¨æ¸¸æˆ<br>è·å¾—æ¸¸æˆçš„ç‰ˆæœ¬å·<br>åˆå§‹åŒ–YooAsset<br>æœ‰ä¸€ä¸ªå†…ç½®è·¯å¾„å’Œä¸€ä¸ªæ²™ç›’è·¯å¾„<br>å†…ç½®è·¯å¾„æ˜¯åŒ…å«åœ¨åº•åŒ…ä¸­çš„, æ²™ç›’è·¯å¾„æ˜¯persistentè·¯å¾„,è¦ä¹ˆæ˜¯æ²™ç›’è·¯å¾„ä¸­å·²ç»æœ‰ä¸€ä»½æŸä¸ªVerrsionçš„Manifestæ–‡ä»¶äº†, è¦ä¹ˆå°±æ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨æ¸¸æˆ, persistentè·¯å¾„ä¸‹æ˜¯å¹²å‡€çš„, ä»buildInä¹Ÿå°±æ˜¯streamingassetä¸‹é¢æŠŠè·Ÿéšåº•åŒ…çš„Versionçš„Manifestæ–‡ä»¶å†™å…¥åˆ°æ²™ç›’è·¯å¾„ä¸‹. åˆ°æ­¤YooAssetæŒæœ‰äº†ä¸€ä»½æ­£ç¡®çš„Manifesetäº†.</p><p>ç„¶åå†æ˜¯ä¸‹é¢çš„æµç¨‹ğŸ‘‡</p><ol><li>è¦è¯·æ±‚å½“å‰è¿™ä¸ªæ¸¸æˆç‰ˆæœ¬åœ¨CDNä¸Šæœ€æ–°çš„èµ„æºåŒ…çš„<strong>ç‰ˆæœ¬</strong></li><li>æ‹¿åˆ°è¿œç«¯æœ€æ–°çš„èµ„æºç‰ˆæœ¬ä¹‹å, å‘CDNè¯·æ±‚è¿™ä¸ªç‰ˆæœ¬å¯¹åº”çš„<strong>èµ„æºæ¸…å•Manifest</strong><ol><li>å¦‚æœæœ¬åœ°çš„èµ„æºæ¸…å•ä¸æ˜¯ç©ºçš„, å¹¶ä¸”æ¸…å•çš„ç‰ˆæœ¬å’Œ1ä¸­æ‹¿åˆ°çš„ç‰ˆæœ¬ä¸€æ ·, å°±ä¸ç”¨å†å‘è¿œç«¯è¯·æ±‚æ¸…å•Manifestäº†</li><li>å¦åˆ™,<ol><li>å…ˆå°è¯•ä»æœ¬åœ°åŠ è½½1ä¸­æ‹¿åˆ°çš„èµ„æºåŒ…ç‰ˆæœ¬, çœ‹çœ‹æ˜¯ä¸æ˜¯è¿œç«¯CDNæŠŠæœ€æ–°çš„é‚£ä¸ªèµ„æºç‰ˆæœ¬ç»™åˆ é™¤äº†, ç„¶åæœ¬åœ°å…¶å®å·²ç»ä¸‹è½½è¿‡CDNä¸Šæœ€æ–°çš„é‚£ä¸ªç‰ˆæœ¬ è¿™æ—¶å€™ä¹Ÿä¸éœ€è¦å»è¿œç«¯è¯·æ±‚ å³å…ˆå°è¯•ä»æœ¬åœ°åŠ è½½<ol><li>æœ¬åœ°åŠ è½½è¦ç»è¿‡ä¸€äº›æ ¡éªŒ MD5ä¹‹ç±»çš„, ç¨åæ•´ç†</li></ol></li><li>å¦‚æœæœ¬åœ°éƒ½æ²¡æœ‰è¿™ä¸ªç‰ˆæœ¬çš„èµ„æº é‚£ä¹ˆè¿™æ¬¡çœŸçš„è¦å»è¿œç«¯ä¸‹è½½äº† è‡³æ­¤Manifestæ£€æŸ¥ä¸åŠ è½½æµç¨‹å®Œæ¯•</li></ol></li></ol></li><li>æ›´æ–°è¢«æ‰“ä¸Šç‰¹æ®Šæ ‡è®°çš„èµ„æº</li></ol><p>é—®é¢˜: åœ¨å¯åŠ¨çš„æ—¶å€™, åªæ˜¯ä»åº•åŒ…ä¸­ä¹Ÿå°±æ˜¯streamingç›®å½•ä¸‹æŠŠManifestæ‹·è´è¿‡æ¥äº†å•Š, åº•åŒ…ä¸­å¸¦çš„é‚£äº›bundleæœ‰æ²¡æœ‰æ‹·è´è¿‡æ¥å‘¢? ç»“è®ºæ˜¯å¹¶æ²¡æœ‰æ‹·è´è¿‡æ¥,</p><p>åº•åŒ…ä¸­çš„èµ„æºä¹Ÿæ˜¯å¯ä»¥çƒ­æ›´çš„, ä½†æ˜¯çƒ­æ›´çš„åº•åŒ…èµ„æºæ˜¯æ”¾åœ¨persistentæ²™ç›’ç›®å½•ä¸‹çš„, é¦–å…ˆæ˜¯YooAssetæ‹¿åˆ°çš„æœ€æ–°çš„manifest, åœ¨æœ€æ–°çš„manifestä¸­ å¦‚æœåº•åŒ…ä¸­çš„èµ„æºå‘ç”Ÿäº†å˜åŒ–, é‚£ä¹ˆè¿™ä¸ªèµ„æºçš„bundleåä»¥ä¸ºæœ‰hashå€¼, hashå€¼æ˜¯ä¼šå˜çš„, æ‰€ä»¥åœ¨åº•åŒ…ä¸­å°±æ‰¾ä¸åˆ°è¿™ä¸ªèµ„æº. æ‰€ä»¥å°±ä¼šè§¦å‘çƒ­æ›´é€»è¾‘.</p><p>1ã€Unityä¸­ï¼ŒStreamingAssetsPathç§°ä¸ºbuildinè·¯å¾„ï¼ŒpersistentPathç§°ä¸ºSandboxè·¯å¾„ï¼Œå¯ä»¥å—ï¼Ÿ</p><p>ç»“è®ºï¼šå¯ä»¥ï¼Œè¿™æ˜¯ä¸€ç§å¸¸è§çš„ç†è§£æ–¹å¼ã€‚</p><p>è¯¦ç»†è§£é‡Š</p><p>StreamingAssetsPathï¼ˆApplication.streamingAssetsPathï¼‰</p><p>å®ƒæŒ‡å‘åŒ…å†…çš„ StreamingAssets ç›®å½•ï¼Œ æ‰“åŒ…åå†…å®¹åªè¯» ï¼Œæ— æ³•è¿è¡Œæ—¶ä¿®æ”¹ï¼Œå†…å®¹éšåŒ…å‘å¸ƒã€‚<br>å¼€å‘ä¸­å¸¸å¸¸è¢«ç§°ä¸º â€œå†…ç½®èµ„æºè·¯å¾„â€ æˆ– â€œåŒ…å†…èµ„æºè·¯å¾„â€ï¼Œè‹±æ–‡æœ‰æ—¶å« builtin path æˆ– package pathã€‚<br>buildin æˆ– builtin æœ¬èº«ä¸æ˜¯Unityå®˜æ–¹æœ¯è¯­ï¼Œä½†åœ¨è¡Œä¸šé‡Œå¤§é‡ç”¨æ¥æŒ‡åªè¯»/åŒ…å†…/åŸç”Ÿè‡ªå¸¦èµ„æºã€‚<br>persistentPathï¼ˆApplication.persistentDataPathï¼‰</p><p>æŒ‡å‘è®¾å¤‡ä¸Šçš„å¯è¯»å¯å†™ç›®å½•ï¼Œè¿è¡Œæ—¶å¯ä»¥å†™å…¥ï¼Œå¸¸ç”¨äºä¸‹è½½ã€å­˜æ¡£ç­‰ã€‚<br>è¿™ä¸ªç›®å½•é€šå¸¸æ˜¯åº”ç”¨â€œæ²™ç›’â€ä¸­çš„ä¸€ä¸ªå­ç›®å½•ï¼Œ**æ²™ç›’ï¼ˆsandboxï¼‰**å°±æ˜¯æŒ‡æ¯ä¸ªåº”ç”¨ç§æœ‰ä¸”å—ç³»ç»Ÿä¿æŠ¤çš„å­˜å‚¨ç©ºé—´ã€‚<br>å› æ­¤ï¼Œå¾ˆå¤šå¼€å‘è€…å°†å…¶å«åš Sandboxè·¯å¾„ æˆ– æ²™ç›’è·¯å¾„ï¼ˆå³ç”¨æˆ·æ•°æ®/å¯æŒä¹…åŒ–è·¯å¾„ï¼‰ã€‚<br>Sandbox ç›®å½•æ˜¯æ“ä½œç³»ç»Ÿå±‚é¢å¯¹åº”ç”¨ç§æœ‰å­˜å‚¨çš„é€šç”¨å«æ³•ã€‚<br>æ‰€ä»¥ä½ è¿™æ ·å¯¹åº”ï¼š</p><p>StreamingAssetsPath = Buildin Path / åŒ…å†…è·¯å¾„ / å†…ç½®èµ„æºè·¯å¾„<br>PersistentPath = Sandbox Path / æ²™ç›’è·¯å¾„ / å¯è¯»å†™è·¯å¾„<br>æ˜¯å®Œå…¨OKçš„ï¼</p><p>2ã€Buildin å’Œ Sandbox æ˜¯ä»€ä¹ˆå¼€å‘æœ¯è¯­ï¼Ÿ</p><p>Buildin / Built-in</p><p>Built-inï¼ˆæˆ– buildinï¼Œå®é™…æ‹¼å†™åº”ä¸º built-inï¼Œæ„æ€æ˜¯ã€Œå†…å»ºçš„ã€ï¼‰<br>æ³›æŒ‡åº”ç”¨ç¨‹åºè‡ªå¸¦çš„ã€ä¸éœ€è¦åŠ¨æ€ä¸‹è½½çš„èµ„æºæˆ–åŠŸèƒ½ï¼Œé€šå¸¸åªè¯»ã€‚<br>åœ¨Unityï¼Œå¾€å¾€æŒ‡ editorè‡ªå¸¦çš„shaderã€èµ„æºï¼Œä¹Ÿè¢«å¼€å‘è€…æ³›æŒ‡ StreamingAssets å’Œ Resources è¿™äº›ã€ŒéšåŒ…å°±æœ‰ã€çš„èµ„æºç›®å½•ã€‚<br>ä¸æ˜¯Unityçš„å®˜æ–¹APIæœ¯è¯­ï¼Œä½†ä¸šç•Œç”¨å¾—å¤šã€‚<br>Sandbox</p><p>Sandboxï¼ˆæ²™ç›’ï¼‰<br>åœ¨ç§»åŠ¨ç«¯å’Œæ¡Œé¢æ“ä½œç³»ç»Ÿï¼ˆiOS/Android/Windows/macOSï¼‰å¼€å‘ä¸­ï¼Œéƒ½æœ‰â€œæ²™ç›’â€æ¦‚å¿µï¼š<br>æ¯ä¸ªåº”ç”¨æœ‰è‡ªå·±çš„ç§æœ‰ç›®å½•ï¼Œä¸èƒ½éšæ„è®¿é—®å…¶ä»–åº”ç”¨çš„æ•°æ®ï¼Œå—OSä¿æŠ¤ã€‚<br>Unityçš„ Application.persistentDataPath ç›®å½• å°±æ˜¯åœ¨å„å¹³å°æ²™ç›’ä¸­çš„ä¸€ä¸ªå¯è¯»å†™å­ç›®å½•ã€‚<br>æ²™ç›’è·¯å¾„å°±æ˜¯è¿™ç§åº”ç”¨ä¸“å±ã€å¯è¯»å†™çš„æ•°æ®ç›®å½•ã€‚<br>æ€»ç»“</p><p>ä½ è¿™æ ·å«æ³•å¯ä»¥ï¼Œä¸šç•Œå¾ˆå¸¸è§ï¼<br>å®˜æ–¹æ–‡æ¡£å¯èƒ½ä¸ç”¨è¿™ä¸¤ä¸ªå•è¯ï¼Œä½†å®é™…å¼€å‘äº¤æµæ—¶å¸¸ç”¨ï¼š<br>Buildin Pathï¼ŒæŒ‡å†…ç½®åªè¯»èµ„æºã€‚<br>Sandbox Pathï¼ŒæŒ‡åº”ç”¨ç§æœ‰å¯è¯»å†™ç›®å½•ã€‚<br>å‚è€ƒé“¾æ¥</p><p>Unity Application.streamingAssetsPath<br>Unity Application.persistentDataPath<br>å¦‚æœä½ åœ¨æ–‡æ¡£ã€é…ç½®ã€ä»£ç æ³¨é‡Šé‡Œè¿™æ ·ä½¿ç”¨ï¼Œä¸€èˆ¬å›¢é˜Ÿæˆå‘˜éƒ½èƒ½ç†è§£ã€‚å¦‚æœè¦æ±‚æ›´å®˜æ–¹ï¼Œå¯ç”¨â€œStreamingAssets Pathâ€ã€â€œPersistent Data Pathâ€çš„å…¨ç§°è¡¨è¿°ã€‚</p><p>æœ‰ä¸€äº›èµ„æºæ˜¯è¢«æ‰“å…¥åº•åŒ…çš„, åŒæ—¶è¿™äº›èµ„æºä¹Ÿä¼šè¢«çƒ­æ›´, åœ¨æ¸¸æˆå¯åŠ¨æµç¨‹ä¸­, YooAsseté¦–å…ˆè·Ÿè¿œç«¯è¯·æ±‚æœ€æ–°çš„èµ„æºç‰ˆæœ¬, æœ‰ä¸¤ç§å¯èƒ½, 1æœ¬åœ°çš„èµ„æºå°±æ˜¯æœ€æ–°çš„, è¿™é‡ŒæŒ‡çš„æ˜¯Buildinçš„èµ„æº, 2æœ¬åœ°èµ„æºä¸æ˜¯æœ€æ–°çš„, é‚£ä¹ˆå°±ä¼šå…ˆå»CDNä¸Šä¸‹è½½æœ€æ–°çš„BuildInèµ„æº, æŠŠè¿™äº›èµ„æºä¸‹è½½åˆ°Persistentæ²™ç›’ç›®å½•ä¸‹, åœ¨åŠ è½½èµ„æºçš„æ—¶å€™, YooAssetä¼šå…ˆåˆ¤æ–­è¿™ä¸ªèµ„æºåœ¨Persistentæ²™ç›’è·¯å¾„ä¸‹æœ‰æ²¡æœ‰, ç„¶åå†å»BuildInstreamingPathä¸‹å»æ‰¾.<br>æ ¹æ®BudleInfoçš„LoadModeå­—æ®µ</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> BundleInfo <span class="title">CreateBundleInfo</span>(<span class="params">PackageBundle packageBundle</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">if</span> (packageBundle == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;Should never get here !&quot;</span>);</span><br><span class="line"></span><br><span class="line">   <span class="comment">// æŸ¥è¯¢åˆ†å‘èµ„æº</span></span><br><span class="line">   <span class="keyword">if</span> (IsDeliveryPackageBundle(packageBundle))</span><br><span class="line">   &#123;</span><br><span class="line">      DeliveryFileInfo deliveryFileInfo = GetDeiveryFileInfo(packageBundle);</span><br><span class="line">      BundleInfo bundleInfo = <span class="keyword">new</span> BundleInfo(packageBundle, BundleInfo.ELoadMode.LoadFromDelivery, deliveryFileInfo.DeliveryFilePath, deliveryFileInfo.DeliveryFileOffset);</span><br><span class="line">      <span class="keyword">return</span> bundleInfo;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// æŸ¥è¯¢æ²™ç›’èµ„æº</span></span><br><span class="line">   <span class="keyword">if</span> (IsCachedPackageBundle(packageBundle))</span><br><span class="line">   &#123;</span><br><span class="line">      BundleInfo bundleInfo = <span class="keyword">new</span> BundleInfo(packageBundle, BundleInfo.ELoadMode.LoadFromCache);</span><br><span class="line">      <span class="keyword">return</span> bundleInfo;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// æŸ¥è¯¢APPèµ„æº</span></span><br><span class="line">   <span class="keyword">if</span> (IsBuildinPackageBundle(packageBundle))</span><br><span class="line">   &#123;</span><br><span class="line">      BundleInfo bundleInfo = <span class="keyword">new</span> BundleInfo(packageBundle, BundleInfo.ELoadMode.LoadFromStreaming);</span><br><span class="line">      <span class="keyword">return</span> bundleInfo;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// ä»æœåŠ¡ç«¯ä¸‹è½½</span></span><br><span class="line">   <span class="keyword">return</span> ConvertToDownloadInfo(packageBundle);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>è´ªå¿ƒç®—æ³•</title>
      <link href="/posts/a4ce31d2/"/>
      <url>/posts/a4ce31d2/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®ç»“æ„ä¸ç®—æ³•ç³»åˆ—</title>
      <link href="/posts/e1a82e1/"/>
      <url>/posts/e1a82e1/</url>
      
        <content type="html"><![CDATA[<p>è¿™æ˜¯æ•°æ®ç»“æ„ä¸ç®—æ³•ç³»åˆ—çš„ç´¢å¼•é¡µï¼Œç¬”è€…å†™ä¸‹è¿™æ®µè¯çš„æ—¶é—´æ˜¯2025.3.14ï¼Œæ­¤æ—¶è·ç¦»ç¬”è€…æ¯•ä¸šå·²ç»è¿‡å»å¿«ä¸¤å¹´çš„æ—¶é—´ï¼Œè¯šç„¶ç¬”è€…ä¸€ç›´æœ‰ä¸ªå¿ƒç»“ï¼Œæƒ³è¦è¡¥æ•‘å­¦ç”Ÿæ—¶ä¸æ›¾ç‰¢å›ºçš„åŸºç¡€ï¼Œä¾¿æœ‰äº†æ­¤ç³»åˆ—è¯ç”Ÿã€‚æœ¬ç³»åˆ—ä¼šä½¿ç”¨C++ä»æ— åˆ°æœ‰å®ç°æ ‘ã€å›¾ã€åŠ¨è§„ã€å›æº¯è¿˜æœ‰æ¸¸æˆä¸­å¸¸ç”¨çš„A*ã€RVOç­‰ç®—æ³•ï¼Œç›®çš„æœ‰äºŒï¼Œå…¶ä¸€ä¸Šé¢å·²ç»è¯´äº†ï¼Œå…¶äºŒä¹Ÿæ˜¯å¸Œæœ›ç†Ÿæ‚‰C++çš„ä½¿ç”¨ï¼Œå¤šä¸€é—¨ç¼–ç¨‹æ‰‹è‰ºå‚èº«ã€‚ç³»åˆ—å¯¹åº”çš„ä»£ç éƒ½ä¼šä¸Šä¼ åˆ°<a href="https://github.com/SoIncredible/programming-practice">GitHubä»“åº“</a>ä¸­</p><p>ä¹‹å‰å­¦ç®—æ³•çš„æ—¶å€™å¾ˆç—›è‹¦çš„åŸå› : ä½¿ç”¨è‡ªå·±å¹¶ä¸ç†Ÿæ‚‰çš„C++è¯­è¨€, åœ¨è¯­æ³•å’Œåº“æ¥å£ä¸Šæ¶ˆç£¨äº†å¤ªå¤šäº†ç²¾åŠ›, è€Œä¸æ˜¯ä¸“æ³¨äºé—®é¢˜æœ¬èº«</p><h1>ç›®å½•</h1><ul><li><a href="https://soincredible.github.io/posts/62b3cca9/">æ ‘</a></li><li><a href="https://soincredible.github.io/posts/c830c38b/">å›¾</a></li><li><a href="https://soincredible.github.io/posts/735e5788/">æ’åºç®—æ³•</a></li><li><a href="https://soincredible.github.io/postsa80d0031/">åŠ¨æ€è§„åˆ’</a></li><li><a href="https://soincredible.github.io/posts/376d0826/">å›æº¯ç®—æ³•</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Wesnothå°åœ°å›¾</title>
      <link href="/posts/9af50f63/"/>
      <url>/posts/9af50f63/</url>
      
        <content type="html"><![CDATA[<p>Wesnothå°åœ°å›¾çš„è®¾è®¡åŸºäºè¿™ç¯‡åšå®¢https://www.redblobgames.com/grids/hexagons/#coordinates-cube</p>]]></content>
      
      
      <categories>
          
          <category> Wesnoth </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å½“æˆ‘è°ˆè·‘æ­¥æ—¶ï¼Œæˆ‘è°ˆäº›ä»€ä¹ˆ</title>
      <link href="/posts/4b5f1bf6/"/>
      <url>/posts/4b5f1bf6/</url>
      
        <content type="html"><![CDATA[<p>ä¸€ä¸ªåˆ°äº†æˆ‘è¿™æ ·å¹´é¾„çš„äºº,è¿˜è¦å†™ä¸‹è¿™ç§äº‹æƒ…,é¢‡æœ‰äº›æ„šè ¢å¯ç¬‘.ä¸è¿‡ä¸ºäº†æ˜ç¡®äº‹å®,æˆ‘å¾—è¨€ä¹‹åœ¨çº¿:è¯´èµ·æ¥,æˆ‘æ˜¯é‚£ç§å–œçˆ±è¯»ä¹¦çš„æ€§æƒ…,è¡¨è¾¾å¾—å‡†ç¡®ä¸€ç‚¹,æ˜¯é‚£ç§ä¸å¤ªä»¥ç‹¬å¤„ä¸ºè‹¦çš„æ€§æƒ….æ¯å¤©æœ‰ä¸€ä¸¤ä¸ªå°æ—¶è°éƒ½ä¸äº¤è°ˆ,ç‹¬è‡ªä¸€äººé»˜é»˜åœ°è·‘æ­¥ä¹Ÿç½¢,å››äº”ä¸ªå°æ—¶ä¼æ¡ˆç‹¬å,é»˜é»˜åœ°å†™æ–‡ç« ä¹Ÿç½¢,æˆ‘éƒ½ä¸è§‰å¾—éš¾ç†¬,ä¹Ÿä¸æ„Ÿåˆ°æ— èŠ.è¿™ç§å€¾å‘ä»å¹´è½»æ—¶èµ·ä¾¿ä¸€ç›´å­˜åœ¨äºæˆ‘èº«ä¸Š.æ¯”èµ·åŒä»€ä¹ˆäººä¸€èµ·åšä»€ä¹ˆäº‹,æˆ‘æ›´å–œæ¬¢ä¸€ä¸ªäººé»˜ä¸ä½œå£°åœ°è¯»ä¹¦,æˆ–æ˜¯å…¨ç¥è´¯æ³¨åœ°å¬éŸ³ä¹.åªéœ€è¦ä¸€ä¸ªäººåšçš„äº‹æƒ…,æˆ‘å¯ä»¥æƒ³å‡ºè®¸å¤šè®¸å¤šæ¥.</p><p>è™½ç„¶å¦‚æ­¤,è‡ªä»å¹´çºªè½»è½»ä¾¿ç»“äº†å©š(æˆ‘ç»“å©šæ—¶äºŒåäºŒå²), æˆ‘æ¸æ¸ä¹ æƒ¯äº†å’Œåˆ«äººå…±åŒç”Ÿæ´». å¤§å­¦æ¯•ä¸šåç»è¥ä¸€å®¶é¥®é£Ÿåº—, è®¤è¯†åˆ°äº†ä¸ä»–äººç›¸å¤„çš„é‡è¦æ€§. äººæ— æ³•ç‹¬è‡ªç”Ÿå­˜ä¸‹å», è¿™æœ¬æ˜¯ç†æ‰€å½“ç„¶, æˆ‘å´æ˜¯è„šè¸å®åœ°å­¦åˆ°çš„. å°½ç®¡æœ‰ç‚¹èµ°æ ·, æˆ‘ä¹Ÿæ¸æ¸æŒæ¡äº†ç±»ä¼¼ç¤¾ä¼šæ€§çš„ä¸œè¥¿. å›æƒ³èµ·æ¥, ä»äºŒåå²åˆ°ä¸‰åå²çš„åå¹´å½“ä¸­, æˆ‘çš„ä¸–ç•Œè§‚å‘ç”Ÿäº†ä¸å°çš„å˜åŒ–, åœ¨åšäººæ–¹é¢ä¹Ÿæœ‰äº†ä¸€äº›é•¿è¿›, ä»å››å¤„ç¢°å£ä¹‹ä¸­å­¦ä¼šäº†ç”Ÿå­˜çš„è¯€çª. å€˜è‹¥æ²¡æœ‰è¿™ç®—å¾—ä¸Šè‰°éš¾çš„åå¹´çš„ç”Ÿæ´»ä½“éªŒ, ææ€•æˆ‘å°±ä¸ä¼šå†™ä»€ä¹ˆå°è¯´äº†, å³ä½¿æƒ³å†™ä¹Ÿå†™ä¸å‡ºæ¥. ä½†è¯è¯´å›æ¥, äººçš„æœ¬æ€§ä¸ä¼šæç«¯åœ°å‘ç”Ÿå˜åŒ–. å¸Œæœ›ä¸€äººç‹¬å¤„çš„å¿µå¤´å§‹ç»ˆä¸å˜åœ°å­˜äºå¿ƒä¸­, æ‰€ä»¥æ¯å¤©è·‘ä¸€ä¸ªå°æ—¶, æ¥ç¡®ä¿åªå±äºè‡ªå·±çš„æ²‰é»˜çš„æ—¶é—´, å¯¹æˆ‘çš„ç²¾ç¥å¥åº·æ¥è¯´æˆäº†å…·æœ‰é‡è¦æ„ä¹‰çš„åŠŸè¯¾. è‡³å°‘åœ¨è·‘æ­¥æ—¶ä¸éœ€è¦å’Œä»»ä½•äººäº¤è°ˆ, ä¸å¿…å¬ä»»ä½•äººè¯´è¯, åªè¦çœºæœ›å‘¨å›´çš„é£å…‰ã€å‡è§†è‡ªå·±å°±è¡Œ. è¿™æ˜¯ä»»ä½•ä¸œè¥¿éƒ½æ— æ³•æ›¿ä»£çš„å®è´µæ—¶åˆ».</p><p>æ¯æ¯æœ‰äººé—®æˆ‘: è·‘æ­¥æ—¶, ä½ æ€è€ƒä»€ä¹ˆ?æè¿™ç§é—®é¢˜çš„äºº, å¤§å¤šæ²¡æœ‰é•¿æ—¶é—´è·‘æ­¥çš„ç»å†. é‡åˆ°è¿™æ ·çš„æé—®, æˆ‘ä¾¿é™·å…¥æ·±æ·±çš„æ€è€ƒ: æˆ‘åœ¨è·‘æ­¥æ—¶, ç©¶ç«Ÿæ€é‡äº†äº›ä»€ä¹ˆ? è€å®è¯´, åœ¨è·‘æ­¥æ—¶æ€è€ƒè¿‡ä»€ä¹ˆ, æˆ‘å‹æ ¹å„¿æƒ³ä¸èµ·æ¥.</p><p>åœ¨å¯’å†·çš„æ—¥å­, æˆ‘è‚¯å‘¢ä¸ªæ€è€ƒä¸€ä¸‹å¯’å†·; åœ¨ç‚çƒ­çš„æ—¥å­,åˆ™æ€è€ƒä¸€ä¸‹ç‚çƒ­; æ‚²å“€çš„æ—¶å€™,æ€è€ƒä¸€ä¸‹æ‚²å“€;å¿«ä¹çš„æ—¶å€™, åˆ™æ€è€ƒä¸€ä¸‹å¿«ä¹. å¦‚åŒå‰é¢å†™è¿‡çš„, è¿˜ä¼šæ¯«æ— ç”±æ¥åœ°æµ®æƒ³å¾€äº‹. æœ‰æ—¶å€™, åªæ˜¯å¶å°”æœ‰ä¹‹,ä¹Ÿæœ‰å…³äºå°è¯´çš„å°å°çµæ„Ÿæµ®ä¸Šè„‘é™…. å°½ç®¡å¦‚æ­¤, æˆ‘å‡ ä¹ä»ä¸æ›¾æ€è€ƒæ­£å„¿å…«ç»çš„äº‹æƒ….</p><p>æˆ‘è·‘æ­¥, åªæ˜¯è·‘ç€. åŸåˆ™ä¸Šæ˜¯åœ¨ç©ºç™½ä¸­è·‘æ­¥. ä¹Ÿè®¸æ˜¯ä¸ºäº†è·å¾—ç©ºç™½è€Œè·‘æ­¥. å³ä¾¿åœ¨è¿™æ ·çš„ç©ºç™½å½“ä¸­,ä¹Ÿæœ‰ç‰‡æ—¶ç‰‡åˆ»çš„æ€ç»ªæ½œå…¥. è¿™æ˜¯ç†æ‰€å½“ç„¶çš„,äººçš„å¿ƒçµä¸­ä¸å¯èƒ½å­˜åœ¨çœŸæ­£çš„ç©ºç™½. äººç±»çš„ç²¾ç¥çŠ¶æ€è¿˜æ²¡æœ‰å¼ºå¤§åˆ°è¶³ä»¥åæ‹¥çœŸç©ºçš„ç¨‹åº¦,å³ä½¿æœ‰,ä¹Ÿä¸æ˜¯ä¸€ä»¥è´¯ä¹‹çš„.è¯è™½å¦‚æ­¤,æ½œå…¥å¥”è·‘çš„æˆ‘ç²¾ç¥å†…éƒ¨çš„è¿™äº›æ€ç»ªæˆ–è€…è¯´å¿µå¤´,ä¹Ÿä¸è¿‡æ˜¯ç©ºç™½çš„ä»å±ç‰©. å®ƒä»¬ä¸æ˜¯å†…å®¹,åªæ˜¯ä»¥ç©ºç™½ä¸ºåŸºè½´æ¸èµ·æ¸é•¿çš„æ€ç»ª.</p>]]></content>
      
      
      <categories>
          
          <category> è¯»ä¸‡å·ä¹¦ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>äººç”Ÿåå¹´ï¼Œä¸å¯è¾œè´Ÿçš„20å²åˆ°30å²</title>
      <link href="/posts/7fa93228/"/>
      <url>/posts/7fa93228/</url>
      
        <content type="html"><![CDATA[<h1>äººç”Ÿåå¹´ ä¸å¯è¾œè´Ÿçš„20å²åˆ°30å²</h1><h2 id="èº«ä»½èµ„æœ¬">èº«ä»½èµ„æœ¬</h2><p>èº«ä»½èµ„æœ¬æ˜¯æˆ‘ä»¬ä¸ªäººèµ„æœ¬çš„ç§¯ç´¯ã€‚ ä»–ä½“ç°ç€æˆ‘ä»¬æ˜¯è°ï¼Œä»¥åŠæˆ‘å³¨åµ‹ä½ çš„äººç”Ÿæ˜¯å¦‚ä½•åº¦è¿‡çš„ã€‚å®ƒåŒ…æ‹¬æˆ‘ä»¬å¯¹è‡ªå·±çš„æŠ•èµ„ï¼Œä»¥åŠå› æˆ‘ä»¬æ“…é•¿æˆ–é•¿æ—¶é—´ä»äº‹è€Œé€æ¸æ¼”å˜ä¸ºè‡ªå·±èº«ä»½ä¸€éƒ¨åˆ†çš„äº‹æƒ…ã€‚è‹¥æƒ³çœŸæ­£å¯»å¾—â€œæˆ‘æ˜¯è°â€è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼Œä»…ä»…åƒæµ·ä¼¦ä¸€æ ·ç­‰å¾…è‡ªå·±â€œçµå…‰ä¹ç°â€æ˜¯ä¸è¡Œçš„ã€‚èº«ä»½èµ„æœ¬æ‰èƒ½è®©æˆ‘ä»¬ä¸€ç‚¹ä¸€ç‚¹åœ°ï¼Œå»ºç«‹çœŸå®çš„è‡ªå·±ã€‚</p><p>ä¸€äº›èº«ä»½èµ„æœ¬ï¼Œè­¬å¦‚å­¦ä½è¯ä¹¦ã€å·¥ä½œç»å†ã€è€ƒè¯•æˆç»©æˆ–ç¤¾å›¢æ´»åŠ¨ï¼Œå¯ä»¥å†™åœ¨ç®€å†é‡Œï¼›ä½†å¦ä¸€äº›èº«ä»½èµ„æœ¬ï¼Œåˆ™æ›´åŠ ç§äººåŒ–ï¼ŒåŒ…æ‹¬æˆ‘ä»¬æ˜¯å¦‚ä½•å‘å¤–ç•Œå±•ç°è‡ªå·±çš„ï¼Œæˆ‘ä»¬æ˜¯å¦‚ä½•è§£å†³é—®é¢˜çš„ï¼Œæˆ‘ä»¬ä»å“ªé‡Œæ¥ï¼Œä»¥åŠæˆ‘ä»¬çš„çˆ±å¥½æˆ–å…¶ä»–äººç”Ÿç»ç†ã€‚è¿™äº›åŠ æ€»åœ¨ä¸€èµ·ï¼Œæ‰æ„æˆäº†æˆ‘ä»¬ç‹¬ä¸€æ— äºŒçš„èº«ä»½èµ„æœ¬ã€‚å®ƒå°±åƒæ˜¯æˆäººä¸–ç•Œé‡Œçš„è™šæ‹Ÿè´§å¸ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥è´­ä¹°è‡ªå·±æƒ³è¦çš„æœºä¼šã€å·¥ä½œå’Œå…¶ä»–ä¸œè¥¿ã€‚</p><p>20å¤šå²çš„å¹´è½»äººï¼Œè­¬å¦‚æµ·ä¼¦ï¼Œæˆ–è®¸ä¼šä»¥ä¸ºè‡ªå·±ç°åœ¨æ­£åœ¨ç»ç†èº«ä»½è®¤åŒå±æœºæ˜¯ç†æ‰€å½“ç„¶çš„ï¼Œè€Œç§¯ç´¯èº«ä»½èµ„æœ¬æ˜¯ä»¥åçš„äº‹ã€‚ä½†äº‹å®ä¸Šï¼Œç»å†èº«ä»½è®¤åŒå±æœºå’Œç§¯ç´¯èº«ä»½èµ„æœ¬ï¼Œå¯ä»¥è€Œä¸”åº”è¯¥åŒæ—¶è¿›è¡Œï¼Œå°±åƒåŸƒé‡Œå…‹æ£®åšçš„é‚£æ ·ã€‚ç ”ç©¶äººå‘˜åœ¨ç ”ç©¶äººä»¬å¦‚ä½•è§£å†³èº«ä»½è®¤åŒå±æœºæ—¶å‘ç°ï¼Œé‚£äº›åªæ˜¯ç§¯ç´¯èº«ä»½èµ„æœ¬ï¼Œè€Œæ²¡æœ‰ç»å†èº«ä»½è®¤åŒå±æœºçš„äººï¼ˆåªå·¥ä½œè€Œæ²¡æœ‰è‡ªæˆ‘æ¢ç´¢çš„äººï¼‰ï¼Œä»–ä»¬çš„äººç”Ÿä¼šæ˜¾å¾—è¿‡äºæ­»æ¿å’Œä¼ ç»Ÿã€‚ç›¸åï¼Œè‹¥åªæ˜¯ç»å†èº«ä»½è®¤åŒå±æœºï¼Œè€Œç–äºç§¯ç´¯èº«ä»½èµ„æœ¬ï¼Œä¹Ÿæœ‰é—®é¢˜ã€‚éšç€èº«ä»½è®¤åŒå±æœºçš„æ¦‚å¿µåœ¨ç¾å›½é€æ¸æµè¡Œï¼ŒåŸƒé‡Œå…‹æ£®æ›¾äº²è‡ªæé†’å¤§å®¶ï¼Œä¸è¦èŠ±å¤ªå¤šæ—¶é—´åœ¨â€œæ— è°“çš„è¿·èŒ«â€ä¸Šã€‚ä»–å¯¹äºå¤ªå¤šå¹´è½»äººå¤„äºâ€œè„±ç¦»ç¤¾ä¼šçš„å±é™©â€è¡¨ç¤ºæ‹…å¿§ã€‚</p><p>äº‹å®ä¸Šï¼Œé‚£äº›æ—¢èƒ½èŠ±æ—¶é—´æ¢ç´¢è‡ªæˆ‘ï¼Œåˆæ•¢äºåšå‡ºæ‰¿è¯ºçš„20å¤šå²çš„å¹´è½»äººï¼Œå°†ä¼šå˜å¾—æ›´åŠ å¼ºå¤§ã€‚ä»–ä»¬ä¸ä»…ä¼šå˜å¾—æ›´æœ‰è‡ªå°Šï¼Œä¹Ÿæ›´æ‡‚å¾—è„šè¸å®åœ°ï¼ŒåšæŒä¸æ‡ˆã€‚è€Œä¸”ï¼Œä»–ä»¬çš„è‡ªæˆ‘æ„Ÿå°†å˜å¾—æ›´åŠ æ¸…æ™°ï¼Œäººç”Ÿä¹Ÿæ›´å¹¸ç¦ï¼›ä»–ä»¬æ‹¥æœ‰æ›´å¼ºçš„å‹åŠ›ç®¡ç†èƒ½åŠ›ä»¥åŠç†æ€§åˆ†æèƒ½åŠ›ï¼Œå¹¶ä¸”èƒ½ä¸ç•ä¸–ä¿—æ´»å‡ºçœŸæ­£çš„è‡ªæˆ‘ã€‚è¿™äº›éƒ½æ˜¯æµ·ä¼¦æƒ³è¦çš„ã€‚</p><hr><p>å½“ä½ ä»å­¦æ ¡è¿ˆå…¥ç¤¾ä¼šä¹‹åï¼Œå¾ˆå¤šè§„åˆ™éƒ½å·²ä¸å†ç›¸åŒã€‚å¯¹äºæŸäº›20å¤šå²çš„å¹´è½»äººè€Œè¨€ï¼Œä»–ä»¬çš„äººç”Ÿæˆ–è®¸å»ºç«‹åœ¨å¸¸æ˜¥è—¤é™¢æ ¡çš„å­¦å†ï¼Œæˆ–åŠ å…¥å…¨ç¾å¤§å­¦ä¼˜ç­‰ç”Ÿè£èª‰åä¼šä¹‹ä¸Šã€‚ä½†æ›´å¤šæ—¶å€™ï¼Œé‚£äº›çœŸæ­£å†³å®šä½ æœªæ¥èŒä¸šé“è·¯çš„ï¼Œå¹¶ä¸æ˜¯ä½ åœ¨å­¦æ ¡å­¦çš„ä¸“ä¸šå’Œå¹³å‡å­¦åˆ†ç»©ç‚¹ï¼Œè€Œæ˜¯ä¸¤ä¸‰ä¸ªèƒ½è®©åˆ«äººå¯¹ä½ äº§ç”Ÿå…´è¶£çš„èº«ä»½èµ„æœ¬ã€‚</p><hr><blockquote><p>ä½•ä¸ºå°±ä¸šä¸è¶³ï¼Ÿ<br>1.æ²¡æœ‰å·¥ä½œçš„çŠ¶æ€<br>2.æœ‰å·¥ä½œï¼Œä½†æ˜¯ä¸æ˜¯ç§¯ç´¯èº«ä»½èµ„æœ¬çš„å·¥ä½œ<br>ä½•ä¸ºèº«ä»½èµ„æœ¬ï¼Ÿ<br>1.å­¦å†ã€æˆç»©<br>2.ç‹¬ç‰¹çš„ç»å†<br>3.æŸç§æŠ€èƒ½</p></blockquote><p>æˆ‘ä»¬åœ¨å·¥ä½œä¸­è¶Šæ™šç«™ç¨³è„šè·Ÿï¼Œæˆ‘ä»¬è¶Šæœ‰å¯èƒ½å˜å¾—åƒä¸€ä½è®°è€…æ‰€æè¿°çš„é‚£æ ·ï¼Œè¢«é•¿æ—¶é—´çš„æ¼‚æ³Šä¸å®šæ‰€â€œå¼‚åŒ–å’Œä¼¤å®³â€ã€‚ç ”ç©¶å‘Šè¯‰æˆ‘ä»¬ï¼Œä»…ä»…9ä¸ªæœˆçš„å°±ä¸šä¸è¶³ï¼Œå°±å¯ä»¥è®©20å¤šå²çš„å¹´è½»äººæ¯”é‚£äº›å……åˆ†å°±ä¸šçš„åŒé¾„äººæ›´åŠ ç¼ºä¹åŠ¨æœºï¼Œæ›´åŠ æŠ‘éƒï¼Œç”šè‡³å’Œé‚£äº›å¤±ä¸šçš„åŒé¾„äººç›¸æ¯”ï¼Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä½†æ˜¯ï¼Œåœ¨ä½ è®¤å®šâ€œå¤±ä¸šâ€æ¯”â€œå°±ä¸šä¸è¶³â€æ›´å¥½ä¹‹å‰ï¼Œè¯·è€ƒè™‘è¿™ä¸€ç‚¹ï¼šä¸20å¤šå²å¤±ä¸šç›¸å…³è”çš„ï¼Œæ˜¯ä¸­å¹´æ—¶æœŸçš„éœ€æ±‚é—®é¢˜å’Œç²¾ç¥æŠ‘éƒï¼Œå³ä½¿æœ‰äº†å›ºå®šå·¥ä½œï¼Œæƒ…å†µä¹Ÿæ²¡æœ‰æ”¹å˜ã€‚</p><p>è¿™æ ·çš„ä¾‹å­ï¼Œæˆ‘è§è¿‡ä¸å°‘ã€‚é‚£äº›æœ¬èº«èªæ˜æœºæ•çš„å¹´è½»äººï¼Œä¸ºäº†é¿å…è¸å…¥â€œçœŸå®ä¸–ç•Œâ€è€Œä¸å»ä»äº‹â€œçœŸæ­£çš„å·¥ä½œâ€ï¼Œå› æ­¤åœ¨å°±ä¸šä¸è¶³çš„çŠ¶æ€é‡Œå¹´å¤ä¸€å¹´åœ°æ··ç€æ—¥å¿—ã€‚æ…¢æ…¢åœ°ï¼Œä»–ä»¬å°±è¢«è¿™æ ·çš„çŠ¶æ€ç£¨å»äº†æœ¬æœ‰çš„æ¿€æƒ…æ ¸åŠ¨åŠ›ï¼Œè€Œä¸å†å»å¯»æ‰¾é‚£äº›æˆ–è®¸èƒ½è®©ä»–ä»¬çœŸæ­£å¿«ä¹çš„å·¥ä½œã€‚åæ¥ï¼Œè¿™æ ·çš„å·¥ä½œç”šè‡³ä¹Ÿå˜å¾—è¶Šæ¥è¶Šéš¾æ‰¾ã€‚æœ‰ä¸€ç‚¹ï¼Œè¢«ç»æµå­¦å®¶å’Œç¤¾ä¼šå­¦å®¶æ‰€ä¸€è‡´è®¤åŒï¼š20å¤šå²æ—¶çš„å·¥ä½œç»å†å°†ä¼šä¸ºæˆ‘ä»¬èŒä¸šç”Ÿæ¶¯çš„æˆåŠŸå¸¦æ¥è¶…ä¹é¢„æ–™çš„å½±å“ã€‚â€œåœ¨ä½ 20å¤šå²æ—¶ï¼Œä½ ä¸€ç”Ÿèƒ½èµšå¤šå°‘é’±å°±åŸºæœ¬å·²ç»ç¡®å®šäº†â€2015å¹´ã€Šåç››é¡¿é‚®æŠ¥ã€‹ä¸€ç¯‡å¤´æ¡æ–‡ç« å¦‚æ­¤æ€»ç»“ã€‚è¿™ç¯‡æ–‡ç« æŠ«éœ²äº†ä¸€é¡¹é’ˆå¯¹500ä¸‡åå·¥ä½œè€…é•¿è¾¾40å¹´çš„ç ”ç©¶ã€‚ç ”ç©¶ç»“æœæ˜¾ç¤ºï¼Œä»–ä»¬æœ€é«˜è–ªèµ„å½“ç„¶ä¸æ˜¯åœ¨ä»–ä»¬20å¤šå²æ—¶èµšå¾—çš„ï¼›ä½†ä»–ä»¬20å¤šå²æ—¶çš„å·¥ä½œç»å†ï¼Œå°†å¾ˆå¤§ç¨‹åº¦ä¸Šå†³å®šä»–ä»¬æœªæ¥çš„èµšé’±èƒ½åŠ›ã€‚ä¸ºä½•å¦‚æ­¤ï¼Ÿå› ä¸ºæœ€å¼€å§‹é‚£åå¹´çš„å·¥ä½œç»å†ï¼Œé€šå¸¸ä¼šä¸ºæˆ‘ä»¬å¡‘é€ å‡ºé™¡å³­çš„å­¦ä¹ æ›²çº¿ï¼Œè€Œè¿™æ ·çš„å­¦ä¹ æ›²çº¿ä¼šéšç€æˆ‘ä»¬é€æ¸æˆç†Ÿï¼Œè€Œå†åæ¥å½¢æˆé™¡å³­çš„èµšé’±æ›²çº¿ã€‚</p><p>è¿™æ„å‘³ç€ï¼Œæˆ–è®¸20å¤šå²æ­£æ˜¯ä½ ä¸ºå·¥ä½œè€ŒèƒŒäº•ç¦»ä¹¡çš„æ—¶å€™ï¼Œ20å¤šå²æ­£æ˜¯ä½ ä¸ºç”³è¯·è¯»ç ”ç©¶ç”Ÿè€Œç„¦å¤´çƒ‚é¢çš„æ—¶å€™ï¼Œ20å¤šå²æ­£æ˜¯ä½ ä¸ºæ¢¦æƒ³è€ŒåŠ å…¥é‚£å®¶åˆ›ä¸šå…¬å¸çš„æ—¶å€™ã€‚å³ä½¿ä½ çš„ç¬¬ä¸€ä»½å·¥ä½œæ”¶å…¥ä¸é«˜ï¼Œä½†ä½ çš„é›‡ä¸»æˆ–å¯¼å¸ˆä¹Ÿè®¸ä¼šä¸ºä½ æŠ•èµ„ï¼Œè®©ä½ å»ç§¯ç´¯æ›´å¤šçš„èº«ä»½èµ„æœ¬ï¼Œè€Œè¿™äº›å°†åœ¨æœªæ¥ä¸ºä½ å¸¦æ¥æ›´å¤§çš„å›æŠ¥ã€‚ä½ è¦çŸ¥é“ï¼Œåœ¨ä½ 30å²ä¹‹åï¼Œå®¶åº­å’Œæˆ¿å±‹è´·æ¬¾å°†ä¼šæˆä¸ºä½ ä¸å¾—ä¸è€ƒè™‘çš„å› ç´ ã€‚åˆ°äº†é‚£æ—¶ï¼Œå†æƒ³è¿½æ±‚æ›´é«˜çš„å­¦ä½æˆ–è¿›è¡Œå¤§çš„äººç”Ÿå˜åŠ¨ï¼Œå›°éš¾æŒ‡æ•°å°†æ”€å‡ã€‚ä½ çš„æ”¶å…¥å¢é•¿ä¹Ÿä¼šå¼€å§‹å‡æ…¢ã€‚20å¤šå²çš„å¹´è½»äººï¼Œæˆ–è®¸è§‰å¾—å‰é¢è¿˜æœ‰å¥½å‡ åå¹´çš„æ—¶é—´åœ¨ç­‰ç€è‡ªå·±ï¼Œé’±å¯ä»¥æ…¢æ…¢èµšï¼Œä¸ç€æ€¥ã€‚ä½†äº‹å®æ˜¯ï¼Œå¹³å‡è€Œè¨€ï¼Œæ”¶å…¥çš„é«˜å³°æœŸåŠç¨³å®šæœŸåœ¨40å¤šå²ã€‚æ‰€è°“å¥½å‡ åå¹´çš„æ—¶é—´ï¼Œå…¶å®å¹¶æ²¡æœ‰æƒ³è±¡ä¸­é‚£ä¹ˆå¤šã€‚</p><p>é‚£äº›è§‰å¾—è‡ªå·±æœ‰å¤§æŠŠæ—¶å…‰å¯ä»¥æµªè´¹ï¼Œè€Œé€‰æ‹©ä¸å°±ä¸šæˆ–è€…å°±ä¸šä¸è¶³çš„å¹´è½»äººï¼Œå°†ä¼šé”™è¿‡é‡è¦çš„å­¦ä¹ ç§¯ç´¯æœŸã€‚å°±ç®—åé¢æ­¥å…¥æ­£è½¨ï¼Œé¡ºåˆ©å¼€å§‹è‡ªå·±çš„èŒä¸šç”Ÿæ¶¯ï¼Œä»–ä»¬ä¹Ÿå¾ˆå¯èƒ½ä¼šæ°¸è¿œæ— æ³•å¼¥è¡¥è‡ªå·±å’Œå…¶ä»–äººçš„å·®è·ã€‚ä»–ä»¬åœ¨æ­¥å…¥ä¸‰å››åå²åï¼Œæˆ–è®¸æœ‰ä¸€å¤©ä¼šçªç„¶å‘ç°ï¼Œè‡ªå·±20å¤šå²æ—¶éšæ„é€‰æ‹©çš„å·¥ä½œæœ€ç»ˆè®©è‡ªå·±ä»˜å‡ºäº†æƒ¨ç—›çš„ä»£ä»·ã€‚è€Œè¿™ä¸€åˆ‡æ—©å·²æ— æ³•é‡æ–°æ¥è¿‡ã€‚ä¸æ­¤åŒæ—¶ï¼Œäººåˆ°ä¸­é—´ï¼Œé…—é…’é—®é¢˜å’Œç²¾ç¥æŠ‘éƒåˆ™å¼€å§‹ä¸Šæ¼”ã€‚</p><p>åœ¨å¦‚ä»Šçš„ç»æµç¯å¢ƒä¸‹ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰äººåœ¨30å²ä¹‹å‰éƒ½ç»å†è¿‡å°±ä¸šä¸è¶³ã€‚é‚£ä¹ˆ20å¤šå²çš„å¹´è½»äººè¯¥æ€ä¹ˆåŠï¼Ÿå¹¸è¿çš„æ˜¯ï¼Œä¸æ˜¯æ‰€æœ‰çš„å°±ä¸šä¸è¶³éƒ½é‚£ä¹ˆç³Ÿç³•ã€‚å¯¹æ­¤ï¼Œæˆ‘ä¸€ç›´ä»¥æ¥çš„å»ºè®®éƒ½æ˜¯é€‰æ‹©èº«ä»½èµ„æœ¬å«é‡æœ€é«˜çš„å·¥ä½œã€‚</p><h2 id="å¼±è¿æ¥">å¼±è¿æ¥</h2><p>æ ¹æ®æ ¼å…°è¯ºç»´ç‰¹æ‰€è¨€,å¹¶éæ‰€æœ‰çš„å…³ç³»æˆ–è¿æ¥éƒ½æ˜¯ä¸€æ ·çš„. æœ‰ä¸€äº›å¼º,æœ‰ä¸€äº›å¼±,è€Œå…³ç³»çš„å¼ºå¼±ç¨‹åº¦ä¼šéšç€æ—¶é—´å’Œç»å†çš„ç§¯ç´¯è€Œå¢é•¿. å°æ—¶å€™,å¼ºè¿æ¥æ˜¯æˆ‘ä»¬æœ€å¥½çš„æœ‹å‹å’Œå®¶äºº. 20å¤šå²æ—¶,å¼ºè¿æ¥åˆ™æ˜¯æˆ‘ä»¬çš„åŸå¸‚éƒ¨è½.</p><p>è€Œå¼±è¿æ¥,æ˜¯é‚£äº›æˆ‘ä»¬æ›¾ç»é‡è§çš„(æˆ–ä¸çŸ¥é“æ€ä¹ˆå°±è®¤è¯†çš„), ä½†ç›®å‰å¹¶ä¸æ€ä¹ˆäº†è§£çš„äºº. ä»–ä»¬æ˜¯æˆ‘ä»¬å‡ ä¹æ²¡æ€ä¹ˆè¯´è¿‡è¯çš„åŒäº‹, ä»–ä»¬æ˜¯æˆ‘ä»¬è§é¢æ—¶ä»…ä»…æ‰“å£°æ‹›å‘¼çš„é‚»å±…, ä»–ä»¬æ˜¯æˆ‘ä»¬åˆšè®¤è¯†çš„ä¸€ç›´æƒ³çº¦å´æ²¡çº¦çš„æœ‹å‹, ä»–ä»¬æ˜¯æˆ‘ä»¬å¥½å‡ å¹´éƒ½ä¸æ›¾è”ç³»çš„è€å‹, ä»–ä»¬æ˜¯æˆ‘ä»¬ä»¥å‰çš„è€æ¿æˆ–è€…è€å¸ˆ. æ¯”å¦‚, å¯¹æˆ‘æ¥è¯´,æˆ‘çš„å¼±è¿æ¥æ˜¯é‚£ä½æ›¾ç»å€Ÿæˆ‘å›¾ä¹¦ææ¡ˆçš„åŒäº‹,ä¹Ÿæ˜¯é‚£ä½ä¸å°å¿ƒå¯„æ¥ä¸€å¤§ç›’ä¹¦çš„ç¼–è¾‘. å®ƒåŒ…æ‹¬æˆ‘ä»¬è”ç³»è¿‡çš„æ‰€æœ‰äºº, ä»¥åŠè¿™äº›äººè”ç³»è¿‡çš„æ‰€æœ‰äºº. å®ƒå¯ä»¥ä½¿æ‰€æœ‰äºº, ä¸è¿‡è¦é™¤å»ç›®å‰çš„å¼ºè¿æ¥.</p><p>ä¸ºä»€ä¹ˆæœ‰çš„äººä¼šæˆä¸ºæˆ‘ä»¬çš„å¼ºè¿æ¥?100å¤šå¹´çš„ç¤¾ä¼šå­¦ç ”ç©¶ä»¥åŠæ•°åƒå¹´ä»¥æ¥çš„è¥¿æ–¹æ€æƒ³å‘Šè¯‰æˆ‘ä»¬, â€œç‰©ä»¥ç±»èš,äººä»¥ç¾¤åˆ†â€, æˆ–è€…è¯´æ˜¯å› ä¸ºæ‰€è°“çš„â€œç›¸ä¼¼æ€§åŸåˆ™â€. ä»å­¦æ ¡åˆ°å…¬å¸,æˆ‘ä»¬æ›´å®¹æ˜“å’Œä¸è‡ªå·±æœ€ä¸ºç›¸ä¼¼çš„äººå½¢æˆç´§å¯†å…³ç³».å› æ­¤, é‚£äº›æˆä¸ºæˆ‘ä»¬å¼ºè¿æ¥çš„äºº, æ¯”å¦‚åŸå¸‚éƒ¨è½,é€šå¸¸ä¼šæ˜¯å…¸å‹çš„æ’å¤–çš„åŒæ€§è´¨å°ç¾¤ä½“.</p><p>è€Œè°ˆåˆ°è¿™é‡Œ,æˆ‘ä»¬çœ‹çœ‹å¦ä¸€ä½ç¤¾ä¼šå­¦å®¶ç½—æ–¯Â·ç§‘æ³½æ‰€è¯´çš„â€œå¼ºè¿æ¥çš„å¼±ç‚¹â€,æˆ–è€…è¿™ä¸ªæ’å¤–çš„åŒè´¨æ€§å°ç¾¤ä½“å¯¹æˆ‘ä»¬çš„é™åˆ¶. è™½ç„¶åœ¨è¿™ä¸ªå°ç¾¤ä½“é‡Œ, æˆ‘ä»¬ä¼šæ„Ÿè§‰å®‰å…¨å’Œç†Ÿæ‚‰,ä½†é™¤å»è¿™äº›, ä»–ä»¬å¾€å¾€ä¹Ÿç»™ä¸äº†æˆ‘ä»¬æ›´å¤š. æ­£å› ä¸ºå°ç¾¤ä½“çš„æˆå‘˜å’Œæˆ‘ä»¬å¤ªè¿‡ç›¸ä¼¼(ç”šè‡³é¢ä¸´ç€ç›¸ä¼¼çš„å›°å¢ƒ), æ‰€ä»¥æ‰æ— æ³•ç»™äºˆå®è´¨æ€§çš„å¸®åŠ©. å…³äºå·¥ä½œå’Œçˆ±æƒ…,ä»–ä»¬çŸ¥é“çš„é€šå¸¸å¹¶ä¸æ¯”æˆ‘ä»¬å¤š. åˆæˆ–è€…è¯´,è‹¥æœ‰ä»€ä¹ˆä»–ä»¬çŸ¥é“çš„, é‚£æˆ‘ä»¬å¾ˆå¯èƒ½ä¹Ÿæ—©å°±çŸ¥é“äº†.</p><p>è€Œå¯¹äºå¼±è¿æ¥,å› ä¸ºæˆ‘ä»¬æ„Ÿè§‰ä»–ä»¬å’Œè‡ªå·±å¤ªè¿‡ä¸åŒ, æˆ–ç¦»è‡ªå·±å¤ªè¿œ, æ‰€ä»¥ä»–ä»¬æ²¡åŠæ³•æˆä¸ºæˆ‘ä»¬äº²å¯†çš„æœ‹å‹. ä½†å…³é”®ä¾¿åœ¨è¿™é‡Œ. è¿™æ°å¥½æ˜¯å¼±è¿æ¥çš„å¼ºå¤§ä¹‹å¤„. æ­£å› ä¸ºä»–ä»¬ä¸æ˜¯è‡ªå·±åœˆå­é‡Œçš„äºº, æ‰€ä»¥ä»–ä»¬å¯ä»¥è®©æˆ‘ä»¬æ¥è§¦åœˆå­ä¹‹å¤–çš„æ–°ä¸œè¥¿. æ–°çš„å·¥ä½œã€æ–°çš„ä¿¡æ¯ã€æ–°çš„å…¬å¯“ã€æ–°çš„æœºä¼šã€æ–°çš„æƒ³æ³•ç”šè‡³æ˜¯æ–°çš„çº¦ä¼šå¯¹è±¡, è¿™äº›å‡ ä¹åŸºæœ¬ä¸Šéƒ½æ¥è‡ªè‡ªå·±ç†Ÿæ‚‰çš„åœˆå­ä¹‹å¤–. å®ƒä»¬å°±åƒæ˜¯ç›’å­é‡Œçš„å·§å…‹åŠ›, ä½ æ°¸è¿œä¸çŸ¥é“ä¸‹ä¸€é¢—æ˜¯ä»€ä¹ˆå‘³é“.</p>]]></content>
      
      
      <categories>
          
          <category> è¯»ä¸‡å·ä¹¦ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WindowsPowerShellä¼˜åŒ–</title>
      <link href="/posts/7f20a787/"/>
      <url>/posts/7f20a787/</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/qq_42951560/article/details/123678786">è§£å†³è¿è¡ŒHexoæŠ¥é”™hexo : æ— æ³•åŠ è½½æ–‡ä»¶hexo.ps1ï¼Œå› ä¸ºåœ¨æ­¤ç³»ç»Ÿä¸Šç¦æ­¢è¿è¡Œè„šæœ¬</a><br><a href="https://blog.unclezs.com/pages/9b6e12">æ‰“é€ å¥½ç”¨çš„PowerShellåª²ç¾oh-my-zsh</a></p><p>Windows PowerShellä¸­gitæŸ¥çœ‹æ–‡ä»¶ä¿®æ”¹çŠ¶æ€æ—¶æ–‡ä»¶åä¸æ˜¾ç¤ºä¸­æ–‡çš„é—®é¢˜ï¼Œ<a href="">è¿™ç¯‡åšå®¢</a>ä¸­å·²ç»è®°å½•è§£å†³æ–¹æ¡ˆäº†</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å›æº¯ç®—æ³•</title>
      <link href="/posts/376d0826/"/>
      <url>/posts/376d0826/</url>
      
        <content type="html"><![CDATA[<h1>åŸºæœ¬ç†è®º</h1><ul><li>å›æº¯ç®—æ³•å’Œé€’å½’æ˜¯ç›¸è¾…ç›¸æˆçš„</li><li>å›æº¯æ³•æ˜¯ä¸€ç§çº¯æš´åŠ›çš„ç®—æ³•,å®ƒå¹¶ä¸æ˜¯é«˜æ•ˆç®—æ³•.</li><li>å›æº¯é—®é¢˜éƒ½å¯ä»¥æŠ½è±¡æˆæ ‘å½¢ç»“æ„.</li></ul><p><strong>å›æº¯æ³•å¯ä»¥è§£å†³å“ªäº›é—®é¢˜?</strong></p><ul><li>ç»„åˆé—®é¢˜: åœ¨ä¸€ç»„æ•°æ®ä¸­æ‰¾åˆ°å¤§å°ä¸º2çš„ç»„åˆ.</li><li>åˆ‡å‰²é—®é¢˜: ç»™ä¸€ä¸ªå­—ç¬¦ä¸²,æœ‰å‡ ç§åˆ‡å‰²æ–¹å¼.</li><li>å­é›†é—®é¢˜</li><li>æ’åˆ—é—®é¢˜: æ’åˆ—å¼ºè°ƒé¡ºåº,ç»„åˆä¸å¼ºè°ƒé—®é¢˜</li><li>æ£‹ç›˜é—®é¢˜: Nçš‡å</li></ul><p><strong>å›æº¯æ³•çš„æ¨¡æ¿</strong></p><ul><li>é€’å½’å‡½æ•°ä¸€èˆ¬æ²¡æœ‰è¿”å›å€¼.</li><li>é€’å½’å‡½æ•°çš„å‘½åä¸€èˆ¬å«<code>backtracking(å‚æ•°)</code></li><li>éœ€è¦æœ‰ç»ˆæ­¢æ¡ä»¶,åœ¨ç»ˆæ­¢æ¡ä»¶å†…æ”¶é›†ç»“æœ.</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">void basetracking(å‚æ•°)&#123;</span><br><span class="line">    if(ç»ˆæ­¢æ¡ä»¶)&#123;</span><br><span class="line">        æ”¶é›†ç»“æœ</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for(é›†åˆå…ƒç´ )&#123;</span><br><span class="line">        å¤„ç†èŠ‚ç‚¹;</span><br><span class="line">        é€’å½’å‡½æ•°;</span><br><span class="line">        å›æº¯æ“ä½œ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ›æ‰£22é¢˜, æ‹¬å·ç”Ÿæˆ</p><h1>ç»„åˆé—®é¢˜</h1><p><strong>å›æº¯é—®é¢˜å¯ä»¥é€šè¿‡é€’å½’çš„æ–¹å¼æ§åˆ¶forå¾ªç¯çš„åµŒå¥—å±‚æ•°</strong></p><h1>å‰ªææ“ä½œ</h1><p>for(é›†åˆå…ƒç´ ) é€šè¿‡æŸç§åˆ¤æ–­æ¡ä»¶å‡å°‘éå†æ¬¡æ•°</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åŠ¨æ€è§„åˆ’</title>
      <link href="/posts/a80d0031/"/>
      <url>/posts/a80d0031/</url>
      
        <content type="html"><![CDATA[<h1>åŠ¨æ€è§„åˆ’</h1><h2 id="åŠ¨æ€è§„åˆ’äº”æ­¥">åŠ¨æ€è§„åˆ’äº”æ­¥</h2><ul><li>DPæ•°ç»„ä»¥åŠä¸‹æ ‡çš„å«ä¹‰</li><li>é€’æ¨å…¬å¼</li><li>DPæ•°ç»„å¦‚ä½•åˆå§‹åŒ–</li><li>éå†é¡ºåº(èƒŒåŒ…é—®é¢˜ä¸­å…ˆéå†èƒŒåŒ…è¿˜æ˜¯å…ˆéå†ç‰©å“?)</li><li>æ‰“å°æ•°ç»„</li></ul><h2 id="å…¥é—¨">å…¥é—¨</h2><ul><li>çˆ¬æ¥¼æ¢¯ã€æ–æ³¢é‚£å¥‘</li><li>èƒŒåŒ…é—®é¢˜</li><li>æ‰“å®¶åŠ«èˆ</li><li>è‚¡ç¥¨é—®é¢˜</li><li>å­åºåˆ—é—®é¢˜</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®ç»“æ„â€”â€”â€”å›¾</title>
      <link href="/posts/c830c38b/"/>
      <url>/posts/c830c38b/</url>
      
        <content type="html"><![CDATA[<h1>å›¾çš„å­˜å‚¨ç»“æ„</h1><h2 id="é‚»æ¥çŸ©é˜µ">é‚»æ¥çŸ©é˜µ</h2><h2 id="é‚»æ¥é“¾è¡¨">é‚»æ¥é“¾è¡¨</h2><h2 id="æ¯”è¾ƒ">æ¯”è¾ƒ</h2><h1>å›¾çš„åŸºæœ¬æ“ä½œ</h1><p>å¢åŠ è¾¹<br>å¢åŠ èŠ‚ç‚¹</p><p>åˆ é™¤èŠ‚ç‚¹<br>åˆ é™¤è¾¹</p><h1>éå†å›¾ä¸­çš„èŠ‚ç‚¹</h1><h2 id="å¹¿åº¦éå†BFS">å¹¿åº¦éå†BFS</h2><h2 id="æ·±åº¦éå†DFS">æ·±åº¦éå†DFS</h2><h1>Dijkstraç®—æ³•</h1><h1>Floydç®—æ³•</h1>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Unity ASEæ’ä»¶é—®é¢˜è®°å½•</title>
      <link href="/posts/7552e7ac/"/>
      <url>/posts/7552e7ac/</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/liweizhao/article/details/133780486">Unityå¯è§†åŒ–Shaderå·¥å…·ASEä»‹ç»â€”â€”5ã€ASEå¿«æ·é”®å’Œå¸¸ç”¨èŠ‚ç‚¹ä»‹ç»</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>MarkDown LaTeXç¬¦å·æ•´ç†</title>
      <link href="/posts/89282b50/"/>
      <url>/posts/89282b50/</url>
      
        <content type="html"><![CDATA[<h1>æ’å…¥å…¬å¼</h1><h2 id="åœ¨æ®µè½å†…æ’å…¥">åœ¨æ®µè½å†…æ’å…¥</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™æ˜¯ä¸€æ®µæ–‡å­—,åœ¨è¿™é‡Œæ’å…¥ä¸€ä¸ªå…¬å¼: $ a = b + c $. è¿™æ®µæ–‡å­—ç»“æŸ</span><br></pre></td></tr></table></figure><h2 id="å¦èµ·ä¸€è¡Œ">å¦èµ·ä¸€è¡Œ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¿™æ˜¯ä¸€æ®µæ–‡å­—,åœ¨è¿™é‡Œæ’å…¥ä¸€ä¸ªå…¬å¼: </span><br><span class="line">$$ a = b + c $$. </span><br><span class="line">è¿™æ®µæ–‡å­—ç»“æŸ</span><br></pre></td></tr></table></figure><h2 id="å¸¸ç”¨ç¬¦å·">å¸¸ç”¨ç¬¦å·</h2><ul><li>åŠ ç²— $\mathbf{M}$ <code>\bold&#123;M&#125;</code>æˆ–è€…<code>$\mathbf&#123;M&#125;$</code></li><li>å€¾æ–œ $\mathit{M}$ <code>$\mathit&#123;M&#125;$</code></li><li>åŠ ç²—å¹¶å€¾æ–œ $\pmb{M}$ <code>\pmb&#123;M&#125;</code></li><li>å‰ä¹˜ $\times$ <code>$\times$</code></li><li>ç‚¹ä¹˜ $\cdot$  <code>$\cdot$</code></li><li>åˆ†æ•° $\frac{1}{2}$ <code>$\frac&#123;1&#125;&#123;2&#125;$</code></li><li>æ’ç­‰äº $\equiv$ <code>$\equiv$</code></li><li>ç­‰ä»·äº $\Leftrightarrow$  <code>$\iff$</code>æˆ–è€…<code>$\Leftrightarrow$</code></li><li>å³æ¨å¯¼ $\Rightarrow$ <code>$\Rightarrow$</code></li><li>å·¦æ¨å¯¼ $\Leftarrow$ <code>$\Leftarrow$</code></li><li>å‘é‡ $\vec{a}$ <code>$\vec&#123;a&#125;$</code></li><li>å•ç«–çº¿ $\vert$  <code>$\vert$</code></li><li>åŒç«–çº¿ $\Vert$ <code>$\Vert$</code></li><li>èŠ±æ‹¬å· ${ }$ <code>$\&#123; \&#125;$</code></li><li>æ–¹æ‹¬å· $[ ]$ <code>$[ ]$</code></li><li>ç´§è´´ $a!b$ <code>$a\!b$</code></li><li>æ²¡æœ‰ç©ºæ ¼ $ab$ <code>$ab$</code></li><li>å°ç©ºæ ¼ $a \space b$ <code>$a \space b$</code></li><li>quadç©ºæ ¼ $a\quad b$ <code>$a\quad b$</code></li><li>ä¸¤ä¸ªquadç©ºæ ¼ $a\qquad b$ <code>$a\qquad b$</code></li><li>çŸ©é˜µ $\mathbf{D} =\left( \begin{array}{ccc}d_1&amp;\ldots &amp; \ldots \\\ldots &amp; d_{2} &amp; \ldots \\\vdots &amp; \vdots &amp; \ddots\end{array} \right)<br>$<br><code>$\mathbf&#123;D&#125; =\left( \begin&#123;array&#125;&#123;ccc&#125;d_1&amp;\ldots &amp; \ldots \\\\\ldots &amp; d_&#123;2&#125; &amp; \ldots \\\\\vdots &amp; \vdots &amp; \ddots\end&#123;array&#125; \right) $</code></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>3Dæ•°å­¦åŸºç¡€â€”â€”ä¸‰ç»´æ—‹è½¬</title>
      <link href="/posts/b66c85b5/"/>
      <url>/posts/b66c85b5/</url>
      
        <content type="html"><![CDATA[<h1>ä¸‰ç»´æ—‹è½¬çš„è¡¨ç¤ºæ–¹å¼</h1><ul><li>çŸ©é˜µ</li><li>æ¬§æ‹‰è§’</li><li>å››å…ƒæ•°</li><li>è½´è§’</li><li>æŒ‡æ•°æ˜ å°„</li></ul><h1>çŸ©é˜µè¡¨ç¤ºæ—‹è½¬</h1><h1>æ¬§æ‹‰è§’è¡¨ç¤ºæ—‹è½¬</h1><h1>ä¸‰ç»´æ—‹è½¬è¡¨ç¤ºæ–¹å¼ä¹‹é—´çš„è½¬æ¢</h1><h2 id="çŸ©é˜µè½¬æ¬§æ‹‰">çŸ©é˜µè½¬æ¬§æ‹‰</h2><h2 id="æ¬§æ‹‰è½¬çŸ©é˜µ">æ¬§æ‹‰è½¬çŸ©é˜µ</h2><h2 id="çŸ©é˜µè½¬å››å…ƒæ•°">çŸ©é˜µè½¬å››å…ƒæ•°</h2><h2 id="å››å…ƒæ•°è½¬çŸ©é˜µ">å››å…ƒæ•°è½¬çŸ©é˜µ</h2><h2 id="æ¬§æ‹‰è½¬å››å…ƒæ•°">æ¬§æ‹‰è½¬å››å…ƒæ•°</h2><h2 id="å››å…ƒæ•°è½¬æ¬§æ‹‰">å››å…ƒæ•°è½¬æ¬§æ‹‰</h2>]]></content>
      
      
      <categories>
          
          <category> 3Dæ•°å­¦åŸºç¡€ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>3Dæ•°å­¦åŸºç¡€â€”â€”æ¦‚å¿µæ”¶é›†ä¸é—®é¢˜è®°å½•</title>
      <link href="/posts/2d9c3613/"/>
      <url>/posts/2d9c3613/</url>
      
        <content type="html"><![CDATA[<h1>æ¦‚å¿µ</h1><ul><li><p>ç§©</p></li><li><p>æ»¡ç§©</p></li><li><p>çŸ¢é‡å‰ç§¯ çŸ¢é‡å‰ç§¯åªèƒ½åœ¨ä¸‰ç»´ä¸­ä½¿ç”¨</p></li><li><p>çŸ¢é‡ç‚¹ç§¯</p></li><li><p>ä¸‰é‡ç§¯(Triple Product)</p></li><li><p>æ­£äº¤çŸ©é˜µ å½“ä¸”ä»…å½“çŸ©é˜µåŠå…¶è½¬ç½®çš„ä¹˜ç§¯æ˜¯å•ä½çŸ©é˜µæ—¶,æ–¹å½¢çŸ©é˜µMæ˜¯æ­£äº¤çš„.<br>$$ \bold{M}æ˜¯æ­£äº¤çŸ©é˜µ \iff \bold{M}\bold{M}^{T} = \bold{I} $$<br>ç”±é€†çŸ©é˜µçš„æ€§è´¨å¯çŸ¥,æ­£äº¤çŸ©é˜µçš„è½¬ç½®çŸ©é˜µå’Œé€†çŸ©é˜µæ˜¯ç­‰ä»·çš„<br>$$ \bold{M}æ˜¯æ­£äº¤çŸ©é˜µ \iff \bold{M}^{T} = \bold{M}^{-1} $$<br>è¯¥æ¡æ€§è´¨ååˆ†é‡è¦,å› ä¸ºè®¡ç®—é€†çŸ©é˜µæ˜¯ä¸€ä¸ªç›¸å¯¹æ˜‚è´µçš„æ“ä½œ,å¦‚æœå·²çŸ¥ä¸€ä¸ªçŸ©é˜µæ˜¯æ­£äº¤çš„,é‚£ä¹ˆç›´æ¥ä½¿ç”¨è½¬ç½®çŸ©é˜µå¾—åˆ°é€†çŸ©é˜µ.</p></li><li><p>è½¬ç½®çŸ©é˜µ</p></li><li><p>å­çŸ©é˜µè¡Œåˆ—å¼Minor å‡è®¾$\mathbf{M}$æ˜¯å…·æœ‰rè¡Œcåˆ—çš„çŸ©é˜µ.è€ƒè™‘é€šè¿‡ä»Mä¸­åˆ é™¤è¡Œiå’Œåˆ—jè€Œè·å¾—çš„çŸ©é˜µ.è¿™ä¸ªçŸ©é˜µæ˜¾ç„¶å…·æœ‰r-1è¡Œå’Œc-1åˆ—.è¿™ä¸ªå­çŸ©é˜µSubmatrixçš„è¡Œåˆ—å¼è¡¨ç¤ºä¸º$\mathit{M}^$,è¢«ç§°ä¸º$\mathbf{M}$çš„å­çŸ©é˜µè¡Œåˆ—å¼</p></li><li><p>ä½™å­å¼Cofactor ç»™å®šè¡Œå’Œåˆ—æ–¹å½¢çŸ©é˜µ$\mathbf{M}$çš„ä½™å­å¼ä¸ç›¸åº”çš„å­çŸ©é˜µè¡Œåˆ—å¼ç›¸åŒ,ä½†å­çŸ©é˜µè¡Œåˆ—å¼ä¼šäº¤æ›¿å˜è´Ÿ $\mathit{C}^ = (-1)^{i+j}\mathit{M}^$</p></li><li><p>ä¼´éšçŸ©é˜µ $adj\space\mathbf{M}$,ä¸¾ä¸€ä¸ªä¸‰</p></li><li><p>é€†çŸ©é˜µ $\mathbf{M}^{-1} = \frac{adj \space \mathbf{M}}{\vert \mathbf{M} \vert}$ åªæœ‰æ–¹é˜µæœ‰é€†çŸ©é˜µ,(éæ–¹é˜µä¹Ÿå­˜åœ¨å¹¿ä¹‰ä¸Šçš„é€†çŸ©é˜µä½†æ˜¯ä¸åœ¨æˆ‘ä»¬è®¨è®ºèŒƒå›´å†…)</p></li><li><p>ä»€ä¹ˆæ˜¯è¡Œåˆ—å¼? åªæœ‰æ–¹é˜µæœ‰è¡Œåˆ—å¼(éæ–¹é˜µä¹Ÿæ˜¯æœ‰è¡Œåˆ—å¼çš„,ä½†æ˜¯ä¸åœ¨æˆ‘ä»¬çš„è®¨è®ºèŒƒå›´å†…)</p></li><li><p>ä»€ä¹ˆæ˜¯é½æ¬¡çŸ©é˜µ?</p></li><li><p>ä»€ä¹ˆæ˜¯é½æ¬¡åæ ‡? å°†ä¸€ä¸ªåŸæœ¬æ˜¯nç»´çš„å‘é‡ç”¨ä¸€ä¸ªn+1ç»´çš„å‘é‡æ¥è¡¨ç¤º.</p></li><li><p>ä»€ä¹ˆæ˜¯é”™åˆ‡(Shearing)? ä¼šå¯¼è‡´åŸæœ¬è¡¨ç¤ºåæ ‡ç©ºé—´çš„äº’ç›¸å‚ç›´çš„åŸºå‘é‡ä¸å†äº’ç›¸å‚ç›´</p></li><li><p>å¥‡å¼‚(Singular)çŸ©é˜µ</p></li><li><p>éå¥‡å¼‚(Singular)çŸ©é˜µ</p></li><li><p>æ‰€æœ‰çŸ©é˜µ$\mathbf{M}$éƒ½æœ‰è½¬ç½®çŸ©é˜µ$\mathbf{M}^{T}$,ä½†æ˜¯åªæœ‰æ–¹é˜µæ‰æœ‰å¯èƒ½æœ‰é€†çŸ©é˜µ$\mathbf{M}^{-1}$</p></li><li><p>ä»€ä¹ˆæ˜¯è¶…é›†(Superset)? å¦‚æœä¸€ä¸ªé›†åˆS2ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½åœ¨é›†åˆS1ä¸­ï¼Œä¸”é›†åˆS1ä¸­å¯èƒ½åŒ…å«S2ä¸­æ²¡æœ‰çš„å…ƒç´ ï¼Œåˆ™é›†åˆS1å°±æ˜¯S2çš„ä¸€ä¸ªè¶…é›†ï¼Œåè¿‡æ¥ï¼ŒS2æ˜¯S1çš„å­é›†ã€‚ S1æ˜¯S2çš„è¶…é›†ï¼Œè‹¥S1ä¸­ä¸€å®šæœ‰S2ä¸­æ²¡æœ‰çš„å…ƒç´ ï¼Œåˆ™S1æ˜¯S2çš„çœŸè¶…é›†ï¼Œåè¿‡æ¥S2æ˜¯S1çš„çœŸå­é›†ã€‚</p></li><li><p>ä»€ä¹ˆæ˜¯çŸ©é˜µæ­£äº¤åŒ–?</p></li><li><p>å¦‚ä½•ç†è§£çŸ©é˜µä¸­çš„è‡ªç”±åº¦? æ¬§æ‹‰è§’ä¸­ä¸‡å‘é”çš„ç°è±¡è·Ÿè‡ªç”±åº¦æœ‰æ²¡æœ‰å…³ç³»?</p></li></ul><h1>å˜æ¢çš„åˆ†ç±»</h1><h2 id="çº¿æ€§å˜æ¢">çº¿æ€§å˜æ¢</h2><h3 id="æ—‹è½¬">æ—‹è½¬</h3><h3 id="ç¼©æ”¾">ç¼©æ”¾</h3><h3 id="æ­£äº¤æŠ•å½±">æ­£äº¤æŠ•å½±</h3><h3 id="åå°„">åå°„</h3><h3 id="é”™åˆ‡">é”™åˆ‡</h3><h3 id="ç»„åˆå˜æ¢">ç»„åˆå˜æ¢</h3><h2 id="æ”¾å°„å˜æ¢">æ”¾å°„å˜æ¢</h2><h2 id="å¯é€†å˜æ¢">å¯é€†å˜æ¢</h2><h2 id="ä¿æŒè§’åº¦çš„å˜æ¢">ä¿æŒè§’åº¦çš„å˜æ¢</h2><h2 id="åˆšä½“å˜æ¢">åˆšä½“å˜æ¢</h2><h1>çŸ©é˜µæ€§è´¨</h1><h2 id="é€†çŸ©é˜µ">é€†çŸ©é˜µ</h2>]]></content>
      
      
      <categories>
          
          <category> 3Dæ•°å­¦åŸºç¡€ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>3Dæ•°å­¦åŸºç¡€â€”â€”çŸ©é˜µ</title>
      <link href="/posts/28fc275d/"/>
      <url>/posts/28fc275d/</url>
      
        <content type="html"><![CDATA[<h1>æ—‹è½¬</h1><h2 id="åœ¨äºŒç»´ä¸­çš„æ—‹è½¬">åœ¨äºŒç»´ä¸­çš„æ—‹è½¬</h2><h2 id="å›´ç»•ä¸»è½´çš„ä¸‰ç»´æ—‹è½¬">å›´ç»•ä¸»è½´çš„ä¸‰ç»´æ—‹è½¬</h2><h2 id="å›´ç»•ä»»æ„è½´çš„ä¸‰ç»´æ—‹è½¬">å›´ç»•ä»»æ„è½´çš„ä¸‰ç»´æ—‹è½¬</h2>]]></content>
      
      
      <categories>
          
          <category> 3Dæ•°å­¦åŸºç¡€ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Wesnoth</title>
      <link href="/posts/d1d5504/"/>
      <url>/posts/d1d5504/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.wesnoth.org/">Wesnothç¤¾åŒº</a><br><a href="https://github.com/wesnoth/wesnoth">ä»“åº“åœ°å€</a><br><a href="https://discord.com/channels/231976805987385345/channel-browser">WesnothDiscordé¢‘é“</a></p><h1>ç›®å½•</h1><ul><li>æ„å»ºWesnoth ä¹Ÿå°±æ˜¯è¿™ç¯‡åšå®¢</li><li><a href="https://soincredible.github.io/posts/9af50f63/">Wesnothä¸­çš„å°åœ°å›¾å¦‚ä½•å®ç°</a></li><li>Wesnothä¸­çš„AI</li><li>Wesnothä¸­çš„å¼•å¯¼é€»è¾‘</li><li>Wesnothä¸­çš„æˆ˜å½¹é€»è¾‘</li></ul><blockquote><p>2025.2.25æ›´æ–°<br>ç¬”è€…åƒå°ä¸‘ä¸€æ · å°è¯•ç”¨Linuxä¸­çš„æ„å»ºæ–¹å¼åœ¨è‡ªå·±çš„Macä¸Šæ„å»ºwesnoth ä¸€ç›´æ— æ³•æˆåŠŸBuild è·Ÿå„ç§é—®é¢˜ç¼ æ–—äº†è¿‘ä¸€ä¸ªæœˆ åœ¨è¿›è¡Œæ”¾å¼ƒå‰çš„æœ€åä¸€æ¬¡å°è¯•æ—¶ å†³å®šå°è¯•ä¸€ä¸‹Buildæ–‡æ¡£ä¸­MacOSå°ç»“æåˆ°çš„ä½¿ç”¨XCodeBuildçš„æ–¹å¼æ„å»ºwesnoth ä¸åˆ°ååˆ†é’ŸæˆåŠŸäº†â€¦<br>åœ¨ç¬”è€…è¿‡å¾€çš„ç»å†ä¸­ Macå’ŒLinuxä¸­æ„å»ºå’Œè¿è¡ŒC++ç¨‹åºçš„æ–¹å¼æ˜¯ä¸€æ ·çš„ å¹¶ä¸”ç¬”è€…å…ˆå…¥ä¸ºä¸»åœ°ä»¥ä¸ºä½¿ç”¨XCodeæ˜¯åœ¨Macä¸Šè¦å‘å¸ƒåˆ°AppStoreã€Steamæˆ–è€…SourceForgeå¹³å°éƒ¨åˆ†æ‰ä¼šä½¿ç”¨åˆ°çš„ å¹¶ä¸æ˜¯ç¬”è€…ç›®å‰éœ€è¦Careçš„ ç¬”è€…åªéœ€è¦è®©wesnothçš„codeåœ¨è‡ªå·±çš„ç”µè„‘ä¸Šè·‘èµ·æ¥å°±å¯ä»¥ åªèƒ½è¯´ç›¸å½“æ“è›‹â€¦<br>è™½ç„¶è¯´åœ¨Macç»ˆç«¯ä¸‹ç›´æ¥ä½¿ç”¨CMakeå‘½ä»¤æ¥å°è¯•æ„å»ºwesnothçš„æ–¹å¼æ˜¯é”™è¯¯çš„,ä½†æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ç¬”è€…äº†è§£äº†ä¸€äº›CMakeã€C++æ„å»ºç›¸å…³çš„çŸ¥è¯† æœ¬ç¯‡åšå®¢ä¾¿æ˜¯å¯¹è¿™äº›çŸ¥è¯†çš„æ€»ç»“æ•´ç†</p></blockquote><h1>Macä¸­æ­£ç¡®çš„æ„å»ºWesnothæ–¹å¼</h1><p>æ—¢ç„¶Buildçš„æ—¶å€™ç”¨åˆ°äº†<code>XCode</code>,é‚£ä¹ˆç¬”è€…å°±èˆå¼ƒ<code>VSCode</code>ç›´æ¥ä½¿ç”¨<code>XCode</code>å¼€å‘äº†.</p><ul><li>é¦–å…ˆç¡®ä¿wesnothä¸­éœ€è¦çš„æ‰€æœ‰ä¾èµ–éƒ½å·²ç»å®‰è£…å¥½,æ‰€æœ‰çš„ä¾èµ–éƒ½å¯ä»¥ä½¿ç”¨<code>homebrew</code>å¿«é€Ÿå®‰è£…</li><li>å‡†å¤‡ä¸€ä¸ª<a href="https://developer.apple.com/">Appleå¼€å‘è€…è´¦å·</a> ä¸éœ€è¦<code>enroll app store</code>å¦‚æœä½ åªæ˜¯å¸Œæœ›åœ¨è‡ªå·±çš„ç”µè„‘ä¸Šbuildå’Œè¿è¡Œwesnoth</li><li>æ ¹ç›®å½•ä¸‹æ‰§è¡Œ<code>scons translations</code>(çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªæ‰§è¡Œç¿»è¯‘çš„å‘½ä»¤ æ‰§è¡Œä¸€æ¬¡å°±å¥½)</li><li>æ‰§è¡ŒæˆåŠŸå,æ‰¾åˆ°é¡¹ç›®ä¸­çš„<code>projectfiles/Xcode/The Battle for Wesnoth.xcodeproj</code>,æ‰“å¼€XCode</li><li>åœ¨XCodeçš„èœå•æ ä¸­,æ‰¾åˆ°<code>Product</code>-&gt;<code>Archive</code>,XCodeå°±å¼€å§‹æ„å»ºwesnothäº†</li><li>XCodeæ„å»ºæˆåŠŸä¹‹å,åº”è¯¥ä¼šè‡ªåŠ¨å¼¹å‡º<code>Organizer</code>çª—å£,åœ¨çª—å£ä¸­é€‰æ‹©<code>DistributeApp</code></li></ul><img src="/posts/d1d5504/image.png" class=""><p>é€‰æ‹©<code>Custom</code></p><img src="/posts/d1d5504/image-1.png" class=""><p>é€‰æ‹©<code>Copy App</code></p><img src="/posts/d1d5504/image-3.png" class=""><p>æœ€åé€‰æ‹©å¯¼å‡ºä½ç½®,å®ŒæˆWesnothçš„build.</p><h1>Macä¸­çš„ç¯å¢ƒå˜é‡</h1><p>ç¬”è€…åœ¨æŒ‰ç…§<a href="https://github.com/wesnoth/wesnoth/blob/master/INSTALL.md">INSTALL</a>éƒ¨åˆ†åœ¨M1ç³»åˆ—èŠ¯ç‰‡çš„Macä¸Šä½¿ç”¨homebrewå®‰è£…å¥½äº†wesnothä¾èµ–çš„æ‰€æœ‰lib, ä½†æ˜¯é€šè¿‡CMake buildçš„æ—¶å€™å´è¿˜æ˜¯æç¤ºæœ‰è¿™æ ·é‚£æ ·çš„libæœªæ‰¾åˆ°ã€è¿™æ ·é‚£æ ·çš„å¤´æ–‡ä»¶æ²¡æœ‰æ‰¾åˆ°.** ç¬”è€…å¹¶ä¸æ¸…æ¥šä¸­é—´æ˜¯ä»€ä¹ˆç¯èŠ‚å‡ºäº†é—®é¢˜, åœ¨æ­¤å…ˆè¿›è¡Œè®°å½•, æ—¥åè‹¥æœ‰æ€è·¯å†å›æ¥è¡¥å……**.</p><p>é¦–å…ˆ, ç¬”è€…çš„å‡è®¾æ˜¯, å®˜æ–¹ç¼–å†™çš„CMakeæ„å»ºè„šæœ¬æ˜¯æ²¡æœ‰é—®é¢˜çš„, é—®é¢˜å‡ºåœ¨äº†ç¬”è€…çš„ç¯å¢ƒé…ç½®ä¸Š, åœ¨å®‰è£…å®Œwesnothéœ€è¦çš„åº“ä¹‹å,éœ€è¦åœ¨ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export LIBRARY_PATH=/opt/homebrew/Cellar/boost/1.87.0/lib:/opt/homebrew/lib:$LIBRARY_PATH</span><br><span class="line">export CPATH=/opt/homebrew/include/harfbuzz:/opt/homebrew/Cellar/boost/1.87.0/include/boost:$CPATH     </span><br><span class="line">```                </span><br><span class="line"># Undefined symbols for architecture arm64</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Undefined symbols for architecture arm64:<br>â€œHello()â€, referenced from:<br>_main in test_charconv.cpp.o<br>ld: symbol(s) not found for architecture arm64<br>c++: error: linker command failed with exit code 1 (use -v to see invocation)<br>make[2]: *** [test_charconv] Error 1<br>make[1]: *** [CMakeFiles/test_charconv.dir/all] Error 2<br>make: *** [all] Error 2</p><pre><code>å‡ºç°å¦‚ä¸‹æŠ¥é”™çš„åŸå› : æ–¹æ³•åªæœ‰å£°æ˜ ä½†æ˜¯æ²¡å®šä¹‰ äºæ˜¯åœ¨é“¾æ¥é˜¶æ®µçš„æ—¶å€™ ç¼–è¯‘å™¨æ‰¾ä¸åˆ°æ–¹æ³•çš„å…·ä½“å®ç°è€ŒæŠ¥é”™. æœ‰å¯èƒ½æ˜¯ä½ åœ¨å¤´æ–‡ä»¶ä¸­å®šä¹‰çš„æ–¹æ³•åå’Œåœ¨cppæ–‡ä»¶ä¸­çš„å…·ä½“å®ç°åä¸ä¸€æ ·.# C++ä¸­çš„.oæ–‡ä»¶https://www.cnblogs.com/eyeofbajie/p/16303580.html# CMakeä¸­å¸¸ç”¨çš„æ–¹æ³•CMakeä¸­æ‰§è¡Œè¡¨ç¤ºæ‰§è¡Œç¼–è¯‘çš„æ–¹æ³•æ˜¯ä»€ä¹ˆ?åˆ«çš„CMakeæ–¹æ³•å…ˆä¸ç®¡,ç¬”è€…æ¯”è¾ƒå…³å¿ƒfind_packageæ–¹æ³•èƒŒåçš„å®ç°åŸç†https://stackoverflow.com/questions/75536743/how-to-fix-undefined-symbols-for-arm64-when-using-boostfilesystem-on-m1-macboo</code></pre>]]></content>
      
      
      <categories>
          
          <category> Wesnoth </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Balatro</title>
      <link href="/posts/254a2567/"/>
      <url>/posts/254a2567/</url>
      
        <content type="html"><![CDATA[<p>å°ä¸‘ç‰Œä½¿ç”¨love2dæ¸¸æˆå¼•æ“å¼€å‘,å¼€å‘è¯­è¨€æ˜¯lua.ç¬”è€…ä¹‹å‰ä»æœªæ¥è§¦è¿‡lua,åœ¨ä¸Šæ‰‹é˜…è¯»å‰è¿˜æ˜¯æœ‰ä¸€äº›å¼€å‘è¯­è¨€ä¸Šçš„è¯­æ³•éšœç¢éœ€è¦å…‹æœä¸€ä¸‹.çœ‹èµ·æ¥å°ä¸‘ç‰Œåº•å±‚ä½¿ç”¨åˆ°äº†ä¸€ä¸ªåå«<code>SNKRX</code>æ¸¸æˆçš„åº•å±‚æ¡†æ¶.</p><h1>ç¯å¢ƒå®‰è£…</h1><ul><li><a href="https://love2d.org/wiki/Main_Page">love2dæ¸¸æˆå¼•æ“åœ°å€</a></li><li><a href="https://www.lua.org/">luaåœ°å€</a></li></ul><h1>è¿è¡Œæ¸¸æˆ</h1><p>é¦–å…ˆåœ¨<code>~/.zshrc</code>ä¸­æ·»åŠ ä»¥ä¸‹æ–‡æœ¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># alias to love</span><br><span class="line">alias love=&quot;/Applications/love.app/Contents/MacOS/love&quot;</span><br></pre></td></tr></table></figure><p>é€€å‡º<code>zshrc</code>,æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.zshrc</span><br></pre></td></tr></table></figure><p>æ¥åˆ°å°ä¸‘ç‰Œçš„æ ¹ç›®å½•,æ‰§è¡Œ:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">love .</span><br></pre></td></tr></table></figure><h1>ç¨‹åºå…¥å£</h1><p>æ‹¿åˆ°å°ä¸‘ç‰Œæºç ,ç¨‹åºçš„å…¥å£åœ¨<code>main.lua</code>ä¸­,é¦–å…ˆçœ‹åˆ°çš„æ˜¯ä¸€ä¸²<code>require</code>è¯­å¥,è¯¥è¯­å¥åé¢è·Ÿçš„å†…å®¹å°±æ˜¯è„šæœ¬çš„è·¯å¾„,ä¸”ä¼šæ‰§è¡Œè¯¥è·¯å¾„ä¸‹çš„è„šæœ¬.å°±æ‹¿<code>game.lua</code>è„šæœ¬ä¸­çš„<code>Game</code>ç±»ä¸¾ä¾‹,é¦–å…ˆæ˜¯<code>main.lua</code>çš„requireè¯­å¥ä¸­è¯·æ±‚æ¨¡å—<code>globals</code>,luaæ‰¾åˆ°å¹¶æ‰§è¡Œ<code>globals.lua</code>è„šæœ¬,åœ¨è¯¥è„šæœ¬ä¸­åˆ›å»ºäº†ä¸€ä¸ª<code>Game</code>å¯¹è±¡,åœ¨<code>Game</code>å¯¹è±¡çš„æ„é€ æ–¹æ³•ä¸­åˆ›å»ºäº†ä¸€ä¸ªGameçš„å•ä¾‹.æ‰§è¡Œå®Œ<code>require &quot;globals&quot;</code>ä¹‹å,<code>Game</code>ç±»çš„å•ä¾‹å°±å·²ç»è¢«åˆ›å»ºå‡ºæ¥äº†,å¹¶å¯ä»¥è¢«å…¨å±€è°ƒç”¨.</p><h1>æ›´æ–°é€»è¾‘</h1><p>æ¸¸æˆçš„updateé€»è¾‘åœ¨<code>game.lua</code>è„šæœ¬çš„<code>function Game:update(dt)</code>ä¸­.<br>åœ¨<code>globals.lua</code>ä¸­,å¯ä»¥çœ‹åˆ°æ¸¸æˆçŠ¶æ€æœºä¸­çš„çŠ¶æ€:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">self.STATES = &#123;</span><br><span class="line">        SELECTING_HAND = 1,</span><br><span class="line">        HAND_PLAYED = 2,</span><br><span class="line">        DRAW_TO_HAND = 3,</span><br><span class="line">        GAME_OVER = 4,</span><br><span class="line">        SHOP = 5,</span><br><span class="line">        PLAY_TAROT = 6,</span><br><span class="line">        BLIND_SELECT = 7,</span><br><span class="line">        ROUND_EVAL = 8,</span><br><span class="line">        TAROT_PACK = 9,</span><br><span class="line">        PLANET_PACK = 10,</span><br><span class="line">        MENU = 11,</span><br><span class="line">        TUTORIAL = 12,</span><br><span class="line">        SPLASH = 13,--DO NOT CHANGE, this has a dependency in the SOUND_MANAGER</span><br><span class="line">        SANDBOX = 14,</span><br><span class="line">        SPECTRAL_PACK = 15,</span><br><span class="line">        DEMO_CTA = 16,</span><br><span class="line">        STANDARD_PACK = 17,</span><br><span class="line">        BUFFOON_PACK = 18,</span><br><span class="line">        NEW_ROUND = 19,</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1>é…ç½®</h1><p>å°ä¸‘ç‰Œçš„é…ç½®åœ¨<code>functions/misc_functions.lua</code>è„šæœ¬ä¸­,åœ¨è¿™é‡Œä½ å¯ä»¥ä¿®æ”¹æ¸¸æˆçš„åˆå§‹å‚æ•°,æ¯”å¦‚åˆå§‹é‡‘å¸ã€æ‰‹ç‰Œä¸Šé™ã€å°ä¸‘ç‰Œæ ä½ä¸Šé™ç­‰ç­‰.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function get_starting_params()</span><br><span class="line">return &#123;</span><br><span class="line">    dollars = 100,</span><br><span class="line">    hand_size = 15,</span><br><span class="line">    discards = 3,</span><br><span class="line">    hands = 4,</span><br><span class="line">    reroll_cost = 5,</span><br><span class="line">    joker_slots = 7,</span><br><span class="line">    ante_scaling = 1,</span><br><span class="line">    consumable_slots = 2,</span><br><span class="line">    no_faces = false,</span><br><span class="line">    erratic_suits_and_ranks = false,</span><br><span class="line">  &#125;</span><br><span class="line">end</span><br></pre></td></tr></table></figure><h1>äº¤äº’</h1><p>ä¸»ç•Œé¢çš„ç»˜åˆ¶åœ¨<code>UI_definitions.lua</code>è„šæœ¬ä¸­,åœ¨å°ä¸‘ç‰Œä¸­é¡µé¢çš„æ‹¼æ¥ç”¨çš„æ˜¯ç±»ä¼¼jsonä¸€æ ·çš„åµŒå¥—ç»“æ„æ¥æè¿°UIçš„ä¿¡æ¯,é‡ç‚¹å…³æ³¨<code>UIBox_button</code>çš„buttonå‚æ•°,è¯¥å‚æ•°æŒ‡æ˜è¯¥æŒ‰é’®å’Œå…¶ç›¸åº”ç‚¹å‡»çš„äº‹ä»¶.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">function create_UIBox_main_menu_buttons()</span><br><span class="line">  local text_scale = 0.45</span><br><span class="line">  local language = nil</span><br><span class="line">  if not G.F_ENGLISH_ONLY then </span><br><span class="line">    language = Sprite(0,0,0.6,0.6,G.ASSET_ATLAS[&quot;icons&quot;], &#123;x=2, y=0&#125;)</span><br><span class="line">    language.states.drag.can = false</span><br><span class="line">  end</span><br><span class="line">  local discord = nil</span><br><span class="line">  local twitter = nil</span><br><span class="line">  if G.F_DISCORD then </span><br><span class="line">    discord = Sprite(0,0,0.6,0.6,G.ASSET_ATLAS[&quot;icons&quot;], &#123;x=0, y=0&#125;)</span><br><span class="line">    discord.states.drag.can = false</span><br><span class="line">    twitter = Sprite(0,0,0.6,0.6,G.ASSET_ATLAS[&quot;icons&quot;], &#123;x=0, y=1&#125;)</span><br><span class="line">    twitter.states.drag.can = false</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  local quit_func = &#x27;quit&#x27;</span><br><span class="line"></span><br><span class="line">  local t = &#123;</span><br><span class="line">    n=G.UIT.ROOT, config = &#123;align = &quot;cm&quot;,colour = G.C.CLEAR&#125;, nodes=&#123; </span><br><span class="line">      &#123;n=G.UIT.C, config=&#123;align = &quot;bm&quot;&#125;, nodes=&#123;      </span><br><span class="line">                    &#123;</span><br><span class="line">                        n = G.UIT.R,</span><br><span class="line">                        config = &#123; align = &quot;cm&quot;, padding = 0.2, r = 0.1, emboss = 0.1, colour = G.C.L_BLACK, mid = true &#125;,</span><br><span class="line">                        nodes = &#123;</span><br><span class="line">          -- å¦‚æœæ²¡æœ‰å®Œæˆæ•™ç¨‹,è¿”å›start_run å¦‚æœå®Œæˆæ•™ç¨‹è¿”å›setup_run</span><br><span class="line">          UIBox_button&#123;id = &#x27;main_menu_play&#x27;, button = not G.SETTINGS.tutorial_complete and &quot;start_run&quot; or &quot;setup_run&quot;, colour = G.C.BLUE, minw = 3.65, minh = 1.55, label = &#123;localize(&#x27;b_play_cap&#x27;)&#125;, scale = text_scale*2, col = true&#125;,</span><br><span class="line">          &#123;n=G.UIT.C, config=&#123;align = &quot;cm&quot;&#125;, nodes=&#123;</span><br><span class="line">            UIBox_button&#123;button = &#x27;options&#x27;, colour = G.C.ORANGE, minw = 2.65, minh = 1.35, label = &#123;localize(&#x27;b_options_cap&#x27;)&#125;, scale = text_scale * 1.2, col = true&#125;,</span><br><span class="line">            G.F_QUIT_BUTTON and &#123;n=G.UIT.C, config=&#123;align = &quot;cm&quot;, minw = 0.2&#125;, nodes=&#123;&#125;&#125; or nil,</span><br><span class="line">            G.F_QUIT_BUTTON and UIBox_button&#123;button = quit_func, colour = G.C.RED, minw = 2.65, minh = 1.35, label = &#123;localize(&#x27;b_quit_cap&#x27;)&#125;, scale = text_scale * 1.2, col = true&#125; or nil,</span><br><span class="line">          &#125;&#125;,</span><br><span class="line">          UIBox_button&#123;id = &#x27;collection_button&#x27;, button = &quot;your_collection&quot;, colour = G.C.PALE_GREEN, minw = 3.65, minh = 1.55, label = &#123;localize(&#x27;b_collection_cap&#x27;)&#125;, scale = text_scale*1.5, col = true&#125;,</span><br><span class="line">        &#125;&#125;,</span><br><span class="line">      &#125;&#125;,</span><br><span class="line">      &#123;n=G.UIT.C, config=&#123;align = &quot;br&quot;, minw = 3.2, padding = 0.1&#125;, nodes=&#123;</span><br><span class="line">        G.F_DISCORD and &#123;n=G.UIT.R, config = &#123;align = &quot;cm&quot;, padding = 0.2&#125;, nodes=&#123;</span><br><span class="line">          &#123;n=G.UIT.C, config=&#123;align = &quot;cm&quot;, padding = 0.1, r = 0.1, hover = true, colour = mix_colours(G.C.BLUE, G.C.GREY, 0.4), button = &#x27;go_to_discord&#x27;, shadow = true&#125;, nodes=&#123;</span><br><span class="line">            &#123;n=G.UIT.O, config=&#123;object = discord&#125;&#125;,</span><br><span class="line">          &#125;&#125;,</span><br><span class="line">          &#123;n=G.UIT.C, config=&#123;align = &quot;cm&quot;, padding = 0.1, r = 0.1, hover = true, colour = G.C.BLACK, button = &#x27;go_to_twitter&#x27;, shadow = true&#125;, nodes=&#123;</span><br><span class="line">            &#123;n=G.UIT.O, config=&#123;object = twitter&#125;&#125;,</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        &#125;&#125; or nil,</span><br><span class="line">        not G.F_ENGLISH_ONLY and &#123;n=G.UIT.R, config = &#123;align = &quot;cm&quot;, padding = 0.2, r = 0.1, emboss = 0.1, colour = G.C.L_BLACK&#125;, nodes=&#123;</span><br><span class="line">          &#123;n=G.UIT.R, config=&#123;align = &quot;cm&quot;, padding = 0.15, minw = 1, r = 0.1, hover = true, colour = mix_colours(G.C.WHITE, G.C.GREY, 0.2), button = &#x27;language_selection&#x27;, shadow = true&#125;, nodes=&#123;</span><br><span class="line">            &#123;n=G.UIT.O, config=&#123;object = language&#125;&#125;,</span><br><span class="line">            &#123;n=G.UIT.T, config=&#123;text = G.LANG.label, scale = 0.4, colour = G.C.UI.TEXT_LIGHT, shadow = true&#125;&#125;</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        &#125;&#125; or nil,</span><br><span class="line">      &#125;&#125;,</span><br><span class="line">    &#125;&#125;</span><br><span class="line">  return t</span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>æ‹¿ä¸»ç•Œé¢ä¸Šçš„quitæŒ‰é’®ä¸¾ä¾‹,<code>quit_func</code>å°±æ˜¯æŒ‡å‘äº†ä¸€ä¸ªå†…å®¹ä¸º<code>quit</code>çš„å­—ç¬¦ä¸²,ä¸è¿‡å…¶å®é™…ä¸ŠæŒ‡å‘çš„æ˜¯<code>main.lua</code>è„šæœ¬ä¸­çš„<code>love.quit()</code>æ–¹æ³•,ç›®å‰æš‚ä¸æ¸…æ¥šç©¶ç«Ÿæ˜¯å¦‚ä½•å…³è”èµ·æ¥çš„.</p><p>çœŸæ­£è¿›å…¥æ¸¸æˆçš„æ˜¯é€šè¿‡<code>start_setup_run</code>æ–¹æ³•,ç„¶åä¼šè¿›å…¥<code>BlindSelect(ç›²æ³¨)é˜¶æ®µ</code>-&gt;<code>New Round</code>-&gt;<code>DrawToHand</code></p><h1>æ´—ç‰Œç®—æ³•</h1><p>åœ¨<code>state_events.lua</code>è„šæœ¬ä¸­<code>new round</code>æ–¹æ³•å†…<code>G.deck:shuffle('nr'..G.GAME.round_resets.ante)</code>è¿™ä¸€è¡Œ.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">G.E_MANAGER:add_event(Event(&#123;</span><br><span class="line">  trigger = &#x27;immediate&#x27;,</span><br><span class="line">  func = function()</span><br><span class="line">      print(&quot;è¿›å…¥DrawToHandé˜¶æ®µ&quot;)</span><br><span class="line">      G.STATE = G.STATES.DRAW_TO_HAND</span><br><span class="line">      -- åœ¨æ­¤å¤„æ‰§è¡Œæ´—ç‰Œæ“ä½œ</span><br><span class="line">      G.deck:shuffle(&#x27;nr&#x27;..G.GAME.round_resets.ante)</span><br><span class="line">      G.deck:hard_set_T()</span><br><span class="line">      G.STATE_COMPLETE = false</span><br><span class="line">      return true</span><br><span class="line">  end</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><p>æ´—ç‰Œç®—æ³•çš„å…·ä½“å®ç°åœ¨<code>cardarea.lua</code>ä¸­.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function CardArea:shuffle(_seed)</span><br><span class="line">    pseudoshuffle(self.cards, pseudoseed(_seed or &#x27;shuffle&#x27;))</span><br><span class="line">    self:set_ranks()</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">function pseudoshuffle(list, seed)</span><br><span class="line">  if seed then math.randomseed(seed) end</span><br><span class="line"></span><br><span class="line">  if list[1] and list[1].sort_id then</span><br><span class="line">    table.sort(list, function (a, b) return (a.sort_id or 1) &lt; (b.sort_id or 2) end)</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  for i = #list, 2, -1 do</span><br><span class="line">local j = math.random(i)</span><br><span class="line">list[i], list[j] = list[j], list[i]</span><br><span class="line">end</span><br><span class="line">end</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¯¥ç®—æ³•åä¸º<code>Fisherâ€“Yates shuffle æ´—ç‰Œç®—æ³•</code>,ç®—æ³•çš„åŸºæœ¬æ€æƒ³å¦‚ä¸‹:</p><ol><li>ç»™å®šä¸€ä¸ªå«æœ‰nä¸ªæ•°çš„åºåˆ—,æ ‡è®°indexä¸º1-n</li><li>ä»1-nä¸­éšæœºä¸€ä¸ªæ•°k</li><li>æ‰¾åˆ°indexä¸ºkçš„æ•°å­—,å°†å…¶ä¸è¯¥åºåˆ—çš„æœ€åä¸€ä½è¿›è¡Œäº¤æ¢.æ¥ä¸‹æ¥ä¼šä»(1 - n-1)èŒƒå›´å†…å¯»æ‰¾æ–°çš„éšæœºæ•°k,ä¸åºåˆ—çš„å€’æ•°ç¬¬äºŒä½è¿›è¡Œäº¤æ¢.</li><li>é‡å¤æ­¥éª¤2ã€3ç›´åˆ°æ‰€æœ‰çš„æ•°éƒ½è¢«å–å®Œ.</li></ol><h1>æœºåˆ¶</h1><h1>å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://gaohaoyang.github.io/2016/10/16/shuffle-algorithm/">https://gaohaoyang.github.io/2016/10/16/shuffle-algorithm/</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨Blenderä¸­å¯¼å‡ºä¸€ä¸ªå¯ä»¥è¢«Unityä½¿ç”¨çš„åœ†</title>
      <link href="/posts/4e0dbdc7/"/>
      <url>/posts/4e0dbdc7/</url>
      
        <content type="html"><![CDATA[<p>èµ·å› æ˜¯2025GGJçš„ä¸»é¢˜æ˜¯Bubble,æƒ³åœ¨Unityä¸­åšä¸€ä¸ªå¹æ³¡æ³¡çš„æ¸¸æˆ,éœ€è¦ç”¨ä¸€ä¸ªåœ†æ¥è¡¨ç°æ³¡æ³¡æ³¢åŠ¨çš„çŠ¶æ€.é‚æ‰“å¼€Blenderå‡†å¤‡å¯¼å‡ºä¸€ä¸ªåœ†ç‰‡åˆ°Unityä¸­.æœ¬æ–‡è®°å½•ä¸ºäº†å¯¼å‡ºä¸€ä¸ªèƒ½åœ¨Unityä¸­æ­£ç¡®ä½¿ç”¨çš„åœ†,ç”¨åˆ°çš„Blenderä¸­çš„åŠŸèƒ½å’ŒæŠ€å·§.</p><h1>Blenderä¸­çš„åæ ‡ç³»</h1><p>Blenderä¸­çš„åæ ‡ç³»æ˜¯å³æ‰‹åæ ‡ç³»,Unityä¸­çš„åæ ‡ç³»æ˜¯å·¦æ‰‹åæ ‡ç³»,åˆ¤æ–­å·¦å³æ‰‹åæ ‡ç³»é€šè¿‡æ‰‹æ€§åˆ¤æ–­:</p><img src="/posts/4e0dbdc7/image-1.png" class=""><p>å¯ä»¥çœ‹ä¸‹é¢ä¸¤å¼ å›¾,å±•ç¤ºäº†åŒä¸€ä¸ªæ¨¡å‹åœ¨Unityå’ŒBlenderä¸­åæ ‡è½´çš„å…³ç³»,ä¸¤ç§åæ ‡ç³»ä¸‹xè½´çš„æ­£æ–¹å‘åè¿‡æ¥äº†,å…¶ä»–ä¸¤ä¸ªè½´åœ¨ä¹‹åxè½´æ–¹å‘ç¿»è½¬çš„æƒ…å†µä¸‹æ˜¯ä¸€è‡´çš„.ä¸¤ä¸ªå›¾ä¸­çš„åæ ‡ç³»éƒ½æ˜¯Localåæ ‡ç³».</p><img src="/posts/4e0dbdc7/image.png" class=""><img src="/posts/4e0dbdc7/image-1.png" class=""><h1>Blenderä¸­å¸¸ç”¨çš„å¿«æ·é”®</h1><p><code>Shift + A</code> åœ¨åœºæ™¯ä¸­å¿«é€Ÿæ·»åŠ ä¸€äº›ç»„ä»¶<br><code>Shift + Z</code> åˆ‡æ¢Viewportç±»å‹ æ¯”å¦‚æ˜¯çº¿æ¡†ã€ç€è‰²ç­‰<br><code>é¼ æ ‡å³é”®</code> å–æ¶ˆä¹‹å‰è§¦å‘çš„å‘½ä»¤<br><code>G</code> ç§»åŠ¨é€‰ä¸­çš„ç‰©ä½“</p><h1>åœ¨Blenderä¸­åˆ¶ä½œä¸€ä¸ªåœ†å½¢çš„å®å¿ƒå¹³é¢</h1><p>Shift + A åˆ›å»ºä¸€ä¸ªCircleçš„Mesh,è¿™æ˜¯å‘ç°å³ä¾¿æ˜¯åœ¨ç€è‰²è§†å£ä¸‹,Circleä»ç„¶åªæœ‰ä¸€ä¸ªçº¿æ¡†,è¿™æ˜¯å› ä¸ºè¿™äº›é¡¶ç‚¹æ²¡æœ‰æ„æˆä¸€ä¸ªä¸ªçš„ä¸‰è§’å½¢,éœ€è¦è®¾ç½®è¿™ä¸ªCircleçš„å¡«å……å±æ€§,å½“ä½ åˆ›å»ºå‡ºæ¥ä¸€ä¸ªCircleä¹‹å,ä¸è¦ä¹±åŠ¨,ä½ ä¼šå‘ç°å·¦ä¸‹è§’æœ‰ä¸€ä¸ªAddCircleçš„å°Widget,ç‚¹å‡»è¿™ä¸ªç»„ä»¶æˆ–è€…æŒ‰é”®ç›˜<code>F9</code>ä¼šå±•å¼€å¼¹çª—,åœ¨å¼¹çª—ä¸­ä¿®æ”¹FillTypeä¸ºTriangleFan,å¦å¤–ä½ ä¹Ÿå¯ä»¥è°ƒæ•´åˆ›å»ºå‡ºæ¥çš„åœ†ç‰‡çš„é¡¶ç‚¹æ•°å’ŒåŠå¾„</p><img src="/posts/4e0dbdc7/image-5.png" class=""><h1>æ›´æ”¹æ¨¡å‹çš„è½´å‘</h1><p>ç¬”è€…å·²ç»åœ¨Unityä¸­æ­å»ºå¥½äº†ä¸€ä¸ªæ‘„åƒæœºæœå‘ä¸ºyè½´è´Ÿæ–¹å‘çš„æ¸¸æˆåœºæ™¯,æ‰€ä»¥è¦åœ¨Blenderé‡Œé¢åˆ›å»ºä¸€ä¸ªæ­£é¢æœå‘æ¨¡å‹æœ¬åœ°åæ ‡ç³»yè½´æ­£æ–¹å‘çš„åœ†ç‰‡æ¨¡å‹,åœ¨Blenderä¸­,å·¦ä¸Šè§’ä¸Šä¼šæœ‰ä¸€ä¸ªé€‰æ‹©å½“å‰æ¨¡å¼çš„æŒ‰é’®,ç¬”è€…æœ¬æ¬¡ç”¨åˆ°äº†ObjectModeå’ŒEditMode,åœ¨ObjectModeä¸‹,é€‰ä¸­åœ†ç‰‡è¿›è¡Œæ—‹è½¬,ä½ ä¼šå‘ç°æ—‹è½¬ä¿¡æ¯éƒ½ä¼šè¢«è®°å½•åœ¨Transformçš„å±æ€§ä¸­,ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªåœ†ç‰‡æ¨¡å‹çš„æœ¬åœ°åæ ‡ç³»ä¹Ÿæ˜¯åœ¨è·Ÿç€æ—‹è½¬çš„,è¿™ä¸ªæ“ä½œæ˜¯æ²¡æœ‰æ„ä¹‰çš„.<br>æˆ‘ä»¬éœ€è¦åˆ‡æ¢åˆ°EditMode,æ¡†é€‰æ‰€æœ‰çš„é¡¶ç‚¹,å›´ç»•Xè½´,æ²¿ç€å³æ‰‹åæ ‡ç³»å®šä¹‰çš„xè½´çš„é€†æ—¶é’ˆæ–¹å‘,<strong>æ³¨æ„æ˜¯é€†æ—¶é’ˆæ–¹å‘</strong>æ—‹è½¬90åº¦,ä½ ä¼šå‘ç°Blenderå¹¶æ²¡æœ‰è®¡ç®—è¿™æ¬¡æ“ä½œçš„æ—‹è½¬è§’åº¦,æˆ‘ä»¬è¿™æ¬¡æ“ä½œç›´æ¥ä¿®æ”¹äº†æ‰€æœ‰é¡¶ç‚¹çš„ä½ç½®ä¿¡æ¯.åœ¨æ—‹è½¬è¿‡ç¨‹ä¸­æŒ‰ä½<code>Shift</code>å¯ä»¥å¾®è°ƒæ—‹è½¬åº¦æ•°.</p><img src="/posts/4e0dbdc7/image-2.png" class=""><img src="/posts/4e0dbdc7/image-3.png" class=""><h1>å¦‚ä½•åœ¨Blenderä¸­åŒºåˆ†æ­£é¢å’Œåé¢</h1><p>åœ¨EditModeä¸‹,è§†å£å³ä¸Šè§’å›¾æ ‡ç‚¹å‡»çª—å£ä¸­å¯ä»¥æ˜¾ç¤ºå½“å‰é€‰ä¸­æ¨¡å‹çš„æ³•çº¿æœå‘,æ³•çº¿æŒ‡å‘çš„æ–¹å‘å³æ˜¯è¯¥é¢çš„æ­£é¢</p><img src="/posts/4e0dbdc7/image-4.png" class=""><p>ä¸Šé¢æˆ‘ä»¬è¯´è¿‡,Unityå’ŒBlenderä¸­æ¨¡å‹çš„æœ¬åœ°åæ ‡ç³»çš„å·®åˆ«æ˜¯xè½´çš„æ–¹å‘ç¿»è½¬äº†,ä¸¾ä¸€åä¸‰:æƒ³è¦å¯¼å‡ºä¸€ä¸ªåœ¨Unityä¸­æ­£é¢æœå‘Unityåæ ‡ç³»ä¸‹xè½´æ­£æ–¹å‘çš„åœ†ç‰‡æ¨¡å‹,é‚£ä¹ˆéœ€è¦åœ¨Blenderä¸­è®©è¿™ä¸ªåœ†ç‰‡çš„æ³•çº¿æœå‘Blenderä¸­è¯¥æ¨¡å‹æœ¬åœ°åæ ‡ç³»çš„xè½´çš„è´Ÿæ–¹å‘å°±å¯ä»¥äº†.</p><p>æœ€å,ä¸€äº›ç»†ææœ«èŠ‚,å¦‚æœåœ¨Blenderä¸­ä»¥Rotation Xä¸º0å¯¼å‡ºåˆ°Unityä¸­,åœ¨Unityçš„Importçª—å£ä¸­ä¼šçœ‹åˆ°æ¨¡å‹çš„local Rotationå±æ€§ä¸º-90,åœ¨Blenderä¸­ä»¥RotationX 90å¯¼å‡ºå°±æ²¡é—®é¢˜äº†</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>é£ä¹¦ååŒå·¥ä½œæµ</title>
      <link href="/posts/9891b583/"/>
      <url>/posts/9891b583/</url>
      
        <content type="html"><![CDATA[<h1>Jenkinså®‰è£…</h1><p>åœ¨Macä¸Š,ä½¿ç”¨Homebrewå‘½ä»¤å®‰è£…Jenkins</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install jenkins-lts</span><br></pre></td></tr></table></figure><p>å®‰è£…æˆåŠŸåä½¿ç”¨ä¸‹é¢å‘½ä»¤å¯åŠ¨JenkinsæœåŠ¡å™¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew services start jenkins-lts</span><br></pre></td></tr></table></figure><p>åœ¨æœ¬åœ°</p><p>å…¶ä»–å¸¸ç”¨å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew services restart jenkins-lts // é‡å¯Jenkins</span><br><span class="line">brew upgrade jenkins-lts // å‡çº§Jenkins</span><br></pre></td></tr></table></figure><p>Jenkinsä¸­çš„å…¶ä»–æ¦‚å¿µ.</p><p>Node<br>Agent<br>åˆ›å»ºPipelineç±»å‹çš„Workæ— æ³•çœ‹åˆ°workspace</p><p>é€šè¿‡æ–°å»ºä¸€ä¸ªNodeçš„æ–¹å¼,å¹¶åœ¨pipelineæµæ°´çº¿ä¸­åˆ¶å®š,</p><h1>é‡åˆ°çš„é—®é¢˜</h1><p>ä½¿ç”¨homebrewå®‰è£…äº†java,åœ¨ç»ˆç«¯ä¸­è¿è¡ŒJavaæç¤º<code>The operation couldnâ€™t be completed. Unable to locate a Java Runtime. Please visit http://www.java.com for information on installing Java.</code><br>åŸå› å¯èƒ½æ˜¯ä½¿ç”¨homebrewå®‰è£…çš„javaæ²¡æœ‰jvm,éœ€è¦å»<a href="https://www.oracle.com/java/technologies/downloads/#jdk23-mac">javaå®˜ç½‘</a>æ‰‹åŠ¨å®‰è£…</p><h1>Jenkinsæ‰§è¡ŒæˆåŠŸ/å¤±è´¥ä¸ŠæŠ¥é£ä¹¦</h1><p>é£ä¹¦+Lubanä½¿ç”¨</p><p>é—®é¢˜è®°å½•</p><p>Armç‰ˆæœ¬çš„MacOSä¸Šä½¿ç”¨.Net9å¹¶ä¸è¡Œ<br>éœ€è¦ä½¿ç”¨.Net8</p><p>æŠ–éŸ³å°æ¸¸æˆSDK<br><a href="https://bytedance.larkoffice.com/docx/doxcnTom4J47auHMnkjGYMBaNnZ">https://bytedance.larkoffice.com/docx/doxcnTom4J47auHMnkjGYMBaNnZ</a><br>SDKä½¿ç”¨æ–‡æ¡£<br><a href="https://bytedance.larkoffice.com/docx/Pu56d7eWfo53PaxizyNcOsxXnBe">https://bytedance.larkoffice.com/docx/Pu56d7eWfo53PaxizyNcOsxXnBe</a></p><h1>Unityæ›´æ–°é£ä¹¦æ–‡æ¡£</h1>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>OpenGLå­¦ä¹ è®°å½•â€”â€”å…¥é—¨ç¯‡</title>
      <link href="/posts/a627ba0f/"/>
      <url>/posts/a627ba0f/</url>
      
        <content type="html"><![CDATA[<p>ç¬”è€…åœ¨ç½‘ä¸Šèƒ½æ‰¾åˆ°çš„C++ä¸OpenGLçš„æ•™ç¨‹å‡ ä¹éƒ½æ˜¯åŸºäºWindows+VisualStudioå±•å¼€çš„ï¼Œä¹Ÿå› ä¸ºå…¶ç›´è§‚å’Œç®€æ˜“çš„ç¯å¢ƒé…ç½®æµç¨‹ï¼Œè®©åˆå­¦è€…æ›´ä¸“æ³¨äºå­¦ä¹ çŸ¥è¯†æœ¬èº«ã€‚è¿™å¯¹ä½œä¸ºMacç”¨æˆ·çš„ç¬”è€…å°±å¾ˆä¸å‹å¥½äº†ï¼Œéœ€è¦é¢å¤–äº†è§£CMakeçš„å·¥ä½œåŸç†ã€è¦é€‰ä»€ä¹ˆæ ·çš„ç¼–è¯‘å™¨ç­‰ç­‰è¯¸å¦‚æ­¤ç±»çš„ï¼Œéƒ½æ˜¯ç¬”è€…è¦å»ææ¸…æ¥šçš„ç‚¹ã€‚</p><h1>C++åŸºç¡€</h1><h2 id="å¤´æ–‡ä»¶å’ŒCPPæ–‡ä»¶çš„åŒºåˆ«">å¤´æ–‡ä»¶å’ŒCPPæ–‡ä»¶çš„åŒºåˆ«</h2><p>åœ¨(æ¸¸æˆå¼•æ“æ¶æ„)[<a href="https://book.douban.com/subject/25815142/">https://book.douban.com/subject/25815142/</a>]è¿™æœ¬ä¹¦ä¸­ï¼Œä»‹ç»äº†å¤´æ–‡ä»¶å’ŒCPPæ–‡ä»¶çš„åŒºåˆ«ï¼šå¤´æ–‡ä»¶é€šå¸¸ç”¨äºåœ¨å¤šä¸ªç¿»è¯‘å•å…ƒä¹‹é—´å…±äº«ä¿¡æ¯ï¼Œä¾‹å¦‚ç±»å‹çš„å£°æ˜ä»¥åŠå‡½æ•°åŸå‹ã€‚C++ç¼–è¯‘å™¨å¹¶ä¸äº†è§£å¤´æ–‡ä»¶ï¼Œå®é™…æƒ…å†µæ˜¯ï¼ŒC++é¢„å¤„ç†å™¨é¢„å…ˆæŠŠæ¯ä¸ª#includeè¯­å¥æ›¿æ¢æˆç›¸åº”çš„å¤´æ–‡ä»¶å†…å®¹ï¼Œç„¶åå†æŠŠç¿»è¯‘å•å…ƒé€äº¤æºä¸€èµ·ã€‚è¿™æ˜¯å¤´æ–‡ä»¶å’Œæºæ–‡ä»¶ä¹‹é—´ä¸€ä¸ªç»†å¾®ä½†æ˜¯éå¸¸é‡è¦çš„åŒºåˆ«ã€‚ä»ç¨‹åºå‘˜çš„è§’åº¦çœ‹ï¼Œå¤´æ–‡ä»¶æ˜¯ç‹¬ç«‹çš„æ–‡ä»¶ï¼Œä½†å¤šäºäº†æœ‰é¢„å¤„ç†å™¨æŠŠå¤´æ–‡ä»¶å±•å¼€ï¼Œç¼–è¯‘å™¨æ¥æ”¶åˆ°çš„æ‰éƒ½æ˜¯ç¿»è¯‘å•å…ƒã€‚ç¿»è¯‘å•å…ƒçš„å®šä¹‰æ˜¯ï¼šå› ä¸ºç¼–è¯‘å™¨æ¯æ¬¡åªç¼–è¯‘ä¸€ä¸ªC++æºæ–‡ä»¶è‡³æœºå™¨ç ï¼Œæ‰€ä»¥åœ¨æŠ€æœ¯ä¸Šï¼Œæºæ–‡ä»¶è¢«ç§°ä¸ºç¿»è¯‘å•å…ƒã€‚é‚£ä¹ˆåƒMacä¸Šç”¨çš„clangå°±æ˜¯ç¼–è¯‘å™¨çš„å‰ç«¯ï¼Œè´Ÿè´£é¢„ç¼–è¯‘å’Œç¼–è¯‘çš„ç¯èŠ‚ï¼Œ</p><h2 id="includeå-å’Œ-çš„åŒºåˆ«">includeå&quot;&quot;å’Œ&lt;&gt;çš„åŒºåˆ«</h2><p>æ¯”å¦‚åœ¨OpenGLå…¥é—¨ç¯‡çš„<a href="https://learnopengl-cn.github.io/01%20Getting%20started/07%20Transformations/#_20">å˜æ¢</a>ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ°äº†ä¸€ä¸ªåä¸ºGLMçš„åº“ï¼Œ</p><h2 id="C-ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹">C++ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹</h2><p>clangæ˜¯ç¼–è¯‘å™¨å‰ç«¯ï¼Œé€šè¿‡clangï¼Œ<br>é¢„ç¼–è¯‘ã€ç¼–è¯‘ã€æ±‡ç¼–ã€é“¾æ¥ï¼Œæ¯ä¸€æ­¥éƒ½åœ¨å¹²ä»€ä¹ˆå‘¢ï¼Ÿ<br>cmake installæˆ–è€…ninja installåˆæ˜¯åœ¨å¹²ä»€ä¹ˆå‘¢ï¼Ÿ</p><h1>Hello Window</h1><p>å…¥é—¨ç¯‡çš„<a href="https://learnopengl-cn.github.io/01%20Getting%20started/03%20Hello%20Window/">ä½ å¥½,çª—å£</a>ç« èŠ‚åœ¨ç¬”è€…é…ç½®OpenGLå¼€å‘ç¯å¢ƒé‚£ä¸€ç¯‡åšå®¢ä¸­å·²ç»éƒ¨åˆ†ä»‹ç»äº†ï¼Œä¸è¿‡ä¸¤ç¯‡æ–‡ç« çš„ä¾§é‡ç‚¹ä¸åŒï¼Œæœ¬ç¯‡æ–‡ç« çš„ä¾§é‡ç‚¹æ˜¯å¯¹æ¯ä¸€è¡Œæ•™ç¨‹ä¸­çš„ä»£ç å’Œé‡è¦æ¦‚å¿µè¿›è¡Œè§£è¯»ã€‚å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬å¯¹æŸäº›å‡½æ•°çš„æè¿°ä¸æ¸…æ¥šï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å»çœ‹GLFWçš„æºç ï¼Œæˆ–è€…æŸ¥çœ‹æ–‡æ¡£</p><h2 id="GLFWå’ŒGLAD">GLFWå’ŒGLAD</h2><p>æƒ³è¦ä½¿ç”¨OpenGLè¿›è¡Œæ¸²æŸ“ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ä¸ªåº“ï¼šGLFWä¸GLADã€‚GLFWæ˜¯ä¸€ä¸ªä¸“é—¨é’ˆå¯¹OpenGLçš„Cè¯­è¨€åº“ï¼Œ</p><h2 id="æ¥å£ä½¿ç”¨">æ¥å£ä½¿ç”¨</h2><h3 id="glfwInit">glfwInit()</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">glfwInit(); // åˆå§‹åŒ–glfw</span><br></pre></td></tr></table></figure><h3 id="glViewport-GLint-x-GLint-y-GLsizei-width-GLsizei-height">glViewport (GLint x, GLint y, GLsizei width, GLsizei height)</h3><h3 id="GLFWAPI-GLFWwindow-glfwCreateWindow-int-width-int-height-const-char-title-GLFWmonitor-monitor-GLFWwindow-share">GLFWAPI GLFWwindow* glfwCreateWindow(int width, int height, const char* title, GLFWmonitor* monitor, GLFWwindow* share)</h3><p>è¿™ä¸¤ä¸ªæ¥å£ç¬”è€…æƒ³è¦æ”¾åœ¨ä¸€èµ·ä»‹ç»,å› ä¸ºè¿™ä¸¤ä¸ªæ¥å£å¼•å…¥äº†ä¸¤ä¸ªç›¸å…³çš„æ¦‚å¿µ:çª—å£(Window)ä¸è§†å£(Viewport).æ¥ä¸‹æ¥ç¬”è€…ä¼šç”¨ä¸€äº›å®æ“æ¥ç›´è§‚åœ°å¸¦å„ä½åŒºåˆ†äºŒè€…çš„åŒºåˆ«.å‰ææ˜¯ä½ éœ€è¦å®ŒæˆHello Triangleç« èŠ‚çš„å­¦ä¹ .</p><p>é¦–å…ˆ,æˆ‘ä»¬æ³¨é‡Šæ‰ä»£ç ä¸­glViewportæ¥å£çš„è°ƒç”¨,ä½ çš„ä»£ç ä¸­å¯èƒ½æœ‰ä¸¤å¤„(å¦‚æœä½ æ˜¯æŒ‰ç…§ä¸­æ–‡æ•™ç¨‹å­¦ä¹ çš„è¯),ä¸€å¤„åœ¨<code>main</code>æ–¹æ³•å†…éƒ¨,å¦ä¸€å¤„åœ¨è°ƒç”¨<code>glfwSetFramebufferSizeCallback</code>æ¥å£æ—¶ä¼ å…¥çš„å›è°ƒæ–¹æ³•é‡Œ.ç„¶å,æˆ‘ä»¬å°†åœ¨è„šæœ¬ä¸­å£°æ˜çš„ä¸‰è§’å½¢é¡¶ç‚¹æ•°ç»„å†…å®¹ä¿®æ”¹æˆä¸‹é¢çš„å€¼:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">float vertices[] = &#123;</span><br><span class="line">        1.0f, 1.0f, 0.0f,  // å³ä¸Šè§’</span><br><span class="line">        1.0f, -1.0f, 0.0f, // å³ä¸‹è§’</span><br><span class="line">        -1.0f, 1.0f, 0.0f, // å·¦ä¸Šè§’</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure><p>æœ€å,æˆ‘ä»¬å¯ä»¥é€‰æ‹©å°†<code>glCreateWindow</code>ä¸­çª—å£çš„å®½åº¦å’Œé«˜åº¦æ”¹çš„å¤§ä¸€äº›,æ¯”å¦‚æ”¹æˆ<code>1920 * 1080</code>,è¿™æ˜¯ç¬”è€…æ˜¾ç¤ºå™¨çš„åˆ†è¾¨ç‡.é‡æ–°æ„å»ºæˆ‘ä»¬çš„ç¨‹åºä½ ä¼šå‘ç°,æˆ‘ä»¬çš„ç¨‹åºç”Ÿæˆäº†ä¸€ä¸ªé“ºæ»¡æˆ‘ä»¬æ•´ä¸ªå±å¹•çš„çª—å£,è€Œä¸”çª—å£ä¸­çš„è¿™ä¸ªä¸‰è§’å½¢é“ºæ»¡äº†æˆ‘ä»¬æ•´ä¸ªçª—å£çš„å³ä¸Šéƒ¨åˆ†å±å¹•!ç”±æ­¤æˆ‘ä»¬å¯ä»¥å¾—å‡ºç¬¬ä¸€ä¸ªç»“è®º:æˆ‘ä»¬å®šä¹‰çš„ä¸‰è§’å½¢çš„é¡¶ç‚¹ä½ç½®å’Œçª—å£çš„å®é™…å¤§å°ä¹‹é—´å­˜åœ¨ä¸€å±‚æ˜ å°„å…³ç³».è€Œå½“æˆ‘ä»¬æ‹–æ‹½çª—å£çš„æ—¶å€™,è¿™ä¸ªä¸‰è§’å½¢çš„å½¢çŠ¶ä¼šéšç€çª—å£å½¢çŠ¶çš„å˜åŒ–è€Œå˜åŒ–.<br>å¦‚æœæˆ‘ä»¬æƒ³è¦è®©ä¸‰è§’å½¢çš„å½¢çŠ¶å›ºå®š,ä¸ä¼šéšç€çª—å£å½¢çŠ¶çš„å˜åŒ–è€Œå˜åŒ–,è¯¥æ€ä¹ˆåšå‘¢?é‚£æˆ‘ä»¬å°±è¦ä½¿ç”¨<code>glViewPort</code>æ¥å£äº†.<code>glViewport</code>æ¥å£çš„çš„å‰ä¸¤ä¸ªå‚æ•°ä»£è¡¨çš„æ˜¯<code>è§†å£</code>å·¦ä¸‹è§’è·ç¦»ç›¸å¯¹äº<code>çª—å£</code>å·¦ä¸‹è§’çš„åæ ‡.è€Œç¬¬ä¸‰ä¸ªå’Œç¬¬å››ä¸ªå‚æ•°ä»£è¡¨çš„æ˜¯è§†å£çš„å¤§å°.ç°åœ¨ä½ å¯èƒ½è¿˜ä¸æ¸…æ¥šè§†å£å’Œçª—å£çš„åŒºåˆ«,æ²¡å…³ç³»,è·Ÿç€ç¬”è€…ä¸€èµ·æ“ä½œ,å–æ¶ˆæ³¨é‡Šä»£ç ä¸­çš„<code>glViewport</code>æ¥å£,å¹¶è®¾ç½®å…¶æ¥å£çš„å‚æ•°å€¼å¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">glViewport(600, 400, 200, 200);</span><br></pre></td></tr></table></figure><p>é‡æ–°æ„å»ºç¨‹åº,ä½ ä¼šå‘ç°,æˆ‘ä»¬çš„ä¸‰è§’å½¢å˜å¾—å¥½å°!è¿™ä¸ªä¸‰è§’å½¢å˜æˆäº†å˜é•¿ä¸º200*200çš„ç­‰è…°ç›´è§’ä¸‰è§’å½¢!å’Œ<code>glViewport</code>æ¥å£çš„ç¬¬ä¸‰å’Œç¬¬å››ä¸ªå‚æ•°çš„å€¼æ˜¯ä¸€æ ·çš„,è€Œä¸”å½“æˆ‘ä»¬è°ƒæ•´çª—å£å¤§å°çš„æ—¶å€™,æ³¨æ„:æˆ‘ä»¬è§‚å¯Ÿçš„æ˜¯é¼ æ ‡å·¦é”®æŠ¬èµ·åä¸‰è§’å½¢çš„å½¢çŠ¶å’Œä½ç½®çš„å˜åŒ–,ä½ ä¼šå‘ç°è¿™ä¸ªä¸‰è§’å½¢ç›¸å¯¹äºçª—å£çš„å·¦ä¸‹è§’çš„ä½ç½®æ²¡æœ‰å‘ç”Ÿå˜åŒ–!åˆ°è¿™é‡Œ,è§†å£å’Œçª—å£çš„åŒºåˆ«ä¸è”ç³»åº”è¯¥æ˜äº†äº†:æˆ‘ä»¬æ¸²æŸ“çš„ä¸‰è§’å½¢å¹¶ä¸æ˜¯æ¸²æŸ“åœ¨çª—å£ä¸Šçš„,è€Œæ˜¯æ¸²æŸ“åœ¨è§†å£ä¸Šçš„,é»˜è®¤æƒ…å†µä¸‹å¦‚æœæˆ‘ä»¬ä¸è°ƒç”¨<code>glViewport</code>è®¾ç½®è§†å£çš„ä½ç½®å°ºå¯¸,è§†å£çš„å¤§å°å’Œçª—å£çš„å¤§å°ç›¸ç­‰,è€Œå¦‚æœè°ƒç”¨äº†<code>glViewport</code>æ˜¾å¼æŒ‡å®šçš„è§†å£çš„å¤§å°,é‚£ä¹ˆè§†å£ä¸çª—å£çš„åŒºåˆ«ä¾¿ä¼šæ˜¾ç°.</p><h3 id="å…¶ä»–">å…¶ä»–</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">void glfwWindowHint(int hint,</span><br><span class="line">                    int value </span><br><span class="line">                    )</span><br></pre></td></tr></table></figure><p>This function sets hints for the next call to glfwCreateWindow. The hints, once set, retain their values until changed by a call to this function or glfwDefaultWindowHints, or until the library is terminated.</p><p>Window hints need to be set before the creation of the window and context you wish to have the specified attributes. They function as additional arguments to glfwCreateWindow.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">GLFWwindow * glfwCreateWindow(int width,</span><br><span class="line">                            int height,</span><br><span class="line">                            const char * title,</span><br><span class="line">                            GLFWmonitor * monitor,</span><br><span class="line">                            GLFWwindow * share </span><br><span class="line">                            )</span><br></pre></td></tr></table></figure><p>This function creates a window and its associated OpenGL or OpenGL ES context. Most of the options controlling how the window and its context should be created are specified with window hints.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void glfwMakeContextCurrent(GLFWwindow * window)</span><br></pre></td></tr></table></figure><p>This function makes the OpenGL or OpenGL ES context of the specified window current on the calling thread. It can also detach the current context from the calling thread without making a new one current by passing in NULL.</p><p>æˆ‘ä»¬ä½¿ç”¨glfwCreateWindow()</p><h1>é‡è¦æ¦‚å¿µ</h1><ul><li>VAO: Vertex Array Object, é¡¶ç‚¹æ•°ç»„å¯¹è±¡</li><li>VBO: Vertex Buffer Object, é¡¶ç‚¹ç¼“å†²å¯¹è±¡</li><li>EBO: Element Buffer Object, å…ƒç´ ç¼“å†²å¯¹è±¡</li><li>IBO: Index Buffer Object, ç´¢å¼•ç¼“å†²å¯¹è±¡</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¡¬æŠ€èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OpenGL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UnityAndroidå¹³å°è‡ªé€‚åº”åˆ·æ–°ç‡è®¾å¤‡è®¾ç½®120HZåˆ·æ–°ç‡æ— æ•ˆé—®é¢˜è§£å†³è®°å½•</title>
      <link href="/posts/7292a3de/"/>
      <url>/posts/7292a3de/</url>
      
        <content type="html"><![CDATA[<p>å›½äº§å‚å•†çš„å¯¹å®‰å“ç³»ç»Ÿçš„ç‰¹æ®Šè°ƒæ•™<br>â­•ï¸ å®‰å“å±‚çš„å°è¯• é‡åˆ°äº†getHolderè·å–ä¸åˆ°surfaceViewçš„é—®é¢˜ åŸå› æ˜¯ä»€ä¹ˆunity3d.player.I cant cast to surfaceView<br>â­•ï¸ Unityå±‚çš„å°è¯• ä½¿ç”¨SysInfo.Resolutionsè·å–å½“å‰è®¾å¤‡æ‰€æœ‰æ”¯æŒçš„åˆ†è¾¨ç‡+åˆ·æ–°ç‡,ä»ä¸­æŒ‘é€‰å‡ºé‚£ä¸ªæœ€é«˜åˆ†è¾¨ç‡çš„,ç„¶åè°ƒç”¨setResolutionæ¥å£è®¾ç½®ä¸Š<br>â­•ï¸ è¿˜æœ‰ä¸€ç§ç­–ç•¥æ²¡å°è¯•:å¦‚æœä¸€ä¸ªè®¾å¤‡æ”¯æŒ120HZåˆ·æ–°ç‡,ä½†æ˜¯æ”¯æŒå¤šç§åˆ†è¾¨ç‡ä¸‹çš„120HZåˆ·æ–°ç‡,æˆ‘æœ€é«˜çš„åˆ†è¾¨ç‡è®¾ç½®ä¸Šå»ä¸ç”Ÿæ•ˆ,é‚£å¦‚æœè®¾ç½®æœ€ä½çš„å‘¢?å¦å¤–è¦å–æ¶ˆå‹¾é€‰FramePacing,è¿˜è¦æŠŠV Syncå…³æ‰</p><h1>è§£é™¤å¸§ç‡é™åˆ¶(Android)</h1><p>å¯¹ä¸€äº›å®‰å“é«˜åˆ·å±æ¥è¯´ï¼Œè¿›æ¸¸æˆæ—¶å±å¹•åˆ·æ–°ç‡ä¼šè¢«è®¾ç½®æˆ60ï¼Œè¿™åº”è¯¥å’ŒAndroidç³»ç»Ÿçš„ç­–ç•¥æœ‰å…³ï¼Œå› æ­¤é€šè¿‡<code>Screen.currentResolution.refreshRateRatio</code>æ¥å£æ‹¿åˆ°çš„å±å¹•åˆ·æ–°ç‡æ˜¯ä¸å‡†ç¡®çš„ï¼Œ<br>å¦‚æœè¦å¼€å¯é«˜åˆ·ï¼Œåˆ™éœ€è¦å…³é—­ ProjectSettings -&gt; Player -&gt; Resolution and Presentation ä¸‹çš„ <a href="https://docs.unity3d.com/ScriptReference/PlayerSettings.Android-optimizedFramePacing.html">Optimized Frame Pacing</a>ï¼Œå¹¶ä¸”åœ¨è„šæœ¬ä¸­è®¾ç½® <code>Application.targetFrameRate = 120;</code></p><p>ä»¥ä¸Šçš„è§£å†³æ–¹æ¡ˆè¿‡äºç²—ç³™äº†ï¼Œæ›´å®Œå–„çš„è§£å†³æ–¹æ¡ˆéœ€è¦å‚è€ƒAndroidçš„<a href="https://developer.android.com/media/optimize/performance/frame-rate?hl=zh-cn">å®˜æ–¹æ–‡æ¡£</a>å»åˆ°Androidå±‚å®ç°å¸§ç‡çš„è®¾ç½®ï¼Œä¸€ç¯‡<a href="https://blog.csdn.net/a310989583/article/details/135771394?spm=1001.2101.3001.6650.4&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-4-135771394-blog-118787844.235%5Ev43%5Epc_blog_bottom_relevance_base8&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-4-135771394-blog-118787844.235%5Ev43%5Epc_blog_bottom_relevance_base8&amp;utm_relevant_index=9">å®è·µçš„å¸–å­</a></p><ul><li><a href="https://source.android.com/docs/core/graphics/multiple-refresh-rate?hl=zh-cn">https://source.android.com/docs/core/graphics/multiple-refresh-rate?hl=zh-cn</a></li></ul><blockquote><p>2024.12.10æ›´æ–°<br>å°è¯•äº†ä¸Šé¢çš„æ–¹æ³•,æœ€ç»ˆå¤±è´¥äº†</p></blockquote><h1>é—®é¢˜</h1><p>æœ‰äº›Androidæ‰‹æœºè®¾ç½®å¸§ç‡120HZä½†æ˜¯å®é™…ä¸Šè¾¾ä¸åˆ°çš„é—®é¢˜https://answer.uwa4d.com/question/64e7779266b5c657c78be192</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>MacOSä¸WindowsOpenGLå¼€å‘ç¯å¢ƒæ­å»º</title>
      <link href="/posts/fd5f8e8b/"/>
      <url>/posts/fd5f8e8b/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢è®°å½•ä»¥<a href="https://github.com/JoeyDeVries">JoeyDeVries</a>çš„<a href="https://learnopengl.com/Introduction">OpenGLæ•™ç¨‹</a>ä¸ºæŒ‡å¯¼åœ¨<code>MacOS</code>å’Œ<code>Windows</code>ç³»ç»Ÿä¸Šæ­å»ºOpenGLçš„è¿‡ç¨‹å’Œç–‘æƒ‘ã€‚<br>åœ¨å‚è€ƒçš„<a href="https://learnopengl-cn.github.io/01%20Getting%20started/02%20Creating%20a%20window/">OpenGLæ•™ç¨‹</a>ä¸­ä½¿ç”¨çš„å¼€å‘å¹³å°æ˜¯Windowsç³»ç»Ÿä¸Šçš„VisualStudioï¼Œä½†æ˜¯Macç³»ç»Ÿä¸Šçš„VisualStudioä¸èƒ½è¿›è¡ŒC++å¼€å‘ï¼Œä¸ºäº†åœ¨Macå’ŒWindowsä¸Šä¿æŒç›¸åŒçš„å¼€å‘ä½“éªŒï¼Œæˆ‘å†³å®šåœ¨MacOSå’ŒWindowsä¸Šç»Ÿä¸€ä½¿ç”¨<code>VSCode</code> + <code>CMake</code> + <code>Ninja</code> + <code>Clang</code>çš„å¼€å‘æ–¹æ¡ˆã€‚</p><h1>å‰ç½®çŸ¥è¯†</h1><h2 id="OpenGLæ˜¯ä»€ä¹ˆï¼Ÿ">OpenGLæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>OpenGLååˆ†ç±»ä¼¼é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³ä¸­çš„æ¥å£å’Œè™šæ–¹æ³•ï¼Œå®ƒåªæ˜¯å®šä¹‰äº†ä¸€ä¸ªæ¡†æ¶ï¼Œè€Œæ²¡æœ‰ä»»ä½•å…·ä½“çš„å®ç°ã€‚æ‰€æœ‰çš„å®ç°éœ€è¦æ˜¾å¡ç”Ÿäº§å‚å•†è‡ªå·±å®ç°ã€‚å¯ä»¥è¯´OpenGLæ˜¯ä¸€å¥—è§„èŒƒã€‚</p><h2 id="GLFWå’ŒGLAD">GLFWå’ŒGLAD</h2><p>GLFWæ˜¯ä¸€ä¸ªä¸“é—¨é’ˆå¯¹OpenGLçš„Cè¯­è¨€åº“ï¼Œå®ƒæä¾›äº†ä¸€äº›æ¸²æŸ“ç‰©ä½“æ‰€éœ€çš„æœ€ä½é™åº¦çš„æ¥å£ã€‚å®ƒå…è®¸ç”¨æˆ·åˆ›å»ºOpenGLä¸Šä¸‹æ–‡ã€å®šä¹‰çª—å£å‚æ•°ä»¥åŠå¤„ç†ç”¨æˆ·è¾“å…¥ã€‚</p><p>å› ä¸ºOpenGLåªæ˜¯ä¸€ä¸ªæ ‡å‡†/è§„èŒƒï¼Œå…·ä½“çš„å®ç°æ˜¯ç”±é©±åŠ¨å¼€å‘å•†é’ˆå¯¹ç‰¹å®šæ˜¾å¡å®ç°çš„ã€‚ç”±äºOpenGLé©±åŠ¨ç‰ˆæœ¬ä¼—å¤šï¼Œå®ƒå¤§å¤šæ•°å‡½æ•°çš„ä½ç½®éƒ½æ— æ³•åœ¨ç¼–è¯‘æ—¶ç¡®å®šä¸‹æ¥ï¼Œéœ€è¦åœ¨è¿è¡Œæ—¶æŸ¥è¯¢ã€‚æ‰€ä»¥ä»»åŠ¡å°±è½åœ¨äº†å¼€å‘è€…èº«ä¸Šï¼Œå¼€å‘è€…éœ€è¦åœ¨è¿è¡Œæ—¶è·å–å‡½æ•°åœ°å€å¹¶å°†å…¶ä¿å­˜åœ¨ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆä¸­ä¾›ä»¥åä½¿ç”¨ã€‚<br>GLADæ˜¯ä¸€ä¸ªå¼€æºçš„åº“ï¼Œå®ƒèƒ½è§£å†³æˆ‘ä»¬ä¸Šé¢æåˆ°çš„é‚£ä¸ªç¹ççš„é—®é¢˜ã€‚GLADçš„é…ç½®ä¸å¤§å¤šæ•°çš„å¼€æºåº“æœ‰äº›è®¸çš„ä¸åŒï¼ŒGLADä½¿ç”¨äº†ä¸€ä¸ªåœ¨çº¿æœåŠ¡ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬èƒ½å¤Ÿå‘Šè¯‰GLADéœ€è¦å®šä¹‰çš„OpenGLç‰ˆæœ¬ï¼Œå¹¶ä¸”æ ¹æ®è¿™ä¸ªç‰ˆæœ¬åŠ è½½æ‰€æœ‰ç›¸å…³çš„OpenGLå‡½æ•°ã€‚GLADçš„ä½œç”¨æ˜¯ç®¡ç†OpenGLçš„å‡½æ•°æŒ‡é’ˆï¼Œæ‰€ä»¥åœ¨è°ƒç”¨ä»»ä½•OpenGLå‡½æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬éƒ½éœ€è¦åˆå§‹åŒ–GLADã€‚</p><h2 id="C-å·¥å…·é“¾">C++å·¥å…·é“¾</h2><p>å°†C++ä»æºä»£ç å˜æˆå¯æ‰§è¡Œç¨‹åºéœ€è¦ç»è¿‡å››ä¸ªåŸºæœ¬æ­¥éª¤ï¼šé¢„ç¼–è¯‘ã€ç¼–è¯‘ã€æ±‡ç¼–ã€é“¾æ¥ã€‚æ¯ä¸€æ­¥éƒ½éœ€è¦æœ‰ç›¸åº”çš„å·¥å…·æ”¯æŒï¼Œå°†åœ¨C++ç¼–è¯‘æˆå¯æ‰§è¡Œç¨‹åºè¿‡ç¨‹ä¸­æ¯ä¸ªç¯èŠ‚ä½¿ç”¨åˆ°çš„å·¥å…·æ”¾åœ¨ä¸€èµ·ï¼Œå°±ç§°è¿™äº›å·¥å…·ç»„æˆäº†ä¸€å¥—C++å·¥å…·é“¾ã€‚ç›®å‰ä¸»æµçš„C++å·¥å…·é“¾æœ‰GNUã€LLVMã€MSVCç­‰ã€‚</p><h2 id="Clangå’ŒLLVMçš„ä»‹ç»"><a href="https://llvm.org/">Clangå’ŒLLVMçš„ä»‹ç»</a></h2><h2 id="Ninja-buildä»‹ç»"><a href="https://ninja-build.org/">Ninja-build</a>ä»‹ç»</h2><h1>å‡†å¤‡å·¥ä½œ</h1><h2 id="å®‰è£…VSCode">å®‰è£…<a href="https://code.visualstudio.com/">VSCode</a></h2><h2 id="å®‰è£…CMake">å®‰è£…<a href="https://cmake.org/">CMake</a></h2><p>Macä¸Šä¹Ÿå¯ä»¥ä½¿ç”¨Homebrewè¿›è¡Œå®‰è£…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install cmake</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…Ninja">å®‰è£…Ninja</h2><ol><li>Macä¸Šä½¿ç”¨Homebrewå®‰è£…Ninja</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install ninja</span><br></pre></td></tr></table></figure><ol start="2"><li>Windowsä¸Šå¯ä»¥åœ¨githubä¸Šçš„<a href="https://github.com/ninja-build/ninja/releases">ninjaä¸»é¡µ</a>è¿›è¡Œä¸‹è½½ï¼Œ<strong>å°†ä¸‹è½½å®Œçš„æ–‡ä»¶çš„æ ¹ç›®å½•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­</strong>ã€‚</li></ol><p>åœ¨ç»ˆç«¯ä¸­è¿è¡Œ<code>ninja --version</code>å¦‚æœæ­£ç¡®æ˜¾ç¤ºç‰ˆæœ¬å·å°±è¯´æ˜ninjaå®‰è£…æˆåŠŸäº†ã€‚</p><h2 id="å®‰è£…clang">å®‰è£…clang</h2><ol><li>Macä¸Šé»˜è®¤ä½¿ç”¨çš„C++ç¼–è¯‘å™¨å°±æ˜¯clang ä¸éœ€è¦é¢å¤–ä¸‹è½½</li><li>Windowså»åˆ°<a href="https://github.com/llvm/llvm-project/releases">LLVM</a>çš„Githubä¸»é¡µä¸Šä¸‹è½½ ä¸‹è½½LLVM-win64ç‰ˆæœ¬ã€‚å°†ä¸‹è½½å¥½çš„ç›®å½•ä¸‹çš„binç›®å½•è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ã€‚åœ¨ç»ˆç«¯ä¸­è¿è¡Œ<code>clang --verison</code>å¦‚æœæ­£ç¡®æ˜¾ç¤ºç‰ˆæœ¬å·è¯´æ˜clangå®‰è£…æˆåŠŸã€‚</li></ol><h2 id="ç¼–è¯‘GLFWæºç ">ç¼–è¯‘GLFWæºç </h2><p>å»åˆ°<a href="https://www.glfw.org/download.html">GLFWå®˜ç½‘</a>ä¸‹è½½GFLWæºç ï¼Œè§£å‹ä¸‹è½½å¥½çš„æºç æ–‡ä»¶ï¼Œåœ¨ç»ˆç«¯ä¸­è¿›å…¥æºç çš„æ ¹ç›®å½•ï¼Œåˆ›å»ºåä¸º<code>build</code>çš„è·¯å¾„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir build</span><br></pre></td></tr></table></figure><p>è¦ä½¿æˆ‘ä»¬ç¼–å†™çš„ç¨‹åºæ­£ç¡®åœ°è°ƒç”¨GLFWåº“ä¸­çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŠ¨æ€é“¾æ¥æˆ–è€…é™æ€é“¾æ¥GLFWåº“çš„æ–¹å¼ï¼Œ<strong>ä¼˜å…ˆé€‰æ‹©é™æ€é“¾æ¥</strong>çš„æ–¹å¼ï¼Œå› ä¸ºåŠ¨æ€é“¾æ¥çš„æ–¹å¼éœ€è¦é¢å¤–æŒ‡å®šä¸€ä¸‹å‚æ•°ï¼Œè€Œä¸”ç¼–è¯‘æˆåŠŸåè¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶æ—¶è¿˜æœ‰æ‰¾ä¸åˆ°åŠ¨æ€é“¾æ¥åº“çš„é—®é¢˜ï¼Œå…·ä½“ç»†èŠ‚ä¼šåœ¨ä¸‹æ–‡ä¼šå…·ä½“é˜è¿°ã€‚</p><p>ä½¿ç”¨<strong>é™æ€é“¾æ¥æ–¹å¼</strong>è¦ç”Ÿæˆé™æ€é“¾æ¥åº“ï¼ŒWindowsä¸‹å¯¹åº”çš„æ–‡ä»¶æ˜¯.libï¼ŒMacä¸‹å¯¹åº”çš„æ–‡ä»¶æ˜¯.a</p><p>CMakeå¯ä»¥æŒ‡å®šä½¿ç”¨ä½•ç§ç±»å‹çš„æ„å»ºç³»ç»Ÿï¼ŒWindowsä¸‹é»˜è®¤çš„æ„å»ºç³»ç»Ÿæ˜¯VisualStudioå·¥ç¨‹ï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œå› æ­¤åœ¨è°ƒç”¨cmakeæŒ‡ä»¤çš„æ—¶å€™è¦æ‰‹åŠ¨æŒ‡å®šè¦æ„å»ºçš„ç³»ç»Ÿã€‚å¦å¤–Windowsä¸‹é»˜è®¤ä½¿ç”¨çš„ç¼–è¯‘å™¨æ˜¯VisualStudioç¼–è¯‘å™¨ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦æŒ‡å®šä¸ºclangç¼–è¯‘å™¨ï¼Œæ‰€ä»¥cmakeçš„å®Œæ•´æŒ‡ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake .. -G Ninja -D CMAKE_C_COMPILER=clang -D CMAKE_CXX_COMPILER=clang++</span><br></pre></td></tr></table></figure><p>æ¥ç€ä½¿ç”¨<code>ninja</code>æŒ‡ä»¤ï¼Œå¦‚æœç¼–è¯‘æˆåŠŸçš„è¯ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨buildç›®å½•ä¸‹çš„srcç›®å½•ä¸‹æ‰¾åˆ°å¯¹åº”å¹³å°çš„é™æ€é“¾æ¥åº“æ–‡ä»¶äº†ã€‚</p><p>ä½¿ç”¨<strong>åŠ¨æ€é“¾æ¥æ–¹å¼</strong>è¦ç”ŸæˆåŠ¨æ€é“¾æ¥åº“ï¼ŒWindowsä¸‹å¯¹åº”çš„æ–‡ä»¶æ˜¯.dllï¼ŒMacä¸‹å¯¹åº”çš„æ–‡ä»¶æ˜¯.dylibï¼ŒåŠ¨æ€é“¾æ¥åº“çš„ç¼–è¯‘å‘½ä»¤å’Œé™æ€é“¾æ¥åº“æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯éœ€è¦æŒ‡å®šä¸€ä¸‹<code>BUILD_SHARED_LIBS</code>å‚æ•°ï¼Œæ³¨æ„æŒ‡å®šä¸€ä¸‹è¦æ„å»ºçš„ç³»ç»Ÿï¼Œå¦å¤–è¿˜è¦æ³¨æ„Windowsä¸‹æŒ‡å®šä½¿ç”¨çš„ç¼–è¯‘å™¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake .. -G Ninja -D BUILD_SHARED_LIBS=ON -D CMAKE_C_COMPILER=clang -D CMAKE_CXX_COMPILER=clang++</span><br></pre></td></tr></table></figure><p>æ¥ç€ä½¿ç”¨<code>ninja</code>æŒ‡ä»¤</p><p>å¯¹äºMacOSç³»ç»Ÿï¼Œè¿˜ä½¿ç”¨<code>make install</code>å‘½ä»¤å¯ä»¥æŠŠåŠ¨æ€é“¾æ¥åº“å®‰è£…åˆ°æœ¬æœºï¼Œå¯èƒ½éœ€è¦ç®¡ç†å‘˜æƒé™ã€‚åŠ¨æ€åº“å°†ä¼šè¢«å®‰è£…åˆ°<code>usr/local/lib</code>ç›®å½•ï¼Œå¤´æ–‡ä»¶å®‰è£…åˆ°<code>usr/local/include</code>ã€‚</p><blockquote><p>2024.11.30æ›´æ–°<br>ç¬”è€…ä½¿ç”¨ninjaå‘½ä»¤æ›¿ä»£äº†makeå‘½ä»¤ï¼Œå› æ­¤<strong>make install</strong>å‘½ä»¤è¦è¢«æ›¿æ¢ä¸º<strong>ninja install</strong>ï¼Œæ–‡ä»¶ä¼šè¢«å®‰è£…åˆ°ä¸‹é¢çš„ç›®å½•:</p><img src="/posts/fd5f8e8b/image.png" class=""></blockquote><p>æ‰§è¡Œå®Œä¸Šé¢çš„æ“ä½œä¹‹åï¼Œå°±å¯ä»¥åœ¨<code>build</code>ç›®å½•çš„<code>src</code>ç›®å½•ä¸‹çœ‹åˆ°å¯¹åº”çš„å¹³å°çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶äº†ã€‚<br><strong>æ³¨æ„</strong> åœ¨Windowsä¸‹ä½¿ç”¨<code>Ninja</code>æ„å»ºç³»ç»Ÿç¼–è¯‘å‡ºæ¥çš„åŠ¨æ€é“¾æ¥åº“å‡ºäº†<code>glfw3.dll</code>å¤–è¿˜ä¼šç”Ÿæˆä¸€ä¸ª<code>glfw3dll.lib</code>ï¼Œè¿™ä¸¤ä¸ªéƒ½æ˜¯åœ¨ä¸‹æ–‡æ­å»ºOpenGLå¼€å‘ç¯å¢ƒä¸­è¦ä½¿ç”¨åˆ°çš„æ–‡ä»¶ã€‚</p><h2 id="ä¸‹è½½GLAD">ä¸‹è½½GLAD</h2><p>ä½¿ç”¨GLADçš„<a href="https://glad.dav1d.de/">åœ¨çº¿æœåŠ¡</a>ä¸‹è½½æ‰€éœ€è¦çš„æ–‡ä»¶ã€‚APIæ ç›®ä¸‹çš„glçš„ç‰ˆæœ¬ä¸€èˆ¬é€‰æ‹©æœ€æ–°çš„å°±å¯ä»¥ï¼Œå‚è€ƒOpenGLæ•™ç¨‹ä¸­è¦æ±‚ä½¿ç”¨çš„OpenGLçš„ç‰ˆæœ¬ä¸èƒ½ä½äº<strong>3.3</strong>ï¼ŒProfileæ ç›®é€‰æ‹©Coreï¼Œå…¶ä»–çš„ä¸ç”¨é…ç½®ï¼Œç‚¹å‡»Generateä¹‹åä¸‹è½½ç”Ÿæˆçš„å‹ç¼©åŒ…åˆ°æœ¬åœ°ã€‚è§£å‹å‹ç¼©åŒ…ï¼Œæ–‡ä»¶ç»“æ„åº”è¯¥å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ include</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ KHR</span><br><span class="line">â”‚Â Â  â”‚Â Â  â””â”€â”€ khrplatform.h</span><br><span class="line">â”‚Â Â  â””â”€â”€ glad</span><br><span class="line">â”‚Â Â      â””â”€â”€ glad.h</span><br><span class="line">â””â”€â”€ src</span><br><span class="line">    â””â”€â”€ glad.c</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="VSCodeCodingä½“éªŒä¼˜åŒ–">VSCodeCodingä½“éªŒä¼˜åŒ–</h2><h3 id="è®¾ç½®">è®¾ç½®</h3><p>ä½¿ç”¨Macä¸Šçš„ <code>Command + ,</code> æˆ–è€…Windowsä¸Šçš„ <code>Control + ,</code> å¿«æ·é”®å¯ä»¥æ‰“å¼€è®¾ç½®é¡µé¢,åœ¨è®¾ç½®é¡µé¢çš„å³ä¸Šè§’é€‰æ‹©ä½¿ç”¨Jsonæ¨¡å¼æ‰“å¼€, å°†ä¸‹é¢çš„æ–‡æœ¬ç²˜è´´è¿›å»ï¼Œå°†é¼ æ ‡æ‚¬åœåœ¨ä¸Šé¢å¯ä»¥çœ‹åˆ°æ¯ä¸€ä¸ªè®¾ç½®çš„ä½œç”¨ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&quot;files.autoSave&quot;: &quot;afterDelay&quot;,</span><br><span class="line">&quot;files.autoGuessEncoding&quot;: true, </span><br><span class="line">&quot;workbench.list.smoothScrolling&quot;: true, </span><br><span class="line">&quot;editor.cursorSmoothCaretAnimation&quot;: &quot;on&quot;,</span><br><span class="line">&quot;editor.smoothScrolling&quot;: true, </span><br><span class="line">&quot;editor.cursorBlinking&quot;: &quot;smooth&quot;,</span><br><span class="line">&quot;editor.mouseWheelZoom&quot;: true,</span><br><span class="line">&quot;editor.formatOnPaste&quot;: true,</span><br><span class="line">&quot;editor.formatOnType&quot;: true,</span><br><span class="line">&quot;editor.formatOnSave&quot;: true,</span><br><span class="line">&quot;editor.wordWrap&quot;: &quot;on&quot;,</span><br><span class="line">&quot;editor.guides.bracketPairs&quot;: true,</span><br><span class="line">&quot;editor.suggest.snippetsPreventQuickSuggestions&quot;: false,</span><br><span class="line">&quot;editor.acceptSuggestionOnEnter&quot;: &quot;smart&quot;,</span><br><span class="line">&quot;editor.suggestSelection&quot;: &quot;recentlyUsed&quot;,</span><br><span class="line">&quot;window.dialogStyle&quot;: &quot;custom&quot;,</span><br><span class="line">&quot;debug.showBreakpointsInOverviewRuler&quot;: true,</span><br><span class="line">&quot;editor.fontFamily&quot;: &quot;JetBrains Mono&quot;,</span><br><span class="line">&quot;git.ignoreMissingGitWarning&quot;: true,</span><br><span class="line">&quot;explorer.confirmDelete&quot;: false,</span><br><span class="line">&quot;cmake.configureOnOpen&quot;: false,</span><br></pre></td></tr></table></figure><h3 id="æ’ä»¶ä¸å­—ä½“">æ’ä»¶ä¸å­—ä½“</h3><p><strong>MarkDownæ’ä»¶</strong></p><p>Markdown Preview Enhanced</p><p>Markdown All in One</p><blockquote><p>2024.8.11æ›´æ–°<br>åœ¨VSCodeä¸­ä½¿ç”¨åƒTyporaé‚£æ ·å°†å›¾ç‰‡å¤åˆ¶åˆ°æŒ‡å®šè·¯å¾„çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><ul><li>é¦–å…ˆä¸‹è½½å¥½ä¸Šé¢çš„ä¸¤ä¸ªæ’ä»¶</li><li>åœ¨VSCodeçš„è®¾ç½®ä¸­æœç´¢<code>Markdown â€º Copy Files: Destination</code></li><li>æ·»åŠ ä¸€å¯¹KeyValueå¦‚ä¸‹ï¼š Key: <code>**/*</code> Value: <code>$&#123;documentBaseName&#125;/</code></li></ul><img src="/posts/fd5f8e8b/image-1.png" class=""><p>ä½†æ˜¯æˆ‘è¿˜æ²¡æœ‰ææ‡‚KeyValueæ˜¯å¦‚ä½•åšè·¯å¾„æ˜ å°„çš„<br><a href="https://code.visualstudio.com/docs/languages/markdown">VSCodeå®˜ç½‘ä¸Šçš„å‚è€ƒ</a></p></blockquote><p><strong>ä»£ç æˆªå›¾å·¥å…·</strong> CodeSnap</p><p><strong>å›¾æ ‡ä¸»é¢˜</strong> Material Icon Theme</p><p><strong>ä»£ç æ ¼å¼åŒ–å·¥å…·</strong> Prettier - Code formatter</p><p><strong>ä¸»é¢˜</strong> <a href="https://marketplace.visualstudio.com/items?itemName=zhuangtongfa.Material-theme">OneDarkPro</a></p><p><strong>å­—ä½“</strong> <a href="https://www.jetbrains.com/lp/mono/">JetBrains Mono</a></p><h3 id="æ™ºèƒ½æç¤º">æ™ºèƒ½æç¤º</h3><p>GLADå’ŒGLFWéƒ½æ˜¯ç¬¬ä¸‰æ–¹åº“ï¼Œåœ¨VSCodeç›´æ¥ä½¿ç”¨æ˜¯æ²¡æœ‰æç¤ºçš„ã€‚ä½¿ç”¨Macä¸Šçš„ <code>Shift + CMD + P</code> æˆ–è€… Windowsä¸Šçš„ <code>Shift + Control + P</code> åœ¨å¼¹å‡ºçš„æœç´¢æ ä¸­è¾“å…¥<code>C/C++:Edit Configurations(JSON)</code>ï¼Œä¼šæ–°å»ºå¦‚ä¸‹Jsonæ–‡ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;configurations&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;name&quot;: &quot;Mac&quot;,</span><br><span class="line">            &quot;includePath&quot;: [</span><br><span class="line">                &quot;$&#123;workspaceFolder&#125;/**&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;defines&quot;: [],</span><br><span class="line">            &quot;macFrameworkPath&quot;: [</span><br><span class="line">                &quot;/Applications/Xcode-15.1.0.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/System/Library/Frameworks&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;compilerPath&quot;: &quot;/usr/bin/clang&quot;,</span><br><span class="line">            &quot;cStandard&quot;: &quot;c17&quot;,</span><br><span class="line">            &quot;cppStandard&quot;: &quot;c++17&quot;,</span><br><span class="line">            &quot;intelliSenseMode&quot;: &quot;macos-clang-arm64&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;version&quot;: 4</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>includePath</code>ä¸­å°†é¡¹ç›®çš„includeç›®å½•æ·»åŠ è¿›å»ï¼Œä¿å­˜é‡å¯VSCodeï¼Œç¼–å†™OpenGLç›¸å…³ä»£ç æ—¶å°±ä¼šæœ‰æç¤ºäº†ã€‚</p><blockquote><p>2024.12.9æ›´æ–°<br>è¯·æ³¨æ„,è™½ç„¶æœ‰æ™ºèƒ½æç¤ºäº†ï¼Œä½†æ˜¯ä¸ä»£è¡¨åœ¨ç¼–è¯‘é¡¹ç›®çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„å¤´æ–‡ä»¶<br>æˆ‘ä»¬éœ€è¦åœ¨CMakeListæ–‡ä»¶ä¸­ä½¿ç”¨<code>include_directories($&#123;INCLUDE_DIR&#125;)</code>å‘½ä»¤æ·»åŠ ç›¸å…³çš„æ–‡ä»¶è·¯å¾„</p></blockquote><h3 id="includeå¤´æ–‡ä»¶ç¬¬ä¸€è¡ŒæŠ¥çº¢é—®é¢˜">includeå¤´æ–‡ä»¶ç¬¬ä¸€è¡ŒæŠ¥çº¢é—®é¢˜</h3><p>æŒ‰ç…§ä¸Šé¢çš„æµç¨‹è®¾ç½®å®Œä¹‹å,ç‚¹å‡»includeçš„å¤´æ–‡ä»¶ä¹Ÿèƒ½è·³è½¬åˆ°å¯¹åº”å¤´æ–‡ä»¶çš„å†…å®¹ä¸­ï¼Œä½†æ˜¯åœ¨ç¬¬ä¸€è¡Œä¼šæœ‰ä¸€ä¸ªçº¢è‰²çš„æ³¢æµªçº¿ï¼ŒåŸå› æ˜¯è®¾ç½®ä¸­<code>clang.diagnostic.enable</code>é€‰é¡¹è¢«æ‰“å¼€äº†ï¼Œå°†å®ƒå…³æ‰å°±ä¸ä¼šæœ‰é—®é¢˜äº†ã€‚</p><h1>OpenGLç¯å¢ƒæ­å»º</h1><h2 id="ç›®å½•ç»“æ„">ç›®å½•ç»“æ„</h2><p>æ•™ç¨‹çš„æ¯ä¸€ä¸ªå°èŠ‚æ˜¯ä¸€ä¸ªå°çš„OpenGLé¡¹ç›®ï¼Œæ‰€æœ‰å°èŠ‚é¡¹ç›®å…±ç”¨ç›¸åŒçš„<code>lib</code>å’Œ<code>include</code>è·¯å¾„ï¼Œå¦å¤–è¿˜å…±ç”¨ä¸€ä¸ª<code>glad.c</code>è„šæœ¬ã€‚æ–‡ä»¶ç›®å½•ç»“æ„å¦‚ä¸‹ï¼Œå°†å‰æ–‡ä¸­ç¼–è¯‘æˆåŠŸçš„GLFWçš„åº“æ–‡ä»¶å’ŒGLADåœ¨çº¿æœåŠ¡ä¸­ä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶æ”¾å…¥å¯¹åº”çš„è·¯å¾„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ C1_GettingStart</span><br><span class="line">â”‚   â”œâ”€â”€ P1_HelloWindow</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">â”‚   â”‚   â””â”€â”€ src</span><br><span class="line">â”‚   â”‚       â””â”€â”€ main.cpp</span><br><span class="line">â”‚   â””â”€â”€ P2_HelloTriangle</span><br><span class="line">â”‚       â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">â”‚       â””â”€â”€ src</span><br><span class="line">â”‚           â””â”€â”€ main.cpp</span><br><span class="line">â”œâ”€â”€ C2_Lighting</span><br><span class="line">â”‚   â”œâ”€â”€ P1_Color</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">â”‚   â”‚   â””â”€â”€ src</span><br><span class="line">â”‚   â”‚       â””â”€â”€ main.cpp</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ include</span><br><span class="line">â”‚   â”œâ”€â”€ GLFW</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ glfw3.h</span><br><span class="line">â”‚   â”‚   â””â”€â”€ glfw3native.h</span><br><span class="line">â”‚   â”œâ”€â”€ KHR</span><br><span class="line">â”‚   â”‚   â””â”€â”€ khrplatform.h</span><br><span class="line">â”‚   â””â”€â”€ glad</span><br><span class="line">â”‚       â””â”€â”€ glad.h</span><br><span class="line">â”œâ”€â”€ lib</span><br><span class="line">â”‚   â”œâ”€â”€ glfw3.dll</span><br><span class="line">â”‚   â”œâ”€â”€ glfw3.lib</span><br><span class="line">â”‚   â”œâ”€â”€ glfw3dll.lib</span><br><span class="line">â”‚   â”œâ”€â”€ libglfw.3.4.dylib</span><br><span class="line">â”‚   â”œâ”€â”€ libglfw.3.dylib -&gt; libglfw.3.4.dylib</span><br><span class="line">â”‚   â””â”€â”€ libglfw3.a</span><br><span class="line">â””â”€â”€ src</span><br><span class="line">    â””â”€â”€ glad.c</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ç¼–å†™æµ‹è¯•ç¨‹åº">ç¼–å†™æµ‹è¯•ç¨‹åº</h2><p>æµ‹è¯•ä»£ç æ¥è‡ªå‚è€ƒOpenGLæ•™ç¨‹çš„<a href="https://learnopengl-cn.github.io/01%20Getting%20started/03%20Hello%20Window/">HelloWindow</a>ç« èŠ‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;glad/glad.h&gt;</span><br><span class="line">#include &lt;GLFW/glfw3.h&gt;</span><br><span class="line"></span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line"></span><br><span class="line">void framebuffer_size_callback(GLFWwindow *window, int width, int height);</span><br><span class="line">void processInput(GLFWwindow *window);</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    // åˆå§‹åŒ–GLFW</span><br><span class="line">    glfwInit();</span><br><span class="line">    // è®¾ç½®ä½¿ç”¨çš„GLFWæœ€å°ç‰ˆæœ¬å·ä¸º3.3</span><br><span class="line">    glfwWindowHint(GLFW_CONTEXT_VERSION_MAJOR, 3);</span><br><span class="line">    glfwWindowHint(GLFW_CONTEXT_VERSION_MINOR, 3);</span><br><span class="line"></span><br><span class="line">    // æŒ‡å®šä½¿ç”¨OpenGLçš„æ ¸å¿ƒåŠŸèƒ½</span><br><span class="line">    glfwWindowHint(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE);</span><br><span class="line"></span><br><span class="line">#ifdef __APPLE__</span><br><span class="line">    glfwWindowHint(GLFW_OPENGL_FORWARD_COMPAT, GL_TRUE);</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">    GLFWwindow *window = glfwCreateWindow(800, 600, &quot;HelloWindow&quot;, NULL, NULL);</span><br><span class="line"></span><br><span class="line">    if (window == NULL)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; &quot;Failed to create GLFW window&quot; &lt;&lt; std::endl;</span><br><span class="line">        glfwTerminate();</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line">    glfwMakeContextCurrent(window);</span><br><span class="line"></span><br><span class="line">    // GLADç”¨æ¥ç®¡ç†OpenGLå‡½æ•°æŒ‡é’ˆ è°ƒç”¨ä»»ä½•OpenGLçš„å‡½æ•°ä¹‹å‰éƒ½éœ€è¦åˆå§‹åŒ–GLAD</span><br><span class="line">    if (!gladLoadGLLoader((GLADloadproc)glfwGetProcAddress))</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; &quot;Failed to initialize GLAD&quot; &lt;&lt; std::endl;</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    glfwSetFramebufferSizeCallback(window, framebuffer_size_callback);</span><br><span class="line"></span><br><span class="line">    // ç•™æ„çª—å£å’Œè§†å£çš„åŒºåˆ«</span><br><span class="line">    glViewport(200, 200, 400, 300);</span><br><span class="line"></span><br><span class="line">    while (!glfwWindowShouldClose(window))</span><br><span class="line">    &#123;</span><br><span class="line">        processInput(window);</span><br><span class="line"></span><br><span class="line">        glClearColor(0.2f, 0.3f, 0.3f, 1.0f);</span><br><span class="line">        glClear(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">        glfwSwapBuffers(window);</span><br><span class="line">        glfwPollEvents();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    glfwTerminate();</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void framebuffer_size_callback(GLFWwindow *window, int width, int height)</span><br><span class="line">&#123;</span><br><span class="line">    glViewport(200, 200, width / 2, height / 2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void processInput(GLFWwindow *window)</span><br><span class="line">&#123;</span><br><span class="line">    if (glfwGetKey(window, GLFW_KEY_ESCAPE) == GLFW_PRESS)</span><br><span class="line">    &#123;</span><br><span class="line">        glfwSetWindowShouldClose(window, true);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ç¼–å†™CMakeList">ç¼–å†™CMakeList</h2><p>åœ¨Windowså’ŒMacOSä¸Šé€šç”¨çš„<code>CMakeLists.txt</code>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.10)</span><br><span class="line">project(HelloWindow VERSION 0.1.0)</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨ C++17 æ ‡å‡†</span><br><span class="line">set(CMAKE_CXX_STANDARD 17)</span><br><span class="line">set(CMAKE_CXX_STANDARD_REQUIRED True)</span><br><span class="line"></span><br><span class="line"># è®¾ç½®æºä»£ç ç›®å½•å’ŒåŒ…å«ç›®å½•</span><br><span class="line">set(SOURCE_DIR &quot;$&#123;PROJECT_SOURCE_DIR&#125;/src&quot;)</span><br><span class="line">set(INCLUDE_DIR &quot;$&#123;PROJECT_SOURCE_DIR&#125;/../../include&quot;)</span><br><span class="line">set(LIBRARY_DIR &quot;$&#123;PROJECT_SOURCE_DIR&#125;/../../lib&quot;)</span><br><span class="line"></span><br><span class="line"># æ·»åŠ å¤´æ–‡ä»¶ç›®å½•</span><br><span class="line">include_directories($&#123;INCLUDE_DIR&#125;)</span><br><span class="line"></span><br><span class="line"># æŸ¥æ‰¾æºæ–‡ä»¶</span><br><span class="line">file(GLOB SOURCES &quot;$&#123;SOURCE_DIR&#125;/*.cpp&quot; &quot;$&#123;PROJECT_SOURCE_DIR&#125;/../../src/glad.c&quot;)</span><br><span class="line"></span><br><span class="line"># æ·»åŠ å¯æ‰§è¡Œæ–‡ä»¶</span><br><span class="line">add_executable($&#123;PROJECT_NAME&#125; $&#123;SOURCES&#125;)</span><br><span class="line">if(WIN32)</span><br><span class="line">    target_link_libraries($&#123;PROJECT_NAME&#125; &quot;$&#123;LIBRARY_DIR&#125;/glfw3.lib&quot;)</span><br><span class="line"></span><br><span class="line">    #åŠ¨æ€é“¾æ¥åº“æ–¹å¼ ä¸ä¼˜å…ˆè€ƒè™‘</span><br><span class="line">    #  target_link_libraries($&#123;PROJECT_NAME&#125; &quot;$&#123;LIBRARY_DIR&#125;/glfw3dll.lib&quot;)</span><br><span class="line">endif()</span><br><span class="line"></span><br><span class="line">if(APPLE)</span><br><span class="line">    target_link_libraries($&#123;PROJECT_NAME&#125; &quot;$&#123;LIBRARY_DIR&#125;/libglfw3.a&quot;)</span><br><span class="line"></span><br><span class="line">    # åŠ¨æ€é“¾æ¥åº“æ–¹å¼ ä¸ä¼˜å…ˆè€ƒè™‘</span><br><span class="line">    # target_link_libraries($&#123;PROJECT_NAME&#125; &quot;$&#123;LIBRARY_DIR&#125;/libglfw.3.dylib&quot;)</span><br><span class="line">endif()</span><br><span class="line"></span><br><span class="line"># å¦‚æœæ˜¯åœ¨è‹¹æœç³»ç»Ÿä¸Šä¸”å¦‚æœä½¿ç”¨çš„æ˜¯é™æ€é“¾æ¥çš„æ–¹å¼ï¼Œéœ€è¦é“¾æ¥é¢å¤–çš„æ¡†æ¶</span><br><span class="line">if(APPLE)</span><br><span class="line">    target_link_libraries($&#123;PROJECT_NAME&#125; &quot;-framework Cocoa&quot; &quot;-framework OpenGL&quot; &quot;-framework IOKit&quot; &quot;-framework CoreVideo&quot; &quot;-lobjc&quot;)</span><br><span class="line">endif()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>éœ€è¦æ³¨æ„</strong></p><ol><li>Windowsä¸Šä½¿ç”¨åŠ¨æ€é“¾æ¥çš„æ–¹å¼<code>target_link_libraries()</code>ä¸­libæ–‡ä»¶ä¸æ˜¯<code>glfw3.dll</code>è€Œæ˜¯<code>glfw3dll.lib</code>ï¼Œå¦å¤–ä½¿ç”¨åŠ¨æ€é“¾æ¥çš„æ–¹å¼ç¼–è¯‘æˆå¯æ‰§è¡Œç¨‹åºåï¼Œè¿˜éœ€è¦æŠŠ<code>glfw3.dll</code>æ–‡ä»¶å¤åˆ¶åˆ°å¯æ‰§è¡Œç¨‹åºæ‰€åœ¨çš„ç›®å½•ä¸‹ç¨‹åºæ‰èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚å› æ­¤ä¼˜å…ˆä½¿ç”¨é™æ€é“¾æ¥çš„æ–¹å¼</li><li>MacOSä¸Šå¦‚æœä½¿ç”¨äº†é™æ€é“¾æ¥çš„æ–¹å¼éœ€è¦é“¾æ¥é¢å¤–çš„æ¡†æ¶</li></ol><h2 id="æ„å»ºOpenGLç¨‹åº">æ„å»ºOpenGLç¨‹åº</h2><ol><li>åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºbuild<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir build</span><br><span class="line">cd build</span><br></pre></td></tr></table></figure></li><li>æ‰§è¡ŒcmakeæŒ‡ä»¤ï¼ŒæŒ‡å®šè¦æ„å»ºçš„æ–‡ä»¶ç³»ç»Ÿå’Œä½¿ç”¨çš„ç¼–è¯‘å™¨<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake .. -G Ninja -D CMAKE_C_COMPILER=clang -D CMAKE_CXX_COMPILER=clang++</span><br></pre></td></tr></table></figure></li><li>æ‰§è¡Œninja<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ninja</span><br></pre></td></tr></table></figure></li></ol><p>ç¼–è¯‘å®Œæˆä¹‹åå°±å¯ä»¥åœ¨buildç›®å½•ä¸‹æ‰¾åˆ°å¯æ‰§è¡Œç¨‹åºäº†ï¼Œèƒ½å¤Ÿæ­£å¸¸è¿è¡Œå°±è¯´æ˜OpenGLçš„å¼€å‘ç¯å¢ƒæ­å»ºå®Œæˆã€‚</p><h1>å‚è€ƒæ–‡ç« </h1><p><a href="https://learnopengl-cn.github.io">OpenGLä¸­æ–‡æ•™ç¨‹</a></p><p><a href="https://learnopengl.com/">OpenGLè‹±æ–‡æ•™ç¨‹</a></p><p><a href="https://huosk.github.io/2019/12/12/OpenGLDevWithVSCode-CMake/">VSCode+CMakeæ­å»ºOpenGLå¼€å‘ç¯å¢ƒ</a></p><p><a href="https://fdhenard.github.io/build_glfw_on_osx.html">How to build GLFW on Mac OSX 10.13 for use in xcode</a></p><p><a href="https://llvm.org/">LLVMå®˜ç½‘</a></p><p><a href="https://ninja-build.org/">Ninjaå®˜ç½‘</a></p><p><a href="https://cmake.org/">CMakeå®˜ç½‘</a></p><p><a href="https://blog.csdn.net/qq_51173321/article/details/126287293">VSCodeä¼˜åŒ–ä½¿ç”¨ä½“éªŒ</a></p><p><a href="https://blog.csdn.net/cbc000/article/details/80670413?spm=1001.2101.3001.6661.1&amp;utm_medium=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-80670413-blog-123625515.235%5Ev43%5Econtrol&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-80670413-blog-123625515.235%5Ev43%5Econtrol&amp;utm_relevant_index=1">VSCodeæ™ºèƒ½æç¤º</a></p>]]></content>
      
      
      <categories>
          
          <category> ç¡¬æŠ€èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OpenGL </tag>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºä¾èµ–æ³¨å…¥</title>
      <link href="/posts/978a7745/"/>
      <url>/posts/978a7745/</url>
      
        <content type="html"><![CDATA[<p>èµ·å› æ˜¯ï¼Œç¬”è€…åœ¨è°ƒç ”å¦‚ä½•å®ç°ä¸€å¥—é«˜æ•ˆçš„UIæ¢çš®æ¡†æ¶çš„æ—¶å€™ï¼Œæ¥è§¦åˆ°äº†ä¾èµ–æ³¨å…¥çš„æ¦‚å¿µã€‚æ‰€è°“UIæ¢çš®ï¼Œå°±æ˜¯åœ¨UIçš„äº¤äº’å’Œæ˜¾ç¤ºæ–‡æœ¬å†…å®¹ä¿¡æ¯ç­‰åŠŸèƒ½æ¨¡å—ä¸å˜çš„æƒ…å†µä¸‹ï¼Œä»…ä»…æ˜¯éœ€è¦åšç¾æœ¯èµ„æºçš„æ›¿æ¢æˆ–è€…åŠ¨ç”»çš„ä¿®æ”¹ã€‚åœ¨ç¬”è€…è¿‡å¾€çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒUIçš„äº¤äº’æ¨¡å—å’ŒåŠ¨æ•ˆæ¨¡å—å¹¶æ²¡æœ‰åˆ†å‰²ã€‚é‚£ä¹ˆå°±å¯¼è‡´äº†ä¸€ä¸ªé—®é¢˜ï¼šå½“é¡¹ç›®è¿›å…¥ä¸€ä¸ªå¤§é‡ç¾æœ¯é£æ ¼æµ‹è¯•çš„é˜¶æ®µæ—¶ï¼Œæ¯”å¦‚ï¼Œæœ‰åå¥—ç¾æœ¯é£æ ¼è¦ä¸Šçº¿æµ‹è¯•ï¼ŒæŒ‰ç…§ä¹‹å‰çš„æ–¹æ¡ˆï¼Œç¬”è€…å°±è¦å¤åˆ¶ååˆ†ç±»ä¼¼çš„é¢„åˆ¶ä½“ï¼Œç„¶åä¸ºè¿™åå¥—é¢„åˆ¶ä½“å„è‡ªç¼–å†™ä¸€å¥—æ§åˆ¶è„šæœ¬ï¼Œå¾ˆéº»çƒ¦çš„ä¸€ç‚¹æ˜¯ï¼Œé¡µé¢ä¸­çš„æŒ‰é’®ã€æ–‡æœ¬ä¿¡æ¯éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè€Œæˆ‘éœ€è¦åœ¨åä»½ä¸åŒçš„è„šæœ¬ä¸­ç¼–å†™åæ¬¡ï¼Œå¹¶ä¸”ï¼Œå½“å…¶ä¸­æŸä¸€ä¸ªæŒ‰é’®çš„ç‚¹å‡»åŠŸèƒ½æˆ–è€…æ–‡æœ¬çš„å†…å®¹å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæˆ‘å°±è¦å»æ”¹åä»½è„šæœ¬ä¸­çš„å†…å®¹ï¼Œç»´æŠ¤æˆæœ¬å®åœ¨æ˜¯å¤ªé«˜äº†ï¼Œå› æ­¤ç¬”è€…å¸Œæœ›æ‰¾åˆ°ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œèƒ½å¤Ÿå°†UIä¸­çš„åŠŸèƒ½æ¨¡å—ä¸åŠ¨æ•ˆæ¨¡å—éš”ç¦»å¼€ï¼Œåªéœ€è¦ç¼–å†™ä¸€æ¬¡åŠŸèƒ½æ¨¡å—ï¼Œè¡¨ç°æ¨¡å—ç”±äºåŠ¨ç”»å®ç°æ–¹å¼ç­‰åŸå› å¿…å®šæ˜¯è¦å®šåˆ¶çš„ã€‚ ç”±æ­¤ï¼Œç¬”è€…äº†è§£åˆ°äº†<code>Zenject</code>æˆ–è®¸å¯ä»¥è§£å†³æˆ‘ä»¬çš„é—®é¢˜ã€‚<br>æˆ‘ä»¬çš„é—®é¢˜åœ¨äºï¼Œåœ¨ä¸åŒçš„é¡µé¢ä¸­ï¼ŒæŒ‰é’®ã€æ–‡æœ¬ç­‰äº¤äº’ç»„ä»¶çš„èŠ‚ç‚¹æ˜¯æ— æ³•ä¿è¯çš„ï¼Œæ¯ä¸€ç§ç¾æœ¯é£æ ¼å¦‚ä½•å‘UIçš„äº¤äº’æ¨¡å—çš„ä»£ç ä¸­ä¼ å…¥æ­£ç¡®çš„Buttonæˆ–Textç»„ä»¶å‘¢ï¼Ÿè¿™å°±æ˜¯æˆ‘ä»¬çš„é—®é¢˜</p><h1>ä¾èµ–æ³¨å…¥</h1><p>ä¾èµ–æ³¨å…¥(Dependency Inject)æœ¬è´¨ä¸Šæ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œç¬”è€…æŒ‰ç…§ä¸ªäººçš„ç†è§£æç»˜ä¸€ä¸ªåœºæ™¯å¸®åŠ©å„ä½è¯»è€…å½¢æˆå¯¹ä¾èµ–æ³¨å…¥çš„åˆæ­¥è®¤çŸ¥ï¼šç¨‹åºåŠŸèƒ½çš„å®ç°ä¾èµ–äºå„ä¸ªç±»ä¹‹é—´çš„ååŒé…åˆï¼Œæˆ‘ä»¬é€šè¿‡ä¸€äº›è®¾è®¡åŸåˆ™ä¿è¯è¿™äº›ç±»çš„å¯ç»´æŠ¤æ€§ä¸å¯æ‹“å±•æ€§ï¼Œè®¾è®¡åŸåˆ™ä¸­æœ‰ä¸€æ¡åŸåˆ™åä¸ºå•ä¸€èŒè´£åŸåˆ™(Single Responsibility Principle)ï¼Œç°åœ¨æœ‰å¦‚ä¸‹ä¸€ä¸ªä¾‹å­:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class A&#123;</span><br><span class="line">    private B _b;</span><br><span class="line"></span><br><span class="line">    public A()&#123;</span><br><span class="line">        _b = new B();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void DoSomeThings()&#123;</span><br><span class="line">        _b.Func();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„å†™æ³•è™½ç„¶èƒ½å¤Ÿå®ç°åŠŸèƒ½ï¼Œä½†æ˜¯è¯¥ç±»çš„å¯æ‹“å±•æ€§è¢«é™ä½äº†ï¼Œè¿™æ˜¯å› ä¸ºç±»Açš„å•ä¸€èŒè´£åŸåˆ™è¢«ä¸€å®šç¨‹åº¦ä¸Šç ´åäº†ï¼Œç±»Aæœ‰ä¸¤ä¸ªèŒè´£ï¼Œä¸€æ˜¯å®ä¾‹åŒ–æˆå‘˜_bï¼ŒäºŒæ˜¯æ‰§è¡ŒDoSomeThingsæ–¹æ³•ã€‚é—´æ¥å¯¼è‡´äº†è¿™æ®µä»£ç çš„è€¦åˆå˜é«˜ã€å¯æ‹“å±•æ€§å˜å·®ã€‚è¦è§£è€¦åˆä¹Ÿå¾ˆç®€å•ï¼Œå°†ç±»Açš„èŒè´£æ‹†åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæˆå‘˜bçš„å®šä¹‰_bçš„å·¥ä½œè½¬ç§»åˆ°è¯¥ç±»å¤–é¢å»ï¼Œç„¶åé€šè¿‡æ„é€ æ–¹æ³•ä¼ å‚çš„æ–¹å¼ï¼Œå°†ç±»Bçš„å®ä¾‹åŒ–å¯¹è±¡ä¼ å…¥è¿›æ¥ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">A</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> B _b;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">A</span>(<span class="params">B b</span>)</span>&#123;</span><br><span class="line">        _b = b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoSomeThings</span>()</span>&#123;</span><br><span class="line">        _b.Func();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§è¿™æ ·çš„å†™æ³•ï¼Œåªè¦ä»»ä½•ç»§æ‰¿è‡ªBçš„ç±»ï¼Œéƒ½å¯ä»¥å¤ç”¨è¿™æ®µè„šæœ¬ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœç±»Aæ˜¯ä¸€ä¸ªé¡µé¢ç›¸å…³é€»è¾‘äº¤äº’çš„ç±»ï¼Œç±»Bæ˜¯ç»„ç»‡é¡µé¢ä¸Šä¸€äº›åŠ¨ç”»è¡¨ç°ç›¸å…³çš„ç±»ï¼Œå¯¹åŒä¸€ä¸ªé¡µé¢æ¥è¯´ï¼Œé¡µé¢ä¸Šçš„æŒ‰é’®äº¤äº’åŠŸèƒ½ã€æ˜¾ç¤ºçš„æ–‡æœ¬ä¿¡æ¯å†…å®¹åŸºæœ¬ä¸Šéƒ½æ˜¯ä¸€æ ·çš„åªæœ‰ä¸€äº›è¡¨ç°å½¢å¼ä¸Šçš„ä¸åŒï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œå¯¹äºä¸åŒè¡¨ç°å½¢å¼çš„é¡µé¢ï¼Œä»–ä»¬çš„é€»è¾‘äº¤äº’æ˜¯å¯ä»¥å¤ç”¨çš„ï¼Œåªéœ€è¦åœ¨è¿™ä¸ªç»´æŠ¤äº¤äº’é€»è¾‘çš„ç±»è¢«å®ä¾‹åŒ–çš„æ—¶å€™å°†å…·ä½“çš„è¡¨ç°å½¢å¼çš„ç±»ä¼ è¿›æ¥å°±å¯ä»¥äº†ã€‚</p><h1>å¯¹ä¾èµ–æ³¨å…¥çš„è¯¯è§£</h1><p>ä¸€å¼€å§‹æ¥è§¦ä¾èµ–æ³¨å…¥çš„æ¦‚å¿µæ—¶ä¼šæ„Ÿåˆ°å¾ˆå›°æƒ‘ï¼Œè¦å®Œå…¨ç†è§£ä¾èµ–æ³¨å…¥çš„æ€æƒ³éœ€è¦æ—¶é—´å’Œç»éªŒã€‚</p><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ä¾èµ–æ³¨å…¥çš„æ–¹å¼å¯ä»¥è½»æ¾åˆ‡æ¢ä¸€ä¸ªç»™å®šæ¥å£çš„ä¸åŒå®ç°ã€‚ç„¶è€Œè¿™åªæ˜¯ä¾èµ–æ³¨å…¥æ‰€èƒ½æä¾›çš„ä¼—å¤šå¥½å¤„ä¹‹ä¸€ã€‚æ›´é‡è¦çš„æ˜¯ä¾èµ–æ³¨å…¥çš„æ¡†æ¶å…è®¸æˆ‘ä»¬æ›´å®¹æ˜“éµå¾ªå•ä¸€èŒè´£åŸåˆ™ã€‚é€šè¿‡è®©ä¾èµ–æ³¨å…¥æ¡†æ¶æ¥å…³å¿ƒå°†ç±»è¿æ¥èµ·æ¥ï¼Œæ¯ä¸ªç±»æœ¬èº«å¯ä»¥åªå…³å¿ƒå±¥è¡Œè‡ªå·±çš„èŒè´£ã€‚</p><p>å¦ä¸€ä¸ªå¯¹äºåˆšåˆšæ¥è§¦DIçš„äººæ‰€çŠ¯æ™®éçš„é”™è¯¯æ˜¯ï¼Œä»–ä»¬ä¼šä»æ¯ä¸ªç±»é‡Œé¢æå–æ¥å£ï¼Œç„¶ååˆ°å¤„ä½¿ç”¨æ¥å£ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ç±»ã€‚æˆ‘ä»¬ä½¿ç”¨ä¾èµ–æ³¨å…¥çš„ç›®æ ‡æ˜¯è®©æˆ‘ä»¬çš„ä»£ç è§£è€¦åˆï¼Œæ‰€ä»¥æˆ‘ä»¬è®¤ä¸ºå°†ä¸€ä¸ªç±»ä¸æ¥å£ç»‘å®šæ¯”å°†ä¸€ä¸ªç±»ä¸å¦ä¸€ä¸ªç±»ç»‘å®šæ˜¯æ›´åŠ åˆç†çš„ã€‚ç„¶è€Œï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç¨‹åºä¸­çš„å„ç§åŠŸèƒ½éƒ½æ˜¯ç”±ä¸€ä¸ªå…·ä½“çš„ç±»æ¥å®ç°ä»–ä»¬çš„ï¼Œæå–æ¥å£çš„è¡Œä¸ºä»…ä»…ä¼šæ˜¯å¢åŠ äº†ä¸å¿…è¦çš„ç»´æŠ¤æˆæœ¬ã€‚è€Œä¸”ï¼Œå…·ä½“ç±»çš„å…¬å…±æˆå‘˜å·²ç»é€šè¿‡å®ƒçš„å…¬å…±æˆå‘˜å®šä¹‰äº†ä¸€ä¸ªæ¥å£ã€‚ä¸€ä¸ªå¥½çš„ç»éªŒæ³•åˆ™æ˜¯ï¼Œåªæœ‰åœ¨ä¸€ä¸ªç±»æœ‰è¶…è¿‡ä¸€ä¸ªå®ç°æˆ–è€…åœ¨æœªæ¥ä¼šæœ‰å¤šä¸ªå®ç°çš„æƒ…å†µä¸‹æ‰åˆ›å»ºæ¥å£ã€‚é¡ºå¸¦ä¸€æï¼Œè¿™ç§åŸåˆ™å«ä½œå¤ç”¨æŠ½è±¡åŸåˆ™(Reused Abstraction Principle)ã€‚</p><p>ä¾èµ–æ³¨å…¥çš„å…¶ä»–å¥½å¤„åŒ…æ‹¬ï¼š</p><ul><li>å¯é‡æ„æ€§(Refactorability)å½“ä»£ç æ˜¯æ¾è€¦åˆçš„æ—¶å€™ï¼Œæ­£ç¡®ä½¿ç”¨DIçš„æ—¶å€™å°±æ˜¯è¿™æ ·ï¼Œæ•´ä¸ªä»£ç åº“ä¼šæ›´åŠ æœ‰å¼¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å®Œå…¨ä¿®ä¸ªä»£ç åº“çš„æŸä¸€ä¸ªéƒ¨åˆ†è€Œä¸ä¼šå¯¹å…¶ä»–éƒ¨åˆ†äº§ç”Ÿä»»ä½•å½±å“ã€‚</li><li>é¼“åŠ±æ¨¡å—åŒ–ä»£ç (Encourage modular code)ä½¿ç”¨DIæ¡†æ¶æ—¶ï¼Œä½ ä¼šå¾ˆè‡ªç„¶åœ°éµå¾ªæ›´å¥½çš„è®¾è®¡å®è·µï¼Œå› ä¸ºDIä¼šè¿«ä½¿ä½ å»æ€è€ƒç±»ä¹‹é—´çš„æ¥å£ä¾èµ–å…³ç³»ã€‚</li><li>å¯æµ‹è¯•æ€§(Testability) ç¼–å†™å•å…ƒæµ‹è¯•æˆ–è€…ç”¨æˆ·é©±åŠ¨æµ‹è¯•å˜å¾—ååˆ†å®¹æ˜“ï¼Œå› ä¸ºè¿™åªæ˜¯ç¼–å†™ä¸åŒç»„åˆæ ¹(composition root)çš„äº‹æƒ…ï¼Œé€šè¿‡ç¼–å†™ä¸åŒçš„ç»„åˆæ ¹å°±èƒ½ç»„åˆä¸åŒçš„ä¾èµ–ã€‚æƒ³è¦åªæµ‹è¯•ä¸€ä¸ªå­ç³»ç»Ÿï¼Ÿåªéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ç»„åˆæ ¹å°±å¯ä»¥äº†ã€‚</li></ul><h1>Zenjectæ¦‚å¿µ</h1><p>å½“æˆ‘ä»¬åœ¨ç¼–å†™ä¸€ä¸ªå•ç‹¬çš„ç±»æ¥å®ç°æŸä¸ªåŠŸèƒ½çš„æ—¶å€™ï¼Œå®ƒå¤§æ¦‚ç‡éœ€è¦</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Foo</span></span><br><span class="line">&#123;</span><br><span class="line">    ISomeS</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>HelloWorld</h1><p>æœ¬å°èŠ‚å°†ä½¿ç”¨Zenjectæ¡†æ¶ç¼–å†™ä¸€ä¸ªHelloWorldï¼Œ<br>æŒ‰ç…§Zenjectçš„HelloWorldæ•™ç¨‹ç¼–å†™ä¹‹åï¼Œç¡®å®èƒ½è¾“å‡ºHelloWorldï¼Œä¸è¿‡ç¬”è€…æœ‰å‡ ä¸ªç–‘é—®ï¼Œé¦–å…ˆæ˜¯æŒ‰ç…§Zenjectçš„å®˜æ–¹è¯´æ³•ï¼ŒZenjectå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªContainerï¼Œæ‰€æœ‰ç”±Zenjectåˆ›å»ºçš„å®ä¾‹éƒ½ä¼šå­˜æ”¾åœ¨è¿™ä¸ªContainerä¸­ï¼Œé‚£ä¹ˆæˆ‘è¯¥å¦‚ä½•è®¿é—®åˆ°Containerç±»ä¸­çš„å®ä¾‹å‘¢ï¼Ÿ<br>ä¸‹é¢å†æ¥ä¸€ä¸ªä¾‹å­:<br>åœ¨åœºæ™¯ä¸­æ·»åŠ ä¸€ä¸ªç©ºç‰©ä½“å¹¶æŒ‚è½½ä¸‹é¢è¿™ä¸ªè„šæœ¬ï¼Œè¿™ä¸ªè„šæœ¬ä¸­ä½¿ç”¨[Inject]ç‰¹æ€§æ ‡è®°äº†Constructæ–¹æ³•ï¼Œå¦‚æœåœ¨Awakeã€Startå’ŒConstructæ–¹æ³•ä¸Šæ‰“æ–­ç‚¹çš„è¯ï¼ŒConstructä¼šå…ˆäºAwakeæ‰§è¡Œï¼Œè¯·æ³¨æ„ï¼Œè¿™æ˜¯ç‰©ä½“åœ¨æ¸¸æˆå¯åŠ¨æ—¶å°±åœ¨åœºæ™¯ä¸­çš„æƒ…å†µï¼Œä½†æ˜¯å¦‚æœç‰©ä½“æ˜¯åœ¨è¿è¡Œäº†ä¸€æ®µæ—¶é—´åè¢«åŠ¨æ€åŠ è½½ä¸Šæ¥çš„ï¼Œæ‰§è¡Œä¸‹é¢è¿™ä¸ªè„šæœ¬å°±ä¼šæŠ¥é”™äº†ï¼Œè¿˜éœ€è¦çœ‹ä¸€ä¸‹æ˜¯ä»€ä¹ˆåŸå› ã€‚</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> Zenject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Test</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">      <span class="keyword">private</span>  Greeter _greeter;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">private</span> <span class="built_in">float</span> _timer;</span><br><span class="line">      [<span class="meta">Inject</span>]</span><br><span class="line">      <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Construct</span>(<span class="params">Greeter greeter</span>)</span></span><br><span class="line">      &#123;</span><br><span class="line">            _greeter = greeter;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">      &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">      &#123; </span><br><span class="line">           </span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">      &#123;</span><br><span class="line">            _timer += Time.deltaTime;</span><br><span class="line">            <span class="keyword">if</span> (_timer &gt;= <span class="number">1f</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                  _greeter.Log();</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>å‡ ç§æ³¨å…¥æ–¹å¼</h1><h2 id="æ„é€ å™¨æ³¨å…¥">æ„é€ å™¨æ³¨å…¥</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Foo</span>&#123;</span><br><span class="line">    IBar _bar;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Foo</span>(<span class="params">IBar bar</span>)</span>&#123;</span><br><span class="line">        _bar = bar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å­—æ®µæ³¨å…¥">å­—æ®µæ³¨å…¥</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Foo</span>&#123;</span><br><span class="line">    [<span class="meta">Inject</span>]</span><br><span class="line">    IBar _bar;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å­—æ®µçš„æ³¨å…¥å‘ç”Ÿåœ¨æ„é€ å‡½æ•°è°ƒç”¨ä¹‹åã€‚æ‰€æœ‰è¢«æ ‡è®°äº†[Inject]ç‰¹æ€§çš„å­—æ®µéƒ½ä¼šåœ¨å®¹å™¨ä¸­æŸ¥æ‰¾å¹¶ç»™å®šä¸€ä¸ªå€¼ã€‚æ— è®ºè¿™ä¸ªå­—æ®µæ˜¯privateè¿˜æ˜¯publicæ–¹æ³•ï¼Œæ³¨å…¥éƒ½ä¼šå‘ç”Ÿ</p><h2 id="Property-Injection">Property Injection</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Foo</span>&#123;</span><br><span class="line">    [<span class="meta">Inject</span>]</span><br><span class="line">    <span class="keyword">public</span> IBar Bar&#123;</span><br><span class="line">        <span class="keyword">get</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">set</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>PropertyInjectionå’Œå­—æ®µçš„æƒ…å†µä¸€æ ·ï¼ŒåŒæ ·çš„ï¼Œæ— è®ºsetter/getteræ˜¯publicè¿˜æ˜¯privateæ³¨å…¥éƒ½ä¼šå‘ç”Ÿ</p><h2 id="Method-Injection">Method Injection</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Foo</span>&#123;</span><br><span class="line">    IBar _bar;</span><br><span class="line">    Qux _qux;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Inject</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Init</span>(<span class="params">IBar bar, Qux qux</span>)</span>&#123;</span><br><span class="line">        _bar = bar;</span><br><span class="line">        _qux = qux;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Method Injectå’Œæ„é€ å‡½æ•°æ³¨å…¥ååˆ†ç›¸ä¼¼</p><p>ä¸€äº›éœ€è¦è¯´æ˜çš„ï¼š</p><ul><li>å¯¹äºç»§æ‰¿è‡ªMonoBehaviourçš„è„šæœ¬æ¥è¯´ï¼Œæ›´æ¨èä½¿ç”¨Methodæ³¨å…¥çš„æ–¹å¼ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•æ“ä½œMonoBehaviourçš„æ„é€ å‡½æ•°ã€‚</li><li>å¯ä»¥å°†ä»»æ„æ•°é‡çš„Methodæ ‡è®°ä¸ºInjectï¼Œä¸è¿‡è¿™äº›Methodè¢«Injectçš„é¡ºåºæ˜¯ä»åŸºç±»åˆ°å­ç±»çš„ã€‚è¿™ç§è®¾è®¡æœ‰åˆ©äºé¿å…ï¼ŒåŒæ—¶ç¡®ä¿äº†åŸºç±»ä¸­çš„æ–¹æ³•é¦–å…ˆå®Œæˆæ³¨å…¥ï¼Œå°±è·Ÿæ„é€ æ–¹æ³•çš„æ‰§è¡Œé¡ºåºä¸€æ ·ã€‚</li><li>InjectMethodåœ¨æ‰€æœ‰å…¶ä»–æ³¨å…¥ç±»å‹æ³¨å…¥å®Œæˆåå®Œæˆæ³¨å…¥</li><li>ä½ å¯ä»¥å®‰å…¨åœ°å‡å®šï¼ˆä¸€ç§æƒ…å†µé™¤å¤–ï¼šä½ çš„ä»£ç ä¸­å­˜åœ¨å¾ªç¯ä¾èµ–ï¼‰ã€‚</li><li>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨æ³¨å…¥æ–¹æ³•æ¥æ‰§è¡Œåˆå§‹åŒ–é€»è¾‘é€šå¸¸ä¸æ˜¯ä¸€ä¸ªå¥½çš„æ–¹æ³•ã€‚æ›´æ¨èçš„æ–¹å¼æ˜¯ä½¿ç”¨IInitializable.Initializeæˆ–è€…Start()æ–¹æ³•ï¼Œå› ä¸ºè¿™æ ·å…è®¸ä½ é¦–å…ˆåˆ›å»ºæ•´ä¸ªåˆå§‹å¯¹è±¡å›¾ã€‚</li></ul><p>æ¨è<br>è·Ÿå­—æ®µ/å±æ€§æ³¨å…¥æ¯”èµ·æ¥ï¼Œä½¿ç”¨æ„é€ æ–¹æ³•å’Œå±æ€§æ³¨å…¥çš„æ–¹å¼æ›´åŠ æ¨è</p><ul><li>æ„é€ æ–¹æ³•æ³¨å…¥å¼ºè¿«è¯¥æ„é€ æ–¹æ³•çš„ä¾èµ–åªåœ¨è¯¥ç±»è¢«åˆ›å»ºçš„æ—¶å€™æŒ‡å®šä¸€æ¬¡ï¼Œè¿™é€šå¸¸æ˜¯ä½ æƒ³è¦çš„ã€‚åœ¨å¤§å¤šæ•°çš„æƒ…å†µä¸‹ï¼Œä½ å¹¶ä¸æƒ³æš´éœ²ä¸€ä¸ªå…¬å…±çš„å±æ€§</li></ul><h1>å‘ä¾èµ–æ³¨å…¥å®¹å™¨ä¸­æ³¨å†Œæ˜ å°„å…³ç³»</h1><p>ä¾èµ–æ³¨å…¥æ¡†æ¶çš„æ ¸å¿ƒå°±æ˜¯DI containerã€‚ å®ƒæœ€ç®€å•çš„å½¢å¼å°±æ˜¯ä¸€ä¸ªæŒæœ‰æ‰€æœ‰æ³¨å†Œé¡¹ç›®çš„å­—å…¸ï¼Œæœ¬èŠ‚æˆ‘ä»¬å°†å°è¯•ä½¿ç”¨ï¼Œåœ¨Zenjectä¸­ï¼Œè¿™è¢«å«åšbinding(ç»‘å®šå…³ç³»)ã€‚å› ä¸ºå®ƒåœ¨æŠ½è±¡ç±»å‹å’Œå…·ä½“ç±»å‹ä¹‹é—´åˆ›å»ºäº†ç»‘å®šå…³ç³»ã€‚</p><h2 id="Binding">Binding</h2><p>æ¯ä¸ªä¾èµ–æ³¨å…¥æ¡†æ¶çš„æœ€ç»ˆå½¢æ€å°±æ˜¯ä¸€ä¸ªå°†ç±»å‹å’Œå®ä¾‹ç»‘å®šèµ·æ¥çš„æ¡†æ¶ã€‚</p><p>åœ¨Zenjectä¸­ï¼Œä¾èµ–æ˜ å°„é€šè¿‡å‘ä¸€ä¸ªåä¸ºcontainer(å®¹å™¨)çš„ç»“æ„ä¸­æ·»åŠ ç»‘å®šå…³ç³»æ¥å®Œæˆã€‚æ·»åŠ å®Œæ˜ å°„å…³ç³»ä¹‹åï¼Œè¿™ä¸ªå®¹å™¨å°±çŸ¥é“äº†å¦‚ä½•åœ¨ä½ çš„Applicationä¸­åˆ›å»ºæ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ï¼Œé€šè¿‡é€’å½’åœ°è§£å†³ç»™å®šç‰©ä½“ä¸Šçš„æ‰€æœ‰çš„ä¾èµ–ã€‚</p><p>å½“è¿™ä¸ªå®¹å™¨è¢«è¦æ±‚ç”¨ä¸€ä¸ªç»™å®šçš„ç±»å‹æ„å»ºä¸€ä¸ªå®ä¾‹ï¼Œè¿™ä¸ªå®¹å™¨ä½¿ç”¨åå°„æ¥æ‰¾åˆ°è¿™ä¸ªç±»çš„æ„é€ æ–¹æ³•ä¸­çš„å‚æ•°å’Œæ‰€æœ‰è¢«æ ‡è®°äº†<code>[Inject]</code>ç‰¹æ€§çš„å­—æ®µ/å±æ€§ã€‚ç„¶åè¿™ä¸ªå®¹å™¨ä¼šå°è¯•è§£å†³æ¯ä¸€ä¸ªéœ€è¦çš„å®ƒç”¨æ¥ä¾èµ–ï¼Œ</p><p>å› æ­¤æ¯ä¸€ä¸ªZenject applicationå¿…é¡»å‘Šè¯‰å®¹å™¨å¦‚ä½•å†³å®šæ¯ä¸€ä¸ªä¾èµ–ï¼Œé€šè¿‡<code>Bind command</code>çš„æ–¹å¼ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Foo</span></span><br><span class="line">&#123;</span><br><span class="line">    IBar _bar;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Foo</span>(<span class="params">IBar bar</span>)</span>&#123;</span><br><span class="line">        _bar = bar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç æ¥è¿æ¥è¿™ä¸ªç±»ä¸­çš„ä¾èµ–é¡¹ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Container.Bind&lt;Foo&gt;.AsSingle();</span><br><span class="line">Container.Bind&lt;IBar&gt;().To&lt;Bar&gt;.AsSingle();</span><br></pre></td></tr></table></figure><p>è¿™å‘Šè¯‰Zenjectæ¯ä¸€ä¸ªéœ€è¦ç±»å‹Fooçš„ä¾èµ–åº”è¯¥ä½¿ç”¨åŒæ ·çš„å®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹å°†ä¼šåœ¨éœ€è¦çš„æ—¶å€™è‡ªåŠ¨åˆ›å»ºã€‚ç±»ä¼¼åœ°ï¼Œä»»ä½•éœ€è¦IBarå’Œæ¥å£çš„ç±»å°†ä¼šè¢«åˆ†é…åŒæ ·çš„Barç±»å‹çš„å®ä¾‹ã€‚</p><p>å®Œæ•´çš„<code>Bind Command</code>å½¢å¼å¦‚ä¸‹ã€‚éœ€è¦æŒ‡æ˜å¤§éƒ¨åˆ†çš„æƒ…å†µæˆ‘ä»¬å°†ä¸å›ç”¨åˆ°ä»¥ä¸‹æ‰€æœ‰çš„æ–¹æ³•ï¼Œå½“æ²¡æœ‰æŒ‡æ˜è°ƒç”¨æŸäº›æ–¹æ³•çš„æ—¶å€™ï¼Œå°†ä¼šä½¿ç”¨é»˜è®¤å€¼</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Container.Bind&lt;ContractType&gt;()</span><br><span class="line">    .WithId(Identifier)</span><br><span class="line">    .To&lt;ResultType&gt;()</span><br><span class="line">    .FromConstructionMethod()</span><br><span class="line">    .AsScope()</span><br><span class="line">    .WithArguments(Arguments)</span><br><span class="line">    .OnInstantiated(InstantiatedCallback)</span><br><span class="line">    .When(Condition)</span><br><span class="line">    .(Copy|Move)Into(All|Direct)SubContainers()</span><br><span class="line">    .NonLazy()</span><br><span class="line">    .IfNotBound();</span><br></pre></td></tr></table></figure><p>ä¸‹é¢è§£é‡Šä¸€ä¸‹å„ä¸ªMethodçš„å«ä¹‰:</p><ul><li>ContractType: é‚£äº›åœ¨è„šæœ¬ä¸­è¢«æ ‡è®°äº†Injectçš„å‚æ•°æˆ–è€…å­—æ®µï¼Œå…¶ç±»å‹ä¼šè¡¨ç°ä¸ºContractTypeã€‚</li><li>ResultType:<br>é»˜è®¤å€¼ç­‰äºContractType<br>ResultTypeå¿…é¡»ç­‰ä»·ä¸ContractTypeæˆ–è€…æ´¾ç”Ÿè‡ªContractTypeã€‚</li><li>Identifier è¯¥å€¼å¯ä»¥ç»™è¿™ä¸ªç»‘å®šæ“ä½œä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„IDï¼Œä¸è¿‡åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹æˆ‘ä»¬ä¸éœ€è¦è¿›è¡Œç»™å®šIDçš„æ“ä½œã€‚æ­¤å€¼å°†ç”±æŒ‡å®šçš„ ConstructionMethod ç”¨äºæ£€ç´¢è¯¥ç±»å‹çš„å®ä¾‹ã€‚</li><li>FromConstructionMethod</li><li>Scope</li><li></li></ul><h2 id="æ„Ÿæ‚Ÿ">æ„Ÿæ‚Ÿ</h2><p>çœ‹äº†ä¸€æ®µæ—¶é—´Zenjectçš„ä»£ç ï¼Œæ„Ÿå—åˆ°äº†æ¥å£æ¦‚å¿µçš„å¼•å…¥å¸¦ç»™é¢å‘å¯¹è±¡å¼€å‘å¸¦æ¥çš„æ‹“å±•æ€§ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FooFactory</span> : <span class="title">IFactory</span>&lt;<span class="title">Foo</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Foo <span class="title">Create</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Foo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">InstallBindings</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    Container.Bind&lt;Foo&gt;().FromIFactory(x =&gt; x.To&lt;FooFactory&gt;().FromSubContainerResolve().ByMethod(InstallFooFactory)).AsSingle();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InstallFooFactory</span>(<span class="params">DiContainer subContainer</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    subContainer.Bind&lt;FooFactory&gt;().AsSingle();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªç±»åªèƒ½å¤Ÿç»§æ‰¿è‡ªä¸€ä¸ªç±»ï¼Œå¯¹äºåƒZenjectè¿™ç§è¾…åŠ©æ€§è´¨çš„æ¡†æ¶ï¼Œå®ƒæ²¡å¿…è¦çŸ¥é“æ¯ä¸€ä¸ªéœ€è¦ä¾èµ–æ³¨å…¥çš„ç±»åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå®ƒçš„å…·ä½“ç»†èŠ‚ï¼ŒZenjectåªå…³å¿ƒè¿™ä¸ªç±»å¯ä»¥è¢«ä¾èµ–æ³¨å…¥ï¼Œå¦‚æœä¸ºäº†å¼•å…¥Zenjectæ¡†æ¶è€Œéœ€è¦ç»™æ‰€æœ‰è¦ä¾èµ–æ³¨å…¥çš„ç±»éƒ½æ·»åŠ ä¸€ä¸ªåŸºç±»ï¼Œé‚£ä¹ˆä»£ç çš„å¯æ‹“å±•æ€§å°±å¤ªå·®äº†ï¼Œä½¿ç”¨æ¥å£å°±æ²¡æœ‰è¿™ç§é—®é¢˜äº†ï¼ŒZenjectå¯ä»¥é€šè¿‡æŒæœ‰æ¥å£çš„æ–¹å¼é—´æ¥æŒæœ‰è¯¥ç±»ï¼ŒåŒæ ·çš„ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å°±å¯ä»¥é€šè¿‡å¤šç§ä¸åŒçš„æ¥å£æ¥è¢«é—´æ¥åœ°æŒæœ‰ã€‚</p><h1>å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://www.sebaslab.com/ioc-container-unity-part-1/">Inversion of Control with Unity â€“ part 1</a></li><li><a href="https://www.sebaslab.com/ioc-container-unity-part-2/">Inversion of Control with Unity â€“ part 2</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> è½¯æŠ€èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¸¸æˆç²¾ç»†åŒ–è¿­ä»£ä¸­ç¾æœ¯é£æ ¼ç®¡ç†æ¡†æ¶</title>
      <link href="/posts/562d8b72/"/>
      <url>/posts/562d8b72/</url>
      
        <content type="html"><![CDATA[<h1>æ¡†æ¶æ•´ç†</h1><h2 id="æ¡†æ¶èŒè´£">æ¡†æ¶èŒè´£</h2><ul><li>æ–°å¢ä¸€å¥—ç¾æœ¯é£æ ¼</li><li>åˆ é™¤ä¸€å¥—ç¾æœ¯é£æ ¼</li><li>æ–°å¢æŸä¸€ç¾æœ¯é£æ ¼ä¸€ç±»åŠ¨æ•ˆ</li><li>åˆ é™¤æŸä¸€ç¾æœ¯é£æ ¼çš„æŸä¸€ç±»åŠ¨æ•ˆ</li><li>æ–°å¢æŸä¸€ç¾æœ¯é£æ ¼æŸä¸€ç±»åŠ¨æ•ˆçš„æ–°é£æ ¼</li><li>åˆ é™¤æŸä¸€ç¾æœ¯é£æ ¼çš„æŸç±»åŠ¨æ•ˆçš„æŸä¸€ä¸ªé£æ ¼</li><li>æ–°å¢æŸä¸€ç¾æœ¯é£æ ¼ä¸‹çš„å®çŸ³å—çš„é£æ ¼</li><li>åˆ é™¤æŸä¸€ç¾æœ¯é£æ ¼ä¸‹çš„å®çŸ³å—çš„æŸä¸€é£æ ¼</li><li>æ–°å¢ä¸€å¥—è¿è¡Œæ—¶ç¾æœ¯é£æ ¼åˆ‡æ¢ç­–ç•¥(ç¾æœ¯é£æ ¼æ‰¿æ¥ç­–ç•¥)</li><li>åˆ é™¤ä¸€å¥—è¿è¡Œæ—¶ç¾æœ¯é£æ ¼åˆ‡æ¢ç­–ç•¥(ç¾æœ¯é£æ ¼æ‰¿æ¥ç­–ç•¥)</li><li>æ–°å¢æŸä¸€ç¾æœ¯é£æ ¼ä¸‹æŸä¸€é¡µé¢ä¸Šçš„äº¤äº’/è¡¨ç°ç»„ä»¶</li><li>åˆ é™¤æŸä¸€ç¾æœ¯é£æ ¼ä¸‹æŸä¸€é¡µé¢ä¸Šçš„äº¤äº’/è¡¨ç°ç»„ä»¶<br>å®éªŒå­—æ®µåˆ†ç±»<br>é£æ ¼ç®¡ç†æ¡†æ¶æ˜¯å¯¹ä»¥ä¸‹å…­ç±»å®éªŒçš„ç®¡ç†å’Œç»„ç»‡:</li></ul><ol><li>ç¾æœ¯é£æ ¼å®éªŒå­—æ®µ,æœ‰äº›å­—æ®µæ˜¯å•çº¯çš„æ§åˆ¶ç¾æœ¯é£æ ¼çš„(ç¾æœ¯é£æ ¼å®éªŒå­—æ®µ), åº”è¯¥è¦ä¿è¯è¿™äº›å®éªŒå­—æ®µä¸­åªæœ‰ä¸€ä¸ªæ˜¯ç”Ÿæ•ˆçš„(åšä¿åº•å’Œå†²çªæ£€æŸ¥) (çº¦æŸç®¡ç†åˆå§‹ç¾æœ¯é£æ ¼çš„å®éªŒå­—æ®µ)</li><li>ç¾æœ¯é£æ ¼ç­–ç•¥å®éªŒ,æŸäº›å®éªŒå­—æ®µå¤©ç”Ÿä¼šå¸¦ä¸€äº›é€»è¾‘(ç´ ææ‰¿æ¥å®éªŒå­—æ®µ),åœ¨è¿è¡Œæ—¶ä¼šåˆ‡æ¢ç¾æœ¯é£æ ¼, åœ¨é£æ ¼ç®¡ç†æ¡†æ¶ä¸­å°†è¿™ç±»å®éªŒå­—æ®µæ˜ å°„ä¸ºä¸€å¥—ç­–ç•¥, ä¹Ÿè®¸Sessionå†…ä¼šæœ‰å¤šä¸ªå¯ä»¥ç”Ÿæ•ˆçš„ç¾æœ¯é£æ ¼åˆ‡æ¢ç­–ç•¥,åªä¼šæœ‰ä¸€ä¸ªå­—æ®µçœŸæ­£ç”Ÿæ•ˆ,æ‰€ä»¥è¦åšä¿åº•å’Œå†²çªæ£€æŸ¥ (çº¦æŸSessionå†…æ›´æ–°ç¾æœ¯é£æ ¼çš„å®éªŒå­—æ®µ)</li><li>ç‰¹å®šé£æ ¼ç‰¹å®šåŠ¨æ•ˆå®éªŒå­—æ®µ,æœ‰ä¸€äº›å®éªŒå­—æ®µæ˜¯åœ¨æŸä¸€ç¾æœ¯é£æ ¼ä¸Šçš„æŸä¸€åŠ¨æ•ˆä¸Šåšå®éªŒ çº¦æŸå¼€å‘è€…ä½¿å…¶çŸ¥æ™“è‡ªå·±æ‰€åšçš„è¿™å—ä¼šå½±å“å“ªäº›é£æ ¼ å¢åŠ ä¸€ä¸ªCareExperimentå­—æ®µ, å½“è¦å»åˆ¤æ–­GetABTestGroupçš„æ—¶å€™éœ€è¦åˆ¤è¿™ä¸ªå®éªŒå­—æ®µåœ¨ä¸åœ¨Care Experimenté‡Œé¢,å¦‚æœä¸åœ¨çš„è¯ å…œåº•+æŠ¥é”™</li><li>ç‰¹å®šé£æ ¼ç‰¹å®šé¡µé¢å®éªŒå­—æ®µ,åœ¨æŸä¸€ç¾æœ¯é£æ ¼çš„é¡µé¢ä¸Šå¢åŠ æ–°çš„åŠŸèƒ½æ¨¡å—oré¡µé¢è¡¨ç°çš„</li><li>åŒä¸€é¡µé¢çš„ä¸åŒæ ·å¼å®éªŒå­—æ®µ, åŒä¸€ç¾æœ¯é£æ ¼ä¸‹çš„å¤šä¸ªéšç§å¼¹çª—,è¿™éƒ¨åˆ†å®éªŒå­—æ®µåº”è¯¥åœ¨å‘UIManagerä¸­æ³¨å†ŒUIInfoæ—¶ç»„ç»‡ä¸€ä¸‹é€»è¾‘</li><li>å®çŸ³å—é£æ ¼å®éªŒå­—æ®µ<br>å…¶ä¸­ 3ã€4ã€5ã€6å®éªŒå­—æ®µçš„ç”Ÿæ•ˆæ˜¯ä»¥ç‰¹å®šç¾æœ¯é£æ ¼å®éªŒå­—æ®µç”Ÿæ•ˆä¸ºå‰æçš„,å› æ­¤æ¡†æ¶ç»„è¦å¼€å‘è€…æ‰‹åŠ¨ç»´æŠ¤ç¾æœ¯é£æ ¼å­—æ®µä¸è¯¥ç¾æœ¯é£æ ¼å­—æ®µä¸‹3ã€4ã€5ã€6å®éªŒå­—æ®µçš„å…³ç³».<br>æ¡†æ¶ç»“æ„<br>æš‚æ—¶æ— æ³•åœ¨é£ä¹¦æ–‡æ¡£å¤–å±•ç¤ºæ­¤å†…å®¹</li><li>è§£ææ‰€æœ‰ä»£è¡¨è¿è¡Œæ—¶ç¾æœ¯é£æ ¼ç­–ç•¥åˆ‡æ¢çš„å®éªŒå­—æ®µ(å†²çªæ£€æŸ¥),å¾—åˆ°ä¸€ä¸ªæœ€ç»ˆç”Ÿæ•ˆçš„è¿è¡Œæ—¶ç¾æœ¯é£æ ¼åˆ‡æ¢ç­–ç•¥</li><li>æ¡†æ¶é¦–å…ˆè§£ææ‰€æœ‰ä»£è¡¨ç¾æœ¯é£æ ¼çš„å®éªŒå­—æ®µ(å†²çªæ£€æŸ¥),å¾—åˆ°ä¸€ä¸ªæœ€ç»ˆç”Ÿæ•ˆçš„ç¾æœ¯é£æ ¼,è¿›è€Œå¾—åˆ°è¯¥é£æ ¼ä¸‹å…³å¿ƒçš„å®éªŒå­—æ®µæ¸…å•,ä¸‹é¢çš„ç¯èŠ‚ä¸­å¦‚æœéœ€è¦è®¿é—®ABTest,å¿…é¡»ä»è¯¥æ¸…å•é—´æ¥è®¿é—®GameABTest,ä¸å¯ä»¥ç›´æ¥è®¿é—®</li><li>æ ¹æ®2ä¸­å¾—åˆ°çš„ç¾æœ¯é£æ ¼å¾—åˆ°å„åŠ¨æ•ˆã€å®çŸ³ã€é¡µé¢å—é£æ ¼çš„è§£æç­–ç•¥(å†²çªæ£€æŸ¥,è§£æç­–ç•¥ä¸­ç»„ç»‡å®éªŒé€»è¾‘),å¾—åˆ°æœ€ç»ˆå„ä¸ªåŠ¨æ•ˆã€å®çŸ³å—ç”Ÿæ•ˆç¾æœ¯é£æ ¼å’Œé¡µé¢çš„UIInfo</li><li>æ ¹æ®3ä¸­å¾—åˆ°çš„é¡µé¢ç”Ÿæ•ˆé£æ ¼,æ‰¾åˆ°è¯¥å¥—é¡µé¢é£æ ¼çš„ä¿¡æ¯(é¢„åˆ¶ä½“ã€Logicã€UIElementsã€UIStg)å‘UIManagerä¸­æ³¨å†Œ</li><li>æ ¹æ®3ä¸­å¾—åˆ°çš„å„åŠ¨æ•ˆç­–ç•¥,å‘EffectManagerä¸­ç­–å„åŠ¨æ•ˆä¿¡æ¯</li><li>æ ¹æ®3ä¸­å¾—åˆ°çš„å®çŸ³å—ç­–ç•¥,å‘BlockGem Managerä¸­æ³¨å†Œå„å®çŸ³å—çš„é£æ ¼ä¿¡æ¯</li><li>æ ¹æ®2ä¸­å¾—åˆ°çš„ç¾æœ¯é£æ ¼ç­–ç•¥,åœ¨ç‰¹å®šæ—¶æœºæ‰§è¡Œç¾æœ¯é£æ ¼åˆ‡æ¢é€»è¾‘(å¦‚æœç¾æœ¯é£æ ¼åˆ‡æ¢ç­–ç•¥ä¸æ˜¯åˆ‡æ¢é¡µé¢çš„ç¾æœ¯é£æ ¼è€Œæ˜¯è¦åˆ‡æ¢æŸä¸ªåŠ¨æ•ˆ/å®çŸ³å—çš„é£æ ¼,éœ€è¦åšç¾æœ¯é£æ ¼å’Œè¦åˆ‡æ¢åŠ¨æ•ˆçš„é£æ ¼ä¸€è‡´æ€§æ£€æŸ¥)</li><li>æ‰“å¼€æŸä¸€é¡µé¢çš„æ—¶å€™,æ ¹æ®è¯¥é¡µé¢çš„Stg(ä¸ºæ¯ä¸€ä¸ªUILogicéƒ½å®ç°ä¸€ä¸ªStgæœ‰ç‚¹ç¹çäº†,åœ¨ç‰¹å®šç¾æœ¯é£æ ¼ç‰¹å®šUILogicä¸­ç›´æ¥è®¿é—®é£æ ¼æ¡†æ¶çš„ABæµ‹è§£è€¦æ¨¡å—ä¹Ÿæ˜¯å¯ä»¥çš„)åšè¡¨ç°</li><li>éŸ³æ•ˆé£æ ¼ä¹Ÿéœ€è¦åŠ å…¥</li></ol><h2 id="æ¡†æ¶è®¾è®¡">æ¡†æ¶è®¾è®¡</h2><p>é£æ ¼è§£ææ¨¡å—è®¾è®¡</p><ul><li>é¡µé¢ç¾æœ¯é£æ ¼æšä¸¾</li><li>æ¯ä¸ªç¾æœ¯é£æ ¼å…³å¿ƒçš„å®éªŒæ¸…å•</li><li>ABæµ‹è§£è€¦æ¨¡å—,ä¼ å…¥ç¾æœ¯é£æ ¼å…³å¿ƒçš„å®éªŒæ¸…å•, æ¡†æ¶å†…æ‰€æœ‰è¦è®¿é—®ABæµ‹çš„åœ°æ–¹éƒ½æ˜¯é€šè¿‡ABæµ‹è§£è€¦æ¨¡å—æ¥è®¿é—®çš„</li><li>æ¯ä¸ªç¾æœ¯é£æ ¼å¯¹åº”çš„æ¯ä¸€ç±»åŠ¨æ•ˆçš„è§£æé€»è¾‘(å†²çªæ£€æŸ¥)</li><li>æ¯ä¸ªç¾æœ¯é£æ ¼å¯¹åº”çš„å®çŸ³å—çš„è§£æé€»è¾‘(å†²çªæ£€æŸ¥)</li><li>æ¯ä¸ªç¾æœ¯é£æ ¼å¯¹åº”çš„é¡µé¢UIInfoçš„è§£æé€»è¾‘(å†²çªæ£€æŸ¥)</li><li>æ¯ä¸ªç¾æœ¯é£æ ¼ä¸è¯¥é£æ ¼å¯ä»¥æ’­æ”¾çš„æ¯ä¸€ç±»åŠ¨æ•ˆé£æ ¼çš„å…³ç³»æ˜ å°„è¡¨</li><li>æ¯ä¸ªç¾æœ¯é£æ ¼ä¸è¯¥é£æ ¼å¯ä»¥è¡¨ç°çš„å®çŸ³å—é£æ ¼çš„å…³ç³»æ˜ å°„è¡¨</li><li>æ¯ä¸ªç¾æœ¯é£æ ¼ä¸‹çš„UIInfoé¢„è®¾è¡¨<br>æš‚æ—¶æ— æ³•åœ¨é£ä¹¦æ–‡æ¡£å¤–å±•ç¤ºæ­¤å†…å®¹</li></ul><ol><li>å®šä¹‰ä¸€å¥—ç¾æœ¯é£æ ¼æ¸…å•,  å»ºç«‹ç¾æœ¯é£æ ¼ä¸æ¯ä¸ªåŠ¨æ•ˆä¹‹é—´å›Šæ‹¬å…³ç³»çš„æ˜ å°„è¡¨,æ¥ç¡®ä¿å®éªŒå­—æ®µç”Ÿæ•ˆçš„åŠ¨æ•ˆå’Œç”Ÿæ•ˆçš„ç¾æœ¯é£æ ¼æ˜¯å¥‘åˆçš„.(ç¾æœ¯é£æ ¼åŠ¨æ•ˆçš„ç”Ÿæ•ˆä¼˜å…ˆçº§æ˜¯æœ€é«˜çš„)</li><li>ç¾æœ¯é£æ ¼è§£æé€»è¾‘ å¾—åˆ°ä¸€ç»„å¯ä»¥åœ¨å½“å‰ç¾æœ¯é£æ ¼ä¸‹å±•ç¤ºçš„åŠ¨æ•ˆæ˜ å°„è¡¨ å¾—åˆ°å½“å‰ç¾æœ¯é£æ ¼å…³å¿ƒçš„è¡¨ç°ç›¸å…³çš„å®éªŒå­—æ®µç»„</li><li>è§£æåœ¨Sessionä¸­æ›´æ–°ç¾æœ¯é£æ ¼çš„é€»è¾‘ä½“åªä¼šæœ‰ä¸€ä¸ªå­—æ®µçœŸæ­£ç”Ÿæ•ˆ,æ‰€ä»¥è¦åšä¿åº•å’Œå†²çªæ£€æŸ¥)(çº¦æŸSessionå†…æ›´æ–°ç¾æœ¯é£æ ¼çš„å®éªŒå­—æ®µ)</li><li>è§£æå„ä¸ªåŠ¨æ•ˆå’Œå®çŸ³å— ä¼šè§£å†³å†²çª</li><li>å¾—åˆ°ä¸€ç»„ç¾æœ¯é£æ ¼ã€åŠ¨æ•ˆã€å®çŸ³å—çš„é£æ ¼æ¸…å• + å½“å‰ç¾æœ¯é£æ ¼å…³å¿ƒçš„å…¶ä»–è¡¨ç°ä¸Šçš„å®éªŒå­—æ®µç»„</li></ol><ul><li>ç¾æœ¯é¡µé¢é£æ ¼ æ¶ˆé™¤åŠ¨æ•ˆé£æ ¼ å¿ƒåŠ¨åŠ¨æ•ˆé£æ ¼ åŠ åˆ†åŠ¨æ•ˆé£æ ¼ ComboåŠ¨æ•ˆé£æ ¼ åŠ åˆ†åŠ¨æ•ˆé£æ ¼ é¼“åŠ±è¯­åŠ¨æ•ˆé£æ ¼ ç ´çºªå½•åŠ¨æ•ˆé£æ ¼ æ¸…ç›˜åŠ¨æ•ˆé£æ ¼ æ–¹å—å‘å…‰åŠ¨æ•ˆé£æ ¼â€¦</li><li>å®çŸ³å—é£æ ¼</li><li>CareExperiments å½“å‰è¿™ä¸ªé£æ ¼å…³å¿ƒçš„å®éªŒ å¦‚æœä¸åœ¨é‡Œé¢å°±æŠ¥é”™ éœ€è¦æ‰€æœ‰é…ç½®å±‚ä¹‹å¤–è°ƒç”¨çš„ABTestçš„å®éªŒå­—æ®µåŠ å…¥è¿™é‡Œé¢ å®éªŒå­—æ®µåˆ†ç±»ä¸­çš„3 4 çº¦æŸå¼€å‘è€…ä½¿å…¶çŸ¥æ™“è‡ªå·±æ‰€åšçš„è¿™å—ä¼šå½±å“å“ªäº›é£æ ¼å…œåº•+æŠ¥é”™</li></ul><h2 id="æ¡†æ¶å·¥ä½œæµæ¢³ç†">æ¡†æ¶å·¥ä½œæµæ¢³ç†</h2><ul><li>æ–°å¢/åˆ é™¤ç¾æœ¯é£æ ¼<ul><li>åœ¨ç¾æœ¯é£æ ¼è§£ææ¨¡å—æ·»åŠ æ–°é£æ ¼çš„å®éªŒå­—æ®µè§£æé€»è¾‘</li><li>åœ¨UIManageræ¨¡å—æ·»åŠ ä¸€å¥—é£æ ¼é¡µé¢çš„é¢„è®¾</li><li>å‡†å¤‡é¡µé¢é¢„åˆ¶ä½“èµ„æºã€é¡µé¢UIElementsã€é¡µé¢Logicã€é¡µé¢è¿è¡Œæ—¶ç­–ç•¥Stg</li></ul></li><li>æ–°å¢/åˆ é™¤æŸä¸€ç¾æœ¯é£æ ¼ä¸€ç±»åŠ¨æ•ˆ<ul><li>å°†è¯¥å®éªŒå­—æ®µæ·»åŠ åˆ°ç¾æœ¯é£æ ¼å…³å¿ƒçš„å®éªŒå­—æ®µä¸­</li><li>æ–°å¢ä¸€ä¸ªè¡¨ç¤ºè¯¥ç±»åŠ¨æ•ˆçš„æšä¸¾ç±»å‹</li><li>åœ¨è§£æè¯¥åŠ¨æ•ˆæšä¸¾å­—æ®µéƒ¨åˆ†å¢åŠ è¯¥å®éªŒå­—æ®µçš„é€»è¾‘</li><li>æ–°å¢è¯¥åŠ¨æ•ˆæ’­æ”¾éœ€è¦å®ç°çš„æ¥å£</li><li>å‡†å¤‡åŠ¨æ•ˆé¢„åˆ¶ä½“ã€é©±åŠ¨é¢„åˆ¶ä½“è„šæœ¬</li><li>åœ¨æ¸¸æˆæµç¨‹ä¸­æ–°å¢åŠ¨æ•ˆæ’­æ”¾çš„æ—¶æœº(åœ¨å¯¹åº”é£æ ¼çš„GameViewä¸Šæ’­,ä¸ä¼šå½±å“åˆ°å…¶ä»–é£æ ¼,ä½†æ˜¯å¯¹äºæ²¡æœ‰æ”¹åŠ¨æ•ˆçš„ç¾æœ¯é£æ ¼è¦åšä¿åº•,è¿™éƒ¨åˆ†é€»è¾‘è¿˜ä¸æ¸…æ¥š,æ˜¯å¦æ¯ä¸€ä¸ªç¾æœ¯é£æ ¼å¯¹åº”ä¸€ä¸ªGameView)</li></ul></li><li>æ–°å¢/åˆ é™¤æŸä¸€ç¾æœ¯é£æ ¼æŸä¸€ç±»åŠ¨æ•ˆçš„é£æ ¼<ul><li>å°†è¯¥å®éªŒå­—æ®µæ·»åŠ åˆ°ç¾æœ¯é£æ ¼å…³å¿ƒçš„å®éªŒå­—æ®µä¸­</li><li>æ–°å¢åŠ¨æ•ˆé£æ ¼æšä¸¾å­—æ®µ</li><li>åœ¨è§£æè¯¥åŠ¨æ•ˆæšä¸¾å­—æ®µéƒ¨åˆ†å¢åŠ è¯¥å®éªŒå­—æ®µçš„é€»è¾‘</li><li>å‡†å¤‡åŠ¨æ•ˆé¢„åˆ¶ä½“èµ„æºã€å‡†å¤‡é©±åŠ¨åŠ¨æ•ˆçš„è„šæœ¬ã€å®ç°åŠ¨æ•ˆå®šä¹‰çš„æ¥å£</li></ul></li><li>æ–°å¢/åˆ é™¤æŸä¸€ç¾æœ¯é£æ ¼ä¸‹çš„å®çŸ³å—çš„é£æ ¼<ul><li>å°†è¯¥å®éªŒå­—æ®µæ·»åŠ åˆ°ç¾æœ¯é£æ ¼å…³å¿ƒçš„å®éªŒå­—æ®µä¸­</li><li>æ–°å¢è¡¨ç¤ºè¯¥é£æ ¼çš„å®çŸ³å—æšä¸¾ç±»å‹</li><li>å‡†å¤‡å®çŸ³å—ç¾æœ¯èµ„æº</li><li>æ–°å¢è§£æè¯¥å®çŸ³å—å®éªŒå­—æ®µçš„è§£æé€»è¾‘</li><li>å®šä¹‰ä¸€å¥—å®çŸ³å—èµ„æºé¢„è®¾</li><li>å®šä¹‰èµ„æºé¢„è®¾ä¸æšä¸¾å­—æ®µçš„æ˜ å°„å…³ç³»</li></ul></li><li>æ–°å¢/åˆ é™¤ä¸€å¥—è¿è¡Œæ—¶ç¾æœ¯é£æ ¼åˆ‡æ¢ç­–ç•¥(ç¾æœ¯é£æ ¼æ‰¿æ¥ç­–ç•¥)<ul><li>å®šä¹‰æ–°çš„ç¾æœ¯é£æ ¼åˆ‡æ¢ç­–ç•¥æšä¸¾å­—æ®µ</li><li>åœ¨åˆ‡æ¢ç­–ç•¥è§£æå¤„æ–°å¢è¯¥å®éªŒå­—æ®µçš„è§£æé€»è¾‘</li><li>ç¼–å†™ç­–ç•¥çš„åˆ‡æ¢é€»è¾‘,å…¶ä¸­åªèƒ½å†™ç¾æœ¯é£æ ¼ã€åŠ¨æ•ˆé£æ ¼ã€å®çŸ³å—é£æ ¼çš„é£æ ¼åˆ‡æ¢é€»è¾‘</li></ul></li><li>æ–°å¢/åˆ é™¤æŸä¸€ç¾æœ¯é£æ ¼ä¸‹æŸä¸€é¡µé¢ä¸Šçš„äº¤äº’/è¡¨ç°ç»„ä»¶<ul><li>å°†è¯¥å®éªŒå­—æ®µæ·»åŠ åˆ°ç¾æœ¯é£æ ¼å…³å¿ƒçš„å®éªŒå­—æ®µä¸­</li><li>é¢„åˆ¶ä½“ä¸Šæ·»åŠ ç»„ä»¶</li><li>åœ¨ç‰¹å®šé¡µé¢çš„Stgä¸­ç»„ç»‡å®éªŒå­—æ®µé€»è¾‘</li><li>åœ¨ç‰¹å®šé¡µé¢çš„Logicä¸­è°ƒç”¨Stgçš„æ¥å£åšç›¸å…³çš„æ˜¾ç¤º</li></ul></li></ul><h2 id="è¦åšçš„äº‹æƒ…">è¦åšçš„äº‹æƒ…</h2><ul><li>ç²¾ç»†åŒ–ABæµ‹è§£ææ¨¡å—çš„è®¾è®¡å®ç°</li><li>UIManageræ¨¡å—æ‰©å±•æ”¯æŒå¤šé£æ ¼ç®¡ç†</li><li>è€UILogicé‡æ„ æ¥å…¥æ–°UIManageræ¨¡å—</li><li>EffectMangerå®ç°</li><li>åŠ¨æ•ˆç®¡ç†æ¨¡å—å®ç°</li><li>åŠ¨æ•ˆEntityæ¨¡å—å®ç°</li><li>åŸæ¥EffectEntityè¿ç§»</li><li>å®çŸ³å—ç®¡ç†æ¨¡å—çš„å®ç°</li><li>åŠ åˆ†åŠ¨æ•ˆçš„é‡æ„</li><li>AniPlayeré›†æˆ</li><li>Adventureå…³å¡é¡µé¢çš„é¢œè‰²é…ç½®(ä½ä¼˜å…ˆçº§)</li></ul><h2 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h2><ul><li>id  èµ„æºå’Œè„šæœ¬ç»‘å®š</li><li>åŠ¨æ•ˆæ¨¡å—å»å…¶ä»–æ¨¡å—çš„äº¤äº’é€»è¾‘ å¦‚æœè¦äº¤äº’çš„å…¶ä»–æ¨¡å—å‡ºäº†é—®é¢˜ è¦åœ¨åŠ¨æ•ˆæ¨¡å—ä¸ŠæŠ¥ é‡åŠ›ä¸‹è½åœ¨å¡é€šé£æ ¼é‡Œæ²¡æœ‰è¿™ä¸ªé€»è¾‘, ä½†æ˜¯è°ƒç”¨æ’­æ”¾é‡åŠ›ä¸‹è½çš„æ—¶å€™æ•°æ®å±‚ä¼ ä¸Šæ¥çš„è¦æ±‚æ’­æ”¾é‡åŠ›ä¸‹è½åŠ¨æ•ˆ,è¿™æ—¶è¦åœ¨åŠ¨æ•ˆæ¨¡å—ä¸ŠæŠ¥</li><li>è€ƒè™‘åœ¨å“ªäº›æ–¹é¢ä¼šå‡ºé—®é¢˜</li><li>åŠ¨æ•ˆç®¡ç†æ¨¡å— ä¸é‡åŠ›ä¸‹è½çš„æ•°æ®é€»è¾‘</li><li>åªåœ¨ä¸€ä¸ªç¾æœ¯é£æ ¼ä¸‹åšäº†ä¸€ä¸ªç»„ä»¶çš„ABæµ‹è¯• å½±å“åˆ°äº†å…¶ä»–é£æ ¼åŒæ ·çš„é¡µé¢</li><li>é£æ ¼çš„è§£ææŠ½åˆ°ä¸€å¤„</li><li>UIå˜æˆäº†å®¹å™¨ æ¥å—å¤–éƒ¨å„ç§ç»„ä»¶çš„ä¼ å…¥ ç»„ä»¶è‡ªå·±ä¿è¯ä¸å‡ºé—®é¢˜ éœ€è¦é‡åˆ°ä¸šåŠ¡åœºæ™¯ ä¼˜å…ˆçº§ä¸é«˜</li></ul>]]></content>
      
      
      <categories>
          
          <category> è½¯æŠ€èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¡¹ç›®ç»éªŒæ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UnityAssetBundleç¬”è®°</title>
      <link href="/posts/96c99d7a/"/>
      <url>/posts/96c99d7a/</url>
      
        <content type="html"><![CDATA[<h1>AssetBundleåŸºç¡€</h1><h2 id="AssetBundleåŸç†">AssetBundleåŸç†</h2><p>â­•ï¸ AssetBundleåœ¨å†…å­˜ä¸­å¦‚ä½•åŠ è½½ã€å­˜å‚¨</p><h2 id="AssetBundleã€AssetBundle-Browserä¸Addressable">AssetBundleã€AssetBundle-Browserä¸Addressable</h2><p>AssetBundleæ˜¯Unityæ¨å‡ºçš„ä¸€ç§å†…ç½®çš„èµ„æºå‹ç¼©æ ¼å¼ï¼Œèƒ½å¤Ÿå…è®¸å¼€å‘è€…åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½éœ€è¦çš„èµ„æºã€‚ç”¨ä¸ç”¨å–å†³äºå¼€å‘è€…è‡ªå·±ã€‚å½“ä½ åœ¨Unityä¸­åˆ›å»ºã€å¯¼å…¥ä»»ä½•éä»£ç èµ„æºæˆ–è€…æ–‡ä»¶å¤¹çš„æ—¶å€™ï¼Œåœ¨Inspectorçª—å£çš„ä¸‹é¢éƒ½ä¼šæœ‰ä¸€ä¸ªAssetLabelï¼š</p><img src="/posts/96c99d7a/image-1.png" class=""><p>Addressableæ˜¯åŸºäºAssetBundleçš„ä¸€å¥—å®Œæ•´çš„Unityèµ„æºç®¡ç†æ¡†æ¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨Addressableè¿›è¡Œå¼€å‘ï¼Œé¡¹ç›®ä¸­çš„èµ„æºå¦‚ä½•è¿›è¡Œæ‰“åŒ…ã€åŠ è½½Addressableéƒ½å¸®æˆ‘ä»¬è§„åˆ’å¥½äº†ï¼Œæˆ‘ä»¬åªéœ€è¦æŒ‰ç…§å®ƒç»™å®šçš„è§„èŒƒå’Œæ¥å£ä½¿ç”¨èµ„æºå°±å¯ä»¥äº†ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬åªæ˜¯ä½¿ç”¨AssetBundleï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦å¼€å‘ä¸€å¥—è‡ªå·±çš„èµ„æºç®¡ç†æ¡†æ¶ã€‚</p><p>å¦å¤–ï¼ŒUnityè¿˜æ¨å‡ºäº†<a href="https://github.com/Unity-Technologies/AssetBundles-Browser">AssetBundle-Browser</a>ç”¨æ¥å¯è§†åŒ–AssetBundleçš„æ„å»ºè¿‡ç¨‹ã€‚åº”è¯¥è¯´Unityæ˜¯å…ˆæ¨å‡ºäº†<code>AssetBundleBrowser</code>ç„¶åæ¨å‡ºäº†<code>Addressable</code>ã€‚äºŒè€…éƒ½å¯ä»¥ç”¨æ¥ç®¡ç†AssetBundleï¼Œ<code>Addressable</code>ä¸­æœ‰æ›´å¤šçš„è‡ªåŠ¨åŒ–åŠŸèƒ½ï¼Œè€Œ<code>AssetBundleBrowser</code>åˆ™æ›´å¤šåœ°éœ€è¦æ‰‹åŠ¨ç®¡ç†Bundleã€‚æ‰€ä»¥<code>AssetBundle-Browser</code>ç®—æ˜¯<code>Addressable</code>çš„é˜‰å‰²ç‰ˆã€‚</p><h2 id="AssetBundle-Browserçš„ä½¿ç”¨">AssetBundle-Browserçš„ä½¿ç”¨</h2><p>åœ¨AssetBundle-Browserä»“åº“çš„è¯´æ˜æ–‡æ¡£ä¸­æç¤ºè¯¥å·¥å…·å¹¶ä¸ä½œä¸ºUnityæ¨èçš„AssetBundleçš„èµ„æºç®¡ç†å·¥å…·ï¼Œä½†æ˜¯å› ä¸ºè¯¥å·¥å…·çš„å»ºè®®æ€§ï¼Œè¿˜æ˜¯å¯ä»¥ä½œä¸ºAssetBundleçš„å…¥é—¨å­¦ä¹ ä½¿ç”¨ã€‚</p><p>æŒ‰ç…§è¯´æ˜æ–‡æ¡£çš„ä»‹ç»ï¼Œå¯ä»¥ç›´æ¥å¤åˆ¶gitä»“åº“çš„è¿æ¥å°†è¯¥åº“å®‰è£…åˆ°Unityå·¥ç¨‹ä¸­ï¼Œä½†æ˜¯æœ‰å¯èƒ½ä¼šå› ä¸ºç½‘ç»œåŸå› å¤±è´¥ï¼Œå¯ä»¥é€‰æ‹©DownloadZipï¼Œç„¶åè§£å‹åˆ°Assetsç›®å½•ä¸‹ï¼Œè®°å¾—åˆ é™¤Testç›®å½•ï¼Œ<a href="https://www.cnblogs.com/XieBoss-blogs1/p/17847061.html">ä¸ç„¶ä¼šæœ‰Booå‘½åç©ºé—´çš„æŠ¥é”™</a>ã€‚</p><h1>AssetBundleå†…å­˜</h1><p>ä½¿ç”¨<a href="https://github.com/AssetRipper/AssetRipper?tab=readme-ov-file">AssetRipper</a>å¯ä»¥æŸ¥çœ‹AssetBundleä¸­çš„æ–‡ä»¶</p><img src="/posts/96c99d7a/image.png" class=""><p>Unityå†…ç½®çš„AssetBundleå·¥å…·æ˜¯<a href="https://docs.unity3d.com/Packages/com.unity.addressables@2.3/manual/index.html">Addressableåº“</a></p><h1>ä¾èµ–</h1><p>å¦‚æœä¸¤ä¸ªab Aå’ŒBä¸­çš„ä¸€äº›èµ„æºéƒ½ä¾èµ–äº†ä¸€ä¸ªæ²¡æœ‰è¢«æŒ‡å®šè¦æ‰“åŒ…çš„èµ„æºCï¼Œé‚£ä¹ˆCå°±ä¼šåŒæ—¶è¢«æ‰“è¿›ab Aå’ŒBä¸­ï¼Œé€ æˆèµ„æºçš„å†—ä½™ï¼Œå¢å¤§abå’Œå®‰è£…åŒ…çš„ä½“ç§¯ã€‚è€Œè¿™ä¸ªè¢«Aï¼ŒBä¾èµ–çš„èµ„æºCåˆå¯ä»¥åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯Assetsä¸‹å¤–éƒ¨å¯¼å…¥çš„èµ„æºï¼Œå³å¼€å‘è€…å¯¼å…¥æˆ–åˆ›å»ºçš„èµ„æºï¼›å¦ä¸€ç§åˆ™æ˜¯Unityå†…ç½®çš„èµ„æºï¼Œä¾‹å¦‚å†…ç½®çš„Shaderï¼ŒDefault-Materialå’ŒUGUIä¸€äº›ç»„ä»¶å¦‚Imageç”¨çš„ä¸€äº›çº¹ç†èµ„æºç­‰ç­‰ã€‚å› æ­¤è¦è§£å†³èµ„æºå†—ä½™çš„é—®é¢˜ï¼Œå°±è¦åˆ†åˆ«å¯¹è¿™ä¸¤ç§è¢«ä¾èµ–çš„èµ„æºè¿›è¡Œå¤„ç†ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨æŠŠä¸€äº›èµ„æºæ‰“è¿›Bundleï¼Œ<br>æƒ³è¦æ‰“Bundleï¼Œæœ€ç»ˆéƒ½è¦è°ƒç”¨<code>BuildPipeline.BuildAssetBundles</code>æ¥å£ï¼Œ</p><p><code>public static AssetBundleManifest BuildAssetBundles(string outputPath,AssetBundleBuild[] builds,BuildAssetBundleOptions assetBundleOptions,BuildTarget targetPlatform)</code>æ¥å£æ”¯æŒä¼ å…¥AssetBundleBuildæ•°ç»„</p><p><code> public static AssetBundleManifest BuildAssetBundles(string outputPath,BuildAssetBundleOptions assetBundleOptions,BuildTarget targetPlatform)</code><br>é€šè¿‡ç»™AssetBundleBuildæ˜¾ç¤ºä¼ å…¥æ‰“åŒ…çš„ä¾èµ–å…³ç³»ï¼Œç¡®ä¿æ‰“åŒ…èµ„æºä¸ä¼šå†—ä½™<br>å› æ­¤ é‡ç‚¹åœ¨äºAssetBundleBuildæ•°ç»„çš„æ„å»ºã€‚</p><p>åœ¨AssetBundleçš„å·¥ä½œæµä¸­ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªç¯èŠ‚æŒ‡å®šæœ‰å“ªäº›èµ„æºæ˜¯è¦æ‰“è¿›Bundleçš„ï¼Œè¿™ä¸ªæ“ä½œå¯ä»¥ç”±Unityå†…ç½®çš„AssetBundleå·¥å…·æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥è‡ªå·±ç¼–å†™è„šæœ¬æ‰§è¡Œã€‚</p><h1>Unity AssetBundleä¸å›¾é›†Sprite Atlas</h1><blockquote><p>æœ¬å°èŠ‚å»ºè®®é…åˆ<a href="https://soincredible.github.io/posts/279644bd/">UnityAndroidå·¥ç¨‹åŒ…ä½“ä¼˜åŒ–</a>è¿™ç¯‡åšå®¢é˜…è¯»</p></blockquote><p>æ–°å»ºä¸€ä¸ªUnityå·¥ç¨‹ï¼ŒAssetsç›®å½•ä¸‹çš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š</p><img src="/posts/96c99d7a/image-3.png" class=""><p>å…¶ä¸­åä¸ºTTTçš„å›¾é›†ä¸­åŒ…å«å›¾ç‰‡Aã€å›¾ç‰‡Bã€å›¾ç‰‡Cèµ„æºï¼ŒImageé¢„åˆ¶ä½“ä¸­åªæœ‰ä¸€ä¸ªImageç»„ä»¶ï¼ŒImageç»„ä»¶ä¸Šå¼•ç”¨äº†å›¾ç‰‡Aã€‚ç¬”è€…å°†ä¼šæµ‹è¯•ä¸‹é¢å‡ ç§æ–¹æ¡ˆä¼šå¦‚ä½•å°†è¿™äº›èµ„æºæ‰“å…¥åŒ…å†…ï¼š</p><h2 id="ä¸ä½¿ç”¨AssetBundle-ä¸ä½¿ç”¨SpriteAtlas">ä¸ä½¿ç”¨AssetBundle ä¸ä½¿ç”¨SpriteAtlas</h2><p>åœ¨è¿™ç§ç­–ç•¥ä¸‹ï¼Œé™¤äº†é‚£äº›å·²ç»æ”¾åœ¨Resourcesç›®å½•ä¸‹çš„èµ„æºï¼Œè¿˜æœ‰é‚£äº›è¢«Resourcesç›®å½•ä¸­èµ„æºå¼•ç”¨çš„ã€æ”¾åœ¨Resourceså¤–é¢çš„èµ„æºä¼šè¢«æ‰“å…¥apkã€‚ä¹Ÿå°±æ˜¯è¯´<code>Art/Image/A</code> + æ‰€æœ‰Resourcesç›®å½•ä¸‹çš„æ–‡ä»¶è¢«æ‰“åŒ…è¿›äº†apkã€‚</p><p>æ‰“å‡ºAndroid Apkä¹‹åè§£å‹ï¼Œåœ¨ç›®å½•ä¸‹æ‰¾åˆ°<code>assets/bin/Data/data.unity3d</code>ï¼Œä½¿ç”¨AssetRipperå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æ„ï¼š</p><img src="/posts/96c99d7a/image-2.png" class=""><ul><li><p><code>globalgamemanagers</code>ã€<code>unity_builtin_extra</code>ã€<code>globalgamemanagers.asset</code>æ˜¯Unityè‡ªåŠ¨åˆ›å»ºçš„ï¼Œæœ¬æµ‹è¯•å¹¶ä¸å…³å¿ƒå…¶å†…å®¹ï¼Œä¹Ÿä¸æˆ‘ä»¬è‡ªå·±çš„èµ„æºæ²¡æœ‰å…³ç³»ã€‚</p></li><li><p><code>resources.asset</code>æ–‡ä»¶é‡Œé¢åŒ…å«äº†Resourcesç›®å½•ä¸‹çš„æ‰€æœ‰èµ„æºã€‚å³å›¾ç‰‡Cå’ŒImageé¢„åˆ¶ä½“</p></li></ul><img src="/posts/96c99d7a/image-4.png" class=""><ul><li><code>level0</code>æ˜¯æˆ‘ä»¬æ„å»ºçš„åœºæ™¯ï¼Œå…¶ä¸­åŒ…å«äº†åœºæ™¯ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯ï¼ŒImageé¢„åˆ¶ä½“ä¹Ÿåœ¨å…¶ä¸­ã€‚</li></ul><img src="/posts/96c99d7a/image-5.png" class=""><ul><li><code>sharedassets0.asset</code>æ–‡ä»¶åˆ™åŒ…å«äº†æ‰€æœ‰çš„Resourcesç›®å½•ä¸‹å¼•ç”¨çš„Resourcesç›®å½•å¤–çš„èµ„æºã€‚å…¶ä¸­åŒ…å«äº†å›¾ç‰‡Aã€‚</li></ul><img src="/posts/96c99d7a/image-6.png" class=""><h2 id="æ²¡æœ‰AssetBundle-æœ‰SpriteAtlasçš„æƒ…å†µ">æ²¡æœ‰AssetBundle æœ‰SpriteAtlasçš„æƒ…å†µ</h2><h3 id="SpriteAtlaså‹¾é€‰IncludeInBuildçš„æƒ…å†µ">SpriteAtlaså‹¾é€‰IncludeInBuildçš„æƒ…å†µ</h3><blockquote><p>æ³¨æ„ ç¬”è€…åœ¨åšä¸‹é¢çš„å®éªŒçš„æ—¶å€™ï¼Œæ¯åšä¸€ä¸ªå®éªŒéƒ½ä¼šåˆ é™¤åŸæ¥çš„å›¾é›†-&gt;é€€å‡ºUnity-&gt;åˆ é™¤å·¥ç¨‹ä¸‹çš„Libraryç›®å½•-&gt;é‡æ–°å¯åŠ¨Unity-&gt;é‡æ–°åˆ›å»ºä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„å›¾é›†ï¼ŒUnityå­˜åœ¨Bugå½“å›¾é›†çš„IncludeInBuildé€‰é¡¹çš„å˜åŒ–å¹¶ä¸ä¼šç”Ÿæ•ˆã€‚</p></blockquote><p>å‹¾é€‰IncludeInBuildçš„æƒ…å†µä¸‹ï¼Œæ•£å›¾å’Œå›¾é›†ä¹‹é—´å°±å»ºç«‹äº†<code>æ˜ å°„å…³ç³»</code>ï¼Œ<code>æ•£å›¾</code>ä¸<code>å…¶ä¾èµ–èµ„æº</code>ä¹‹é—´çš„ä¾èµ–å…³ç³»å°±å˜æˆäº†<code>æ•£å›¾æ‰€åœ¨å›¾é›†</code>ä¸<code>ä¾èµ–è¯¥æ•£å›¾èµ„æº</code>ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</p><img src="/posts/96c99d7a/image-7.png" class=""><blockquote><p>æ³¨æ„ï¼šResourcesç›®å½•ä¸‹çš„èµ„æºä¼šè¢«æ— æ¡ä»¶åœ°æ‰“å…¥åŒ…å†…ï¼Œå³ä¾¿æ˜¯åŒ…å«åœ¨å›¾é›†å†…çš„æ•£å›¾ï¼Œæœ€ç»ˆæ‰“è¿›åŒ…å†…çš„æ˜¯æ•£å›¾æ‰€åœ¨çš„å›¾é›†+æ•£å›¾è‡ªå·±ï¼Œä¼šæœ‰èµ„æºå†—ä½™ã€‚å°±æ¯”å¦‚å›¾ç‰‡Cï¼Œåœ¨Resourcesç›®å½•ä¸‹æœ‰ä¸€å¼ å›¾ç‰‡Cæ•£å›¾ï¼Œç„¶åå›¾ç‰‡Cåˆè¢«æ‰“å…¥TTTå›¾é›†å­˜æ”¾åœ¨sharedassetsä¸­ï¼Œä¸è¿‡æœ¬æµ‹è¯•å›¾é›†ä¸­è¿˜æœ‰å¾ˆå¤šçš„ç©ºç™½ç©ºé—´ï¼Œå¤šä¸€å¼ å›¾ç‰‡Cå¹¶ä¸ä¼šé€ æˆå›¾é›†å˜å¤§ï¼Œå› æ­¤åŒ…ä½“ä¸ä¼šå˜å¤§ã€‚</p></blockquote><h3 id="SpriteAtlasæœªå‹¾é€‰IncludeInBuildçš„æƒ…å†µ">SpriteAtlasæœªå‹¾é€‰IncludeInBuildçš„æƒ…å†µ</h3><p>å’Œ<code>ä¸ä½¿ç”¨AssetBundle ä¸ä½¿ç”¨SpriteAtlas</code>å®éªŒæ¡ä»¶çš„ç»“æœä¸€æ ·ï¼Œå›¾é›†ä¸ä¼šè¢«æ‰“å…¥åŒ…å†…ã€‚</p><h2 id="æœ‰AssetBundle-æ²¡æœ‰SpriteAtlasçš„æƒ…å†µ">æœ‰AssetBundle æ²¡æœ‰SpriteAtlasçš„æƒ…å†µ</h2><p>æˆ‘ä»¬éœ€è¦æ›´æ”¹ä¸€ä¸‹å·¥ç¨‹çš„ç›®å½•ç»“æ„ï¼Œæ–°å»ºä¸€ä¸ªAssetBundleç›®å½•ï¼ŒæŠŠResourcesç›®å½•ä¸‹çš„å›¾ç‰‡Cç§»åŠ¨åˆ°Spritesç›®å½•ä¸‹ï¼ŒæŠŠImageé¢„åˆ¶ä½“æ”¹åä¸ºImageAæ”¾åœ¨PrefabAç›®å½•ä¸‹ï¼Œå¤åˆ¶ä¸€ä¸ªImageAé¢„åˆ¶ä½“æ”¹åä¸ºImageBæ”¾åœ¨PrefabBç›®å½•ä¸‹ï¼Œå°†ImageBä¸­çš„Spriteå¼•ç”¨æ”¹ä¸ºå›¾ç‰‡Bã€‚æˆ‘ä»¬è¿˜è¦æŠŠåˆšæ‰åˆ›å»ºçš„å›¾é›†åˆ æ‰ï¼Œé˜²æ­¢å½±å“å®éªŒã€‚</p><img src="/posts/96c99d7a/image-8.png" class=""><p><s>æˆ‘ä»¬åˆ†åˆ«ç»™è¿™ä¸‰ä¸ªç›®å½•æ·»åŠ AssetLabels:</s></p><img src="/posts/96c99d7a/image-9.png" class=""><p><s>ç„¶åæ‰“å¼€AssetBundleBrowserï¼Œå°±ä¼šçœ‹åˆ°æˆ‘ä»¬åˆšæ‰æ‰“çš„ä¸‰ä¸ªAssetBundleTagäº†</s></p><img src="/posts/96c99d7a/image-10.png" class=""><p>ä¸Šé¢è¿™æ ·æ·»åŠ AssetBundleLabelæ˜¯é”™è¯¯çš„ï¼Œæ­£ç¡®çš„æ–¹å¼æ˜¯æ‰“å¼€AssetBundleBrowserå°†è¦æ‰“Bundleçš„æ–‡ä»¶å¤¹æˆ–è€…æ–‡ä»¶æ‹–æ‹½è¿›å»ï¼Œæ‰€æœ‰çš„Bundleç»“æ„ç»„ç»‡éƒ½åœ¨AssetBundleBrowserä¸­æ“ä½œã€‚</p><p>æ‰§è¡ŒBuildæ“ä½œ</p><img src="/posts/96c99d7a/image-11.png" class=""><p>ç„¶åBuildAndroidPlayerï¼Œæ­¤æ—¶æˆ‘ä»¬çš„èµ„æºå°±ä¸æ˜¯åœ¨<code>assets/bin/Data/data.unity3d</code>ç›®å½•ä¸‹äº†ï¼Œè€Œæ˜¯åœ¨<code>assets/bin/</code>ç›®å½•ä¸‹ã€‚<br>å®éªŒé¢„æœŸæ˜¯<code>assets/bin/Data/data.unity3d</code>å†…ä¸åŒ…å«ä»»ä½•æˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„èµ„æºã€‚ä¸è¿‡æ³¨æ„ï¼šåœºæ™¯ä¸­è¿˜å­˜æ”¾äº†ä¸€ä¸ªImageçš„é¢„åˆ¶ä½“ï¼Œå› æ­¤åœ¨<code>level0</code>ä¸­ä½ ä¼šçœ‹åˆ°é¢„åˆ¶ä½“ç›¸å…³çš„ä¿¡æ¯ï¼Œè€Œåœ¨<code>sharedassets0.asset</code>ä¸­ä½ ä¼šçœ‹åˆ°é¢„åˆ¶ä½“ä¸Šå¼•ç”¨çš„å›¾ç‰‡Aã€‚ä»åœºæ™¯ä¸­å°†é¢„åˆ¶ä½“ç§»é™¤ï¼Œå†æ¬¡æ‰“åŒ…ï¼Œæˆ‘ä»¬å°±ä¸ä¼šå†åœ¨<code>assets/bin/Data/data.unity3d</code>ç›®å½•ä¸‹çœ‹åˆ°ä»»ä½•æˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„èµ„æºäº†ã€‚</p><img src="/posts/96c99d7a/image-12.png" class=""><p>ç›®å‰è¿™ç§æƒ…å†µæ˜¯æ²¡æœ‰èµ„æºå†—ä½™çš„ï¼Œå› ä¸ºç°åœ¨æ˜¯æ•£å›¾ï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿåœ¨AssetBundle-Browseré‡Œé¢çœ‹åˆ°äº†æ¯ä¸ªBundleä¸­çš„èµ„æºæƒ…å†µã€‚</p><h2 id="æœ‰AssetBundle-æœ‰SpriteAtlasçš„æƒ…å†µ">æœ‰AssetBundle æœ‰SpriteAtlasçš„æƒ…å†µ</h2><h3 id="SpriteAtlaså‹¾é€‰IncludeInBuildçš„æƒ…å†µ-2">SpriteAtlaså‹¾é€‰IncludeInBuildçš„æƒ…å†µ</h3><p>æŒ‰ç…§ä¸Šé¢è¯´çš„ï¼šåˆ é™¤åŸæ¥çš„å›¾é›†-&gt;é€€å‡ºUnity-&gt;åˆ é™¤å·¥ç¨‹ä¸‹çš„Libraryç›®å½•-&gt;é‡æ–°å¯åŠ¨Unity-&gt;é‡æ–°åˆ›å»ºä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„å›¾é›†ã€‚</p><p>ç„¶åæ‰“å¼€AssetBundleBrowserï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå³ä¾¿æ˜¯æˆ‘ä»¬åˆ›å»ºäº†å›¾é›†å¹¶ä¸”æŠŠå›¾ç‰‡ABCéƒ½æ”¾è¿›äº†å›¾é›†å†…ï¼Œåœ¨AssetBundleBrowseré‡Œé¢è¿˜æ˜¯æŠŠå›¾ç‰‡ABCè¯†åˆ«ä¸ºäº†å•å¼ å›¾ç‰‡å»å¼•ç”¨ï¼Œè™½ç„¶çœ‹ä¸Šå»èµ„æºæ²¡æœ‰å†—ä½™ï¼Œä½†æ˜¯æ‰“å‡ºåŒ…æ¥ä¹‹åè¿™äº›å›¾ç‰‡ä¼šä»¥å›¾é›†çš„æ–¹å¼å­˜åœ¨åœ¨abåŒ…å†…ï¼Œå› æ­¤æ¯ä¸ªabåŒ…å†…éƒ½ä¼šæœ‰ä¸€å¼ å›¾é›†ï¼Œå®é™…ä¸Šæ˜¯å†—ä½™çš„ã€‚æ‰€ä»¥ä¸ºäº†é¿å…å†—ä½™ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºSpriteAtlasæ˜¾ç¤ºæŒ‡å®šæ‰“åŒ…è·¯å¾„ã€‚</p><p>å¦å¤–åœ¨æˆ‘ä»¬çš„æµ‹è¯•åœºæ™¯ä¸­ï¼Œå‘ç°äº†Unityä¸­æ‰“å›¾é›†å’Œæ‰“Bundleçš„æœºåˆ¶ï¼šä»¥å›¾ç‰‡Cä¸ºä¾‹ï¼Œå¦‚æœå›¾ç‰‡Cæ‰€åœ¨çš„ç›®å½•è¢«æŒ‡å®šè¦æ‰“Bundleäº†ï¼Œé‚£ä¹ˆå³ä¾¿æ˜¯å›¾é›†æ–‡ä»¶ä¸­æŒ‡å®šäº†åŒ…å«å›¾ç‰‡Cï¼Œæœ€ç»ˆæ„å»ºå‡ºæ¥çš„Atlasä¸­ä¹Ÿæ˜¯ä¸åŒ…å«å›¾ç‰‡Cçš„ã€‚</p><h3 id="SpriteAtlasæœªå‹¾é€‰IncludeInBuildçš„æƒ…å†µ-å…¶å®ä¸æ˜¯å› ä¸ºæœªå‹¾é€‰IncludeInBuildå¯¼è‡´å›¾é›†æ²¡æ‰“è¿›åŒ…å†…ï¼Œè€Œæ˜¯å› ä¸ºæ²¡æœ‰æ˜¾å¼åˆ¶å®šå›¾é›†Bundle">SpriteAtlasæœªå‹¾é€‰IncludeInBuildçš„æƒ…å†µ å…¶å®ä¸æ˜¯å› ä¸ºæœªå‹¾é€‰IncludeInBuildå¯¼è‡´å›¾é›†æ²¡æ‰“è¿›åŒ…å†…ï¼Œè€Œæ˜¯å› ä¸ºæ²¡æœ‰æ˜¾å¼åˆ¶å®šå›¾é›†Bundle</h3><p>è¿™ç§æƒ…å†µç­‰åŒäº<code>æœ‰AssetBundle æ²¡æœ‰SpriteAtlasçš„æƒ…å†µ</code>ï¼Œä¸ä½¿ç”¨å›¾é›†è€Œæ˜¯å°†æ•£å›¾æ‰“è¿›åŒ…å†…ï¼Œåªè¦æ²¡æœ‰æ˜¾å¼æŒ‡å®šè¿™äº›æ•£å›¾è¦æ‰“åˆ°å“ªä¸ªBundleé‡Œï¼Œå¦‚æœæœ‰å¤šä¸ªBundleå¼•ç”¨äº†åŒä¸€ä¸ªæ•£å›¾ï¼Œè¿™ä¸ªæ•£å›¾å°±ä¼šè¢«æ‰“è¿›æ¯ä¸€ä¸ªå¼•ç”¨å®ƒçš„Bundleé‡Œï¼Œä¸åªæ˜¯å›¾ç‰‡ï¼Œæ‰€æœ‰çš„èµ„æºéƒ½æ˜¯è¿™ä¸ªé€»è¾‘ã€‚å› æ­¤å¯ä»¥å°†æ”¾åœ¨ä¸€ä¸ªå›¾é›†ä¸­çš„ä¸åŒæ•£å›¾çœ‹ä½œæ˜¯ä¸€ä¸ªèµ„æºã€‚</p><h2 id="ç»“è®º">ç»“è®º</h2><ul><li>æƒ³è¦è®©å›¾é›†è¢«æ‰“å…¥Bundleå†…ï¼Œè¦ä¹ˆæ˜¾ç¤ºæŒ‡å®šè¯¥å›¾é›†è¢«æ‰“å…¥å“ªä¸ªBundleï¼Œè¦ä¹ˆå¼•ç”¨è¯¥å›¾é›†çš„èµ„æºè¢«æ˜¾ç¤ºæ‰“å…¥æŸä¸ªæˆ–æŸäº›Bundleä¸”å‹¾é€‰äº†IncludeInBuildï¼Œä½†ä¼šé€ æˆèµ„æºå†—ä½™ï¼Œè€Œä¸”å¦‚æœå†…åµŒåœºæ™¯ä¹Ÿæœ‰å¯¹è¯¥å›¾é›†çš„å¼•ç”¨ï¼Œåœ¨å†…åµŒèµ„æºä¸­ä¹Ÿä¼šæœ‰ä¸€ä»½å†—ä½™çš„å›¾é›†èµ„æºã€‚SpriteAtlasçš„IncludeInBuildå‹¾é€‰ä¸å¦å½±å“çš„æ˜¯ï¼šå½“å†…åµŒåœºæ™¯ä¸­æœ‰å¯¹è¯¥å›¾é›†ä¸­çš„æ•£å›¾æœ‰ä¾èµ–æ—¶ï¼Œæœªå‹¾é€‰çš„å›¾é›†ä¸ä¼šå†…åµŒè¿›Playerä¸­ï¼Œåœºæ™¯åŠ è½½çš„æ—¶å€™æœ‰å¯èƒ½æ‰¾ä¸åˆ°è¿™ä¸ªå›¾é›†ï¼Œè€Œå¦‚æœåœºæ™¯æ²¡æœ‰ä¾èµ–è¯¥å›¾é›†ï¼Œé‚£å‹¾ä¸å‹¾é€‰æ— æ‰€è°“ï¼Œå› ä¸ºBuildPlayeræ—¶åˆ¤å®šæ²¡æœ‰å¯¹è¯¥å›¾é›†æœ‰å¼•ç”¨ï¼Œå°±ç®—å‹¾é€‰äº†ä¹Ÿä¸ä¼šå†…åµŒè¿›Playerã€‚<strong>è§„èŒƒçš„å›¾é›†ä¸AssetBundleçš„ä½¿ç”¨åº”è¯¥æ˜¯ï¼šå†…åµŒåœºæ™¯ä¸­æ²¡æœ‰å¯¹å›¾é›†çš„ä¾èµ–ã€æ˜¾ç¤ºæŒ‡å®šå›¾é›†Bundleã€ä¸å‹¾é€‰IncludeInBundle</strong></li><li>å‹¾é€‰IncludeInBuildï¼Œä¸æ˜¾å¼æŒ‡å®šå›¾é›†Bundleçš„æƒ…å†µä¸‹ï¼ŒBuildPlayeræ„å»ºå†…åµŒèµ„æºå’ŒBuildBundleæ„å»ºBundleèµ„æºï¼Œä¸¤ç§æ„å»ºèµ„æºçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœæœ‰å¯¹è¿™ä¸ªå›¾é›†çš„å¼•ç”¨ï¼Œå°±ä¼šæŠŠè¿™ä¸ªå›¾é›†æ„å»ºåˆ°å„è‡ªçš„èµ„æºä¸­ï¼Œæ²¡æœ‰å¼•ç”¨å°±ä¸ä¼šæ„å»ºåˆ°åŒ…å†…ã€‚çªç„¶æƒ³åˆ°ï¼ŒæŠŠå›¾é›†æ”¾åˆ°Resourcesç›®å½•ä¸‹ç­‰ä»·äºAssetBundleä¸­æ˜¾å¼æŒ‡å®šå°†å›¾é›†æ‰“å…¥Bundleã€‚ä¸å‹¾é€‰IncludeInBuildï¼Œä¸”ä¸æŒ‡å®šå›¾é›†Bundleï¼Œæ‰“å…¥Bundleä¸­çš„å°±éƒ½æ˜¯æ•£å›¾äº†ã€‚</li><li>å¦‚æœå›¾é›†ä¸­çš„æŸä¸€ä¸ªæ•£å›¾è¢«æ˜¾ç¤ºæŒ‡å®šæ‰“å…¥æŸä¸€ä¸ªBundleï¼Œé‚£ä¹ˆè¿™ä¸ªæ•£å›¾å°±ä¸ä¼šè¢«æ‰“è¿›å›¾é›†ä¸­ï¼Œä¹Ÿä¸ä¼šå› ä¸ºæœ‰å¤šä¸ªBundleä¸­çš„èµ„æºå¼•ç”¨è€Œé€ æˆå†—ä½™ã€‚</li><li>å›¾é›†çš„å¼•ç”¨è®¡æ•°ç­‰äºå›¾é›†ä¸­æ¯ä¸€ä¸ªæ•£å›¾å„è‡ªå¼•ç”¨è®¡æ•°çš„å’Œ</li><li>åœºæ™¯ä¸­åº”å½“å°½å¯èƒ½åœ°ä¸åŒ…å«ä»»ä½•èµ„æºçš„å¼•ç”¨ï¼Œè€Œæ˜¯é€šè¿‡ä¸€äº›è„šæœ¬åŠ¨æ€åŠ è½½éœ€è¦çš„èµ„æºï¼Œä¸ç„¶è¿™äº›èµ„æºä¼šè¢«æ‰“è¿›<code>assets/bin/Data/data.unity3d</code>æ–‡ä»¶ä¸­ä»è€Œæ‹–æ…¢æ¸¸æˆçš„å¯åŠ¨é€Ÿåº¦ã€‚</li><li>æƒ³è¦èµ„æºä¸å†—ä½™ï¼Œå°±å¿…é¡»æŠŠåœºæ™¯ä¸­æ‰€æœ‰çš„èµ„æºå¼•ç”¨è¿‡ä¸€éï¼Œå°†æ‰€æœ‰å¼•ç”¨çš„èµ„æºéƒ½æ˜¾ç¤ºåœ°æ‰“Bundleã€‚</li><li>BuildPlayerä¸BuildBundleæ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„è¿‡ç¨‹ã€‚åœ¨BuildPlayeré˜¶æ®µå¤„ç†çš„èµ„æºéƒ½ä¼šåµŒå…¥åˆ°<code>assets/bin/Data/data.unity3d</code>ï¼Œè¿™ç±»èµ„æºå«åµŒå…¥å¼èµ„æºã€‚</li></ul><p>å¥½äº†ï¼Œåˆ°æ­¤ä¸ºæ­¢ç¬”è€…å¤§æ¦‚æ¸…æ™°äº†AssetBundleå’ŒSpriteAtlasä¹‹é—´çš„å…³ç³»ï¼Œæ¥ä¸‹æ¥ç¬”è€…éœ€è¦ææ˜ç™½çš„äº‹æƒ…æ˜¯ï¼šåœ¨BuildBundleçš„æ—¶å€™è‡ªåŠ¨å°†æ•£å›¾çš„å…³ç³»å’Œå›¾é›†çš„å…³ç³»çš„æ˜ å°„è¿˜æ˜¯éœ€è¦äººä¸ºåœ°å»ç®¡ç†è¿™ä¸ªæµç¨‹ã€‚æˆ‘ä»¬éœ€è¦çœ‹ä¸€ä¸‹AssetBundleBrowserä¸­çš„BuildBundleæ“ä½œåšäº†ä»€ä¹ˆï¼Ÿ</p><p>é‚£ä¹ˆåœ¨æ„å»ºAssetBundleçš„æ—¶å€™ï¼ŒAssetBundleæ˜¯ä¸çŸ¥é“æœ‰æ•£å›¾çš„å›¾é›†çš„æ¦‚å¿µçš„å§ï¼Ÿ<br>Unityçš„AssetDataBaseæ¥å£é‡Œé¢çš„GetAllDependencyæ¥å£ï¼Œåœ¨è·å–ä¸€ä¸ªèµ„æºçš„æ‰€æœ‰ä¾èµ–çš„æ—¶å€™ï¼Œå¦‚æœä¸€ä¸ªä¾èµ–æ˜¯å›¾ç‰‡ï¼Œé‚£ä¹ˆå®ƒè·å–çš„ä¾èµ–ç©¶ç«Ÿæ˜¯å›¾é›†è¿˜æ˜¯è¿™ä¸ªæ•£å›¾å‘¢ï¼Ÿéœ€è¦éªŒè¯ä¸€ä¸‹ã€‚<br>æ˜¯ä¸æ˜¯è¯´æ˜åœ¨BuildBundleä¹‹å‰éœ€è¦å…ˆæ„å»ºå›¾é›†ï¼Ÿ ç„¶åå†è°ƒç”¨GetDependencyæ¥å£çš„æ—¶å€™èµ„æºçš„ä¾èµ–å°±éƒ½æŒ‡å‘å›¾é›†è€Œéæ•£å›¾äº†ã€‚</p><h2 id="Spriteå’ŒSpriteAtlaså’ŒTextureçš„æ¦‚å¿µé‡è¦åŒºåˆ†">Spriteå’ŒSpriteAtlaså’ŒTextureçš„æ¦‚å¿µé‡è¦åŒºåˆ†</h2><p>åœ¨åˆç†ä½¿ç”¨SpriteAtlasçš„æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬æŠŠAssetBundleåŒ…è§£å¼€ä»¥åï¼Œä¼šå‘ç°é‡Œé¢ä¼šåŒ…å«ä¸€å¼ Textureå’Œè‹¥å¹²ä¸ªSpriteè¿™ä¸¤ç§èµ„äº§ã€‚Textureæ˜¯çº¹ç†ï¼Œæ˜¾ç¤ºçš„æ–‡ä»¶å¤§å°è¾ƒå¤§ï¼›è€ŒSpriteå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæè¿°äº†ç²¾çµåœ¨æ•´å¼ çº¹ç†ä¸Šçš„åç§»é‡ä½ç½®ä¿¡æ¯çš„æ•°æ®æ–‡ä»¶ï¼Œæ˜¾ç¤ºçš„æ–‡ä»¶å¤§å°è¾ƒå°ã€‚å› æ­¤è¿™ä¸ªä¸æ˜¯å†—ä½™ï¼Œæ˜¯æ­£å¸¸ç°è±¡ã€‚</p><p>Spriteå’ŒSprite Atlasæ˜¯ä¸¤ä¸ªç±»ï¼Œä»–ä»¬ä¸­å…·æœ‰ä¸€äº›å›¾ç‰‡ä¿¡æ¯çš„æ•°æ®æˆå‘˜ï¼Œä»–ä»¬ä¸æ˜¯çœŸçš„â€œå›¾ç‰‡â€ï¼è€ŒTextureæ‰æ˜¯çœŸæ­£çš„å›¾ç‰‡ï¼Œå› æ­¤åœ¨MemoryProfilerä¸­ä½ å¯ä»¥çœ‹åˆ°SpriteAtlaså’ŒSpriteç±»å¤–åŠ çœŸæ­£çš„å›¾ç‰‡Textureè¢«åŠ è½½åˆ°å†…å­˜ä¸­</p><h1>å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://blog.csdn.net/yinfourever/article/details/109493160">https://blog.csdn.net/yinfourever/article/details/109493160</a></li><li><a href="https://zhuanlan.zhihu.com/p/369080940">https://zhuanlan.zhihu.com/p/369080940</a></li><li><a href="https://docs.unity3d.com/cn/2021.2/Manual/AssetBundles-Native.html">https://docs.unity3d.com/cn/2021.2/Manual/AssetBundles-Native.html</a></li><li><a href="https://www.jianshu.com/p/1b1527faaca2">https://www.jianshu.com/p/1b1527faaca2</a></li><li><a href="https://www.jianshu.com/p/0d18ac565563">https://www.jianshu.com/p/0d18ac565563</a></li><li><a href="https://blog.csdn.net/sunheng_/article/details/128204386">https://blog.csdn.net/sunheng_/article/details/128204386</a></li><li><a href="https://blog.uwa4d.com/archives/TechSharing_249.html">https://blog.uwa4d.com/archives/TechSharing_249.html</a></li><li><a href="https://www.yuque.com/sibyl-3ao1w/phv062/sgagpsf8bcm9fu1b?singleDoc">https://www.yuque.com/sibyl-3ao1w/phv062/sgagpsf8bcm9fu1b?singleDoc</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¡¬æŠ€èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AssetBundle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UnityAndroidå·¥ç¨‹åŒ…ä½“ä¼˜åŒ–</title>
      <link href="/posts/279644bd/"/>
      <url>/posts/279644bd/</url>
      
        <content type="html"><![CDATA[<h1>åŒ…ä½“æ„æˆ</h1><p>ä½¿ç”¨AndroidStudioä¸­çš„<code>Build -&gt; ApkAnalyzer</code>æ¥å¯¹åŒ…ä½“å†…å®¹è¿›è¡Œåˆ†æï¼Œå¯ä»¥çœ‹åˆ°å®‰å“åŒ…å†…çš„åŸºæœ¬ç»“æ„å¦‚ä¸‹ï¼š</p><img src="/posts/279644bd/image.png" class=""><p>Resourcesç›®å½•ä¸‹çš„æ–‡ä»¶éƒ½ä¼šè¢«æ‰“åŒ…è¿›<code>assets/bin/Data/data.unity3d</code>æ–‡ä»¶ä¸­ï¼Œæ¸¸æˆå¯åŠ¨çš„æ—¶å€™ä¼šä¸€æ¬¡æ€§æŠŠè¿™ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå› æ­¤åº”è¯¥è¦å°½å¯èƒ½åœ°å‡å°æ”¾åœ¨resourcesç›®å½•ä¸‹çš„æ–‡ä»¶ä½“ç§¯ã€‚</p><h1>libil2cpp.soå†…å®¹åˆ†æ</h1><p><a href="https://blog.csdn.net/linxinfa/article/details/116572369">https://blog.csdn.net/linxinfa/article/details/116572369</a></p><h1>AssetRipperä½¿ç”¨</h1><p>AssetRipperçš„GitHubé“¾æ¥ğŸ‘‰ğŸ‘‰ğŸ‘‰ <a href="https://github.com/AssetRipper/AssetRipper">https://github.com/AssetRipper/AssetRipper</a></p><p>ä¸‹è½½åˆ°æœ¬åœ°è§£å‹ååœ¨æ ¹ç›®å½•æ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œ<code>./AssetRipper.GUI.Free</code>åœ¨æµè§ˆå™¨ä¸­å¯åŠ¨ã€‚</p><p>UnityResourcesç›®å½•ä¸‹çš„å†…å®¹éƒ½è¢«æ‰“åŒ…è¿›äº†ä¸€ä¸ªunity_3dçš„ç›®å½•ä¸‹ï¼Œ</p><h1>AssetBundleæ‰“åŒ…é—®é¢˜</h1><h1>èµ„æºå†—ä½™</h1><p>å¦‚æœä¸¤ä¸ªab Aå’ŒBä¸­çš„ä¸€äº›èµ„æºéƒ½ä¾èµ–äº†ä¸€ä¸ªæ²¡æœ‰è¢«æŒ‡å®šè¦æ‰“åŒ…çš„èµ„æºCï¼Œé‚£ä¹ˆCå°±ä¼šåŒæ—¶è¢«æ‰“è¿›ab Aå’ŒBä¸­ï¼Œé€ æˆèµ„æºçš„å†—ä½™ï¼Œå¢å¤§abå’Œå®‰è£…åŒ…çš„ä½“ç§¯ã€‚è€Œè¿™ä¸ªè¢«Aï¼ŒBä¾èµ–çš„èµ„æºCåˆå¯ä»¥åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯Assetsä¸‹å¤–éƒ¨å¯¼å…¥çš„èµ„æºï¼Œå³å¼€å‘è€…å¯¼å…¥æˆ–åˆ›å»ºçš„èµ„æºï¼›å¦ä¸€ç§åˆ™æ˜¯Unityå†…ç½®çš„èµ„æºï¼Œä¾‹å¦‚å†…ç½®çš„Shaderï¼ŒDefault-Materialå’ŒUGUIä¸€äº›ç»„ä»¶å¦‚Imageç”¨çš„ä¸€äº›çº¹ç†èµ„æºç­‰ç­‰ã€‚å› æ­¤è¦è§£å†³èµ„æºå†—ä½™çš„é—®é¢˜ï¼Œå°±è¦åˆ†åˆ«å¯¹è¿™ä¸¤ç§è¢«ä¾èµ–çš„èµ„æºè¿›è¡Œå¤„ç†ã€‚</p><p>å†—ä½™æ‰“åŒ…çš„åŸå› æ˜¯å› ä¸ºè¯¥èµ„æºæ²¡æœ‰è¢«æŒ‡å®šæ‰“åˆ°å“ªä¸ªåŒ…å†…ï¼Œæ‰€ä»¥éå†æ‰€æœ‰çš„èµ„æºï¼Œæ‰¾åˆ°æ‰€æœ‰èµ„æºçš„ä¾èµ–å…³ç³»ï¼Œå¹¶æ‰¾åˆ°è¿™äº›æ²¡æœ‰è¢«æ˜¾ç¤ºæŒ‡å®šæ‰“åˆ°å“ªä¸ªAssetBundleçš„èµ„æºï¼Œæ‰“å°å‡ºLog</p>]]></content>
      
      
      <categories>
          
          <category> ç¡¬æŠ€èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RPGæ¸¸æˆå¼€å‘è®°å½•(ä¸‰)ï¼šPlayeræ¨¡å‹ä¸åŠ¨ç”»</title>
      <link href="/posts/8601cc5/"/>
      <url>/posts/8601cc5/</url>
      
        <content type="html"><![CDATA[<h1>çŠ¶æ€æœº</h1><p>Unityçš„Animatorç³»ç»Ÿæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œç¬”è€…è®¤ä¸ºåœ¨æ­¤å¼•å…¥çŠ¶æ€æœºæœ‰åˆ©äºåŠŸèƒ½çš„å®ç°ã€‚åœ¨è¡¨ç°ä¸Šï¼Œäººç‰©ä¼šè·‘ã€è·³ã€é£ç­‰åŠ¨ä½œï¼Œè€Œä¸ä¹‹å¯¹åº”çš„æ˜¯ä¸è¿™äº›åŠ¨ä½œç›¸å…³çš„æ•°æ®å‘ç”Ÿäº†å˜åŒ–ï¼Œæ³¨æ„è¿™é‡Œé¢çš„å…ˆåå…³ç³»ï¼šå…ˆæ˜¯ç”±äºæ•°æ®å‘ç”Ÿäº†å˜åŒ–ï¼Œç„¶åæ‰å¯¼è‡´äº†è¡¨ç°ä¸Šè§’è‰²åŠ¨ç”»è¡Œä¸ºçš„å˜åŒ–ã€‚ç§‰æ‰¿ç€ä¸Šè¿°æ•°æ®é©±åŠ¨è¡¨ç°çš„åŸåˆ™ï¼Œæˆ‘ä»¬ç±»æ¯”AnimatorçŠ¶æ€æœºï¼Œä¸ºæˆ‘ä»¬çš„æ•°æ®å±‚ä¹Ÿå»ºç«‹ä¸€ä¸ªçŠ¶æ€æœºã€‚å…¶å®ä»»ä½•é€»è¾‘ä½ éƒ½å¯ä»¥å»ç”¨çŠ¶æ€æœºè¿›è¡Œç»„ç»‡ï¼Œåªè¦ä½ èƒ½å¤ŸæŠ½è±¡å‡ºå‡ ç§äº’æ–¥çš„çŠ¶æ€ï¼Œç„¶ååœ¨æ¯ç§çŠ¶æ€å†…éƒ¨å»å®ç°è¯¥çŠ¶æ€ä¸‹çš„æ‰€æœ‰é€»è¾‘ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹çŠ¶æ€æœºçš„åŸºæœ¬å†™æ³•ã€‚</p><p>çŠ¶æ€æœºå¯ä»¥è¢«åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯çŠ¶æ€ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯ç®¡ç†è¿™äº›çŠ¶æ€çš„éƒ¨åˆ†ã€‚è¿™ä¸¤ä¸ªéƒ¨åˆ†çš„å…·ä½“è¡¨ç°éƒ½æ˜¯ç±»ï¼Œä¸Šé¢æˆ‘ä»¬è¯´è¦åœ¨</p><p>æœ¬èŠ‚å°†æˆ‘ä»¬æ§åˆ¶çš„Playerç”±åœ†æŸ±ä½“æ›¿æ¢æˆæœ‰äººå½¢éª¨éª¼çš„æ¨¡å‹</p><h1>æ¨¡å‹</h1><h1>Unityä¸­çš„åŠ¨ç”»ç³»ç»Ÿ</h1><p>å®ç°ä¸€ä¸ªå¯ä»¥é™æ­¢ã€ç§»åŠ¨åˆ‡æ¢çš„åŠ¨ç”»çŠ¶æ€</p><p>é™æ­¢çŠ¶æ€ä¸‹éšæœºæ’­æ”¾åŠ¨ç”»</p><h2 id="è¦å†™ä¸€ä¸ªçŠ¶æ€æœº">è¦å†™ä¸€ä¸ªçŠ¶æ€æœº</h2><p>è®¾è®¡ä¸€ä¸ªä¸»è§’çš„çŠ¶æ€æœº</p><p>ä¸»è§’æœ‰Idleã€Moveã€Jumpç­‰çŠ¶æ€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sm.AddState(StateEnum, StateClass(Host, Animation ....))</span><br></pre></td></tr></table></figure><p>ç±»ä¼¼ä¸Šé¢çš„çŠ¶æ€æ³¨å†Œï¼Œå°†Animatorä¼ é€’è¿›å»ï¼Œåœ¨æ¯ä¸ªçŠ¶æ€çš„OnTickä¸­æ‰§è¡ŒéŸ³é¢‘ã€åŠ¨ç”»ç­‰æ¨¡å—çš„æ›´æ–°</p><p>PlayerControlleræ˜¯çŠ¶æ€æœºçš„Host</p><h2 id=""></h2>]]></content>
      
      
      <categories>
          
          <category> ç¡¬æŠ€èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼€å‘æ—¥å¿— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>3Dæ•°å­¦åŸºç¡€-å¤šä¸ªåæ ‡ç©ºé—´</title>
      <link href="/posts/9e2eb769/"/>
      <url>/posts/9e2eb769/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡åšå®¢æ˜¯ç¬”è€…ç»“åˆã€ŠUnityShaderå…¥é—¨ç²¾è¦ã€‹å’Œã€Š3Dæ•°å­¦åŸºç¡€â€”â€”å›¾å½¢å’Œæ¸¸æˆå¼€å‘ã€‹ä¸¤æœ¬ä¹¦å¯¹Shaderæ‰€éœ€è¦çš„æ•°å­¦çŸ¥è¯†çš„æ•´ç†ã€‚</p><p>åœ¨ã€Š3Dæ•°å­¦åŸºç¡€â€”â€”å›¾å½¢å’Œæ¸¸æˆå¼€å‘ã€‹ç¬¬ä¸‰ç« ä¸­ï¼Œä½œè€…ä»‹ç»äº†åæ ‡ç©ºé—´çš„çŸ¥è¯†ï¼Œ<br>ç¬¬ä¸‰ç« ä¸­æœ‰ä¸‰ä¸ªå¾ˆæœ‰æ„æ€çš„çŸ¥è¯†ç‚¹ï¼šç›´ç«‹ç©ºé—´ã€å˜æ¢åæ ‡ç©ºé—´çš„ä¸¤ç§è§†è§’ï¼šç»å¯¹è§†è§’å’Œå±€éƒ¨è§†è§’ã€ä»çŸ¢é‡çš„è§’åº¦è¿›è¡Œåæ ‡å˜æ¢</p><p>ä¹¦ä¸­å¯¹ä¸–ç•Œç©ºé—´çš„æè¿°ç¬”è€…åœ¨æ­¤æœ‰å¿…è¦æåŠï¼šThe <strong>world coordinate system</strong> is a special coordinate system that establishes the â€œglobalâ€ reference frame for all other coordinate system to be specified. In other words, we can express the position of other coordinate spaces in terms of the world coordinate space, but we cannot express the world coordinate space in terms of any larger, outer coordinate space.</p><p>ä¸–ç•Œåæ ‡ç©ºé—´æ˜¯æˆ‘ä»¬å…³å¿ƒçš„â€œæœ€å¤§â€ç©ºé—´ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºä½¿ç”¨ä¸–ç•Œåæ ‡ç©ºé—´è¡¨ç¤ºçš„ç‰©ä½“ä½ç½®å°±æ˜¯ç»å¯¹ä½ç½®ã€‚</p><p>ä¹¦ä¸­æä¾›äº†ä¸€ä¸ªæœ‰è¶£çš„è§†è§’æ¥æè¿°å„ä¸ªåæ ‡ç³»ï¼Œé‚£å°±æ˜¯æŠŠåæ ‡ç³»ä¹Ÿå½“ä½œè¢«æ”¾å…¥ä¸–ç•Œç©ºé—´ä¸­çš„ä¸€ä¸ªç‰©ä½“ï¼Œè¿™å¸®åŠ©ç¬”è€…æ›´å¥½åœ°ç†è§£äº†å„ä¸ªåæ ‡ç³»çš„è½¬æ¢è¿‡ç¨‹ã€‚ç¬”è€…ä¼šåœ¨<strong>å˜æ¢åæ ‡ç©ºé—´çš„ä¸¤ç§è§†è§’ï¼šç»å¯¹è§†è§’å’Œå±€éƒ¨è§†è§’</strong>éƒ¨åˆ†è¿›è¡Œé˜è¿°ã€‚</p><h1>å˜æ¢åæ ‡ç©ºé—´çš„ä¸¤ç§è§†è§’ï¼šç»å¯¹è§†è§’å’Œå±€éƒ¨è§†è§’</h1><p>ç›´ç«‹ç©ºé—´æ˜¯æœ¬ä¹¦å¼•å…¥çš„ä¸€ä¸ªåæ ‡ç©ºé—´ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹æ²¡æœ‰ç›´ç«‹ç©ºé—´æ—¶ä¸€ä¸ªç‰©ä½“çš„åæ ‡ä»å¯¹è±¡ç©ºé—´è½¬æ¢åˆ°ä¸–ç•Œç©ºé—´çš„è¿‡ç¨‹</p><p>æˆ‘ä»¬æƒ³è±¡ä¸€ä¸‹å°†ä¸€ä¸ªåæ ‡ç³»æ¨¡æ ·çš„ç‰©ä½“æ”¾åœ¨è¿™ä¸ªç‰©ä½“çš„ä¸­å¿ƒç‚¹ä½ç½®ï¼Œæˆ‘ä»¬è¦åšçš„ï¼Œå°±æ˜¯æŠŠè¿™ä¸ªåæ ‡ç³»ç‰©ä½“ä»ç‰©ä½“çš„ä¸­å¿ƒç‚¹ä½ç½®ç§»åŠ¨åˆ°ä¸–ç•Œç©ºé—´çš„ä¸­å¿ƒç‚¹ä½ç½®(åæ ‡ç³»çš„åæ ‡è½´å’ŒåŸç‚¹éƒ½ä¸æ”¾åœ¨ä¸–ç•Œç©ºé—´ä¸­å¿ƒä½ç½®çš„åæ ‡ç³»ç‰©ä½“çš„åæ ‡è½´å’ŒåŸç‚¹å®Œå…¨é‡åˆ)ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ªåæ ‡ç³»ç‰©ä½“å¹³ç§»åˆ°ä¸–ç•Œç©ºé—´çš„åæ ‡ç³»ç‰©ä½“åŸç‚¹çš„ä½ç½®ï¼Œç„¶åå›´ç»•ä¸–ç•Œç©ºé—´åæ ‡ç³»ç‰©ä½“çš„åŸç‚¹è¿›è¡Œæ—‹è½¬å°±å¯ä»¥äº†ã€‚åœ¨è¿™ç§è§†è§’ä¸‹è§‚å¯Ÿï¼Œä»¿ä½›æ˜¯åæ ‡ç³»è‡ªå·±åœ¨ç§»åŠ¨ï¼Œè€Œç‰©ä½“æ˜¯æ²¡æœ‰ç§»åŠ¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„è§†è§’æ˜¯é”å®šåœ¨ç‰©ä½“ä¸Šçš„ï¼Œè¿™ç§è§†è§’ä¹Ÿè¢«ç§°ä¸ºç»å¯¹è§†è§’ã€‚</p><p>å¦ä¸€ç§è§†è§’ï¼šåæ ‡ç³»ä¸åŠ¨ï¼Œç‰©ä½“åœ¨åŠ¨ï¼Œè¿™ç§è§†è§’ä¸‹æˆ‘ä»¬æ˜¯é”å®šåœ¨åæ ‡ç³»ä¸Šçš„ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œæœ€ä¸€å¼€å§‹çš„æ—¶å€™ï¼Œä¸–ç•Œåæ ‡ç³»çš„è¿™ä¸ªç‰©ä½“çš„ä¸­å¿ƒä½ç½®ï¼ˆä¹Ÿå°±æ˜¯å¯¹è±¡ç©ºé—´åæ ‡ç³»çš„ä½ç½®æ˜¯é‡åˆçš„ï¼‰ï¼Œç„¶åç¥å¥‡çš„æ¥çš„ï¼Œæˆ‘ä»¬å‡è®¾ç‰©ä½“ç°åœ¨æ‰€åœ¨çš„ä½ç½®å°±æ˜¯ä¸–ç•Œçš„ä¸­å¿ƒï¼Œè€Œä¸”ç°åœ¨å¯¹è±¡ç©ºé—´çš„åæ ‡ç³»å°±å’Œä¸–ç•Œåæ ‡ç³»å®Œå…¨é‡åˆï¼Œæˆ‘ä»¬ç°åœ¨è¦åšçš„æ˜¯â€”â€”é€šè¿‡ç§»åŠ¨æ•´ä¸ªä¸–ç•Œï¼Œè®©æ•´ä¸ªä¸–ç•Œçš„åŸç‚¹ç§»åŠ¨åˆ°è¿™ä¸ªä½ç½®ï¼Œæˆ‘ä»¬å‡è®¾ä¸–ç•Œçš„åŸç‚¹ä¸åœ¨ä»–è¯¥åœ¨çš„åœ°æ–¹ã€‚åœ¨è¿™ç§è§†è§’ä¸‹ï¼Œæˆ‘ä»¬è¦å…ˆå¹³ç§»å†æ—‹è½¬ã€‚</p><h1>ç›´ç«‹ç©ºé—´(Upright Space)</h1><p>åœ¨ä»å¯¹è±¡ç©ºé—´å˜æ¢åˆ°ä¸–ç•Œç©ºé—´æˆ–è€…ä»ä¸–ç•Œç©ºé—´å˜æ¢åˆ°å¯¹è±¡ç©ºé—´çš„è¿‡ç¨‹ä¸­</p><img src="/posts/9e2eb769/image.png" class=""><h1>ä»çŸ¢é‡çš„è§’åº¦è¿›è¡Œåæ ‡å˜æ¢</h1><p>ä»ä¸€ä¸ªç‚¹çš„è§’åº¦çœ‹ï¼Œå°±æ˜¯ä»ä¸€ç§åæ ‡ç³»çš„å¯¹è¯¥ç‚¹çš„è¡¨ç¤ºè½¬æ¢åˆ°å¦ä¸€ä¸ªåæ ‡ç³»ä¸­å¯¹è¯¥ç‚¹çš„è¡¨ç¤ºï¼Œ</p><p>å¦‚æœå·²çŸ¥ä¸€ä¸ªåæ ‡ç³»Açš„åŸºçŸ¢é‡åœ¨å¦å¤–ä¸€ä¸ªåæ ‡ç³»Bä¸­çš„åŸºçŸ¢é‡çš„è¡¨ç¤ºï¼Œé‚£ä¹ˆçŸ¥åæ ‡ç³»Bä¸­çš„ç‚¹çš„è¡¨ç¤ºï¼Œå¯ä»¥<br>åŒæ ·çš„å‰æï¼Œå¦‚æœå·²çŸ¥åæ ‡ç³»Aä¸­çš„ç‚¹çš„è¡¨ç¤ºï¼ŒåŒæ ·å¯ä»¥ç”¨è¿™ä¸€ç»„åŸºçŸ¢é‡çš„å¯¹åº”å…³ç³»è½¬æ¢æˆåæ ‡ç³»Bä¸­çš„ç‚¹çš„è¡¨ç¤º</p><p>æˆ‘ä»¬å‡è®¾æ¯ä¸ªåæ ‡ç©ºé—´ä¸­éƒ½æœ‰ä¸¤å¹…åæ ‡ç³»ï¼Œè¿™ä¸¤å¹…åæ ‡ç³»æ˜¯ä¸€æ¨¡ä¸€æ ·çš„åœ¨æœ€ä¸€å¼€å§‹ï¼Œ<br>å°±æ‹¿æœ€ç†Ÿæ‚‰çš„ä¸–ç•Œç©ºé—´åæ ‡ç³»ä¸¾ä¾‹å­ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä¸¤å¹…åæ ‡ç³»ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦ä¸€å‰¯åæ ‡ç³»æ¥ç§»åŠ¨ï¼Œå¦ä¸€å‰¯åæ ‡ç³»æ¥æ ‡å®šç§»åŠ¨åæ ‡ç³»çš„ä½ç½®ä¿¡æ¯</p><p>ä¸‰ç»´ç©ºé—´ä¸­éœ€è¦ä¸‰ä¸ªä¸åœ¨åŒä¸€å¹³é¢çš„çŸ¢é‡åæ ‡æ‰èƒ½è¡¨ç¤ºç©ºé—´ä¸­æ‰€æœ‰çš„ä½ç½®ï¼Œå¯ä»¥ç”¨ä¸–ç•Œåæ ‡ç³»è¡¨ç¤ºè¿™ä¸‰ä¸ªåŸºçŸ¢é‡çš„æ–¹å‘ä¿¡æ¯ï¼Œå’ŒåŸç‚¹ä¿¡æ¯ï¼Œç„¶åè¿™ä¸‰ä¸ªåŸºçŸ¢é‡å¯ä»¥æ„æˆä¸€ä¸ªæ–°çš„åæ ‡ç³»ã€‚ è¡¨ç¤ºæŸä¸€ç‚¹(x, y, z)ï¼ŒæŠŠx y zçœ‹æˆæ˜¯åŸºçŸ¢é‡å‰é¢çš„ç³»æ•°è€Œéæ˜¯åæ ‡ä¼šæ›´å¥½åœ°ç†è§£åŸºçŸ¢é‡çš„æœºç†</p><h1>é½æ¬¡åæ ‡ç©ºé—´</h1><img src="/posts/9e2eb769/image.png" class=""><h1>å±å¹•ç©ºé—´</h1><h1>ç›¸æœºç©ºé—´</h1><h1>è£å‰ªç©ºé—´</h1><h1>åˆ‡çº¿ç©ºé—´</h1>]]></content>
      
      
      <categories>
          
          <category> 3Dæ•°å­¦åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°å­¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RPGæ¸¸æˆå¼€å‘è®°å½•(äºŒ)ï¼šç›¸æœºæ§åˆ¶</title>
      <link href="/posts/ea538f2a/"/>
      <url>/posts/ea538f2a/</url>
      
        <content type="html"><![CDATA[<h1>åŸºæœ¬æ€æƒ³</h1><p>å·«å¸ˆ3ä¸­çš„ç›¸æœºæ˜¯é”å¤´çš„ï¼Œå¦‚æœPlayerçš„å¤´å’Œæ‘„åƒæœºä¹‹é—´æœ‰é®æŒ¡å°±ä¼šä½ç§»<br>ç›¸æœºçš„è¿åŠ¨å¯ä»¥è¢«æ‹†åˆ†æˆç›¸æœºè·Ÿéšã€æ°´å¹³è½¬å‘ã€ä¿¯ä»°(ç«–ç›´)è½¬å‘ä¸‰ä¸ªåˆ†è¿åŠ¨ã€‚<br>å› æ­¤ï¼Œåœ¨ç¬”è€…è®¾è®¡çš„ç›¸æœºè·Ÿéšçš„æ–¹æ¡ˆä¸­ï¼Œç›¸æœºç»„ä»¶ä¼šè¢«è®¾è®¡æˆä¸€ä¸ªå…·æœ‰ä¸‰å±‚åµŒå¥—å…³ç³»çš„ç»“æ„â€”â€”æœ€å¤–å±‚è´Ÿè´£è·Ÿéšè§’è‰²ç§»åŠ¨ã€ä¸­é—´å±‚è´Ÿè´£ç›¸æœºæ°´å¹³æ–¹å‘ä¸Šçš„è½¬å‘ã€æœ€å†…å±‚è´Ÿè´£ç›¸æœºç«–ç›´æ–¹å‘çš„è½¬å‘ã€‚</p><h1>ç”¨åˆ°çš„æ¥å£</h1><ul><li><a href="https://docs.unity3d.com/ScriptReference/Transform.InverseTransformDirection.html">Transform.InverseTransformDirection(Vector3 direction);</a><br>ä¼ å…¥ä¸€ä¸ªä¸–ç•Œç©ºé—´åæ ‡ä¸‹è¡¨ç¤ºçš„ä¸‰ç»´å‘é‡ï¼Œå¾—åˆ°è¿™ä¸ªtransformå¯¹è±¡ç©ºé—´åæ ‡ä¸‹è¯¥å‘é‡çš„è¡¨ç¤º</li><li><a href="https://docs.unity3d.com/ScriptReference/Transform.TransformDirection.html">Transform.TransformDirection(Vector3 direction);</a><br>ä¼ å…¥ä¸€ä¸ªåœ¨è¯¥transformåæ ‡ç©ºé—´ä¸‹è¡¨ç¤ºçš„ä¸‰ç»´å‘é‡ï¼Œå¾—åˆ°è¿™ä¸ªå‘é‡åœ¨ä¸–ç•Œç©ºé—´åæ ‡ä¸‹çš„è¡¨ç¤º</li><li><a href="https://docs.unity3d.com/ScriptReference/Transform.RotateAround.html">Transform.RotateAround(Vector3 point, Vector3 axis, float angle);</a><br>ä½¿ä¸€ä¸ªç‰©ä½“ç»•ç€ç©¿è¿‡æŸä¸€ç‚¹çš„æŸä¸€ä¸ªæ–¹å‘çš„è½´æ—‹è½¬angleè§’åº¦ï¼Œåœ¨å·¦æ‰‹åæ ‡ç³»ä¸­ï¼Œé¡ºæ—¶é’ˆä¸ºæ­£å‘æ—‹è½¬ã€‚</li><li><a href="https://docs.unity3d.com/ScriptReference/Vector3.SmoothDamp.html">Vector3.SmoothDamp(Vector3 current, Vector3 target, ref Vector3 currentVelocity, float smoothTime, float maxSpeed = Mathf.Infinity, float deltaTime = Time.deltaTime);</a><br>Gradually changes a vector towards a desired goal over time.</li></ul><p>æˆ‘è¿˜éœ€è¦çŸ¥é“ç›¸æœºè·ç¦»è§’è‰²çš„è·ç¦»ï¼Œè¿™ä¸ªè·ç¦»åº”è¯¥æ˜¯ä¸‰ç»´ç©ºé—´ä¸‹çš„è·ç¦»ï¼Œæ¯”å¦‚è¯´å¦‚æœæ‘„åƒæœºçš„è§†è§’å¾ˆé«˜çš„è¯ï¼Œè¿™æ—¶å€™é•œå¤´å°±ä¼šç¦»æ§åˆ¶è§’è‰²çš„å¤´é¡¶å¾ˆè¿‘ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€å¥—é€»è¾‘å»åŠ¨æ€æ§åˆ¶è¿™ä¸ªè·ç¦»ï¼Œæ¯”å¦‚è¯´è§’è‰²é å¢™å¾ˆè¿‘çš„æ—¶å€™ï¼Œé•œå¤´è¦å°½å¯èƒ½åœ°é è¿‘è§’è‰²ï¼Œè¿™ä¸ªåŠŸèƒ½èƒ½ä¸èƒ½ç›´æ¥é€šè¿‡ç»™ç›¸æœºä¸Šè£…ä¸€ä¸ªç¢°æ’ä½“å®ç°ï¼Ÿ</p><p>å¦å¤–è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›¸æœºçš„æ—‹è½¬æ˜¯ä»¥æˆ‘ä»¬æ§åˆ¶çš„è§’è‰²ä¸ºä¸­å¿ƒçš„ï¼Œåœ¨è§†è§’ä¸­æˆ‘ä»¬çš„è§’è‰²ä¸€èˆ¬åå·¦ï¼Œé•œå¤´æ—‹è½¬ä¹Ÿæ˜¯å›´ç»•ç€å·¦ä¾§ä¸ºè½´è¿›è¡Œçš„</p><h1>å¤–å±‚è·Ÿéšé€»è¾‘</h1><p>æˆ‘ä»¬è¦è®©ç›¸æœºçš„å¤–å±‚èŠ‚ç‚¹å§‹ç»ˆè·ŸéšPlayerï¼Œæˆ‘ä»¬ç«™åœ¨æ‘„åƒæœºçš„è§†è§’çœ‹ï¼Œæ— è®ºæˆ‘ä»¬æ€ä¹ˆæ“ä½œè§’è‰²å’Œç›¸æœºï¼Œæ‘„åƒæœºå’ŒPlayerä¹‹é—´çš„ç›¸å¯¹æ–¹å‘æ˜¯ä¸å˜çš„(ç”±å¤–å±‚èŠ‚ç‚¹åŸç‚¹æŒ‡å‘Playeræ–¹å‘çš„çŸ¢é‡æ˜¯ä¸å˜çš„ï¼Œä½†æ˜¯è·ç¦»å¯èƒ½ä¼šå˜)ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç»™å®šä¸€ä¸ªæ‘„åƒæœºå’ŒPlayerä½ç½®å…³ç³»çš„å•ä½æ–¹å‘çŸ¢é‡<strong>v</strong>ï¼Œå’Œä¸€ä¸ªæ‘„åƒæœºå’ŒPlayeræ—¶é—´çš„è·ç¦»<code>distance</code>ã€‚æ³¨æ„ï¼Œè¿™ä¸ªæ–¹å‘çŸ¢é‡æ˜¯å¯¹è±¡ç©ºé—´åæ ‡ä¸‹è¡¨ç¤ºçš„ï¼Œæˆ‘ä»¬è¦é€šè¿‡åæ ‡ç³»å˜æ¢ï¼Œå°†è¯¥çŸ¢é‡å˜æ¢åˆ°ä¸–ç•Œåæ ‡ç³»ä¸‹ï¼Œç„¶åå†ç”¨ä¸–ç•Œåæ ‡ä¸‹Playerçš„ä½ç½®å‡å»æ–¹å‘çŸ¢é‡ä¹˜<code>distance</code>çš„ç»“æœï¼Œå°±æ˜¯æ‘„åƒæœºæ‰€å¤„çš„ä½ç½®ã€‚</p><h1>ä¸­å±‚æ°´å¹³æ—‹è½¬é€»è¾‘</h1><p>åœ¨æ°´å¹³å’Œä¿¯ä»°çš„æ—‹è½¬å®ç°ä¸­ï¼Œä¸€å®šè¦æ³¨æ„æ—‹è½¬çš„ä¸­å¿ƒä¸æ˜¯æ‘„åƒæœºçš„ä¸­å¿ƒç‚¹ï¼Œè€Œæ˜¯Playerçš„ä¸­å¿ƒç‚¹ï¼Œå¯¹äºæ°´å¹³æ—‹è½¬çš„æè¿°å°±æ˜¯ä¸­å±‚èŠ‚ç‚¹ç»•è¿‡Playerçš„ä¸­å¿ƒç‚¹çš„å¹³è¡Œäºä¸–ç•Œç©ºé—´yè½´æ­£æ–¹å‘çš„è½´è¿›è¡Œæ—‹è½¬ã€‚</p><h1>å†…å±‚ä¿¯ä»°é€»è¾‘</h1><p>åŒä¸­å±‚æ°´å¹³æ—‹è½¬é€»è¾‘ä¸€æ ·ï¼Œæ—‹è½¬çš„ä¸­å¿ƒç‚¹ä½äºPlayerçš„ä¸­å¿ƒç‚¹ï¼Œå¯¹ä¿¯ä»°æ—‹è½¬çš„æè¿°æ˜¯å†…å±‚èŠ‚ç‚¹ç»•è¿‡Playerçš„ä¸­å¿ƒç‚¹çš„å¹³è¡Œäºä¸–ç•Œç©ºé—´xè½´æ­£æ–¹å‘çš„è½´è¿›è¡Œæ—‹è½¬ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç»™ä¿¯ä»°æ—‹è½¬æ·»åŠ æ—‹è½¬è§’åº¦çš„é™åˆ¶ï¼Œå¦‚æœä¸è®¾é™é•œå¤´ä¼šç¿»è½¬ä¸”è§†è§’å¾ˆå¥‡æ€ªã€‚è¿™é‡Œä¼šé‡åˆ°çš„ä¸€ä¸ªå‘å°±æ˜¯ï¼Œåœ¨Inspectorçª—å£ä¸­çœ‹åˆ°çš„rotationæ˜¯è´Ÿå€¼ï¼Œä½†æ˜¯åœ¨ä»£ç ä¸­è¯¥å€¼å®é™…æ˜¯360 + è´Ÿå€¼ï¼Œå› æ­¤æˆ‘ä»¬è®¾ç½®ä¿¯ä»°è§’åº¦çš„èŒƒå›´å®é™…ä¸Šæ˜¯$[0, max]\cup[360 + min, 360ï¼‰$ã€‚</p><h1>æ‘„åƒæœºç¢°æ’é—®é¢˜</h1><p>å½“è§’è‰²é è¿‘å¢™ä½“å¾ˆè¿‘æ—¶ï¼Œè½¬åŠ¨æ‘„åƒæœºä½¿å…¶é è¿‘å¢™ä½“ï¼Œå¦‚æœæ‘„åƒæœºå’ŒPlayerä¹‹é—´è®¾ç½®çš„è·ç¦»è¾ƒè¿œï¼Œé‚£ä¹ˆæ‘„åƒæœºå°±ä¼šåµŒå…¥åˆ°å¢™ä½“ä¸­ï¼Œè¿™æ ·æ‘„åƒæœºå’ŒPlayerä¹‹é—´å°±ä¼šå‡ºç°éšœç¢ï¼Œå½±å“æ“ä½œä½“éªŒã€‚</p><p>å› æ­¤æˆ‘ä»¬éœ€è¦è®©è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶æ‘„åƒæœºè¦é è¿‘Playerç›´åˆ°æ‘„åƒæœºå’ŒPlayerä¹‹é—´æ²¡æœ‰é®æŒ¡ä¸ºæ­¢ã€‚</p><h1>ä»£ç å®ç°</h1><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Unity.Collections;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">CameraControl</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CameraHandler</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">SerializeField</span>] <span class="keyword">private</span> <span class="built_in">float</span> cameraDistance;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">private</span> Transform CameraFollowTransform =&gt; transform;</span><br><span class="line">        [<span class="meta">SerializeField</span>] <span class="keyword">private</span> Transform cameraTransform;</span><br><span class="line">        [<span class="meta">SerializeField</span>] <span class="keyword">private</span> Transform cameraHorizontalTransform;</span><br><span class="line">        [<span class="meta">SerializeField</span>] <span class="keyword">private</span> Transform targetTransform;</span><br><span class="line">        <span class="keyword">public</span> LayerMask ignoreLayers;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">float</span> horizontalSpeed = <span class="number">300f</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">float</span> verticalSpeed = <span class="number">300f</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">float</span> minimumVerticalAngle = <span class="number">-45</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">float</span> maximumAngle = <span class="number">20</span>;</span><br><span class="line">        [<span class="meta">ReadOnly</span>]<span class="keyword">public</span> Vector3 targetDirInCameraCoordinates;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">bool</span> _isViewBlocked;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">#<span class="keyword">if</span> UNITY_EDITOR</span></span><br><span class="line">        <span class="keyword">private</span> LineRenderer _lineRenderer;</span><br><span class="line">        <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Vector3 _previousTargetTransformPos;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="meta">#<span class="keyword">if</span> UNITY_EDITOR</span></span><br><span class="line">            _lineRenderer = gameObject.AddComponent&lt;LineRenderer&gt;();</span><br><span class="line">            _lineRenderer.positionCount = <span class="number">2</span>; <span class="comment">// è®¾ç½®è¿çº¿çš„é¡¶ç‚¹æ•°é‡ä¸º2</span></span><br><span class="line">            _lineRenderer.startWidth = <span class="number">0.1f</span>; <span class="comment">// è®¾ç½®è¿çº¿çš„èµ·å§‹å®½åº¦</span></span><br><span class="line">            _lineRenderer.endWidth = <span class="number">0.1f</span>; <span class="comment">// è®¾ç½®è¿çº¿çš„ç»“æŸå®½åº¦</span></span><br><span class="line">            <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            FollowTarget();</span><br><span class="line">            HandleCameraHorizontalRotation(Input.GetAxis(<span class="string">&quot;Mouse X&quot;</span>));</span><br><span class="line">            HandleCameraVerticalRotation(Input.GetAxis(<span class="string">&quot;Mouse Y&quot;</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="meta">#<span class="keyword">if</span> UNITY_EDITOR</span></span><br><span class="line">            _lineRenderer.SetPosition(<span class="number">0</span>, targetTransform.position);</span><br><span class="line">            _lineRenderer.SetPosition(<span class="number">1</span>, cameraTransform.position);</span><br><span class="line">            <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">            </span><br><span class="line">            ProcessCameraCollision();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnDrawGizmos</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (_previousTargetTransformPos == targetTransform.position)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// æ‘„åƒæœºåŠ¨æ˜¯è°ƒæ•´è§†è§’</span></span><br><span class="line">                CalculateTargetDirectionInCameraCoordinates();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// ç›¸æœºè·Ÿéšç‰©ä½“åŠ¨åˆ™æ‘„åƒæœºåªæ˜¯è·ŸéšPlayerä¸€èµ·åŠ¨</span></span><br><span class="line">                FollowTargetOnDrawGizmos();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            _previousTargetTransformPos = targetTransform.position;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CalculateTargetDirectionInCameraCoordinates</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> dir = targetTransform.position - transform.position;</span><br><span class="line">            targetDirInCameraCoordinates = transform.InverseTransformDirection(dir).normalized;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">FollowTarget</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> worldDir = CameraFollowTransform.TransformDirection(targetDirInCameraCoordinates).normalized;</span><br><span class="line">            <span class="keyword">var</span> targetPosition = targetTransform.position - worldDir * cameraDistance;</span><br><span class="line">            <span class="keyword">var</span> velocity = Vector3.zero;</span><br><span class="line">            CameraFollowTransform.position = Vector3.SmoothDamp(CameraFollowTransform.position, targetPosition, <span class="keyword">ref</span> velocity, <span class="number">0f</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">FollowTargetOnDrawGizmos</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> worldDir = CameraFollowTransform.TransformDirection(targetDirInCameraCoordinates).normalized;</span><br><span class="line">            <span class="keyword">var</span> targetPosition = targetTransform.position - worldDir * cameraDistance;</span><br><span class="line">            CameraFollowTransform.position = targetPosition;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">HandleCameraHorizontalRotation</span>(<span class="params"><span class="built_in">float</span> mouseXInput</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> horizontalAngle = mouseXInput * horizontalSpeed * Time.deltaTime;</span><br><span class="line">            cameraHorizontalTransform.RotateAround(targetTransform.position, Vector3.up, horizontalAngle);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">HandleCameraVerticalRotation</span>(<span class="params"><span class="built_in">float</span> mouseYInput</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> currentAngle = cameraTransform.localEulerAngles.x;</span><br><span class="line">            <span class="keyword">switch</span> (mouseYInput)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">case</span> &gt; <span class="number">0</span> <span class="keyword">when</span> currentAngle &lt;= <span class="number">360</span> + minimumVerticalAngle &amp;&amp; currentAngle &gt; <span class="number">180</span>:</span><br><span class="line">                <span class="keyword">case</span> &lt; <span class="number">0</span> <span class="keyword">when</span> currentAngle &gt;= maximumAngle &amp;&amp; currentAngle &lt; <span class="number">180</span>:</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                <span class="literal">default</span>:</span><br><span class="line">                    cameraTransform.RotateAround(targetTransform.position, cameraTransform.right, -mouseYInput * verticalSpeed * Time.deltaTime);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ProcessCameraCollision</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Physics.Linecast(cameraTransform.position, targetTransform.position, <span class="keyword">out</span> <span class="keyword">var</span> hit, ~ignoreLayers))</span><br><span class="line">            &#123;</span><br><span class="line">                cameraTransform.position = hit.point;</span><br><span class="line">                _isViewBlocked = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> dir = targetTransform.position - cameraTransform.position;</span><br><span class="line">                <span class="keyword">var</span> originPos = targetTransform.position - dir.normalized * cameraDistance;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!_isViewBlocked || !((cameraTransform.position - targetTransform.position).magnitude &lt; cameraDistance) ||</span><br><span class="line">                    Physics.Linecast(originPos, targetTransform.position, <span class="keyword">out</span> _, ~ignoreLayers)) <span class="keyword">return</span>;</span><br><span class="line">                cameraTransform.position = originPos;</span><br><span class="line">                _isViewBlocked = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>æ‘„åƒæœºç¢°æ’çš„å¦ä¸€ç§è§£å†³æ–¹æ¡ˆâ€”â€”è¾¹ç¼˜è½®å»“å…‰å®ç°</h1><p>æ‘„åƒæœºç¢°æ’çš„å¦ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œæ˜¯ä¸æ”¹å˜æ‘„åƒæœºå’Œè§’è‰²ä¹‹é—´çš„è·ç¦»ï¼Œè€Œæ˜¯åœ¨æ‘„åƒæœºå’Œè§’è‰²ä¹‹é—´æœ‰é®æŒ¡çš„æ—¶å€™ï¼Œé€šè¿‡ç»™Playeræ·»åŠ ä¸€å±‚å¤–è½®å»“å‘å…‰æ•ˆæœæ¥å‡å°‘é®æŒ¡å¯¹æ“ä½œä½“éªŒçš„å½±å“ï¼Œè¿™å°±éœ€è¦ç”¨åˆ°Shaderç›¸å…³çš„çŸ¥è¯†äº†ã€‚</p><h1>å‚è€ƒèµ„æ–™</h1>]]></content>
      
      
      <categories>
          
          <category> ç¡¬æŠ€èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼€å‘æ—¥å¿— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RPGæ¸¸æˆå¼€å‘è®°å½•(ä¸€)ï¼šè§’è‰²åŸºç¡€ç§»åŠ¨</title>
      <link href="/posts/1987e04c/"/>
      <url>/posts/1987e04c/</url>
      
        <content type="html"><![CDATA[<p>é¦–å…ˆæˆ‘ä»¬æ˜ç¡®ä¸€ä¸‹æˆ‘ä»¬è¦å®ç°çš„æ˜¯ç±»ä¼¼GTAå’Œå·«å¸ˆ3è¿™æ ·çš„ç¬¬ä¸‰äººç§°è§†è§’çš„æ§åˆ¶è§’è‰²ç§»åŠ¨æ–¹å¼ï¼Œæœ¬èŠ‚åªå®ç°æœ€ç®€å•çš„å‰åå·¦å³ç§»åŠ¨å’Œè§’è‰²è½¬å‘çš„é€»è¾‘ã€‚</p><h1>åŸºæœ¬æ€æƒ³</h1><p>æ¸¸æˆä¸­ï¼Œæˆ‘ä»¬æŒ‰ä¸‹Wé”®ï¼Œè§’è‰²ä¼šå‘å‰ç§»åŠ¨ï¼›æŒ‰ä¸‹Sé”®ï¼Œè§’è‰²ä¼šå…ˆè½¬èº«é¢å¯¹é•œå¤´ï¼Œç„¶åç§»åŠ¨ï¼›æŒ‰ä¸‹Aé”®ï¼Œè§’è‰²å…ˆå‘å·¦è½¬ï¼Œç„¶åç§»åŠ¨ï¼›æŒ‰ä¸‹Dé”®ï¼Œè§’è‰²å…ˆå‘å³è½¬ï¼Œç„¶åç§»åŠ¨ã€‚æˆ‘ä»¬å‘ç°ï¼Œæ— è®ºæŒ‰ä¸‹å“ªä¸ªé”®ï¼Œè§’è‰²éƒ½æ˜¯æœç€ä»–ä»¬è‡ªå·±çš„å‰æ–¹ç§»åŠ¨çš„ã€‚ä½†æ˜¯æˆ‘ä»¬åœ¨æŒ‰ä¸‹<code>WSAD</code>é”®æ—¶æ˜¯å¸Œæœ›è§’è‰²å‘å‰ã€åã€å·¦ã€å³ç§»åŠ¨çš„ã€‚è¿™é‡Œå­˜åœ¨ä¸€ä¸ªå‚è€ƒç³»çš„åŒºåˆ«ï¼Œå¦‚æœæˆ‘ä»¬æŠŠè‡ªå·±ä»£å…¥åˆ°æˆ‘ä»¬æ§åˆ¶çš„è§’è‰²è§†è§’ä¸Šï¼Œæˆ‘ä»¬ç¡®å®ä¸€ç›´éƒ½æ˜¯åœ¨å‘å‰èµ°ï¼›è€Œåœ¨æ‘„åƒæœºçš„è§†è§’ä¸­ï¼Œæˆ‘ä»¬æ§åˆ¶çš„è§’è‰²ä¹Ÿç¡®å®æŒ‰ç…§æˆ‘ä»¬çš„æ„æ„¿æœæŸä¸€æ–¹å‘åœ¨ç§»åŠ¨ã€‚å› æ­¤æˆ‘ä»¬æƒ³è¦å‘æŸä¸ªæ–¹å‘ç§»åŠ¨æ˜¯ä¸€ä¸ª<strong>æ‘„åƒæœºè§†è§’ä¸‹</strong>çš„æ¦‚å¿µã€‚æ‘„åƒæœºé¢å‘çš„æ–¹å‘æ˜¯å‰è¿›çš„æ–¹å‘ï¼Œæ‘„åƒæœºé¢å‘æ–¹å‘çš„å·¦æ–¹æ˜¯å‘å·¦ç§»åŠ¨çš„æ–¹å‘ï¼Œå³è¾¹å’Œåé¢åˆ†åˆ«æ˜¯æ‘„åƒæœºé¢å‘æ–¹å‘çš„å³è¾¹å’Œåè¾¹ã€‚æˆ‘ä»¬è¦å‘å‰ç§»åŠ¨ï¼Œå°±æ˜¯è¦è®©æˆ‘ä»¬æ§åˆ¶çš„è§’è‰²çš„æœç€æ‘„åƒæœºæœå‘çš„æ–¹å‘ç§»åŠ¨ï¼›è¦å‘å·¦ç§»åŠ¨ï¼Œå°±æ˜¯è¦è®©è§’è‰²çš„æœå‘å’Œæ‘„åƒæœºå·¦æ–¹çš„æ–¹å‘ç§»åŠ¨ï¼Œè§’è‰²çš„æœå‘å‘æˆ‘ä»¬ç§»åŠ¨æ–¹å‘é‡åˆçš„è¿‡ç¨‹ä¸­å°±ä¼šé€ æˆçš„è§’è‰²è½¬å‘ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œå®ç°æœ¬èŠ‚è§’è‰²ç§»åŠ¨æ•ˆæœçš„å…³é”®æ˜¯å¤„ç†å¥½è§’è‰²çš„æœå‘å’Œæ‘„åƒæœºæœå‘çš„å…³ç³»ã€‚</p><p>åœ¨å¼€å§‹å†™ä»£ç ä¹‹å‰ä¹‹å‰æˆ‘ä»¬éœ€è¦äº†è§£å››ä¸ªæ¥å£ï¼š</p><ul><li><p><a href="https://docs.unity3d.com/ScriptReference/Quaternion.Slerp.html">Quaternion.Slerp</a><br>ä¼ å…¥<strong>æˆ‘ä»¬æ§åˆ¶è§’è‰²å½“å‰åœ¨ä¸–ç•Œç©ºé—´ä¸‹æœå‘çš„Quaternion</strong>ã€<strong>æˆ‘ä»¬å¸Œæœ›è§’è‰²ç§»åŠ¨æ–¹å‘çš„Quaternion</strong>å’Œä¸€ä¸ªè¡¨ç¤ºè½¬å‘é€Ÿåº¦çš„å€¼ï¼Œè¿”å›å½“å‰å¸§æ§åˆ¶è§’è‰²åœ¨ä¸–ç•Œç©ºé—´ä¸‹æ–°çš„æœå‘Quaternionã€‚</p></li><li><p><a href="https://docs.unity3d.com/ScriptReference/Quaternion.LookRotation.html">Quaternion.LookRotation</a><br>ä¼ å…¥ä¸€ä¸ªä¸–ç•Œç©ºé—´åæ ‡ä¸‹çš„æ–¹å‘å‘é‡ï¼Œè¿”å›è¯¥æ–¹å‘å‘é‡å¯¹åº”çš„Quaternionã€‚</p></li><li><p><a href="https://docs.unity3d.com/ScriptReference/Rigidbody.MoveRotation.html">Rigidbody.MoveRotation</a><br>ä¼ å…¥è¿™ä¸€å¸§è§’è‰²æœå‘çš„ä¸–ç•Œåæ ‡ä¸‹çš„Quaternionï¼Œæ›´æ–°è§’è‰²çš„æœå‘ã€‚</p></li><li><p><a href="https://docs.unity3d.com/ScriptReference/Rigidbody.MovePosition.html">Rigidbody.MovePosition</a><br>ä¼ å…¥è¿™ä¸€å¸§è§’è‰²çš„ä¸–ç•Œåæ ‡ä¸‹çš„Positionï¼Œæ›´æ–°è§’è‰²çš„ä½ç½®ã€‚</p></li></ul><p>ä»¥åŠtransform.forwardå’ŒVector3.forwardçš„åŒºåˆ«ï¼š</p><p><a href="https://docs.unity3d.com/ScriptReference/Transform.Translate.html">transform.Translate</a><br>(vector3.forward * Time.deltaTime);ç­‰ä»·äº transform.Translate(transform.forward * Time.deltaTime, Space.World);å‰è€…æ˜¯åœ¨å¯¹è±¡ç©ºé—´åæ ‡ä¸‹å®ç°ç‰©ä½“ç§»åŠ¨çš„æ–¹å¼ï¼Œåè€…æ˜¯åœ¨ä¸–ç•Œç©ºé—´åæ ‡ä¸‹å®ç°ç‰©ä½“ç§»åŠ¨çš„æ–¹å¼ï¼Œå› æ­¤transform.forwardæ˜¯ä¸€ä¸ªä¸–ç•Œç©ºé—´åæ ‡ç³»ä¸‹çš„æ¦‚å¿µã€‚</p><h1>ä»£ç å®ç°æ€è·¯</h1><p>æˆ‘ä»¬åœ¨ä»£ç ä¸­å£°æ˜äº†ä¸€ä¸ªç”¨æ¥è¡¨ç¤ºå½“å‰å¸§ç§»åŠ¨æ–¹å‘çš„äºŒç»´å‘é‡<code>_moveDirection</code>ï¼Œé€šè¿‡åˆ¤æ–­å½“å‰å¸§æœ‰å“ªäº›æŒ‰é”®è¢«æŒ‰ä¸‹å†³å®š<code>_moveDirection</code>çš„å€¼ã€‚<br>æ³¨æ„<code>_moveDirection</code>æ˜¯ä½œç”¨åœ¨æ˜¯æ‘„åƒæœºå¯¹è±¡ç©ºé—´ä¸‹çš„ï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ªå‘é‡è½¬æ¢åˆ°ä¸–ç•Œç©ºé—´åæ ‡ç³»ä¸‹ï¼Œæ‰èƒ½å’Œè§’è‰²çš„<code>transform.forward</code>å‘é‡è¿›è¡Œè¿ç®—ã€‚</p><p>æˆ‘ä»¬æŠŠ<code>_moveDirection</code>ä¸<code>speed * Time.deltaTime</code>ç›¸ä¹˜ï¼Œå°±èƒ½å¾—åˆ°å½“å‰å¸§ä¸­è§’è‰²çš„ä½ç§»ï¼Œå°†è§’è‰²å½“å‰çš„ä½ç½®åŠ ä¸Šè§’è‰²åœ¨è¯¥å¸§ä¸­çš„ä½ç§»å°±å¾—åˆ°äº†è¿™ä¸€å¸§æœ€ç»ˆè§’è‰²çš„ä½ç½®ï¼Œå°†æœ€ç»ˆçš„ä½ç½®ä¼ å…¥<code>Rigidbody.MovePosition</code>æ–¹æ³•ï¼Œå®Œæˆè§’è‰²çš„ç§»åŠ¨æ•ˆæœã€‚</p><p>åŒæ—¶ï¼Œå°†ä¸Šé¢ä¸¤ä¸ªå€¼å’Œ<code>turnSpeed * Time.deltaTime</code>ä¼ å…¥<code>Quaternion.Slerp</code>æ–¹æ³•ä¸­ï¼Œå°±èƒ½å¤Ÿå¾—åˆ°å½“å‰å¸§ä¸­è§’è‰²æœ€ç»ˆæœå‘çš„æ–¹å‘ï¼Œç„¶åæœ€ç»ˆæœå‘ä¼ ç»™<code>Rigidbody.MoveRotation</code>æ–¹æ³•ï¼Œå®Œæˆè§’è‰²çš„è½¬å‘æ•ˆæœã€‚</p><h1>å®Œæ•´ä»£ç </h1><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">PlayerMovement</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerMovement</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> Camera _camera;</span><br><span class="line">        <span class="keyword">private</span> Rigidbody _rigidBody;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">SerializeField</span>] <span class="keyword">private</span> <span class="built_in">float</span> turnSpeed = <span class="number">20f</span>;</span><br><span class="line">        [<span class="meta">SerializeField</span>] <span class="keyword">private</span> <span class="built_in">float</span> speed = <span class="number">20f</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Vector2 _moveDirection = Vector2.zero;</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            _camera = GameObject.Find(<span class="string">&quot;Camera&quot;</span>).GetComponent&lt;Camera&gt;();</span><br><span class="line"></span><br><span class="line">            _rigidBody = GetComponent&lt;Rigidbody&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            UpdateInput();</span><br><span class="line">         </span><br><span class="line">            UpdateMovement();</span><br><span class="line">            UpdateRotation();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">UpdateInput</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            _moveDirection = Vector2.zero;</span><br><span class="line">            <span class="keyword">if</span> (Input.GetKey(KeyCode.W))</span><br><span class="line">            &#123;</span><br><span class="line">                _moveDirection += Vector2.up;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (Input.GetKey(KeyCode.A))</span><br><span class="line">            &#123;</span><br><span class="line">                _moveDirection += Vector2.left;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (Input.GetKey(KeyCode.S))</span><br><span class="line">            &#123;</span><br><span class="line">                _moveDirection += Vector2.down;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (Input.GetKey(KeyCode.D))</span><br><span class="line">            &#123;</span><br><span class="line">                _moveDirection += Vector2.right;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            _moveDirection.Normalize();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">UpdateMovement</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">           <span class="keyword">var</span> movement = CameraDirection(<span class="keyword">new</span> Vector3(_moveDirection.x, <span class="number">0</span>, _moveDirection.y)) * speed * Time.deltaTime;</span><br><span class="line">           _rigidBody.MovePosition(transform.position + movement);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">UpdateRotation</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(_moveDirection.magnitude &lt;= <span class="number">0.01f</span>) <span class="keyword">return</span>;</span><br><span class="line">            <span class="keyword">var</span> rotation = Quaternion.Slerp(_rigidBody.rotation,</span><br><span class="line">                Quaternion.LookRotation (CameraDirection(<span class="keyword">new</span> Vector3(_moveDirection.x, <span class="number">0</span>, _moveDirection.y))), turnSpeed * Time.deltaTime);</span><br><span class="line">            </span><br><span class="line">            _rigidBody.MoveRotation(rotation);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> Vector3 <span class="title">CameraDirection</span>(<span class="params">Vector3 dir</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> cameraForward = _camera.transform.forward;</span><br><span class="line">            <span class="keyword">var</span> cameraRight = _camera.transform.right;</span><br><span class="line">            </span><br><span class="line">            cameraForward.y = <span class="number">0</span>;</span><br><span class="line">            cameraRight.y = <span class="number">0</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> cameraForward * dir.z + cameraRight * dir.x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://blog.csdn.net/kaluluosi111/article/details/17206655?spm=1001.2101.3001.6650.2&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-2-17206655-blog-78846299.235%5Ev43%5Econtrol&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-2-17206655-blog-78846299.235%5Ev43%5Econtrol&amp;utm_relevant_index=5">Unity3d vector3.forwardå’Œtransform.forwardçš„åŒºåˆ«ï¼</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¡¬æŠ€èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼€å‘æ—¥å¿— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UnityShaderæ¦‚å¿µæ”¶é›†ä¸é—®é¢˜æ‚è®°</title>
      <link href="/posts/bc50bf5f/"/>
      <url>/posts/bc50bf5f/</url>
      
        <content type="html"><![CDATA[<h1>ä¸ªäººå¯¹å…‰ç…§æ¨¡å‹å’Œè®¡ç®—æœºå¦‚ä½•æ˜¾ç¤ºé¢œè‰²çš„ç†è§£</h1><h1>æ¦‚å¿µ</h1><ul><li>å‰å‘æ¸²æŸ“å’Œå»¶è¿Ÿæ¸²æŸ“</li><li>å¦‚ä½•è®¡ç®—ç¯å¢ƒå…‰? ç¯å¢ƒå…‰å’Œalbedoä¹‹é—´çš„å…³ç³»æ˜¯æ€æ ·çš„?</li></ul><h1>CPUå’ŒGPUçš„å…³ç³»</h1><blockquote><p>è¿™é‡Œæˆ‘æƒ³åˆ°äº†CPUå’ŒGPUä¹‹é—´çš„è§’è‰²å…³ç³»å¾ˆåƒå¹¼å„¿å›­æˆ–è€…å°å­¦ä¸€äºŒå¹´çº§é‡Œè€å¸ˆå’Œå°æœ‹å‹åœ¨ç©é—®ç­”æ¸¸æˆï¼Œè€å¸ˆå‘é—® â€œä¸€åŠ ä¸€ç­‰äºå‡ ï¼Ÿâ€ â€œäºŒä¹˜äºŒç­‰äºå‡ ï¼Ÿâ€ å°æœ‹å‹ä»¬è¦å›ç­”â€œäºŒï¼â€â€œå››ï¼â€ã€‚è€å¸ˆï¼ˆCPUï¼‰è´Ÿè´£æä¾› è¿ç®—æ•°ï¼ˆç½‘æ ¼é¡¶ç‚¹ä¿¡æ¯ï¼‰å’Œè¿ç®—å¼ï¼ˆShaderï¼‰è€Œå°æœ‹å‹ï¼ˆGPUï¼‰éœ€è¦åšçš„æ˜¯æŠŠè€å¸ˆç»™çš„é¢˜ç›®è§£ç­”å‡ºæ¥å°±å¯ä»¥äº†ã€‚</p></blockquote><h1>å…³äºå¤šPass</h1><p>åœ¨æœ¬ä¹¦çš„ç¬¬å…«ç« é€æ˜æ•ˆæœä¸­ç¬¬ä¸€æ¬¡é‡åˆ°äº†å¤šPassçš„æ¦‚å¿µï¼Œç¬”è€…åœ¨å­¦ä¹ å¤šPassçš„è¿‡ç¨‹ä¸­äº§ç”Ÿäº†å¾ˆå¤šç–‘æƒ‘ï¼Œç›´åˆ°ç¬¬åäºŒç« ç¬”è€…çš„ç–‘æƒ‘æ‰å¾—ä»¥è§£ç­”ã€‚<br>é¦–å…ˆä¸ºä»€ä¹ˆShaderä¸­éœ€è¦å¤šPassçš„å­˜åœ¨ï¼Ÿåœ¨æœ¬ä¹¦ç¬¬ä¸‰ç« ä»‹ç»SubShaderçš„æ—¶å€™æåˆ°äº†æ¯ä¸€ä¸ªPasséƒ½ä¼šå®Œæ•´åœ°èµ°ä¸€éGPUçš„æµæ°´çº¿ã€‚ç¬”è€…æ— æ³•ç†è§£åŒä¸€ä»½é¡¶ç‚¹æ•°æ®æ˜¯å¦‚ä½•èƒ½å¤Ÿåœ¨GPUä¸­ç»è¿‡å¤šä¸ªPasså¤„ç†è¡¨ç°å‡ºå¤šä¸ªæ•ˆæœçš„ã€‚æ¯”å¦‚è¯´ï¼Œæœ‰ä¸€ä¸ªåŒ…å«æœ‰ä¸¤ä¸ªPassçš„Shaderï¼Œç¬¬ä¸€ä¸ªPassåœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­è¿›è¡Œäº†é¡¶ç‚¹å‘å·¦åç§»çš„æ“ä½œï¼Œç¬¬äºŒä¸ªPassåœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­è¿›è¡Œäº†é¡¶ç‚¹å‘å³åç§»çš„æ“ä½œã€‚æœ€ç»ˆè¡¨ç°çš„æ•ˆæœæ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿç¬”è€…è‡ªå·±å†™äº†ä¸€æ®µShaderéªŒè¯ä¸€ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Custom/TestMutilePass&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _MainTex (&quot;MainTex&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _InvWaveLength (&quot;Distortion Inverse Wave Length&quot;, Float) = 10</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">        CGINCLUDE</span><br><span class="line"></span><br><span class="line">        #include &quot;UnityCG.cginc&quot;</span><br><span class="line">        #include &quot;Lighting.cginc&quot;</span><br><span class="line"></span><br><span class="line">        sampler2D _MainTex;</span><br><span class="line">        float _InvWaveLength;</span><br><span class="line">        float4 _MainTex_ST;</span><br><span class="line"></span><br><span class="line">        struct a2v</span><br><span class="line">        &#123;</span><br><span class="line">            float4 vertex : POSITION;</span><br><span class="line">            float4 texcoord : TEXCOORD0;</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        struct v2f</span><br><span class="line">        &#123;</span><br><span class="line">            float4 position : SV_POSITION;</span><br><span class="line">            float2 uv : TEXCOORD0;</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        fixed4 frag(v2f i) : SV_TARGET</span><br><span class="line">        &#123;</span><br><span class="line">            float4 color = tex2D(_MainTex, i.uv);</span><br><span class="line">            return color;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        ENDCG</span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert;</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                float4 offset;</span><br><span class="line">offset.yzw = float3(0.0, 0.0, 0.0);</span><br><span class="line">offset.x = _InvWaveLength;</span><br><span class="line">            </span><br><span class="line">                o.position = mul(unity_MatrixMVP, v.vertex + offset);</span><br><span class="line">                o.uv = v.texcoord.xy * _MainTex_ST.xy + _MainTex_ST.zw;;</span><br><span class="line">            </span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            CGPROGRAM</span><br><span class="line">            </span><br><span class="line">            #pragma vertex vert;</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                float4 offset;</span><br><span class="line">offset.yzw = float3(0.0, 0.0, 0.0);</span><br><span class="line">offset.x = _InvWaveLength;</span><br><span class="line">            </span><br><span class="line">                o.position = mul(unity_MatrixMVP, v.vertex - offset);</span><br><span class="line">                o.uv = v.texcoord.xy * _MainTex_ST.xy + _MainTex_ST.zw;</span><br><span class="line">            </span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬”è€…åœ¨ç¬¬ä¸€ä¸ªPassä¸­å°†æ‰€æœ‰çš„é¡¶ç‚¹éƒ½è¿›è¡Œäº†å‘å·¦çš„åç§»ï¼Œåœ¨ç¬¬äºŒä¸ªPassä¸­å°†æ‰€æœ‰çš„é¡¶ç‚¹è¿›è¡Œäº†å‘å³çš„åç§»ã€‚æŠŠè¿™ä¸ªShaderç»™åˆ°ä¸€ä¸ªæè´¨å¹¶èµ‹ç»™ä¸€ä¸ªQuadæ¨¡å‹ï¼Œå¯ä»¥çœ‹åˆ°è¡¨ç°æ•ˆæœå¦‚ä¸‹ï¼š</p><p>åœ¨è¿™ä¸€ä¸ªQuadä¸Šç«Ÿç„¶ç”Ÿæˆäº†ä¸¤ä¸ªé¢ç‰‡ï¼ä¹Ÿå°±æ˜¯è¯´åœ¨è¡¨ç°ä¸Šï¼Œè¿™ç§å¤šPassæ–¹å¼è¾¾åˆ°äº†å’Œåœ¨åœºæ™¯ä¸­åˆ›å»ºå¤šä¸ªæ¨¡å‹åŒæ ·çš„æ•ˆæœã€‚<br>åœ¨æ¥çœ‹ä¸€ç§æƒ…å†µï¼Œåœ¨Unity Inspectorçª—å£ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªMeshRendererä¸Šé¢å¯ä»¥æŒ‚å¤šä¸ªæè´¨çš„ï¼š</p><p>é‚£æˆ‘ä»¬å°±åœ¨Quadæ¨¡å‹ä¸Šå¤šæŒ‚å‡ ä¸ªçœ‹çœ‹ï¼Œç„¶åä½ å°±å¯ä»¥çœ‹åˆ°ï¼Œåœ¨åœºæ™¯ä¸­è™½ç„¶åªæœ‰ä¸€ä¸ªQuadæ¨¡å‹ï¼Œä½†æ˜¯å®é™…ä¸Šä½ å´èƒ½çœ‹åˆ°å››ä¸ªQuadæ¨¡å‹åœ¨åœºæ™¯ä¸­ï¼</p><p>ä¸‹é¢è¿™å¼ å›¾ä½¿ç”¨çš„æ˜¯æœ¬ä¹¦ä¸­ç¬¬åä¸€ç« æ¨¡æ‹Ÿæ²³æµçš„Shaderï¼Œå¯ä»¥çœ‹åˆ°ç¡®å®è¾¾åˆ°äº†â€œåˆ†èº«â€çš„æ•ˆæœã€‚</p><p>åˆ°è¿™ä¸ºæ­¢ï¼ŒUnityå¤šPassçš„ç†è§£å°±åŸºæœ¬æ¸…æ™°äº†ï¼šåœ¨æ˜¾å­˜ä¸­å­˜å‚¨äº†æ¨¡å‹çš„ç½‘æ ¼æ•°æ®ï¼Œæ¯å¸§æ¸²æŸ“çš„æ—¶å€™ï¼Œæ¯ä¸ªShaderçš„æ¯ä¸ªPasséƒ½ä¼šä»æ˜¾å­˜ä¸­è·å–è¿™äº›é¡¶ç‚¹æ•°æ®ï¼Œæ³¨æ„åªæ˜¯<strong>è¯»å–</strong>ï¼ŒShaderçš„æ‰§è¡Œä¸ä¼šå½±å“å­˜å‚¨åœ¨æ˜¾å­˜ä¸­çš„é¡¶ç‚¹æ•°æ®ï¼Œæ‰€ä»¥è¯´ï¼Œä¸€ä¸ªShaderçš„å¤šä¸ªPassåªæ˜¯éƒ½æ°å¥½è¯»å–äº†ä¸€æ¨¡ä¸€æ ·çš„é¡¶ç‚¹æ•°æ®ï¼Œå„è‡ªæ‰§è¡Œçš„æ—¶å€™éƒ½æ“ä½œå„è‡ªçš„<strong>ä¸´æ—¶æ•°æ®</strong>äº’ä¸å½±å“ï¼Œæœ€ç»ˆæ¸²æŸ“åˆ°å±å¹•ä¸Šçš„æ—¶å€™ä¹Ÿæ˜¯å„è‡ªæ¸²æŸ“å„è‡ªçš„ï¼Œè¿™çœŸçš„æŒºå¥‡å¦™çš„ï¼Œä½¿ç”¨å¤šPasså’Œä½¿ç”¨å¤šä¸ªMaterialèƒ½å¤Ÿè¾¾åˆ°ç›¸åŒçš„æ•ˆæœï¼Œçœ‹èµ·æ¥Unityå®˜æ–¹æ›´åŠ æ¨èä½¿ç”¨å¤šPassçš„æ•ˆæœï¼Œè¿™ç§æ–¹å¼æ›´åŠ èŠ‚çœæ€§èƒ½ã€‚</p><p>åœ¨æœ¬ç« ä»‹ç»é«˜æ–¯æ¨¡ç³Šå®ç°æ–¹å¼ä¸­ï¼Œä½œè€…ä½¿ç”¨åˆ°äº†RenderTextureï¼ŒRenderTextureæ­é…å¤šPassä½¿ç”¨è¿˜æ˜¯æŒºå·§å¦™çš„ï¼Œå› ä¸ºå®ƒåšåˆ°äº†<strong>ä¸Šä¸€ä¸ªPassè¾“å‡ºçš„RenderTextureçš„ç»“æœä½œä¸ºä¸‹ä¸€ä¸ªPassçš„è¾“å…¥</strong>ã€‚è¿™ä¸€ç‚¹åœ¨éRenderTextureçš„åº”ç”¨ä¸Šç»™ç¬”è€…é€ æˆäº†å›°æƒ‘ï¼Œè¿™å’Œç›´æ¥æŠŠå¤šPassçš„ShaderæŒ‚åœ¨ä¸€ä¸ªæ¨¡å‹ä¸Šæ¯ä¸ªPasså„è‡ªæ¸²æŸ“å„è‡ªçš„æƒ…å†µæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯”å¦‚ä¸Šé¢çš„Quadå®éªŒã€‚åœ¨éRenderTextureçš„åº”ç”¨ä¸­ï¼Œç¬”è€…èƒ½æƒ³åˆ°çš„å¤šPassçš„åº”ç”¨æ˜¯ç”¨æ¥æ˜¾ç¤ºæ¨¡å‹çš„å¤–è½®å»“çº¿ï¼Œè‡³äºè¿˜æœ‰ä»€ä¹ˆå¤šPassçš„åº”ç”¨åœºæ™¯ï¼Œç¬”è€…åœ¨è¿™é‡Œå°±ä¸å†è„‘åŠ›é£æš´äº†ã€‚</p><h1>Unityçš„OnRenderImageæ¥å£</h1><blockquote><p>åœ¨ä¸€å¸§ä¸­ï¼ŒCPUå¹¶ä¸æ˜¯ä¸€æ¬¡æ€§æŠŠè¿™ä¸€å¸§æ‰€æœ‰çš„æ¸²æŸ“å‘½ä»¤æ‰“åŒ…æäº¤ç»™GPUè¿›è¡Œæ¸²æŸ“çš„ï¼Œè€Œæ˜¯é€æ­¥æäº¤çš„ã€‚</p></blockquote><p>OnRenderImageæ¥å£çš„å®˜æ–¹æè¿°å¦‚ä¸‹ï¼šUnityåœ¨ç›¸æœºå®Œæˆæ¸²æŸ“åè°ƒç”¨çš„äº‹ä»¶å‡½æ•°ï¼Œå®ƒå…è®¸ä½ ä¿®æ”¹ç›¸æœºçš„æœ€ç»ˆå›¾åƒã€‚(Event function that Unity calls after a Camera has finished rendering, that allows you to modify the Cameraâ€™s final image.)</p><p>é¦–å…ˆä»‹ç»ä¸€ä¸‹Profilerä¸­CPUUsageæ¨¡å—TimeLineçª—å£ä¸­MainThreadå’ŒRenderThreadçš„å«ä¹‰</p><ul><li>MainThread : This is where all of the game logic/scripts perform their work by default and where the majority of the time is spent for features and systems such as physics, animation, UI, and rendering</li><li>RenderThread : During the rendering process, the main thread examines the scene and performs Camera culling, depth sorting, and draw call batching, resulting in a list of things to render . This list is passed to the render thread, which translates it from Unityâ€™s internal platform-agnostic representation to the specific graphics API calls required to instruct the GPU on a particular platform</li></ul><p>ç¬”è€…åœ¨è¿™é‡Œåªå…³æ³¨ä¸¤ä¸ªThreadä¸GPUç›¸å…³çš„ä½œç”¨ï¼Œè¯´ç™½äº†MainThreadè´Ÿè´£ç›¸æœºå‰”é™¤ã€æ·±åº¦æ’åºå’ŒDrawCallåˆå¹¶çš„å·¥ä½œï¼Œå°†GPUè¦åšçš„äº‹æƒ…æ•´ç†æˆä¸€ä¸ªåˆ—è¡¨ï¼Œäº¤ç»™RenderThreadã€‚RenderThreadè´Ÿè´£æ¥æ”¶åˆ°æ¥è‡ªMainThreadçš„åˆ—è¡¨åï¼ŒæŠŠè¿™ä¸ªåˆ—è¡¨ä¸­çš„æ¸²æŸ“å‘½ä»¤ç¿»è¯‘æˆGPUèƒ½å¤Ÿç†è§£çš„ä¸œè¥¿ï¼Œå¹¶å‘é€ç»™GPUï¼Œä¹Ÿå°±æ˜¯<strong>DrawCall</strong>ã€‚</p><p>çœ‹ä¸€ä¸‹ä¸‹é¢è¿™å¼ å›¾ï¼š</p><img src="/posts/bc50bf5f/image.png" class=""><p>ç”±è¿™å¼ å›¾æ¨æµ‹ï¼ŒUnityæ˜¯åœ¨è°ƒç”¨Camera.Renderä¸­çš„Drawingæ¥å£ä¸­è¿›è¡Œçš„CPUå’ŒGPUçš„é€šä¿¡ï¼Œç„¶åæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸‹é¢è¿™å¼ å›¾ï¼š</p><p>è¿™å¼ å›¾åæ˜ äº†<code>OnRenderImage</code>æ–¹æ³•è°ƒç”¨å’ŒCPU GPUé€šä¿¡ä¹‹é—´çš„æ—¶é—´é—´éš”ã€‚æŒ‰ç…§Unityå®˜æ–¹çš„æè¿°è¯´ï¼ŒOnRenderImageæ–¹æ³•çš„ç¬¬ä¸€ä¸ªsourceå‚æ•°æ˜¯å½“å‰å¸§è¿™ä¸ªCameraçš„æ¸²æŸ“ç»“æœï¼Œä¹Ÿå°±æ˜¯è¯´GPUåœ¨è¿™ä¹ˆçŸ­çš„æ—¶é—´é‡Œé¢å°±å®Œæˆäº†è¿™ä¸€å¸§ä¸­å¤§éƒ¨åˆ†åœºæ™¯çš„æ¸²æŸ“ã€‚<strong>ç¬”è€…ä¹‹å‰ä¸€ç›´æœ‰è¯¯åŒºï¼Œä»¥ä¸ºå½“å‰å¸§ä¸­GPUæ¸²æŸ“çš„æ˜¯ä¸Šä¸€å¸§CPUæäº¤ç»™GPUçš„å‘½ä»¤ï¼Œä½†å…¶å®ä¸æ˜¯ï¼Œå½“å‰å¸§GPUæ¸²æŸ“çš„å°±æ˜¯å½“å‰å¸§çš„ç”»é¢</strong>ã€‚</p><h2 id="OnRenderImage-å’Œ-GPU-æ‰§è¡Œæ—¶æœº"><code>OnRenderImage</code> å’Œ GPU æ‰§è¡Œæ—¶æœº</h2><p><code>OnRenderImage</code>ç¡®å®æ˜¯åœ¨CPUç«¯è°ƒç”¨çš„ï¼Œå®ƒæ˜¯Unityæ¸²æŸ“æµç¨‹ä¸­çš„ä¸€ä¸ªå›è°ƒæ–¹æ³•ï¼Œç”¨äºå¤„ç†æ¸²æŸ“å›¾åƒï¼ˆé€šå¸¸åœ¨æ¸²æŸ“åˆ°å±å¹•ä¹‹å‰ï¼‰ã€‚å½“ä½ åœ¨<code>OnRenderImage</code>ä¸­è°ƒç”¨<code>Graphics.Blit</code>æ—¶ï¼Œä½ å®é™…ä¸Šæ˜¯åœ¨åˆ›å»ºä¸€ä¸ªå‘½ä»¤ï¼Œå‘Šè¯‰GPUï¼šâ€œè¯·æŒ‰ç…§è¿™ä¸ªæè´¨ï¼ˆå’Œå®ƒçš„Shaderï¼‰å¤„ç†è¿™ä¸ªçº¹ç†ï¼Œç„¶åè¾“å‡ºåˆ°å¦ä¸€ä¸ªçº¹ç†ä¸Šã€‚â€</p><p>è¿™äº›å‘½ä»¤ä¼šè¢«Unityæ¸²æŸ“å¼•æ“æ”¶é›†èµ·æ¥ï¼Œç„¶ååœ¨é€‚å½“çš„æ—¶å€™ä¸€èµ·å‘é€ç»™GPUã€‚GPUæ”¶åˆ°è¿™äº›å‘½ä»¤åï¼Œä¼šæŒ‰ç…§æŒ‡ä»¤æ‰§è¡Œæ¸²æŸ“æ“ä½œã€‚è¿™ä¸ªè¿‡ç¨‹ç¡®å®ä¸æ˜¯ç«‹å³å‘ç”Ÿçš„ï¼Œè€Œæ˜¯åœ¨CPUç«¯çš„æ‰€æœ‰æ¸²æŸ“ç›¸å…³å‘½ä»¤éƒ½æäº¤ç»™GPUä¹‹åï¼ŒGPUæ‰å¼€å§‹æ‰§è¡Œè¿™äº›å‘½ä»¤ã€‚è¿™æ„å‘³ç€ï¼Œ<code>Graphics.Blit</code>è°ƒç”¨å‘ç”Ÿæ—¶ï¼Œå¹¶ä¸ä¼šç«‹å³æ‰§è¡ŒShaderæ•ˆæœï¼Œè€Œæ˜¯ç¨ååœ¨GPUçš„æ¸²æŸ“é˜Ÿåˆ—ä¸­æ‰§è¡Œã€‚</p><p>å¦å¤–ï¼Œå½“å‰å®ç°å±å¹•åå¤„ç†çš„æ•ˆæœä½¿ç”¨çš„éƒ½æ˜¯CommandBufferäº†ï¼Œæ¯”å¦‚Unityå®˜æ–¹çš„å±å¹•åå¤„ç†çš„åº“ã€‚OnRenderImageå·²ç»å¾ˆå°‘ä½¿ç”¨äº†ã€‚</p><h1>Shaderå˜ä½“å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://www.bilibili.com/video/BV1P44y1V7bu/?spm_id_from=333.999.0.0">https://www.bilibili.com/video/BV1P44y1V7bu/?spm_id_from=333.999.0.0</a></li><li><a href="https://www.bilibili.com/video/BV1PG411G7DR/?spm_id_from=333.337.search-card.all.click&amp;vd_source=83f4165825ce9df46cf4fd576ccb1102">https://www.bilibili.com/video/BV1PG411G7DR/?spm_id_from=333.337.search-card.all.click&amp;vd_source=83f4165825ce9df46cf4fd576ccb1102</a></li><li><a href="https://blog.csdn.net/qq_36383623/article/details/103327389">https://blog.csdn.net/qq_36383623/article/details/103327389</a></li></ul><h1>ä¸€ä¸ªæœ‰å…­ä¸ªé¢çš„ç«‹æ–¹ä½“æ¨¡å‹ ä¸ºä»€ä¹ˆä¸€å¼ è´´å›¾ä¼šæŒ‰ç…§æŸç§è§„åˆ™è´´åœ¨å…­ä¸ªé¢ä¸Š?</h1><h1>UnityShaderä¸­å¸¸ç”¨å¤´æ–‡ä»¶ã€å¸¸ç”¨æ–¹æ³•ã€å¸¸ç”¨å®</h1><ul><li><p>UnityCG.cginc</p></li><li><p>AutoLight.cginc</p></li><li><p>Lighting.cginc</p></li><li><p>UNITY_LIGHT_ATTENUATION</p></li><li><p>SHADOW_ATTENUATION</p></li><li><p>SHADOW_COORDS</p></li><li><p>TRANSFER_SHADOW</p></li><li><p>SHADOW_CASTER_FRAGMENT åœ¨<code>LightMode</code>ä¸º<code>ShadowCaster</code>çš„Passçš„<code>frag</code>ä¸­ä½¿ç”¨,ç”¨æ¥å®ç°é˜´å½±æŠ•å°„çš„åŠŸèƒ½,å®ƒç”¨æ¥å¤„ç†ç‰©ä½“çš„æ·±åº¦ä¿¡æ¯,ç„¶åå°†è¯¥æ·±åº¦ä¿¡æ¯ä¼ é€’ç»™é˜´å½±æ˜ å°„çº¹ç†,ä»è€Œè®©å…¶ä»–ç‰©ä½“æ ¹æ®è¿™ä¸ªé˜´å½±æ˜ å°„çº¹ç†è®¡ç®—å‡ºè‡ªèº«æ˜¯å¦å¤„äºè¯¥ç‰©ä½“çš„é˜´å½±ä¸­.ç®€å•æ¥è¯´,å®ƒç”¨æ¥å¸®åŠ©ç‰©ä½“åœ¨åœºæ™¯ä¸­æ­£ç¡®åœ°æŠ•å°„å‡ºé˜´å½±.</p></li><li><p>TRANSFER_SHADOW_CASTER_NORMALOFFSET ç”¨äºåœ¨é˜´å½±æŠ•å°„çš„è¿‡ç¨‹ä¸­,åœ¨é¡¶ç‚¹ç€è‰²å™¨é‡Œå¯¹ç›¸å…³æ•°æ®è¿›è¡Œå¤„ç†å’Œä¼ é€’.å…·ä½“è€Œè¨€å®ƒä¼šå¤„ç†é¡¶ç‚¹çš„ä½ç½®ä¿¡æ¯ä»¥åŠæ³•çº¿åç§»ä¿¡æ¯,å¹¶ä¸”å°†è¿™äº›æ•°æ®ä¼ é€’ç»™fragç€è‰²å™¨,ä¸ºåç»­å°†ç‰©ä½“çš„æ·±åº¦ä¿¡æ¯æ­£ç¡®å†™å…¥é˜´å½±æ˜ å°„çº¹ç†åšå‡†å¤‡.</p></li><li><p>clip</p></li><li><p>tex2D</p></li><li><p>UnpackNormal æ˜¯Unity Shaderç”¨æ¥ä»åˆ‡çº¿ç©ºé—´ä¸‹è¯»å–è¢«æ ‡è®°ä¸º<code>NormalMap</code>çš„Textureä¸­è¯»å–æ³•çº¿ä¿¡æ¯çš„æ–¹æ³•.</p></li><li><p>normalize</p></li><li><p>smoothstep</p></li><li><p>pow</p></li><li><p>step</p></li><li><p>multi_compile_shadowcaster</p></li><li><p>LightMode</p></li><li><p>CGINCLUDE CGPROGRAM</p></li><li><p>ObjSpaceLightDir</p></li><li><p>GrabPass</p></li></ul><h1>é—®é¢˜è®°å½•</h1><h2 id="ä»€ä¹ˆæ˜¯åˆ‡çº¿ç©ºé—´-ä¸ºä»€ä¹ˆéœ€è¦åˆ‡çº¿ç©ºé—´">ä»€ä¹ˆæ˜¯åˆ‡çº¿ç©ºé—´? ä¸ºä»€ä¹ˆéœ€è¦åˆ‡çº¿ç©ºé—´?</h2><p><a href="https://www.bilibili.com/video/BV1cq4y1R7wu/?spm_id_from=333.880.my_history.page.click&amp;vd_source=83f4165825ce9df46cf4fd576ccb1102">https://www.bilibili.com/video/BV1cq4y1R7wu/?spm_id_from=333.880.my_history.page.click&amp;vd_source=83f4165825ce9df46cf4fd576ccb1102</a></p><h2 id="ä¸ºä»€ä¹ˆåœ¨åˆ‡çº¿ç©ºé—´ä¸‹çš„æ³•çº¿çº¹ç†çœ‹èµ·æ¥éƒ½æ˜¯æµ…è“è‰²çš„">ä¸ºä»€ä¹ˆåœ¨åˆ‡çº¿ç©ºé—´ä¸‹çš„æ³•çº¿çº¹ç†çœ‹èµ·æ¥éƒ½æ˜¯æµ…è“è‰²çš„?</h2><h2 id="ä¸ºä»€ä¹ˆè¦ç”¨åˆ‡çº¿ç©ºé—´å­˜å‚¨æ³•çº¿ä¿¡æ¯-å’Œç‰©ä½“ç©ºé—´ä¸‹ç›¸æ¯”å„è‡ªæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹">ä¸ºä»€ä¹ˆè¦ç”¨åˆ‡çº¿ç©ºé—´å­˜å‚¨æ³•çº¿ä¿¡æ¯ å’Œç‰©ä½“ç©ºé—´ä¸‹ç›¸æ¯”å„è‡ªæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹?</h2><h2 id="é˜´å½±æ˜¯å¦‚ä½•äº§ç”Ÿçš„">é˜´å½±æ˜¯å¦‚ä½•äº§ç”Ÿçš„?</h2><p>æ‰€æœ‰ç‰©ä½“çš„æ·±åº¦ä¿¡æ¯ä¼šè¢«å­˜å…¥ä¸€ä¸ªæ·±åº¦çº¹ç†æˆ–è€…å«é˜´å½±çº¹ç†ä¸­, è¦æŠ•å°„é˜´å½±çš„ç‰©ä½“å‘è¿™ä¸ªçº¹ç†ä¸­å†™å…¥æ·±åº¦ä¿¡æ¯,éœ€è¦æ¥æ”¶é˜´å½±çš„ç‰©ä½“ä»è¿™ä¸ªçº¹ç†ä¸­è¯»å–é˜´å½±ä¿¡æ¯.</p><p>Tagä¸­<code>LightMode</code>ä¸º<code>ShadowCaster</code>çš„Passä¸­çš„ä»£ç ç”Ÿæ•ˆ,è¦æ±‚æŒ‚è½½è¯¥Shaderçš„MeshRendereræŠŠ<code>CastShadows</code>é€‰é¡¹æ‰“å¼€.</p><h2 id="ä¸¤ä¸ªPasså…¬ç”¨ä»£ç ">ä¸¤ä¸ªPasså…¬ç”¨ä»£ç </h2><p>Unity Shaderä¸­å¯ä»¥ä½¿ç”¨<code>CGINCLUDE</code>çš„æ–¹æ³•å°†ä¸€äº›æ•°æ®ç»“æ„ã€å­—æ®µåœ¨ä¸åŒçš„Passä¸­å…±äº«</p><h2 id="æ¨¡å‹çš„æ•°æ®ç»“æ„ä¸­ä¼šå­˜æœ‰æ¯ä¸ªé¡¶ç‚¹çš„æ³•çº¿ä¿¡æ¯-æ³•çº¿è´´å›¾ä¸­çš„æ³•çº¿ä¿¡æ¯åˆæ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„">æ¨¡å‹çš„æ•°æ®ç»“æ„ä¸­ä¼šå­˜æœ‰æ¯ä¸ªé¡¶ç‚¹çš„æ³•çº¿ä¿¡æ¯,æ³•çº¿è´´å›¾ä¸­çš„æ³•çº¿ä¿¡æ¯åˆæ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„?</h2><h2 id="Unityä¸­æœ‰å‡ ç§Shader-åŒºåˆ«æ˜¯ä»€ä¹ˆ">Unityä¸­æœ‰å‡ ç§Shader?åŒºåˆ«æ˜¯ä»€ä¹ˆ?</h2><img src="/posts/bc50bf5f/image.png" class=""><ul><li>Standard Surface Shader</li><li>Unlit Shader</li><li>Image Effect Shader</li><li>Compute Shader</li><li>Ray Tracing Shader</li></ul><h2 id="Unity-Shaderæ˜¯æ€ä¹ˆè¢«æ”¶é›†ç„¶åæ‰“è¿›åŒ…å†…çš„ï¼Ÿ">Unity Shaderæ˜¯æ€ä¹ˆè¢«æ”¶é›†ç„¶åæ‰“è¿›åŒ…å†…çš„ï¼Ÿ</h2>]]></content>
      
      
      <categories>
          
          <category> UnityShader </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity </tag>
            
            <tag> Shader </tag>
            
            <tag> é—®é¢˜æ‚è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RPGå¼€å‘è®°å½•(é›¶)ï¼šåœºæ™¯æ­å»º</title>
      <link href="/posts/eb0ca922/"/>
      <url>/posts/eb0ca922/</url>
      
        <content type="html"><![CDATA[<p>åœ¨å¼€å§‹è¿›å…¥æ­£é¢˜ä¹‹å‰ï¼Œéœ€è¦å…ˆæ­å»ºä¸€ä¸ªå¯ä»¥ä¾›è§’è‰²ç«™ç«‹ã€ç§»åŠ¨ã€è·³è·ƒå¹¶ä¸”è¿˜æœ‰è¾¹ç•Œçš„æµ‹è¯•åœºæ™¯ã€‚ç¬”è€…å¸Œæœ›æ­å»ºçš„åœºæ™¯è¦éµå¾ªä¸€äº›è§„èŒƒï¼š</p><ol><li>ç»Ÿä¸€æ‰€æœ‰æ¨¡å‹èµ„æºçš„å•ä½é•¿åº¦ï¼Œæç‰¹æ®Šæƒ…å†µï¼Œæ‰€æœ‰æ¨¡å‹çš„ç¼©æ”¾éƒ½è®¾ç½®ä¸º1</li><li>å°†åœºæ™¯ä¸­çš„åœ°å½¢é¢„åˆ¶ä½“åŒ–ï¼Œæ¯”å¦‚å¢™ã€åœ°é¢ã€å°é˜¶ç­‰</li><li>â€¦</li></ol><p>ä¸‹é¢è¯´ä¸€ä¸ªå¯ä»¥æé«˜æˆ‘ä»¬æ­å»ºåœºæ™¯æ•ˆç‡çš„æŠ€å·§ï¼šåœ¨Unityçš„Sceneçª—å£ä¸­ï¼Œç‚¹å‡»ä¸‹å›¾ä½ç½®çš„å›¾æ ‡å¯ä»¥è®¾ç½®ç‰©ä½“ç§»åŠ¨çš„å›ºå®šæ­¥é•¿ã€‚æŒ‰ä½<code>Control/Command</code>é”®æ‹–æ‹½Sceneä¸­é€‰ä¸­ç‰©ä½“çš„Objectåæ ‡ç³»çš„åæ ‡è½´ï¼Œå°±å¯ä»¥ä»¥å›ºå®šçš„æ­¥é•¿ç§»åŠ¨ç‰©ä½“äº†ã€‚æŒ‰ä½<code>V</code>é”®æ‹–æ‹½åæ ‡è½´å°±å¯ä»¥è®©é€‰ä¸­ç‰©ä½“çš„é€‰ä¸­é¡¶ç‚¹å¸é™„åˆ°å¦ä¸€ä¸ªåœºæ™¯ä¸­çš„ç‰©ä½“ä¸Šã€‚</p><h1>åˆ›å»ºåœ°å½¢</h1><h2 id="Unityä¸­è‡ªå¸¦çš„æ¨¡å‹">Unityä¸­è‡ªå¸¦çš„æ¨¡å‹</h2><p>Unityä¸­è‡ªå¸¦çš„ç”¨æ¥è¡¨ç¤ºå¹³é¢çš„æ˜¯<code>Plane</code>æ¨¡å‹ï¼Œç”¨æ¥è¡¨ç¤ºå¢™é¢çš„æ˜¯<code>Quad</code>æ¨¡å‹ï¼Œåœ¨åœºæ™¯ä¸­åˆ†åˆ«åˆ›å»º<code>Plane</code>å’Œ<code>Quad</code>æ¨¡å‹ï¼ŒæŸ¥çœ‹å®ƒä»¬çš„è¯¦ç»†ä¿¡æ¯ï¼Œä½ ä¼šå‘ç°<code>Plane</code>æ¨¡å‹çš„å°ºå¯¸æ˜¯10x10çš„(æ­¤å¤„ä¸è€ƒè™‘æ¨¡å‹çš„åšåº¦)ï¼Œä¹Ÿå°±æ˜¯é•¿å®½å„ä¸º10ä¸ªå•ä½é•¿åº¦ï¼›è€Œ<code>Quad</code>æ¨¡å‹çš„å°ºå¯¸æ˜¯1x1ï¼Œé•¿å®½å„1ä¸ªå•ä½é•¿åº¦ã€‚ä¹Ÿå°±æ˜¯è¯´éœ€è¦ä½¿ç”¨100ä¸ª<code>Quad</code>æ¨¡å‹æ‰èƒ½æ‹¼å‡ºä¸€ä¸ªå’Œ<code>Plane</code>é¢ç§¯ä¸€æ ·å¤§çš„æ¨¡å‹ã€‚</p><h2 id="åˆ›å»ºæè´¨">åˆ›å»ºæè´¨</h2><p>ä¸ºäº†è®©åœ°å½¢çš„å°ºå¯¸å±•ç¤ºæ›´ç›´è§‚ï¼Œæˆ‘ä»¬ä½¿ç”¨Unityå†…ç½®çš„ä¸€å¼ åä¸º<code>Default-Checker-Gray</code>è´´å›¾æ¥è£…é¥°æˆ‘ä»¬çš„åœ°å½¢ï¼Œæˆ‘ä»¬ä¼šä¸ºPlaneå’ŒQuadå„è‡ªç”Ÿæˆä¸€ä¸ªæè´¨ï¼Œè¿™ä¸¤ä¸ªæè´¨çš„åŒºåˆ«åªæœ‰ä¸Šé¢çš„Tillingå‚æ•°ï¼Œä¸€ä¸ªè®¾ç½®æˆ10ï¼Œè€Œå¦ä¸€ä¸ªè®¾ç½®ä¸º1ã€‚è¿™æ ·çš„è®¾ç½®ä¸»è¦å’Œè¿™ä¸¤ç§æ¨¡å‹çš„å°ºå¯¸æœ‰å…³ç³»ã€‚ç„¶åå°†æè´¨åˆ†åˆ«èµ‹ç»™è¿™ä¸¤ä¸ªæ¨¡å‹ã€‚</p><p>è‡³æ­¤ï¼Œè¿™æ ·æˆ‘ä»¬å°±æœ‰äº†æ­å»ºåœºæ™¯çš„é¢„åˆ¶åœ°å½¢äº†ã€‚</p><h1>å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://jingyan.baidu.com/article/1612d500968440e20e1eeebd.html">Unity å®ç”¨æ•™ç¨‹ ä¹‹ ç‰©ä½“å›ºå®šå€¼ç§»åŠ¨è°ƒæ•´é¡¶ç‚¹å¸é™„</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¡¬æŠ€èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼€å‘æ—¥å¿— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Macç»ˆç«¯ä¼˜åŒ–è®°å½•</title>
      <link href="/posts/eeec06d0/"/>
      <url>/posts/eeec06d0/</url>
      
        <content type="html"><![CDATA[<h1>ä¸‹è½½oh-my-zsh</h1><p>åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä¸‹é¢çš„å‘½ä»¤å®‰è£…oh-my-zsh</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh -c &quot;$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)&quot;</span><br></pre></td></tr></table></figure><p>å¦‚æœæœ‰å¦‚ä¸‹æŠ¥é”™æç¤º<code>curl: (7) Failed to connect to raw.githubusercontent.com port 443 after 14 ms: Couldn't connect to server</code>ï¼Œæœ‰ä¸¤ç§è§£å†³æ–¹æ³•:</p><ul><li>ç¬¬ä¸€ç§è§£å†³æ–¹æ³•æ˜¯åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ª.shè„šæœ¬ï¼Œå°†ä¸‹è½½é“¾æ¥æŒ‡å‘çš„è„šæœ¬ä¸­çš„å†…å®¹æ‹·è´åˆ°æœ¬åœ°åˆ›å»ºçš„è„šæœ¬ä¸­ï¼Œå¹¶æ‰§è¡Œè¯¥è„šæœ¬ã€‚</li><li>ç¬”è€…æ›´æ¨èç¬¬äºŒç§è§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºæ¥ä¸‹æ¥å®‰è£…ç»ˆç«¯ä¸»é¢˜çš„æ—¶å€™å¤§æ¦‚ç‡ä¹Ÿä¼šé‡åˆ°è¿™ä¸ªæŠ¥é”™ã€‚<br>è¿›å…¥è¿™ä¸ªç½‘å€<code>https://www.ipaddress.com/</code>ï¼Œåœ¨ç½‘é¡µå³ä¸Šè§’è¾“å…¥<code>raw.githubusercontent.com</code>æŸ¥çœ‹å¹¶å¤åˆ¶å¯¹åº”çš„IPåœ°å€</li></ul><img src="/posts/eeec06d0/image.png" class=""><p>åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œ<code>vim ~/etc/hosts</code>ï¼Œåœ¨æœ€åæ·»åŠ ç±»ä¼¼ä¸‹é¢ä¸€è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*æ›¿æ¢ä¸ºä¸Šé¢è·å¾—çš„IPåœ°å€* raw.githubusercontent.com</span><br></pre></td></tr></table></figure><p>é‡æ–°è¿›å…¥ç»ˆç«¯æ‰§è¡Œå®‰è£…å‘½ä»¤å°±å¯ä»¥åœ¨æœ¬åœ°å®‰è£…å¥½<code>oh-my-zsh</code>äº†</p><h1>å®‰è£…å‘½ä»¤è¡¥å…¨å’Œå‘½ä»¤é«˜äº®æ’ä»¶</h1><p><strong>å‘½ä»¤è¡¥å…¨æ’ä»¶</strong><br>ç»ˆç«¯ä¸­æ‰§è¡Œä¸‹é¢å‘½ä»¤ğŸ‘‡ğŸ‘‡ğŸ‘‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/.oh-my-zsh/custom/plugins</span><br><span class="line">git clone https://github.com/zsh-users/zsh-autosuggestions.git</span><br></pre></td></tr></table></figure><p><strong>é«˜äº®æ’ä»¶</strong><br>ç»ˆç«¯ä¸­æ‰§è¡Œä¸‹é¢å‘½ä»¤ğŸ‘‡ğŸ‘‡ğŸ‘‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/.oh-my-zsh/custom/plugins</span><br><span class="line">git clone https://github.com/zsh-users/zsh-syntax-highlighting.git</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ<code>vim ~/.zshrc</code>ï¼Œåœ¨æ‰“å¼€çš„æ–‡ä»¶ä¸­æ‰¾åˆ° <code>plugins=(git)</code> ä¸€è¡Œï¼Œæ›¿æ¢æˆè¿™ä¸€è¡Œ:<br><code>plugins=(git zsh-autosuggestions zsh-syntax-highlighting)</code>ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆ™ç›´æ¥æ·»åŠ åˆ°æ–‡ä»¶ä¸­å°±å¥½äº†ã€‚</p><p>ä¿å­˜å¹¶é€€å‡º<code>~/.zshrc</code>ï¼Œæ‰§è¡Œ<code>source ~/.zshrc</code>ï¼Œå®Œæˆå®‰è£…ã€‚</p><blockquote><p>å®‰è£…å®Œä¹‹åï¼Œå¦‚æœå‘ç°è¿™ä¸¤ä¸ªæ’ä»¶åœ¨ç»ˆç«¯ä¸­æ²¡æœ‰ç”Ÿæ•ˆï¼Œåˆ™éœ€è¦åœ¨<code>~/.zshrc</code>ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source ~/.oh-my-zsh/custom/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh</span><br><span class="line">source ~/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh</span><br></pre></td></tr></table></figure><p>ä¿å­˜å¹¶é€€å‡º<code>~/.zshrc</code>ï¼Œæ‰§è¡Œ<code>source ~/.zshrc</code>ï¼Œé‡å¼€ç»ˆç«¯ï¼Œé—®é¢˜è§£å†³ã€‚</p></blockquote><h1>å®‰è£…å­—ä½“</h1><p>å­—ä½“ä½¿ç”¨çš„æ˜¯<code>powerlevel10k</code>ä¸»é¢˜æ¨èçš„å­—ä½“<a href="https://github.com/ryanoasis/nerd-fonts">nerd-fonts</a></p><p>ç»ˆç«¯ä¸­æ‰§è¡Œä¸‹é¢å‘½ä»¤ğŸ‘‡ğŸ‘‡ğŸ‘‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install font-hack-nerd-font</span><br></pre></td></tr></table></figure><p>ä¸‹è½½å®Œä¹‹ååœ¨ç»ˆç«¯çš„å­—ä½“è®¾ç½®ä¸­æœç´¢ä¸€ä¸‹<code>Hack Nerd Font Mono</code>å­—ä½“å¹¶åº”ç”¨ã€‚</p><h1>å®‰è£…ä¸»é¢˜</h1><p>æˆ‘ä»¬å®‰è£…ä¸¤ä¸ªä¸»é¢˜ï¼Œä¸€ä¸ªä¸»é¢˜æ˜¯ç»ˆç«¯çš„ä¸»é¢˜ï¼Œå¦ä¸€ä¸ªä¸»é¢˜æ˜¯<code>oh-my-zsh</code>çš„ä¸»é¢˜ã€‚</p><h2 id="å®‰è£…ç»ˆç«¯ä¸»é¢˜">å®‰è£…ç»ˆç«¯ä¸»é¢˜</h2><p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/sindresorhus/terminal-snazzy/raw/main/Snazzy.terminal</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸Šé¢æ²¡æœ‰ä½¿ç”¨ç¬¬äºŒç§è§£å†³æ–¹æ¡ˆçš„è¯ï¼Œè¿™é‡Œå°±ä¼šä¸‹è½½å¤±è´¥ã€‚è¿™ä¸ªä¸»é¢˜çš„ä½œç”¨æ˜¯è®¾ç½®ç»ˆç«¯çš„èƒŒæ™¯é¢œè‰²ã€‚æ‰¾åˆ°ä¸‹è½½åˆ°æœ¬åœ°çš„<code>Snazzy.terminal</code>æ–‡ä»¶ï¼ŒåŒå‡»å®ƒæ‰“å¼€ç»ˆç«¯ï¼Œç„¶ååœ¨ç»ˆç«¯çš„è®¾ç½®ä¸­å°†<code>Snazzy</code>è®¾ç½®ä¸ºDefaultä¸»é¢˜ã€‚</p><h2 id="å®‰è£…oh-my-zshä¸»é¢˜">å®‰è£…oh-my-zshä¸»é¢˜</h2><p>ç¬”è€…é€‰æ‹©çš„ä¸»é¢˜æ˜¯<a href="https://github.com/romkatv/powerlevel10k/tree/master">powerlevel10k</a></p><p>ç»ˆç«¯ä¸­æ‰§è¡Œä¸‹é¢å‘½ä»¤ğŸ‘‡ğŸ‘‡ğŸ‘‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone --depth=1 https://gitee.com/romkatv/powerlevel10k.git $&#123;ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom&#125;/themes/powerlevel10k</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ<code>vim ~/.zshrc</code>,æ‰¾åˆ°<code>ZSH_THEME=&quot;anytheme&quot;</code>é‚£ä¸€è¡Œæ›¿æ¢ä¸º<code>ZSH_THEME=&quot;powerlevel10k/powerlevel10k&quot;</code></p><p>ä¿å­˜å¹¶é€€å‡º<code>~/.zshrc</code>ï¼Œæ‰§è¡Œ<code>source ~/.zshrc</code>ã€‚æ‰§è¡Œå®Œæ¯•ä¹‹åä¼šå¼¹å‡ºè¯¥ä¸»é¢˜çš„é…ç½®å¼•å¯¼ï¼ŒæŒ‰ç…§è‡ªå·±çš„å–œå¥½é…ç½®å³å¯ï¼Œå¦‚æœå¯¹æ•ˆæœä¸æ»¡æ„åˆ™åœ¨ç»ˆç«¯ä¸­è¾“å…¥<code>p10k configure</code>å¯ä»¥é‡æ–°è¿›è¡Œé…ç½®ã€‚</p><img src="/posts/eeec06d0/image-1.png" class=""><h2 id="é—®é¢˜è®°å½•">é—®é¢˜è®°å½•</h2><ul><li><a href="https://github.com/romkatv/powerlevel10k/issues/1942">[oh-my-zsh] theme â€˜powerlevel10kâ€™ not found</a><br>ä¸çŸ¥é“æ€ä¹ˆæçš„è¿™ä¸ªä¸»é¢˜è¢«å®‰è£…åœ¨äº†ç¬”è€…ç”µè„‘çš„æ ¹ç›®å½•ä¸‹ï¼Œæ­£ç¡®çš„ç›®å½•åº”è¯¥æ˜¯<code>$&#123;ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom&#125;/themes/powerlevel10k</code>ï¼Œåªæœ‰åœ¨è¿™ä¸ªç›®å½•ä¸‹ä¸»é¢˜æ‰èƒ½è¢«æ­£ç¡®è¯†åˆ«ï¼Œå¦å¤–æ³¨æ„<code>~/.zshrc</code>ä¸­æ·»åŠ ä¸€è¡Œ<code>source $&#123;ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom&#125;/themes/powerlevel10k/powerlevel10k.zsh-theme</code>ä»£ç ï¼Œæ³¨é‡Šæ‰ä¹‹å‰sourceè¯¥ä¸»é¢˜çš„å‘½ä»¤ã€‚</li><li><a href="https://github.com/romkatv/powerlevel10k/issues/1023">[WARNING]: Console output during zsh initialization detected</a><br>ç›´æ¥åœ¨å¼•å¯¼é…ç½®çš„æœ€åä¸€é¡¹ä¸­é€‰æ‹©<code>Quite</code>ï¼Œè€Œä¸æ˜¯é€‰æ‹©æ¨èçš„<code>Verbose</code>ã€‚<img src="/posts/eeec06d0/image-2.png" class=""></li></ul><h1>å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://blog.csdn.net/weixin_42326144/article/details/121957795?spm=1001.2101.3001.6650.7&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-7-121957795-blog-135977657.235%5Ev43%5Econtrol&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-7-121957795-blog-135977657.235%5Ev43%5Econtrol&amp;utm_relevant_index=12">MAC ç»ˆç«¯ç¾åŒ–æ•™ç¨‹ï¼ˆæ¥ä¸ªå…¨å¥—ï¼‰</a></li><li><a href="https://zhuanlan.zhihu.com/p/554264938">Mac ç»ˆç«¯ç¾åŒ–æŒ‡å—</a></li><li><a href="https://blog.csdn.net/m0_60980259/article/details/135977657">æ›´æ”¹MACç»ˆç«¯æ ·å¼(ç¾åŒ–ã€æ˜“ç”¨çš„æç¤ºç­‰)</a></li><li><a href="https://blog.csdn.net/wjp52/article/details/124426943">Mac ç»ˆç«¯é…ç½® oh-my-zsh å’Œè‡ªåŠ¨è¡¥å…¨ä»¥åŠå‘½ä»¤é«˜äº®</a></li><li><a href="https://blog.csdn.net/a143730/article/details/135573409">å®‰è£…oh-my-zshï¼Œé…ç½®å‘½ä»¤è¡Œé«˜äº®ï¼Œå‘½ä»¤æç¤ºï¼Œæ‰“é€ é«˜æ•ˆç»ˆç«¯</a></li><li><a href="https://huaweicloud.csdn.net/6509554c993dd34278ee3a0f.html?dp_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpZCI6ODkxMDEzLCJleHAiOjE3Mjc3ODcwNDQsImlhdCI6MTcyNzE4MjI0NCwidXNlcm5hbWUiOiJxcV80NTcyMzgyMSJ9.3rYUSIkc7_U_kaBdQ-35s0Kr6Sff-06B_M229QXJU8s&amp;spm=1001.2101.3001.6650.2&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Eactivity-2-106862753-blog-123021848.235%5Ev43%5Econtrol&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Eactivity-2-106862753-blog-123021848.235%5Ev43%5Econtrol&amp;utm_relevant_index=3">curl: (7) Failed to connect to raw.githubusercontent.com port 443: Connection refusedçš„å‡ ç§è§£å†³æ–¹å¼</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¡¬æŠ€èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¯å¢ƒé…ç½® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UnityAssetDatabaseé—®é¢˜æ•´ç†</title>
      <link href="/posts/1a407a45/"/>
      <url>/posts/1a407a45/</url>
      
        <content type="html"><![CDATA[<h1>AssetDataBaseæ¥å£ä½¿ç”¨é‡åˆ°çš„å‘</h1><p><code>AssetDatabase.Refresh</code>æ–¹æ³•ç”¨äºåˆ·æ–°Unityç¼–è¾‘å™¨çš„èµ„äº§æ•°æ®åº“ã€‚è¿™ä¸ªæ–¹æ³•ä¼šåŒæ­¥ç£ç›˜å’ŒUnityç¼–è¾‘å™¨ä¹‹é—´çš„èµ„äº§çŠ¶æ€ï¼ŒåŒ…æ‹¬æ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹æ–‡ä»¶ç­‰ã€‚å¦‚æœä½ åœ¨Unityç¼–è¾‘å™¨å¤–éƒ¨ï¼ˆæ¯”å¦‚åœ¨æ–‡ä»¶æµè§ˆå™¨ä¸­æˆ–é€šè¿‡è„šæœ¬ï¼‰å¯¹é¡¹ç›®ä¸­çš„æ–‡ä»¶è¿›è¡Œäº†æ›´æ”¹ï¼Œä½¿ç”¨AssetDatabase.Refreshå¯ä»¥è®©Unityç¼–è¾‘å™¨è¯†åˆ«è¿™äº›æ›´æ”¹ã€‚</p><p><code>AssetDatabase.SaveAssets</code>æ–¹æ³•ç”¨äºå°†æ‰€æœ‰æœªä¿å­˜çš„èµ„äº§æ›´æ”¹æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚è¿™åŒ…æ‹¬å¯¹é¢„åˆ¶ä½“ã€åœºæ™¯ã€æè´¨ç­‰ä»»ä½•åœ¨ç¼–è¾‘å™¨ä¸­åšå‡ºçš„æ›´æ”¹ã€‚å¦‚æœä½ åœ¨è„šæœ¬ä¸­ä¿®æ”¹äº†ä»»ä½•èµ„äº§ï¼ˆæ¯”å¦‚æ›´æ”¹äº†ä¸€ä¸ªæè´¨çš„é¢œè‰²ï¼Œæˆ–è€…æ·»åŠ äº†ä¸€ä¸ªæ–°çš„æ¸¸æˆå¯¹è±¡åˆ°ä¸€ä¸ªé¢„åˆ¶ä½“ä¸­ï¼‰ï¼Œå¹¶ä¸”æƒ³è¦ç¡®ä¿è¿™äº›æ›´æ”¹è¢«ä¿å­˜ï¼Œå°±éœ€è¦è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p><ol><li>è„šæœ¬ä¸­ä¿®æ”¹å®Œèµ„æºé‡Œé¢çš„å±æ€§çš„æ—¶å€™ï¼Œè°ƒç”¨ä¸€æ¬¡AssetDataBase.Save() å¿…é¡»è¦åœ¨AssetDataBase.Load()æ–¹æ³•ä¹‹é—´è°ƒç”¨ï¼Œä¸ç„¶ä¿®æ”¹å°±ç™½åšäº†</li><li>Fileæ¥å£ç›¸å…³çš„æ“ä½œDirectoryç›¸å…³çš„æ“ä½œåå¿…é¡»åé¢è·Ÿä¸€ä¸ªAssetDataBase.Refreshè°ƒç”¨</li></ol><p><code>AssetDatabase.MoveAsset</code>è°ƒç”¨çš„æ—¶å€™,å¦‚æœç›®æ ‡ä½ç½®çš„è·¯å¾„ä¸å­˜åœ¨çš„è¯ç§»åŠ¨Assetçš„æ“ä½œæ˜¯ä¸ä¼šæˆåŠŸçš„.ä¼šæç¤ºä½ <code>Could not find parent directory GUID</code>,æ‰€ä»¥åœ¨ç§»åŠ¨Assetä¹‹å‰éœ€è¦å…ˆç¡®å®šç›®æ ‡è·¯å¾„æ˜¯å¦å­˜åœ¨,ä½ å¯ä»¥ä½¿ç”¨<code>AssetDataBase.CreateFolder</code>æ¥å£æ¥åˆ›å»ºç›®æ ‡è·¯å¾„,æˆ–è€…ä½¿ç”¨<code>Directory</code>ç›¸å…³æ¥å£æ¥åˆ›å»º,æ³¨æ„ä½¿ç”¨<code>Directory</code>æ¥å£åˆ›å»ºè·¯å¾„åéœ€è¦è°ƒç”¨<code>AssetDatabase.Refresh</code>æ¥å£æ¥åŒæ­¥</p><h1>æŸ¥è¯¢èµ„æºå¼•ç”¨</h1><p>AssetDataBase.FindAssetsæ¥å£ å¯¹äºé¢„åˆ¶ä½“æ¥è¯´, å¿…é¡»ä¼ è¿›å»çš„æ˜¯é¢„åˆ¶ä½“æ‰€åœ¨çš„ç›®å½•, æ˜¯æ–‡ä»¶å¤¹, ä¸èƒ½æ˜¯å…·ä½“çš„é¢„åˆ¶ä½“, ä½†æ˜¯å¯¹äºTextureæ¥è¯´, ä¼ å…¥Textureè·¯å¾„å´æ˜¯æ²¡é—®é¢˜çš„.</p><h1>æ¡ˆä¾‹</h1><p>éœ€è¦åšçƒ­æ›´,å°†åŸæ¥æ··åœ¨ä¸€èµ·çš„èµ„æºéš”ç¦»å‡ºæ¥,</p><p>èµ„æºçš„åˆ†ç±»</p><ul><li>Material</li><li>Texture</li><li>Animation</li><li>Font</li><li>Prefab</li><li>Audioin</li></ul>]]></content>
      
      
      <categories>
          
          <category> UnityEditorå¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¡¹ç›®ç»éªŒæ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¸¸æˆå¼€å‘ä¸­çš„è®¾è®¡æ¨¡å¼ â€”â€” å‘½ä»¤æ¨¡å¼</title>
      <link href="/posts/1b7f45c3/"/>
      <url>/posts/1b7f45c3/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œä½¿ä½ å¯ç”¨ä¸åŒçš„è¯·æ±‚å¯¹å®¢æˆ·è¿›è¡Œå‚æ•°åŒ–ï¼Œå¯¹è¯·æ±‚æ’é˜Ÿæˆ–è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œä»¥åŠæ”¯æŒå¯æ’¤é”€çš„æ“ä½œã€‚</p></blockquote><p>åœ¨GTAã€å·«å¸ˆè¿™ä¸€ç±»æ¸¸æˆä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>WASD</code>æ“æ§è§’è‰²çš„ç§»åŠ¨ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æŒ‰é”®æ“æ§è½½å…·ã€é©¬åŒ¹çš„ç§»åŠ¨ã€‚æ— è®ºæ˜¯è½½å…·è¿˜æ˜¯è§’è‰²ï¼Œå½“ä½ æŒ‰ä¸‹äº†<code>W</code>é”®ï¼Œå®ƒä»¬éƒ½ä¼šæ‰§è¡Œäº†å‘å‰ç§»åŠ¨çš„æŒ‡ä»¤ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ä¸­å†™å‡ºå¦‚ä¸‹çš„ä»£ç :</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(CurrentControllingObject == Horse)&#123;</span><br><span class="line">        <span class="keyword">if</span>(Input.GetKeyDown(KeyCode.W))&#123;</span><br><span class="line">            HorseMoveForward();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(Input.GetKeyDown(KeyCode.A))&#123;</span><br><span class="line">            HorseMoveLeft();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(Input.GetKeyDown(KeyCode.S))&#123;</span><br><span class="line">            HorseMoveBackward();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(Input.GetKeyDown(KeyCode.D))&#123;</span><br><span class="line">            HorseMoveRight();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(CurrentControllingObject == Hero)&#123;</span><br><span class="line">        <span class="keyword">if</span>(Input.GetKeyDown(KeyCode.W))&#123;</span><br><span class="line">            HeroMoveForward();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(Input.GetKeyDown(KeyCode.A))&#123;</span><br><span class="line">            HeroMoveLeft();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(Input.GetKeyDown(KeyCode.S))&#123;</span><br><span class="line">            HeroMoveBackward();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(Input.GetKeyDown(KeyCode.D))&#123;</span><br><span class="line">            HeroMoveRight();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ....</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„ä»£ç å¤ªä¸‘é™‹äº†ï¼Œä½†æ˜¯æ›´ä¸¥é‡çš„é—®é¢˜æ˜¯ï¼Œè¿™æ ·çš„å†™æ³•å¾ˆä¸åˆ©äºç»´æŠ¤å’Œæ‹“å±•ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è®©æˆ‘ä»¬çš„æ¸¸æˆæ”¯æŒç©å®¶è‡ªå®šä¹‰æŒ‰é”®æ“ä½œçš„åŠŸèƒ½ï¼Œä¸Šé¢çš„ä»£ç æ ¹æœ¬å°±æ²¡åŠæ³•å®ç°ï¼Œå› ä¸ºæŒ‰é”®çš„ç»‘å®šæ˜¯è¢«æˆ‘ä»¬ç¡¬ç¼–ç è¿›è„šæœ¬é‡Œçš„ã€‚è€Œä¸”ï¼Œæ¸¸æˆä¸­å„ç§å¯ä»¥è¢«æ§åˆ¶ç§»åŠ¨çš„ç‰©ä½“éƒ½è¢«è€¦åˆåœ¨äº†ä¸€èµ·ï¼Œè¿™ä¸ç¬¦åˆé¢å‘å¯¹è±¡çš„è®¾è®¡åŸåˆ™ã€‚</p><p>å› æ­¤ï¼Œç¬”è€…å¸Œæœ›é€šè¿‡æœ¬æ–‡ä»‹ç»çš„å‘½ä»¤æ¨¡å¼è§£å†³ä¸Šé¢ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>æŒ‰é”®ä¸æ¸¸æˆç‰©ä½“è¡Œä¸ºç¡¬ç¼–ç ç»‘å®š</li><li>æ‰€æœ‰æ¸¸æˆç‰©ä½“çš„è¡Œä¸ºå¤„ç†é€»è¾‘è€¦åˆåœ¨äº†ä¸€èµ·</li></ul><h1>å‘½ä»¤æ¨¡å¼</h1>]]></content>
      
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UnityShaderå…¥é—¨ç²¾è¦ç¬”è®°-ï¼ˆåäº”ï¼‰-ä½¿ç”¨å™ªå£°</title>
      <link href="/posts/200401f7/"/>
      <url>/posts/200401f7/</url>
      
        <content type="html"><![CDATA[<p>å¾ˆå¤šæ—¶å€™ï¼Œå‘è§„åˆ™çš„äº‹ç‰©é‡Œæ·»åŠ ä¸€äº›â€œæ‚ä¹±æ— ç« â€çš„æ•ˆæœå¾€å¾€ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„æ•ˆæœã€‚è€Œè¿™äº›â€œæ‚ä¹±æ— ç« â€çš„æ•ˆæœæ¥æºå°±æ˜¯å™ªå£°ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šå­¦ä¹ å¦‚ä½•ä½¿ç”¨å™ªå£°æ¥æ¨¡æ‹Ÿå„ç§çœ‹ä¼¼â€œç¥å¥‡â€çš„æ•ˆæœã€‚åœ¨15.1èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šä½¿ç”¨ä¸€å¼ å™ªå£°çº¹ç†æ¥æ¨¡æ‹Ÿç«ç„°çš„æ¶ˆèæ•ˆæœã€‚15.2èŠ‚åˆ™æŠŠå™ªå£°åº”ç”¨åœ¨æ¨¡æ‹Ÿæ°´é¢çš„æ³¢åŠ¨ä¸Šï¼Œä»è€Œäº§ç”Ÿæ³¢å…‰ç²¼ç²¼çš„è§†è§‰æ„Ÿå—ã€‚åœ¨15.3èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šå›é¡¾13.3èŠ‚ä¸­å®ç°çš„å…¨å±€é›¾æ•ˆï¼Œå¹¶å‘å…¶ä¸­æ·»åŠ å™ªå£°æ¥æ¨¡æ‹Ÿä¸å‡åŒ€çš„é£˜æ¸ºé›¾æ•ˆã€‚</p><h2 id="æ¶ˆèæ•ˆæœ">æ¶ˆèæ•ˆæœ</h2><p>æ¶ˆèæ•ˆæœå¸¸è§äºæ¸¸æˆä¸­çš„è§’è‰²æ­»äº¡ã€åœ°å›¾çƒ§æ¯ç­‰æ•ˆæœ.åœ¨è¿™äº›å°é”…ä¸­,æ¶ˆèå¾€å¾€ä»ä¸åŒçš„åŒºåŸŸå¼€å§‹,å¹¶å‘çœ‹ä¼¼éšæœºçš„æ–¹å‘æ‰©å¼ ,æœ€åæ•´ä¸ªç‰©ä½“éƒ½å°†æ¶ˆå¤±ä¸è§.åœ¨æœ¬èŠ‚ä¸­,æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åœ¨Unityä¸­å®ç°è¿™ç§æ•ˆæœ.<br>è¦å®ç°è¿™ç§æ•ˆæœ,åŸç†éå¸¸ç®€å•,æ¦‚æ‹¬æ¥è¯´,å°±æ˜¯ä½¿ç”¨å™ªå£°çº¹ç†+é€æ˜åº¦æµ‹è¯•.æˆ‘ä»¬ä½¿ç”¨å¯¹å™ªå£°çº¹ç†é‡‡æ ·çš„ç»“æœå’ŒæŸä¸ªæ§åˆ¶æ¶ˆèç¨‹åº¦çš„é˜ˆå€¼æ¯”è¾ƒ,å¦‚æœå°äºé˜ˆå€¼,å°±ä½¿ç”¨clipå‡½æ•°æŠŠå®ƒå¯¹åº”çš„åƒç´ è£å‰ªæ‰,è¿™äº›éƒ¨åˆ†å°±å¯¹åº”äº†å›¾ä¸­è¢«â€œçƒ§æ¯â€çš„åŒºåŸŸ.è€Œé•‚ç©ºåŒºåŸŸè¾¹ç¼˜çš„çƒ§ç„¦æ•ˆæœåˆ™æ˜¯å°†ä¸¤ç§é¢œè‰²æ··åˆ,å†ç”¨powå‡½æ•°å¤„ç†ä¹‹å,ä¸åŸçº¹ç†é¢œè‰²æ··åˆåçš„ç»“æœ.</p><ol><li>é¦–å…ˆ,å£°æ˜æ¶ˆèæ•ˆæœéœ€è¦çš„å„ä¸ªå±æ€§</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Properties</span><br><span class="line">&#123;</span><br><span class="line">    _BurnAmount (&quot;Burn Amount&quot;, Range(0.0, 1.0)) = 0.0</span><br><span class="line">    _LineWidth(&quot;Burn Line Width&quot;, Range(0.0, 0.2)) = 0.1</span><br><span class="line">    _MainTex (&quot;Base (RGB)&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">    _BumpMap (&quot;Normal Map&quot;, 2D) = &quot;bump&quot; &#123;&#125;</span><br><span class="line">    _BurnFirstColor(&quot;Burn First Color&quot;, Color) = (1, 0, 0, 1)</span><br><span class="line">    _BurnSecondColor(&quot;Burn Second Color&quot;, Color) = (1, 0, 0, 1)</span><br><span class="line">    _BurnMap(&quot;Burn Map&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>_BurnAmountå±æ€§ç”¨äºæ§åˆ¶æ¶ˆèç¨‹åº¦,å½“å€¼ä¸º0æ—¶,ç‰©ä½“ä¸ºæ­£å¸¸æ•ˆæœ,å½“å€¼ä¸º1æ—¶,ç‰©ä½“ä¼šå®Œå…¨æ¶ˆè._LineWidthå±æ€§ç”¨äºæ§åˆ¶æ¨¡æ‹Ÿçƒ§ç„¦æ•ˆæœæ—¶çš„çº¿å®½,å®ƒçš„å€¼è¶Šå¤§,ç«ç„°è¾¹ç¼˜çš„è”“å»¶èŒƒå›´è¶Šå¹¿._MainTexå’Œ_BumpMapåˆ†åˆ«å¯¹åº”äº†ç‰©ä½“åŸæœ¬çš„æ¼«åå°„çº¹ç†å’Œæ³•çº¿çº¹ç†._BurnFirstColorå’Œ_BurnSecondColorå¯¹åº”äº†ç«ç„°è¾¹ç¼˜çš„ä¸¤ç§é¢œè‰²å€¼._BurnMapåˆ™æ˜¯å…³é”®çš„å™ªå£°çº¹ç†.</p><ol start="2"><li>æˆ‘ä»¬åœ¨SubShaderå—ä¸­å®šä¹‰æ¶ˆèæ‰€éœ€è¦çš„Pass:</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags &#123;  &quot;LightMode&quot;=&quot;ForwardBase&quot; &#125;</span><br><span class="line">            Cull Off</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #include &quot;Lighting.cginc&quot;</span><br><span class="line">            #include &quot;AutoLight.cginc&quot;</span><br><span class="line"></span><br><span class="line">            #pragma multi_compile_fwdbase</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        </span><br><span class="line">        &#125;    </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†å¾—åˆ°æ­£ç¡®çš„å…‰ç…§,æˆ‘ä»¬è®¾ç½®äº†Passçš„LightModeå’Œmulti_compile_fwdbaseçš„ç¼–è¯‘æŒ‡ä»¤.å€¼å¾—æ³¨æ„çš„æ˜¯,æˆ‘ä»¬è¿˜ä½¿ç”¨Cullå‘½ä»¤å…³é—­äº†è¯¥Shaderçš„é¢ç‰‡å‰”é™¤,ä¹Ÿå°±æ˜¯è¯´,æ¨¡å‹çš„æ­£é¢å’ŒèƒŒé¢éƒ½ä¼šè¢«æ¸²æŸ“.è¿™æ˜¯å› ä¸º,æ¶ˆèä¼šå¯¼è‡´è£¸éœ²å†…éƒ¨çš„æ„é€ ,å¦‚æœåªæ¸²æŸ“æ­£é¢ä¼šå‡ºç°é”™è¯¯çš„ç»“æœ.</p><ol start="3"><li>å®šä¹‰é¡¶ç‚¹ç€è‰²å™¨</li></ol><p>é¡¶ç‚¹ç€è‰²å™¨ä¸­çš„ä»£ç å¾ˆå¸¸è§„.æˆ‘ä»¬ä½¿ç”¨å®TRANSFORM_TEXè®¡ç®—äº†ä¸‰å¼ çº¹ç†å¯¹åº”çš„çº¹ç†åæ ‡,å†æŠŠå…‰æºæ–¹å‘ä»æ¨¡å‹ç©ºé—´å˜æ¢åˆ°äº†åˆ‡çº¿ç©ºé—´.æœ€å,ä¸ºäº†å¾—åˆ°é˜´å½±ä¿¡æ¯,è®¡ç®—äº†ä¸–ç•Œç©ºé—´ä¸‹çš„é¡¶ç‚¹ä½ç½®å’Œé˜´å½±çº¹ç†çš„é‡‡æ ·åæ ‡(ä½¿ç”¨äº†TRANSFER_SHADOWå®).</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">v2f vert(a2v v)</span><br><span class="line">&#123;</span><br><span class="line">    v2f o;</span><br><span class="line">    o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line"></span><br><span class="line">    o.uvMainTex = TRANSFORM_TEX(v.texcoord, _MainTex);</span><br><span class="line">    o.uvBumpMap = TRANSFORM_TEX(v.texcoord, _BumpMap);</span><br><span class="line">    o.uvBurnMap = TRANSFORM_TEX(v.texcoord, _BurnMap);</span><br><span class="line"></span><br><span class="line">    TANGENT_SPACE_ROTATION;</span><br><span class="line"></span><br><span class="line">    o.lightDir = mul(rotation, ObjSpaceLightDir(v.vertex)).xyz;</span><br><span class="line"></span><br><span class="line">    o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;</span><br><span class="line"></span><br><span class="line">    TRANSFER_SHADOW(o);</span><br><span class="line"></span><br><span class="line">    return o;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨TANGENT_SPACE_ROTATIONå®ç°äº†ä»åæ ‡ç©ºé—´åˆ°åˆ‡çº¿ç©ºé—´çš„å˜æ¢çŸ©é˜µ.<br>4. æˆ‘ä»¬è¿˜éœ€è¦ç‰‡å…ƒç€è‰²å™¨æ¥æ¨¡æ‹Ÿæ¶ˆèçš„æ•ˆæœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">fixed4 frag(v2f i) : SV_Target</span><br><span class="line">&#123;</span><br><span class="line">    fixed3 burn = tex2D(_BurnMap, i.uvBurnMap).rgb;</span><br><span class="line">    clip(burn.r - _BurnAmount);</span><br><span class="line"></span><br><span class="line">    float3 tangentLightDir = normalize(i.lightDir);</span><br><span class="line">    fixed3 tangentNormal = UnpackNormal(tex2D(_BumpMap, i.uvBumpMap));</span><br><span class="line"></span><br><span class="line">    fixed3 albedo = tex2D(_MainTex, i.uvMainTex).rgb;</span><br><span class="line"></span><br><span class="line">    fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz * albedo;</span><br><span class="line">    fixed3 diffuse = _LightColor0.rgb * albedo * max(0, dot(tangentNormal, tangentLightDir));</span><br><span class="line"></span><br><span class="line">    fixed t = 1 - smoothstep(0.0, _LineWidth, burn.r - _BurnAmount);</span><br><span class="line">    fixed3 burnColor = lerp(_BurnFirstColor, _BurnSecondColor, t);</span><br><span class="line">    burnColor = pow(burnColor, 5);</span><br><span class="line"></span><br><span class="line">    UNITY_LIGHT_ATTENUATION(atten, i, i.worldPos);</span><br><span class="line"></span><br><span class="line">    fixed3 finalColor = lerp(ambient + diffuse * atten, burnColor, t * step(0.0001l, _BurnAmount));</span><br><span class="line"></span><br><span class="line">    return fixed4(finalColor, 1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é¦–å…ˆå¯¹å™ªå£°çº¹ç†è¿›è¡Œé‡‡æ ·,å¹¶å°†é‡‡æ ·ç»“æœå’Œç”¨äºæ§åˆ¶æ¶ˆèç¨‹åº¦çš„å±æ€§_BurnAmountç›¸å‡,ä¼ é€’ç»™clipå‡½æ•°. å½“ç»“æœå°äº0æ—¶,è¯¥åƒç´ å°†ä¼šè¢«å‰”é™¤,ä»è€Œä¸ä¼šæ˜¾ç¤ºåˆ°å±å¹•ä¸Š.å¦‚æœé€šè¿‡äº†æµ‹è¯•,åˆ™è¿›è¡Œæ­£å¸¸çš„å…‰ç…§è®¡ç®—.æˆ‘ä»¬é¦–å…ˆæ ¹æ®æ¼«åå°„çº¹ç†å¾—åˆ°æè´¨çš„åç…§ç‡albedo,å¹¶ç”±æ­¤è®¡ç®—å¾—åˆ°ç¯å¢ƒå…‰ç…§, è¿›è€Œå¾—åˆ°æ¼«åå°„å…‰ç…§.ç„¶å,æˆ‘ä»¬è®¡ç®—äº†çƒ§ç„¦é¢œè‰²burnColor. æˆ‘ä»¬æƒ³è¦åœ¨å®½åº¦ä¸º_LineWidthçš„èŒƒå›´å†…æ¨¡æ‹Ÿä¸€ä¸ªçƒ§ç„¦çš„é¢œè‰²å˜åŒ–,ç¬¬ä¸€æ­¥å°±æ˜¯ç”¨äº†smoothstepå‡½æ•°æ¥è®¡ç®—æ··åˆç³»æ•°t.å½“tçš„å€¼ä¸º1æ—¶,è¡¨æ˜è¯¥åƒç´ ä½äºæ¶ˆèçš„è¾¹ç•Œå¤„,å½“tå€¼ä¸º0æ—¶,è¡¨æ˜è¯¥åƒç´ ä¸ºæ­£å¸¸çš„æ¨¡å‹é¢œè‰²,è€Œä¸­é—´çš„æ’å€¼åˆ™è¡¨ç¤ºéœ€è¦æ¨¡æ‹Ÿä¸€ä¸ªçƒ§ç„¦æ•ˆæœ.æˆ‘ä»¬é¦–å…ˆç”¨tæ¥æ··åˆä¸¤ç§ç«ç„°é¢œè‰²_BurnFirstColorå’Œ_BurnSecondColor,ä¸ºäº†è®©æ•ˆæœæ›´ä½³æ¥è¿‘çƒ§ç„¦çš„ç—•è¿¹,æˆ‘ä»¬è¿˜ä½¿ç”¨powå‡½æ•°å¯¹ç»“æœè¿›è¡Œå¤„ç†.ç„¶å,æˆ‘ä»¬å†æ¬¡ä½¿ç”¨tæ¥æ··åˆæ­£å¸¸çš„å…‰ç…§é¢œè‰²(ç¯å¢ƒå…‰+æ¼«åå°„)å’Œçƒ§ç„¦é¢œè‰².æˆ‘ä»¬è¿™é‡Œåˆä½¿ç”¨äº†stepå‡½æ•°æ¥æŠ¥ç§°å½“_BurnAmountä¸º0æ—¶,ä¸æ˜¾ç¤ºä»»ä½•æ¶ˆèæ•ˆæœ.æœ€å,è¿”å›æ··åˆåçš„é¢œè‰²å€¼finalColor</p><p>ä¸ä¹‹å‰çš„å®ç°ä¸åŒ,æˆ‘ä»¬åœ¨æœ¬ä¾‹ä¸­è¿˜å®šä¹‰äº†ä¸€ä¸ªç”¨äºæŠ•å°„é˜´å½±çš„Pass.æ­£å¦‚æˆ‘ä»¬åœ¨ä¹‹å‰è§£é‡Šè¿‡çš„ä¸€æ ·:ä½¿ç”¨é€æ˜åº¦æµ‹è¯•çš„ç‰©ä½“çš„é˜´å½±éœ€è¦ç‰¹åˆ«å¤„ç†,å¦‚æœä»ç„¶ä½¿ç”¨æ™®é€šçš„é˜´å½±Pass,é‚£ä¹ˆè¢«å‰”é™¤çš„åŒºåŸŸä»ç„¶ä¼šå‘å…¶ä»–ç‰©ä½“æŠ•å°„é˜´å½±,é€ æˆç©¿å¸®.ä¸ºäº†è®©ç‰©ä½“çš„é˜´å½±ä¹Ÿèƒ½é…åˆé€æ˜åº¦æµ‹è¯•äº§ç”Ÿæ­£ç¡®çš„æ•ˆæœ,æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªæŠ•å°„é˜´å½±çš„Pass.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Pass</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    Tags&#123; &quot;LightMode&quot;=&quot;ShadowCaster&quot; &#125;</span><br><span class="line">    CGPROGRAM</span><br><span class="line"></span><br><span class="line">    #pragma vertex vert</span><br><span class="line">    #pragma fragment frag</span><br><span class="line"></span><br><span class="line">    #pragma multi_compile_shadowcaster</span><br><span class="line"></span><br><span class="line">    struct v2f</span><br><span class="line">    &#123;</span><br><span class="line">        V2F_SHADOW_CASTER;</span><br><span class="line">        float2 uvBurnMap : TEXCOORD1;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    v2f vert(appdata_base v)</span><br><span class="line">    &#123;</span><br><span class="line">        v2f o;</span><br><span class="line"></span><br><span class="line">        TRANSFER_SHADOW_CASTER_NORMALOFFSET(o)</span><br><span class="line"></span><br><span class="line">        o.uvBurnMap = TRANSFORM_TEX(v.texcoord, _BurnMap);</span><br><span class="line">        return o;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fixed4 frag(v2f i) : SV_Target&#123;</span><br><span class="line">        fixed3 burn = tex2D(_BurnMap,i.uvBurnMap).rgb;</span><br><span class="line"></span><br><span class="line">        clip(burn.r - _BurnAmount);</span><br><span class="line"></span><br><span class="line">        SHADOW_CASTER_FRAGMENT(i)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ENDCG</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é˜´å½±æŠ•å°„çš„é‡ç‚¹åœ¨äºæˆ‘ä»¬éœ€è¦æŒ‰æ­£å¸¸Passçš„å¤„ç†æ¥å‰”é™¤ç‰‡å…ƒæˆ–è¿›è¡Œå®šç‚¹åŠ¨ç”»,ä»¥ä¾¿å¯ä»¥å’Œç‰©ä½“æ­£å¸¸æ¸²æŸ“çš„ç»“æœç›¸åŒ¹é….åœ¨è‡ªå®šä¹‰çš„é˜´å½±æŠ•å°„çš„Passä¸­,æˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨Unityæä¾›çš„å†…ç½®å®<code>V2F_SHADOW_CASTER</code>ã€<code>TRANSFER_SHADOW_CASTER_NORMALOFFSET</code>å’Œ<code>SHADOW_CASTER_FRAGMENT</code>æ¥å¸®åŠ©æˆ‘ä»¬è®¡ç®—é˜´å½±æŠ•å°„æ—¶æ‰€éœ€è¦çš„å„ç§å˜é‡,è€Œæˆ‘ä»¬å¯ä»¥åªå…³æ³¨è‡ªå®šä¹‰è®¡ç®—çš„éƒ¨åˆ†.åœ¨ä¸Šé¢çš„ä»£ç ä¸­,æˆ‘ä»¬é¦–å…ˆåœ¨v2fç»“æ„ä½“ä¸­åˆ©ç”¨V2F_SHADOW_CASTERæ¥å®šä¹‰é˜´å½±æŠ•å°„éœ€è¦å®šä¹‰çš„å˜é‡.éšå,åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­,æˆ‘ä»¬ä½¿ç”¨TRANSFER_SHADOW_CASTER_NORMALOFFSETæ¥å¡«å……V2F_SHADOW_CASTERåœ¨èƒŒåå£°æ˜çš„ä¸€äº›å˜é‡,è¿™æ˜¯ç”±Unityåœ¨èƒŒåä¸ºæˆ‘ä»¬å®Œæˆçš„. æˆ‘ä»¬éœ€è¦åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­å…³æ³¨è‡ªå®šä¹‰çš„è®¡ç®—éƒ¨åˆ†,è¿™é‡ŒæŒ‡çš„å°±æ˜¯æˆ‘ä»¬éœ€è¦è®¡ç®—å™ªå£°çº¹ç†çš„é‡‡æ ·åæ ‡uvBurnMap. åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­,æˆ‘ä»¬é¦–å…ˆæŒ‰ä¹‹å‰çš„å¤„ç†æ–¹æ³•ä½¿ç”¨å™ªå£°çº¹ç†çš„é‡‡æ ·ç»“æœæ¥å‰”é™¤ç‰‡å…ƒ,æœ€åå†åˆ©ç”¨SHADOW_CASTER_FRAGMENTæ¥è®©Unityä¸ºæˆ‘ä»¬å®Œæˆé˜´å½±æŠ•å°„çš„éƒ¨åˆ†,æŠŠç»“æœè¾“å‡ºåˆ°æ·±åº¦å›¾å’Œé˜´å½±æ˜ å°„çº¹ç†ä¸­.<br>é€šè¿‡Unityæä¾›çš„è¿™ä¸‰ä¸ªå†…ç½®å®,æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°å®šä¹‰éœ€è¦é˜´å½±æŠ•å°„çš„Pass, ä½†ç”±äºè¿™äº›å®éœ€è¦ä½¿ç”¨ä¸€äº›ç‰¹å®šçš„è¾“å…¥å˜é‡,å› æ­¤æˆ‘ä»¬éœ€è¦ä¿è¯ä¸ºå®ƒä»¬æä¾›äº†è¿™äº›å˜é‡. ä¾‹å¦‚TRANSFER_SHADOW_CASTER_NORMALOFFSETä¼šä½¿ç”¨åç§°vä½œä¸ºè¾“å…¥ç»“æ„ä½“,vä¸­éœ€è¦åŒ…å«é¡¶ç‚¹ä½ç½®v.vertexå’Œé¡¶ç‚¹æ³•çº¿v.normalçš„ä¿¡æ¯,æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å†…ç½®çš„appdata_baseç»“æ„ä½“,å®ƒåŒ…å«äº†è¿™äº›å¿…é¡»çš„é¡¶ç‚¹å˜é‡. å¦‚æœæˆ‘ä»¬éœ€è¦è¿›è¡Œå®šç‚¹åŠ¨ç”»,å¯ä»¥åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­ç›´æ¥ä¿®æ”¹v.vertex,å†ä¼ é€’ç»™TRANSFER_SHADOW_CASTER_NORMALOFFSET.</p><p>æŠ•å°„é˜´å½±â€œä¸‰å‰‘å®¢â€ æƒ³æŠ•å°„é˜´å½±é™¤äº†ç¼–å†™Shaderä»£ç è¿˜è¦æŠŠMeshRendererä¸­çš„<code>CastShadows</code>é€‰é¡¹æ‰“å¼€ <code>V2F_SHADOW_CASTER</code>ã€<code>TRANSFER_SHADOW_CASTER_NORMALOFFSET</code>å’Œ<code>SHADOW_CASTER_FRAGMENT</code></p><p>æ¥æ”¶é˜´å½±â€œä¸‰å‰‘å®¢â€ <code>SHADOW_COORDS</code> <code>TRANSFER_SHADOW</code> <code>SHADOW_ATTENUATION</code></p><p>ç»Ÿä¸€ç®¡ç†å…‰ç…§è¡°å‡(Attenuation)å’Œæ¥æ”¶é˜´å½±<code>SHADOW_COORDS</code> <code>TRANSFER_SHADOW</code> å°†<code>SHADOW_ATTENUATION</code>æ›¿æ¢ä¸º<code>UNITY_LIGHT_ATTENUATION</code></p><h2 id="æ°´æ³¢æ•ˆæœ">æ°´æ³¢æ•ˆæœ</h2><p>åœ¨æ¨¡æ‹Ÿå®æ—¶æ°´é¢çš„è¿‡ç¨‹ä¸­,æˆ‘ä»¬å¾€å¾€ä¹Ÿä¼šä½¿ç”¨å™ªå£°çº¹ç†.æ­¤æ—¶,å™ªå£°çº¹ç†é€šå¸¸ä¼šç”¨ä½œä¸€ä¸ªé«˜åº¦å›¾, ä»¥ä¸æ–­ä¿®æ”¹æ°´é¢çš„æ³•çº¿æ–¹å‘. ä¸ºäº†æ¨¡æ‹Ÿæ°´ä¸æ–­æµåŠ¨çš„æ•ˆæœ,æˆ‘ä»¬ä¼šä½¿ç”¨å’Œæ—¶é—´ç›¸å…³çš„å˜é‡æ¥å¯¹å™ªå£°çº¹ç†è¿›è¡Œé‡‡æ ·,å½“å¾—åˆ°æ³•çº¿ä¿¡æ¯å,å†è¿›è¡Œæ­£å¸¸çš„åå°„å’ŒæŠ˜å°„è®¡ç®—,æœ€åå¾—åˆ°æ°´é¢æ³¢åŠ¨çš„æ•ˆæœ.</p><p>æˆ‘ä»¬å°†ä¼šä½¿ç”¨ä¸€ä¸ªç”±å™ªå£°çº¹ç†å¾—åˆ°çš„æ³•çº¿è´´å›¾,å®ç°ä¸€ä¸ªåŒ…å«è²æ¶…è€³åå°„çš„æ°´é¢æ•ˆæœ.</p><p>æˆ‘ä»¬ä½¿ç”¨ä¸€å¼ ç«‹æ–¹ä½“çº¹ç†ä½œä¸ºç¯å¢ƒçº¹ç†,æ¨¡æ‹Ÿåå°„.ä¸ºäº†æ¨¡æ‹ŸæŠ˜å°„æ•ˆæœ,æˆ‘ä»¬ä½¿ç”¨GrabPassæ¥è·å–å½“å‰å±å¹•çš„æ¸²æŸ“çº¹ç†,å¹¶ä½¿ç”¨åˆ‡çº¿ç©ºé—´ä¸‹çš„æ³•çº¿æ–¹å‘å¯¹åƒç´ çš„å±å¹•åæ ‡è¿›è¡Œåç§»,å†ä½¿ç”¨è¯¥åæ ‡å¯¹æ¸²æŸ“çº¹ç†è¿›è¡Œçº¹ç†é‡‡æ ·,ä»è€Œæ¨¡æ‹Ÿè¿‘ä¼¼æŠ˜å°„çš„æ•ˆæœ. ä¸ä¹‹å‰å®ç°ä¸åŒçš„æ˜¯,æ°´æ³¢çš„æ³•çº¿çº¹ç†æ˜¯ç”±ä¸€å¼ å™ªå£°çº¹ç†ç”Ÿæˆè€Œå¾—,è€Œä¸”ä¼šéšç€æ—¶é—´å˜åŒ–ä¸æ–­å¹³ç§»,æ¨¡æ‹Ÿæ³¢å…‰ç²¼ç²¼çš„æ•ˆæœ.é™¤æ­¤ä¹‹å¤–,æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ä¸€ä¸ªå®šå€¼æ¥æ··åˆåå°„å’ŒæŠ˜å°„çš„é¢œè‰²,è€Œæ˜¯ä½¿ç”¨ä¹‹å‰æåˆ°çš„è²æ¶…è€³ç³»æ•°æ¥åŠ¨æ€å†³å®šæ··åˆç³»æ•°.æˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹å…¬å¼æ¥è®¡ç®—è²æ¶…è€³ç³»æ•°:<br>$$ fresnel=pow(1 - max(0, v \cdot n), 4)$$<br>å…¶ä¸­,vå’Œnåˆ†åˆ«å¯¹åº”äº†è§†è§’æ–¹å‘å’Œæ³•çº¿æ–¹å‘. å®ƒä»¬ä¹‹é—´çš„å¤¹è§’è¶Šå°,fresnelå€¼è¶Šå°, åå°„è¶Šå¼±, æŠ˜å°„è¶Šå¼º. è²æ¶…è€³ç³»æ•°è¿˜ç»å¸¸ä¼šç”¨äºè¾¹ç¼˜å…‰ç…§çš„è®¡ç®—ä¸­.</p>]]></content>
      
      
      <categories>
          
          <category> UnityShader </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity </tag>
            
            <tag> Shader </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¯»ä¹¦ç¬”è®°â€”â€”ä¹”å¸ƒæ–¯ä¼ </title>
      <link href="/posts/e27b9cd3/"/>
      <url>/posts/e27b9cd3/</url>
      
        <content type="html"><![CDATA[<ul><li>åªæœ‰ç–¯ç‹‚åˆ°è®¤ä¸ºè‡ªå·±å¯ä»¥æ”¹å˜ä¸–ç•Œçš„äººï¼Œæ‰èƒ½çœŸæ­£æ”¹å˜ä¸–ç•Œ â€”â€” è‹¹æœ1997å¹´å¹¿å‘Š â€œéåŒå‡¡æƒ³â€</li><li>ä»–è¯´ï¼šâ€œæˆ‘å°æ—¶å€™ä¸€ç›´è§‰å¾—è‡ªå·±æ˜¯ä¸€ä¸ªåæ–‡è‰ºçš„äººï¼Œä½†ä¹Ÿå–œæ¬¢ç”µå­çš„ä¸œè¥¿ã€‚åæ¥ï¼Œæˆ‘è¯»åˆ°å®ä¸½æ¥åˆ›å§‹äººåŸƒå¾·æ¸©Â·å…°å¾·(Edwin Land)çš„ä¸€æ®µè¯ã€‚ä»–è¯´ï¼Œèƒ½ç«™åœ¨äººæ–‡ä¸ç§‘æŠ€çš„äº¤æ±‡å¤„ï¼Œå–ä¸¤è€…ä¹‹é•¿çš„äººï¼Œæ‰æ˜¯ç¤¾ä¼šçš„ä¸­æµç ¥æŸ±ã€‚ä»–æ˜¯æˆ‘çš„å¶åƒï¼Œæˆ‘å½“æ—¶å°±ç«‹å¿—è¦æˆä¸ºè¿™æ ·çš„äººã€‚â€</li><li>æ¿€å‘çƒ­æƒ…ï¼Œå†…å‘æ¢ç´¢ï¼Œè„±ç¦»ä½“åˆ¶(turn on, tune in, drop out)</li><li>é©¬åº“æ‹‰åœ¨ä¸€é¡µçº¸ä¸Šå†™ä¸‹äº†ä¸€ç¯‡åä¸ºã€Šè‹¹æœè¥é”€å“²å­¦ã€‹çš„æ–‡ç« ï¼Œå¼ºè°ƒäº†è¥é”€æ–‡å­¦çš„ä¸‰ä¸ªè¦ç‚¹ã€‚ç¬¬ä¸€ç‚¹æ˜¯â€œå…±é¸£â€ï¼Œå°±æ˜¯è¦è®¾èº«å¤„åœ°ä¸ºç”¨æˆ·ç€æƒ³ã€‚â€œæˆ‘ä»¬ä¼šæ¯”å…¶ä»–ä»»ä½•ä¼ä¸šéƒ½æ›´åŠ å……åˆ†åœ°äº†è§£ç”¨æˆ·éœ€æ±‚ã€‚â€ç¬¬äºŒç‚¹æ˜¯â€œä¸“æ³¨â€ï¼Œâ€œä¸ºäº†å‡ºè‰²å®Œæˆæ—¢å®šç›®æ ‡ï¼Œæˆ‘ä»¬å¿…é¡»å¿ƒæ— æ—éª›ï¼Œæ”¾å¼ƒæ‰€æœ‰æ— å…³ç´§è¦åœ°å¿ƒæ€å’Œè¿½æ±‚ã€‚â€ç¬¬ä¸‰ç‚¹åŒæ ·é‡è¦ï¼Œå«åšâ€œçŒè¾“â€ï¼Œå…¶ä¸­å¿ƒæ€æƒ³æ˜¯äººä»¬å¯¹ä¸€ä¸ªå…¬å¸æˆ–äº§å“çš„å°è±¡åŸºäºå…¶å¯¹å¤–ä¼ é€’çš„ä¿¡å·ã€‚ä»–å†™é“ï¼šâ€œæ¶ˆè´¹è€…çš„ç¡®ä¼šä»¥è²Œå–ç‰©ã€‚å³ä½¿æˆ‘ä»¬æ‹¥æœ‰æœ€å¥½çš„äº§å“ã€æœ€ä½³çš„å“è´¨å’Œæœ€å¼ºå¤§çš„è½¯ä»¶ï¼Œä½†æ˜¯å¦‚æœäº§å“çš„å‘ˆç°æ–¹å¼ç²—ç³™æ•·è¡ï¼Œäººä»¬å°±ä¼šè®¤ä¸ºæˆ‘ä»¬çš„äº§å“å’ŒæœåŠ¡ä¹Ÿæ˜¯è‰è‰äº†äº‹ï¼›å¦‚æœæˆ‘ä»¬ä»¥ä¸€ç§å……æ»¡åˆ›æ„ã€ä¸“ä¸šè®¤çœŸçš„æ€åº¦è¿›è¡Œå‘ˆç°ï¼Œæ¶ˆè´¹è€…å°±ä¼šè¢«æˆ‘ä»¬ä¼ é€’å’ŒçŒè¾“çš„ç§¯æä¿¡æ¯æµ¸æŸ“æ¸—é€ï¼Œæˆ‘ä»¬çš„å½¢è±¡å°±ä¼šåœ¨å®ƒä»¬çš„æ„è¯†å½“ä¸­ç¡®ç«‹èµ·æ¥ã€‚â€</li><li>æœ€ç»ˆçš„è®¾è®¡æ–¹æ¡ˆæ•²å®šåï¼Œä¹”å¸ƒæ–¯æŠŠéº¦é‡‘å¡”ç”µè„‘å›¢é˜Ÿçš„æˆå‘˜éƒ½å¬é›†åˆ°ä¸€èµ·ï¼Œä¸¾è¡Œäº†ä¸€ä¸ªä»ªå¼ã€‚ä»–è¯´ï¼šâ€œçœŸæ­£çš„è‰ºæœ¯å®¶éƒ½ä¼šåœ¨ä½œå“ä¸Šç­¾ä¸Šåå­—ã€‚â€äºæ˜¯ä»–æ‹¿å‡ºä¸€å¼ ç»˜å›¾çº¸å’Œä¸€åªä¸‰å¹…ç¬”ï¼Œè®©æ‰€æœ‰äººéƒ½ç­¾ä¸Šäº†è‡ªå·±çš„åå­—ã€‚è¿™äº›åå­—è¢«åˆ»åœ¨äº†æ¯ä¸€å°éº¦é‡‘å¡”ç”µè„‘çš„å†…éƒ¨ã€‚é™¤äº†ç»´ä¿®ç”µè„‘çš„äººï¼Œæ²¡æœ‰äººä¼šçœ‹åˆ°è¿™äº›åå­—ã€‚ä½†å›¢é˜Ÿé‡Œçš„æ¯ä¸€ä¸ªæˆå‘˜éƒ½çŸ¥é“åœ¨å“ªé‡Œæœ‰è‡ªå·±çš„åå­—ï¼Œå°±å¦‚åŒæ¯ä¸ªäººéƒ½çŸ¥é“é‚£é‡Œé¢çš„ç”µè·¯æ¿å·²ç»è¢«è®¾è®¡å¾—å°½å–„å°½ç¾äº†ã€‚ä¹”å¸ƒæ–¯ä¸€ä¸ªä¸€ä¸ªå«å‡ºå¤§å®¶çš„åå­—ï¼Œè®©ä»–ä»¬ç­¾åã€‚ä¼¯å‹’å°”Â·å²å¯†æ–¯æ˜¯ç¬¬ä¸€ä¸ªã€‚ä¹”å¸ƒæ–¯ç­‰åˆ°äº†æœ€åï¼Œå…¶ä»–45ä¸ªäººéƒ½ç­¾è¿‡ååï¼Œä»–åœ¨å›¾çº¸çš„æ­£ä¸­é—´æ‰¾åˆ°äº†ä¸€ä¸ªä½ç½®ï¼Œç”¨å°å†™å­—æ¯æ½‡æ´’åœ°ç­¾ä¸‹äº†è‡ªå·±çš„åå­—ã€‚ç„¶åä»–ä»¥é¦™æ§Ÿå‘å¤§å®¶ç¥é…’ã€‚â€œåœ¨è¿™æ ·çš„æ—¶åˆ»ï¼Œä»–è®©æˆ‘ä»¬è§‰å¾—è‡ªå·±çš„æˆæœå°±æ˜¯è‰ºæœ¯å“ã€‚â€é˜¿ç‰¹é‡‘æ£®è¯´ã€‚â€”â€”åä¸‰ç«  åˆ¶é€ </li><li>ä½ çš„æƒ³æ³•ä¼šåœ¨è‡ªå·±çš„å¤´è„‘ä¸­åˆ›å»ºå‡ºæ¨¡å¼ï¼Œå°±åƒè„šæ‰‹æ¶ä¸€æ ·ã€‚å¤§è„‘ä¸­çš„åŒ–å­¦ååº”èš€åˆ»å‡ºæ€ç»´çš„æ¨¡å¼ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œäººä»¬ä¼šé™·å…¥è¿™äº›æ¨¡å¼ï¼Œå°±åƒå”±ç‰‡ä¸Šçš„é’ˆæ§½ï¼Œå¹¶ä¸”å†ä¹Ÿå‡ºä¸æ¥äº†ã€‚<br>æˆ‘ä¼šæ°¸è¿œä¿æŒä¸è‹¹æœçš„å…³ç³»ã€‚æˆ‘å¸Œæœ›è¿™ä¸€ç”Ÿï¼Œèƒ½è®©è‡ªå·±çš„ç”Ÿå‘½å†ç¨‹å’Œè‹¹æœçš„å‘½è¿å½¼æ­¤äº¤é”™ï¼Œå°±åƒç¼–ç»‡ä¸€å‰¯æŒ‚æ¯¯ä¸€æ ·ï¼Œå¯èƒ½æˆ‘ä¼šç¦»å¼€è‹¹æœå‡ å¹´ï¼Œä½†æˆ‘ç»ˆç©¶æ˜¯ä¼šå›æ¥çš„ã€‚è¿™å°±æ˜¯æˆ‘å¯èƒ½æƒ³è¦åšçš„äº‹æƒ…ã€‚<br>å¦‚æœä½ å¸Œæœ›åƒè‰ºæœ¯å®¶ä¸€æ ·ï¼Œå……æ»¡åˆ›é€ åŠ›åœ°åº¦è¿‡æ­¤ç”Ÿï¼Œå°±ä¸èƒ½æ²‰æººäºè¿‡å¾€ï¼Œæ— è®ºä»¥å‰ä½ æ˜¯è°ï¼Œä½ åšè¿‡ä»€ä¹ˆï¼Œä½ éƒ½å¿…é¡»æ¬£ç„¶æ¥å—ï¼Œæ·¡ç„¶æ”¾æ‰‹ï¼Œç„¶åæ¯…ç„¶å†³ç„¶åœ°è½»è£…å‰è¡Œã€‚<br>å¤–ç•Œè¶Šæ˜¯è¯•å›¾å›ºåŒ–ä½ çš„å½¢è±¡ï¼Œä½ å°±è¶Šéš¾ç»§ç»­ä¿æŒè‰ºæœ¯å®¶çš„åˆå¿ƒã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¾ˆå¤šæ—¶å€™ï¼Œè‰ºæœ¯å®¶ä¸å¾—ä¸è¯´â€œå†è§äº†ï¼Œæˆ‘å¿…é¡»ç¦»å¼€ï¼Œæˆ‘å¿«è¢«é€¼ç–¯äº†ï¼Œå¿…é¡»é€ƒå‡ºç°å®çš„ç‰¢ç¬¼ã€‚â€ç„¶åä»–ä»¬ä¼šæŒ¥æ‰‹å‘Šåˆ«ï¼Œæ‰¾ä¸ªåœ°æ–¹è—è¡Œéšè¿¹ï¼Œé—­å…³æ½œä¿®ã€‚ä¹Ÿè®¸è¿‡ä¸€æ®µæ—¶é—´ï¼Œä»–ä»¬ä¼šé‡å‡ºæ±Ÿæ¹–ï¼Œä½†ä¼šè·Ÿä»¥å¾€æœ‰æ‰€ä¸åŒã€‚</li><li>è‡³ç¹å½’äºè‡³ç®€</li><li>æˆ‘çš„åŠ¨åŠ›æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘è§‰å¾—ï¼Œå¤§å¤šæ•°åˆ›é€ è€…éƒ½æƒ³ä¸ºæˆ‘ä»¬èƒ½å¤Ÿå¾—ç›Šäºå‰äººå–å¾—çš„æˆå°±è€Œè¡¨è¾¾æ„Ÿæ¿€ã€‚æˆ‘å¹¶æ²¡æœ‰å‘æ˜æˆ‘çš„è¯­è¨€æˆ–æ•°å­¦ã€‚æˆ‘çš„é£Ÿç‰©åŸºæœ¬ä¸æ˜¯æˆ‘è‡ªå·±åšçš„ï¼Œè¡£æœæ›´æ˜¯ä¸€ä»¶éƒ½æ²¡åšè¿‡ã€‚æˆ‘æ‰€åšçš„æ¯ä¸€ä»¶äº‹éƒ½æœ‰èµ–äºæˆ‘ä»¬äººç±»çš„å…¶ä»–æˆå‘˜ï¼Œä»¥åŠä»–ä»¬çš„è´¡çŒ®å’Œæˆå°±ã€‚æˆ‘ä»¬å¾ˆå¤šäººéƒ½æƒ³å›é¦ˆç¤¾ä¼šï¼Œåœ¨å†å²é•¿æ²³ä¸­å†æ·»ä¸€ç¬”ã€‚æˆ‘ä»¬åªèƒ½ç”¨è¿™ç§å¤§å¤šæ•°äººéƒ½æŒæ¡çš„æ–¹å¼å»è¡¨è¾¾â€”â€”å› ä¸ºæˆ‘ä»¬ä¸ä¼šå†™é²å‹ƒè¿ªä¼¦çš„æ­Œæˆ–æ±¤å§†æ–¯æ‰˜å¸•å¾·çš„æˆå‰§ã€‚æˆ‘ä»¬è¯•å›¾ç”¨æˆ‘ä»¬ä»…æœ‰çš„å¤©åˆ†å»è¡¨è¾¾æˆ‘ä»¬æ·±å±‚çš„æ„Ÿå—ï¼Œå»è¡¨è¾¾æˆ‘ä»¬å¯¹å‰äººæ‰€æœ‰è´¡çŒ®çš„æ„Ÿæ¿€ï¼Œè¶£å‘³å†å²é•¿æ²³åŠ ä¸Šç‚¹ä»€ä¹ˆã€‚è¿™å°±æ˜¯æ¨åŠ¨æˆ‘çš„åŠ›é‡ã€‚</li><li>ã€Šè™«è™«å±æœºã€‹æ‰“è´¥äº†ã€Šå°èšé›„å…µã€‹ï¼Œä½†æ¯”ç¥¨æˆ¿æ›´é‡è¦çš„æ˜¯ï¼Œè¿™éƒ¨ç”µå½±è®©çš®å…‹æ–¯è¯æ˜äº†è‡ªå·±ä¸æ˜¯ä¸€å®¶æ˜™èŠ±ä¸€ç°çš„å…¬å¸ã€‚ã€Šè™«è™«å±æœºã€‹çš„ç¥¨æˆ¿æˆç»©å¯ä»¥åª²ç¾ã€Šç©å…·æ€»åŠ¨å‘˜ã€‹ï¼Œè¯æ˜çš®å…‹æ–¯å½“åˆçš„æ——å¼€å¾—èƒœå¹¶éä¾¥å¹¸ã€‚ä¹”å¸ƒæ–¯åæ¥è¯´ï¼šâ€œå•†ä¸šé¢†åŸŸå­˜åœ¨ä¸€ä¸ªç»å…¸çš„ç°è±¡ï¼Œå«åšâ€˜ç¬¬äºŒäº§å“ç»¼åˆç—‡â€™ã€‚â€æ„æ€æ˜¯è¯´ï¼Œäººä»¬å› ä¸ºæ²¡æœ‰ç†è§£ç¬¬ä¸€ä»¶äº§å“æˆåŠŸçš„çœŸæ­£åŸå› ï¼Œæ‰€ä»¥åšå‡ºçš„ç¬¬äºŒä¸ªäº§å“å¾€å¾€æ˜¯å¤±è´¥çš„ã€‚â€œæˆ‘åœ¨è‹¹æœå°±ç»å†è¿‡è¿™ç§æƒ…å†µã€‚æˆ‘å½“æ—¶è§‰å¾—ï¼Œå¦‚æœæˆ‘ä»¬çš„ç¬¬äºŒéƒ¨ç”µå½±èƒ½å¤Ÿç»å—ä½è€ƒéªŒï¼Œçš®å…‹æ–¯å°±èƒ½ç«‹ä½è„šäº†ã€‚â€</li><li>è®°ä½è‡ªå·±å°†ä¸ä¹…äºäººä¸–ï¼Œæ˜¯æˆ‘é¢å¯¹äººç”Ÿé‡å¤§æŠ‰æ‹©æ—¶æœ€é‡è¦çš„èˆªæ ‡ã€‚å› ä¸ºå‡ ä¹æ‰€æœ‰ä¸œè¥¿â€”â€”å¤–ç•Œçš„æœŸå¾…ã€éª„å‚²ã€å¯¹çª˜è¿«æˆ–å¤±è´¥çš„ææƒ§â€”â€”åœ¨æ­»äº¡é¢å‰éƒ½ä¼šçƒŸæ¶ˆäº‘æ•£ï¼Œåªä¼šç•™ä¸‹çœŸæ­£é‡è¦çš„ä¸œè¥¿ã€‚æ—¶åˆ»é“­è®°äººç»ˆæœ‰ä¸€æ­»ï¼Œæ˜¯æˆ‘çŸ¥é“çš„é¿å…æ‚£å¾—æ‚£å¤±é™·é˜±çš„æœ€ä½³æ–¹å¼ã€‚äººèµ¤æ¡æ¡åœ°æ¥ï¼Œå†èµ¤æ¡æ¡åœ°èµ°ã€‚æ—¢ç„¶ç”Ÿä¸å¸¦æ¥ï¼Œæ­»ä¸å¸¦å»ï¼Œå°±æ²¡æœ‰ä»€ä¹ˆç†ç”±ä¸è¿½éšå†…å¿ƒã€‚</li><li>å‘ç–¯ç‹‚äººå£«è‡´æ•¬ã€‚ä»–ä»¬ç‰¹ç«‹ç‹¬è¡Œã€‚ä»–ä»¬æ¡€éªœä¸é©¯ã€‚ä»–ä»¬æƒ¹æ˜¯ç”Ÿéã€‚ä»–ä»¬æ–¹æ˜åœ†å‡¿ã€‚ä»–ä»¬çœ¼å…‰ç‹¬åˆ°ã€‚ä»–ä»¬è®¨åŒæ¡æ¡æ¡†æ¡†ã€‚ä»–ä»¬ä¸å±‘å®‰äºç°çŠ¶ã€‚ä½ å¯ä»¥æŠŠä»–ä»¬çš„è¯è¯­å¼•ä½œç»å…¸ï¼Œä¹Ÿå¯ä»¥åå¯¹ä»–ä»¬çš„è§‚ç‚¹ï¼Œä½ å¯ä»¥é¢‚æ‰¬ä»–ä»¬ï¼Œä¹Ÿå¯ä»¥è´¬æŸä»–ä»¬ï¼Œä½†å”¯ç‹¬ä¸èƒ½å¿½è§†ä»–ä»¬ã€‚å› ä¸ºä»–ä»¬å¸¦æ¥äº†æ”¹å˜ã€‚ä»–ä»¬æ¨åŠ¨äº†äººç±»ä¸æ–­å‘å‰ã€‚ä»–ä»¬æˆ–è®¸æ˜¯åˆ«äººçœ¼é‡Œçš„ç–¯å­ï¼Œä½†ç¡®æ˜¯æˆ‘ä»¬å¿ƒä¸­çš„å¤©æ‰ã€‚åªæœ‰ç–¯ç‹‚åˆ°è®¤ä¸ºè‡ªå·±å¯ä»¥æ”¹å˜ä¸–ç•Œçš„äººï¼Œæ‰èƒ½çœŸæ­£æ”¹å˜ä¸–ç•Œã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> è¯»ä¸‡å·ä¹¦ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>UnityShaderå…¥é—¨ç²¾è¦ç¬”è®°-ï¼ˆåå››ï¼‰-éçœŸå®æ„Ÿæ¸²æŸ“</title>
      <link href="/posts/8d920ebf/"/>
      <url>/posts/8d920ebf/</url>
      
        <content type="html"><![CDATA[<p>å°½ç®¡æ¸¸æˆæ¸²æŸ“ä¸€èˆ¬æ˜¯ä»¥ç…§ç›¸å†™å®ä¸»ä¹‰(photorealism)ä½œä¸ºä¸»è¦ç›®æ ‡ï¼Œä½†ä¹Ÿæœ‰å¾ˆå¤šæ¸¸æˆä½¿ç”¨äº†éçœŸå®æ„Ÿæ¸²æŸ“(Non-PhotorealisticRendering, NPR)çš„æ–¹æ³•æ¥æ¸²æŸ“æ¸¸æˆç”»é¢ã€‚éçœŸå®æ„Ÿæ¸²æŸ“çš„ä¸€ä¸ªä¸»è¦ç›®æ ‡æ˜¯ï¼Œä½¿ç”¨ä¸€äº›æ¸²æŸ“æ–¹æ³•ä½¿å¾—ç”»é¢è¾¾åˆ°å’ŒæŸäº›ç‰¹æ®Šçš„ç»˜ç”»é£æ ¼ç›¸ä¼¼çš„æ•ˆæœï¼Œä¾‹å¦‚å¡é€šã€æ°´å½©é£æ ¼ç­‰ã€‚</p><p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šä»‹ç»ä¸¤ç§å¸¸è§çš„éçœŸå®æ„Ÿæ¸²æŸ“æ–¹æ³•ã€‚14.1èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šå­¦ä¹ å¦‚ä½•å®ç°ä¸€ä¸ªåŒ…å«ç®€å•æ¼«åå°„ã€é«˜å…‰å’Œæè¾¹çš„å¡é€šé£æ ¼çš„æ¸²æŸ“æ•ˆæœã€‚14.2èŠ‚å°†ä¼šä»‹ç»ä¸€ç§å®æ—¶ç´ ææ•ˆæœçš„å®ç°ã€‚åœ¨æœ¬ç« çš„æœ€åï¼Œæˆ‘ä»¬è¿˜ä¼šç»™å‡ºä¸€äº›å…³äºéçœŸå®æ„Ÿæ¸²æŸ“çš„èµ„æ–™ï¼Œè¯»è€…å¯ä»¥åœ¨è¿™äº›æ–‡çŒ®ä¸­æ‰¾åˆ°æ›´å¤šéçœŸå®æ„Ÿæ¸²æŸ“çš„å®ç°æ–¹æ³•ã€‚</p><h1>å¡é€šé£æ ¼çš„æ¸²æŸ“</h1><p>å¡é€šé£æ ¼æ˜¯æ¸¸æˆä¸­å¸¸è§çš„ä¸€ç§æ¸²æŸ“é£æ ¼ã€‚ä½¿ç”¨è¿™ç§é£æ ¼çš„æ¸¸æˆç”»é¢é€šå¸¸æœ‰ä¸€äº›å…±åŒçš„ç‰¹ç‚¹ï¼Œæ¯”å¦‚ç‰©ä½“éƒ½è¢«é»‘è‰²çš„çº¿æ¡æè¾¹ï¼Œä»¥åŠåˆ†æ˜çš„æ˜æš—å˜åŒ–ç­‰ã€‚ç”±æ—¥æœ¬å¡æ™®ç©ºæ ªå¼ä¼šç¤¾å¼€å‘çš„æ¸¸æˆã€Šå¤§ç¥ã€‹å°±ä½¿ç”¨äº†æ°´å¢¨+å¡é€šé£æ ¼æ¥æ¸²æŸ“æ•´ä¸ªç”»é¢ã€‚</p><img src="/posts/8d920ebf/image.png" class=""><p>è¦å®ç°å¡é€šæ¸²æŸ“æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œå…¶ä¸­ä¹‹ä¸€å°±æ˜¯ä½¿ç”¨åŸºäºè‰²è°ƒçš„ç€è‰²æŠ€æœ¯(tone-based shading)ã€‚Goochç­‰äººåœ¨ä»–ä»¬1998å¹´çš„ä¸€ç¯‡ç†è®ºæ–‡ä¸­æå‡ºå¹¶å®ç°äº†åŸºäºè‰²è°ƒçš„å…‰ç…§æ¨¡å‹ã€‚åœ¨å®ç°ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šä½¿ç”¨æ¼«åå°„ç³»æ•°å¯¹ä¸€å¼ ä¸€ç»´çº¹ç†è¿›è¡Œé‡‡æ ·ï¼Œä»¥æ§åˆ¶æ¼«åå°„çš„è‰²è°ƒã€‚æˆ‘ä»¬æ›¾åœ¨7.3èŠ‚ä½¿ç”¨æ¸å˜çº¹ç†å®ç°è¿‡è¿™æ ·çš„æ•ˆæœã€‚å¡é€šé£æ ¼çš„é«˜å…‰æ•ˆæœä¹Ÿå’Œæˆ‘ä»¬ä¹‹å‰å­¦ä¹ çš„å…‰ç…§ä¸åŒã€‚åœ¨å¡é€šé£æ ¼ä¸­ï¼Œæ¨¡å‹çš„é«˜å…‰å¾€å¾€æ˜¯ä¸€å—å—åˆ†ç•Œæ˜æ˜¾çš„çº¯è‰²åŒºåŸŸã€‚</p><p>é™¤äº†å…‰ç…§æ¨¡å‹ä¸ä¸€æ ·ï¼Œå¡é€šé£æ ¼é€šå¸¸è¿˜éœ€è¦åœ¨ç‰©ä½“è¾¹ç¼˜éƒ¨åˆ†ç»˜åˆ¶è½®å»“ã€‚åœ¨ä¹‹å‰çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ›¾ä»‹ç»ä½¿ç”¨å±å¹•åå¤„ç†æŠ€æœ¯å¯¹å±å¹•å›¾åƒè¿›è¡Œæè¾¹ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šä»‹ç»åŸºäºæ¨¡å‹çš„æè¾¹æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•çš„å®ç°æ›´åŠ ç®€å•ï¼Œè€Œä¸”åœ¨å¾ˆå¤šæƒ…å†µä¸‹ä¹Ÿèƒ½å¾—åˆ°ä¸é”™çš„æ•ˆæœã€‚åœ¨æœ¬èŠ‚ç»“æŸåæˆ‘ä»¬å°†å®ç°ç±»ä¼¼ä¸‹å›¾çš„æ•ˆæœã€‚</p><img src="/posts/8d920ebf/image-1.png" class=""><h2 id="æ¸²æŸ“è½®å»“çº¿">æ¸²æŸ“è½®å»“çº¿</h2><p>åœ¨å®æ—¶æ¸²æŸ“ä¸­ï¼Œè½®å»“çº¿çš„æ¸²æŸ“æ˜¯åº”ç”¨éå¸¸å¹¿æ³›çš„ä¸€ç§æ•ˆæœã€‚è¿‘20å¹´æ¥ï¼Œæœ‰è®¸å¤šç»˜åˆ¶æ¨¡å‹è½®å»“çº¿çš„æ–¹æ³•è¢«å…ˆåæå‡ºæ¥ã€‚åœ¨ã€ŠReal Time Rendering, third editionã€‹ä¸€ä¹¦ä¸­ï¼Œä½œè€…æŠŠè¿™äº›æ–¹æ³•åˆ†æˆäº†äº”ç§ç±»å‹ã€‚</p><ul><li>åŸºäºè§‚å¯Ÿè§’åº¦å’Œè¡¨é¢æ³•çº¿çš„è½®å»“çº¿æ¸²æŸ“ã€‚è¿™ç§æ–¹æ³•ä½¿ç”¨è§†è§’æ–¹å‘å’Œè¡¨é¢æ³•çº¿çš„ç‚¹ä¹˜ç»“æœæ¥å¾—åˆ°è½®å»“çº¿çš„ä¿¡æ¯ã€‚è¿™ç§æ–¹æ³•ç®€å•å¿«é€Ÿï¼Œå¯ä»¥åœ¨ä¸€ä¸ªPassä¸­å°±å¾—åˆ°æ¸²æŸ“ç»“æœï¼Œä½†æ˜¯å±€é™æ€§å¾ˆå¤§ï¼Œå¾ˆå¤šæ¨¡å‹æ¸²æŸ“å‡ºæ¥çš„æè¾¹æ•ˆæœéƒ½ä¸å°½å¦‚äººæ„ã€‚</li><li>è¿‡ç¨‹å¼å‡ ä½•è½®å»“çº¿æ¸²æŸ“ã€‚è¿™ç§æ–¹æ³•çš„æ ¸å¿ƒæ˜¯ä½¿ç”¨ä¸¤ä¸ªPassæ¸²æŸ“ï¼Œç¬¬ä¸€ä¸ªPassæ¸²æŸ“èƒŒé¢çš„é¢ç‰‡ï¼Œå¹¶ä½¿ç”¨æŸäº›æŠ€æœ¯è®©å®ƒçš„è½®å»“å¯è§ï¼›ç¬¬äºŒä¸ªPasså†æ­£å¸¸æ¸²æŸ“æ­£é¢çš„é¢ç‰‡ã€‚è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹åœ¨äºå¿«é€Ÿæœ‰æ•ˆï¼Œå¹¶ä¸”é€‚ç”¨äºç»å¤§å¤šæ•°è¡¨é¢å¹³æ»‘çš„æ¨¡å‹ï¼Œä½†å®ƒçš„ç¼ºç‚¹æ˜¯ä¸é€‚åˆç±»ä¼¼äºç«‹æ–¹ä½“è¿™ç§å¹³æ•´çš„æ¨¡å‹ã€‚</li><li>åŸºäºå›¾åƒå¤„ç†çš„è½®å»“çº¿æ¸²æŸ“ã€‚æˆ‘ä»¬åœ¨12ã€13ç« ä»‹ç»çš„è¾¹ç¼˜æ£€æµ‹çš„æ–¹æ³•å°±å±äºè¿™ä¸ªç±»åˆ«ã€‚è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹åœ¨äºï¼Œå¯ä»¥é€‚ç”¨äºä»»ä½•ç§ç±»çš„æ¨¡å‹ã€‚ä½†å®ƒä¹Ÿæœ‰è‡ªèº«çš„å±€é™æ‰€åœ¨ï¼Œä¸€äº›æ·±åº¦å’Œæ³•çº¿å˜åŒ–å¾ˆå°çš„è½®å»“æ— æ³•è¢«æ£€æµ‹å‡ºæ¥ï¼Œä¾‹å¦‚æ¡Œå­ä¸Šçš„çº¸å¼ ã€‚</li><li>åŸºäºè½®å»“è¾¹ç¼˜æ£€æµ‹çš„è½®å»“çº¿æ¸²æŸ“ã€‚ä¸Šé¢æåˆ°çš„å„ç§æ–¹æ³•ï¼Œä¸€ä¸ªæœ€å¤§çš„é—®é¢˜æ˜¯ï¼Œæ— æ³•æ§åˆ¶è½®å»“çº¿çš„é£æ ¼æ¸²æŸ“ã€‚å¯¹äºä¸€äº›æƒ…å†µï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥æ¸²æŸ“å‡ºç‹¬ç‰¹çš„è½®å»“çº¿ï¼Œä¾‹å¦‚æ°´å¢¨é£æ ¼ç­‰ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥æ£€æµ‹å‡ºç²¾ç¡®çš„è½®å»“è¾¹ï¼Œç„¶åç›´æ¥æ¸²æŸ“å®ƒä»¬ã€‚æ£€æµ‹ä¸€æ¡è¾¹æ˜¯å¦æ˜¯è½®å»“è¾¹çš„å…¬å¼å¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦æ£€æŸ¥å’Œè¿™æ¡è¾¹ç›¸é‚»çš„ä¸¤ä¸ªä¸‰è§’é¢ç‰‡æ˜¯å¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š<br>$$(n_0 \cdot v &gt; 0) \neq (n_1 \cdot v &gt; 0) $$</li></ul><p>å…¶ä¸­ï¼Œ$n_0$å’Œ$n_1$åˆ†åˆ«è¡¨ç¤ºä¸¤ä¸ªç›¸é‚»ä¸‰è§’é¢ç‰‡çš„æ³•å‘ï¼Œvæ˜¯ä»è§†è§’åˆ°è¯¥è¾¹å±±ä»»æ„é¡¶ç‚¹çš„æ–¹å‘ã€‚ä¸Šè¿°å…¬å¼çš„æœ¬è´¨åœ¨äºæ£€æŸ¥ä¸¤ä¸ªç›¸é‚»çš„ä¸‰è§’é¢ç‰‡æ˜¯å¦ä¸€ä¸ªæœæ­£é¢ã€ä¸€ä¸ªæœèƒŒé¢ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å‡ ä½•ç€è‰²å™¨(Geometry Shader)çš„å¸®åŠ©ä¸‹å®ç°ä¸Šé¢çš„æ£€æµ‹è¿‡ç¨‹ã€‚å½“ç„¶ï¼Œè¿™ç§æ–¹æ³•ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œé™¤äº†å®ç°ç›¸å¯¹å¤æ‚å¤–ï¼Œå®ƒè¿˜ä¼šæœ‰åŠ¨ç”»è¿è´¯æ€§çš„é—®é¢˜ã€‚ä¹Ÿå°±æ˜¯è¯´ç”±äºæ˜¯é€å¸§å•ç‹¬æå–è½®å»“ï¼Œæ‰€ä»¥åœ¨å¸§ä¸å¸§ä¹‹é—´ä¼šå‡ºç°è·³è·ƒæ€§ã€‚</p><ul><li>æœ€åä¸€ä¸ªç§ç±»å°±æ˜¯æ··åˆäº†ä¸Šè¿°çš„å‡ ç§æ¸²æŸ“æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œé¦–å…ˆæ‰¾åˆ°ç²¾ç¡®çš„è½®å»“è¾¹ï¼ŒæŠŠæ¨¡å‹å’Œè½®å»“è¾¹æ¸²æŸ“åˆ°çº¹ç†ä¸­ï¼Œå†ä½¿ç”¨å›¾åƒå¤„ç†çš„æ–¹æ³•è¯†åˆ«å‡ºè½®å»“çº¿ï¼Œå¹¶åœ¨å›¾åƒç©ºé—´ä¸‹è¿›è¡Œé£æ ¼åŒ–æ¸²æŸ“ã€‚</li></ul><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šåœ¨Unityä¸­ä½¿ç”¨è¿‡ç¨‹å¼å‡ ä½•è½®å»“çº¿æ¸²æŸ“æ–¹æ³•æ¥å¯¹æ¨¡å‹è¿›è¡Œè½®å»“æè¾¹ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸¤ä¸ªPassæ¸²æŸ“æ¨¡å‹ï¼šåœ¨ç¬¬ä¸€ä¸ªPassä¸­æˆ‘ä»¬ä¼šä½¿ç”¨è½®å»“çº¿é¢œè‰²æ¸²æŸ“æ•´ä¸ªèƒŒé¢çš„å›¾ç‰‡ï¼Œå¹¶åœ¨è§†è§’ç©ºé—´ä¸‹æŠŠæ¨¡å‹é¡¶ç‚¹æ²¿ç€æ³•çº¿æ–¹å‘å‘å¤–æ‰©å¼ ä¸€æ®µè·ç¦»ï¼Œä»¥æ­¤æ¥è®©èƒŒéƒ¨è½®å»“çº¿å¯è§ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">viewPos = viewPos + viewNormal * _Outline;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨é¡¶ç‚¹æ³•çº¿è¿›è¡Œæ‰©å±•ï¼Œå¯¹äºä¸€äº›å†…å‡¹çš„æ¨¡å‹ï¼Œå°±å¯èƒ½å‘ç”ŸèƒŒé¢é¢ç‰‡é®æŒ¡æ­£é¢é¢ç‰‡çš„æƒ…å†µã€‚ä¸ºäº†å°½å¯èƒ½é˜²æ­¢å‡ºç°è¿™æ ·çš„æƒ…å†µï¼Œåœ¨æ‰©å¼ èƒŒé¢é¡¶ç‚¹ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¹é¡¶ç‚¹æ³•çº¿çš„zåˆ†é‡è¿›è¡Œå¤„ç†ï¼Œä½¿å®ƒä»¬ç­‰äºä¸€ä¸ªå®šå€¼ï¼Œç„¶åæŠŠæ³•çº¿å½’ä¸€åŒ–åå†å¯¹é¡¶ç‚¹è¿›è¡Œæ‰©å¼ ã€‚è¿™æ ·çš„å¥½å¤„åœ¨äºï¼Œæ‰©å±•åçš„èƒŒé¢æ›´åŠ æ‰å¹³åŒ–ï¼Œä»è€Œé™ä½äº†é®æŒ¡æ­£é¢é¢ç‰‡çš„å¯èƒ½æ€§ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">viewNormal.z = -0.5;</span><br><span class="line">viewNormal = normalize(viewNormal);</span><br><span class="line">viewPos = viewPos + viewNormal * _Outline;</span><br></pre></td></tr></table></figure><h2 id="æ·»åŠ é«˜å…‰">æ·»åŠ é«˜å…‰</h2><p>å‰é¢æåˆ°è¿‡ï¼Œå¡é€šé£æ ¼ä¸­çš„é«˜å…‰å¾€å¾€æ˜¯æ¨¡å‹ä¸Šä¸€å—å—åˆ†ç•Œæ˜æ˜¾çš„çº¯è‰²åŒºåŸŸã€‚ä¸ºäº†å®ç°è¿™ç§æ•ˆæœï¼Œæˆ‘ä»¬å°±ä¸èƒ½å†ä½¿ç”¨ä¹‹å‰å­¦ä¹ çš„å…‰ç…§æ¨¡å‹ã€‚å›é¡¾ä¸€ä¸‹ï¼Œåœ¨ä¹‹å‰å®ç°Blinn-Phongæ¨¡å‹çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ³•çº¿ç‚¹ä¹˜å…‰ç…§æ–¹å‘ä»¥åŠè§†è§’æ–¹å‘çš„ä¸€åŠï¼Œå†å’Œå¦ä¸€ä¸ªå‚æ•°è¿›è¡ŒæŒ‡æ•°æ“ä½œå¾—åˆ°é«˜å…‰åå°„ç³»æ•°ã€‚ä»£ç å¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">float spec = pow(saturate(dot(normal, halfDir)), _Gloss)</span><br></pre></td></tr></table></figure><p>å¯¹äºå¡é€šæ¸²æŸ“éœ€è¦çš„é«˜å…‰åå°„å…‰ç…§æ¨¡å‹ï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦è®¡ç®—normalå’ŒhalfDirçš„ç‚¹ä¹˜ç»“æœï¼Œä½†æ˜¯ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬æŠŠè¯¥å€¼å’Œä¸€ä¸ªé˜ˆå€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå°äºè¯¥é˜ˆå€¼ï¼Œé‚£ä¹ˆé«˜å…‰åå°„ç³»æ•°å°±æ˜¯0ï¼Œå¦åˆ™è¿”å›1.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">float spec = dot(worldNormal, worldHalfDir);</span><br><span class="line">spec = step(threshold, spec);</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨CGçš„stepå‡½æ•°æ¥å®ç°å’Œé˜ˆå€¼æ¯”è¾ƒçš„ç›®çš„ã€‚stepå‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å‚è€ƒå€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¾…æ¯”è¾ƒçš„æ•°å€¼ã€‚å¦‚æœç¬¬äºŒä¸ªå‚æ•°å¤§äºç­‰äºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåˆ™è¿”å›1ï¼Œå¦åˆ™è¿”å›0ã€‚</p><p>ä½†æ˜¯è¿™ç§ç²—æš´çš„åˆ¤æ–­æ–¹æ³•ä¼šåœ¨é«˜å…‰åŒºåŸŸçš„è¾¹ç•Œé€ æˆé”¯é½¿ï¼Œå¦‚ä¸‹å›¾çš„å·¦å›¾æ‰€ç¤ºã€‚å‡ºç°è¿™ç§é—®é¢˜çš„åŸå› åœ¨äºï¼Œé«˜å…‰åŒºåŸŸçš„è¾¹ç¼˜ä¸æ˜¯å¹³æ»‘æ¸å˜çš„ï¼Œè€Œæ˜¯ç”±0çªå˜åˆ°1ã€‚æƒ³è¦å¯¹å…¶è¿›è¡ŒæŠ—é”¯é½¿å¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¾¹ç•Œå¤„å¾ˆå°çš„ä¸€å—åŒºåŸŸå†…ï¼Œè¿›è¡Œå¹³æ»‘å¤„ç†ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">float spec = dot(worldNormal, worldHalfDir);</span><br><span class="line">spec = lerp(0, 1, smoothstep(-w, w, spec - threshold));</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰åƒä¹‹å‰ä¸€æ ·ç›´æ¥ä½¿ç”¨stepå‡½æ•°è¿”å›0æˆ–1ï¼Œè€Œæ˜¯é¦–å…ˆä½¿ç”¨äº†CGçš„smoothstepå‡½æ•°ã€‚å…¶ä¸­wæ˜¯ä¸€ä¸ªå¾ˆå°çš„å€¼ï¼Œå½“spec - thresholdå°äº-wæ—¶ï¼Œè¿”å›0ï¼Œå¤§äºwæ—¶ï¼Œè¿”å›1ï¼Œå¦åˆ™åœ¨0åˆ°1ä¹‹é—´è¿›è¡Œå·®å€¼ã€‚è¿™æ ·çš„æ•ˆæœæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨[-w, w]åŒºé—´å†…ï¼Œå³é«˜å…‰åŒºåŸŸçš„è¾¹ç•Œå¤„ï¼Œå¾—åˆ°ä¸€ä¸ªä»0åˆ°1å¹³æ»‘å˜åŒ–çš„specå€¼ï¼Œä»è€Œå®ç°æŠ—é”¯é½¿çš„ç›®çš„ã€‚å°½ç®¡æˆ‘ä»¬å¯ä»¥æŠŠwè®¾ç½®ä¸ºä¸€ä¸ªå¾ˆå°çš„å®šå€¼ï¼Œä½†åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨é‚»åŸŸåƒç´ ä¹‹é—´çš„è¿‘ä¼¼å¯¼æ•°å€¼ï¼Œè¿™å¯ä»¥é€šè¿‡CGçš„fwidthå‡½æ•°æ¥å¾—åˆ°ã€‚</p><img src="/posts/8d920ebf/image-2.png" class=""><p>å½“ç„¶ï¼Œå¡é€šæ¸²æŸ“ä¸­çš„é«˜å…‰å¾€å¾€æœ‰æ›´è¿‡ä¸ªæ€§åŒ–çš„éœ€è¦ã€‚ä¾‹å¦‚ï¼Œå¾ˆå¤šå¡é€šé«˜å…‰ç‰¹æ•ˆå¸Œæœ›å¯ä»¥éšæ„ä¼¸ç¼©ã€æ–¹å—åŒ–å…‰ç…§åŒºåŸŸã€‚Anjyoç­‰äººåœ¨ä»–ä»¬2003å¹´çš„ä¸€ç¯‡è®ºæ–‡ä¸­ç»™å‡ºäº†ä¸€ç§é£æ ¼åŒ–çš„å¡é€šé«˜å…‰çš„å®ç°ã€‚å¯ä»¥åœ¨æœ¬ä¹¦ä½œè€…çš„<a href="http://blog.csdn.net/candycat1992/article/details/47284289">è¿™ç¯‡åšå®¢</a>ä¸­æ‰¾åˆ°è¿™ç§æ–¹æ³•åœ¨Unityä¸­çš„å®ç°</p><h2 id="å®ç°">å®ç°</h2><h1>ç´ æé£æ ¼çš„æ¸²æŸ“</h1><p>å¦ä¸€ä¸ªéå¸¸æµè¡Œçš„éçœŸå®æ„Ÿæ¸²æŸ“æ˜¯ç´ æé£æ ¼çš„æ¸²æŸ“ã€‚å¾®è½¯ç ”ç©¶é™¢çš„Praunç­‰äººåœ¨2001å¹´çš„SIGGRAPHä¸Šå‘è¡¨äº†ä¸€ç¯‡è‘—åçš„è®ºæ–‡ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä»–ä»¬ä½¿ç”¨äº†æå‰ç”Ÿæˆçš„ç´ æçº¹ç†æ¥å®ç°å®æ—¶çš„ç´ æé£æ ¼æ¸²æŸ“ï¼Œè¿™äº›çº¹ç†ç»„æˆäº†ä¸€ä¸ªè‰²è°ƒè‰ºæœ¯æ˜ å°„(Tonal Art Map, TAM)ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚åœ¨ä¸‹å›¾ä¸­ï¼Œä»å·¦åˆ°å³çº¹ç†ä¸­çš„ç¬”è§¦é€æ¸å¢å¤šï¼Œç”¨äºæ¨¡æ‹Ÿä¸åŒå…‰ç…§ä¸‹çš„æ¼«åå°„æ•ˆæœï¼Œä»ä¸Šåˆ°ä¸‹åˆ™å¯¹åº”äº†æ¯å¼ çº¹ç†çš„å¤šçº§æ¸è¿œçº¹ç†(mipmaps)ã€‚è¿™äº›å¤šçº§æ¸è¿œçº¹ç†çš„ç”Ÿæˆå¹¶ä¸æ˜¯ç®€å•çš„å¯¹ä¸Šä¸€çº§çº¹ç†è¿›è¡Œé™é‡‡æ ·ï¼Œè€Œæ˜¯éœ€è¦ä¿æŒç¬”è§¦ä¹‹é—´çš„é—´éš”ï¼Œä¸€è¾¹æ›´çœŸå®åœ°æ¨¡æ‹Ÿç´ ææ•ˆæœã€‚</p><img src="/posts/8d920ebf/image-3.png" class=""><p>æœ¬èŠ‚å°†ä¼šå®ç°ç®€åŒ–ç‰ˆçš„è®ºæ–‡ä¸­æå‡ºçš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸è€ƒè™‘å¤šçº§æ¸è¿œçº¹ç†çš„ç”Ÿæˆï¼Œè€Œç›´æ¥ä½¿ç”¨6å¼ ç´ æçº¹ç†è¿›è¡Œæ¸²æŸ“ã€‚åœ¨æ¸²æŸ“é˜¶æ®µï¼Œæˆ‘ä»¬é¦–å…ˆåœ¨é¡¶ç‚¹ç€è‰²å™¨é˜¶æ®µè®¡ç®—é€é¡¶ç‚¹çš„å…‰ç…§ï¼Œæ ¹æ®å…‰ç…§ç»“æœæ¥å†³å®šå…­å¼ çº¹ç†çš„æ··åˆæƒé‡ï¼Œå¹¶ä¼ é€’ç»™ç‰‡å…ƒç€è‰²å™¨ã€‚ç„¶åï¼Œåœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­æ ¹æ®è¿™äº›æƒé‡æ¥æ··åˆå…­å¼ çº¹ç†çš„é‡‡æ ·ç»“æœã€‚æœ¬èŠ‚è¿‡åï¼Œä¼šå¾—åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ•ˆæœã€‚</p><img src="/posts/8d920ebf/image-4.png" class="">]]></content>
      
      
      <categories>
          
          <category> UnityShader </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity </tag>
            
            <tag> Shader </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UnityShaderå…¥é—¨ç²¾è¦ç¬”è®°ï¼ˆåä¸‰ï¼‰â€”â€”ä½¿ç”¨æ·±åº¦å’Œæ³•çº¿çº¹ç†</title>
      <link href="/posts/b2c547d7/"/>
      <url>/posts/b2c547d7/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ç¬¬12ç« ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ çš„å±å¹•åå¤„ç†æ•ˆæœéƒ½åªæ˜¯åœ¨å±å¹•é¢œè‰²å›¾åƒä¸Šè¿›è¡Œå„ç§æ“ä½œæ¥å®ç°çš„ã€‚ç„¶è€Œï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¸ä»…éœ€è¦å½“å‰å±å¹•çš„é¢œè‰²ä¿¡æ¯ï¼Œè¿˜å¸Œæœ›å¾—åˆ°æ·±åº¦å’Œæ³•çº¿ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œåœ¨è¿›è¡Œè¾¹ç¼˜æ£€æµ‹çš„æ—¶å€™ï¼ŒæèŠ‚åˆ©ç”¨é¢œè‰²ä¿¡æ¯ä¼šä½¿æ£€æµ‹åˆ°çš„è¾¹ç¼˜ä¿¡æ¯æ”¶ç‰©ä½“çº¹ç†å’Œå…‰ç…§ç­‰å¤–éƒ¨å› ç´ çš„å½±å“ï¼Œå¾—åˆ°å¾ˆå¤šæˆ‘ä»¬ä¸éœ€è¦çš„è¾¹ç¼˜ç‚¹ã€‚ä¸€ç§æ›´å¥½çš„æ–¹æ³•æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ·±åº¦çº¹ç†å’Œæ³•çº¿çº¹ç†ä¸Šè¿›è¡Œè¾¹ç¼˜æ£€æµ‹ï¼Œè¿™äº›å›¾åƒä¸ä¼šå—çº¹ç†å’Œå…‰ç…§çš„å½±å“ï¼Œè€Œä»…ä»…ä¿å­˜äº†å½“å‰æ¸²æŸ“ç‰©ä½“çš„æ¨¡å‹ä¿¡æ¯ï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼æ£€æµ‹å‡ºæ¥çš„è¾¹ç¼˜æ›´åŠ å¯é ã€‚</p><p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åœ¨Unityä¸­è·å–æ·±åº¦çº¹ç†å’Œæ³•çº¿çº¹ç†æ¥å®ç°ç‰¹å®šçš„å±å¹•åå¤„ç†æ•ˆæœã€‚åœ¨13.1èŠ‚ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä¼šå­¦ä¹ å¦‚ä½•åœ¨Unityä¸­è·å–è¿™ä¸¤ç§çº¹ç†ã€‚åœ¨13.2èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šåˆ©ç”¨æ·±åº¦çº¹ç†æ¥è®¡ç®—æ‘„åƒæœºçš„ç§»åŠ¨é€Ÿåº¦ï¼Œå®ç°æ‘„åƒæœºçš„è¿åŠ¨æ¨¡ç³Šæ•ˆæœã€‚åœ¨13.3èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šå­¦ä¹ å¦‚ä½•åˆ©ç”¨æ·±åº¦çº¹ç†æ¥é‡å»ºå±å¹•åƒç´ åœ¨ä¸–ç•Œç©ºé—´ä¸­çš„ä½ç½®ï¼Œä»è€Œæ¨¡æ‹Ÿå±å¹•é›¾æ•ˆã€‚13.4èŠ‚ä¼šå†æ¬¡å­¦ä¹ è¾¹ç¼˜æ£€æµ‹çš„å¦ä¸€ç§å®ç°ï¼Œå³åˆ©ç”¨æ·±åº¦å’Œæ³•çº¿çº¹ç†è¿›è¡Œè¾¹ç¼˜æ£€æµ‹ã€‚</p><h1>è·å–æ·±åº¦å’Œæ³•çº¿çº¹ç†</h1><p>è™½ç„¶åœ¨Unityä¸­è·å–æ·±åº¦å’Œæ³•çº¿çº¹ç†çš„ä»£ç ååˆ†ç®€å•ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰å¿…è¦åœ¨è¿™ä¹‹å‰é¦–å…ˆäº†è§£å®ƒä»¬èƒŒåçš„å®ç°åŸç†ã€‚</p><h2 id="èƒŒåçš„åŸç†">èƒŒåçš„åŸç†</h2><p>æ·±åº¦çº¹ç†å®é™…å°±æ˜¯ä¸€å¼ æ¸²æŸ“çº¹ç†ï¼Œåªä¸è¿‡å®ƒé‡Œé¢å­˜å‚¨çš„åƒç´ å€¼ä¸æ˜¯é¢œè‰²å€¼ï¼Œè€Œæ˜¯ä¸€ä¸ªé«˜ç²¾åº¦çš„æ·±åº¦å€¼ã€‚ç”±äºè¢«å­˜å‚¨åœ¨ä¸€å¼ çº¹ç†ä¸­ï¼Œæ·±åº¦çº¹ç†é‡Œçš„æ·±åº¦å€¼èŒƒå›´æ˜¯[0,1]ï¼Œè€Œä¸”é€šå¸¸æ˜¯éçº¿æ€§åˆ†å¸ƒçš„ã€‚é‚£ä¹ˆï¼Œè¿™äº›æ·±åº¦å€¼æ˜¯ä»å“ªé‡Œå¾—åˆ°çš„å‘¢ï¼Ÿè¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å›é¡¾åœ¨ç¬¬4ç« å­¦ä¹ è¿‡çš„é¡¶ç‚¹å˜æ¢çš„è¿‡ç¨‹ã€‚æ€»ä½“æ¥è¯´ï¼Œè¿™äº›æ·±åº¦å€¼æ¥è‡ªäºé¡¶ç‚¹å˜æ¢åå¾—åˆ°çš„å½’ä¸€åŒ–çš„è®¾å¤‡åæ ‡(Normalized Device Coordinates, NDC)ã€‚å›é¡¾ä¸€ä¸‹ï¼Œä¸€ä¸ªæ¨¡å‹æƒ³è¦æœ€ç»ˆè¢«ç»˜åˆ¶åœ¨å±å¹•ä¸Šï¼Œéœ€è¦æŠŠå®ƒçš„é¡¶ç‚¹ä»æ¨¡å‹ç©ºé—´å˜æ¢åˆ°é½æ¬¡è£å‰ªåæ ‡ç³»ä¸‹ï¼Œè¿™æ˜¯é€šè¿‡åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­ä¹˜ä»¥MVPå˜æ¢çŸ©é˜µå¾—åˆ°çš„ã€‚åœ¨å˜æ¢çš„æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ä¸ªæŠ•å½±çŸ©é˜µæ¥å˜æ¢é¡¶ç‚¹ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯é€è§†æŠ•å½±ç±»å‹çš„æ‘„åƒæœºæ—¶ï¼Œè¿™ä¸ªæŠ•å½±çŸ©é˜µå°±æ˜¯éçº¿æ€§çš„ï¼Œå…·ä½“è¿‡ç¨‹å¯ä»¥å›é¡¾4.6.7å°èŠ‚ã€‚</p><p>ä¸‹å›¾æ˜¾ç¤ºäº†åœ¨4.6.7å°èŠ‚ä¸­ç»™å‡ºçš„Unityä¸­é€è§†æŠ•å½±å¯¹é¡¶ç‚¹çš„å˜æ¢è¿‡ç¨‹ã€‚å›¾ä¸­å·¦ä¾§çš„å›¾æ˜¾ç¤ºäº†æŠ•å½±å˜æ¢å‰ï¼Œå³è§‚å¯Ÿç©ºé—´ä¸‹è§†é”¥ä½“çš„ç»“æ„ä»¥åŠç›¸åº”é¡¶ç‚¹çš„ä½ç½®ï¼Œä¸­é—´å›¾æ˜¾ç¤ºäº†åº”ç”¨é€è§†è£å‰ªçŸ©é˜µåçš„å˜æ¢ç»“æœï¼Œå³é¡¶ç‚¹ç€è‰²å™¨é˜¶æ®µè¾“å‡ºçš„é¡¶ç‚¹å˜æ¢çš„ç»“æœï¼Œæœ€å³ä¾§çš„å›¾åˆ™æ˜¯åº•å±‚ç¡¬ä»¶è¿›è¡Œäº†é€è§†é™¤æ³•åå¾—åˆ°çš„å½’ä¸€åŒ–çš„è®¾å¤‡åæ ‡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„æŠ•å½±è¿‡ç¨‹æ˜¯å»ºç«‹åœ¨Unityå¯¹åæ ‡ç³»çš„å‡å®šä¸Šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬é’ˆå¯¹çš„æ˜¯è§‚å¯Ÿç©ºé—´ä¸ºå³æ‰‹åæ ‡ç³»ï¼Œä½¿ç”¨åˆ—çŸ©é˜µåœ¨çŸ©é˜µå³ä¾§è¿›è¡Œç›¸ä¹˜ï¼Œä¸”å˜æ¢åˆ°NDCåzåˆ†é‡èŒƒå›´å°†åœ¨[-1,1]ä¹‹é—´çš„æƒ…å†µã€‚è€Œåœ¨ç±»ä¼¼DirectXè¿™æ ·çš„å›¾å½¢æ¥å£ä¸­ï¼Œå˜æ¢åzåˆ†é‡èŒƒå›´å°†åœ¨[0,1]ä¹‹é—´ã€‚å¦‚æœéœ€è¦åœ¨å…¶ä»–å›¾å½¢æ¥å£ä¸‹å®ç°æœ¬ç« çš„ç±»ä¼¼æ•ˆæœï¼Œéœ€è¦å¯¹ä¸€äº›è®¡ç®—å‚æ•°ä½œå‡ºç›¸åº”çš„å˜åŒ–ã€‚</p><img src="/posts/b2c547d7/image.png" class=""><p>ä¸‹å›¾æ˜¾ç¤ºäº†åœ¨ä½¿ç”¨æ­£äº¤æ‘„åƒæœºæ—¶æŠ•å½±å˜æ¢çš„è¿‡ç¨‹ã€‚åŒæ ·ï¼Œå˜æ¢åä¼šå¾—åˆ°ä¸€ä¸ªèŒƒå›´ä¸º[-1,1]çš„æ­£æ–¹ä½“ã€‚æ­£äº¤æŠ•å½±ä½¿ç”¨çš„å˜æ¢çŸ©é˜µæ˜¯çº¿æ€§çš„ã€‚</p><img src="/posts/b2c547d7/image-1.png" class=""><p>åœ¨å¾—åˆ°NDCä¹‹åï¼Œæ·±åº¦çº¹ç†ä¸­çš„åƒç´ å€¼å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„è®¡ç®—åˆ°äº†ï¼Œè¿™äº›æ·±åº¦å€¼å°±å¯¹åº”äº†NDCä¸­é¡¶ç‚¹åæ ‡çš„zåˆ†é‡çš„å€¼ã€‚ç”±äºNDCä¸­zåˆ†é‡çš„èŒƒå›´åœ¨[-1,1]ï¼Œä¸ºäº†è®©è¿™äº›å€¼èƒ½å¤Ÿå­˜å‚¨åœ¨ä¸€å¼ å›¾åƒä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸‹é¢çš„å…¬å¼å¯¹å…¶è¿›è¡Œæ˜ å°„ï¼š<br>$$d = 0.5z_{ndc} + 0.5$$</p><p>å…¶ä¸­ï¼Œdå¯¹åº”äº†æ·±åº¦çº¹ç†ä¸­çš„åƒç´ å€¼ï¼Œ$z_{ndc}$å¯¹åº”äº†NDCåæ ‡ä¸­çš„zåˆ†é‡çš„å€¼ã€‚</p><p>é‚£ä¹ˆUnityæ˜¯æ€ä¹ˆå¾—åˆ°è¿™æ ·ä¸€å¼ æ·±åº¦çº¹ç†çš„å‘¢ï¼Ÿåœ¨Unityä¸­ï¼Œæ·±åº¦çº¹ç†å¯ä»¥ç›´æ¥æ¥è‡ªäºçœŸæ­£çš„æ·±åº¦ç¼“å­˜ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„Passæ¸²æŸ“è€Œå¾—ã€‚å…·ä½“å®ç°æ˜¯ï¼ŒUnityä¼šä½¿ç”¨ç€è‰²å™¨æ›¿æ¢(Shader Replacement)æŠ€æœ¯é€‰æ‹©é‚£äº›æ¸²æŸ“ç±»å‹(å³SubShaderçš„RenderTypeæ ‡ç­¾)ä¸ºOpaqueçš„ç‰©ä½“ï¼Œåˆ¤æ–­ä»–ä»¬çš„æ¸²æŸ“é˜Ÿåˆ—æ˜¯å¦å°äºç­‰äº2500(å†…ç½®çš„Backgroundã€Geometryå’ŒAlphaTestæ¸²æŸ“é˜Ÿåˆ—å‡åœ¨æ­¤èŒƒå›´å†…)ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œå°±æŠŠå®ƒæ¸²æŸ“åˆ°æ·±åº¦å’Œæ³•çº¿çº¹ç†ä¸­ã€‚å› æ­¤ï¼Œè¦æƒ³è®©ç‰©ä½“èƒ½å¤Ÿå‡ºç°åœ¨æ·±åº¦å’Œæ³•çº¿çº¹ç†ä¸­ï¼Œå°±å¿…é¡»åœ¨Shaderä¸­è®¾ç½®æ­£ç¡®çš„RenderTypeæ ‡ç­¾ã€‚</p><p>åœ¨Unityä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©è®©ä¸€ä¸ªæ‘„åƒæœºç”Ÿæˆä¸€å¼ æ·±åº¦çº¹ç†æˆ–æ˜¯ä¸€å¼ æ·±åº¦+æ³•çº¿çº¹ç†ã€‚å½“é€‰æ‹©å‰è€…ï¼Œå³åªéœ€è¦ä¸€å¼ å•ç‹¬çš„æ·±åº¦çº¹ç†æ—¶ï¼ŒUnityä¼šç›´æ¥è·å–æ·±åº¦ç¼“å­˜æˆ–æ˜¯æŒ‰ä¹‹å‰è®²åˆ°çš„ç€è‰²å™¨æ›¿æ¢æŠ€æœ¯ï¼Œé€‰å–éœ€è¦çš„ä¸é€æ˜ç‰©ä½“ï¼Œå¹¶ä½¿ç”¨å®ƒæŠ•å°„é˜´å½±æ—¶ä½¿ç”¨çš„Pass(å³LightModeè¢«è®¾ç½®ä¸ºShadowCasterçš„Pass)æ¥å¾—åˆ°æ·±åº¦çº¹ç†ã€‚å¦‚æœShaderä¸­ä¸åŒ…æ‹¬è¿™æ ·ä¸€ä¸ªPassï¼Œé‚£ä¹ˆè¿™ä¸ªç‰©ä½“å°±ä¸ä¼šå‡ºç°åœ¨æ·±åº¦çº¹ç†ä¸­ï¼ˆå½“ç„¶ä¹Ÿä¸èƒ½åƒå…¶ä»–ç‰©ä½“æŠ•å°„é˜´å½±ã€‚æ·±åº¦çº¹ç†çš„ç²¾åº¦é€šå¸¸æ˜¯24ä½æˆ–è€…16ä½ï¼Œè¿™å–å†³äºä½¿ç”¨çš„æ·±åº¦ç¼“å­˜çš„ç²¾åº¦ï¼Œå¦‚æœé€‰æ‹©ç”Ÿæˆä¸€å¼ æ·±åº¦+æ³•çº¿çº¹ç†ã€‚Unityä¼šåˆ›å»ºä¸€å¼ å’Œå±å¹•åˆ†è¾¨ç‡ç›¸åŒã€ç²¾åº¦ä¸º32ä½ï¼ˆæ¯ä¸ªé€šé“ä¸º8ä½ï¼‰çš„çº¹ç†ï¼Œå…¶ä¸­è§‚å¯Ÿç©ºé—´ä¸‹çš„æ³•çº¿ä¿¡æ¯ä¼šè¢«ç¼–ç è¿›çº¹ç†çš„Rå’ŒGé€šé“ï¼Œè€Œæ·±åº¦ä¿¡æ¯ä¼šè¢«ç¼–ç è¿›Bå’ŒAé€šé“ã€‚æ³•çº¿ä¿¡æ¯çš„è·å–åœ¨å»¶è¿Ÿæ¸²æŸ“ä¸­æ˜¯å¯ä»¥éå¸¸å®¹æ˜“å°±å¾—åˆ°çš„ï¼ŒUnityåªéœ€è¦åˆå¹¶æ·±åº¦å’Œæ³•çº¿ç¼“å­˜å³å¯ã€‚è€Œåœ¨å‰å‘æ¸²æŸ“ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸ä¼šåˆ›å»ºæ³•çº¿ç¼“å­˜çš„ï¼Œå› æ­¤Unityåº•å±‚ä½¿ç”¨äº†ä¸€ä¸ªå•ç‹¬çš„PassæŠŠæ•´ä¸ªåœºæ™¯å†æ¸²æŸ“ä¸€éæ¥å®Œæˆã€‚è¿™ä¸ªPassè¢«åŒ…å«åœ¨Unityå†…ç½®çš„ä¸€ä¸ªUnity Shaderä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å†…ç½®çš„builtin_shaders-xxx/DefaultResources/Camera-DepthNormalTexture.shaderæ–‡ä»¶ä¸­æ‰¾åˆ°è¿™ä¸ªç”¨äºæ¸²æŸ“æ·±åº¦å’Œæ³•çº¿ä¿¡æ¯çš„Passã€‚</p><h2 id="å¦‚ä½•è·å–">å¦‚ä½•è·å–</h2><p>åœ¨Unityä¸­ï¼Œè·å–æ·±åº¦çº¹ç†æ˜¯éå¸¸ç®€å•çš„ï¼Œæˆ‘ä»¬åªéœ€è¦å‘Šè¯‰Unityï¼šâ€œå˜¿ï¼æŠŠæ·±åº¦çº¹ç†ç»™æˆ‘ï¼â€ç„¶ååœ¨Shaderä¸­ç›´æ¥è®¿é—®ç‰¹å®šçš„çº¹ç†å±æ€§å³å¯ã€‚è¿™ä¸ªä¸Unityæ²Ÿé€šçš„è¿‡ç¨‹æ˜¯é€šè¿‡åœ¨è„šæœ¬ä¸­è®¾ç½®æ‘„åƒæœºçš„depthTextureModeæ¥å®Œæˆçš„ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç æ¥è·å–æ·±åº¦çº¹ç†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">camera.depthTextureMode = DepthTextureMode.Depth;</span><br></pre></td></tr></table></figure><p>ä¸€æ—¦è®¾ç½®å¥½äº†ä¸Šé¢çš„æ‘„åƒæœºæ¨¡å¼åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨Sahderä¸­é€šè¿‡å£°æ˜_CameraDepthTextureå˜é‡æ¥è®¿é—®å®ƒã€‚è¿™ä¸ªè¿‡ç¨‹éå¸¸ç®€å•ï¼Œä½†æˆ‘ä»¬éœ€è¦çŸ¥é“è¿™ä¸¤è¡Œä»£ç çš„èƒŒåï¼ŒUnityä¸ºæˆ‘ä»¬åšäº†å¾ˆå¤šå·¥ä½œã€‚</p><p>åŒç†ï¼Œå¦‚æœæƒ³è¦è·å¾—æ·±åº¦+æ³•çº¿çº¹ç†ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ä»£ç ä¸­è¿™æ ·è®¾ç½®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">camera.depthTextureMode = DepthTextureMode.DepthNormals;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨Shaderä¸­é€šè¿‡å£°æ˜_CameraDepthNormalsTextureå˜é‡æ¥è®¿é—®å®ƒã€‚<br>æˆ‘ä»¬è¿˜å¯ä»¥ç»„åˆè¿™äº›æ¨¡å¼ï¼Œè®©ä¸€ä¸ªæ‘„åƒæœºåŒæ—¶äº§ç”Ÿä¸€å¼ æ·±åº¦å’Œæ·±åº¦+æ³•çº¿çº¹ç†:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">camera.depthTextureMode |= DepthTextureMode.Depth;</span><br><span class="line">camera.depthTextureMode |= DepthTextureMode.DepthNormals;</span><br></pre></td></tr></table></figure><p>åœ¨Unityä¸­æˆ‘ä»¬è¿˜å¯ä»¥åœ¨æ‘„åƒæœºçš„Cameraç»„ä»¶ä¸Šçœ‹åˆ°å½“å‰æ‘„åƒæœºæ˜¯å¦éœ€è¦æ¸²æŸ“æ·±åº¦æˆ–æ·±åº¦+æ³•çº¿çº¹ç†ã€‚å½“åœ¨Shaderä¸­è®¿é—®æ·±åº¦çº¹ç†_CameraDepthTextureåï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å½“å‰åƒç´ çš„çº¹ç†åæ ‡å¯¹å®ƒè¿›è¡Œé‡‡æ ·ã€‚ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨tex2Då‡½æ•°é‡‡æ ·å³å¯ï¼Œä½†æ˜¯åœ¨æŸä¸€äº›å¹³å°ä¸Šï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›ç‰¹æ®Šå¤„ç†ã€‚Unityä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„å®SAMPLE_DEPTH_TEXTUREï¼Œç”¨æ¥å¤„ç†è¿™äº›ç”±äºå¹³å°å·®å¼‚é€ æˆçš„é—®é¢˜ã€‚è€Œæˆ‘ä»¬åªéœ€è¦åœ¨Shaderä¸­ä½¿ç”¨SAMPLE_DEPTH_TEXTUREå®å¯¹æ·±åº¦çº¹ç†è¿›è¡Œé‡‡æ ·ã€‚å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">float d = SAMPLE_DEPTH_TEXTURE(_CameraDdepthTexture, i.uv);</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œi.uvæ˜¯ä¸€ä¸ªfloat2ç±»å‹çš„å˜é‡ï¼Œå¯¹åº”äº†å½“å‰åƒç´ çš„çº¹ç†åæ ‡ã€‚ç±»ä¼¼çš„å®è¿˜æœ‰SAMPLE_DEPTH_TEXTURE_PROJå’ŒSAMPLE_DEPTH_TEXTURE_LODã€‚SAMPLE_DEPTH_TEXTURE_PROJå®åŒæ ·æ¥å—ä¸¤ä¸ªå‚æ•°â€”â€”æ·±åº¦çº¹ç†å’Œä¸€ä¸ªfloat3æˆ–float4ç±»å‹çš„çº¹ç†åæ ‡ï¼Œå®ƒçš„å†…éƒ¨ä½¿ç”¨äº†tex2Dprojè¿™æ ·çš„å‡½æ•°è¿›è¡ŒæŠ•å½±çº¹ç†é‡‡æ ·ï¼Œçº¹ç†åæ ‡çš„å‰ä¸¤ä¸ªåˆ†é‡é¦–å…ˆä¼šé™¤ä»¥æœ€åä¸€ä¸ªåˆ†é‡ï¼Œå†è¿›è¡Œçº¹ç†é‡‡æ ·ã€‚å¦‚æœæä¾›äº†ç¬¬å››ä¸ªåˆ†é‡ï¼Œè¿˜ä¼šè¿›è¡Œä¸€æ¬¡æ¯”è¾ƒï¼Œé€šå¸¸ç”¨äºé˜´å½±çš„å®ç°ä¸­ã€‚SAMPLE_DEPTH_TEXTURE_PROJçš„ç¬¬äºŒä¸ªå‚æ•°é€šå¸¸æ˜¯ç”±é¡¶ç‚¹ç€è‰²å™¨è¾“å‡ºçš„æ’å€¼è€Œå¾—çš„å±å¹•åæ ‡ã€‚ä¾‹å¦‚:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">float d = SAMPLE_DEPTH_TEXTURE_PROJ(_CameraDepthTexture, UNITY_PROJ_COORD(i.scrPos))</span><br></pre></td></tr></table></figure><p>å…¶ä¸­, i.scrPosæ˜¯å†é¡¶ç‚¹ç€è‰²å™¨ä¸­é€šè¿‡è°ƒç”¨ComputeScreenPos(o.pos)å¾—åˆ°çš„å±å¹•åæ ‡ã€‚ä¸Šè¿°è¿™äº›å®çš„å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Unityå†…ç½®çš„HLSLSupport.cgincæ–‡ä»¶ä¸­æ‰¾åˆ°ã€‚</p><p>å½“é€šè¿‡çº¹ç†é‡‡æ ·å¾—åˆ°æ·±åº¦å€¼åï¼Œè¿™äº›æ·±åº¦å€¼å¾€å¾€æ˜¯éçº¿æ€§çš„ï¼Œè¿™ç§éçº¿æ€§æ¥è‡ªäºé€è§†æŠ•å½±ä½¿ç”¨çš„è£å‰ªçŸ©é˜µã€‚ç„¶è€Œï¼Œåœ¨æˆ‘ä»¬è®¡ç®—è¿‡ç¨‹ä¸­é€šå¸¸æ˜¯éœ€è¦çº¿æ€§çš„æ·±åº¦å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæŠ•å½±åçš„æ·±åº¦å€¼å˜æ¢åˆ°çº¿æ€§ç©ºé—´ä¸‹ï¼Œä¾‹å¦‚è§†è§’ç©ºé—´ä¸‹çš„æ·±åº¦å€¼ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•è¿›è¡Œè¿™ä¸ªè½¬æ¢å‘¢ï¼Ÿå®é™…ä¸Šï¼Œæˆ‘ä»¬åªéœ€è¦å€’æ¨é¡¶ç‚¹å˜æ¢çš„è¿‡ç¨‹å³å¯ã€‚ä¸‹é¢æˆ‘ä»¬ä»¥é€è§†æŠ•å½±ä¸ºä¾‹ï¼Œæ¨å¯¼å¦‚ä½•ç”±æ·±åº¦çº¹ç†ä¸­çš„æ·±åº¦ä¿¡æ¯è®¡ç®—å¾—åˆ°è§†è§’ç©ºé—´ä¸‹çš„æ·±åº¦å€¼ã€‚</p><p>ç”±4.6.7èŠ‚å¯çŸ¥ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨é€è§†æŠ•å½±çš„è£å‰ªçŸ©é˜µ$P_{clip}$å¯¹è§†è§’ç©ºé—´ä¸‹çš„ä¸€ä¸ªé¡¶ç‚¹è¿›è¡Œå˜æ¢åï¼Œè£å‰ªç©ºé—´ä¸‹é¡¶ç‚¹çš„zå’Œwåˆ†é‡ä¸ºï¼š</p><p>$$z_{clip} = -z_{view}\frac{Far + Near}{Far - Near} - \frac{2\cdot Near \cdot Far}{Far - Near}$$<br>$$w_{clip} = -z_{view}$$</p><p>å…¶ä¸­ï¼ŒFarå’ŒNearåˆ†åˆ«æ˜¯è¿œè¿‘è£åˆ‡å¹³é¢çš„è·ç¦»ã€‚ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡é½æ¬¡é™¤æ³•å°±å¯ä»¥å¾—åˆ°NDCä¸‹çš„zåˆ†é‡ï¼š</p><p>$$z_{ndc} = \frac{z_{clip}}{w_{clip}} = \frac{Far + Near}{Far - Near} + \frac{2Near \cdot Far}{(Far - Near) \cdot z_{view}}$$</p><p>åœ¨13.1.1èŠ‚ä¸­æˆ‘ä»¬çŸ¥é“ï¼Œæ·±åº¦çº¹ç†ä¸­çš„æ·±åº¦å€¼æ˜¯é€šè¿‡ä¸‹é¢çš„å…¬å¼ç”±NDCè®¡ç®—è€Œå¾—çš„ï¼š<br>$$d = 0.5 \cdot z_{ndc} + 0.5$$</p><p>ç”±ä¸Šé¢çš„è¿™äº›å¼å­ï¼Œæˆ‘ä»¬å¯ä»¥æ¨å¯¼å‡ºdè¡¨ç¤ºè€Œå¾—çš„$z_{view}$çš„è¡¨è¾¾å¼ï¼š</p><p>$$z_{view} = \frac{1}{\frac{Far - Near}{Near \cdot Far}d - \frac{1}{Near}}$$</p><p>ç”±äºåœ¨Unityä½¿ç”¨çš„è§†è§’ç©ºé—´ä¸­ï¼Œæ‘„åƒæœºæ­£å‘å¯¹åº”çš„zå€¼å‡ä¸ºè´Ÿå€¼ï¼Œå› æ­¤ä¸ºäº†å¾—åˆ°æ·±åº¦å€¼çš„æ­£æ•°è¡¨ç¤ºï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä¸Šé¢çš„ç»“æœå–åï¼Œæœ€åå¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š</p><p>$$z_{view} = \frac{1}{\frac{Near - Far}{Near \cdot Far}d + \frac{1}{Near}}$$</p><p>å®ƒçš„å–å€¼èŒƒå›´å°±æ˜¯è§†é”¥ä½“çš„æ·±åº¦èŒƒå›´ï¼Œå³[Near, Far]ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦å¾—åˆ°èŒƒå›´åœ¨[0,1]ä¹‹å‰çš„æ·±åº¦å€¼ï¼Œåªéœ€è¦æŠŠä¸Šé¢å¾—åˆ°çš„ç»“æœé™¤ä»¥Farå³å¯ã€‚è¿™æ ·ï¼Œ0å°±è¡¨ç¤ºè¯¥ç‚¹ä¸æ‘„åƒæœºå¤„äºåŒä¸€ä½ç½®ï¼Œ1è¡¨ç¤ºè¯¥ç‚¹ä½äºè§†é”¥ä½“çš„è¿œè£å‰ªå¹³é¢ä¸Šã€‚ç»“æœå¦‚ä¸‹ï¼š<br>$$z_{01} = \frac{1}{\frac{Near - Far}{Near }d + \frac{Far}{Near}}$$</p><p>å¹¸è¿çš„æ˜¯ï¼ŒUnityæä¾›äº†ä¸¤ä¸ªè¾…åŠ©å‡½æ•°æ¥ä¸ºæˆ‘ä»¬è¿›è¡Œä¸Šè¿°çš„è®¡ç®—è¿‡ç¨‹â€”â€”LinearEyeDepthå’ŒLinear01Depthã€‚LinearEyeDepthè´Ÿè´£æŠŠæ·±åº¦çº¹ç†çš„é‡‡æ ·ç»“æœè½¬æ¢åˆ°è§†è§’ç©ºé—´ä¸‹çš„æ·±åº¦å€¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢å¾—åˆ°çš„ã€‚è€ŒLinear01Depthåˆ™ä¼šè¿”å›ä¸€ä¸ªèŒƒå›´åœ¨[0,1]çš„çº¿æ€§æ·±åº¦å€¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢å¾—åˆ°çš„$z_{01}$ã€‚è¿™ä¸¤ä¸ªå‡½æ•°å†…éƒ¨ä½¿ç”¨äº†å†…ç½®çš„_ZBufferParamså˜é‡æ¥å¾—åˆ°è¿œè¿‘è£å‰ªå¹³é¢çš„è·ç¦»ã€‚</p><p>å¦‚æœæˆ‘ä»¬éœ€è¦è·å–æ·±åº¦+æ³•çº¿çº¹ç†ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨tex2Då‡½æ•°å¯¹_CameraDepthNormalsTextureè¿›è¡Œé‡‡æ ·ï¼Œå¾—åˆ°é‡Œé¢å­˜å‚¨çš„æ·±åº¦å’Œæ³•çº¿ä¿¡æ¯ã€‚Unityæä¾›äº†è¾…åŠ©å‡½æ•°æ¥ä¸ºæˆ‘ä»¬å¯¹è¿™ä¸ªé‡‡æ ·ç»“æœè¿›è¡Œè§£ç ï¼Œä»è€Œå¾—åˆ°æ·±åº¦å€¼å’Œæ³•çº¿æ–¹å‘ã€‚è¿™ä¸ªå‡½æ•°æ˜¯DecodeDepthNormalï¼Œå®ƒåœ¨UnityCG.cgincé‡Œè¢«å®šä¹‰:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">inline void DecodeDepthNormal(float4 enc, out float depth, out float3 normal)&#123;</span><br><span class="line">    depth = DecodeFloatRG(enc.zw);</span><br><span class="line">    normal = DecodeViewNormalStereo(enc);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>DecodeDepthNormalçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯¹æ·±åº¦+æ³•çº¿çº¹ç†çš„é‡‡æ ·ç»“æœï¼Œè¿™ä¸ªé‡‡æ ·ç»“æœæ˜¯Unityå¯¹æ·±åº¦å’Œæ³•çº¿ä¿¡æ¯ç¼–ç åçš„ç»“æœï¼Œå®ƒçš„xyåˆ†é‡å­˜å‚¨çš„æ˜¯è§†è§’ç©ºé—´ä¸‹çš„æ³•çº¿ä¿¡æ¯ï¼Œè€Œæ·±åº¦ä¿¡æ¯è¢«ç¼–ç è¿›äº†zwåˆ†é‡ã€‚é€šè¿‡è°ƒç”¨DecodeDepthNormalå‡½æ•°å¯¹é‡‡æ ·ç»“æœç¼–ç åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°è§£ç åçš„æ·±åº¦å€¼å’Œæ³•çº¿ã€‚è¿™ä¸ªæ·±åº¦å€¼èŒƒå›´åœ¨[0,1]çš„çº¿æ€§æ·±åº¦å€¼ï¼ˆè¿™ä¸å•ç‹¬çš„æ·±åº¦çº¹ç†ä¸­å­˜å‚¨çš„æ·±åº¦å€¼ä¸åŒï¼‰ï¼Œè€Œå¾—åˆ°çš„æ³•çº¿åˆ™æ˜¯è§†è§’ç©ºé—´ä¸‹çš„æ³•çº¿æ–¹å‘ã€‚åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨DecodeFloatRGå’ŒDecodeViewNormalStereoæ¥è§£ç æ·±åº¦+å‘ç°çº¹ç†ä¸­çš„æ·±åº¦å’Œæ³•çº¿ä¿¡æ¯ã€‚</p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¼šäº†å¦‚ä½•åœ¨Unityé‡Œè·å¾—åŠä½¿ç”¨æ·±åº¦å’Œæ³•çº¿çº¹ç†ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬ä¼šå­¦ä¹ å¦‚ä½•ä½¿ç”¨å®ƒä»¬å®ç°å„ç§å±å¹•ç‰¹æ•ˆã€‚</p><h2 id="æŸ¥çœ‹æ·±åº¦å’Œæ³•çº¿çº¹ç†">æŸ¥çœ‹æ·±åº¦å’Œæ³•çº¿çº¹ç†</h2><p>å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥æŸ¥çœ‹ç”Ÿæˆçš„æ·±åº¦å’Œæ³•çº¿çº¹ç†ï¼Œä»¥ä¾¿å¯¹Shaderè¿›è¡Œè°ƒè¯•ã€‚Unityä¸­å¯ä»¥ä½¿ç”¨Frame Debuggeræ¥æŸ¥çœ‹æ‘„åƒæœºç”Ÿæˆçš„æ·±åº¦å’Œæ³•çº¿çº¹ç†ã€‚å¦‚ä¸‹å›¾ï¼š</p><img src="/posts/b2c547d7/image-2.png" class=""><p>ä½¿ç”¨å¸§è°ƒè¯•å™¨æŸ¥çœ‹åˆ°çš„æ·±åº¦çº¹ç†æ˜¯éçº¿æ€§ç©ºé—´çš„æ·±åº¦å€¼ï¼Œè€Œæ·±åº¦å’Œæ³•çº¿çº¹ç†éƒ½æ˜¯ç”±Unityç¼–ç åçš„ç»“æœã€‚æœ‰æ—¶ï¼Œæ˜¾ç¤ºå‡ºçº¿æ€§ç©ºé—´ä¸‹çš„æ·±åº¦ä¿¡æ¯æˆ–è§£ç åçš„æ³•çº¿æ–¹å‘ä¼šæ›´åŠ æœ‰ç”¨ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªè¡Œåœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­è¾“å‡ºè½¬æ¢æˆ–è§£ç åçš„æ·±åº¦å’Œæ³•çº¿å€¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚è¾“å‡ºä»£ç éå¸¸ç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç±»ä¼¼ä¸‹é¢çš„ä»£ç æ¥è¾“å‡ºçº¿æ€§æ·±åº¦å€¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">float depth = SAMPLE_DEPTH_TEXTURE(_CameraDepthTexture, i.uv);</span><br><span class="line">float linearDepth = Linear01Depth(depth);</span><br><span class="line">return fixed4(linearDepth, linearDepth, linearDepth, 1.0);</span><br></pre></td></tr></table></figure><p>æˆ–æ˜¯è¾“å‡ºæ³•çº¿æ–¹å‘ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fixed3 normal = DecodeViewNormalStereo(tex2D(_CameraDepthNormalsTexture, i.uv).xy);</span><br><span class="line">return fixed4(normal * 0.5 + 0.5, 1.0);</span><br></pre></td></tr></table></figure><img src="/posts/b2c547d7/image-3.png" class=""><p><strong>åœ¨æŸ¥çœ‹æ·±åº¦çº¹ç†æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°çš„ç”»é¢æœ‰å¯èƒ½å‡ ä¹æ˜¯å…¨é»‘æˆ–è€…å…¨ç™½çš„ã€‚è¿™æ—¶æˆ‘ä»¬å¯ä»¥æŠŠæ‘„åƒæœºçš„è¿œè£å‰ªå¹³é¢çš„è·ç¦»è°ƒå°ï¼Œä½¿è§†é”¥ä½“çš„èŒƒå›´åˆšå¥½è¦†ç›–ä»è¿‘è£å‰ªå¹³é¢åˆ°è¿œè£å‰ªå¹³é¢çš„æ‰€æœ‰æ·±åº¦åŒºåŸŸï¼Œå½“è¿œè£å‰ªå¹³é¢çš„è·ç¦»è¿‡å¤§æ—¶ï¼Œä¼šå¯¼è‡´è·ç¦»æ‘„åƒæœºè¾ƒè¿‘çš„è·ç¦»æ˜ å°„åˆ°éå¸¸å°çš„æ·±åº¦å€¼ï¼Œå¦‚æœåœºæ™¯æ˜¯ä¸€ä¸ªå°é—­çš„åŒºåŸŸï¼Œé‚£ä¹ˆè¿™å°±ä¼šå¯¼è‡´ç”»é¢çœ‹èµ·æ¥å‡ ä¹æ˜¯å…¨é»‘çš„ã€‚ç›¸åï¼Œå¦‚æœåœºæ™¯æ˜¯ä¸€ä¸ªå¼€æ”¾åŒºåŸŸï¼Œå¹¶ä¸”ç‰©ä½“ç¦»æ‘„åƒæœºçš„è·ç¦»è¾ƒè¿œï¼Œå°±ä¼šå¯¼è‡´ç”»é¢å‡ ä¹æ˜¯å…¨ç™½çš„ã€‚</strong></p><h1>å†è°ˆè¿åŠ¨æ¨¡ç³Š</h1><p>åœ¨12.6èŠ‚ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•é€šè¿‡æ··åˆå¤šå¼ å±å¹•å›¾åƒæ¥æ¨¡æ‹Ÿè¿åŠ¨æ¨¡ç³Šçš„æ•ˆæœã€‚ä½†æ˜¯ï¼Œå¦å¤–ä¸€ç§åº”ç”¨æ›´åŠ å¹¿æ³›çš„æŠ€æœ¯åˆ™æ˜¯ä½¿ç”¨é€Ÿåº¦æ˜ å°„å›¾ã€‚é€Ÿåº¦æ˜ å°„å›¾ä¸­å­˜å‚¨äº†æ¯ä¸ªåƒç´ çš„é€Ÿåº¦ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªé€Ÿåº¦æ¥å†³å®šæ¨¡ç³Šçš„å¤§å°å’Œæ–¹å‘ã€‚é€Ÿåº¦ç¼“å†²çš„ç”Ÿæˆæœ‰å¤šç§æ–¹æ³•ï¼Œä¸€ç§æ–¹æ³•æ˜¯æŠŠåœºæ™¯ä¸­æ‰€æœ‰ç‰©ä½“çš„é€Ÿåº¦æ¸²æŸ“åˆ°ä¸€å¼ çº¹ç†ä¸­ã€‚ä½†è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯éœ€è¦ä¿®æ”¹åœºæ™¯ä¸­æ‰€æœ‰ç‰©ä½“çš„Shaderä»£ç ï¼Œä½¿å…¶æ·»åŠ è®¡ç®—é€Ÿåº¦çš„ä»£ç å¹¶è¾“å‡ºåˆ°ä¸€ä¸ªæ¸²æŸ“çº¹ç†ä¸­ã€‚</p><p>GPUç²¾ç²¹åœ¨ç¬¬27ç« ä¸­ä»‹ç»äº†ä¸€ç§ç”Ÿæˆé€Ÿåº¦æ˜ å°„å›¾çš„æ–¹æ³•ã€‚è¿™ç§æ–¹æ³•åˆ©ç”¨æ·±åº¦çº¹ç†åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­ä¸ºæ¯ä¸ªåƒç´ è®¡ç®—å…¶åœ¨ä¸–ç•Œç©ºé—´ä¸‹çš„ä½ç½®ï¼Œè¿™æ˜¯é€šè¿‡ä½¿ç”¨å½“å‰çš„è§†è§’ä¹˜æŠ•å½±çŸ©é˜µçš„é€†çŸ©é˜µå¯¹NDCä¸‹çš„é¡¶ç‚¹åæ ‡è¿›è¡Œå˜æ¢å¾—åˆ°çš„ã€‚å½“å¾—åˆ°ä¸–ç•Œç©ºé—´ä¸­çš„é¡¶ç‚¹åæ ‡åï¼Œæˆ‘ä»¬ä½¿ç”¨å‰ä¸€å¸§çš„è§†è§’ä¹˜æŠ•å½±çŸ©é˜µå¯¹å…¶è¿›è¡Œå˜æ¢ï¼Œå¾—åˆ°è¯¥ä½ç½®åœ¨å‰ä¸€å¸§ä¸­çš„NDCåæ ‡ã€‚ç„¶åï¼Œæˆ‘ä»¬è®¡ç®—å‰ä¸€å¸§å’Œå½“å‰å¸§çš„ä½ç½®å·®ï¼Œç”Ÿæˆè¯¥åƒç´ çš„é€Ÿåº¦ã€‚è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯å¯ä»¥åœ¨ä¸€ä¸ªå±å¹•åå¤„ç†æ­¥éª¤ä¸­å®Œæˆæ•´ä¸ªæ•ˆæœçš„æ¨¡æ‹Ÿï¼Œä½†æ˜¯ç¼ºç‚¹éœ€è¦åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­è¿›è¡Œä¸¤æ¬¡çŸ©é˜µä¹˜æ³•çš„æ“ä½œï¼Œå¯¹æ€§èƒ½æœ‰æ‰€å½±å“ã€‚</p><p>æœ¬èŠ‚å®ç°çš„è¿åŠ¨æ¨¡ç³Šé€‚ç”¨äºåœºæ™¯é™æ­¢ã€æ‘„åƒæœºå¿«é€Ÿè¿åŠ¨çš„æƒ…å†µï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨è®¡ç®—æ—¶åªè€ƒè™‘äº†æ‘„åƒæœºçš„è¿åŠ¨ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬æŠŠæœ¬èŠ‚çš„ä»£ç åº”ç”¨åˆ°ä¸€ä¸ªç‰©ä½“å¿«é€Ÿè¿åŠ¨è€Œæ‘„åƒæœºé™æ­¢çš„åœºæ™¯ï¼Œä¼šå‘ç°ä¸ä¼šäº§ç”Ÿä»»ä½•è¿åŠ¨æ¨¡ç³Šæ•ˆæœã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦å¯¹å¿«é€Ÿç§»åŠ¨çš„ç‰©ä½“äº§ç”Ÿè¿åŠ¨æ¨¡ç³Šçš„æ•ˆæœï¼Œå°±éœ€è¦ç”Ÿæˆæ›´åŠ ç²¾ç¡®çš„é€Ÿåº¦æ˜ å°„å›¾ã€‚æˆ‘ä»¬å¯ä»¥åœ¨Unityè‡ªå¸¦çš„Image EffectåŒ…ä¸­æ‰¾åˆ°æ›´å¤šè¿åŠ¨æ¨¡ç³Šçš„å®ç°æ–¹æ³•ã€‚</p><p>æœ¬èŠ‚é€‰æ‹©åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­ä½¿ç”¨é€†çŸ©é˜µæ¥é‡å»ºæ¯ä¸ªåƒç´ åœ¨ä¸–ç•Œç©ºé—´ä¸‹çš„ä½ç½®ã€‚ä½†æ˜¯è¿™ç§åšæ³•å¾€å¾€ä¼šå½±å“æ€§èƒ½ï¼Œåœ¨13.3èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šä»‹ç»ä¸€ç§æ›´å¿«é€Ÿç”±æ·±åº¦çº¹ç†é‡å»ºä¸–ç•Œåæ ‡çš„æ–¹æ³•ã€‚</p><p>Shaderä»£ç å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">// Upgrade NOTE: replaced &#x27;mul(UNITY_MATRIX_MVP,*)&#x27; with &#x27;UnityObjectToClipPos(*)&#x27;</span><br><span class="line"></span><br><span class="line">Shader &quot;Custom/MotionBlur&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _MainTex (&quot;Base (RGB)&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _BlurSize (&quot;Blur Size&quot;, Float) = 1.0</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        CGINCLUDE</span><br><span class="line"></span><br><span class="line">        #include &quot;UnityCG.cginc&quot;</span><br><span class="line">            </span><br><span class="line">        sampler2D _MainTex;</span><br><span class="line">        half4 _MainTex_TexelSize;</span><br><span class="line">        sampler2D _CameraDepthTexture;</span><br><span class="line">        float4x4 _CurrentViewProjectionInverseMatrix;</span><br><span class="line">        float4x4 _PreviousViewProjectionMatrix;</span><br><span class="line">        half _BlurSize;</span><br><span class="line"></span><br><span class="line">        struct v2f</span><br><span class="line">        &#123;</span><br><span class="line">            float4 pos : SV_POSITION;</span><br><span class="line">            half2 uv : TEXCOORD0;</span><br><span class="line">            half2 uv_depth : TEXCOORD1;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        v2f vert(appdata_img v)</span><br><span class="line">        &#123;</span><br><span class="line">            v2f o;</span><br><span class="line">            o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">            o.uv = v.texcoord;</span><br><span class="line">            o.uv_depth = v.texcoord;</span><br><span class="line"></span><br><span class="line">            #if UNITY_UV_STARTS_AT_TOP</span><br><span class="line">            if(_MainTex_TexelSize.y &lt; 0)</span><br><span class="line">                o.uv_depth = 1 - o.uv_depth.y;</span><br><span class="line">            #endif</span><br><span class="line"></span><br><span class="line">            return o;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fixed4 frag(v2f i) : SV_Target&#123;</span><br><span class="line"></span><br><span class="line">            float d = SAMPLE_DEPTH_TEXTURE(_CameraDepthTexture, i.uv_depth);</span><br><span class="line"></span><br><span class="line">            float4 H = float4(i.uv.x * 2 - 1, i.uv.y * 2 - 1, d * 2 - 1, 1);</span><br><span class="line"></span><br><span class="line">            float4 D = mul(_CurrentViewProjectionInverseMatrix, H);</span><br><span class="line"></span><br><span class="line">            float4 worldPos = D / D.w;</span><br><span class="line"></span><br><span class="line">            float4 currentPos = H;</span><br><span class="line"></span><br><span class="line">            float4 previousPos = mul(_PreviousViewProjectionMatrix, worldPos);</span><br><span class="line"></span><br><span class="line">            previousPos /= previousPos.w;</span><br><span class="line"></span><br><span class="line">            float2 velocity = (currentPos.xy - previousPos.xy) / 2.0f;</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">            float2 uv = i.uv;</span><br><span class="line">float4 c = tex2D(_MainTex, uv);</span><br><span class="line">uv += velocity * _BlurSize;</span><br><span class="line">for (int it = 1; it &lt; 3; it++, uv += velocity * _BlurSize) &#123;</span><br><span class="line">float4 currentColor = tex2D(_MainTex, uv);</span><br><span class="line">c += currentColor;</span><br><span class="line">&#125;</span><br><span class="line">c /= 3;</span><br><span class="line"></span><br><span class="line">return fixed4(c.rgb, 1.0);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        ENDCG</span><br><span class="line"></span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            ZTest Always Cull Off ZWrite Off</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Fallback Off</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ©ç”¨æ·±åº¦çº¹ç†å’Œå½“å‰å¸§çš„è§†è§’ä¹˜æŠ•å½±çŸ©é˜µçš„é€†çŸ©é˜µæ¥æ±‚å¾—è¯¥åƒç´ åœ¨ä¸–ç•Œç©ºé—´ä¸‹çš„åæ ‡ï¼Œè¿‡ç¨‹å¼€å§‹äºå¯¹æ·±åº¦çº¹ç†çš„é‡‡æ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨å†…ç½®çš„SAMPLE_DEPTH_TEXTUREå®å’Œçº¹ç†åæ ‡å¯¹æ·±åº¦çº¹ç†è¿›è¡Œé‡‡æ ·ï¼Œå¾—åˆ°äº†æ·±åº¦å€¼dã€‚ç”±13.1.2èŠ‚å¯çŸ¥ï¼Œdæ˜¯ç”±NDCä¸‹çš„åæ ‡æ˜ å°„è€Œæ¥çš„ï¼Œæˆ‘ä»¬æƒ³è¦æ„å»ºåƒç´ çš„NDCåæ ‡Hï¼Œå°±éœ€è¦æŠŠè¿™ä¸ªæ·±åº¦å€¼é‡æ–°æ˜ å°„å›NDCï¼Œè¿™ä¸ªæ˜ å°„å¾ˆç®€å•ï¼Œåªéœ€è¦ä½¿ç”¨åŸæ˜ å°„çš„åå‡½æ•°å³å¯ï¼Œå³d*2 - 1ã€‚åŒæ ·ï¼ŒNDCçš„xyåˆ†é‡å¯ä»¥ç”±åƒç´ çš„çº¹ç†åæ ‡æ˜ å°„è€Œæ¥(NDCä¸‹çš„xyzåˆ†é‡èŒƒå›´å‡ä¸º[-1,1])ã€‚å½“å¾—åˆ°NDCä¸‹çš„åæ ‡Håï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å½“å‰å¸§çš„è§†è§’ä¹˜<strong>æŠ•å½±çŸ©é˜µçš„é€†çŸ©é˜µ</strong>å¯¹å…¶è¿›è¡Œå˜æ¢ï¼Œå¹¶æŠŠç»“æœå€¼é™¤ä»¥å®ƒçš„wåˆ†é‡æ¥å¾—åˆ°ä¸–ç•Œç©ºé—´ä¸‹çš„åæ ‡è¡¨ç¤º<code>worldPos</code>ã€‚</p><blockquote><p>ç¬”è€…åœ¨å†™è¿™æ®µåšå®¢çš„æ—¶å€™è¿˜æ²¡æœ‰å¥½å¥½çœ‹ä»£ç ï¼Œè¢«æŠ•å½±çŸ©é˜µçš„é€†çŸ©é˜µè¿™ä¸ªæ¦‚å¿µæç³Šæ¶‚äº†ï¼Œåœ¨ç¬¬å››ç« ä¸­è®²åˆ°äº†ä»ä¸–ç•Œç©ºé—´åˆ°è§‚å¯Ÿç©ºé—´è¦ç»è¿‡è§†å›¾å˜åŒ–ã€æŠ•å½±å˜æ¢ï¼Œæ€ä¹ˆåˆ°è¿™åªæœ‰ä¸€ä¸ªé€†æŠ•å½±å˜æ¢äº†ï¼Œä½†æ˜¯ä½ çœ‹ä»£ç çš„è¯å‘ç°å…¶å®è¿™ä¸ªçŸ©é˜µæ˜¯è§†å›¾å˜æ¢å’ŒæŠ•å½±å˜åŒ–çŸ©é˜µçš„ä¹˜ç§¯</p></blockquote><p>ä¸€æ—¦å¾—åˆ°äº†ä¸–ç•Œç©ºé—´ä¸‹çš„åæ ‡ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å‰ä¸€å¸§çš„è§†è§’*æŠ•å½±çŸ©é˜µå¯¹å®ƒè¿›è¡Œå˜æ¢ï¼Œå¾—åˆ°å‰ä¸€å¸§åœ¨NDCä¸‹çš„åæ ‡previousPosã€‚ç„¶åï¼Œæˆ‘ä»¬è®¡ç®—å‰ä¸€å¸§å’Œå½“å‰å¸§åœ¨å±å¹•ç©ºé—´ä¸‹çš„ä½ç½®å·®ï¼Œå¾—åˆ°è¯¥åƒç´ çš„velocityã€‚</p><p>C#ä»£ç å¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">namespace Shader.Chapter13</span><br><span class="line">&#123;</span><br><span class="line">    public class MotionBlurWithDepthTexture : MonoBehaviour</span><br><span class="line">    &#123;</span><br><span class="line">        private static readonly int BlurSize = UnityEngine.Shader.PropertyToID(&quot;_BlurSize&quot;);</span><br><span class="line">        private static readonly int PreviousViewProjectionMatrix = UnityEngine.Shader.PropertyToID(&quot;_PreviousViewProjectionMatrix&quot;);</span><br><span class="line">        private static readonly int CurrentViewProjectionInverseMatrix = UnityEngine.Shader.PropertyToID(&quot;_CurrentViewProjectionInverseMatrix&quot;);</span><br><span class="line">        public UnityEngine.Shader motionBlurShader;</span><br><span class="line">        </span><br><span class="line">        private Material motionBlurMaterial;</span><br><span class="line">        private Camera _camera;</span><br><span class="line"></span><br><span class="line">        private void OnEnable()</span><br><span class="line">        &#123;</span><br><span class="line">            if (motionBlurMaterial == null)</span><br><span class="line">            &#123;</span><br><span class="line">                motionBlurMaterial = new Material(motionBlurShader);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (_camera == null)</span><br><span class="line">            &#123;</span><br><span class="line">                _camera = GetComponent&lt;Camera&gt;();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            _camera.depthTextureMode |= DepthTextureMode.Depth;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [Range(0.0f, 1.0f)] public float blurSize = 0.5f;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        private Matrix4x4 previousViewProjectionMatrix;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        private void OnRenderImage(RenderTexture source, RenderTexture destination)</span><br><span class="line">        &#123;</span><br><span class="line">            if (motionBlurMaterial != null)</span><br><span class="line">            &#123;</span><br><span class="line">                motionBlurMaterial.SetFloat(BlurSize, blurSize);</span><br><span class="line">                motionBlurMaterial.SetMatrix(PreviousViewProjectionMatrix, previousViewProjectionMatrix);</span><br><span class="line">                </span><br><span class="line">                Matrix4x4 currentViewProjectionMatrix = _camera.projectionMatrix * _camera.worldToCameraMatrix;</span><br><span class="line">                Matrix4x4 currentCurrentViewProjectionInverseMatrix = currentViewProjectionMatrix.inverse;</span><br><span class="line">                motionBlurMaterial.SetMatrix(CurrentViewProjectionInverseMatrix, currentCurrentViewProjectionInverseMatrix);</span><br><span class="line">                previousViewProjectionMatrix = currentViewProjectionMatrix;</span><br><span class="line">                </span><br><span class="line">                Graphics.Blit(source, destination, motionBlurMaterial);</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                Graphics.Blit(source, destination);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1>å…¨å±€é›¾æ•ˆ</h1><p>é›¾æ•ˆ(Fog)æ˜¯æ¸¸æˆé‡Œç»å¸¸ä½¿ç”¨çš„ä¸€ç§æ•ˆæœã€‚Unityå†…ç½®çš„é›¾æ•ˆå¯ä»¥äº§ç”ŸåŸºäºè·ç¦»çš„çº¿æ€§æˆ–æŒ‡æ•°é›¾æ•ˆã€‚ç„¶è€Œï¼Œæƒ³è¦åœ¨è‡ªå·±ç¼–å†™çš„é¡¶ç‚¹/ç‰‡å…ƒç€è‰²å™¨ä¸­å®ç°è¿™äº›é›¾æ•ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨Shaderä¸­æ·»åŠ <code>#pragma multi_compile_fog</code>æŒ‡ä»¤ï¼ŒåŒæ—¶è¿˜éœ€è¦ä½¿ç”¨ç›¸å…³çš„å†…ç½®å®ï¼Œä¾‹å¦‚UNITY_FOG_COORDSã€UNITY_TRANSFER_FOGå’ŒUNITY_APPLY_FOGç­‰ã€‚è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹åœ¨äºï¼Œæˆ‘ä»¬ä¸ä»…è¦ä¸ºåœºæ™¯ä¸­æ‰€æœ‰ç‰©ä½“æ·»åŠ ç›¸å…³çš„æ¸²æŸ“ä»£ç ï¼Œè€Œä¸”èƒ½å¤Ÿå®ç°çš„æ•ˆæœéå¸¸æœ‰é™ã€‚å½“æˆ‘ä»¬éœ€è¦å¯¹é›¾æ•ˆè¿›è¡Œä¸€äº›ä¸ªæ€§åŒ–æ“ä½œæ—¶ï¼Œä¾‹å¦‚ä½¿ç”¨åŸºäºé«˜åº¦çš„é›¾æ•ˆç­‰ï¼Œä»…ä»…ä½¿ç”¨Unityå†…ç½®çš„é›¾æ•ˆå°±å˜å¾—ä¸å†å¯è¡Œã€‚</p><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šå­¦ä¹ ä¸€ç§åŸºäºå±å¹•åå¤„ç†çš„å…¨å±€é›¾æ•ˆçš„å®ç°ã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ›´æ”¹åœºæ™¯å†…æ¸²æŸ“çš„ç‰©ä½“æ‰€ä½¿ç”¨çš„Shaderä»£ç ï¼Œè€Œä»…ä»…ä¾é ä¸€æ¬¡å±å¹•åå¤„ç†æ­¥éª¤å³å¯ã€‚è¿™ç§æ–¹æ³•çš„è‡ªç”±åº¦å¾ˆé«˜ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°æ¨¡æ‹Ÿå„ç§é›¾æ•ˆï¼Œä¾‹å¦‚å‡åŒ€çš„é›¾æ•ˆã€åŸºäºè·ç¦»çš„çº¿æ€§/æŒ‡æ•°é›¾æ•ˆã€åŸºäºé«˜åº¦çš„é›¾æ•ˆç­‰ã€‚åœ¨å­¦ä¹ å®Œæœ¬èŠ‚åï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ç±»ä¼¼ä¸‹å›¾çš„æ•ˆæœã€‚</p><p>åŸºäºå±å¹•åå¤„ç†çš„å…¨å±€é›¾æ•ˆçš„å…³é”®æ˜¯ï¼Œæ ¹æ®æ·±åº¦çº¹ç†æ¥é‡å»ºæ¯ä¸ªåƒç´ åœ¨ä¸–ç•Œç©ºé—´ä¸‹çš„ä½ç½®ã€‚å°½ç®¡åœ¨13.2èŠ‚ä¸­ï¼Œæˆ‘ä»¬åœ¨æ¨¡æ‹Ÿè¿åŠ¨æ¨¡ç³Šæ—¶å·²ç»å®ç°äº†è¿™ä¸ªéœ€æ±‚ï¼Œå³æ„å»ºå‡ºå½“å‰åƒç´ çš„NDCåæ ‡ï¼Œå†é€šè¿‡å½“å‰æ‘„åƒæœºçš„è§†è§’ä¹˜æŠ•å½±çŸ©é˜µçš„é€†çŸ©é˜µæ¥å¾—åˆ°ä¸–ç•Œç©ºé—´ä¸‹çš„åƒç´ åæ ‡ã€‚ä½†æ˜¯è¿™æ ·çš„å®ç°éœ€è¦åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­è¿›è¡ŒçŸ©é˜µä¹˜æ³•çš„æ“ä½œï¼Œè€Œè¿™é€šå¸¸ä¼šå½±å“æ¸¸æˆçš„æ€§èƒ½ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šå­¦ä¹ ä¸€ä¸ªå¿«é€Ÿä»æ·±åº¦çº¹ç†ä¸­æ„å»ºä¸–ç•Œåæ ‡çš„æ–¹æ³•ã€‚è¿™ç§æ–¹æ³•é¦–å…ˆå¯¹å›¾åƒç©ºé—´ä¸‹çš„è§†é”¥ä½“å°„çº¿ï¼ˆä»æ‘„åƒæœºå‡ºå‘ï¼ŒæŒ‡å‘å›¾åƒä¸Šçš„æŸç‚¹çš„å°„çº¿ï¼‰è¿›è¡Œæ’å€¼ï¼Œè¿™æ¡å°„çº¿å­˜å‚¨äº†è¯¥åƒç´ åœ¨ä¸–ç•Œç©ºé—´ä¸‹åˆ°æ‘„åƒæœºçš„æ–¹å‘ä¿¡æ¯ã€‚ç„¶åï¼Œæˆ‘ä»¬æŠŠè¯¥å°„çº¿å’Œçº¿æ€§åŒ–åçš„è§†è§’ç©ºé—´ä¸‹çš„æ·±åº¦å€¼æƒ³æˆï¼Œå†åŠ ä¸Šæ‘„åƒæœºçš„ä¸–ç•Œä½ç½®ï¼Œå°±å¯ä»¥å¾—åˆ°è¯¥åƒç´ åœ¨ä¸–ç•Œç©ºé—´ä¸‹çš„ä½ç½®ã€‚å½“æˆ‘ä»¬å¾—åˆ°ä¸–ç•Œåæ ‡åï¼Œå°±å¯ä»¥è½»æ¾åœ°ä½¿ç”¨å„ä¸ªå…¬å¼æ¥æ¨¡æ‹Ÿå…¨å±€é›¾æ•ˆäº†ã€‚</p><h2 id="é‡å»ºä¸–ç•Œåæ ‡">é‡å»ºä¸–ç•Œåæ ‡</h2><p>åœ¨åŠ¨æ‰‹å¼€å§‹å†™ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥äº†è§£å¦‚ä½•ä»æ·±åº¦çº¹ç†ä¸­é‡å»ºä¸–ç•Œåæ ‡ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåæ ‡ä¸­çš„ä¸€ä¸ªé¡¶ç‚¹åæ ‡å¯ä»¥é€šè¿‡å®ƒç›¸å¯¹äºå¦ä¸€ä¸ªé¡¶ç‚¹åæ ‡çš„åç§»é‡æ¥æ±‚å¾—ã€‚é‡å»ºåƒç´ çš„ä¸–ç•Œåæ ‡ä¹Ÿæ˜¯åŸºäºè¿™æ ·çš„æ€æƒ³ã€‚æˆ‘ä»¬åªéœ€è¦çŸ¥é“æ‘„åƒæœºåœ¨ä¸–ç•Œç©ºé—´ä¸‹çš„ä½ç½®ï¼Œä»¥åŠä¸–ç•Œç©ºé—´ä¸‹è¯¥åƒç´ ç›¸å¯¹äºæ‘„åƒæœºçš„åç§»é‡ï¼ŒæŠŠå®ƒä»¬ç›¸åŠ å°±å¯ä»¥å¾—åˆ°è¯¥åƒç´ çš„ä¸–ç•Œåæ ‡ã€‚æ•´ä¸ªè¿‡ç¨‹å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç æ¥è¡¨ç¤º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">float worldPos = _WorldSpaceCameraPos + linearDepth * interpolateRay;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>_WorldSpaceCameraPos</code>æ˜¯æ‘„åƒæœºåœ¨ä¸–ç•Œç©ºé—´ä¸‹çš„ä½ç½®ï¼Œè¿™å¯ä»¥ç”±Unityçš„å†…ç½®å˜é‡ç›´æ¥è®¿é—®å¾—åˆ°ã€‚è€Œ<code>linearDepth * interpolatedRay</code>åˆ™å¯ä»¥è®¡ç®—å¾—åˆ°è¯¥åƒç´ ç›¸å¯¹äºæ‘„åƒæœºçš„åç§»é‡ï¼Œ<code>linearDepth</code>æ˜¯ç”±æ·±åº¦çº¹ç†å¾—åˆ°çš„çº¿æ€§æ·±åº¦å€¼ï¼Œ<code>interpolatedRay</code>æ˜¯ç”±é¡¶ç‚¹ç€è‰²å™¨è¾“å‡ºå¹¶æ’å€¼åå¾—åˆ°çš„å°„çº¿ï¼Œå®ƒä¸ä»…åŒ…å«äº†è¯¥åƒç´ åˆ°æ‘„åƒæœºçš„æ–¹å‘ï¼Œä¹ŸåŒ…å«äº†è·ç¦»ä¿¡æ¯ã€‚<code>linearDepth</code>çš„è·å–æˆ‘ä»¬å·²ç»åœ¨å‰é¢çš„å°èŠ‚ä¸­è¯¦ç»†è§£é‡Šè¿‡äº†ï¼Œå› æ­¤ï¼Œæœ¬èŠ‚ç€é‡è§£é‡Š<code>interpolatedRay</code>çš„æ±‚æ³•ã€‚</p><p><code>interpolatedRay</code>æ¥æºäºå¯¹è¿‘è£åˆ‡å¹³é¢çš„4ä¸ªè§’çš„æŸä¸ªç‰¹å®šå‘é‡çš„æ’å€¼ï¼Œè¿™4ä¸ªå‘é‡åŒ…æ‹¬äº†å®ƒä»¬åˆ°æ‘„åƒæœºçš„æ–¹å‘å’Œè·ç¦»ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ‘„åƒæœºçš„è¿‘è£åˆ‡å¹³é¢è·ç¦»ã€FOVã€çºµæ¨ªæ¯”è®¡ç®—è€Œå¾—ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†è®¡ç®—æ—¶ä½¿ç”¨çš„ä¸€äº›è¾…åŠ©å‘é‡ã€‚ä¸ºäº†æ–¹ä¾¿è®¡ç®—ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆè®¡ç®—ä¸¤ä¸ªå‘é‡â€”â€”toTopå’ŒtoRightï¼Œæ˜¾ç¤ºäº†è®¡ç®—æ—¶ä½¿ç”¨çš„ä¸€äº›è¾…åŠ©å‘é‡ã€‚åˆ†åˆ«æŒ‡å‘æ‘„åƒæœºæ­£ä¸Šæ–¹å’Œæ­£å³æ–¹çš„å‘é‡ã€‚å®ƒä»¬çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><p>$$half = Near \times tan(\frac{FOV}{2})$$<br>$$toTop = camera.up \times halfHeight$$<br>$$toRight = camera.right \times halfHeight \cdot aspect$$</p><p>å…¶ä¸­ï¼ŒNearæ˜¯è¿‘è£åˆ‡å¹³é¢çš„è·ç¦»ï¼ŒFOVæ˜¯ç«–ç›´æ–¹å‘çš„è§†è§’èŒƒå›´ï¼Œcamera.upã€camera.rightåˆ†åˆ«å¯¹åº”äº†æ‘„åƒæœºçš„æ­£ä¸Šæ–¹å’Œæ­£å³æ–¹ã€‚<br>å½“å¾—åˆ°è¿™ä¸¤ä¸ªè¾…åŠ©å‘é‡åï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¡ç®—4ä¸ªè§’ç›¸å¯¹äºæ‘„åƒæœºçš„æ–¹å‘äº†ã€‚æˆ‘ä»¬ä»¥å·¦ä¸Šè§’ä¸ºä¾‹(è§ä¸‹å›¾çš„TLç‚¹)ï¼Œå®ƒçš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><p>$$TL = camera.forward \cdot Near + toTop - toRight$$</p><p>è¯»è€…å¯ä»¥ä¾é åŸºæœ¬çš„çŸ¢é‡è¿ç®—éªŒè¯ä¸Šé¢çš„ç»“æœã€‚åŒç†ï¼Œå…¶ä»–ä¸‰ä¸ªè§’çš„è®¡ç®—ä¹Ÿæ˜¯ç±»ä¼¼çš„:</p><p>$$TR = camera.forward \cdot Near + toTop + toRight$$<br>$$BL = camera.forward \cdot Near - toTop - toRight$$<br>$$BR = camera.forward \cdot Near - toTop + toRight$$</p><img src="/posts/b2c547d7/image-4.png" class=""><p>æ³¨æ„ï¼Œä¸Šé¢æ±‚å¾—çš„4ä¸ªå‘é‡ä¸ä»…åŒ…å«äº†æ–¹å‘ä¿¡æ¯ï¼Œå®ƒä»¬çš„æ¨¡å¯¹åº”äº†4ä¸ªç‚¹åˆ°æ‘„åƒæœºçš„ç©ºé—´è·ç¦»ã€‚ç”±äºæˆ‘ä»¬å¾—åˆ°çš„çº¿æ€§æ·±åº¦å€¼å¹¶éæ˜¯ç‚¹åˆ°æ‘„åƒæœºçš„æ¬§å¼è·ç¦»ï¼Œè€Œæ˜¯åœ¨zæ–¹å‘ä¸Šçš„è·ç¦»ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½ç›´æ¥ä½¿ç”¨æ·±åº¦å€¼å’Œ4ä¸ªè§’çš„å•ä½æ–¹å‘çš„ä¹˜ç§¯æ¥è®¡ç®—å®ƒä»¬åˆ°æ‘„åƒæœºçš„åç§»é‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæƒ³è¦æŠŠæ·±åº¦å€¼è½¬æ¢æˆåˆ°æ‘„åƒæœºçš„æ¬§å¼è·ç¦»ä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬ä»¥TLç‚¹ä¸ºä¾‹ï¼Œæ ¹æ®ç›¸ä¼¼ä¸‰è§’å½¢åŸç†ï¼ŒTLæ‰€åœ¨çš„å°„çº¿ä¸Šï¼Œåƒç´ çš„æ·±åº¦å€¼å’Œå®ƒåˆ°æ‘„åƒæœºçš„å®é™…è·ç¦»çš„æ¯”ç­‰äºè¿‘è£å‰ªå¹³é¢çš„è·ç¦»å’ŒTLå‘é‡çš„æ¨¡çš„æ¯”ï¼Œå³:</p><p>$$\frac{depth}{dist} = \frac{Near}{|TL|}$$</p><p>ç”±æ­¤å¯å¾—ï¼Œæˆ‘ä»¬éœ€è¦çš„TLè·ç¦»æ‘„åƒæœºçš„æ¬§å¼è·ç¦»dist:</p><p>$$ dist = \frac{|TL|}{Near} \times depth$$</p><p>ç”±äº4ä¸ªç‚¹ç›¸äº’å¯¹ç§°ï¼Œå› æ­¤å…¶ä»–ä¸‰ä¸ªå‘é‡çš„æ¨¡å’ŒTLç›¸ç­‰ï¼Œå³æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªå› å­å’Œå•ä½å‘é‡ç›¸ä¹˜ï¼Œå¾—åˆ°å®ƒä»¬å¯¹åº”çš„å‘é‡å€¼</p><p>$$scale = \frac{|TL|}{|Near|}$$</p><p>$$Ray_{TL} = \frac{TL}{|TL|} \times scale, Ray_{TR} = \frac{TR}{|TR|} \times scale$$<br>$$Ray_{BL} = \frac{BL}{|BL|} \times scale, Ray_{BR} = \frac{BR}{|BR|} \times scale$$</p><img src="/posts/b2c547d7/image-5.png" class=""><p>å±å¹•åå¤„ç†çš„åŸç†æ˜¯ä½¿ç”¨ç‰¹å®šçš„æè´¨å»æ¸²æŸ“ä¸€ä¸ªåˆšå¥½å¡«å……æ•´ä¸ªå±å¹•çš„å››è¾¹å½¢é¢ç‰‡ã€‚è¿™ä¸ªå››è¾¹å½¢é¢ç‰‡çš„4ä¸ªé¡¶ç‚¹å°±å¯¹åº”äº†è¿‘è£å‰ªå¹³é¢çš„4ä¸ªè§’ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢çš„è®¡ç®—ç»“æœä¼ é€’ç»™é¡¶ç‚¹ç€è‰²å™¨ï¼Œé¡¶ç‚¹ç€è‰²å™¨æ ¹æ®å½“å‰çš„ä½ç½®é€‰æ‹©å®ƒæ‰€å¯¹åº”çš„å‘é‡ï¼Œç„¶åå†å°†å…¶è¾“å‡ºï¼Œç»è¿‡æ’å€¼åä¼ é€’ç»™ç‰‡å…ƒç€è‰²å™¨å¾—åˆ°interpolatedRayï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åˆ©ç”¨æœ¬èŠ‚ä¸€å¼€å§‹æåˆ°çš„å…¬å¼é‡å»ºè¯¥åƒç´ åœ¨ä¸–ç•Œç©ºé—´ä¸‹çš„ä½ç½®äº†ã€‚</p><h2 id="é›¾çš„è®¡ç®—">é›¾çš„è®¡ç®—</h2><p>åœ¨ç®€å•çš„é›¾æ•ˆå®ç°ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—ä¸€ä¸ªé›¾æ•ˆç³»æ•°fï¼Œä½œä¸ºæ··åˆåŸå§‹é¢œè‰²å’Œé›¾çš„é¢œè‰²çš„æ··åˆç³»æ•°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">float afterFog = f * fogColor + (1 - f) * origColor;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé›¾æ•ˆç³»æ•°$f$æœ‰å¾ˆå¤šè®¡ç®—æ–¹æ³•ã€‚åœ¨Unityå†…ç½®çš„é›¾æ•ˆå®ç°ä¸­ï¼Œæ”¯æŒä¸‰ç§é›¾æ•ˆçš„è®¡ç®—æ–¹å¼â€”â€”çº¿æ€§(Linear)ã€æŒ‡æ•°(Exponential)ä»¥åŠæŒ‡æ•°çš„å¹³æ–¹(Exponential Squared)ã€‚å½“ç»™å®šè·ç¦»zåï¼Œ$f$çš„è®¡ç®—å…¬å¼åˆ†åˆ«å¦‚ä¸‹:</p><p>Linear:</p><p>$$f = \frac{d_{max} - |z|}{d_{max} - d_{min}}$$</p><p>å…¶ä¸­$d_{min}$å’Œ$d_{max}$åˆ†åˆ«è¡¨ç¤ºå—é›¾å½±å“çš„æœ€å°è·ç¦»å’Œæœ€å¤§è·ç¦»ã€‚</p><p>Exponential:</p><p>$$f = e^{-d \cdot |z|}$$</p><p>å…¶ä¸­dæ˜¯æ§åˆ¶é›¾çš„æµ“åº¦çš„å‚æ•°</p><p>Exponential Squardï¼š</p><p>$$f = e ^ {-(d - |z|)^2}$$</p><p>dæ˜¯æ§åˆ¶é›¾çš„æµ“åº¦çš„å‚æ•°</p><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç±»ä¼¼çº¿æ€§é›¾çš„è®¡ç®—æ–¹å¼ï¼Œè®¡ç®—åŸºäºé«˜åº¦çš„é›¾æ•ˆã€‚å…·ä½“æ–¹æ³•æ˜¯ï¼Œå½“ç»™å®šä¸€ç‚¹åœ¨ä¸–ç•Œç©ºé—´ä¸‹çš„é«˜åº¦yåï¼Œ$f$çš„è®¡ç®—å…¬å¼ä¸ºï¼š</p><p>$$f = \frac{H_{end} - y}{H_{end} - H_{start}}$$</p><p>å…¶ä¸­$H_{start}$å’Œ$H_{end}$åˆ†åˆ«è¡¨ç¤ºå—é›¾å½±å“çš„èµ·å§‹é«˜åº¦å’Œç»ˆæ­¢é«˜åº¦ã€‚</p><h2 id="å®ç°">å®ç°</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Custom/FogWithDepthTexture&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _MainTex (&quot;Base (RGB)&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _FogDensity (&quot;Rog Density&quot;, Float) = 1.0</span><br><span class="line">        _FogColor (&quot;Fog Color&quot;, Color) = (1, 1, 1, 1)</span><br><span class="line">        _FogStart (&quot;Fog Start&quot;, Float) = 0.0</span><br><span class="line">        _FogEnd (&quot;Fog End&quot;, Float) = 1.0</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        CGINCLUDE</span><br><span class="line"></span><br><span class="line">        #include &quot;UnityCG.cginc&quot;</span><br><span class="line"></span><br><span class="line">        float4x4 _FrustumCornersRay;</span><br><span class="line">        </span><br><span class="line">        sampler2D _MainTex;</span><br><span class="line">        half4 _MainTex_TexelSize;</span><br><span class="line">        sampler2D _CameraDepthTexture;</span><br><span class="line">        half _FogDensity;</span><br><span class="line">        fixed4 _FogColor;</span><br><span class="line">        float _FogStart;</span><br><span class="line">        float _FogEnd;</span><br><span class="line"></span><br><span class="line">        struct v2f</span><br><span class="line">        &#123;</span><br><span class="line">            float4 pos : SV_POSITION;</span><br><span class="line">            half2 uv : TEXCOORD0;</span><br><span class="line">            half2 uv_depth : TEXCOORD1;</span><br><span class="line">            float4 interpolatedRay : TEXCOORD2;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        v2f vert(appdata_img v)</span><br><span class="line">        &#123;</span><br><span class="line">            v2f o;</span><br><span class="line">            o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">            o.uv = v.texcoord;</span><br><span class="line">            o.uv_depth = v.texcoord;</span><br><span class="line"></span><br><span class="line">            #if UNITY_UV_STARTS_AT_TOP</span><br><span class="line">            if(_MainTex_TexelSize.y &lt; 0)</span><br><span class="line">                o.uv_depth = 1 - o.uv_depth.y;</span><br><span class="line">            #endif</span><br><span class="line"></span><br><span class="line">            int index = 0;</span><br><span class="line">            if(v.texcoord.x &lt; 0.5 &amp;&amp; v.texcoord.y &lt; 0.5)</span><br><span class="line">            &#123;</span><br><span class="line">                index = 0;</span><br><span class="line">            &#125;else if(v.texcoord.x &gt; 0.5 &amp;&amp; v.texcoord.y &lt; 0.5)</span><br><span class="line">            &#123;</span><br><span class="line">                index = 1;</span><br><span class="line">            &#125;else if(v.texcoord.x &gt; 0.5 &amp;&amp; v.texcoord.y &gt; 0.5)</span><br><span class="line">            &#123;</span><br><span class="line">                index = 2;</span><br><span class="line">            &#125;else</span><br><span class="line">            &#123;</span><br><span class="line">                index = 3;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            #if UNITY_UV_STARTS_AT_TOP</span><br><span class="line">            if(_MainTex_TexelSize.y &lt; 0)</span><br><span class="line">                index = 3 - index;</span><br><span class="line">            #endif</span><br><span class="line"></span><br><span class="line">            o.interpolatedRay = _FrustumCornersRay[index];            </span><br><span class="line">            </span><br><span class="line">            return o;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fixed4 frag(v2f i) : SV_Target&#123;</span><br><span class="line"></span><br><span class="line">            float linearDepth = LinearEyeDepth(SAMPLE_DEPTH_TEXTURE(_CameraDepthTexture, i.uv_depth));</span><br><span class="line"></span><br><span class="line">            float3 worldPos = _WorldSpaceCameraPos + linearDepth * i.interpolatedRay.xyz;</span><br><span class="line"></span><br><span class="line">            float fogDensity = (_FogEnd - worldPos.y) / (_FogEnd - _FogStart);</span><br><span class="line">            fogDensity = saturate(fogDensity * _FogDensity);</span><br><span class="line"></span><br><span class="line">            fixed4 finalColor = tex2D(_MainTex, i.uv);</span><br><span class="line">            finalColor.rgb = lerp(finalColor.rgb, _FogColor.rgb, fogDensity);</span><br><span class="line">            </span><br><span class="line">return finalColor;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        ENDCG</span><br><span class="line"></span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            ZTest Always Cull Off ZWrite Off</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Fallback Off</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">namespace Shader.Chapter13</span><br><span class="line">&#123;</span><br><span class="line">    public class FogWithDepthTexture : MonoBehaviour</span><br><span class="line">    &#123;</span><br><span class="line">        private static readonly int FrustumCornersRay = UnityEngine.Shader.PropertyToID(&quot;_FrustumCornersRay&quot;);</span><br><span class="line">        private static readonly int ViewProjectionInverseMatrix = UnityEngine.Shader.PropertyToID(&quot;_ViewProjectionInverseMatrix&quot;);</span><br><span class="line">        private static readonly int FogDensity = UnityEngine.Shader.PropertyToID(&quot;_FogDensity&quot;);</span><br><span class="line">        private static readonly int FogColor = UnityEngine.Shader.PropertyToID(&quot;_FogColor&quot;);</span><br><span class="line">        private static readonly int FogStart = UnityEngine.Shader.PropertyToID(&quot;_FogStart&quot;);</span><br><span class="line">        private static readonly int FogEnd = UnityEngine.Shader.PropertyToID(&quot;_FogEnd&quot;);</span><br><span class="line">        public UnityEngine.Shader fogShader;</span><br><span class="line">        private Material material;</span><br><span class="line"></span><br><span class="line">        private Camera _camera;</span><br><span class="line">        private Transform cameraTransform;</span><br><span class="line">        </span><br><span class="line">        private void OnEnable()</span><br><span class="line">        &#123;</span><br><span class="line">            _camera = GetComponent&lt;Camera&gt;();</span><br><span class="line">            cameraTransform = GetComponent&lt;Transform&gt;();</span><br><span class="line"></span><br><span class="line">            if (material == null)</span><br><span class="line">            &#123;</span><br><span class="line">                material = new Material(fogShader);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            _camera.depthTextureMode |= DepthTextureMode.Depth;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        [Range(0.0f, 3.0f)]</span><br><span class="line">        public float fogDensity = 1.0f;</span><br><span class="line">        </span><br><span class="line">        public Color fogColor = Color.white;</span><br><span class="line">        </span><br><span class="line">        public float fogStart = 0.0f;</span><br><span class="line">        public float fogEnd = 2.0f;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        private void OnRenderImage(RenderTexture source, RenderTexture destination)</span><br><span class="line">        &#123;</span><br><span class="line">            if (material != null)</span><br><span class="line">            &#123;</span><br><span class="line">                Matrix4x4 frustumCorners = Matrix4x4.identity;</span><br><span class="line"></span><br><span class="line">                float fov = _camera.fieldOfView;</span><br><span class="line">                float near = _camera.nearClipPlane;</span><br><span class="line">                float aspect = _camera.aspect;</span><br><span class="line"></span><br><span class="line">                float halfHeight = near * Mathf.Tan(fov * 0.5f * Mathf.Deg2Rad);</span><br><span class="line">                Vector3 toRight = cameraTransform.right * halfHeight * aspect;</span><br><span class="line">                Vector3 toTop = cameraTransform.up * halfHeight;</span><br><span class="line"></span><br><span class="line">                Vector3 topLeft = cameraTransform.forward * near + toTop - toRight;</span><br><span class="line">                float scale = topLeft.magnitude / near;</span><br><span class="line"></span><br><span class="line">                topLeft.Normalize();</span><br><span class="line">                topLeft *= scale;</span><br><span class="line"></span><br><span class="line">                Vector3 topRight = cameraTransform.forward * near + toRight + toTop;</span><br><span class="line">                topRight.Normalize();</span><br><span class="line">                topRight *= scale;</span><br><span class="line"></span><br><span class="line">                Vector3 bottomLeft = cameraTransform.forward * near - toTop - toRight;</span><br><span class="line">                bottomLeft.Normalize();</span><br><span class="line">                bottomLeft *= scale;</span><br><span class="line"></span><br><span class="line">                Vector3 bottomRight = cameraTransform.forward * near + toRight - toTop;</span><br><span class="line">                bottomRight.Normalize();</span><br><span class="line">                bottomRight *= scale;</span><br><span class="line"></span><br><span class="line">                frustumCorners.SetRow(0, bottomLeft);</span><br><span class="line">                frustumCorners.SetRow(1, bottomRight);</span><br><span class="line">                frustumCorners.SetRow(2, topRight);</span><br><span class="line">                frustumCorners.SetRow(3, topLeft);</span><br><span class="line"></span><br><span class="line">                material.SetMatrix(&quot;_FrustumCornersRay&quot;, frustumCorners);</span><br><span class="line"></span><br><span class="line">                material.SetFloat(&quot;_FogDensity&quot;, fogDensity);</span><br><span class="line">                material.SetColor(&quot;_FogColor&quot;, fogColor);</span><br><span class="line">                material.SetFloat(&quot;_FogStart&quot;, fogStart);</span><br><span class="line">                material.SetFloat(&quot;_FogEnd&quot;, fogEnd);</span><br><span class="line"></span><br><span class="line">                Graphics.Blit (source, destination, material);</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                Graphics.Blit(source, destination);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>å†è°ˆè¾¹ç¼˜æ£€æµ‹</h1><p>åœ¨12.3èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ›¾ä»‹ç»å¦‚ä½•ä½¿ç”¨Sobelç®—å­å¯¹å±å¹•å›¾åƒè¿›è¡Œè¾¹ç¼˜æ£€æµ‹ï¼Œå®ç°æè¾¹çš„æ•ˆæœã€‚ä½†æ˜¯ï¼Œè¿™ç§ç›´æ¥åˆ©ç”¨é¢œè‰²ä¿¡æ¯è¿›è¡Œè¾¹ç¼˜æ£€æµ‹çš„æ–¹æ³•ä¼šäº§ç”Ÿå¾ˆå¤šæˆ‘ä»¬ä¸å¸Œæœ›å¾—åˆ°çš„è¾¹ç¼˜çº¿ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><img src="/posts/b2c547d7/image-6.png" class=""><p>å¯ä»¥çœ‹å‡ºï¼Œç‰©ä½“çš„çº¹ç†ã€é˜´å½±ç­‰ä½ç½®ä¹Ÿè¢«æä¸Šé»‘è¾¹ï¼Œè€Œè¿™å¾€å¾€ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›çœ‹åˆ°çš„ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åœ¨æ·±åº¦å’Œæ³•çº¿çº¹ç†ä¸Šè¿›è¡Œè¾¹ç¼˜æ£€æµ‹ï¼Œè¿™äº›å›¾åƒä¸ä¼šå—çº¹ç†å’Œå…‰ç…§çš„å½±å“ï¼Œè€Œä»…ä»…ä¿å­˜äº†å½“å‰æ¸²æŸ“ç‰©ä½“çš„æ¨¡å‹ä¿¡æ¯ï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼æ£€æµ‹å‡ºæ¥çš„è¾¹ç¼˜æ›´åŠ å¯é ã€‚åœ¨å­¦ä¹ å®Œæœ¬èŠ‚åæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸‹å›¾çš„æ•ˆæœã€‚</p><img src="/posts/b2c547d7/image-7.png" class=""><p>ä¸12.3èŠ‚ä½¿ç”¨çš„Sobelç®—å­ä¸åŒï¼Œæœ¬èŠ‚å°†ä½¿ç”¨Robertsç®—å­æ¥è¿›è¡Œè¾¹ç¼˜æ£€æµ‹ã€‚å®ƒä½¿ç”¨çš„å·ç§¯æ ¸å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p>Robertç®—å­çš„æœ¬è´¨å°±æ˜¯è®¡ç®—å·¦ä¸Šè§’å’Œå³ä¸Šè§’çš„å·®å€¼ï¼Œä¹˜ä»¥å³ä¸Šè§’å’Œå·¦ä¸‹è§’çš„å·®å€¼ï¼Œä½œä¸ºè¯„ä¼°è¾¹ç¼˜çš„ä¾æ®ã€‚åœ¨ä¸‹é¢çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä¼šæŒ‰ç…§è¿™æ ·çš„æ–¹å¼ï¼Œå–å¯¹è§’æ–¹å‘çš„æ·±åº¦æˆ–æ³•çº¿å€¼ï¼Œæ¯”è¾ƒå®ƒä»¬ä¹‹é—´çš„å·®å€¼ï¼Œå¦‚æœè¶…è¿‡æŸä¸€ä¸ªé˜ˆå€¼ï¼Œå°±è®¤ä¸ºå®ƒä»¬ä¹‹é—´å­˜åœ¨ä¸€æ¡è¾¹ã€‚</p><img src="/posts/b2c547d7/image-8.png" class=""><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">namespace Shader.Chapter13</span><br><span class="line">&#123;</span><br><span class="line">    public class EdgeDetectNormalsAndDepth : MonoBehaviour &#123;</span><br><span class="line">        private static readonly int EdgeOnly = UnityEngine.Shader.PropertyToID(&quot;_EdgeOnly&quot;);</span><br><span class="line"></span><br><span class="line">        public UnityEngine.Shader edgeDetectShader;</span><br><span class="line">        private Material material = null;</span><br><span class="line"></span><br><span class="line">        [Range(0.0f, 1.0f)]</span><br><span class="line">        public float edgesOnly = 0.0f;</span><br><span class="line"></span><br><span class="line">        public Color edgeColor = Color.black;</span><br><span class="line"></span><br><span class="line">        public Color backgroundColor = Color.white;</span><br><span class="line"></span><br><span class="line">        public float sampleDistance = 1.0f;</span><br><span class="line"></span><br><span class="line">        public float sensitivityDepth = 1.0f;</span><br><span class="line"></span><br><span class="line">        public float sensitivityNormals = 1.0f;</span><br><span class="line"></span><br><span class="line">        void OnEnable() &#123;</span><br><span class="line">            GetComponent&lt;Camera&gt;().depthTextureMode |= DepthTextureMode.DepthNormals;</span><br><span class="line">            material = new Material(edgeDetectShader);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [ImageEffectOpaque]</span><br><span class="line">        void OnRenderImage (RenderTexture src, RenderTexture dest) &#123;</span><br><span class="line">            if (material != null) &#123;</span><br><span class="line">                material.SetFloat(EdgeOnly, edgesOnly);</span><br><span class="line">                material.SetColor(&quot;_EdgeColor&quot;, edgeColor);</span><br><span class="line">                material.SetColor(&quot;_BackgroundColor&quot;, backgroundColor);</span><br><span class="line">                material.SetFloat(&quot;_SampleDistance&quot;, sampleDistance);</span><br><span class="line">                material.SetVector(&quot;_Sensitivity&quot;, new Vector4(sensitivityNormals, sensitivityDepth, 0.0f, 0.0f));</span><br><span class="line"></span><br><span class="line">                Graphics.Blit(src, dest, material);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                Graphics.Blit(src, dest);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸ºOnRenderImageå‡½æ•°æ·»åŠ äº†[ImageEffectOpaque]å±æ€§ï¼Œæˆ‘ä»¬æ›¾åœ¨12.1èŠ‚æåˆ°è¿‡è¿™ä¸ªå±æ€§çš„å«ä¹‰ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒOnRenderImageå‡½æ•°ä¼šåœ¨æ‰€æœ‰çš„ä¸é€æ˜å’Œé€æ˜çš„Passæ‰§è¡Œå®Œæˆä¹‹åè¢«è°ƒç”¨ï¼Œä»¥ä¾¿å¯¹åœºæ™¯ä¸­çš„æ‰€æœ‰æ¸¸æˆå¯¹è±¡éƒ½äº§ç”Ÿå½±å“ã€‚ä½†æœ‰æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ä¸é€æ˜çš„Pass(å³æ¸²æŸ“é˜Ÿåˆ—å°äºç­‰äº2500çš„Passï¼Œå†…ç½®çš„Backgroundã€Geometryå’ŒAlphaTestæ¸²æŸ“é˜Ÿåˆ—å‡åœ¨æ­¤èŒƒå›´å†…)æ‰§è¡Œå®Œæ¯•åç«‹å³è°ƒç”¨è¯¥å‡½æ•°ï¼Œè€Œä¸å¯¹é€æ˜ç‰©ä½“(æ¸²æŸ“é˜Ÿåˆ—ä¸ºTransparentPass)äº§ç”Ÿå½±å“ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨OnRenderImageå‡½æ•°å‰é¢æ·»åŠ [ImageEffectOpaque]å±æ€§æ¥å®ç°è¿™æ ·çš„ç›®çš„ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬åªå¸Œæœ›å¯¹ä¸é€æ˜ç‰©ä½“è¿›è¡Œæè¾¹ï¼Œè€Œä¸å¸Œæœ›é€æ˜ç‰©ä½“ä¹Ÿè¢«æè¾¹ï¼Œå› æ­¤éœ€è¦æ·»åŠ è¯¥å±æ€§ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">// Upgrade NOTE: replaced &#x27;mul(UNITY_MATRIX_MVP,*)&#x27; with &#x27;UnityObjectToClipPos(*)&#x27;</span><br><span class="line"></span><br><span class="line">Shader &quot;Unity Shaders Book/Chapter 13/Edge Detection Normals And Depth&quot; &#123;</span><br><span class="line">Properties &#123;</span><br><span class="line">_MainTex (&quot;Base (RGB)&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">_EdgeOnly (&quot;Edge Only&quot;, Float) = 1.0</span><br><span class="line">_EdgeColor (&quot;Edge Color&quot;, Color) = (0, 0, 0, 1)</span><br><span class="line">_BackgroundColor (&quot;Background Color&quot;, Color) = (1, 1, 1, 1)</span><br><span class="line">_SampleDistance (&quot;Sample Distance&quot;, Float) = 1.0</span><br><span class="line">_Sensitivity (&quot;Sensitivity&quot;, Vector) = (1, 1, 1, 1)</span><br><span class="line">&#125;</span><br><span class="line">SubShader &#123;</span><br><span class="line">CGINCLUDE</span><br><span class="line"></span><br><span class="line">#include &quot;UnityCG.cginc&quot;</span><br><span class="line"></span><br><span class="line">sampler2D _MainTex;</span><br><span class="line">half4 _MainTex_TexelSize;</span><br><span class="line">fixed _EdgeOnly;</span><br><span class="line">fixed4 _EdgeColor;</span><br><span class="line">fixed4 _BackgroundColor;</span><br><span class="line">float _SampleDistance;</span><br><span class="line">half4 _Sensitivity;</span><br><span class="line"></span><br><span class="line">sampler2D _CameraDepthNormalsTexture;</span><br><span class="line"></span><br><span class="line">struct v2f &#123;</span><br><span class="line">float4 pos : SV_POSITION;</span><br><span class="line">half2 uv[5]: TEXCOORD0;</span><br><span class="line">&#125;;</span><br><span class="line">  </span><br><span class="line">v2f vert(appdata_img v) &#123;</span><br><span class="line">v2f o;</span><br><span class="line">o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line"></span><br><span class="line">half2 uv = v.texcoord;</span><br><span class="line">o.uv[0] = uv;</span><br><span class="line"></span><br><span class="line">#if UNITY_UV_STARTS_AT_TOP</span><br><span class="line">if (_MainTex_TexelSize.y &lt; 0)</span><br><span class="line">uv.y = 1 - uv.y;</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">o.uv[1] = uv + _MainTex_TexelSize.xy * half2(1,1) * _SampleDistance;</span><br><span class="line">o.uv[2] = uv + _MainTex_TexelSize.xy * half2(-1,-1) * _SampleDistance;</span><br><span class="line">o.uv[3] = uv + _MainTex_TexelSize.xy * half2(-1,1) * _SampleDistance;</span><br><span class="line">o.uv[4] = uv + _MainTex_TexelSize.xy * half2(1,-1) * _SampleDistance;</span><br><span class="line"> </span><br><span class="line">return o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">half CheckSame(half4 center, half4 sample) &#123;</span><br><span class="line">half2 centerNormal = center.xy;</span><br><span class="line">float centerDepth = DecodeFloatRG(center.zw);</span><br><span class="line">half2 sampleNormal = sample.xy;</span><br><span class="line">float sampleDepth = DecodeFloatRG(sample.zw);</span><br><span class="line"></span><br><span class="line">// difference in normals</span><br><span class="line">// do not bother decoding normals - there&#x27;s no need here</span><br><span class="line">half2 diffNormal = abs(centerNormal - sampleNormal) * _Sensitivity.x;</span><br><span class="line">int isSameNormal = (diffNormal.x + diffNormal.y) &lt; 0.1;</span><br><span class="line">// difference in depth</span><br><span class="line">float diffDepth = abs(centerDepth - sampleDepth) * _Sensitivity.y;</span><br><span class="line">// scale the required threshold by the distance</span><br><span class="line">int isSameDepth = diffDepth &lt; 0.1 * centerDepth;</span><br><span class="line"></span><br><span class="line">// return:</span><br><span class="line">// 1 - if normals and depth are similar enough</span><br><span class="line">// 0 - otherwise</span><br><span class="line">return isSameNormal * isSameDepth ? 1.0 : 0.0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fixed4 fragRobertsCrossDepthAndNormal(v2f i) : SV_Target &#123;</span><br><span class="line">half4 sample1 = tex2D(_CameraDepthNormalsTexture, i.uv[1]);</span><br><span class="line">half4 sample2 = tex2D(_CameraDepthNormalsTexture, i.uv[2]);</span><br><span class="line">half4 sample3 = tex2D(_CameraDepthNormalsTexture, i.uv[3]);</span><br><span class="line">half4 sample4 = tex2D(_CameraDepthNormalsTexture, i.uv[4]);</span><br><span class="line"></span><br><span class="line">half edge = 1.0;</span><br><span class="line"></span><br><span class="line">edge *= CheckSame(sample1, sample2);</span><br><span class="line">edge *= CheckSame(sample3, sample4);</span><br><span class="line"></span><br><span class="line">fixed4 withEdgeColor = lerp(_EdgeColor, tex2D(_MainTex, i.uv[0]), edge);</span><br><span class="line">fixed4 onlyEdgeColor = lerp(_EdgeColor, _BackgroundColor, edge);</span><br><span class="line"></span><br><span class="line">return lerp(withEdgeColor, onlyEdgeColor, _EdgeOnly);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ENDCG</span><br><span class="line"></span><br><span class="line">Pass &#123; </span><br><span class="line">ZTest Always Cull Off ZWrite Off</span><br><span class="line"></span><br><span class="line">CGPROGRAM      </span><br><span class="line"></span><br><span class="line">#pragma vertex vert  </span><br><span class="line">#pragma fragment fragRobertsCrossDepthAndNormal</span><br><span class="line"></span><br><span class="line">ENDCG  </span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line">FallBack Off</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æœ¬èŠ‚å®ç°çš„æè¾¹æ•ˆæœæ˜¯åŸºäºæ•´ä¸ªå±å¹•ç©ºé—´è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœºæ™¯å†…çš„æ‰€æœ‰ç‰©ä½“éƒ½ä¼šè¢«æ·»åŠ æè¾¹æ•ˆæœã€‚ä½†æœ‰æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›åªå¯¹ç‰¹å®šçš„ç‰©ä½“è¿›è¡Œæè¾¹ï¼Œä¾‹å¦‚å½“ç©å®¶é€‰ä¸­åœºæ™¯ä¸­çš„æŸä¸ªç‰©ä½“åï¼Œæˆ‘ä»¬æƒ³è¦åœ¨è¯¥ç‰©ä½“å‘¨å›´æ·»åŠ ä¸€å±‚æè¾¹æ•ˆæœã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Unityæä¾›çš„<code>Graphics.DrawMesh</code>æˆ–è€…<code>Graphics.DrawMeshNow</code>å‡½æ•°æŠŠéœ€è¦æè¾¹çš„ç‰©ä½“å†æ¸²æŸ“ä¸€æ¬¡(åœ¨æ‰€æœ‰ä¸é€æ˜ç‰©ä½“æ¸²æŸ“å®Œæ¯•ä¹‹å)ï¼Œç„¶åå†ä½¿ç”¨æœ¬èŠ‚æåˆ°çš„è¾¹ç¼˜æ£€æµ‹ç®—æ³•è®¡ç®—æ·±åº¦å’Œæ³•çº¿çº¹ç†ä¸­æ¯ä¸ªåƒç´ çš„æ¢¯åº¦å€¼ï¼Œåˆ¤æ–­å®ƒä»¬æ˜¯å¦å°äºæŸä¸ªé˜ˆå€¼ï¼Œå¦‚æœæ˜¯ï¼Œå°±åœ¨Shaderä¸­ä½¿ç”¨clip()å‡½æ•°å°†è¯¥åƒç´ å‰”é™¤æ‰ï¼Œä»è€Œæ˜¾ç¤ºå‡ºåŸæ¥çš„é¢œè‰²ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> UnityShader </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity </tag>
            
            <tag> Shader </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¸¸æˆå¼€å‘ä¸­çš„è®¾è®¡æ¨¡å¼ â€”â€” ç¼“å­˜æ± </title>
      <link href="/posts/c41139c9/"/>
      <url>/posts/c41139c9/</url>
      
        <content type="html"><![CDATA[<p>ç¼“å­˜æ± å¯ä»¥è¯´æ˜¯æ¸¸æˆä¸­éå¸¸å¸¸ç”¨çš„ä¸€ç§è®¾è®¡æ¨¡å¼äº†,</p><p>æ³¨æ„ç”Ÿå‘½å‘¨æœŸ</p>]]></content>
      
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UnityShaderå…¥é—¨ç²¾è¦ç¬”è®°ï¼ˆåäºŒï¼‰â€”â€”å±å¹•åå¤„ç†æ•ˆæœ</title>
      <link href="/posts/a07e7969/"/>
      <url>/posts/a07e7969/</url>
      
        <content type="html"><![CDATA[<p>å±å¹•åå¤„ç†æ•ˆæœæ˜¯æ¸¸æˆä¸­å®ç°å±å¹•ç‰¹æ•ˆçš„å¸¸è§æ–¹æ³•ã€‚åœ¨æœ¬ç« ä¸­æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åœ¨Unityä¸­åˆ©ç”¨æ¸²æŸ“çº¹ç†æ¥å®ç°å„ç§å¸¸è§çš„å±å¹•åå¤„ç†æ•ˆæœã€‚æˆ‘ä»¬é¦–å…ˆè¦å»ºç«‹ä¸€ä¸ªåŸºæœ¬çš„å±å¹•åå¤„ç†è„šæœ¬ç³»ç»Ÿï¼Œéšåæˆ‘ä»¬ä¼šä½¿ç”¨è¿™ä¸ªç³»ç»Ÿå®ç°ä¸€ä¸ªç®€å•çš„è°ƒæ•´ç”»é¢äº®åº¦ã€é¥±å’Œåº¦å’Œå¯¹æ¯”åº¦çš„å±å¹•ç‰¹æ•ˆã€‚ç„¶åæˆ‘ä»¬ä¼šæ¥è§¦åˆ°å›¾åƒæ»¤æ³¢çš„æ¦‚å¿µï¼Œå¹¶åˆ©ç”¨Sobelç®—å­åœ¨å±å¹•ç©ºé—´ä¸­å¯¹å›¾åƒè¿›è¡Œè¾¹ç¼˜æ£€æµ‹ï¼Œå®ç°æè¾¹æ•ˆæœã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬ä¼šå®ç°ä¸€ä¸ªé«˜æ–¯æ¨¡ç³Šçš„å±å¹•ç‰¹æ•ˆã€Bloomå’Œè¿åŠ¨æ¨¡ç³Šçš„æ•ˆæœã€‚</p><h1>å»ºç«‹ä¸€ä¸ªåŸºæœ¬çš„å±å¹•åå¤„ç†è„šæœ¬ç³»ç»Ÿ</h1><blockquote><p>åœ¨Unity5ä¹‹åï¼Œä¹¦é‡Œé¢æåˆ°çš„è¿™ä¸ªåå¤„ç†è„šæœ¬ç³»ç»Ÿçš„åŸºç±»ä¸­ä½¿ç”¨çš„é‚£äº›æ¥å£éƒ½å·²ç»åºŸå¼ƒäº†ï¼Œæ‰€ä»¥è¿™ä¸ªåå¤„ç†è„šæœ¬å¯åŠ¨å…¶å®ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå­˜åœ¨çš„å¿…è¦äº†ã€‚<br>å¦å¤–ï¼Œæœ¬ä¹¦ä½¿ç”¨OnRenderImageçš„æ–¹æ³•å®ç°åå¤„ç†æ•ˆæœçš„æ–¹å¼ä¹Ÿé€æ¸è¢«CommandBufferç»™å–ä»£äº†ï¼Œæ‰€ä»¥ç¬”è€…ä¼šå°è¯•ç”¨CommandBufferçš„æ–¹å¼é‡æ–°å®ç°è¿™ç« çš„æ‰€æœ‰åå¤„ç†æ•ˆæœã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">[ExecuteInEditMode]</span><br><span class="line">[RequireComponent (typeof(Camera))]</span><br><span class="line">public class PostEffectsBase : MonoBehaviour &#123;</span><br><span class="line"></span><br><span class="line">    // Called when start</span><br><span class="line">    protected void CheckResources() &#123;</span><br><span class="line">        bool isSupported = CheckSupport();</span><br><span class="line"></span><br><span class="line">        if (isSupported == false) &#123;</span><br><span class="line">            NotSupported();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Called in CheckResources to check support on this platform</span><br><span class="line">    protected bool CheckSupport() &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Called when the platform doesn&#x27;t support this effect</span><br><span class="line">    protected void NotSupported() &#123;</span><br><span class="line">        enabled = false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected void Start() &#123;</span><br><span class="line">        CheckResources();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Called when need to create the material used by this effect</span><br><span class="line">    protected Material CheckShaderAndCreateMaterial(Shader shader, Material material) &#123;</span><br><span class="line">        if (shader == null) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (shader.isSupported &amp;&amp; material &amp;&amp; material.shader == shader)</span><br><span class="line">            return material;</span><br><span class="line"></span><br><span class="line">        if (!shader.isSupported) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            material = new Material(shader);</span><br><span class="line">            material.hideFlags = HideFlags.DontSave;</span><br><span class="line">            if (material)</span><br><span class="line">                return material;</span><br><span class="line">            else </span><br><span class="line">                return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>è°ƒæ•´å±å¹•çš„äº®åº¦ã€é¥±å’Œåº¦å’Œå¯¹æ¯”åº¦</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class BrightnessSaturationAndContrast : PostEffectsBase</span><br><span class="line">&#123;</span><br><span class="line">    public Shader briSatConShader;</span><br><span class="line">    public Material briSatConMat;</span><br><span class="line">    </span><br><span class="line">    private Material _material</span><br><span class="line">    &#123;</span><br><span class="line">        get</span><br><span class="line">        &#123;</span><br><span class="line">            briSatConMat = CheckShaderAndCreateMaterial(briSatConShader, briSatConMat);</span><br><span class="line">            return briSatConMat;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [Range(0.0f, 3.0f)] public float brightness = 1.0f;</span><br><span class="line">    [Range(0.0f, 3.0f)] public float saturation = 1.0f;</span><br><span class="line">    [Range(0.0f, 3.0f)] public float contrast = 1.0f;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private void OnRenderImage(RenderTexture source, RenderTexture destination)</span><br><span class="line">    &#123;</span><br><span class="line">        if (_material != null)</span><br><span class="line">        &#123;</span><br><span class="line">            _material.SetFloat(&quot;_Brightness&quot;, brightness);</span><br><span class="line">            _material.SetFloat(&quot;_Saturation&quot;, saturation);</span><br><span class="line">            _material.SetFloat(&quot;_Contrast&quot;, contrast);</span><br><span class="line">            </span><br><span class="line">            Graphics.Blit(source, destination, _material);</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            Graphics.Blit(source, destination);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;UnityShaderBook/Chapter 12/BrightnessSaturationAndContrast&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _MainTex (&quot;MainTex&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _Brightness (&quot;Brightness&quot;, Float) = 1</span><br><span class="line">        _Saturation (&quot;Saturation&quot;, Float) = 1</span><br><span class="line">        _Contrast (&quot;Contrast&quot;, Float) = 1</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags</span><br><span class="line">        &#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            ZTest Always</span><br><span class="line">            Cull Off</span><br><span class="line">            ZWrite Off</span><br><span class="line"></span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert;</span><br><span class="line">            #pragma fragment frag;</span><br><span class="line"></span><br><span class="line">            #include &quot;UnityCG.cginc&quot;</span><br><span class="line">            </span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            half _Brightness;</span><br><span class="line">            half _Saturation;</span><br><span class="line">            half _Contrast;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                half2 uv : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f vert(appdata_img v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line">                o.uv = v.texcoord;</span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target&#123;</span><br><span class="line">                fixed4 renderTex = tex2D(_MainTex, i.uv);</span><br><span class="line"></span><br><span class="line">                fixed3 finalColor = renderTex.rgb * _Brightness;</span><br><span class="line"></span><br><span class="line">                fixed luminance = 0.2125 * renderTex.r + 0.7154 * renderTex.g + 0.0721 * renderTex.b;</span><br><span class="line">                fixed3 luminanceColor = fixed3(luminance, luminance, luminance);</span><br><span class="line">                finalColor = lerp(luminanceColor, finalColor, _Saturation);</span><br><span class="line"></span><br><span class="line">                fixed3 avgColor = fixed3(0.5, 0.5, 0.5);</span><br><span class="line">                finalColor = lerp(avgColor, finalColor, _Contrast);</span><br><span class="line"></span><br><span class="line">                return fixed4(finalColor, renderTex.a);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¾—åˆ°å¯¹åŸå±å¹•å›¾åƒï¼ˆå­˜å‚¨åœ¨_MainTexï¼‰ä¸­çš„é‡‡æ ·ç»“æœrenderTexã€‚ç„¶åï¼Œåˆ©ç”¨_Brightnesså±æ€§æ¥è®¡ç®—æ¥è°ƒæ•´äº®åº¦ã€‚äº®åº¦çš„è°ƒæ•´éå¸¸ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠåŸé¢œè‰²ä¹˜ä»¥äº®åº¦ç³»æ•°_Brightnesså³å¯ã€‚ç„¶åï¼Œæˆ‘ä»¬è®¡ç®—è¯¥åƒç´ å€¼å¯¹åº”çš„äº®åº¦å€¼ï¼ˆluminanceï¼‰ï¼Œè¿™æ˜¯é€šè¿‡å¯¹æ¯ä¸ªé¢œè‰²åˆ†é‡ä¹˜ä»¥ä¸€ä¸ªç‰¹å®šçš„ç³»æ•°</p><h1>è¾¹ç¼˜æ£€æµ‹</h1><p>è¾¹ç¼˜æ£€æµ‹çš„åŸç†æ˜¯åˆ©ç”¨ä¸€äº›è¾¹ç¼˜æ£€æµ‹ç®—å­å¯¹å›¾åƒè¿›è¡Œ<code>å·ç§¯(convolution)</code>æ“ä½œï¼Œæˆ‘ä»¬é¦–å…ˆæ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯å·ç§¯ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯å·ç§¯">ä»€ä¹ˆæ˜¯å·ç§¯</h2><p>åœ¨å›¾åƒå¤„ç†ä¸­ï¼Œå·ç§¯æ“ä½œæŒ‡çš„å°±æ˜¯ä½¿ç”¨ä¸€ä¸ª<code>å·ç§¯æ ¸(kernel)</code>å¯¹ä¸€å¼ å›¾ç‰‡ä¸­çš„æ¯ä¸ªåƒç´ è¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œã€‚å·ç§¯æ ¸é€šå¸¸æ˜¯ä¸€ä¸ªå››æ–¹å½¢çš„ç½‘æ ¼ç»“æ„(æ¯”å¦‚ $2 \times 2$ã€$3 \times 3$çš„æ–¹å½¢åŒºåŸŸ)ï¼Œè¯¥åŒºåŸŸå†…æ¯ä¸ªæ–¹æ ¼éƒ½æœ‰ä¸€ä¸ªæƒé‡å€¼ã€‚å½“å¯¹å›¾åƒä¸­æŸä¸ªåƒç´ è¿›è¡Œå·ç§¯æ—¶ï¼Œæˆ‘ä»¬ä¼šæŠŠå·ç§¯æ ¸çš„ä¸­å¿ƒæ”¾ç½®äºè¯¥åƒç´ ä¸Šï¼Œç¿»è½¬æ ¸ä¹‹åå†ä»¥æ­¤è®¡ç®—æ ¸ä¸­æ¯ä¸ªå…ƒç´ å’Œå…¶è¦†ç›–çš„å›¾åƒåƒç´ å€¼çš„ä¹˜ç§¯å¹¶æ±‚å’Œï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯è¯¥ä½ç½®çš„æ–°åƒç´ å€¼ã€‚</p><p>è¿™æ ·çš„è®¡ç®—è¿‡ç¨‹è™½ç„¶ç®€å•ï¼Œä½†æ˜¯å¯ä»¥å®ç°å¾ˆå¤šå¸¸è§çš„å›¾åƒå¤„ç†æ•ˆæœï¼Œä¾‹å¦‚å›¾åƒæ¨¡ç³Šã€è¾¹ç¼˜æ£€æµ‹ç­‰ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦å¯¹å›¾åƒè¿›è¡Œå‡å€¼æ¨¡ç³Šï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ª$3 \times 3$çš„å·ç§¯æ ¸ï¼Œæ ¸å†…æ¯ä¸ªå…ƒç´ çš„å€¼å‡ä¸º1/9ã€‚</p><h2 id="å¸¸è§çš„è¾¹ç¼˜æ£€æµ‹ç®—å­">å¸¸è§çš„è¾¹ç¼˜æ£€æµ‹ç®—å­</h2><p>å·ç§¯æ“ä½œçš„ç¥å¥‡ä¹‹å¤„åœ¨äºé€‰æ‹©çš„å·ç§¯ã€‚é‚£ä¹ˆï¼Œç”¨äºè¾¹ç¼˜æ£€æµ‹çš„å·ç§¯æ ¸åº”è¯¥é•¿ä»€ä¹ˆæ ·å‘¢ï¼Ÿåœ¨å›ç­”è¿™ä¸ªé—®é¢˜å‰ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå›æƒ³ä¸€ä¸‹è¾¹åˆ°åº•æ˜¯å¦‚ä½•å½¢æˆçš„ã€‚å¦‚æœç›¸é‚»åƒç´ ä¹‹é—´å­˜åœ¨å·®åˆ«æ˜æ˜¾çš„é¢œè‰²ã€äº®åº¦ã€çº¹ç†ç­‰å±æ€§ï¼Œæˆ‘ä»¬å°±ä¼šè®¤ä¸ºå®ƒä»¬ä¹‹é—´åº”è¯¥æœ‰ä¸€æ¡è¾¹ç•Œã€‚è¿™ç§ç›¸é‚»åƒç´ ä¹‹é—´çš„å·®å€¼å¯ä»¥ç”¨æ¢¯åº¦(gradient)æ¥è¡¨ç¤ºï¼Œå¯ä»¥æƒ³è±¡åˆ°ï¼Œè¾¹ç¼˜å¤„çš„æ¢¯åº¦ç»å¯¹å€¼ä¼šæ¯”è¾ƒå¤§ã€‚</p><img src="/posts/a07e7969/image.png" class=""><p>3ç§å¸¸è§çš„è¾¹ç¼˜ç®—å­å¦‚å›¾æ‰€ç¤ºï¼Œå®ƒä»¬éƒ½åŒ…å«äº†ä¸¤ä¸ªæ–¹å‘çš„å·ç§¯æ ¸ï¼Œåˆ†åˆ«ç”¨äºæ£€æµ‹æ°´å¹³æ–¹å‘å’Œç«–ç›´æ–¹å‘ä¸Šçš„è¾¹ç¼˜ä¿¡æ¯ã€‚åœ¨è¿›è¡Œè¾¹ç¼˜æ£€æµ‹æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ¯ä¸ªåƒç´ åˆ†åˆ«è¿›è¡Œä¸€æ¬¡å·ç§¯è®¡ç®—ï¼Œå¾—åˆ°ä¸¤ä¸ªæ–¹å‘ä¸Šçš„æ¢¯åº¦å€¼$G_{x}$å’Œ$G_{y}$ ï¼Œè€Œæ•´ä½“çš„æ¢¯åº¦å…¬å¼å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„å…¬å¼è®¡ç®—è€Œå¾—ï¼š<br>$$G=\sqrt{G^2_{x} + G^2_{y}}$$</p><p>ç”±äºä¸Šé¢çš„è®¡ç®—åŒ…å«äº†å¼€æ ¹å·çš„æ“ä½œï¼Œå‡ºäºæ€§èƒ½è€ƒè™‘ã€‚æˆ‘ä»¬æœ‰æ—¶ä¼šä½¿ç”¨ç»å¯¹å€¼æ“ä½œæ¥ä»£æ›¿å¼€æ ¹å·æ“ä½œ:<br>$$G = |G_{x}| + |G_{y}|$$</p><p>å½“æˆ‘ä»¬å¾—åˆ°æ¢¯åº¦Gåï¼Œæˆ‘ä»¬å°±å¯ä»¥æ®æ­¤æ¥åˆ¤æ–­å“ªäº›åƒç´ å¯¹åº”äº†è¾¹ç¼˜ï¼ˆæ¢¯åº¦å€¼è¶Šå¤§è¶Šæœ‰å¯èƒ½æ˜¯è¾¹ç¼˜ç‚¹ï¼‰ã€‚</p><h2 id="å®ç°">å®ç°</h2><p>æœ¬èŠ‚ä¼šä½¿ç”¨Sobelç®—å­è¿›è¡Œè¾¹ç¼˜æ£€æµ‹ï¼Œå®ç°æè¾¹æ•ˆæœã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class EdgeDetection : PostEffectsBase</span><br><span class="line">&#123;</span><br><span class="line">    public Shader edgeDetectShader;</span><br><span class="line">    private Material edgeDetectMaterial = null;</span><br><span class="line"></span><br><span class="line">    public Material material</span><br><span class="line">    &#123;</span><br><span class="line">        get</span><br><span class="line">        &#123;</span><br><span class="line">            edgeDetectMaterial = CheckShaderAndCreateMaterial(edgeDetectShader, edgeDetectMaterial);</span><br><span class="line">            return edgeDetectMaterial;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [Range(0.0f, 1.0f)] public float edgesOnly = 0.0f;</span><br><span class="line">    </span><br><span class="line">    public Color edgeColor = Color.black;</span><br><span class="line">    </span><br><span class="line">    public Color backgroundColor = Color.white;</span><br><span class="line">    private static readonly int EdgeColor = Shader.PropertyToID(&quot;_EdgeColor&quot;);</span><br><span class="line">    private static readonly int EdgeOnly = Shader.PropertyToID(&quot;_EdgeOnly&quot;);</span><br><span class="line">    private static readonly int BackgroundColor = Shader.PropertyToID(&quot;_BackgroundColor&quot;);</span><br><span class="line"></span><br><span class="line">    private void OnRenderImage(RenderTexture source, RenderTexture destination)</span><br><span class="line">    &#123;</span><br><span class="line">        if (material != null)</span><br><span class="line">        &#123;</span><br><span class="line">            material.SetFloat(EdgeOnly, edgesOnly);</span><br><span class="line">            material.SetColor(EdgeColor, edgeColor);</span><br><span class="line">            material.SetColor(BackgroundColor, backgroundColor);</span><br><span class="line">            Graphics.Blit(source, destination, material);</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            Graphics.Blit(source, destination);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Unity Shader Book/Chapter 12/Edge Detection&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _MainTex (&quot;Base (RGB)&quot;, 2D) = &quot;white&quot;&#123;&#125;</span><br><span class="line">        _EdgeOnly (&quot;Edge Only&quot;, Float) = 1.0</span><br><span class="line">        _EdgeColor (&quot;Edge Color&quot;, Color) = (0,0,0,1)</span><br><span class="line">        _BackgroundColor (&quot;Background Color&quot;, Color) = (1,1,1,1)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            ZTest Always</span><br><span class="line">            Cull Off</span><br><span class="line">            ZWrite Off</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert;</span><br><span class="line">            #pragma fragment frag;</span><br><span class="line"></span><br><span class="line">            #include &quot;UnityCG.cginc&quot;</span><br><span class="line">            </span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            half4 _MainTex_TexelSize;</span><br><span class="line">            fixed _EdgeOnly;</span><br><span class="line">            fixed4 _EdgeColor;</span><br><span class="line">            fixed4 _BackgroundColor;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                half2 uv[9] : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f vert(appdata_img v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line"></span><br><span class="line">                half2 uv = v.texcoord;</span><br><span class="line">                o.uv[0] = uv + _MainTex_TexelSize.xy * half2(-1, -1);</span><br><span class="line">                o.uv[1] = uv + _MainTex_TexelSize.xy * half2(0, -1);</span><br><span class="line">                o.uv[2] = uv + _MainTex_TexelSize.xy * half2(1, -1);</span><br><span class="line">                o.uv[3] = uv + _MainTex_TexelSize.xy * half2(-1, 0);</span><br><span class="line">                o.uv[4] = uv + _MainTex_TexelSize.xy * half2(0, 0);</span><br><span class="line">                o.uv[5] = uv + _MainTex_TexelSize.xy * half2(1, 0);</span><br><span class="line">                o.uv[6] = uv + _MainTex_TexelSize.xy * half2(-1, 1);</span><br><span class="line">                o.uv[7] = uv + _MainTex_TexelSize.xy * half2(0, 1);</span><br><span class="line">                o.uv[8] = uv + _MainTex_TexelSize.xy * half2(1, 1);</span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed luminance(fixed4 color)</span><br><span class="line">            &#123;</span><br><span class="line">                return 0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            half Sobel(v2f i)</span><br><span class="line">            &#123;</span><br><span class="line">                const half Gx[9] = &#123;</span><br><span class="line">                    -1, -2, -1,</span><br><span class="line">                    0, 0, 0,</span><br><span class="line">                    1, 2, 1</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                const half Gy[9] = &#123;</span><br><span class="line">                    -1, 0, 1,</span><br><span class="line">                    -2, 0, 2,</span><br><span class="line">                    -1, 0, 1</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                half texColor;</span><br><span class="line">                half edgeX = 0;</span><br><span class="line">                half edgeY = 0;</span><br><span class="line">                for(int it = 0; it &lt; 9; it++)</span><br><span class="line">                &#123;</span><br><span class="line">                    texColor = luminance(tex2D(_MainTex, i.uv[it]));</span><br><span class="line">                    edgeX += texColor * Gx[it];</span><br><span class="line">                    edgeY += texColor * Gy[it];</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                half edge = 1 - abs(edgeX) - abs(edgeY);</span><br><span class="line"></span><br><span class="line">                return edge;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            fixed4 frag(v2f i) : SV_Target&#123;</span><br><span class="line"></span><br><span class="line">                half edge = Sobel(i);</span><br><span class="line"></span><br><span class="line">                fixed4 withEdgeColor = lerp(_EdgeColor, tex2D(_MainTex, i.uv[4]), edge);</span><br><span class="line">                fixed4 onlyEdgeColor = lerp(_EdgeColor, _BackgroundColor, edge);</span><br><span class="line">                return lerp(withEdgeColor, onlyEdgeColor, _EdgeOnly);</span><br><span class="line">            &#125;</span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Fallback Off</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬è¿˜å£°æ˜äº†ä¸€ä¸ªæ–°çš„å˜é‡_MainTex_TexelSizeã€‚xxx_TexelSizeæ˜¯unityä¸ºæˆ‘ä»¬æä¾›çš„è®¿é—®xxxçº¹ç†å¯¹åº”çš„æ¯ä¸ªçº¹ç´ çš„å¤§å°ã€‚ä¾‹å¦‚ä¸€å¼ 512x512å¤§å°çš„çº¹ç†ï¼Œè¯¥å€¼å¤§çº¦æ˜¯0.001953ã€‚ç”±äºå·ç§¯éœ€è¦å¯¹ç›¸é‚»åŒºåŸŸå†…çš„çº¹ç†è¿›è¡Œé‡‡æ ·ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆ©ç”¨_MainTex_TexelSizeæ¥è®¡ç®—å„ä¸ªç›¸é‚»åŒºåŸŸçš„çº¹ç†åæ ‡ã€‚</p><p>æˆ‘ä»¬åœ¨v2fç»“æ„ä½“ä¸­å®šä¹‰äº†ä¸€ä¸ªç»´æ•°ä¸º9çš„çº¹ç†æ•°ç»„ï¼Œå¯¹åº”äº†ä½¿ç”¨Sobelç®—å­é‡‡æ ·æ—¶éœ€è¦çš„9å“¥é‚»åŸŸçº¹ç†åæ ‡ã€‚é€šè¿‡æŠŠè®¡ç®—é‡‡æ ·çº¹ç†åæ ‡çš„ä»£ç ä»ç‰‡å…ƒç€è‰²å™¨ä¸­è½¬ç§»åˆ°é¡¶ç‚¹ç€è‰²å™¨ä¸­ï¼Œå¯ä»¥å‡å°‘è¿ç®—ï¼Œæé«˜æ€§èƒ½ã€‚ç”±äºä»é¡¶ç‚¹ç€è‰²å™¨åˆ°ç‰‡å…ƒç€è‰²å™¨çš„æ’å€¼æ˜¯çº¿æ€§çš„ï¼Œå› æ­¤è¿™æ ·çš„è½¬ç§»å¹¶ä¸ä¼šå½±å“çº¹ç†åæ ‡çš„è®¡ç®—ç»“æœ</p><p>æˆ‘ä»¬é¦–å…ˆè°ƒç”¨Sobelå‡½æ•°è®¡ç®—å½“å‰åƒç´ çš„æ¢¯åº¦å€¼edgeï¼Œå¹¶åˆ©ç”¨è¯¥å€¼åˆ†åˆ«è®¡ç®—äº†èƒŒæ™¯ä¸ºåŸå›¾å’Œçº¯è‰²çš„é¢œè‰²å€¼ï¼Œç„¶ååˆ©ç”¨_EdgeOnlyåœ¨ä¸¤è€…ä¹‹é—´æ’å€¼å¾—åˆ°æœ€ç»ˆçš„åƒç´ å€¼ã€‚Sobelå‡½æ•°åˆ©ç”¨Sobelç®—å­å¯¹åŸå›¾è¿›è¡Œè¾¹ç¼˜æ£€æµ‹ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆå®šä¹‰äº†æ°´å¹³æ–¹å‘å’Œç«–ç›´æ–¹å‘ä½¿ç”¨çš„å·ç§¯æ ¸$G_{x}$å’Œ$G_{y}$ã€‚æ¥ç€ï¼Œæˆ‘ä»¬ä¾æ¬¡å¯¹9ä¸ªåƒç´ è¿›è¡Œé‡‡æ ·ï¼Œè®¡ç®—å®ƒä»¬çš„äº®åº¦å€¼ï¼Œå†ä¸å·ç§¯æ ¸G_{x}$å’Œ$G_{y}$ä¸­å¯¹åº”çš„æƒé‡ç›¸ä¹˜åï¼Œå åŠ åˆ°å„è‡ªçš„æ¢¯åº¦å€¼ä¸Šã€‚æœ€åæˆ‘ä»¬ä»1ä¸­å‡å»æ°´å¹³æ–¹å‘å’Œæ ‘ææ–¹å‘çš„æ¢¯åº¦å€¼çš„ç»å¯¹å€¼ï¼Œå¾—åˆ°edgeã€‚edgeè¶Šå°ï¼Œè¡¨æ˜è¯¥ä½ç½®è¶Šå¯èƒ½æ˜¯ä¸€ä¸ªè¾¹ç¼˜ç‚¹ã€‚è‡³æ­¤ï¼Œè¾¹ç¼˜æ£€æµ‹çš„è¿‡ç¨‹ç»“æŸã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ¬èŠ‚å®ç°çš„è¾¹ç¼˜æ£€æµ‹ä»…ä»…åˆ©ç”¨äº†å±å¹•é¢œè‰²ä¿¡æ¯ï¼Œè€Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œç‰©ä½“çš„çº¹ç†ã€é˜´å½±ç­‰ä¿¡æ¯å‡ä¼šå½±å“è¾¹ç¼˜æ£€æµ‹çš„ç»“æœï¼Œä½¿å¾—ç»“æœåŒ…å«è®¸å¤šéé¢„æœŸçš„æè¾¹ï¼Œä¸ºäº†å¾—åˆ°æ›´åŠ å‡†ç¡®çš„è¾¹ç¼˜ä¿¡æ¯ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šåœ¨å±å¹•çš„æ·±åº¦çº¹ç†å’Œæ³•çº¿çº¹ç†ä¸Šè¿›è¡Œè¾¹ç¼˜æ£€æµ‹ã€‚æˆ‘ä»¬å°†ä¼šåœ¨13.4èŠ‚ä¸­å®ç°è¿™ç§æ–¹æ³•ã€‚</p><h1>é«˜æ–¯æ¨¡ç³Š</h1><h2 id="é«˜æ–¯æ»¤æ³¢">é«˜æ–¯æ»¤æ³¢</h2><p>é«˜æ–¯æ¨¡ç³ŠåŒæ ·åˆ©ç”¨äº†å·ç§¯è®¡ç®—ï¼Œå®ƒä½¿ç”¨çš„å·ç§¯æ ¸åä¸ºé«˜æ–¯æ ¸ã€‚é«˜æ–¯æ ¸æ˜¯ä¸€ä¸ªæ­£æ–¹å½¢å¤§å°çš„æ»¤æ³¢æ ¸ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ çš„è®¡ç®—éƒ½æ˜¯åŸºäºä¸‹é¢çš„é«˜æ–¯æ–¹ç¨‹ï¼š</p><p>$$G(x,y) = \frac{1}{2\pi\sigma^2}e^{\frac{x^2 + y^2}{2\sigma^2}}$$</p><p>å…¶ä¸­$\sigma$æ˜¯æ ‡å‡†æ–¹å·®ï¼Œä¸€èˆ¬å–å€¼ä¸º1ï¼Œxå’Œyåˆ†åˆ«å¯¹åº”äº†å½“å‰ä½ç½®åˆ°å·ç§¯æ ¸ä¸­å¿ƒçš„æ•´æ•°è·ç¦»ã€‚è¦æ„å»ºä¸€ä¸ªé«˜æ–¯æ ¸ï¼Œæˆ‘ä»¬åªéœ€è¦è®¡ç®—é«˜æ–¯æ ¸ä¸­å„ä¸ªä½ç½®å¯¹åº”çš„é«˜æ–¯å€¼ã€‚ä¸ºäº†ä¿è¯æ»¤æ³¢åçš„å›¾åƒä¸ä¼šå˜æš—ï¼Œæˆ‘ä»¬éœ€è¦å¯¹é«˜æ–¯æ ¸ä¸­çš„æƒé‡è¿›è¡Œå½’ä¸€åŒ–ï¼Œå³è®©æ¯ä¸ªæƒé‡é™¤ä»¥æ‰€æœ‰æƒé‡çš„å’Œï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ‰€æœ‰æƒé‡çš„å’Œä¸º1.å› æ­¤ï¼Œé«˜æ–¯å‡½æ•°eå‰é¢çš„ç³»æ•°å®é™…ä¸ä¼šå¯¹ç»“æœäº§ç”Ÿä»»ä½•å½±å“ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªæ ‡å‡†æ–¹å·®ä¸º1çš„5$\times$5å¤§å°çš„é«˜æ–¯æ ¸ã€‚</p><img src="/posts/a07e7969/image-1.png" class=""><p>é«˜æ–¯æ–¹ç¨‹å¾ˆå¥½åœ°æ¨¡æ‹Ÿäº†é‚»åŸŸæ¯ä¸ªåƒç´ å¯¹å½“å‰å¤„ç†åƒç´ çš„å½±å“ç¨‹åº¦â€”â€”è·ç¦»è¶Šè¿‘ï¼Œå½±å“è¶Šå¤§ã€‚é«˜æ–¯æ ¸çš„ç»´æ•°è¶Šé«˜ï¼Œæ¨¡ç³Šç¨‹åº¦å°±è¶Šå¤§ã€‚ä½¿ç”¨ä¸€ä¸ªNxNçš„é«˜æ–¯æ ¸å¯¹å›¾åƒè¿›è¡Œå·ç§¯æ»¤æ³¢ï¼Œå°±éœ€è¦N$\times$N$\times$W$\times$H(Wå’ŒHåˆ†åˆ«æ˜¯å›¾åƒçš„å®½å’Œé«˜)æ¬¡çº¹ç†é‡‡æ ·ã€‚å½“Nçš„å¤§å°ä¸æ–­å¢åŠ æ—¶ï¼Œé‡‡æ ·çš„æ¬¡æ•°å°±ä¼šå˜å¾—éå¸¸å·¨å¤§ã€‚å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªäºŒç»´çš„é«˜æ–¯å‡½æ•°æ‹†åˆ†æˆä¸¤ä¸ªä¸€ç»´å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªä¸€ç»´çš„é«˜æ–¯æ ¸å…ˆåå¯¹å›¾åƒè¿›è¡Œæ»¤æ³¢ï¼Œå®ƒä»¬å¾—åˆ°çš„ç»“æœå’Œç›´æ¥ä½¿ç”¨äºŒç»´é«˜æ–¯æ ¸æ˜¯ä¸€æ ·çš„ï¼Œä½†é‡‡æ ·æ¬¡æ•°åªéœ€è¦2$\times$N$\times$W$\times$Hã€‚æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥è§‚å¯Ÿåˆ°ï¼Œä¸¤ä¸ªä¸€ç»´é«˜æ–¯æ ¸ä¸­åŒ…å«äº†å¾ˆå¤šé‡å¤çš„æƒé‡ï¼Œå¯¹äºä¸€ä¸ªå¤§å°ä¸º5çš„ä¸€ç»´é«˜æ–¯æ ¸ï¼Œæˆ‘ä»¬å®é™…ä¸Šåªéœ€è¦è®°å½•3ä¸ªæƒé‡å€¼å°±å¯ä»¥äº†ã€‚</p><blockquote><p>ä¸ºå•¥ä¸¤ä¸ªä¸€ç»´çš„é«˜æ–¯æ ¸å…ˆåå¯¹å›¾åƒè¿›è¡Œæ»¤æ³¢ï¼Œå®ƒä»¬å¾—åˆ°çš„ç»“æœå’Œç›´æ¥ä½¿ç”¨äºŒç»´é«˜æ–¯æ ¸æ˜¯ä¸€æ ·ï¼Ÿ</p></blockquote><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ä¸Šè¿°çš„5$\times$5çš„é«˜æ–¯æ ¸å¯¹åŸå›¾åƒè¿›è¡Œé«˜æ–¯æ¨¡ç³Šã€‚æˆ‘ä»¬å°†å…ˆåè°ƒç”¨ä¸¤ä¸ªPassï¼Œç¬¬ä¸€ä¸ªPasså°†ä¼šä½¿ç”¨ç«–ç›´æ–¹å‘çš„ä¸€ç»´é«˜æ–¯æ ¸å¯¹å›¾åƒè¿›è¡Œæ»¤æ³¢ï¼Œç¬¬äºŒä¸ªPassä½¿ç”¨æ°´å¹³æ–¹å‘çš„ä¸€ç»´é«˜æ–¯æ ¸å¯¹å›¾åƒè¿›è¡Œæ»¤æ³¢ï¼Œå¾—åˆ°æœ€ç»ˆçš„ç›®æ ‡å›¾åƒã€‚åœ¨å®ç°ä¸­æˆ‘ä»¬è¿˜ä¼šåˆ©ç”¨å›¾åƒç¼©æ”¾æ¥è¿›ä¸€æ­¥æé«˜æ€§èƒ½ï¼Œå¹¶é€šè¿‡è°ƒæ•´é«˜æ–¯æ»¤æ³¢çš„åº”ç”¨æ¬¡æ•°æ¥æ§åˆ¶æ¨¡ç³Šç¨‹åº¦ï¼ˆæ¬¡æ•°è¶Šå¤šï¼Œå›¾åƒè¶Šæ¨¡ç³Šï¼‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">using UnityEngine;</span><br><span class="line">using System.Collections;</span><br><span class="line"></span><br><span class="line">public class GaussianBlur : PostEffectsBase &#123;</span><br><span class="line"></span><br><span class="line">public Shader gaussianBlurShader;</span><br><span class="line">private Material gaussianBlurMaterial = null;</span><br><span class="line"></span><br><span class="line">public Material material &#123;  </span><br><span class="line">get &#123;</span><br><span class="line">gaussianBlurMaterial = CheckShaderAndCreateMaterial(gaussianBlurShader, gaussianBlurMaterial);</span><br><span class="line">return gaussianBlurMaterial;</span><br><span class="line">&#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Blur iterations - larger number means more blur.</span><br><span class="line">[Range(0, 4)]</span><br><span class="line">public int iterations = 3;</span><br><span class="line"></span><br><span class="line">// Blur spread for each iteration - larger value means more blur</span><br><span class="line">[Range(0.2f, 3.0f)]</span><br><span class="line">public float blurSpread = 0.6f;</span><br><span class="line"></span><br><span class="line">[Range(1, 8)]</span><br><span class="line">public int downSample = 2;</span><br><span class="line"></span><br><span class="line">void OnRenderImage (RenderTexture src, RenderTexture dest) &#123;</span><br><span class="line">if (material != null) &#123;</span><br><span class="line">int rtW = src.width/downSample;</span><br><span class="line">int rtH = src.height/downSample;</span><br><span class="line"></span><br><span class="line">RenderTexture buffer0 = RenderTexture.GetTemporary(rtW, rtH, 0);</span><br><span class="line">buffer0.filterMode = FilterMode.Bilinear;</span><br><span class="line"></span><br><span class="line">Graphics.Blit(src, buffer0);</span><br><span class="line"></span><br><span class="line">for (int i = 0; i &lt; iterations; i++) &#123;</span><br><span class="line">material.SetFloat(&quot;_BlurSize&quot;, 1.0f + i * blurSpread);</span><br><span class="line"></span><br><span class="line">RenderTexture buffer1 = RenderTexture.GetTemporary(rtW, rtH, 0);</span><br><span class="line"></span><br><span class="line">// Render the vertical pass</span><br><span class="line">Graphics.Blit(buffer0, buffer1, material, 0);</span><br><span class="line"></span><br><span class="line">RenderTexture.ReleaseTemporary(buffer0);</span><br><span class="line">buffer0 = buffer1;</span><br><span class="line">buffer1 = RenderTexture.GetTemporary(rtW, rtH, 0);</span><br><span class="line"></span><br><span class="line">// Render the horizontal pass</span><br><span class="line">Graphics.Blit(buffer0, buffer1, material, 1);</span><br><span class="line"></span><br><span class="line">RenderTexture.ReleaseTemporary(buffer0);</span><br><span class="line">buffer0 = buffer1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Graphics.Blit(buffer0, dest);</span><br><span class="line">RenderTexture.ReleaseTemporary(buffer0);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">Graphics.Blit(src, dest);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç æ˜¾ç¤ºäº†å¦‚ä½•åˆ©ç”¨ä¸¤ä¸ªä¸´æ—¶ç¼“å­˜åœ¨è¿­ä»£ä¹‹é—´è¿›è¡Œäº¤æ›¿çš„è¿‡ç¨‹ã€‚åœ¨è¿­ä»£å¼€å§‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰äº†ç¬¬ä¸€ä¸ªç¼“å­˜buffer0ï¼Œå¹¶æŠŠsrcä¸­çš„å›¾åƒç¼©æ”¾åå­˜å‚¨åˆ°buffer0ä¸­ã€‚åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åˆå®šä¹‰äº†ç¬¬äºŒä¸ªç¼“å­˜buffer1ã€‚åœ¨æ‰§è¡Œç¬¬ä¸€ä¸ªPassæ—¶ï¼Œè¾“å…¥æ˜¯buffer0ï¼Œè¾“å‡ºæ˜¯buffer1ï¼Œå®Œæ¯•åé¦–å…ˆæŠŠbuffer0é‡Šæ”¾ï¼Œå†æŠŠç»“æœå€¼buffer1å­˜å‚¨åˆ°buffer0ä¸­ï¼Œé‡æ–°åˆ†é…buffer1ï¼Œç„¶åå†è°ƒç”¨ç¬¬äºŒä¸ªPassé‡å¤ä¸Šé¢çš„è¿‡ç¨‹ã€‚è¿­ä»£å®Œæˆåï¼Œbuffer0å°†å­˜å‚¨æœ€ç»ˆçš„å›¾åƒï¼Œæˆ‘ä»¬å†åˆ©ç”¨Graphic.Blit(buffer0, dest)æŠŠç»“æœæ˜¾ç¤ºåˆ°å±å¹•ä¸Šï¼Œå¹¶é‡Šæ”¾ç¼“å­˜ã€‚</p><p>ä¸‹é¢æ˜¯Shaderå®ç°éƒ¨åˆ†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Unity Shader Book/Chapter 12/GaussianBlur&quot;</span><br><span class="line">&#123;</span><br><span class="line">Properties &#123;</span><br><span class="line">_MainTex (&quot;Base (RGB)&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">_BlurSize (&quot;Blur Size&quot;, Float) = 1.0</span><br><span class="line">&#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        CGINCLUDE</span><br><span class="line"></span><br><span class="line">        #include &quot;UnityCG.cginc&quot;</span><br><span class="line">        </span><br><span class="line">        sampler2D _MainTex;</span><br><span class="line">        half4 _MainTex_TexelSize;</span><br><span class="line">        float _BlurSize;</span><br><span class="line"></span><br><span class="line">        struct v2f</span><br><span class="line">        &#123;</span><br><span class="line">            float4 pos : SV_POSITION;</span><br><span class="line">            half2 uv[5] : TEXCOORD0;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        v2f vertexBlurVertical(appdata_img v)</span><br><span class="line">        &#123;</span><br><span class="line">v2f o;</span><br><span class="line">o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line"></span><br><span class="line">half2 uv = v.texcoord;</span><br><span class="line"></span><br><span class="line">o.uv[0] = uv;</span><br><span class="line">o.uv[1] = uv + float2(0.0, _MainTex_TexelSize.y * 1.0) * _BlurSize;</span><br><span class="line">o.uv[2] = uv - float2(0.0, _MainTex_TexelSize.y * 1.0) * _BlurSize;</span><br><span class="line">o.uv[3] = uv + float2(0.0, _MainTex_TexelSize.y * 2.0) * _BlurSize;</span><br><span class="line">o.uv[4] = uv - float2(0.0, _MainTex_TexelSize.y * 2.0) * _BlurSize;</span><br><span class="line"> </span><br><span class="line">return o;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        v2f vertexBlurHorizontal(appdata_img v)</span><br><span class="line">        &#123;</span><br><span class="line">           v2f o;</span><br><span class="line">o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line"></span><br><span class="line">half2 uv = v.texcoord;</span><br><span class="line"></span><br><span class="line">o.uv[0] = uv;</span><br><span class="line">o.uv[1] = uv + float2(_MainTex_TexelSize.x * 1.0, 0.0) * _BlurSize;</span><br><span class="line">o.uv[2] = uv - float2(_MainTex_TexelSize.x * 1.0, 0.0) * _BlurSize;</span><br><span class="line">o.uv[3] = uv + float2(_MainTex_TexelSize.x * 2.0, 0.0) * _BlurSize;</span><br><span class="line">o.uv[4] = uv - float2(_MainTex_TexelSize.x * 2.0, 0.0) * _BlurSize;</span><br><span class="line"></span><br><span class="line">            return o;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fixed4 fragBlur(v2f i) : SV_Target&#123;</span><br><span class="line">            float weight[3] = &#123;0.4026, 0.2442, 0.0545&#125;;</span><br><span class="line"></span><br><span class="line">            fixed3 sum = tex2D(_MainTex, i.uv[0]).rgb * weight[0];</span><br><span class="line"></span><br><span class="line">            for(int it = 1; it &lt; 3; it++)</span><br><span class="line">            &#123;</span><br><span class="line">                sum += tex2D(_MainTex, i.uv[it*2 - 1]).rgb * weight[it];</span><br><span class="line">                sum += tex2D(_MainTex, i.uv[it*2]).rgb * weight[it];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            return fixed4(sum, 1.0);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ENDCG</span><br><span class="line">        </span><br><span class="line">        ZTest Always</span><br><span class="line">        Cull Off</span><br><span class="line">        ZWrite Off</span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Name &quot;GAUSSIAN_BLUR_VERTICAL&quot;</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vertexBlurVertical</span><br><span class="line">            #pragma fragment fragBlur</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Name &quot;GAUSSIAN_BLUR_HORIZONTAL&quot;</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vertexBlurHorizontal</span><br><span class="line">            #pragma fragment fragBlur</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;        </span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Fallback &quot;Diffuse&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ç¬¬ä¸€æ¬¡ä½¿ç”¨CGINCLUDEæ¥ç»„ç»‡ä»£ç ã€‚æˆ‘ä»¬åœ¨SubShaderå—ä¸­åˆ©ç”¨CGINCLUDEå’ŒENDCGè¯­ä¹‰å®šä¹‰äº†ä¸€ç³»åˆ—çš„ä»£ç ã€‚<br>è¿™äº›ä»£ç ä¸éœ€è¦åŒ…å«åœ¨ä»»ä½•Passè¯­ä¹‰å—ä¸­ï¼Œåœ¨ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨Passä¸­ç›´æ¥æŒ‡å®šéœ€è¦ä½¿ç”¨çš„é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡å…ƒç€è‰²å™¨å‡½æ•°åå³å¯ã€‚CGINCLUDEç±»ä¼¼äºC++ä¸­å¤´æ–‡ä»¶çš„åŠŸèƒ½ã€‚ç”±äºé«˜æ–¯æ¨¡ç³Šéœ€è¦å®šä¹‰ä¸¤ä¸ªPassï¼Œä½†å®ƒä»¬ä½¿ç”¨çš„ç‰‡å…ƒç€è‰²å™¨ä»£ç æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œä½¿ç”¨CGINCLUDEå¯ä»¥é¿å…æˆ‘ä»¬ç¼–å†™ä¸¤ä¸ªå®Œå…¨ä¸€æ ·çš„fragå‡½æ•°ã€‚</p><p>ç”±äºè¦å¾—åˆ°ç›¸é‚»åƒç´ çš„çº¹ç†åæ ‡ï¼Œæˆ‘ä»¬è¿™é‡Œå†ä¸€æ¬¡ä½¿ç”¨äº†Unityæä¾›çš„_MainTex_TexelSizeå˜é‡ä»¥è®¡ç®—ç›¸é‚»åƒç´ çš„çº¹ç†åæ ‡åç§»é‡ã€‚</p><p>åœ¨æœ¬èŠ‚ä¸­æˆ‘ä»¬ä¼šåˆ©ç”¨5$\times$5å¤§å°çš„é«˜æ–¯æ ¸å¯¹åŸå›¾åƒè¿›è¡Œé«˜æ–¯æ¨¡ç³Šï¼Œè€Œç”±12.4.1èŠ‚å¯çŸ¥ï¼Œä¸€ä¸ª5$\times$5çš„äºŒç»´é«˜æ–¯æ ¸å¯ä»¥æ‹†åˆ†æˆä¸¤ä¸ªå¤§å°ä¸º5çš„ä¸€ç»´é«˜æ–¯æ ¸ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦è®¡ç®—5ä¸ªçº¹ç†åæ ‡å³å¯ã€‚ä¸ºæ­¤æˆ‘ä»¬åœ¨v2fç»“æ„ä½“ä¸­å®šä¹‰äº†ä¸€ä¸ª5ç»´çš„çº¹ç†åæ ‡æ•°ç»„ã€‚é¼ æ—çš„ç¬¬ä¸€ä¸ªåæ ‡å­˜å‚¨äº†å½“å‰çš„é‡‡æ ·çº¹ç†ï¼Œå‰©ä½™çš„å››ä¸ªåæ ‡åˆ™æ˜¯é«˜æ–¯æ¨¡ç³Šä¸­å¯¹é‚»åŸŸé‡‡æ ·æ—¶ä½¿ç”¨çš„çº¹ç†åæ ‡ã€‚æˆ‘ä»¬è¿˜å’Œå±æ€§_BlurSizeç›¸ä¹˜æ¥æ§åˆ¶é‡‡æ ·è·ç¦»ã€‚åœ¨é«˜æ–¯æ ¸ç»´æ•°ä¸å˜çš„æƒ…å†µä¸‹ï¼Œ_BlurSizeè¶Šå¤§ï¼Œæ¨¡ç³Šç¨‹åº¦è¶Šé«˜ï¼Œä½†æ˜¯é‡‡æ ·æ•°å´ä¸ä¼šå—åˆ°å½±å“ã€‚ä½†æ˜¯è¿‡å¤§çš„_BlurSizeä¼šé€ æˆè™šå½±ï¼Œè¿™å¯èƒ½å¹¶ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›çš„ã€‚é€šè¿‡æŠŠè®¡ç®—é‡‡æ ·çº¹ç†åæ ‡çš„ä»£ç ä»ç‰‡å…ƒç€è‰²å™¨ç§»åŠ¨åˆ°é¡¶ç‚¹ç€è‰²å™¨ä¸­ï¼Œå¯ä»¥å‡å°‘è¿ç®—ï¼Œæé«˜ä¿¡å¿µã€‚ç”±äºä»é¡¶ç‚¹ç€è‰²å™¨åˆ°ç‰‡å…ƒç€è‰²å™¨çš„æ’å€¼æ˜¯çº¿æ€§çš„ï¼Œå› æ­¤è¿™æ ·çš„è½¬ç§»å¹¶ä¸ä¼šå½±å“çº¹ç†åæ ‡çš„è®¡ç®—ç»“æœã€‚</p><p>æ°´å¹³æ–¹å‘çš„é¡¶ç‚¹ç€è‰²å™¨å’Œä¸Šé¢çš„ä»£ç ç±»ä¼¼ï¼Œåªæ˜¯åœ¨è®¡ç®—4ä¸ªçº¹ç†åæ ‡æ—¶ä½¿ç”¨äº†æ°´å¹³æ–¹å‘çš„çº¹ç´ å¤§å°è¿›è¡Œçº¹ç†åç§»ã€‚</p><p>æ³¨æ„ï¼Œæˆ‘ä»¬ä»ç„¶é¦–å…ˆè®¾ç½®äº†æ¸²æŸ“çŠ¶æ€ã€‚å’Œä¹‹å‰ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬ä¸ºä¸¤ä¸ªPassä½¿ç”¨NAMEè¯­ä¹‰å®šä¹‰äº†å®ƒä»¬çš„åå­—ã€‚è¿™æ˜¯å› ä¸ºï¼Œé«˜æ–¯æ¨¡ç³Šæ˜¯éå¸¸å¸¸è§çš„å›¾åƒå¤„ç†æ“ä½œï¼Œå¾ˆå¤šå±å¹•ç‰¹æ•ˆéƒ½æ˜¯å»ºç«‹åœ¨å®ƒçš„åŸºç¡€ä¸Šçš„ï¼Œä¾‹å¦‚Bloomæ•ˆæœã€‚ä¸ºPasså®šä¹‰åå­—ï¼Œå¯ä»¥åœ¨å…¶ä»–Shaderä¸­ç›´æ¥é€šè¿‡å®ƒä»¬çš„åå­—æ¥ä½¿ç”¨è¯¥Pasï¼Œè€Œä¸éœ€è¦å†é‡å¤ç¼–å†™ä»£ç ã€‚</p><p>åŒæ ·çš„ï¼Œç”±äºé«˜æ–¯æ ¸çš„å¯¹ç§°æ€§ï¼Œæˆ‘ä»¬åªéœ€è¦è®°å½•3ä¸ªé«˜æ–¯æƒé‡ï¼Œä¹Ÿå°±æ˜¯ä»£ç ä¸­çš„weightå˜é‡ã€‚æˆ‘ä»¬é¦–å…ˆå£°æ˜äº†å„ä¸ªé‚»åŸŸåƒç´ å¯¹åº”çš„æƒé‡weightï¼Œç„¶åå°†ç»“æœå€¼sumåˆå§‹åŒ–ä¸ºå½“å‰çš„åƒç´ å€¼ä¹˜ä»¥å®ƒçš„æƒé‡å€¼ã€‚æ ¹æ®å¯¹ç§°æ€§ï¼Œæˆ‘ä»¬è¿›è¡Œäº†ä¸¤æ¬¡è¿­ä»£ï¼Œæ¯æ¬¡è¿­ä»£åŒ…å«äº†ä¸¤æ¬¡çº¹ç†é‡‡æ ·ï¼Œå¹¶æŠŠåƒç´ å€¼å’Œæƒé‡ç›¸ä¹˜åçš„ç»“æœå åŠ åˆ°sumä¸­ã€‚æœ€åï¼Œå‡½æ•°è¿”å›æ»¤æ³¢ç»“æœsumã€‚</p><h1>Bloomæ•ˆæœ</h1><p>Bloomæ•ˆæœæ˜¯æ¸¸æˆä¸­å¸¸è§çš„ä¸€ç§æ•ˆæœã€‚è¿™ç§ç‰¹æ•ˆå¯ä»¥æ¨¡æ‹ŸçœŸå®æ‘„åƒæœºçš„ä¸€ç§å›¾åƒæ•ˆæœï¼Œå®ƒè®©ç”»é¢ä¸­è¾ƒäº®çš„åŒºåŸŸâ€œæ‰©æ•£â€åˆ°å‘¨å›´åŒºåŸŸä¸­ï¼Œé€ æˆä¸€ç§æœ¦èƒ§çš„æ•ˆæœã€‚</p><p>Bloomæ•ˆæœçš„å®ç°åŸç†éå¸¸ç®€å•ï¼šæˆ‘ä»¬é¦–å…ˆæ ¹æ®ä¸€ä¸ªé˜ˆå€¼æå–å‡ºå›¾åƒä¸­è¾ƒäº®çš„åŒºåŸŸï¼ŒæŠŠå®ƒä»¬å­˜å‚¨åˆ°ä¸€å¼ æ¸²æŸ“çº¹ç†ä¸­ï¼Œå†åˆ©ç”¨é«˜æ–¯æ¨¡ç³Šå¯¹è¿™æ ·æ¸²æŸ“çº¹ç†è¿›è¡Œæ¨¡ç³Šå¤„ç†ï¼Œæ¨¡æ‹Ÿå…‰çº¿æ‰©æ•£çš„æ•ˆæœï¼Œæœ€åå†å°†å…¶å’ŒåŸå›¾åƒæ··åˆï¼Œå¾—åˆ°æœ€ç»ˆçš„æ•ˆæœã€‚</p><p>å°½ç®¡åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå›¾åƒçš„äº®åº¦å€¼ä¸ä¼šè¶…è¿‡1.ä½†æ˜¯å¦‚æœæˆ‘ä»¬å¼€å¯äº†HDRï¼Œç¡¬ä»¶å°±ä¼šå…è®¸æˆ‘ä»¬æŠŠé¢œè‰²å€¼å­˜å‚¨åœ¨ä¸€ä¸ªæ›´é«˜ç²¾åº¦èŒƒå›´çš„ç¼“å†²ä¸­ï¼Œæ­¤æ—¶åƒç´ çš„äº®åº¦å€¼å¯èƒ½ä¼šè¶…è¿‡1ã€‚å› æ­¤ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æŠŠluminanceThreasholdçš„å€¼è§„å®šåœ¨[0,4]èŒƒå›´å†…ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class Bloom : PostEffectsBase</span><br><span class="line">&#123;</span><br><span class="line">    public Shader bloomShader;</span><br><span class="line">    private Material bloomMaterial = null;</span><br><span class="line"></span><br><span class="line">    public Material material</span><br><span class="line">    &#123;</span><br><span class="line">        get</span><br><span class="line">        &#123;</span><br><span class="line">            bloomMaterial = CheckShaderAndCreateMaterial(bloomShader, bloomMaterial);</span><br><span class="line">            return bloomMaterial;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [Range(0, 4)] public int iterations = 3;</span><br><span class="line">    [Range(0.2f, 3.0f)] public float blurSpread = 0.6f;</span><br><span class="line">    [Range(1, 8)] public int downSample = 2;</span><br><span class="line">    [Range(0.0f, 4.0f)] public float luminanceThreshold = 0.6f;</span><br><span class="line">    private static readonly int LuminanceThreshold = Shader.PropertyToID(&quot;_LuminanceThreshold&quot;);</span><br><span class="line">    private static readonly int Bloom1 = Shader.PropertyToID(&quot;_Bloom&quot;);</span><br><span class="line">    private static readonly int BlurSize = Shader.PropertyToID(&quot;_BlurSize&quot;);</span><br><span class="line"></span><br><span class="line">    private void OnRenderImage(RenderTexture source, RenderTexture destination)</span><br><span class="line">    &#123;</span><br><span class="line">        if (material != null)</span><br><span class="line">        &#123;</span><br><span class="line">            material.SetFloat(LuminanceThreshold, luminanceThreshold);</span><br><span class="line"></span><br><span class="line">            int rtW = source.width / downSample;</span><br><span class="line">            int rtH = source.height / downSample;</span><br><span class="line"></span><br><span class="line">            RenderTexture buffer0 = RenderTexture.GetTemporary(rtW, rtH, 0);</span><br><span class="line">            buffer0.filterMode = FilterMode.Bilinear;</span><br><span class="line"></span><br><span class="line">            Graphics.Blit(source, buffer0, material, 0);</span><br><span class="line"></span><br><span class="line">            for (int i = 0; i &lt; iterations; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                material.SetFloat(BlurSize, 1.0f + i * blurSpread);</span><br><span class="line"></span><br><span class="line">                RenderTexture buffer1 = RenderTexture.GetTemporary(rtW, rtH, 0);</span><br><span class="line">                </span><br><span class="line">                Graphics.Blit(buffer0, buffer1, material, 1);</span><br><span class="line">                </span><br><span class="line">                RenderTexture.ReleaseTemporary(buffer0);</span><br><span class="line"></span><br><span class="line">                buffer0 = buffer1;</span><br><span class="line">                buffer1 = RenderTexture.GetTemporary(rtW, rtH, 0);</span><br><span class="line">                </span><br><span class="line">                Graphics.Blit(buffer0, buffer1, material, 2);</span><br><span class="line">                </span><br><span class="line">                RenderTexture.ReleaseTemporary(buffer0);</span><br><span class="line">                buffer0 = buffer1;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            material.SetTexture(Bloom1, buffer0);</span><br><span class="line">            Graphics.Blit(source,destination, material, 3);</span><br><span class="line">            </span><br><span class="line">            RenderTexture.ReleaseTemporary(buffer0);</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            Graphics.Blit(source, destination);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Unity Shader Book/Chapter 12/Bloom&quot;</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _MainTex (&quot;Base (RGB)&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _Bloom (&quot;Bloom (RGB)&quot;, 2D) = &quot;black&quot; &#123;&#125;</span><br><span class="line">        _LuminanceThreshold (&quot;Luminance Threshold&quot;, Float) = 0.5</span><br><span class="line">        _BlurSize (&quot;Blur Size&quot;, Float) = 1.0</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        CGINCLUDE</span><br><span class="line"></span><br><span class="line">        #include &quot;UnityCG.cginc&quot;</span><br><span class="line">        sampler2D _MainTex;</span><br><span class="line">        half4 _MainTex_TexelSize;</span><br><span class="line">        sampler2D _Bloom;</span><br><span class="line">        float _LuminanceThreshold;</span><br><span class="line">        float _BlurSize;</span><br><span class="line"></span><br><span class="line">        struct v2f</span><br><span class="line">        &#123;</span><br><span class="line">            float4 pos : SV_POSITION;</span><br><span class="line">            half2 uv : TEXCOORD0;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        v2f vertExtractBright(appdata_img v)</span><br><span class="line">        &#123;</span><br><span class="line">            v2f o;</span><br><span class="line"></span><br><span class="line">            o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line"></span><br><span class="line">            o.uv = v.texcoord;</span><br><span class="line"></span><br><span class="line">            return o;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fixed luminance(fixed4 color)</span><br><span class="line">        &#123;</span><br><span class="line">            return 0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fixed4 fragExtractBright(v2f i) : SV_Target&#123;</span><br><span class="line">            fixed4 c = tex2D(_MainTex, i.uv);</span><br><span class="line">            fixed val = clamp(luminance(c) - _LuminanceThreshold, 0.0, 1.0);</span><br><span class="line">            return c * val;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        struct v2fBloom</span><br><span class="line">        &#123;</span><br><span class="line">            float4 pos : SV_POSITION;</span><br><span class="line">            half4 uv : TEXCOORD0;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        v2fBloom vertBloom(appdata_img v)</span><br><span class="line">        &#123;</span><br><span class="line">            v2fBloom o;</span><br><span class="line">            o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line"></span><br><span class="line">            o.uv.xy = v.texcoord;</span><br><span class="line">            o.uv.zw = v.texcoord;</span><br><span class="line"></span><br><span class="line">            #if UNITY_UV_STARTS_AT_TOP</span><br><span class="line">            if(_MainTex_TexelSize.y &lt; 0.0)</span><br><span class="line">            &#123;</span><br><span class="line">                o.uv.w = 1.0 - o.uv.w;</span><br><span class="line">            &#125;</span><br><span class="line">            #endif</span><br><span class="line"></span><br><span class="line">            return o;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fixed4 fragBloom(v2fBloom i) : SV_Target&#123;</span><br><span class="line">            return tex2D(_MainTex, i.uv.xy) + tex2D(_Bloom, i.uv.zw);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        ENDCG</span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vertExtractBright</span><br><span class="line">            #pragma fragment fragExtractBright</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;   </span><br><span class="line">        </span><br><span class="line">        UsePass &quot;Unity Shader Book/Chapter 12/GaussianBlur/GAUSSIAN_BLUR_VERTICAL&quot;</span><br><span class="line">        UsePass &quot;Unity Shader Book/Chapter 12/GaussianBlur/GAUSSIAN_BLUR_HORIZONTAL&quot;</span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vertBloom</span><br><span class="line">            #pragma fragment fragBloom</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">    Fallback Off</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>è¿åŠ¨æ¨¡ç³Š</h1><p>è¿åŠ¨æ¨¡ç³Šæ˜¯çœŸå®ä¸–ç•Œä¸­çš„æ‘„åƒæœºçš„ä¸€ç§æ•ˆæœã€‚å¦‚æœåœ¨æ‘„åƒæœºæ›å…‰æ—¶ï¼Œæ‹æ‘„åœºæ™¯å‘ç”Ÿäº†å˜åŒ–ï¼Œå°±ä¼šäº§ç”Ÿæ¨¡ç³Šçš„ç”»é¢ã€‚è¿åŠ¨æ¨¡ç³Šåœ¨æˆ‘ä»¬çš„æ—¥å¸¸ç”Ÿæ´»ä¸­æ˜¯éå¸¸å¸¸è§çš„ï¼Œåªè¦ç•™å¿ƒè§‚å¯Ÿï¼Œå°±å¯ä»¥å‘ç°æ— è®ºæ˜¯ä½“è‚²æŠ¥é“è¿˜æ˜¯å„ä¸ªç”µå½±ä¸­ï¼Œéƒ½æœ‰è¿åŠ¨æ¨¡ç³Šçš„èº«å½±ã€‚è¿åŠ¨æ¨¡ç³Šçš„æ•ˆæœå¯ä»¥è®©ç‰©ä½“è¿åŠ¨èµ·æ¥æ›´åŠ çœŸå®å¹³æ»‘ï¼Œä½†åœ¨è®¡ç®—æœºäº§ç”Ÿå›¾åƒçš„è¿‡ç¨‹ä¸­ï¼Œç”±äºä¸å­˜åœ¨æ›å…‰è¿™ä¸€ç‰©ç†ç°è±¡ï¼Œæ¸²æŸ“å‡ºæ¥çš„å›¾åƒå¾€å¾€éƒ½æ˜¯æ£±è§’åˆ†æ˜ï¼Œç¼ºå°‘è¿åŠ¨æ¨¡ç³Šã€‚åœ¨ä¸€äº›æ³¨å…¥èµ›è½¦ç±»å‹çš„æ¸¸æˆä¸­ï¼Œä¸ºç”»é¢æ·»åŠ è¿åŠ¨æ¨¡ç³Šæ˜¯ä¸€ç§å¸¸è§çš„å¤„ç†æ–¹æ³•ã€‚åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åœ¨å±å¹•åå¤„ç†ä¸­å®ç°è¿åŠ¨æ¨¡ç³Šçš„æ•ˆæœã€‚</p><p>è¿åŠ¨æ¨¡ç³Šçš„å®ç°æœ‰å¾ˆå¤šç§æ–¹æ³•ã€‚ä¸€ç§å®ç°æ–¹æ³•æ˜¯åˆ©ç”¨ä¸€å—<strong>ç´¯è®¡ç¼“å­˜(accumulation buffer)<strong>æ¥æ··åˆå¤šå¼ è¿ç»­çš„å›¾åƒã€‚å½“ç‰©ä½“å¿«é€Ÿç§»åŠ¨äº§ç”Ÿå¤šå¼ å›¾åƒåï¼Œæˆ‘ä»¬å–å®ƒä»¬ä¹‹é—´çš„å¹³å‡å€¼ä½œä¸ºæœ€åçš„è¿åŠ¨æ¨¡ç³Šå›¾åƒã€‚ç„¶è€Œè¿™ç§æš´åŠ›çš„æ–¹æ³•å¯¹æ€§èƒ½çš„æ¶ˆè€—å¾ˆå¤§ï¼Œå› ä¸ºæƒ³è¦è·å¾—å¤šå¼ å¸§å›¾åƒå¾€å¾€æ„å‘³ç€æˆ‘ä»¬è¦åœ¨åŒä¸€å¸§å†…æ¸²æŸ“å¤šæ¬¡åœºæ™¯ã€‚å¦ä¸€ç§åº”ç”¨å¹¿æ³›çš„æ–¹æ³•æ˜¯åˆ›å»ºå’Œä½¿ç”¨</strong>é€Ÿåº¦ç¼“å­˜(velocity buffer)</strong>ï¼Œè¿™ä¸ªç¼“å­˜ç§å­˜å‚¨äº†å„ä¸ªåƒç´ å½“å‰çš„è¿åŠ¨é€Ÿåº¦ï¼Œç„¶ååˆ©ç”¨è¯¥å€¼æ¥å†³å®šæ¨¡ç³Šçš„æ–¹å‘å’Œå¤§å°ã€‚</p><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç±»ä¼¼ä¸Šè¿°ç¬¬ä¸€ç§æ–¹æ³•çš„å®ç°æ¥æ¨¡æ‹Ÿè¿åŠ¨æ¨¡ç³Šçš„æ•ˆæœã€‚æˆ‘ä»¬ä¸éœ€è¦åœ¨ä¸€å¸§ä¸­æŠŠåœºæ™¯æ¸²æŸ“å¤šæ¬¡ï¼Œä½†éœ€è¦ä¿å­˜ä¹‹å‰çš„æ¸²æŸ“ç»“æœï¼Œä¸æ–­æŠŠå½“å‰çš„æ¸²æŸ“å›¾åƒå åŠ åˆ°ä¹‹å‰çš„æ¸²æŸ“å›¾åƒä¸­ï¼Œä»è€Œäº§ç”Ÿä¸€ç§è¿åŠ¨è½¨è¿¹çš„è§†è§‰æ•ˆæœã€‚è¿™ç§æ–¹æ³•ä¸åŸå§‹çš„åˆ©ç”¨ç´¯è®¡ç¼“å­˜çš„æ–¹æ³•ç›¸æ¯”æ€§èƒ½æ›´å¥½ï¼Œä½†æ¨¡ç³Šæ•ˆæœå¯èƒ½ä¼šç•¥æœ‰å½±å“ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">public class MotionBlur : PostEffectsBase</span><br><span class="line">&#123;</span><br><span class="line">    public Shader motionBlurShader;</span><br><span class="line">    private Material motionBlurMaterial = null;</span><br><span class="line"></span><br><span class="line">    public Material material</span><br><span class="line">    &#123;</span><br><span class="line">        get</span><br><span class="line">        &#123;</span><br><span class="line">            motionBlurMaterial = CheckShaderAndCreateMaterial(motionBlurShader, motionBlurMaterial);</span><br><span class="line">            return motionBlurMaterial;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [Range(0.0f, 0.9f)] public float blurAmount = 0.5f;</span><br><span class="line"></span><br><span class="line">    private RenderTexture accumulationTexture;</span><br><span class="line">    private static readonly int BlurAmount = Shader.PropertyToID(&quot;_BlurAmount&quot;);</span><br><span class="line"></span><br><span class="line">    private void OnDisable()</span><br><span class="line">    &#123;</span><br><span class="line">        DestroyImmediate(accumulationTexture);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private void OnRenderImage(RenderTexture source, RenderTexture destination)</span><br><span class="line">    &#123;</span><br><span class="line">        if (material != null)</span><br><span class="line">        &#123;</span><br><span class="line">            if (accumulationTexture == null || accumulationTexture.width != source.width ||</span><br><span class="line">                accumulationTexture.height != source.height)</span><br><span class="line">            &#123;</span><br><span class="line">                DestroyImmediate(accumulationTexture);</span><br><span class="line">                accumulationTexture = new RenderTexture(source.width, source.height, 0);</span><br><span class="line"></span><br><span class="line">                accumulationTexture.hideFlags = HideFlags.HideAndDontSave;</span><br><span class="line">                Graphics.Blit(source, accumulationTexture);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            material.SetFloat(BlurAmount, 1.0f - blurAmount);</span><br><span class="line">            Graphics.Blit(source, accumulationTexture, material);</span><br><span class="line">            Graphics.Blit(accumulationTexture, destination);</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            Graphics.Blit(source, destination);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Unity Shader Book/Chapter 12/Motion Blur&quot;</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _MainTex (&quot;Base(RGB)&quot;, 2D) = &quot;white&quot;&#123;&#125;</span><br><span class="line">        _BlurAmount (&quot;Blur Amount&quot;, Float) = 1.0</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        CGINCLUDE</span><br><span class="line"></span><br><span class="line">        #include &quot;UnityCG.cginc&quot;</span><br><span class="line">        fixed _BlurAmount;</span><br><span class="line">        sampler2D _MainTex;</span><br><span class="line"></span><br><span class="line">        struct v2f</span><br><span class="line">        &#123;</span><br><span class="line">            float4 pos : SV_POSITION;</span><br><span class="line">            half2 uv : TEXCOORD0;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        v2f vert(appdata_img v)</span><br><span class="line">        &#123;</span><br><span class="line">            v2f o;</span><br><span class="line"></span><br><span class="line">            o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line"></span><br><span class="line">            o.uv = v.texcoord;</span><br><span class="line"></span><br><span class="line">            return o;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fixed4 fragRGB(v2f i) : SV_Target&#123;</span><br><span class="line">            return fixed4(tex2D(_MainTex, i.uv).rgb, _BlurAmount);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fixed4 fragA(v2f i) : SV_Target&#123;</span><br><span class="line">            return tex2D(_MainTex, i.uv);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        ENDCG</span><br><span class="line">        </span><br><span class="line">        ZTest Always Cull Off ZWrite Off</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Blend  SrcAlpha OneMinusSrcAlpha</span><br><span class="line">            ColorMask RGB</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment fragRGB</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Blend One Zero</span><br><span class="line">            ColorMask A</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment fragA</span><br><span class="line">                </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Fallback Off</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> UnityShader </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity </tag>
            
            <tag> Shader </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UnityShaderå…¥é—¨ç²¾è¦ç¬”è®°ï¼ˆåä¸€ï¼‰â€”â€”è®©ç”»é¢åŠ¨èµ·æ¥</title>
      <link href="/posts/e01b0f68/"/>
      <url>/posts/e01b0f68/</url>
      
        <content type="html"><![CDATA[<p>æ²¡æœ‰åŠ¨ç”»çš„ç”»é¢å¾€å¾€ä¼šè®©äººè§‰å¾—å¾ˆæ— è¶£ï¼Œåœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šå­¦ä¹ å¦‚ä½•å‘UnityShaderä¸­å¼•å…¥æ—¶é—´å˜é‡ï¼Œä»¥å®ç°å„ç§åŠ¨ç”»æ•ˆæœã€‚</p><h1>Unity Shaderä¸­çš„å†…ç½®å˜é‡(æ—¶é—´ç¯‡)</h1><p>åŠ¨ç”»æ•ˆæœå¾€å¾€æ˜¯æŠŠæ—¶é—´æ·»åŠ åˆ°ä¸€äº›å˜é‡çš„è®¡ç®—ä¸­ï¼Œä»¥ä¾¿åœ¨æ—¶é—´å˜åŒ–æ—¶ç”»é¢ä¹Ÿå¯ä»¥éšä¹‹å˜åŒ–ã€‚UnityShaderæä¾›äº†ä¸€äº›åˆ—å…³äºæ—¶é—´çš„å†…ç½®å˜é‡æ¥å…è®¸æˆ‘ä»¬æ–¹ä¾¿åœ°åœ¨Shaderä¸­è®¿é—®è¿è¡Œæ—¶é—´ï¼Œå®ç°å„ç§åŠ¨ç”»æ•ˆæœã€‚ä¸‹è¡¨æ˜¯Unityä¸­å†…ç½®åœ°æ—¶é—´å˜é‡ã€‚</p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>_Time</td><td>float4</td><td>tæ˜¯è‡ªè¯¥åœºæ™¯åŠ è½½å¼€å§‹æ‰€ç»è¿‡åœ°æ—¶é—´ï¼Œ4ä¸ªåˆ†é‡åˆ†åˆ«æ˜¯(t/20, t, 2t, 3t)</td></tr><tr><td>_SinTime</td><td>float4</td><td>tæ˜¯æ—¶é—´çš„æ­£å¼¦å€¼ï¼Œ4ä¸ªåˆ†é‡çš„å€¼åˆ†åˆ«æ˜¯(t/8, t/4, t/2, t)</td></tr><tr><td>_CosTime</td><td>float4</td><td>tæ˜¯æ—¶é—´çš„ä½™å¼¦å€¼ ï¼Œ4ä¸ªåˆ†é‡åˆ†åˆ«æ˜¯(t/8,t/4, t/2, t)</td></tr><tr><td>unity_DeltaTime</td><td>float4</td><td>dtæ˜¯æ—¶é—´å¢é‡ï¼Œ4ä¸ªåˆ†é‡çš„å€¼åˆ†åˆ«æ˜¯(dt, 1/dt, smoothDt, 1/smoothDt)</td></tr></tbody></table><p>åœ¨åé¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ä¸Šè¿°çš„æ—¶é—´å˜é‡æ¥å®ç°çº¹ç†åŠ¨ç”»å’Œé¡¶ç‚¹åŠ¨ç”»ã€‚</p><h1>çº¹ç†åŠ¨ç”»</h1><p>çº¹ç†åŠ¨ç”»åœ¨æ¸¸æˆä¸­éå¸¸å¹¿æ³›ã€‚å°¤å…¶åœ¨å„ç§èµ„æºéƒ½æ¯”è¾ƒå±€é™çš„ç§»åŠ¨å¹³å°ä¸Šï¼Œæˆ‘ä»¬å¾€å¾€ä¼šä½¿ç”¨çº¹ç†åŠ¨ç”»æ¥ä»£æ›¿å¤æ‚çš„ç²’å­ç³»ç»Ÿç­‰æ¨¡æ‹Ÿå„ç§åŠ¨ç”»æ•ˆæœã€‚</p><h2 id="åºåˆ—å¸§åŠ¨ç”»">åºåˆ—å¸§åŠ¨ç”»</h2><p>æœ€å¸¸è§çš„çº¹ç†åŠ¨ç”»ä¹‹ä¸€å°±æ˜¯åºåˆ—å¸§åŠ¨ç”»ã€‚åºåˆ—å¸§åŠ¨ç”»çš„åŸç†ååˆ†ç®€å•ï¼Œå®ƒåƒæ”¾ç”µå½±ä¸€æ ·ï¼Œä¾æ¬¡æ’­æ”¾ä¸€ç³»åˆ—å…³é”®å¸§å›¾åƒï¼Œå½“æ’­æ”¾é€Ÿåº¦è¾¾åˆ°ä¸€å®šæ•°å€¼æ—¶ï¼Œçœ‹èµ·æ¥å°±åƒæ˜¯ä¸€ä¸ªè¿ç»­çš„åŠ¨ç”»åŒ–ã€‚å®ƒçš„ä¼˜ç‚¹åœ¨äºçµæ´»æ€§å¼ºï¼Œæˆ‘ä»¬ä¸éœ€è¦è¿›è¡Œä»»ä½•çš„ç‰©ç†è®¡ç®—å°±å¯ä»¥å¾—åˆ°éå¸¸ç»†è…»çš„åŠ¨ç”»æ•ˆæœã€‚è€Œå®ƒçš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œç”±äºåºåˆ—å¸§ä¸­æ¯å¼ å…³é”®å¸§å›¾åƒéƒ½ä¸ä¸€æ ·ï¼Œå› æ­¤è¦åˆ¶ä½œä¸€å¼ å‡ºè‰²çš„åºåˆ—å¸§çº¹ç†æ‰€éœ€è¦çš„å·¥ç¨‹é‡å¾ˆå¤§ã€‚</p><p>æƒ³è¦å®ç°åºåˆ—å¸§åŠ¨ç”»ï¼Œæˆ‘ä»¬é¦–å…ˆè¦æä¾›ä¸€å¼ åŒ…å«å…³é”®å¸§å›¾åƒçš„å›¾åƒã€‚<br>åºåˆ—å¸§åŠ¨ç”»çš„ç²¾é«“åœ¨äºï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸ªæ—¶åˆ»è®¡ç®—ä¸‹ä¸ªåº”è¯¥æ’­æ”¾çš„å…³é”®å¸§çš„ä½ç½®ï¼Œå¹¶å¯¹å…³é”®å¸§è¿›è¡Œé‡‡æ ·ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;UnityShaderBook/Chapter11/ImageSequenceAnimation&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Color (&quot;Color Tint&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _MainTex (&quot;Image Sequence&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _HorizontalAmount (&quot;Horizontal Amount&quot;, Float) = 4</span><br><span class="line">        _VerticalAmount (&quot;Vertical Amount&quot;, Float) = 4</span><br><span class="line">        _Speed (&quot;Speed&quot;, Range(1, 100)) = 30</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags&#123;</span><br><span class="line">            &quot;Queue&quot;=&quot;TransParent&quot;</span><br><span class="line">            &quot;IgnoreProjector&quot;=&quot;True&quot;</span><br><span class="line">            &quot;RenderType&quot;=&quot;Transparent&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ZWrite Off</span><br><span class="line">            Blend SrcAlpha OneMinusSrcAlpha</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            #include &quot;UnityCG.cginc&quot;</span><br><span class="line">            </span><br><span class="line">            fixed4 _Color;</span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line">            float _HorizontalAmount;</span><br><span class="line">            float _VerticalAmount;</span><br><span class="line">            float _Speed;</span><br><span class="line">            </span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float4 texcoord : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float2 uv : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line">                o.uv = TRANSFORM_TEX(v.texcoord, _MainTex);</span><br><span class="line">                return  o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target&#123;</span><br><span class="line"></span><br><span class="line">                float time = floor(_Time.y * _Speed);</span><br><span class="line">                float row = floor(time / _HorizontalAmount);</span><br><span class="line">                float column = time - row * _HorizontalAmount;</span><br><span class="line"></span><br><span class="line">                half2 uv = i.uv + half2(column, -row);</span><br><span class="line">                uv.x /= _HorizontalAmount;</span><br><span class="line">                uv.y /= _VerticalAmount;</span><br><span class="line"></span><br><span class="line">                fixed4 c = tex2D(_MainTex, uv);</span><br><span class="line"></span><br><span class="line">                c.rgb *= _Color;</span><br><span class="line">                </span><br><span class="line">                return c;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">Fallback &quot;Transparent/VertexLit&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºåºåˆ—å¸§å›¾åƒé€šå¸¸æ˜¯é€æ˜çº¹ç†ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®Passçš„ç›¸å…³çŠ¶æ€ï¼Œä»¥æ¸²æŸ“é€æ˜æ•ˆæœï¼Œç”±äºåºåˆ—å¸§å›¾åƒé€šå¸¸åŒ…å«äº†é€æ˜é€šé“ï¼Œå› æ­¤å¯ä»¥è¢«å½“æˆæ˜¯ä¸€ä¸ªåŠé€æ˜å¯¹è±¡ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨åŠé€æ˜çš„â€œæ ‡é…â€æ¥è®¾ç½®å®ƒçš„SubShaderæ ‡ç­¾ï¼Œå³æŠŠQueueå’ŒRenderTypeè®¾ç½®æˆTransparentï¼ŒæŠŠIgnoreProjectorè®¾ç½®ä¸ºTrueã€‚åœ¨Passä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Blendå‘½ä»¤æ¥å¼€å¯å¹¶è®¾ç½®æ··åˆæ¨¡å¼ï¼ŒåŒæ—¶å…³é—­äº†æ·±åº¦å†™å…¥ã€‚</p><p>é¡¶ç‚¹ç€è‰²å™¨çš„ä»£ç ååˆ†ç®€å•ï¼Œæˆ‘ä»¬è¿›è¡Œäº†åŸºæœ¬çš„é¡¶ç‚¹å˜æ¢ï¼Œå¹¶æŠŠé¡¶ç‚¹çº¹ç†åæ ‡å­˜å‚¨åˆ°äº†v2fç»“æ„ä½“ä¸­ã€‚</p><p>è¦æ’­æ”¾å¸§åŠ¨ç”»ï¼Œä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—å‡ºæ¯ä¸ªæ—¶åˆ»éœ€è¦æ’­æ”¾çš„å…³é”®å¸§åœ¨çº¹ç†ä¸­çš„ä½ç½®ï¼Œè€Œç”±äºåºåˆ—å¸§çº¹ç†éƒ½æ˜¯æŒ‰è¡ŒæŒ‰åˆ—è¿›è¡Œæ’åˆ—çš„ï¼Œå› æ­¤è¿™ä¸ªä½ç½®å¯ä»¥è®¤ä¸ºæ—¶è¯¥å…³é”®å¸§æ‰€åœ¨çš„è¡Œåˆ—ç´¢å¼•æ•°ã€‚å› æ­¤ï¼Œåœ¨ä¸Šé¢çš„ä»£ç çš„å‰3è¡Œä¸­æˆ‘ä»¬è®¡ç®—è®¡ç®—è¡Œåˆ—å¼ï¼Œå…¶ä¸­ä½¿ç”¨äº†Unityçš„å†…ç½®æ—¶é—´å˜é‡_Timeã€‚ç”±ä¸Šè¡¨çŸ¥é“ï¼Œ_Time.yå°±æ˜¯è‡ªè¯¥åœºæ™¯åŠ è½½åç»è¿‡çš„æ—¶é—´ã€‚æˆ‘ä»¬é¦–å…ˆæŠŠ_Time.yå’Œé€Ÿåº¦å±æ€§_Speedç›¸ä¹˜æ¥å¾—åˆ°æ¨¡æ‹Ÿçš„æ—¶é—´ï¼Œå¹¶ä½¿ç”¨CGçš„floorå‡½æ•°å¯¹ç»“æœå€¼å–æ•´æ¥å¾—åˆ°æ•´æ•°æ—¶é—´timeã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨timeé™¤ä»¥_HorizontalAmountçš„ç»“æœçš„å•†æ¥ä½œä¸ºå½“å‰å¯¹åº”çš„è¡Œç´¢å¼•ï¼Œé™¤æ³•ç»“æœçš„ä½™æ•°å¯¹åº”çš„åˆ™æ—¶åˆ—ç´¢å¼•ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨è¡Œåˆ—ç´¢å¼•å€¼æ¥æ„å»ºçœŸæ­£çš„é‡‡æ ·åæ ‡ã€‚ç”±äºåºåˆ—å¸§å›¾åƒåŒ…å«äº†è®¸å¤šå…³é”®å¸§å›¾åƒï¼Œè¿™æ„å‘³ç€é‡‡æ ·åæ ‡éœ€è¦æ˜ å°„åˆ°æ¯ä¸ªå…³é”®å¸§å›¾åƒçš„åæ ‡èŒƒå›´å†…ã€‚æˆ‘ä»¬å¯ä»¥é¦–å…ˆæŠŠåŸçº¹ç†åæ ‡i.uvæŒ‰è¡Œæ•°å’Œåˆ—æ•°è¿›è¡Œç­‰åˆ†ï¼Œå¾—åˆ°æ¯ä¸ªå­å›¾åƒçš„çº¹ç†åæ ‡èŒƒå›´ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨å½“å‰è¡Œåˆ—æ•°å¯¹ä¸Šé¢çš„ç»“æœè¿›è¡Œåç§»ï¼Œå¾—åˆ°å½“å‰å­å›¾åƒçš„çº¹ç†åæ ‡èŒƒå›´ã€‚éœ€è¦æ³¨æ„çš„æ—¶ï¼Œå¯¹ç«–ç›´æ–¹å‘ä¸Šçš„åæ ‡åç§»è¦ä½¿ç”¨å‡æ³•ï¼Œè¿™æ˜¯å› ä¸ºåœ¨Unityä¸­çº¹ç†åæ ‡ç«–ç›´æ–¹å‘çš„é¡ºåºå’Œåºåˆ—å¸§çº¹ç†ä¸­çš„é¡ºåºæ˜¯ç›¸åçš„ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†çœŸæ­£çš„çº¹ç†é‡‡æ ·åæ ‡ã€‚</p><p>ä»£ç ä¸­çš„<code>half2 uv = i.uv + half2(column, -row);</code>è¿™ä¸€è¡Œè®©æˆ‘è¿·æƒ‘äº†å¾ˆä¹…ï¼Œæˆ‘è¿·æƒ‘çš„ç‚¹åœ¨äºï¼Œiä¸­çš„væœ€å¤§å€¼æ˜¯1ï¼Œè€Œrowçš„æœ€å°å€¼ä¸º1ï¼Œä¹Ÿå°±æ˜¯è¯´uvæœ€ç»ˆçš„ç»“æœé‡Œçš„vçš„å€¼æ˜¯ä¸€ä¸ªå°äºç­‰äº0çš„å€¼ï¼Œä¸ºä»€ä¹ˆé€šè¿‡è¿™ä¸ªå€¼èƒ½å¤Ÿå¾—åˆ°æ­£ç¡®çš„UVé‡‡æ ·åæ ‡å‘¢ï¼Ÿå¥½äº†ç°åœ¨æˆ‘ä»¬æ¥è§£ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å›é¡¾ä¸€ä¸‹åœ¨UnityShaderå…¥é—¨ç²¾è¦ç¬¬ä¸ƒç« çš„7.1.2èŠ‚ï¼Œä»‹ç»çº¹ç†å±æ€§é‚£ä¸€éƒ¨åˆ†ï¼Œä¹¦ä¸­ç»™æˆ‘ä»¬æ¼”ç¤ºäº†ä½¿ç”¨Tillingå’Œoffsetå¯¹çº¹ç†çš„è¡¨ç°é€ æˆçš„å½±å“ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸€éƒ¨åˆ†ææ‡‚äº†ï¼Œä¸Šé¢è¿™è¡Œä»£ç ä¹Ÿå°±è‡ªç„¶è€Œç„¶ææ‡‚äº†ã€‚</p><h2 id="æ»šåŠ¨çš„èƒŒæ™¯">æ»šåŠ¨çš„èƒŒæ™¯</h2><p>å¾ˆå¤š2Dæ¸¸æˆéƒ½ä½¿ç”¨äº†ä¸æ–­æ»šåŠ¨çš„èƒŒæ™¯æ¥æ¨¡æ‹Ÿæ¸¸æˆè§’è‰²åœ¨åœºæ™¯ä¸­çš„ç©¿æ¢­ï¼Œè¿™äº›èƒŒæ™¯å¾€å¾€åŒ…å«äº†å¤šä¸ªå±‚(layer)æ¥æ¨¡æ‹Ÿä¸€ç§è§†å·®æ•ˆæœã€‚è€Œè¿™äº›èƒŒæ™¯çš„å®ç°å¾€å¾€å°±æ˜¯åˆ©ç”¨äº†çº¹ç†åŠ¨ç”»ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å®ç°ä¸€ä¸ªåŒ…å«äº†ä¸¤å±‚çš„æ— é™æ»šåŠ¨çš„2Dæ¸¸æˆèƒŒæ™¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;UnityShaderBook/Chapter11/ScrollingBackground&quot;&#123;</span><br><span class="line"></span><br><span class="line">    Properties&#123;</span><br><span class="line">        _MainTex (&quot;Base Layer (RGB)&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _DetailTex (&quot;2nd Layer (RGB)&quot;, 2D) = &quot;white&quot; &#123;&#125; </span><br><span class="line">        _ScrollX (&quot;Base Layer Scroll Speed&quot;, Float) = 1.0</span><br><span class="line">        _Scroll2X (&quot;2nd Layer Scroll Speed&quot;, Float) = 1.0</span><br><span class="line">        _Multiplier (&quot;Layer Multiplier&quot;, Float) = 1.0</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader&#123;</span><br><span class="line">        </span><br><span class="line">        Tags</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;RenderType&quot;=&quot;Opaque&quot;</span><br><span class="line">            &quot;Queue&quot;=&quot;Geometry&quot;   </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">                </span><br><span class="line">            Tags</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot; </span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            #include &quot;UnityCG.cginc&quot;</span><br><span class="line"></span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line">            sampler2D _DetailTex;</span><br><span class="line">            float4 _DetailTex_ST;</span><br><span class="line">            float _ScrollX;</span><br><span class="line">            float _Scroll2X;</span><br><span class="line">            float _Multiplier;</span><br><span class="line">            </span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float4 texcoord : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float4 uv : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line">                o.uv.xy = TRANSFORM_TEX(v.texcoord, _MainTex) + frac(float2(_ScrollX, 0.0) * _Time.y);</span><br><span class="line">                o.uv.zw = TRANSFORM_TEX(v.texcoord, _DetailTex) + frac(float2(_Scroll2X, 0.0) * _Time.y);</span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                fixed4 firstLayer = tex2D(_MainTex, i.uv.xy);</span><br><span class="line">                fixed4 secondLayer = tex2D(_DetailTex, i.uv.zw);</span><br><span class="line"></span><br><span class="line">                fixed4 c = lerp(firstLayer, secondLayer, secondLayer.a);</span><br><span class="line"></span><br><span class="line">                c.rgb *= _Multiplier;</span><br><span class="line"></span><br><span class="line">                return c;</span><br><span class="line">            &#125;</span><br><span class="line">         </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>lerpæ˜¯å¹²å•¥çš„ï¼Ÿå·²ç»çœ‹åˆ°è¿‡å¥½å¤šæ¬¡äº†ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨lerpå‡½æ•°æ¥æ··åˆä¸¤å¼ çº¹ç†ã€‚fracæ–¹æ³•ç”¨äºè®¡ç®—å¹¶è¿”å›ä¸€ä¸ªæ•°å€¼çš„å°æ•°éƒ¨åˆ†ã€‚å¹¶ä¸æ˜¯å¾ˆç†è§£ä¸ºä»€ä¹ˆè¿™é‡Œè¦ç”¨ä¸€ä¸ªfracæ–¹æ³•ï¼ŒçŒœæµ‹æ˜¯åªå–å°æ•°éƒ¨åˆ†æ¥é¿å…å¤§é‡çš„è®¡ç®—ã€‚</p></blockquote><h1>é¡¶ç‚¹åŠ¨ç”»</h1><p>å¦‚æœä¸€ä¸ªæ¸¸æˆä¸­æ‰€æœ‰çš„ç‰©ä½“éƒ½æ˜¯é™æ­¢çš„ï¼Œè¿™æ ·æ¯ç‡¥çš„ä¸–ç•Œææ€•å¾ˆéš¾å¼•èµ·ç©å®¶çš„å…´è¶£ã€‚é¡¶ç‚¹åŠ¨ç”»å¯ä»¥è®©æˆ‘ä»¬çš„åœºæ™¯å˜å¾—æ›´åŠ ç”ŸåŠ¨æœ‰è¶£ã€‚åœ¨æ¸¸æˆä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸ä½¿ç”¨é¡¶ç‚¹åŠ¨ç”»æ¥æ¨¡æ‹Ÿé£˜åŠ¨çš„æ——å¸œã€æ¹æµçš„å°æºªç­‰æ•ˆæœã€‚æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ ä¸¤ç§å¸¸è§çš„é¡¶ç‚¹åŠ¨ç”»çš„åº”ç”¨â€”â€”æµåŠ¨çš„æ²³æµä»¥åŠå¹¿å‘Šç‰ŒæŠ€æœ¯ã€‚åœ¨æœ¬èŠ‚çš„æœ€åï¼Œæˆ‘ä»¬è¿˜å°†ç»™å‡ºä¸€äº›é¡¶ç‚¹åŠ¨ç”»ä¸­çš„æ³¨æ„äº‹é¡¹ä»¥åŠè§£å†³æ–¹æ³•ã€‚</p><h2 id="æµåŠ¨çš„æ²³æµ">æµåŠ¨çš„æ²³æµ</h2><p>æ²³æµçš„æ¨¡æ‹Ÿæ˜¯é¡¶ç‚¹åŠ¨ç”»æœ€å¸¸è§çš„åº”ç”¨ä¹‹ä¸€ã€‚å®ƒçš„åŸç†é€šå¸¸æ˜¯ä½¿ç”¨æ­£å¼¦å‡½æ•°ç­‰æ¥æ¨¡æ‹Ÿæ°´æµçš„æ³¢åŠ¨ç‰¹æ•ˆã€‚åœ¨æœ¬å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•æ¨¡æ‹Ÿä¸€ä¸ª2Dæ²³æµçš„æ•ˆæœã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;UnityShaderBook/Chapter11/Water&quot;</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _MainTex (&quot;Main Tex&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _Color (&quot;Color Tint&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _Magnitude (&quot;Distortion Magnitude&quot;, Float) = 1</span><br><span class="line">        _Frequency (&quot;Distortion Frequency&quot;, Float) = 1</span><br><span class="line">        _InvWaveLength (&quot;Distortion Inverse Wave Length&quot;, Float) = 10</span><br><span class="line">        _Speed (&quot;Speed&quot;, Float) = 0.5</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">        Tags</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Queue&quot;=&quot;Transparent&quot;</span><br><span class="line">            &quot;IgnoreProjector&quot;=&quot;True&quot;</span><br><span class="line">            &quot;RenderType&quot;=&quot;Transparent&quot;</span><br><span class="line">            &quot;DisableBatching&quot;=&quot;True&quot;    </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">            &#125;</span><br><span class="line">                    </span><br><span class="line">            ZWrite Off</span><br><span class="line">            Blend SrcAlpha OneMinusSrcAlpha</span><br><span class="line">            Cull Off</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #include&quot;UnityCG.cginc&quot;</span><br><span class="line">            </span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line">            </span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line">            fixed4 _Color;</span><br><span class="line">            float _Magnitude;</span><br><span class="line">            float _Frequency;</span><br><span class="line">            float _InvWaveLength;</span><br><span class="line">            float _Speed;</span><br><span class="line">            </span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float4 texcoord : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float2 uv : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                float4 offset;</span><br><span class="line">                offset.yzw = float3(0.0, 0.0, 0.0);</span><br><span class="line"></span><br><span class="line">                offset.x = sin(_Frequency * _Time.y + v.vertex.x * _InvWaveLength + v.vertex.y * _InvWaveLength + v.vertex.z * _InvWaveLength) * _Magnitude;</span><br><span class="line"></span><br><span class="line">                o.pos = mul(unity_MatrixMVP, v.vertex + offset);</span><br><span class="line"></span><br><span class="line">                o.uv = TRANSFORM_TEX(v.texcoord, _MainTex);</span><br><span class="line">                o.uv += float2(0.0, _Time.y * _Speed);</span><br><span class="line"></span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                fixed4 c = tex2D(_MainTex, i.uv);</span><br><span class="line">                c.rgb *= _Color.rgb;</span><br><span class="line">                return c;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Fallback &quot;Transparent/VertexLit&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ é‡åˆ°äº†æ˜¾ç¤ºä¸æ­£ç¡®çš„é—®é¢˜ï¼Œå¾ˆå¯èƒ½æ˜¯å› ä¸ºä½ ä½¿ç”¨çš„äº†Unityå†…ç½®çš„Quadæ¨¡å‹ï¼Œå¦‚æœä½ ä½¿ç”¨Unityå†…ç½®çš„Planeæ¨¡å‹æˆ–è€…éšä¹¦é™„å¸¦çš„æ¨¡å‹ï¼Œå°±èƒ½å¾—åˆ°æ­£ç¡®çš„æ•ˆæœäº†ã€‚ä¸ºå•¥ç”¨Quadå°±ä¸è¡Œå‘¢ï¼Ÿä½ åœ¨Sceneçª—å£ä¸­ï¼Œå°†Shading Modeæ”¹ä¸ºWireframeï¼Œä½ ä¼šçœ‹åˆ°ï¼ŒQuadæ¨¡å‹ä¸Šçš„é¡¶ç‚¹å¾ˆå°‘ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„Shaderæ²¡æœ‰åŠæ³•åšå‡ºæµç•…çš„æ›²çº¿ï¼Œå› æ­¤ï¼Œåªè¦æ²¿ç€yã€zè½´æ–¹å‘ä¸Šçš„é¡¶ç‚¹æ•°è¶Šå¤šï¼Œå®ç°å‡ºæ¥çš„æ•ˆæœè¶Šæµç•…ä¸æ»‘ã€‚</p><p>ä¸ºäº†å¾—å‡ºè¿™ä¸ªæ­£ç¡®çš„ç»“è®ºï¼Œè¸©äº†å¾ˆå¤šå‘ï¼š</p><p>ä¸€å¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯Quadå’ŒPlaneæ¨¡å‹ä¸­é¡¶ç‚¹çš„åˆ†å¸ƒä½ç½®é—®é¢˜å¯¼è‡´çš„æ•ˆæœä¸ä¸€æ ·ï¼šPlaneå¹³é¢ä¸­ï¼Œæ‰€æœ‰ç‚¹çš„yè½´åˆ†é‡éƒ½æ˜¯ä¸€è‡´çš„ï¼Œè€ŒQuadæ¨¡å‹ä¸­ï¼Œæ‰€æœ‰ç‚¹çš„zè½´åˆ†é‡éƒ½æ˜¯ä¸€è‡´çš„ã€‚ä½†æ˜¯æˆ‘åå¤è¯»äº†å‡ éå®ç°æ°´æµæ•ˆæœçš„Shaderè„šæœ¬ï¼Œæˆ‘ç»ˆäºç†è§£äº†ï¼Œè¿™ä¸ªè„šæœ¬è¦åšçš„æ˜¯åœ¨xè½´åˆ†é‡ä¸Šè¿›è¡Œåç§»ï¼Œä¸yå’Œzè½´çš„åˆ†é‡å…¶å®æ˜¯æ²¡æœ‰å…³ç³»çš„ï¼Œä¹Ÿå°±æ˜¯è¯´Planeå’ŒQuadçš„è¡¨ç°åº”è¯¥æ˜¯ä¸€æ ·çš„ã€‚</p><p>åœ¨è¿™é‡Œè¯´ä¸€ä¸‹æˆ‘å¯¹Planeå’ŒQuadçš„ç†è§£ï¼šPlaneæ¨¡å‹æ˜¯ç”¨æ¥åšâ€œåœ°é¢â€çš„ï¼Œè€ŒQuadæ˜¯ç”¨æ¥åšâ€œå¢™é¢â€çš„ã€‚ä½ æ²¡æœ‰å¿…è¦ä½¿ç”¨Planeï¼Œæ—‹è½¬90åº¦ï¼ˆæ— è®ºæ˜¯å“ªä¸ªè½´ï¼‰æ¥åšå¢™é¢ï¼Œç›´æ¥ç”¨Quadå°±å¥½äº†ã€‚</p><p>ç„¶åï¼Œæˆ‘å°†è¿™ä¸ªæè´¨é™„ç»™äº†ä¸€ä¸ªCubeï¼Œæˆ‘åœ¨æ—‹è½¬è¿™ä¸ªç«‹æ–¹ä½“çš„è¿‡ç¨‹ä¸­å‘ç°äº†ä¸€äº›å¥‡æ€ªçš„æ•ˆæœï¼Œä¸è¿‡åœ¨è¯´å¥‡æ€ªæ•ˆæœä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥è¯´ä¸€ä¸‹ç«‹æ–¹ä½“ä¸Šå…­ä¸ªé¢çš„çº¹ç†åæ ‡ç³»ï¼Œå¦‚æœæˆ‘ä»¬ç»™ç«‹æ–¹ä½“æ·»åŠ ä¸€ä¸ªåŒ…å«å•å¼ çº¹ç†çš„æè´¨ï¼Œè¿™å…­ä¸ªé¢éƒ½ä¼šæ˜¾ç¤ºè¿™ä¸ªçº¹ç†ï¼Œä½†æ˜¯æ¯ä¸ªé¢çš„æ˜¾ç¤ºè§„åˆ™æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ–è€…è¯´æ¯ä¸ªé¢çš„çº¹ç†åæ ‡çš„åŸç‚¹æ˜¯å¦‚ä½•ç¡®å®šçš„å‘¢ï¼Ÿç»è¿‡æˆ‘çš„ä¸€ç•ªç ”ç©¶ï¼Œæˆ‘å¾—åˆ°äº†ä¸‹é¢çš„ç»“è®ºï¼šæƒ³è±¡ä¸€ä¸‹å°†ä¸€ä¸ªç«‹æ–¹ä½“å±•å¼€ï¼Œä¹Ÿå°±æ˜¯è¯´å°†ç«‹æ–¹ä½“çš„å…­ä¸ªé¢ç²˜è¿ç€å±•å¼€æˆä¸€å¼ å¹³é¢å›¾å¦‚ä¸‹ï¼š</p><img src="/posts/e01b0f68/dc5fccaa317db0bbbe6e46f5f950cc3.jpg" class=""><p>æ³¨æ„ï¼Œä¸Šé¢æåˆ°çš„åæ ‡è½´éƒ½æ˜¯åœ¨æ¨¡å‹ç©ºé—´ä¸‹çš„ã€‚</p><p>ä½†æˆ‘å‘ç°æˆ‘çœ‹åˆ°çš„ä¸€äº›é¢çš„çº¹ç†åæ ‡å¹¶æ²¡æœ‰æŒ‰ç…§ç«‹æ–¹ä½“å±•å¼€çš„çº¹ç†åæ ‡å±•å¼€ï¼Œé¦–å…ˆä¸Šé¢çš„ç»“è®ºè‚¯å®šæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œäºæ˜¯åˆæ˜¯å¯¹ä»£ç ä¸€é¡¿è‹¦å¿ƒç ”ç©¶ï¼Œå› ä¸ºWaterçš„Shaderä»£ç ä¸­å…³é—­äº†Cullå’ŒZWriteï¼Œå¯¼è‡´å‘ç”Ÿäº†Z-Fightingçš„ç°è±¡ã€‚ä¹Ÿå°±æ˜¯æˆ‘çœ‹åˆ°çš„é‚£äº›çº¹ç†åæ ‡å¼‚å¸¸çš„é¢ï¼Œå…¶å®ä¸æ˜¯æˆ‘ä»¥ä¸ºçš„é‚£ä¸ªé¢ï¼Œè€Œæ˜¯å’Œè¿™ä¸ªé¢å¯¹åº”çš„â€œèƒŒåâ€çš„é‚£ä¸ªé¢ï¼Œç¦»æ‘„åƒæœºè¿‘çš„é‚£ä¸ªé¢æ ¹æœ¬å°±æ²¡æœ‰è¢«æ¸²æŸ“ï¼Œè€Œæ˜¯è¢«å‰”é™¤äº†ï¼Œä½†æˆ‘è¿˜ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¼šè¿™æ ·çš„å…·ä½“åŸå› ï¼Œå› ä¸ºæœ‰çš„é¢æ˜¯æ­£å¸¸æ˜¾ç¤ºè€Œæœ‰çš„é¢å´è¢«å‰”é™¤æ‰äº†ï¼Œæˆ‘ä¹Ÿä¸æƒ³åœ¨è¿™é‡Œæ·±ç©¶ï¼Œä¸è¿‡æˆ‘çŸ¥é“çš„æ˜¯ï¼Œäº§ç”Ÿè¿™æ ·çš„åŸå› æ˜¯åœ¨Sahderä¸­åŒæ—¶é…ç½®äº†ZWriteå’ŒCull Offå¯¼è‡´çš„ã€‚æˆ‘çš„çœ¼ç›éƒ½è¦çœ‹æ™•äº†ã€‚</p><h2 id="å¹¿å‘Šç‰Œ">å¹¿å‘Šç‰Œ</h2><p>å¦ä¸€ç§å¸¸è§çš„é¡¶ç‚¹åŠ¨ç”»å°±æ˜¯å¹¿å‘Šç‰ŒæŠ€æœ¯(Billboarding)ã€‚å¹¿å‘Šç‰ŒæŠ€æœ¯ä¼šæ ¹æ®è§†è§’æ–¹å‘æ¥æ—‹è½¬ä¸€ä¸ªè¢«çº¹ç†ç€è‰²çš„å¤šè¾¹å½¢(é€šå¸¸å°±æ˜¯ç®€å•çš„å››è¾¹å½¢ï¼Œè¿™ä¸ªå¤šè¾¹å½¢å°±æ˜¯å¹¿å‘Šç‰Œ)ï¼Œä½¿å¾—å¤šè¾¹å½¢çœ‹èµ·æ¥å¥½åƒæ€»æ˜¯é¢å¯¹ç€æ‘„åƒæœºã€‚å¹¿å‘Šç‰ŒæŠ€æœ¯è¢«ç”¨äºå¾ˆå¤šåº”ç”¨ï¼Œæ¯”å¦‚æ¸²æŸ“çƒŸé›¾ã€äº‘æœµã€é—ªå…‰æ•ˆæœç­‰ã€‚</p><p>å¹¿å‘Šç‰ŒæŠ€æœ¯çš„æœ¬è´¨å°±æ˜¯æ„å»ºæ—‹è½¬çŸ©é˜µï¼Œè€Œæˆ‘ä»¬çŸ¥é“ä¸€ä¸ªå˜æ¢çŸ©é˜µéœ€è¦3ä¸ªåŸºå‘é‡ã€‚å¹¿å‘Šç‰ŒæŠ€æœ¯ä½¿ç”¨çš„åŸºå‘é‡é€šå¸¸å°±æ˜¯è¡¨é¢æ³•çº¿(normal)ã€æŒ‡å‘ä¸Šçš„æ–¹å‘(up)ä»¥åŠæŒ‡å‘å³çš„æ–¹å‘ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªé”šç‚¹ï¼Œè¿™ä¸ªé”šç‚¹åœ¨æ—‹è½¬è¿‡ç¨‹ä¸­æ˜¯å›ºå®šä¸å˜çš„ï¼Œä»¥æ­¤æ¥ç¡®å®šå¤šè¾¹å½¢åœ¨ç©ºé—´ä¸­çš„ä½ç½®ã€‚</p><p>å¹¿å‘Šç‰ŒæŠ€æœ¯çš„éš¾ç‚¹åœ¨äºå¦‚ä½•æ ¹æ®éœ€æ±‚æ¥æ„å»º3ä¸ªç›¸äº’æ­£äº¤çš„åŸºå‘é‡ã€‚è®¡ç®—è¿‡ç¨‹é€šå¸¸æ˜¯ï¼Œæˆ‘ä»¬é¦–å…ˆä¼šé€šè¿‡åˆå§‹è®¡ç®—å¾—åˆ°ç›®æ ‡çš„è¡¨é¢æ³•çº¿(ä¾‹å¦‚å°±æ˜¯è§†è§’æ–¹å‘)å’ŒæŒ‡å‘ä¸Šçš„æ–¹å‘ï¼Œè€Œä¸¤è€…å¾€å¾€æ˜¯ä¸å‚ç›´çš„ã€‚ä½†æ˜¯ï¼Œä¸¤è€…å…¶ä¸­ä¹‹ä¸€æ˜¯å›ºå®šçš„ï¼Œä¾‹å¦‚å½“æ¨¡æ‹Ÿè‰ä¸›æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å¹¿å‘Šç‰ŒæŒ‡å‘ä¸Šçš„æ–¹å‘æ°¸è¿œæ˜¯(0,1,0)ï¼Œè€Œæ³•çº¿æ–¹å‘åº”è¯¥éšè§†è§’å˜åŒ–ï¼›è€Œå½“æ¨¡æ‹Ÿç²’å­æ•ˆæœæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å¹¿å‘Šç‰Œçš„æ³•çº¿æ–¹å‘æ˜¯å›ºå®šçš„ï¼Œå³æ€»æ˜¯æŒ‡å‘è§†è§’æ–¹å‘ï¼ŒæŒ‡å‘ä¸Šçš„æ–¹å‘åˆ™å¯ä»¥å‘ç”Ÿå˜åŒ–ã€‚è¿™é‡Œçš„æŒ‡å‘ä¸Šå’ŒæŒ‡å‘å³çš„è¡¨è¿°æ˜¯åœ¨æ¨¡å‹ç©ºé—´ä¸‹çš„ã€‚</p><p>æˆ‘ä»¬å‡è®¾æ³•çº¿æ–¹å‘æ˜¯å›ºå®šçš„ï¼Œé¦–å…ˆæˆ‘ä»¬æ ¹æ®åˆå§‹çš„è¡¨é¢æ³•çº¿å’ŒæŒ‡å‘ä¸Šçš„æ–¹å‘æ¥è®¡ç®—å‡ºç›®æ ‡æ–¹å‘çš„æŒ‡å‘å³çš„æ–¹å‘(é€šè¿‡å‰ç§¯æ“ä½œ):<br>$$right = up \times normal$$</p><p>å¯¹å…¶å½’ä¸€åŒ–åï¼Œå†ç”±æ³•çº¿æ–¹å‘å’ŒæŒ‡å‘å³çš„æ–¹å‘è®¡ç®—å‡ºæ­£äº¤çš„æŒ‡å‘ä¸Šçš„æ–¹å‘å³å¯</p><p>$$upâ€™ = normal \times right$$</p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°ç”¨äºæ—‹è½¬çš„3ä¸ªæ­£äº¤åŸºäº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;UnityShaderBook/Chapter11/BillBoard&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _MainTex (&quot;MainTex&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _Color (&quot;Color&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _VerticalBillboarding (&quot;Vertical Restraints&quot;, Range(0,1)) = 1</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Queue&quot;=&quot;Transparent&quot;</span><br><span class="line">            &quot;IgnoreProjector&quot;=&quot;True&quot;</span><br><span class="line">            &quot;RenderType&quot;=&quot;Transparent&quot;</span><br><span class="line">            &quot;DisableBatching&quot;=&quot;True&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ZWrite Off</span><br><span class="line">            Blend SrcAlpha OneMinusSrcAlpha</span><br><span class="line">            Cull Off</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            #include &quot;UnityCG.cginc&quot;</span><br><span class="line">            </span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line">            float4 _Color;</span><br><span class="line">            float _VerticalBillboarding;</span><br><span class="line">            </span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float4 texcoord : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float2 uv : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                float3 center = float3(0,0,0);</span><br><span class="line">                float3 viewer = mul(unity_WorldToObject, float4(_WorldSpaceCameraPos, 1));</span><br><span class="line"></span><br><span class="line">                float3 normalDir = viewer - center;</span><br><span class="line">                normalDir.y = normalDir.y * _VerticalBillboarding;</span><br><span class="line">                normalDir = normalize(normalDir);</span><br><span class="line"></span><br><span class="line">                float3 upDir = abs(normalDir.y) &gt; 0.999 ? float3(0,0,1) : float3(0,1,0);</span><br><span class="line">                float3 rightDir = normalize(cross(upDir, normalDir));</span><br><span class="line">                upDir = normalize(cross(normalDir, rightDir));</span><br><span class="line"></span><br><span class="line">                float3 centerOffs = v.vertex.xyz - center;</span><br><span class="line">                float3 localPos = center + rightDir * centerOffs.x + upDir * centerOffs.y + normalDir * centerOffs.z;</span><br><span class="line"></span><br><span class="line">                o.pos = mul(unity_MatrixMVP, float4(localPos,1));</span><br><span class="line"></span><br><span class="line">                o.uv = TRANSFORM_TEX(v.texcoord, _MainTex);</span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                fixed4 c = tex2D(_MainTex, i.uv);</span><br><span class="line">                c.rgb *= _Color.rgb;</span><br><span class="line">                return c;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">    </span><br><span class="line">    Fallback &quot;Transparent/VertexLit&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œæ³•çº¿çš„æ–¹å‘ä¸æ˜¯é€šè¿‡æµæ°´çº¿çš„è¾“å…¥è¿›æ¥çš„ï¼Œè€Œæ˜¯ç”±æ‘„åƒæœºçš„è§†è§’å’Œcenterç‚¹çš„ä½ç½®ç®—å‡ºæ¥çš„ã€‚</p><p>å¦å¤–ï¼Œä¸ºäº†é˜²æ­¢æ³•çº¿æ–¹å‘å’Œå‘ä¸Šæ–¹å‘å¹³è¡Œï¼Œå¦‚æœå¹³è¡Œï¼Œé‚£ä¹ˆå‰ç§¯å¾—åˆ°çš„ç»“æœå°±æ˜¯é”™è¯¯çš„ï¼Œæˆ‘ä»¬å¯¹æ³•çº¿æ–¹å‘çš„yåˆ†é‡è¿›è¡Œåˆ¤æ–­ï¼Œä»¥å¾—åˆ°åˆé€‚çš„å‘ä¸Šæ–¹å‘ï¼Œç„¶åæ ¹æ®æ³•çº¿æ–¹å‘å’Œç²—ç•¥çš„å‘ä¸Šæ–¹å‘å¾—åˆ°å‘å³æ–¹å‘ï¼Œå¹¶å¯¹ç»“æœè¿›è¡Œå½’ä¸€åŒ–ã€‚ä½†ç”±äºæ­¤æ—¶å‘ä¸Šçš„æ–¹å‘è¿˜æ˜¯ä¸å‡†ç¡®çš„ï¼Œæˆ‘ä»¬åˆæ ¹æ®ç¡®å®šçš„æ³•çº¿æ–¹å‘å’Œå‘å³æ–¹å‘å¾—åˆ°äº†æœ€åçš„å‘ä¸Šæ–¹å‘ã€‚</p><p>è€Œä¸”ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯Unityè‡ªå¸¦çš„Quadæ¥ä½œä¸ºå¹¿å‘Šç‰Œï¼Œè€Œä¸èƒ½ä½¿ç”¨è‡ªå¸¦çš„å¹³é¢ã€‚è¿™æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬çš„ä»£ç æ˜¯å»ºç«‹åœ¨ä¸€ä¸ªç«–ç›´æ‘†æ”¾çš„å¤šè¾¹å½¢çš„åŸºç¡€ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªå¤šè¾¹å½¢çš„é¡¶ç‚¹ç»“æ„éœ€è¦æ»¡è¶³åœ¨æ¨¡å‹ç©ºé—´ä¸‹æ˜¯ç«–ç›´æ’åˆ—çš„ã€‚åªæœ‰è¿™æ ·ï¼Œæˆ‘ä»¬æ‰èƒ½ç”¨v.vertexæ¥è®¡ç®—å¾—åˆ°æ­£ç¡®çš„ç›¸å¯¹äºä¸­å¿ƒçš„ä½ç½®çš„åç§»é‡ã€‚</p><h2 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h2><p>é¡¶ç‚¹åŠ¨ç”»è™½ç„¶éå¸¸çµæ´»æœ‰æ•ˆï¼Œä½†æ˜¯æœ‰ä¸€äº›æ³¨æ„äº‹é¡¹è¦åœ¨æ­¤æé†’ä¸€ä¸‹ã€‚</p><p>é¦–å…ˆå¦‚æˆ‘ä»¬åœ¨11.3.2èŠ‚çœ‹åˆ°çš„é‚£æ ·ï¼Œå¦‚æœæˆ‘ä»¬åœ¨æ¨¡å‹ç©ºé—´ä¸‹è¿›è¡Œäº†ä¸€äº›é¡¶ç‚¹åŠ¨ç”»ï¼Œé‚£ä¹ˆæ‰¹å¤„ç†å¾€å¾€ä¼šç ´åè¿™ç§åŠ¨ç”»æ•ˆæœã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡SubShaderçš„DisableBatchingæ ‡ç­¾æ¥å¼ºåˆ¶å–æ¶ˆå¯¹è¯¥unityShaderçš„æ‰¹å¤„ç†ã€‚ç„¶è€Œï¼Œå–æ¶ˆæ‰¹å¤„ç†ä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½ä¸‹é™ï¼Œå¢åŠ äº†Draw Callï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥å°½é‡é¿å…ä½¿ç”¨æ¨¡å‹ç©ºé—´ä¸‹çš„ä¸€äº›ç»å¯¹ä½ç½®å’Œæ–¹å‘è¿›è¡Œè®¡ç®—ã€‚åœ¨å¹¿å‘Šç‰Œçš„ä¾‹å­ä¸­ï¼Œä¸ºäº†é¿å…æ˜¾å¼ä½¿ç”¨æ¨¡å‹ç©ºé—´çš„ä¸­å¿ƒæ¥ä½œä¸ºé”šç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨é¡¶ç‚¹é¢œè‰²æ¥å­˜å‚¨æ¯ä¸ªé¡¶ç‚¹åˆ°é”šç‚¹çš„è·ç¦»å€¼ï¼Œè¿™ç§åšæ³•åœ¨å•†ä¸šæ¸¸æˆä¸­å¾ˆå¸¸è§ã€‚</p><p>å…¶æ¬¡ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦å¯¹åŒ…å«äº†é¡¶ç‚¹åŠ¨ç”»çš„ç‰©ä½“æ·»åŠ é˜´å½±ï¼Œé‚£ä¹ˆä»ç„¶åƒ9.4èŠ‚ä¸­é‚£æ ·ä½¿ç”¨å†…ç½®çš„Diffuseç­‰åŒ…å«é˜´å½±çš„Passæ¥æ¸²æŸ“ï¼Œå°±å¾—ä¸åˆ°æ­£ç¡®çš„é˜´å½±æ•ˆæœ(è¿™é‡ŒæŒ‡çš„æ˜¯æ— æ³•å‘å…¶ä»–ç‰©ä½“æ­£ç¡®åœ°æŠ•å°„é˜´å½±)ã€‚è¿™æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬è®²è¿‡Unityåœ°é˜´å½±ç»˜åˆ¶éœ€è¦è°ƒç”¨ä¸€ä¸ªShadowCasterPassï¼Œè€Œå¦‚æœç›´æ¥ä½¿ç”¨è¿™äº›å†…ç½®åœ°ShaddowCaster Passï¼Œè¿™ä¸ªPassä¸­å¹¶æ²¡æœ‰è¿›è¡Œç›¸å…³çš„é¡¶ç‚¹åŠ¨ç”»ï¼Œå› æ­¤Unityä¼šä»ç„¶æŒ‰ç…§åŸæ¥çš„é¡¶ç‚¹ä½ç½®æ¥è®¡ç®—é˜´å½±ï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›çœ‹åˆ°çš„ã€‚è¿™æ˜¯ï¼Œæˆ‘ä»¬å°±éœ€è¦æä¾›ä¸€ä¸ªè‡ªå®šä¹‰çš„ShadowCasterPassï¼Œåœ¨è¿™ä¸ªPassä¸­æˆ‘ä»¬å°†è¿›è¡ŒåŒæ ·çš„é¡¶ç‚¹å˜æ¢çš„è¿‡ç¨‹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å‰é¢çš„å®ç°ä¸­ï¼Œå¦‚æœæ¶‰åŠåŠé€æ˜ç‰©ä½“æˆ‘ä»¬éƒ½æŠŠFallbackè®¾ç½®æˆäº†Transparent/VertexLitï¼Œè€ŒTransparent/VertexLitæ²¡æœ‰å®šä¹‰ShadowCaster Passï¼Œå› æ­¤ä¹Ÿå°±ä¸ä¼šäº§ç”Ÿé˜´å½±ã€‚</p><p>ä¸‹é¢æ˜¯å¾—åˆ°æ°´æµæ­£ç¡®é˜´å½±æ•ˆæœçš„Shaderè„šæœ¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Shader &quot;UnityShaderBook/Chapter11/Water&quot;</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _MainTex (&quot;Main Tex&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _Color (&quot;Color Tint&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _Magnitude (&quot;Distortion Magnitude&quot;, Float) = 1</span><br><span class="line">        _Frequency (&quot;Distortion Frequency&quot;, Float) = 1</span><br><span class="line">        _InvWaveLength (&quot;Distortion Inverse Wave Length&quot;, Float) = 10</span><br><span class="line">        _Speed (&quot;Speed&quot;, Float) = 0.5</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">        Tags</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Queue&quot;=&quot;Transparent&quot;</span><br><span class="line">            &quot;IgnoreProjector&quot;=&quot;True&quot;</span><br><span class="line">            &quot;RenderType&quot;=&quot;Transparent&quot;</span><br><span class="line">            &quot;DisableBatching&quot;=&quot;True&quot;    </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">            &#125;</span><br><span class="line">                    </span><br><span class="line">            ZWrite Off</span><br><span class="line">            Blend SrcAlpha OneMinusSrcAlpha</span><br><span class="line">            Cull Off</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #include&quot;UnityCG.cginc&quot;</span><br><span class="line">            </span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line">            </span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line">            fixed4 _Color;</span><br><span class="line">            float _Magnitude;</span><br><span class="line">            float _Frequency;</span><br><span class="line">            float _InvWaveLength;</span><br><span class="line">            float _Speed;</span><br><span class="line">            </span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float4 texcoord : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float2 uv : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                float4 offset;</span><br><span class="line">                offset.yzw = float3(0.0, 0.0, 0.0);</span><br><span class="line"></span><br><span class="line">                offset.x = sin(_Frequency * _Time.y + v.vertex.x * _InvWaveLength + v.vertex.y * _InvWaveLength * 300 + v.vertex.z * _InvWaveLength) * _Magnitude;</span><br><span class="line"></span><br><span class="line">                o.pos = mul(unity_MatrixMVP, v.vertex + offset);</span><br><span class="line">                // o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line"></span><br><span class="line">                o.uv = TRANSFORM_TEX(v.texcoord, _MainTex);</span><br><span class="line">                o.uv += float2(0, _Time.y * _Speed);</span><br><span class="line"></span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                fixed4 c = tex2D(_MainTex, i.uv);</span><br><span class="line">                c.rgb *= _Color.rgb;</span><br><span class="line">                return c;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ShadowCaster&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            #pragma multi_compile_shadowcaster</span><br><span class="line"></span><br><span class="line">            #include &quot;UnityCG.cginc&quot;</span><br><span class="line"></span><br><span class="line">            float _Magnitude;</span><br><span class="line">            float _Frequency;</span><br><span class="line">            float _InvWaveLength;</span><br><span class="line">            float _Speed;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                V2F_SHADOW_CASTER;                </span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f vert(appdata_base v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                float4 offset;</span><br><span class="line"></span><br><span class="line">                offset.yzw = float3(0.0, 0.0, 0.0);</span><br><span class="line"></span><br><span class="line">                offset.x = sin(_Frequency * _Time.y + v.vertex.x * _InvWaveLength + v.vertex.y * _InvWaveLength + v.vertex.z * _InvWaveLength) * _Magnitude;</span><br><span class="line"></span><br><span class="line">                v.vertex = v.vertex + offset;</span><br><span class="line"></span><br><span class="line">                TRANSFER_SHADOW_CASTER_NORMALOFFSET(o);</span><br><span class="line"></span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                SHADOW_CASTER_FRAGMENT(i)       </span><br><span class="line">            &#125;</span><br><span class="line">                                      </span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">    Fallback &quot;Transparent/VertexLit&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é˜´å½±æŠ•å°„çš„é‡ç‚¹åœ¨äºæˆ‘ä»¬éœ€è¦æŒ‰ç…§æ­£å¸¸Passçš„å¤„ç†æ¥å‰”é™¤ç‰‡å…ƒæˆ–è€…è¿›è¡Œé¡¶ç‚¹åŠ¨ç”»ï¼Œä»¥ä¾¿é˜´å½±å¯ä»¥å’Œç‰©ä½“æ­£å¸¸æ¸²æŸ“çš„ç»“æœä¸‹åŒ¹é…ã€‚åœ¨å®šä¹‰çš„é˜´å½±æŠ•å°„Passä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨Unityæä¾›çš„å†…ç½®å®V2F_SHADOW_CASTERã€TRANSFER_SHADOW_CASTER_NORMALOFFSETå’ŒSHADOW_CASTER_FRAGMENTæ¥è®¡ç®—é˜´å½±æŠ•å°„æ—¶éœ€è¦çš„å„ç§å˜é‡ï¼Œè€Œæˆ‘ä»¬å¯ä»¥åªå…³æ³¨è‡ªå®šä¹‰è®¡ç®—çš„éƒ¨åˆ†ã€‚åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåœ¨v2fç»“æ„ä½“ä¸­åˆ©ç”¨V2F_SHADOW_CASTERæ¥å®šä¹‰é˜´å½±æŠ•å°„æ‰€éœ€è¦çš„å˜é‡ï¼Œéšåï¼Œåœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆæŒ‰ä¹‹å‰å¯¹é¡¶ç‚¹çš„å¤„ç†æ–¹æ³•è®¡ç®—é¡¶ç‚¹çš„åç§»é‡ï¼Œä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬ç›´æ¥æŠŠåç§»å€¼åŠ åˆ°é¡¶ç‚¹ä½ç½®å˜é‡ä¸­ï¼Œå†ä½¿ç”¨TRANSFER_SHADOW_CASTER_NORMALOFFSETæ¥è®©Unityä¸ºæˆ‘ä»¬å®Œæˆå‰©ä¸‹çš„å·¥ä½œã€‚åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨SHADOW_CASTER_FRAGMENTæ¥è®©Unityè‡ªåŠ¨å®Œæˆé˜´å½±æŠ•å°„éƒ¨åˆ†ï¼ŒæŠŠç»“æœè¾“å‡ºåˆ°æ·±åº¦å›¾å’Œé˜´å½±æ˜ å°„çº¹ç†ä¸­ã€‚</p><p>é€šè¿‡Unityæä¾›çš„è¿™3ä¸ªå†…ç½®å®ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°è‡ªå®šä¹‰éœ€è¦åœ°é˜´å½±æŠ•å°„åœ°Passï¼Œä½†ç”±äºè¿™äº›å®é‡Œéœ€è¦ä½¿ç”¨ä¸€äº›ç‰¹å®šçš„è¾“å…¥å˜é‡ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¿è¯ä¸ºå®ƒä»¬æä¾›äº†è¿™äº›å˜é‡ã€‚ä¾‹å¦‚TRANSFER_SHADOW_CASTER_NORMALOFFSETä¼šä½¿ç”¨åç§°ä¸ºvä½œä¸ºè¾“å…¥ç»“æ„ä½“ï¼Œvä¸­éœ€è¦åŒ…å«é¡¶ç‚¹ä½ç½®v.vertexå’Œé¡¶ç‚¹æ³•çº¿v.normalçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å†…ç½®çš„appdata_baseç»“æ„ä½“ï¼Œå®ƒåŒ…å«äº†è¿™äº›å¿…éœ€çš„é¡¶ç‚¹å˜é‡ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦è¿›è¡Œé¡¶ç‚¹åŠ¨ç”»ï¼Œå¯ä»¥åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­ç›´æ¥ä¿®æ”¹v.vertexï¼Œå†ä¼ é€’ç»™TRANSFER_SHADOW_CASTER_NORMALOFFSETå³å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> UnityShader </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity </tag>
            
            <tag> Shader </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UnityShaderå…¥é—¨ç²¾è¦ç¬”è®°ï¼ˆåï¼‰â€”â€”é«˜çº§çº¹ç†</title>
      <link href="/posts/f8400f04/"/>
      <url>/posts/f8400f04/</url>
      
        <content type="html"><![CDATA[<h1>ç«‹æ–¹ä½“çº¹ç†</h1><p>åœ¨å›¾å½¢å­¦ä¸­ï¼Œç«‹æ–¹ä½“çº¹ç†(Cubemap)æ˜¯**ç¯å¢ƒæ˜ å°„(Environment Mapping)**çš„ä¸€ç§å®ç°æ–¹æ³•ã€‚ç¯å¢ƒæ˜ å°„å¯ä»¥æ¨¡æ‹Ÿç‰©ä½“å‘¨å›´çš„ç¯å¢ƒï¼Œè€Œä½¿ç”¨äº†ç¯å¢ƒæ˜ å°„çš„ç‰©ä½“å¯ä»¥çœ‹èµ·æ¥åƒæ˜¯é•€äº†ä¸€å±‚é‡‘å±ä¸€æ ·åå°„å¤„å‘¨å›´çš„ç¯å¢ƒã€‚</p><p>å’Œä¹‹å‰è§åˆ°çš„çº¹ç†ä¸åŒï¼Œç«‹æ–¹ä½“çº¹ç†æ€»å…±åŒ…å«å…­å¼ å›¾ç‰‡ï¼Œè¿™äº›å›¾åƒå¯¹åº”äº†ä¸€ä¸ªç«‹æ–¹ä½“çš„å…­ä¸ªé¢ï¼Œç«‹æ–¹ä½“çº¹ç†çš„åç§°ä¹Ÿç”±æ­¤è€Œæ¥ã€‚ç«‹æ–¹ä½“çš„æ¯ä¸ªé¢è¡¨ç¤ºæ²¿ç€ä¸–ç•Œç©ºé—´ä¸‹çš„è½´å‘ï¼ˆä¸Šã€ä¸‹ã€å·¦ã€å³ã€å‰ã€åï¼‰è§‚å¯Ÿæ‰€å¾—çš„å›¾åƒã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å¯¹è¿™æ ·çš„ä¸€ç§çº¹ç†è¿›è¡Œé‡‡æ ·å‘¢ï¼Ÿå’Œä¹‹å‰ä½¿ç”¨çš„äºŒç»´çº¹ç†åæ ‡ä¸åŒï¼Œå¯¹ç«‹æ–¹ä½“çº¹ç†é‡‡æ ·æˆ‘ä»¬éœ€è¦æä¾›ä¸€ä¸ªä¸‰ç»´çš„çº¹ç†åæ ‡ï¼Œè¿™ä¸ªä¸‰ç»´çº¹ç†åæ ‡è¡¨ç¤ºäº†æˆ‘ä»¬åœ¨ä¸–ç•Œç©ºé—´ä¸‹çš„ä¸€ä¸ª3Dæ–¹å‘ã€‚è¿™ä¸ªæ–¹å‘çŸ¢é‡ä»ç«‹æ–¹ä½“çš„ä¸­å¿ƒå‡ºå‘ï¼Œå½“å®ƒå‘å¤–éƒ¨å»¶ä¼¸æ—¶å°±ä¼šå’Œç«‹æ–¹ä½“çš„6ä¸ªçº¹ç†ä¹‹ä¸€å‘ç”Ÿç›¸äº¤ï¼Œè€Œé‡‡æ ·å¾—åˆ°çš„ç»“æœå°±æ˜¯ç”±è¯¥äº¤ç‚¹è®¡ç®—è€Œæ¥çš„ã€‚</p><p>ä½¿ç”¨ç«‹æ–¹ä½“çº¹ç†çš„å¥½å¤„åœ¨äºï¼Œå®ƒçš„å®ç°ç®€å•å¿«é€Ÿï¼Œè€Œä¸”å¾—åˆ°çš„æ•ˆæœä¹Ÿæ˜¯æ¯”è¾ƒå¥½çš„ã€‚ä½†æ˜¯å®ƒä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œä¾‹å¦‚ï¼Œå½“åœºæ™¯ä¸­å¼•å…¥äº†æ–°çš„ç‰©ä½“ã€å…‰æºï¼Œæˆ–è€…ç‰©ä½“å‘ç”Ÿç§»åŠ¨æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦é‡æ–°ç”Ÿæˆç«‹æ–¹ä½“çº¹ç†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç«‹æ–¹ä½“çº¹ç†ä¹Ÿä»…å¯ä»¥åå°„ç¯å¢ƒï¼Œä½†ä¸èƒ½åå°„ä½¿ç”¨äº†è¯¥ç«‹æ–¹ä½“çº¹ç†çš„ç‰©ä½“æœ¬èº«ã€‚è¿™æ˜¯å› ä¸ºï¼Œç«‹æ–¹ä½“çº¹ç†ä¸èƒ½æ¨¡æ‹Ÿå¤šæ¬¡åå°„çš„ç»“æœï¼Œä¾‹å¦‚ä¸¤ä¸ªé‡‘å±çƒäº’ç›¸åå°„çš„æƒ…å†µï¼Œä¸è¿‡Unityä¸­å¼•å…¥çš„å…¨å±€å…‰ç…§ç³»ç»Ÿå…è®¸æˆ‘ä»¬å®ç°è¿™æ ·çš„è‡ªåå°„æ•ˆæœã€‚ç”±äºè¿™æ ·çš„åŸå› ï¼Œæƒ³è¦å¾—åˆ°ä»¤äººä¿¡æœçš„æ¸²æŸ“ç»“æœï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡å¯¹å‡¸é¢ä½“è€Œä¸è¦å¯¹å‡¹é¢ä½“ä½¿ç”¨ç«‹æ–¹ä½“çº¹ç†ï¼Œå› ä¸ºå‡¹é¢ä½“ä¼šåå°„è‡ªèº«ã€‚</p><p>ç«‹æ–¹ä½“çº¹ç†åœ¨å®æ—¶æ¸²æŸ“ä¸­æœ‰å¾ˆå¤šåº”ç”¨ï¼Œæœ€å¸¸è§çš„æ˜¯ç”¨äºå¤©ç©ºç›’å­ä»¥åŠç¯å¢ƒæ˜ å°„ã€‚</p><h2 id="å¤©ç©ºç›’å­">å¤©ç©ºç›’å­</h2><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œåœ¨Window -&gt; Lighting -&gt; Skyboxä¸­è®¾ç½®çš„å¤©ç©ºç›’å­ä¼šåº”ç”¨äºè¯¥åœºæ™¯ä¸­æ‰€æœ‰çš„æ‘„åƒæœºã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›æŸäº›æ‘„åƒæœºå¯ä»¥ä½¿ç”¨ä¸åŒçš„å¤©ç©ºç›’å­ï¼Œå¯ä»¥é€šè¿‡å‘è¯¥æ‘„åƒæœºæ·»åŠ Skyboxç»„ä»¶æ¥è¦†ç›–æ‰ä¹‹å‰çš„è®¾ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æŒ‚è½½æœ‰æ‘„åƒæœºç»„ä»¶çš„ç‰©ä½“ä¸Šç‚¹å‡»Component -&gt; Rendering -&gt; Skyboxæ¥å®Œæˆå¯¹åœºæ™¯é»˜è®¤å¤©ç©ºç›’å­çš„è¦†ç›–ã€‚</p><p>åœ¨Unityä¸­ï¼Œå¤©ç©ºç›’å­æ˜¯åœ¨æ‰€æœ‰ä¸é€æ˜ç‰©ä½“ä¹‹åæ¸²æŸ“çš„ï¼Œè€Œå…¶è¢«åä½¿ç”¨çš„ç½‘æ ¼æ˜¯ä¸€ä¸ªç«‹æ–¹ä½“æˆ–ä¸€ä¸ªç»†åˆ†åçš„çƒä½“ã€‚</p><h2 id="åˆ›å»ºç”¨äºç¯å¢ƒæ˜ å°„çš„ç«‹æ–¹ä½“çº¹ç†">åˆ›å»ºç”¨äºç¯å¢ƒæ˜ å°„çš„ç«‹æ–¹ä½“çº¹ç†</h2><p>é™¤äº†å¤©ç©ºç›’å­ï¼Œç«‹æ–¹ä½“çº¹ç†æœ€å¸¸è§çš„ç”¨å¤„å°±æ˜¯ç”¨äºç¯å¢ƒæ˜ å°„ã€‚é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿå‡ºå…·æœ‰é‡‘å±è´¨æ„Ÿçš„æè´¨ã€‚</p><p>åœ¨Unityä¸­åˆ›å»ºç”¨äºç¯å¢ƒæ˜ å°„çš„ç«‹æ–¹ä½“çº¹ç†çš„æ–¹æ³•æœ‰ä¸‰ç§ï¼šç¬¬ä¸€ç§æ–¹æ³•æ˜¯ç›´æ¥ç”±ä¸€äº›ç‰¹æ®Šå¸ƒå±€çš„çº¹ç†åˆ›å»ºï¼›ç¬¬äºŒç§æ–¹æ³•æ˜¯æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªCubemapèµ„æºï¼Œå†æŠŠ6å¼ å›¾èµ‹ç»™å®ƒï¼›ç¬¬ä¸‰ç§æ–¹æ³•æ˜¯ç”±è„šæœ¬ç”Ÿæˆã€‚</p><p>å¦‚æœä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦æä¾›ä¸€å¼ å…·æœ‰ç‰¹æ®Šå¸ƒå±€çš„çº¹ç†ï¼Œä¾‹å¦‚ç±»ä¼¼æ­£æ–¹ä½“å±•å¼€å›¾çš„äº¤å‰å¸ƒå±€ã€å…¨æ™¯å¸ƒå±€ç­‰ã€‚ç„¶åï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠè¯¥çº¹ç†çš„Texture Typeè®¾ç½®æˆCubemapå³å¯ï¼ŒUnityä¼šä¸ºæˆ‘ä»¬åšå¥½å‰©ä¸‹çš„äº‹æƒ…ã€‚åœ¨åŸºäºç‰©ç†çš„æ¸²æŸ“ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨ä¸€å¼ HDRå›¾åƒæ¥ç”Ÿæˆé«˜è´¨é‡çš„Cubemapã€‚</p><p>ç¬¬äºŒç§æ–¹æ³•æ˜¯Unity5ä¹‹å‰çš„æ–¹æ³•ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åœ¨é¡¹ç›®èµ„æºä¸­åˆ›å»ºä¸€ä¸ªCubemapï¼Œç„¶åæŠŠ6å¼ çº¹ç†æ‹–æ‹½åˆ°å®ƒçš„é¢æ¿ä¸­ã€‚åœ¨Unity5ä¸­ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•æ¥åˆ›å»ºç«‹æ–¹ä½“çº¹ç†ï¼Œè¿™æ˜¯å› ä¸ºç¬¬ä¸€ç§æ–¹æ³•å¯ä»¥å¯¹çº¹ç†æ•°æ®è¿›è¡Œå‹ç¼©ï¼Œè€Œä¸”å¯ä»¥æ”¯æŒè¾¹ç¼˜ä¿®æ­£ã€å…‰æ»‘åå°„(Glossy Reflection)å’ŒHDRç­‰åŠŸèƒ½ã€‚</p><p>å‰é¢ä¸¤ç§æ–¹æ³•éƒ½éœ€è¦æˆ‘ä»¬æå‰å‡†å¤‡å¥½ç«‹æ–¹ä½“çº¹ç†çš„å›¾åƒï¼Œå®ƒä»¬å¾—åˆ°çš„ç«‹æ–¹ä½“çº¹ç†å¾€å¾€æ˜¯è¢«åœºæ™¯ä¸­çš„ç‰©ä½“æ‰€å…±ç”¨çš„ã€‚ä½†åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›æ ¹æ®ç‰©ä½“æ‰€åœ¨åœºæ™¯ä¸­ä½ç½®çš„ä¸åŒï¼Œç”Ÿæˆå®ƒä»¬å„è‡ªä¸åŒçš„ç«‹æ–¹ä½“çº¹ç†ã€‚è¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥åœ¨Unityä¸­é€šè¿‡è„šæœ¬æ¥åˆ›å»ºã€‚è¿™æ˜¯é€šè¿‡åˆ©ç”¨Unityæä¾›çš„<code>Camera.RenderToCubemap</code>å‡½æ•°æ¥å®ç°çš„ã€‚è¿™ä¸ªå‡½æ•°å¯ä»¥æŠŠä»ä»»æ„ä½ç½®è§‚å¯Ÿåˆ°çš„åœºæ™¯å›¾åƒå­˜å‚¨åœ¨6å¼ å›¾ç‰‡ä¸­ï¼Œä»è€Œåˆ›å»ºå‡ºè¯¥ä½ç½®ä¸Šå¯¹åº”çš„ç«‹æ–¹ä½“çº¹ç†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">using UnityEngine;</span><br><span class="line">using UnityEditor;</span><br><span class="line">using System.Collections;</span><br><span class="line"></span><br><span class="line">public class RenderCubemapWizard : ScriptableWizard &#123;</span><br><span class="line"></span><br><span class="line">public Transform renderFromPosition;</span><br><span class="line">public Cubemap cubemap;</span><br><span class="line"></span><br><span class="line">void OnWizardUpdate () &#123;</span><br><span class="line">helpString = &quot;Select transform to render from and cubemap to render into&quot;;</span><br><span class="line">isValid = (renderFromPosition != null) &amp;&amp; (cubemap != null);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void OnWizardCreate () &#123;</span><br><span class="line">// create temporary camera for rendering</span><br><span class="line">GameObject go = new GameObject( &quot;CubemapCamera&quot;);</span><br><span class="line">go.AddComponent&lt;Camera&gt;();</span><br><span class="line">// place it on the object</span><br><span class="line">go.transform.position = renderFromPosition.position;</span><br><span class="line">// render into cubemap</span><br><span class="line">go.GetComponent&lt;Camera&gt;().RenderToCubemap(cubemap);</span><br><span class="line"></span><br><span class="line">// destroy temporary camera</span><br><span class="line">DestroyImmediate( go );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[MenuItem(&quot;GameObject/Render into Cubemap&quot;)]</span><br><span class="line">static void RenderCubemap () &#123;</span><br><span class="line">ScriptableWizard.DisplayWizard&lt;RenderCubemapWizard&gt;(</span><br><span class="line">&quot;Render cubemap&quot;, &quot;Render!&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åå°„">åå°„</h2><p>ä½¿ç”¨äº†åå°„æ•ˆæœçš„ç‰©ä½“é€šå¸¸çœ‹èµ·æ¥å°±åƒæ˜¯é•€äº†ä¸€å±‚é‡‘å±ã€‚æƒ³è¦æ¨¡æ‹Ÿåå°„æ•ˆæœååˆ†ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡å…¥å°„å…‰çº¿çš„æ–¹å‘å’Œè¡¨é¢æ³•çº¿æ–¹å‘æ¥è®¡ç®—åå°„æ–¹å‘ï¼Œå†åˆ©ç”¨åå°„æ–¹å‘å¯¹ç«‹æ–¹ä½“çº¹ç†è¿›è¡Œé‡‡æ ·å³å¯ã€‚</p><p>ç‰©ä½“åå°„åˆ°æ‘„åƒæœºä¸­çš„å…‰çº¿æ–¹å‘ï¼Œå¯ä»¥ç”±å…‰è·¯å¯é€†çš„åŸåˆ™æ¥åå‘æ±‚å¾—ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—è§†è§’æ–¹å‘å…³äºé¡¶ç‚¹æ³•çº¿çš„åå°„æ–¹å‘æ¥æ±‚å¾—å…¥å°„å…‰çº¿çš„æ–¹å‘ã€‚</p><blockquote><p><strong>ç–‘é—®</strong> çœ‹åˆ°è¿™é‡Œçš„æ—¶å€™æˆ‘æ˜¯å¾ˆæ‡µçš„ï¼Œå› ä¸ºå¦‚æœæŒ‰ç…§ä¸Šè¿°å…‰è·¯å¯é€†çš„æ–¹å¼æ¥è®¡ç®—<strong>å…¥å°„å…‰çº¿</strong>çš„æ–¹å‘ï¼Œé‚£ä¹ˆå¯¹ä¸€ä¸ªå‡¹å‡¸ä¸å¹³çš„Meshæ¥è¯´ï¼Œæ¯ä¸€ä¸ªé¡¶ç‚¹æˆ–è€…ç‰‡å…ƒå¤„çš„å…¥å°„æ–¹å‘å¯ä»¥éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å…‰çº¿çš„æ–¹å‘æ˜¯å¯ä»¥ä»»æ„å˜åŒ–çš„ï¼Œæ€ä¹ˆä¼šè¿™æ ·ï¼Ÿ</p></blockquote><blockquote><p><strong>2024-8-1æ›´æ–°</strong> è¿™é‡Œæ˜¯ä¹¦ä¸­çš„æè¿°å¹¶ä¸å‡†ç¡®ï¼ŒåŸæ–‡æ˜¯â€œæˆ‘ä»¬åªéœ€è¦é€šè¿‡å…¥å°„å…‰çº¿çš„æ–¹å‘å’Œè¡¨é¢æ³•çº¿æ–¹å‘æ¥è®¡ç®—åå°„æ–¹å‘â€ï¼Œæ­¤å¤„å…¥å°„å…‰çº¿è¡¨è¿°æœ‰è¯¯ï¼Œåº”è¯¥æ˜¯ä»Cameraå‡ºå‘å°„å‘å½“å‰æ“ä½œçš„è¿™ä¸€é¡¶ç‚¹æˆ–è€…ç‰‡å…ƒæ–¹å‘çš„å‘é‡ã€‚å¦å¤–æˆ‘è§‰å¾—ä¹¦ä¸­å¯¹åå°„çš„è¡¨ç°æè¿°ä¹Ÿä¸å¤Ÿå½¢è±¡ï¼Œåå°„å…¶å®å°±æ˜¯é•œé¢åå°„ï¼Œä½†è¿™é¢é•œå­ä¸æ˜¯å¹³æ•´çš„ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥æŠŠå•ä¸ªé¡¶ç‚¹æˆ–è€…ç‰‡å…ƒçœ‹æˆæ˜¯ä¸€ä¸ªå¹³æ•´çš„é•œé¢ï¼Œæˆ‘ä»¬çš„è§†çº¿ä»æ‘„åƒæœºå¤„å‡ºå‘ï¼Œçœ‹å‘è¿™é¢å¹³æ•´çš„é•œå­ï¼Œç„¶åæˆ‘ä»¬å°±çœ‹åˆ°äº†ç»è¿‡åå°„åçš„ç”»é¢äº†ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Unity Shader Book/Chapter 10/Reflection&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Color (&quot;Color Tint&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _ReflectColor (&quot;Reflect Color&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _ReflectAmount (&quot;Relect Amount&quot;, Range(0,1)) = 1</span><br><span class="line">        _Cubemap (&quot;Reflecttion Cubmap&quot;, Cube)  = &quot;_Skybox&quot; &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;RenderType&quot;=&quot;Opaque&quot;</span><br><span class="line">            &quot;Queue&quot;=&quot;Geometry&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;    </span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma multi_compile_fwdbase</span><br><span class="line">            </span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line">            #include &quot;Lighting.cginc&quot;</span><br><span class="line">            #include &quot;AutoLight.cginc&quot;</span><br><span class="line">            </span><br><span class="line">            fixed4 _Color;</span><br><span class="line">            fixed4 _ReflectColor;</span><br><span class="line">            fixed _ReflectAmount;</span><br><span class="line">            samplerCUBE _Cubemap;</span><br><span class="line">            </span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float3 worldNormal : TEXCOORD0;</span><br><span class="line">                float3 worldPos : TEXCOORD1;</span><br><span class="line">                float3 worldViewDir : TEXCOORD2;</span><br><span class="line">                float3 worldRefl : TEXCPPRD3;</span><br><span class="line">                SHADOW_COORDS(4)</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line">                o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line">                o.worldPos = mul(unity_ObjectToWorld, v.vertex);</span><br><span class="line">                o.worldViewDir = UnityWorldSpaceViewDir(o.worldPos);</span><br><span class="line">                o.worldRefl = reflect(-o.worldViewDir, o.worldNormal);</span><br><span class="line">                </span><br><span class="line">                TRANSFER_SHADOW(o);</span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line">                fixed3 worldLightDir = normalize(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line">                fixed3 worldViewDir = normalize(i.worldNormal);</span><br><span class="line"></span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz;</span><br><span class="line"></span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * _Color.rgb * saturate(dot(worldNormal, worldLightDir));</span><br><span class="line"></span><br><span class="line">                fixed3 reflection = texCUBE(_Cubemap, i.worldRefl).rgb * _ReflectColor.rgb;</span><br><span class="line"></span><br><span class="line">                UNITY_LIGHT_ATTENUATION(atten, i,i.worldPos)</span><br><span class="line"></span><br><span class="line">                fixed3 color = ambient + lerp(diffuse, reflection, _ReflectAmount) * atten;</span><br><span class="line"></span><br><span class="line">                return fixed4(color, 1.0);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Fallback &quot;Reflective/VertexLit&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä½¿ç”¨äº†<code>reflect</code>æ–¹æ³•æ¥è®¡ç®—å…‰çº¿çš„å…¥å°„æ–¹å‘ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨ç¬¬å…­ç« å­¦ä¹ æ ‡å‡†å…‰ç…§æ¨¡å‹ä¸­ä½¿ç”¨è¿‡ã€‚ä¸Šé¢è¿™æ®µShaderä»£ç ä¸­æˆ‘ä»¬è¿˜è®¡ç®—äº†é˜´å½±ï¼Œä½†åœ¨éšä¹¦é™„å¸¦çš„è¿™ä¸€èŠ‚çš„ç¤ºä¾‹åœºæ™¯é‡Œè®¡ç®—é˜´å½±çš„Shaderä»£ç æ ¹æœ¬å°±æ²¡æœ‰èµ·ä½œç”¨ã€‚å¯¹äºåå°„æ•ˆæœçš„è¡¨ç°æ²¡æœ‰ä»»ä½•å½±å“ã€‚</p><blockquote><p>çœ‹å®Œè¿™å°èŠ‚çš„ä»£ç ï¼Œæˆ‘å½“æ—¶æœ‰å¾ˆå¤šç–‘é—®ï¼Ÿä¸ºä»€ä¹ˆè¿™æ®µä»£ç è·Ÿç¬¬å…­ç« ä¸­è®¡ç®—æ ‡å‡†å…‰ç…§æ¨¡å‹çš„ä»£ç ä¸ä¸€æ ·ï¼Ÿé—®è¿‡GPTä¹‹åï¼Œæˆ‘å¾—åˆ°äº†èƒ½å¤Ÿè¯´æœæˆ‘è‡ªå·±çš„è¯´æ³•ï¼šæ ‡å‡†å…‰ç…§æ¨¡å‹å¹¶ä¸æ˜¯é€‚ç”¨äºåƒè¿™ç§éœ€è¦æœ‰é‡‘å±å…‰æ³½çš„æè´¨æè´¨ä¸­ï¼Œå› æ­¤å¯ä»¥è®¤ä¸ºè¿™ä¸€å°èŠ‚çš„ä»£ç æ˜¯ä¸€ç§ç±»ä¼¼æ ‡å‡†å…‰ç…§æ¨¡å‹çš„â€œé‡‘å±å…‰æ³½æ¨¡å‹â€ï¼Œä¸–ç•Œä¸Šè¿˜æœ‰å¾ˆå¤šå¾ˆå¤šå…¶ä»–çš„â€œå…‰ç…§æ¨¡å‹â€ã€‚å½“ç„¶è¿™ä¸ªç§°è°“æ˜¯æˆ‘çç¼–çš„ã€‚</p></blockquote><h2 id="æŠ˜å°„">æŠ˜å°„</h2><p>åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åœ¨Unityä¸­æ¨¡æ‹Ÿå¦ä¸€ç§ç¯å¢ƒæ˜ å°„å¸¸è§çš„åº”ç”¨â€”â€”æŠ˜å°„ã€‚</p><p>å¥½å§ï¼Œæˆ‘æ‰¿è®¤åœ¨çœ‹åˆ°è¿™ä¸€å°èŠ‚çš„æ—¶å€™ï¼Œæˆ‘çš„æ€ç»ªè¿˜åœç•™åœ¨ä¸Šä¸€èŠ‚çš„åå°„å°ç»“ä¸­ï¼Œå¹¶ä¸”æˆ‘å¹¶æ²¡æœ‰å®Œå…¨ç†è§£æŠ˜å°„çš„å«ä¹‰ï¼Œè€Œä¸”è¿™ä¸€å°èŠ‚å¯¹æŠ˜å°„çš„ä»‹ç»ä¹Ÿæœ‰è¯¯å¯¼æ€§ï¼ˆè‡³å°‘å¯¹æˆ‘æ¥è¯´ï¼‰ã€‚ç°åœ¨æˆ‘æŒ‰ç…§æˆ‘è‡ªå·±çš„ç†è§£è¯´ä¸€ä¸‹Unityä¸­çš„æŠ˜å°„ï¼šåœºæ™¯ä¸­æœ‰ä¸€ä¸ªåŠé€æ˜çš„ç‰©ä½“ï¼Œå…‰çº¿ä»ç‰©ä½“çš„ä¸€é¢å°„å…¥ï¼Œå…‰çº¿çš„æ–¹å‘ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å…‰çº¿æœ€ç»ˆæ˜¯ä¼šå°„å‡ºè¿™ä¸ªåŠé€æ˜çš„ç‰©ä½“ï¼Œç„¶åæˆ‘ä»¬å°±èƒ½çœ‹åˆ°è¿™ä¸ªåŠé€æ˜ç‰©ä½“åé¢çš„ä¸€äº›ç‰©ä½“ï¼Œæƒ³è±¡ä¸€ä¸‹åœ¨ä¸€ä¸ªå€’æ»¡æ°´çš„é€æ˜ç»ç’ƒæ¯ä¸­æ’å…¥ä¸€æ ¹ç­·å­ï¼Œæˆ‘ä»¬æ˜¯åœ¨ç»ç’ƒè¢«çš„å¤–é¢çœ‹åˆ°å…‰çº¿ç©¿è¿‡æ¯å­ã€åˆç©¿è¿‡ä¸€éƒ¨åˆ†æ°´ç„¶åçœ‹åˆ°äº†å‘ç”Ÿå½¢å˜çš„èº²åœ¨æ¯å­å’Œæ°´â€œåé¢â€çš„ç­·å­ã€‚è¿™ä¸€å°èŠ‚æˆ‘ä»¬è¦å®ç°çš„å°±æ˜¯è¿™ç§æ•ˆæœã€‚</p><p>æŠ˜å°„çš„ç‰©ç†åŸç†æ¯”åå°„æ›´å¤æ‚ä¸€äº›ã€‚æˆ‘ä»¬åœ¨åˆä¸­ç‰©ç†å°±å·²ç»æ¥è§¦è¿‡æŠ˜å°„çš„å®šä¹‰ï¼šå½“å…‰çº¿ä»ä¸€ç§ä»‹è´¨ï¼ˆæ¯”å¦‚ç©ºæ°”ï¼‰æ–œå°„è¿›å…¥å¦ä¸€ç§ä»‹è´¨ï¼ˆæ¯”å¦‚ç»ç’ƒï¼‰æ—¶ï¼Œä¼ æ’­æ–¹å‘ä¸€èˆ¬ä¼šå‘ç”Ÿå˜åŒ–ã€‚å½“ç»™å®šå…¥å°„è§’æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ–¯æ¶…è€³å®šå¾‹(Snellâ€™a Law)æ¥è®¡ç®—åå°„è§’ã€‚å…¬å¼å¦‚ä¸‹ï¼š</p><p>$$\eta_1\sin\theta_1 =\eta_2\sin\theta_2 $$</p><p>å…¶ä¸­ï¼Œ$\eta_1$å’Œ$\eta_2$åˆ†åˆ«æ˜¯ä¸¤ä¸ªä»‹è´¨çš„æŠ˜å°„ç‡ï¼ŒæŠ˜å°„ç‡æ˜¯ä¸€é¡¹ååˆ†é‡è¦çš„ç‰©ç†å¸¸æ•°ï¼Œä¾‹å¦‚çœŸç©ºçš„æŠ˜å°„ç‡æ˜¯1ï¼Œè€Œç»ç’ƒçš„æŠ˜å°„ç‡ä¸€èˆ¬æ˜¯1.5.</p><p>é€šå¸¸æ¥è¯´ï¼Œå½“å¾—åˆ°æŠ˜å°„æ–¹å‘åæˆ‘ä»¬å°±ä¼šç›´æ¥ä½¿ç”¨å®ƒæ¥å¯¹ç«‹æ–¹ä½“çº¹ç†è¿›è¡Œé‡‡æ ·ï¼Œä½†æ˜¯è¿™æ˜¯ä¸ç¬¦åˆç‰©ç†è§„å¾‹çš„ã€‚å¯¹äºä¸€ä¸ªé€æ˜ç‰©ä½“æ¥è¯´ï¼Œä¸€ç§æ›´å‡†ç¡®çš„æ¨¡æ‹Ÿæ–¹æ³•éœ€è¦è®¡ç®—ä¸¤æ¬¡æŠ˜å°„â€”â€”ä¸€æ¬¡æ˜¯å½“å…‰çº¿è¿›å…¥å®ƒçš„å†…éƒ¨æ—¶ï¼Œè€Œå¦ä¸€æ¬¡åˆ™æ˜¯å®ƒä»å†…éƒ¨å°„å‡ºçš„æ—¶å€™ã€‚ä½†æ˜¯æƒ³è¦åœ¨å®æ—¶æ¸²æŸ“ä¸­æ¨¡æ‹Ÿå‡ºç¬¬äºŒæ¬¡æŠ˜å°„æ–¹å‘æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œè€Œä¸”ä»…ä»…æ¨¡æ‹Ÿä¸€æ¬¡å¾—åˆ°çš„æ•ˆæœä»è§†è§‰ä¸Šçœ‹èµ·æ¥ä¹ŸæŒºåƒé‚£ä¹ˆå›äº‹çš„ã€‚æ­£å¦‚æˆ‘ä»¬ä¹‹å‰æåˆ°çš„å›¾å½¢å­¦ç¬¬ä¸€å‡†åˆ™å¦‚æœå®ƒçœ‹èµ·æ¥æ˜¯å¯¹çš„ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯å¯¹çš„ã€‚å› æ­¤åœ¨å®æ—¶æ¸²æŸ“ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä»…æ¨¡æ‹Ÿä¸€æ¬¡æŠ˜å°„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;UnityShaderBook/Chapter10/Refraction&quot;</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">      _Color (&quot;Color Tint&quot;, Color) = (1, 1, 1, 1)</span><br><span class="line">_RefractColor (&quot;Refraction Color&quot;, Color) = (1, 1, 1, 1)</span><br><span class="line">_RefractAmount (&quot;Refraction Amount&quot;, Range(0, 1)) = 1</span><br><span class="line">_RefractRatio (&quot;Refraction Ratio&quot;, Range(0.1, 1)) = 0.5</span><br><span class="line">_Cubemap (&quot;Refraction Cubemap&quot;, Cube) = &quot;_Skybox&quot; &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;RenderType&quot;=&quot;Opaque&quot;</span><br><span class="line">            &quot;Queue&quot;=&quot;Geometry&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            #pragma multi_compile_fwdbase</span><br><span class="line">            </span><br><span class="line">            #include &quot;Lighting.cginc&quot;</span><br><span class="line">            #include &quot;AutoLight.cginc&quot;</span><br><span class="line"></span><br><span class="line">fixed4 _Color;</span><br><span class="line">fixed4 _RefractColor;</span><br><span class="line">float _RefractAmount;</span><br><span class="line">fixed _RefractRatio;</span><br><span class="line">samplerCUBE _Cubemap;</span><br><span class="line">            </span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">          struct v2f &#123;</span><br><span class="line">float4 pos : SV_POSITION;</span><br><span class="line">float3 worldPos : TEXCOORD0;</span><br><span class="line">fixed3 worldNormal : TEXCOORD1;</span><br><span class="line">fixed3 worldViewDir : TEXCOORD2;</span><br><span class="line">fixed3 worldRefr : TEXCOORD3;</span><br><span class="line">SHADOW_COORDS(4)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line">                o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line">                o.worldPos = mul(unity_ObjectToWorld, v.vertex);</span><br><span class="line">                o.worldViewDir = UnityWorldSpaceViewDir(o.worldPos);</span><br><span class="line"></span><br><span class="line">                o.worldRefr = refract(-normalize(o.worldViewDir), normalize(o.worldNormal), _RefractRatio);</span><br><span class="line"></span><br><span class="line">                TRANSFER_SHADOW(o);</span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line">                fixed3 worldLightDir = normalize(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line"></span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz;</span><br><span class="line"></span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * _Color.rgb * saturate(dot(worldNormal, worldLightDir));</span><br><span class="line"></span><br><span class="line">                fixed3 refraction = texCUBE(_Cubemap, i.worldRefr).rgb * _RefractColor.rgb;</span><br><span class="line"></span><br><span class="line">UNITY_LIGHT_ATTENUATION(atten, i, i.worldPos);</span><br><span class="line"></span><br><span class="line">            fixed3 color = ambient + lerp(diffuse, refraction, _RefractAmount) * atten;</span><br><span class="line">            </span><br><span class="line">                return fixed4(color, 1.0);   </span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Fallback &quot;Reflecive/VertexLit&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä½¿ç”¨äº†CGçš„refractå‡½æ•°æ¥è®¡ç®—æŠ˜å°„æ–¹å‘ã€‚å®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°å³ä¸ºå…¥å°„å…‰çº¿çš„æ–¹å‘ï¼Œå®ƒå¿…é¡»æ˜¯å½’ä¸€åŒ–ä¹‹åçš„çŸ¢é‡ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¡¨é¢æ³•çº¿ï¼Œæ³•çº¿æ–¹å‘åŒæ ·éœ€è¦æ˜¯å½’ä¸€åŒ–ä¹‹åçš„ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å…¥å°„å…‰çº¿æ‰€åœ¨ä»‹è´¨çš„æŠ˜å°„ç‡å’ŒæŠ˜å°„å…‰çº¿æ‰€åœ¨ä»‹è´¨çš„æŠ˜å°„ç‡ä¹‹é—´çš„æ¯”å€¼ï¼Œä¾‹å¦‚å¦‚æœå…‰æ˜¯ä»ç©ºæ°”å°„åˆ°ç»ç’ƒè¡¨é¢ï¼Œé‚£ä¹ˆè¿™ä¸ªå‚æ•°åº”è¯¥æ˜¯ç©ºæ°”çš„æŠ˜å°„ç‡å’Œç»ç’ƒçš„æŠ˜å°„ç‡ä¹‹é—´çš„æ¯”å€¼ï¼Œå³1/1.5.å®ƒçš„è¿”å›å€¼å°±æ˜¯è®¡ç®—è€Œå¾—çš„æŠ˜å°„æ–¹å‘ï¼Œå®ƒçš„æ¨¡åˆ™å¯¹åº”å…¥å°„å…‰çº¿çš„æ¨¡ã€‚</p><p>ç„¶åæˆ‘ä»¬åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­ä½¿ç”¨æŠ˜å°„æ–¹å‘å¯¹ç«‹æ–¹ä½“çº¹ç†è¿›è¡Œé‡‡æ ·ã€‚åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰å¯¹i.worldRefrè¿›è¡Œå½’ä¸€åŒ–æ“ä½œï¼Œå› ä¸ºå¯¹ç«‹æ–¹ä½“çº¹ç†çš„é‡‡æ ·åªéœ€è¦æä¾›æ–¹å‘å³å¯ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨_RefractAmountæ¥æ··åˆæ¼«åå°„é¢œè‰²å’ŒæŠ˜å°„é¢œè‰²ï¼Œå¹¶å’Œç¯å¢ƒå…‰ç…§ç›¸åŠ åè¿”å›ã€‚</p><h2 id="è²æ¶…å°”åå°„">è²æ¶…å°”åå°„</h2><p>åœ¨å®æ—¶æ¸²æŸ“ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨è²æ¶…å°”åå°„(<code>Fresnel reflection</code>)æ¥æ ¹æ®è§†è§’æ–¹å‘æ§åˆ¶åå°„ç¨‹åº¦ã€‚é€šä¿—æ¥è®²ï¼Œè²æ¶…å°”åå°„æè¿°äº†ä¸€ç§å…‰å­¦ç°è±¡ï¼Œå³å½“å…‰çº¿ç…§å°„åˆ°ç‰©ä½“è¡¨é¢ä¸Šæ—¶ï¼Œä¸€éƒ¨åˆ†å‘ç”Ÿåå°„ï¼Œä¸€éƒ¨åˆ†è¿›å…¥ç‰©ä½“å†…éƒ¨å‘ç”ŸæŠ˜å°„æˆ–æ•£å°„ã€‚è¢«åå°„çš„å…‰å’Œå…¥å°„å…‰ä¹‹é—´å­˜åœ¨ä¸€å®šçš„æ¯”ç‡å…³ç³»ï¼Œè¿™ä¸ªæ¯”ç‡å…³ç³»å¯ä»¥é€šè¿‡è²æ¶…å°”ç­‰å¼è¿›è¡Œè®¡ç®—ã€‚ä¸€ä¸ªå¸¸ç”¨çš„ä¾‹å­å°±æ˜¯ï¼Œå½“ä½ ç«™åœ¨æ¹–è¾¹ï¼Œç›´æ¥ä½å¤´çœ‹è„šè¾¹çš„æ°´é¢æ—¶ï¼Œä½ ä¼šå‘ç°æ°´å‡ ä¹æ˜¯é€æ˜çš„ï¼Œä½ å¯ä»¥ç›´æ¥çœ‹åˆ°æ°´åº•ä¸‹çš„å°é±¼å’ŒçŸ³å­ï¼›ä½†æ˜¯ï¼Œå½“ä½ æŠ¬å¤´çœ‹å‘è¿œå¤„çš„æ°´é¢æ—¶ï¼Œä¼šå‘ç°å‡ ä¹çœ‹ä¸åˆ°æ°´ä¸‹çš„æƒ…æ™¯ï¼Œåªèƒ½çœ‹åˆ°æ°´è¡¨é¢åå°„çš„ç¯å¢ƒã€‚è¿™å°±æ˜¯æ‰€è°“çš„è²æ¶…å°”æ•ˆæœï¼Œäº‹å®ä¸Šï¼Œä¸åªæ˜¯æ°´ã€ç»ç’ƒè¿™æ ·çš„åå…‰ç‰©ä½“å…·æœ‰è²æ¶…å°”æ•ˆæœï¼Œå‡ ä¹ä»»ä½•ç‰©ä½“éƒ½æˆ–å¤šæˆ–å°‘åœ°åŒ…å«äº†è²æ¶…å°”æ•ˆæœï¼Œè¿™æ˜¯åŸºäºç‰©ç†çš„æ¸²æŸ“ä¸­éå¸¸é‡è¦çš„ä¸€é¡¹é«˜å…‰åå°„è®¡ç®—å› å­ã€‚</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•è®¡ç®—è²æ¶…å°”åå°„å‘¢ï¼Ÿè¿™å°±éœ€è¦ä½¿ç”¨è²æ¶…å°”ç­‰å¼è¿›è¡Œè®¡ç®—ã€‚çœŸå®ä¸–ç•Œçš„è²æ¶…å°”ç­‰å¼æ˜¯ååˆ†å¤æ‚çš„ï¼Œä½†åœ¨å®æ—¶æ¸²æŸ“ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨ä¸€äº›è¿‘ä¼¼çš„å…¬å¼æ¥è®¡ç®—ã€‚å…¶ä¸­ä¸€ä¸ªè‘—åçš„è¿‘ä¼¼å…¬å¼å°±æ˜¯Schlickè²æ¶…å°”è¿‘ä¼¼ç­‰å¼ï¼š</p><p>$$F_{Schlink}(v,n) = F_0 + (1 - F_0)(1 - v \cdot n)^5$$</p><p>å…¶ä¸­ï¼Œ$F_0$æ˜¯ä¸€ä¸ªåå°„ç³»æ•°ï¼Œç”¨äºæ§åˆ¶è²æ¶…å°”åå°„çš„å¼ºåº¦ï¼Œvæ˜¯è§†è§’æ–¹å‘ï¼Œnæ˜¯è¡¨é¢æ³•çº¿ã€‚å¦ä¸€ä¸ªåº”ç”¨æ¯”è¾ƒå¹¿æ³›çš„ç­‰å¼æ˜¯Empricialè²æ¶…å°”è¿‘ä¼¼ç­‰å¼ï¼š</p><p>$$F_{Empricial}(v,n) = max(0, min(1, bias + scale \times (1 - v \cdot n)^{power}))$$</p><p>å…¶ä¸­ï¼Œbiasã€scaleå’Œpoweræ˜¯æ§åˆ¶é¡¹ã€‚</p><p>ä½¿ç”¨ä¸Šé¢çš„è²æ¶…å°”è¿‘ä¼¼ç­‰å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¾¹ç•Œå¤„æ¨¡æ‹Ÿåå°„å…‰å¼ºåº¦å’ŒæŠ˜å°„å…‰å¼ºåº¦/æ¼«åå°„å…‰å¼ºä¹‹é—´çš„å˜åŒ–ï¼Œåœ¨è®¸å¤šè½¦æ¼†ã€æ°´é¢ç­‰æè´¨çš„æ¸²æŸ“ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨è²æ¶…å°”åå°„æ¥æ¨¡æ‹Ÿæ›´åŠ çœŸå®çš„åå°„æ•ˆæœã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;UnityShaderBook/Chapter10/Fresnel&quot;&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Color (&quot;Color Tint&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _FresnelScale (&quot;Fresnel Scale&quot;, Range(0,1)) = 0.5</span><br><span class="line">        _Cubemap (&quot;Reflection Cubemap&quot;, Cube) = &quot;_Skybox&quot; &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Queue&quot;=&quot;Geometry&quot;</span><br><span class="line">            &quot;RenderType&quot;=&quot;Opaque&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;   </span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            #pragma multi_compile_fwdbase</span><br><span class="line">            </span><br><span class="line">            #include &quot;Lighting.cginc&quot;</span><br><span class="line">            #include &quot;AutoLight.cginc&quot;</span><br><span class="line"></span><br><span class="line">            fixed4 _Color;</span><br><span class="line">            float _FresnelScale;</span><br><span class="line">            samplerCUBE _Cubemap;</span><br><span class="line"></span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float3 worldNormal : TEXCOORD0;</span><br><span class="line">                float3 worldPos : TEXCOORD1;</span><br><span class="line">                float3 worldViewDir : TEXCOORD2;</span><br><span class="line">                float3 worldRefl : TEXCOORD3;</span><br><span class="line">                SHADOW_COORDS(4)</span><br><span class="line">            &#125;;</span><br><span class="line">            </span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line">                o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line">                o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;</span><br><span class="line">                o.worldViewDir = UnityWorldSpaceViewDir(o.worldPos);</span><br><span class="line">                o.worldRefl = reflect(-o.worldViewDir, o.worldNormal);</span><br><span class="line">                TRANSFER_SHADOW(o);</span><br><span class="line">                </span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line">                fixed3 worldLightDir = normalize(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line">                fixed3 worldViewDir = normalize(i.worldViewDir);</span><br><span class="line"></span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz;</span><br><span class="line"></span><br><span class="line">                UNITY_LIGHT_ATTENUATION(atten, i, i.worldPos)</span><br><span class="line">                </span><br><span class="line">                fixed3 reflection = texCUBE(_Cubemap, i.worldRefl).rgb;</span><br><span class="line"></span><br><span class="line">                fixed fresnel = _FresnelScale + (1 - _FresnelScale) * pow(1 - dot(worldViewDir, worldNormal), 5);</span><br><span class="line">                </span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * _Color.rgb * saturate(dot(worldNormal, worldLightDir));</span><br><span class="line"></span><br><span class="line">                fixed3 color = ambient + lerp(diffuse, reflection, saturate(fresnel)) * atten;</span><br><span class="line"></span><br><span class="line">                return fixed4(color, 1.0);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">Fallback &quot;Reflective/VertexLit&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>æ¸²æŸ“çº¹ç†</h1><p>åœ¨ä¹‹å‰çš„å­¦ä¹ ä¸­ï¼Œä¸€ä¸ªæ‘„åƒæœºçš„æ¸²æŸ“ç»“æœä¼šè¾“å‡ºåˆ°é¢œè‰²ç¼“å†²ä¸­ï¼Œå¹¶æ˜¾ç¤ºåˆ°æˆ‘ä»¬çš„å±å¹•ä¸Šã€‚ç°åœ¨çš„GPUå…è®¸æˆ‘ä»¬æŠŠæ•´ä¸ªä¸‰ç»´åœºæ™¯æ¸²æŸ“åˆ°ä¸€ä¸ªä¸­é—´ç¼“å†²ä¸­ï¼Œå³æ¸²æŸ“ç›®æ ‡çº¹ç†ï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿçš„å¸§ç¼“å†²æˆ–åå¤‡ç¼“å†²ã€‚ä¸ä¹‹ç›¸å…³çš„æ˜¯å¤šé‡æ¸²æŸ“ç›®æ ‡ï¼Œè¿™ç§æŠ€æœ¯æŒ‡çš„æ˜¯GPUå…è®¸æˆ‘ä»¬æŠŠåœºæ™¯åŒæ—¶æ¸²æŸ“åˆ°å¤šä¸ªæ¸²æŸ“ç›®æ ‡çº¹ç†ä¸­ï¼Œè€Œä¸å†éœ€è¦ä¸ºæ¯ä¸ªæ¸²æŸ“ç›®æ ‡çº¹ç†å•ç‹¬æ¸²æŸ“å®Œæ•´çš„åœºæ™¯ã€‚å»¶è¿Ÿæ¸²æŸ“å°±æ˜¯ä½¿ç”¨å¤šé‡æ¸²æŸ“ç›®æ ‡çš„ä¸€ä¸ªåº”ç”¨ã€‚</p><p>Unityä¸ºæ¸²æŸ“ç›®æ ‡çº¹ç†å®šä¹‰äº†ä¸€ç§ä¸“é—¨çš„çº¹ç†ç±»å‹â€”â€”æ¸²æŸ“çº¹ç†(Render Texture)ã€‚åœ¨Unityä¸­ä½¿ç”¨æ¸²æŸ“çº¹ç†é€šå¸¸æœ‰ä¸¤ç§æ–¹å¼ï¼šä¸€ç§æ–¹å¼æ˜¯åœ¨Projectç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ¸²æŸ“çº¹ç†ï¼Œç„¶åæŠŠæŸä¸ªæ‘„åƒæœºçš„æ¸²æŸ“ç›®æ ‡è®¾ç½®æˆè¯¥æ¸²æŸ“çº¹ç†ï¼Œè¿™æ ·ä¸€æ¥è¯¥æ‘„åƒæœºçš„æ¸²æŸ“ç»“æœå°±ä¼šå®æ—¶æ›´æ–°åˆ°æ¸²æŸ“çº¹ç†ä¸­ï¼Œè€Œä¸ä¼šæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€‰æ‹©æ¸²æŸ“çº¹ç†çš„åˆ†è¾¨ç‡ã€æ»¤æ³¢æ¨¡å¼ç­‰çº¹ç†å±æ€§ã€‚å¦ä¸€ç§æ–¹å¼æ˜¯åœ¨å±å¹•åå¤„ç†æ—¶ä½¿ç”¨GrabPasså‘½ä»¤æˆ–è€…OnRenderImageå‡½æ•°æ¥è·å–å½“å‰å±å¹•å›¾åƒï¼ŒUnityä¼šæŠŠè¿™ä¸ªå±å¹•å›¾åƒæ”¾åˆ°ä¸€å¼ å’Œå±å¹•åˆ†è¾¨ç‡ç­‰åŒçš„æ¸²æŸ“çº¹ç†ä¸­ï¼Œä¸‹é¢æˆ‘ä»¬å¯ä»¥åœ¨è‡ªå®šä¹‰çš„Passä¸­æŠŠå®ƒä»¬å½“ä½œæ™®é€šçš„çº¹ç†æ¥è¿›è¡Œå¤„ç†ï¼Œä»è€Œå®ç°å„ç§å±å¹•çš„ç‰¹æ•ˆã€‚æˆ‘ä»¬å°†ä¾æ¬¡å­¦ä¹ è¿™ä¸¤ç§æ–¹æ³•åœ¨Unityä¸­çš„å®ç°ã€‚</p><h2 id="é•œå­æ•ˆæœ">é•œå­æ•ˆæœ</h2><p>åœ¨æœ¬èŠ‚ä¸­æˆ‘ä»¬å°†æ¥å­¦ä¹ ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨æ¸²æŸ“çº¹ç†æ¥æ¨¡æ‹Ÿé•œå­æ•ˆæœã€‚</p><p>æœ€åï¼Œä¸ºäº†å¾—åˆ°ä»é•œå­å‡ºå‘è§‚å¯Ÿåˆ°çš„åœºæ™¯å›¾åƒï¼Œæˆ‘ä»¬è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªæ‘„åƒæœºï¼Œå¹¶è°ƒæ•´å®ƒçš„ä½ç½®ã€è£å‰ªå¹³é¢ã€è§†è§’ç­‰ï¼Œä½¿å¾—å®ƒçš„æ˜¾ç¤ºå›¾åƒæ˜¯æˆ‘ä»¬å¸Œæœ›çš„é•œå­å›¾åƒã€‚ç”±äºè¿™ä¸ªæ‘„åƒæœºä¸éœ€è¦ç›´æ¥æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œè€Œæ˜¯ç”¨äºæ¸²æŸ“çº¹ç†ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æŠŠä¸Šä¸€æ­¥ä¸­åˆ›å»ºçš„MirrorTextureæ‹–æ‹½åˆ°è¯¥æ‘„åƒæœºçš„TargetTextureã€‚</p><p>é•œå­å®ç°çš„åŸç†å¾ˆç®€å•ï¼Œå®ƒä½¿ç”¨ä¸€ä¸ªæ¸²æŸ“çº¹ç†ä½œä¸ºè¾“å…¥å±æ€§ï¼Œå¹¶æŠŠè¯¥æ¸²æŸ“çº¹ç†åœ¨æ°´å¹³æ–¹å‘ä¸Šç¿»è½¬åç›´æ¥æ˜¾ç¤ºåˆ°ç‰©ä½“ä¸Šå³å¯ã€‚åœ¨æ–°å»ºçš„Shaderæ–‡ä»¶ä¸­å®ç°ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;UnityShaderBook/Chapter10/Mirror&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _MainTex (&quot;MainTex&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">                &quot;RenderType&quot;=&quot;Opaque&quot;</span><br><span class="line">                &quot;Queue&quot;=&quot;Geometry&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            </span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float4 texcoord : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                fixed4 uv : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line">            </span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line">                o.uv = v.texcoord;</span><br><span class="line"></span><br><span class="line">                // é•œå­æ•ˆæœéœ€è¦åè½¬xè½´</span><br><span class="line">                o.uv.x = 1 - o.uv.x;</span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target&#123;</span><br><span class="line">                return tex2D(_MainTex, i.uv);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬åè½¬äº†xåˆ†é‡çš„çº¹ç†åæ ‡ï¼Œè¿™æ˜¯å› ä¸ºï¼Œé•œå­é‡Œæ˜¾ç¤ºçš„å›¾åƒéƒ½æ˜¯å·¦å³ç›¸åçš„ã€‚<br>ä¿å­˜åè¿”å›åœºæ™¯ï¼Œå¹¶æŠŠæˆ‘ä»¬åˆ›å»ºçš„MirrorTextureæ¸²æŸ“çº¹ç†æ‹–æ‹½åˆ°æè´¨çš„MainTexå±æ€§ä¸­ã€‚å°±å¯ä»¥å¾—åˆ°é•œå­æ•ˆæœäº†ã€‚<br>åœ¨ä¸Šé¢çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬æŠŠæ¸²æŸ“çº¹ç†çš„åˆ†è¾¨ç‡å¤§å°è®¾ç½®æˆ256 $\times$ 256ã€‚æœ‰æ—¶ï¼Œè¿™æ ·çš„åˆ†è¾¨ç‡ä¼šä½¿å›¾åƒæ¨¡ç³Šä¸æ¸…ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ›´é«˜çš„åˆ†è¾¨ç‡æˆ–æ›´å¤šçš„æŠ—é”¯é½¿é‡‡æ ·ç­‰ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„æ›´é«˜çš„åˆ†è¾¨ç‡ä¼šå½±å“å¸¦å®½å’Œæ€§èƒ½ï¼Œæˆ‘ä»¬åº”å½“å°½é‡ä½¿ç”¨è¾ƒå°çš„åˆ†è¾¨ç‡ã€‚</p><h2 id="ç»ç’ƒæ•ˆæœ">ç»ç’ƒæ•ˆæœ</h2><p>åœ¨Unityä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨UnityShaderä¸­ä½¿ç”¨ä¸€ç§ç‰¹æ®Šçš„Passæ¥å®Œæˆè·å–å±å¹•å›¾åƒçš„ç›®çš„ï¼Œè¿™å°±æ˜¯GrabPassã€‚å½“æˆ‘ä»¬åœ¨Shaderä¸­å®šä¹‰äº†ä¸€ä¸ªGrabPassåï¼ŒUnityä¼šæŠŠå½“å‰å±å¹•çš„å›¾åƒç»˜åˆ¶åœ¨ä¸€å¼ çº¹ç†ä¸­ï¼Œä»¥ä¾¿æˆ‘ä»¬åœ¨åç»­çš„Passä¸­è®¿é—®å®ƒã€‚æˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨GrabPassæ¥å®ç°è¯¸å¦‚ç»ç’ƒç­‰é€æ˜æè´¨çš„æ¨¡æ‹Ÿï¼Œä¸ä½¿ç”¨ç®€å•çš„é€æ˜æ··åˆä¸åŒï¼Œä½¿ç”¨grabPasså¯ä»¥è®©æˆ‘ä»¬å¯¹è¯¥ç‰©ä½“åé¢çš„å›¾åƒè¿›è¡Œæ›´åŠ å¤æ‚çš„å¤„ç†ï¼Œä¾‹å¦‚ä½¿ç”¨æ³•çº¿æ¥æ¨¡æ‹ŸæŠ˜å°„æ•ˆæœï¼Œè€Œä¸å†æ˜¯ç®€å•çš„å±å¹•é¢œè‰²è¿›è¡Œæ··åˆã€‚</p><p>éœ€è¦æ³¨æ„çš„æ—¶ï¼Œåœ¨ä½¿ç”¨GrabPassçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦é¢å¤–å°å¿ƒç‰©ä½“çš„æ¸²æŸ“é˜Ÿåˆ—çš„è®¾ç½®ã€‚æ­£å¦‚ä¹‹å‰æ‰€è¯´ï¼ŒGrabPassé€šå¸¸ç”¨äºæ¸²æŸ“é€æ˜ç‰©ä½“ã€‚å°½ç®¡ä»£ç é‡Œé¢å¹¶ä¸åŒ…å«æ··åˆæŒ‡ä»¤ï¼Œä½†æˆ‘ä»¬å¾€å¾€ä»ç„¶éœ€è¦æŠŠæ‰€æœ‰çš„ç‰©ä½“çš„æ¸²æŸ“é˜Ÿåˆ—è®¾ç½®æˆé€æ˜é˜Ÿåˆ—ã€‚è¿™æ ·æ‰å¯ä»¥ä¿è¯ï¼Œå½“æ¸²æŸ“è¯¥ç‰©ä½“çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„ä¸é€æ˜ç‰©ä½“éƒ½å·²ç»è¢«ç»˜åˆ¶åœ¨å±å¹•ä¸Šï¼Œä»è€Œè·å¾—æ­£ç¡®çš„å±å¹•å›¾åƒã€‚</p><p>æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ä¸€ä¸ªGrabPassæ¥æ¨¡æ‹Ÿç»ç’ƒçš„æ•ˆæœï¼Œè¿™ç§æ•ˆæœçš„å®ç°éå¸¸ç®€å•ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨ä¸€å¼ æ³•çº¿çº¹ç†æ¥ä¿®æ”¹æ¨¡å‹çš„æ³•çº¿ä¿¡æ¯ï¼Œç„¶åä½¿ç”¨äº†10.1èŠ‚ä»‹ç»çš„åå°„æ–¹æ³•ï¼Œé€šè¿‡ä¸€ä¸ªCubmapæ¥æ¨¡æ‹Ÿç»ç’ƒçš„åå°„ï¼Œè€Œåœ¨æ¨¡æ‹Ÿåç§»åï¼Œå†å¯¹å±å¹•å›¾åƒè¿›è¡Œé‡‡æ ·æ¨¡æ‹Ÿè¿‘ä¼¼çš„æŠ˜å°„æ•ˆæœã€‚</p><p>æˆ‘ä»¬é¦–å…ˆåœ¨SubShaderçš„æ ‡ç­¾ä¸­å°†æ¸²æŸ“é˜Ÿåˆ—è®¾ç½®æˆTransparentï¼Œå°½ç®¡åœ¨åé¢çš„RenderTypeè¢«è®¾ç½®æˆäº†Opaqueã€‚è¿™ä¸¤è€…çœ‹ä¼¼çŸ›ç›¾ï¼Œä½†å®é™…ä¸ŠæœåŠ¡äºä¸åŒçš„éœ€æ±‚ã€‚æˆ‘ä»¬åœ¨ä¹‹å‰è¯´è¿‡ï¼ŒæŠŠQueueè®¾ç½®æˆTransparentå¯ä»¥ç¡®ä¿ç‰©ä½“æ¸²æŸ“æ—¶ï¼Œå…¶ä»–æ‰€æœ‰çš„ä¸é€æ˜ç‰©ä½“éƒ½å·²ç»è¢«æ¸²æŸ“åˆ°å±å¹•ä¸Šäº†ï¼Œå¦åˆ™å°±å¯èƒ½æ— æ³•æ­£ç¡®å¾—åˆ°&quot;é€è¿‡ç»ç’ƒçœ‹åˆ°çš„å›¾åƒ&quot;ã€‚è€Œè®¾ç½®RenderTypeåˆ™æ˜¯ä¸ºäº†åœ¨ä½¿ç”¨ç€è‰²å™¨æ›¿æ¢(Shader Replacement)æ—¶ï¼Œè¯¥ç‰©ä½“å¯ä»¥åœ¨éœ€è¦æ—¶è¢«æ­£ç¡®æ¸²æŸ“ã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨æˆ‘ä»¬éœ€è¦å¾—åˆ°æ‘„åƒæœºçš„æ·±åº¦å’Œæ³•çº¿çº¹ç†æ—¶ï¼Œè¿™ä¼šåœ¨åä¸‰ç« çš„æ—¶å€™è®²åˆ°ã€‚</p><p>éšåï¼Œæˆ‘ä»¬é€šè¿‡å…³é”®è¯GrabPasså®šä¹‰äº†ä¸€ä¸ªæŠ“å–å±å¹•å›¾åƒçš„Passï¼Œåœ¨è¿™ä¸ªpassä¸­æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å†…éƒ¨çš„åç§°å†³å®šäº†æŠ“å–å¾—åˆ°çš„å±å¹•å›¾åƒä¼šè¢«å­˜å…¥å“ªä¸ªçº¹ç†ä¸­ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥çœç•¥å£°æ˜è¯¥å­—ç¬¦ä¸²ï¼Œä½†ç›´æ¥å£°æ˜çº¹ç†åç§°çš„æ–¹æ³•å¾€å¾€å¯ä»¥å¾—åˆ°æ›´é«˜çš„æ€§èƒ½ï¼Œå…·ä½“åŸå› è§æœ¬èŠ‚æœ€åçš„éƒ¨åˆ†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">// Upgrade NOTE: replaced &#x27;_Object2World&#x27; with &#x27;unity_ObjectToWorld&#x27;</span><br><span class="line"></span><br><span class="line">Shader &quot;UnityShaderBook/Chapter10/GlassRefraction&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">       _MainTex (&quot;Main Tex&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">_BumpMap (&quot;Normal Map&quot;, 2D) = &quot;bump&quot; &#123;&#125;</span><br><span class="line">_Cubemap (&quot;Environment Cubemap&quot;, Cube) = &quot;_Skybox&quot; &#123;&#125;</span><br><span class="line">_Distortion (&quot;Distortion&quot;, Range(0, 100)) = 10</span><br><span class="line">_RefractAmount (&quot;Refract Amount&quot;, Range(0.0, 1.0)) = 1.0</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Queue&quot;=&quot;Transparent&quot;</span><br><span class="line">            &quot;RenderType&quot;=&quot;Opaque&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        GrabPass&#123;&quot;_RefractionTex&quot;&#125;</span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            #include &quot;UnityCG.cginc&quot;</span><br><span class="line">sampler2D _MainTex;</span><br><span class="line">float4 _MainTex_ST;</span><br><span class="line">sampler2D _BumpMap;</span><br><span class="line">float4 _BumpMap_ST;</span><br><span class="line">samplerCUBE _Cubemap;</span><br><span class="line">float _Distortion;</span><br><span class="line">fixed _RefractAmount;</span><br><span class="line">sampler2D _RefractionTex;</span><br><span class="line">float4 _RefractionTex_TexelSize;</span><br><span class="line">            </span><br><span class="line">           struct a2v &#123;</span><br><span class="line">float4 vertex : POSITION;</span><br><span class="line">float3 normal : NORMAL;</span><br><span class="line">float4 tangent : TANGENT; </span><br><span class="line">float2 texcoord: TEXCOORD0;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct v2f &#123;</span><br><span class="line">float4 pos : SV_POSITION;</span><br><span class="line">float4 scrPos : TEXCOORD0;</span><br><span class="line">float4 uv : TEXCOORD1;</span><br><span class="line">float4 TtoW0 : TEXCOORD2;  </span><br><span class="line">    float4 TtoW1 : TEXCOORD3;  </span><br><span class="line">    float4 TtoW2 : TEXCOORD4; </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">              v2f o;</span><br><span class="line">o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line"></span><br><span class="line">o.scrPos = ComputeGrabScreenPos(o.pos);</span><br><span class="line"></span><br><span class="line">o.uv.xy = TRANSFORM_TEX(v.texcoord, _MainTex);</span><br><span class="line">o.uv.zw = TRANSFORM_TEX(v.texcoord, _BumpMap);</span><br><span class="line"></span><br><span class="line">float3 worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;  </span><br><span class="line">fixed3 worldNormal = UnityObjectToWorldNormal(v.normal);  </span><br><span class="line">fixed3 worldTangent = UnityObjectToWorldDir(v.tangent.xyz);  </span><br><span class="line">fixed3 worldBinormal = cross(worldNormal, worldTangent) * v.tangent.w; </span><br><span class="line"></span><br><span class="line">o.TtoW0 = float4(worldTangent.x, worldBinormal.x, worldNormal.x, worldPos.x);  </span><br><span class="line">o.TtoW1 = float4(worldTangent.y, worldBinormal.y, worldNormal.y, worldPos.y);  </span><br><span class="line">o.TtoW2 = float4(worldTangent.z, worldBinormal.z, worldNormal.z, worldPos.z);  </span><br><span class="line"></span><br><span class="line">return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">float3 worldPos = float3(i.TtoW0.w, i.TtoW1.w, i.TtoW2.w);</span><br><span class="line">fixed3 worldViewDir = normalize(UnityWorldSpaceViewDir(worldPos));</span><br><span class="line"></span><br><span class="line">// Get the normal in tangent space</span><br><span class="line">fixed3 bump = UnpackNormal(tex2D(_BumpMap, i.uv.zw));</span><br><span class="line"></span><br><span class="line">// Compute the offset in tangent space</span><br><span class="line">float2 offset = bump.xy * _Distortion * _RefractionTex_TexelSize.xy;</span><br><span class="line">i.scrPos.xy = offset * i.scrPos.z + i.scrPos.xy;</span><br><span class="line">fixed3 refrCol = tex2D(_RefractionTex, i.scrPos.xy/i.scrPos.w).rgb;</span><br><span class="line"></span><br><span class="line">// Convert the normal to world space</span><br><span class="line">bump = normalize(half3(dot(i.TtoW0.xyz, bump), dot(i.TtoW1.xyz, bump), dot(i.TtoW2.xyz, bump)));</span><br><span class="line">fixed3 reflDir = reflect(-worldViewDir, bump);</span><br><span class="line">fixed4 texColor = tex2D(_MainTex, i.uv.xy);</span><br><span class="line">fixed3 reflCol = texCUBE(_Cubemap, reflDir).rgb * texColor.rgb;</span><br><span class="line"></span><br><span class="line">fixed3 finalColor = reflCol * (1 - _RefractAmount) + refrCol * _RefractAmount;</span><br><span class="line"></span><br><span class="line">return fixed4(finalColor, 1);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">Fallback &quot;Diffuse&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬è¿˜å®šä¹‰äº†<code>_RefactionTex</code>å’Œ<code>_RefactionTex_TexelSize</code>å˜é‡ï¼Œè¿™å¯¹åº”äº†ç”¨GrabPassæ—¶æŒ‡å®šçš„çº¹ç†åç§°ï¼Œ<code>_RefactionTex_TexelSize</code>å¯ä»¥è®©æˆ‘ä»¬å¾—åˆ°è¯¥çº¹ç†çš„çº¹ç´ å¤§å°ã€‚æˆ‘ä»¬éœ€è¦åœ¨å¯¹å±å¹•å›¾åƒçš„é‡‡æ ·åæ ‡è¿›è¡Œåç§»æ—¶ä½¿ç”¨è¯¥å˜é‡ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­ï¼Œè¿›è¡Œäº†å¿…è¦çš„é¡¶ç‚¹åæ ‡å˜æ¢åï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨å†…ç½®çš„ComputeGrabScreenPoså‡½æ•°æ¥å¾—åˆ°å¯¹åº”è¢«æŠ“å–çš„å±å¹•å›¾åƒçš„é‡‡æ ·åæ ‡ã€‚æˆ‘ä»¬å¯ä»¥åœ¨UnityCG.cgincæ–‡ä»¶ä¸­æ‰¾åˆ°å®ƒçš„å£°æ˜ï¼Œå®ƒçš„ä¸»è¦ä»£ç å’ŒComputeScreenPosåŸºæœ¬ç±»ä¼¼ï¼Œæœ€å¤§çš„ä¸åŒæ—¶é’ˆå¯¹å¹³å°å·®å¼‚é€ æˆçš„é‡‡æ ·åæ ‡é—®é¢˜è¿›è¡Œäº†å¤„ç†ã€‚æ¥ç€ï¼Œæˆ‘ä»¬è®¡ç®—äº†_MainTexå’Œ_BumpMapçš„é‡‡æ ·åæ ‡ï¼Œå¹¶æŠŠå®ƒä»¬åˆ†åˆ«å­˜å‚¨åœ¨äº†ä¸€ä¸ªfloat4ç±»å‹å˜é‡çš„xyå’Œzwä¸­ã€‚ç”±äºæˆ‘ä»¬éœ€è¦åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­æŠŠæ³•çº¿æ–¹å‘ä»åˆ‡çº¿ç©ºé—´å˜æ¢åˆ°ä¸–ç•Œç©ºé—´ä¸‹ï¼Œä»¥ä¾¿å¯¹Cubemapè¿›è¡Œé‡‡æ ·ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨è¿™é‡Œè®¡ç®—è¯¥é¡¶ç‚¹å¯¹åº”çš„ä»åˆ‡çº¿ç©ºé—´åˆ°ä¸–ç•Œç©ºé—´çš„å˜æ¢çŸ©é˜µï¼Œå¹¶æŠŠè¯¥çŸ©é˜µçš„æ¯ä¸€è¡Œåˆ†åˆ«å­˜å‚¨åœ¨TtoW0ã€TtoW1å’ŒTtoW2çš„xyzåˆ†ä¸¤ç§ã€‚è¿™é‡Œé¢ä½¿ç”¨çš„æ•°å­¦æ–¹æ³•å°±æ˜¯ï¼Œå¾—åˆ°åˆ‡çº¿ç©ºé—´ä¸‹çš„3ä¸ªåæ ‡è½´(xyzè½´åˆ†åˆ«å¯¹åº”äº†åˆ‡çº¿ã€å‰¯åˆ‡çº¿å’Œæ³•çº¿çš„æ–¹å‘)åœ¨ä¸–ç•Œåæ ‡ç©ºé—´ä¸‹çš„è¡¨ç¤ºï¼Œå†æŠŠå®ƒä»¬ä¾æ¬¡æŒ‰åˆ—ç»„æˆä¸€ä¸ªå˜æ¢çŸ©é˜µå³å¯ã€‚TtoW0ç­‰å€¼çš„wè½´è¢«åŒæ ·åˆ©ç”¨èµ·æ¥ï¼Œç”¨äºå­˜å‚¨ä¸–ç•Œç©ºé—´ä¸‹çš„é¡¶ç‚¹åæ ‡ã€‚</p><p>ç„¶åï¼Œåœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆé€šè¿‡TtoW0ç­‰å˜é‡çš„wåˆ†é‡å¾—åˆ°ä¸–ç•Œåæ ‡ï¼Œå¹¶ç”¨è¯¥å€¼å¾—åˆ°è¯¥ç‰‡å…ƒå¯¹åº”çš„è§†è§’æ–¹å‘ã€‚éšåï¼Œæˆ‘ä»¬å¯¹æ³•çº¿çº¹ç†è¿›è¡Œé‡‡æ ·ï¼Œå¾—åˆ°åˆ‡çº¿ç©ºé—´ä¸‹çš„æ³•çº¿æ–¹å‘ã€‚æˆ‘ä»¬ä½¿ç”¨è¯¥å€¼å’Œ_Distortionå±æ€§ä»¥åŠ_RefractionTex_TexelSizeæ¥å¯¹å±å¹•å›¾åƒçš„é‡‡æ ·åæ ‡è¿›è¡Œåç§»ï¼Œæ¨¡æ‹ŸæŠ˜å°„æ•ˆæœã€‚_Distortionå€¼è¶Šå¤§ï¼Œåç§»é‡è¶Šå¤§ï¼Œç»ç’ƒèƒŒåçš„ç‰©ä½“çœ‹èµ·æ¥å˜å½¢ç¨‹åº¦å°±è¶Šå¤§ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨åˆ‡çº¿ç©ºé—´ä¸‹çš„æ³•çº¿æ–¹å‘æ¥è¿›è¡Œåç§»ï¼Œè¿™æ˜¯å› ä¸ºè¯¥ç©ºé—´ä¸‹çš„æ³•çº¿å¯ä»¥åæ˜ é¡¶ç‚¹å±€éƒ¨ç©ºé—´ä¸‹çš„æ³•çº¿æ–¹å‘ã€‚éšåï¼Œæˆ‘ä»¬å¯¹scrPosé€è§†é™¤æ³•å¾—åˆ°çœŸæ­£çš„å±å¹•åæ ‡ï¼Œå†ä½¿ç”¨è¯¥åæ ‡å¯¹æŠ“å–çš„å±å¹•å›¾åƒ_RefractionTexè¿›è¡Œé‡‡æ ·ï¼Œå¾—åˆ°æ¨¡æ‹Ÿçš„æŠ˜å°„é¢œè‰²ã€‚</p><p>ä¹‹åï¼Œæˆ‘ä»¬æŠŠæ³•çº¿æ–¹å‘ä»åˆ‡çº¿ç©ºé—´å˜æ¢åˆ°äº†ä¸–ç•Œç©ºé—´ä¸‹(ä½¿ç”¨å˜æ¢çŸ©é˜µçš„æ¯ä¸€è¡Œï¼Œå³TtoW0ã€TtoW1å’ŒTtoW2ï¼Œåˆ†åˆ«å’Œæ³•çº¿æ–¹å‘ç‚¹ä¹˜ï¼Œæ„æˆæ–°çš„æ³•çº¿æ–¹å‘)ï¼Œå¹¶æ®æ­¤å¾—åˆ°è§†è§’æ–¹å‘ç›¸å¯¹äºæ³•çº¿æ–¹å‘çš„åå°„æ–¹å‘ã€‚éšåä½¿ç”¨åå°„æ–¹å‘å¯¹Cubemapè¿›è¡Œé‡‡æ ·ï¼Œå¹¶æŠŠç»“æœå’Œä¸»çº¹ç†é¢œè‰²ç›¸ä¹˜åå¾—åˆ°åå°„é¢œè‰²ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨_RefractAmountå±æ€§å¯¹åå°„å’ŒæŠ˜å°„é¢œè‰²è¿›è¡Œæ··åˆï¼Œä½œä¸ºæœ€ç»ˆçš„è¾“å‡ºé¢œè‰²ã€‚</p><p>åœ¨å‰é¢çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬åœ¨GrabPassä¸­ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²æŒ‡æ˜äº†è¢«æŠ“å–çš„å±å¹•å›¾åƒå°†ä¼šè¢«å­˜å‚¨åœ¨å“ªä¸ªåç§°çš„çº¹ç†ä¸­ã€‚å®é™…ä¸Šï¼ŒGrabPassæ”¯æŒä¸¤ç§å½¢å¼ã€‚</p><ul><li>ç›´æ¥ä½¿ç”¨GrabPass{}ï¼Œè™½ç„¶ååœ¨åç»­çš„Passä¸­ç›´æ¥ä½¿ç”¨_GrabTextureæ¥è®¿é—®å±å¹•å›¾åƒã€‚ä½†æ˜¯ï¼Œå½“åœºæ™¯ä¸­æœ‰å¤šä¸ªç‰©ä½“éƒ½ä½¿ç”¨äº†è¿™æ ·çš„å½¢å¼æ¥æŠ“å–å±å¹•æ—¶ï¼Œè¿™ç§æ–¹æ³•çš„æ€§èƒ½æ¶ˆè€—æ¯”è¾ƒå¤§ï¼Œå› ä¸ºå¯¹äºæ¯ä¸€ä¸ªä½¿ç”¨å®ƒçš„ç‰©ä½“ï¼ŒUnityéƒ½ä¼šä¸ºå®ƒå•ç‹¬è¿›è¡Œä¸€æ¬¡æ˜‚è´µçš„å±å¹•æŠ“å–æ“ä½œã€‚ä½†è¿™ç§æ–¹æ³•å¯ä»¥è®©æ¯ä¸ªç‰©ä½“å¾—åˆ°ä¸åŒçš„ç“¶æœ¨å›¾åƒï¼Œè¿™å–å†³äºå®ƒä»¬çš„æ¸²æŸ“é˜Ÿåˆ—ä»¥æ¸²æŸ“å®ƒä»¬æ—¶å½“å‰çš„å±å¹•ç¼“å†²ä¸­çš„é¢œè‰²ã€‚</li><li>ä½¿ç”¨GrabPass{â€œTextureNameâ€}ï¼Œæ­£å¦‚æœ¬èŠ‚ä¸­çš„å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åç»­çš„Passä¸­ä½¿ç”¨TextureNameæ¥è®¿é—®å±å¹•å›¾åƒï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•åŒæ ·å¯ä»¥æŠ“å–å±å¹•ï¼Œä½†æ˜¯Unityåªä¼šåœ¨æ¯ä¸€å¸§æ—¶ä¸ºç¬¬ä¸€ä¸ªä½¿ç”¨åä¸ºTextureNameçš„çº¹ç†çš„ç‰©ä½“è¿›è¡Œä¾æ¬¡æŠ“å–å±å¹•çš„æ“ä½œï¼Œè¿™ä¸ªçº¹ç†åŒæ ·å¯ä»¥åœ¨å…¶ä»–çš„Passä¸­è¢«è®¿é—®ã€‚è¿™ç§æ–¹æ³•æ›´åŠ é«˜æ•ˆï¼Œå› ä¸ºä¸ç®¡åœºæ™¯ä¸­æœ‰å¤šå°‘ä¸ªç‰©ä½“ä½¿äº†è¯¥å‘½ä»¤ï¼Œæ¯ä¸€å¸§ä¸­Unityéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡æŠ“å–å·¥ä½œï¼Œä½†è¿™ä¹Ÿæ„å‘³ç€æ‰€æœ‰ç‰©ä½“éƒ½ä¼šä½¿ç”¨åŒä¸€å¼ å±å¹•å›¾åƒã€‚ä¸è¿‡åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹è¿™å·²ç»è¶³å¤Ÿäº†ã€‚</li></ul><h2 id="æ¸²æŸ“çº¹ç†-vs-GrabPass">æ¸²æŸ“çº¹ç† vs. GrabPass</h2><p>å°½ç®¡GrabPasså’Œ10.2.1èŠ‚ä¸­ä½¿ç”¨çš„æ¸²æŸ“çº¹ç† + é¢å¤–æ‘„åƒæœºçš„æ–¹å¼éƒ½å¯ä»¥æŠ“å–å±å¹•å›¾åƒï¼Œä½†æ˜¯å®ƒä»¬ä¹‹é—´è¿˜æ˜¯æœ‰ä¸€äº›ä¸åŒçš„ã€‚GrabPassçš„å¥½å¤„åœ¨äºå®ç°ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨Shaderä¸­å†™å‡ è¡Œä»£ç å°±å¯ä»¥å®ç°æŠ“å–å±å¹•çš„ç›®çš„ã€‚è€Œè¦æ¸²æŸ“çº¹ç†çš„è¯ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªæ¸²æŸ“çº¹ç†å’Œä¸€ä¸ªé¢å¤–çš„æ‘„åƒæœºï¼Œå†æŠŠæ‘„åƒæœºçš„RenderTargetè®¾ç½®ä¸ºæ–°å»ºçš„æ¸²æŸ“çº¹ç†å¯¹è±¡ï¼Œæœ€åæŠŠè¯¥æ¸²æŸ“çº¹ç†ä¼ é€’ç»™ç›¸åº”çš„Shaderã€‚</p><p>ä½†æ˜¯ä»æ•ˆç‡ä¸Šæ¥è®²ï¼Œä½¿ç”¨æ¸²æŸ“çº¹ç†çš„æ•ˆæœå¾€å¾€è¦å¥½äºGrabPassï¼Œå°¤å…¶æ˜¯åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šã€‚ä½¿ç”¨æ¸²æŸ“çº¹ç†æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æ¸²æŸ“çº¹ç†çš„å¤§å°ï¼Œå°½ç®¡è¿™ç§æ–¹æ³•éœ€è¦æŠŠéƒ¨åˆ†åœºæ™¯å†æ¸²æŸ“ä¸€æ¬¡ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒæ•´æ‘„åƒæœºé¢æ¸²æŸ“å±‚æ¥å‡å°‘äºŒæ¬¡æ¸²æŸ“æ—¶çš„åœºæ™¯å¤§å°ï¼Œæˆ–ä½¿ç”¨å…¶ä»–æ–¹æ³•æ¥æ§åˆ¶æ‘„åƒæœºæ˜¯å¦å¼€å¯ã€‚è€ŒGrabPassè·å–åˆ°çš„å›¾åƒåˆ†è¾¨ç‡å’Œæ˜¾ç¤ºå±å¹•æ˜¯ä¸€è‡´çš„ï¼Œè¿™æ„å‘³ç€å†ä¸€äº›é«˜åˆ†è¾¨ç‡çš„è®¾å¤‡ä¸Šå¯èƒ½ä¼šé€ æˆä¸¥é‡çš„å¸¦å®½å½±å“ã€‚è€Œå†ç§»åŠ¨è®¾å¤‡ä¸Šï¼ŒGrabPassè™½ç„¶ä¸ä¼šé‡æ–°æ¸²æŸ“åœºæ™¯ï¼Œä½†å®ƒå¾€å¾€éœ€è¦CPUç›´æ¥è¯»å–åå¤‡ç¼“å†²ä¸­çš„æ•°æ®ï¼Œç ´åäº†CPUå’ŒGPUä¹‹é—´çš„å¹¶è¡Œæ€§ï¼Œè¿™æ ·åšæ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œç”šè‡³åœ¨ä¸€äº›ç§»åŠ¨è®¾å¤‡ä¸Šè¿™æ˜¯ä¸æ”¯æŒçš„ã€‚</p><p>ç°åœ¨çš„Unityå¼•å…¥äº†CommandBufferæ¥å…è®¸æˆ‘ä»¬æ‰©å±•Unityçš„æ¸²æŸ“æµæ°´çº¿ã€‚ä½¿ç”¨å‘½ä»¤ç¼“å†²æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾—åˆ°ç±»ä¼¼æŠ“å±çš„æ•ˆæœï¼Œå®ƒå¯ä»¥åœ¨ä¸é€æ˜çš„ç‰©ä½“æ¸²æŸ“åæŠŠå½“å‰çš„å›¾åƒå¤åˆ¶åˆ°ä¸€ä¸ªä¸´æ—¶çš„æ¸²æŸ“ç›®æ ‡çº¹ç†ä¸­ï¼Œç„¶ååœ¨é‚£é‡Œè¿›è¡Œä¸€äº›é¢å¤–çš„æ“ä½œï¼Œä¾‹å¦‚æ¨¡ç³Šç­‰ï¼Œæœ€åæŠŠå›¾åƒä¼ é€’ç»™éœ€è¦ä½¿ç”¨å®ƒçš„ç‰©ä½“è¿›è¡Œå¤„ç†å’Œæ˜¾ç¤ºã€‚å½“ç„¶CommandBufferèƒ½å¤Ÿå®ç°çš„æ•ˆæœè¿˜è¿œè¿œä¸æ­¢è¿™äº›ã€‚</p><h1>ç¨‹åºçº¹ç†</h1><p>ç¨‹åºçº¹ç†æ˜¯æŒ‡é‚£äº›ç”¨ç”±è®¡ç®—æœºç”Ÿæˆçš„å›¾åƒï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ä¸€äº›ç‰¹å®šçš„ç®—æ³•æ¥åˆ›å»ºä¸ªæ€§åŒ–å›¾æ¡ˆæˆ–è€…éå¸¸çœŸå®çš„è‡ªç„¶å…ƒç´ ï¼Œä¾‹å¦‚æœ¨å¤´ã€çŸ³å­ç­‰ã€‚ä½¿ç”¨ç¨‹åºçº¹ç†çš„å¥½å¤„åœ¨äºæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å„ç§å‚æ•°æ¥æ§åˆ¶çº¹ç†çš„å¤–è§‚ï¼Œè€Œè¿™äº›å±æ€§ä¸ä»…ä»…æ˜¯é‚£äº›é¢œè‰²å±æ€§ï¼Œç”šè‡³å¯ä»¥æ˜¯å®Œå…¨ä¸åŒç±»å±æ€§çš„å›¾æ¡ˆå±æ€§ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥å¾—åˆ°æ›´åŠ ä¸°å¯Œçš„åŠ¨ç”»å’Œè§†è§‰æ•ˆæœã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šé¦–å…ˆå°è¯•ä½¿ç”¨ç®—æ³•æ¥å®ç°ä¸€ä¸ªéå¸¸ç®€å•çš„ç¨‹åºæè´¨ï¼Œç„¶åæˆ‘ä»¬ä¼šä»‹ç»Unityä¸­ä¸€ç±»ä¸“é—¨ä½¿ç”¨ç¨‹åºçº¹ç†çš„æè´¨â€”â€”ç¨‹åºæè´¨ã€‚</p><h2 id="åœ¨Unityä¸­å®ç°ç®€å•çš„ç¨‹åºçº¹ç†">åœ¨Unityä¸­å®ç°ç®€å•çš„ç¨‹åºçº¹ç†</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªæè´¨ï¼Œä½¿ç”¨ä¸€ä¸ªç¬¬7ç« ä¸­æˆ‘ä»¬ç¼–å†™çš„SingleTextureçš„Shaderï¼Œæˆ‘ä»¬ä¸ä¼šç»™è¿™ä¸ªæè´¨æ·»åŠ çº¹ç†ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨è„šæœ¬æ¥åˆ›å»ºç¨‹åºçº¹ç†ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬è¦å†åˆ›å»ºä¸€ä¸ªè„šæœ¬ProceduralTextureGeneration.csï¼Œå¹¶æŠŠè¿™ä¸ªè„šæœ¬æ·»åŠ å¾—åˆ°æˆ‘ä»¬åœ¨åœºæ™¯ä¸­åˆ›å»ºçš„ä¸€ä¸ªCubeçš„æ¨¡å‹ä¸Šã€‚</p><p>ProceduralTextureGeneration.csè„šæœ¬å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">[ExecuteInEditMode]</span><br><span class="line">public class ProceduralTextureGeneration : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    public Material Material = null;</span><br><span class="line"></span><br><span class="line">    #region Material properties</span><br><span class="line"></span><br><span class="line">    [SerializeField] private int m_textureWidth = 512;</span><br><span class="line"></span><br><span class="line">    private int TextureWidth =&gt; m_textureWidth;</span><br><span class="line"></span><br><span class="line">    [SerializeField] private Color m_backgroundColor = Color.white;</span><br><span class="line"></span><br><span class="line">    public Color backgroundColor</span><br><span class="line">    &#123;</span><br><span class="line">        get</span><br><span class="line">        &#123;</span><br><span class="line">            return m_backgroundColor;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        set</span><br><span class="line">        &#123;</span><br><span class="line">            m_backgroundColor = value;</span><br><span class="line">            UpdateMaterial();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [SerializeField] private Color m_circleColor = Color.yellow;</span><br><span class="line">    private Color circleColor</span><br><span class="line">    &#123;</span><br><span class="line">        get</span><br><span class="line">        &#123;</span><br><span class="line">            return m_circleColor;</span><br><span class="line">        &#125;</span><br><span class="line">        set</span><br><span class="line">        &#123;</span><br><span class="line">            m_circleColor = value;</span><br><span class="line">            UpdateMaterial();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [SerializeField] private float m_blurFactor = 2.0f;</span><br><span class="line"></span><br><span class="line">    public float blurFactor</span><br><span class="line">    &#123;</span><br><span class="line">        get</span><br><span class="line">        &#123;</span><br><span class="line">            return m_blurFactor;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        set</span><br><span class="line">        &#123;</span><br><span class="line">            m_blurFactor = value;</span><br><span class="line">            UpdateMaterial();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    #endregion</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private Texture2D m_generatedTexture = null;</span><br><span class="line">    private static readonly int MainTex = Shader.PropertyToID(&quot;_MainTex&quot;);</span><br><span class="line"></span><br><span class="line">    private void Start()</span><br><span class="line">    &#123;</span><br><span class="line">        if (Material == null)</span><br><span class="line">        &#123;</span><br><span class="line">            Renderer renderer = gameObject.GetComponent&lt;Renderer&gt;();</span><br><span class="line">            if (renderer == null)</span><br><span class="line">            &#123;</span><br><span class="line">                Debug.LogError(&quot;Can not find a renderer&quot;);</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Material = renderer.material;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        UpdateMaterial();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void UpdateMaterial()</span><br><span class="line">    &#123;</span><br><span class="line">        if (Material == null)</span><br><span class="line">        &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        m_generatedTexture = _GenerateProceduralTexture();</span><br><span class="line">        Material.SetTexture(MainTex, m_generatedTexture);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private Texture2D _GenerateProceduralTexture()</span><br><span class="line">    &#123;</span><br><span class="line">        Texture2D proceduralTexture = new Texture2D(TextureWidth, TextureWidth);</span><br><span class="line">        </span><br><span class="line">        var circleInterval = TextureWidth / 4.0f;</span><br><span class="line">        var radius = TextureWidth / 10.0f;</span><br><span class="line">        var edgeBlur = 1.0f / blurFactor;</span><br><span class="line"></span><br><span class="line">        for (int w = 0; w &lt; TextureWidth; w++)</span><br><span class="line">        &#123;</span><br><span class="line">            for (int h = 0; h &lt; TextureWidth; h++)</span><br><span class="line">            &#123;</span><br><span class="line">                Color pixel = backgroundColor;</span><br><span class="line">                </span><br><span class="line">                // ä¾æ¬¡ç”»ä¹ä¸ªåœ†</span><br><span class="line">                for (int i = 0; i &lt; 3; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    for (int j = 0; j &lt; 3; j++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Vector2 circleCenter = new Vector2(circleInterval * (i + 1), circleInterval * (j + 1));</span><br><span class="line"></span><br><span class="line">                        float dist = Vector2.Distance(new Vector2(w, h), circleCenter) - radius;</span><br><span class="line"></span><br><span class="line">                        Color color = _MixColor(circleColor, new Color(pixel.r, pixel.g, pixel.b, 0f),</span><br><span class="line">                            Mathf.SmoothStep(0f, 1.0f, dist * edgeBlur));</span><br><span class="line"></span><br><span class="line">                        pixel = _MixColor(pixel, color, color.a);</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                proceduralTexture.SetPixel(w,h, pixel);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        proceduralTexture.Apply();</span><br><span class="line">        return proceduralTexture;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private Color _MixColor(Color color0, Color color1, float mixFactor) &#123;</span><br><span class="line">        Color mixColor = Color.white;</span><br><span class="line">        mixColor.r = Mathf.Lerp(color0.r, color1.r, mixFactor);</span><br><span class="line">        mixColor.g = Mathf.Lerp(color0.g, color1.g, mixFactor);</span><br><span class="line">        mixColor.b = Mathf.Lerp(color0.b, color1.b, mixFactor);</span><br><span class="line">        mixColor.a = Mathf.Lerp(color0.a, color1.a, mixFactor);</span><br><span class="line">        return mixColor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Unityçš„ç¨‹åºæè´¨">Unityçš„ç¨‹åºæè´¨</h2><p>åœ¨Unityä¸­ï¼Œæœ‰ä¸€ç±» ä¸“é—¨ä½¿ç”¨ç¨‹åºçº¹ç†çš„æè´¨ï¼Œå«åšç¨‹åºæè´¨(Procedural Materials)ã€‚è¿™ç±»æè´¨å’Œæˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„é‚£äº›æè´¨åœ¨æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œä¸åŒçš„æ˜¯ï¼Œå®ƒä»¬ä½¿ç”¨çš„çº¹ç†ä¸æ˜¯æ™®é€šçš„çº¹ç†ï¼Œè€Œæ˜¯ç¨‹åºçº¹ç†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¨‹åºæè´¨å’Œå®ƒä½¿ç”¨çš„ç¨‹åºçº¹ç†å¹¶ä¸æ˜¯åœ¨Unityä¸­åˆ›å»ºçš„ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ªå«Substance Designerçš„è½¯ä»¶åœ¨Unityå¤–éƒ¨ç”Ÿæˆçš„ã€‚</p><p><a href="https://www.cnblogs.com/zhyan8/p/17760973.html">ã€Unity3Dã€‘ç¨‹åºçº¹ç†ç®€å•åº”ç”¨</a></p>]]></content>
      
      
      <categories>
          
          <category> UnityShader </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity </tag>
            
            <tag> Shader </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UnityShaderå…¥é—¨ç²¾è¦ç¬”è®°ï¼ˆä¹ï¼‰â€”â€”æ›´å¤æ‚çš„å…‰ç…§</title>
      <link href="/posts/e52a9ff3/"/>
      <url>/posts/e52a9ff3/</url>
      
        <content type="html"><![CDATA[<h1>Unity çš„æ¸²æŸ“è·¯å¾„</h1><p>åœ¨Unityä¸­ï¼Œ æ¸²æŸ“è·¯å¾„(Render Path)å†³å®šäº†å…‰ç…§æ˜¯å¦‚ä½•è¢«åº”ç”¨åˆ°Unity Shaderä¸­çš„ã€‚å› æ­¤ï¼Œå¦‚æœè¦å’Œå…‰æºæ‰“äº¤é“ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªPassæŒ‡å®šå®ƒä½¿ç”¨çš„æ¸²æŸ“è·¯å¾„ï¼Œåªæœ‰è¿™æ ·æ‰èƒ½è®©UnityçŸ¥é“ï¼Œâ€œå“¦ï¼ŒåŸæ¥è¿™ä¸ªç¨‹åºå‘˜æƒ³è¦è¿™ç§æ¸²æŸ“è·¯å¾„ï¼Œé‚£ä¹ˆå¥½çš„ï¼Œæˆ‘æŠŠå…‰æºå’Œå¤„ç†åçš„å…‰ç…§ä¿¡æ¯éƒ½æ”¾åœ¨è¿™äº›æ•°æ®é‡Œï¼Œä½ å¯ä»¥è®¿é—®å•¦ï¼â€ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åªæœ‰ä¸ºShaderæ­£ç¡®åœ°é€‰æ‹©å’Œè®¾ç½®äº†éœ€è¦åœ°æ¸²æŸ“è·¯å¾„ï¼Œè¯¥Shaderåœ°å…‰ç…§è®¡ç®—æ‰èƒ½è¢«æ­£ç¡®æ‰§è¡Œã€‚</p><p>Unityæ”¯æŒå¤šç§ç±»å‹çš„æ¸²æŸ“è·¯å¾„ã€‚åœ¨Unity5.0ä¹‹å‰ï¼ŒUnityä¸»è¦æœ‰3ç§ï¼š<code>å‰å‘æ¸²æŸ“è·¯å¾„(Forward Rendering Path)</code>ã€<code>å»¶è¿Ÿæ¸²æŸ“è·¯å¾„(Deferred Rendering Path)</code>å’Œ<code>é¡¶ç‚¹ç…§æ˜æ¸²æŸ“è·¯å¾„(Vertex Lit Rendering Path)</code>ã€‚unity5.0ä¹‹åï¼ŒUnityåšäº†å¾ˆå¤šæ›´æ”¹ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªå˜åŒ–ï¼šé¦–å…ˆé¡¶ç‚¹ç…§æ˜æ¸²æŸ“è·¯å¾„å·²ç»è¢«UnityæŠ›å¼ƒã€‚å…¶æ¬¡ï¼Œæ–°çš„å»¶è¿Ÿæ¸²æŸ“è·¯å¾„å·²ç»ä»£æ›¿äº†åŸæ¥çš„å»¶è¿Ÿæ¸²æŸ“è·¯å¾„ã€‚</p><p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸€ä¸ªé¡¹ç›®åªä¼šä½¿ç”¨ä¸€ç§æ¸²æŸ“è·¯å¾„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¸ºæ•´ä¸ªé¡¹ç›®è®¾ç½®æ¸²æŸ“æ—¶çš„æ¸²æŸ“è·¯å¾„ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨Unityçš„<code>Edit -&gt; Project Settings -&gt; Player -&gt; Other Settings -&gt; Rendering Path</code>ç§è¿›è¡Œè¿™æ˜¯ã€‚é»˜è®¤æƒ…å†µä¸‹æ˜¯å‰å‘æ¸²æŸ“è·¯å¾„ã€‚æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›å¯ä»¥ä½¿ç”¨å¤šä¸ªæ¸²æŸ“è·¯å¾„ï¼Œä¾‹å¦‚æ‘„åƒæœºAæ¸²æŸ“çš„ç‰©ä½“ä½¿ç”¨å‰å‘æ¸²æŸ“è·¯å¾„ï¼Œè€Œæ‘„åƒæœºBæ¸²æŸ“çš„ç‰©ä½“ä½¿ç”¨å»¶è¿Ÿæ¸²æŸ“è·¯å¾„ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ªæ‘„åƒæœºçš„æ¸²æŸ“è®¾ç½®ç§è®¾ç½®è¯¥æ‘„åƒæœºçš„æ¸²æŸ“è·¯å¾„ï¼Œä»¥è¦†ç›–Project Settingç§çš„è®¾ç½®ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå½“å‰çš„æ˜¾å¡ä¸æ”¯æŒæ‰€é€‰æ‹©çš„æ¸²æŸ“è·¯å¾„ï¼ŒUnityä¼šè‡ªåŠ¨ä½¿ç”¨æ›´ä½ä¸€çº§çš„æ¸²æŸ“è·¯å¾„ã€‚ä¾‹å¦‚å¦‚æœä¸€ä¸ªGPUä¸æ”¯æŒå»¶è¿Ÿæ¸²æŸ“ï¼Œé‚£ä¹ˆUnityå°±ä¼šä½¿ç”¨å‰å‘æ¸²æŸ“ã€‚</p><p>å®Œæˆäº†ä¸Šé¢çš„è®¾ç½®åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æ¯ä¸ªPassç§ä½¿ç”¨æ ‡ç­¾æ¥æŒ‡å®šè¯¥Passä½¿ç”¨çš„æ¸²æŸ“è·¯å¾„ã€‚è¿™æ˜¯é€šè¿‡è®¾ç½®Passä¸­çš„<code>LightMode</code>æ ‡ç­¾æ¥å®ç°çš„ã€‚ä¸åŒç±»å‹çš„æ¸²æŸ“è·¯å¾„å¯èƒ½ä¼šåŒ…å«å¤šç§æ ‡ç­¾è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¹‹å‰åœ¨ä»£ç ä¸­å†™çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Pass&#123;</span><br><span class="line">    Tags&#123;&quot;LightMode&quot;=&quot;ForwardBase&quot;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç å°†å‘Šè¯‰Unityï¼Œè¯¥Passä½¿ç”¨å‰å‘æ¸²æŸ“è·¯å¾„ä¸­çš„ForwardBaseè·¯å¾„ã€‚è€Œå‰å‘æ¸²æŸ“è·¯å¾„è¿˜æœ‰ä¸€ç§è·¯å¾„å«åšForwardAddã€‚ä¸‹è¡¨ç»™å‡ºäº†Passçš„LightModeæ ‡ç­¾æ”¯æŒçš„æ¸²æŸ“è·¯å¾„è®¾ç½®é€‰é¡¹ã€‚</p><table><thead><tr><th>æ ‡ç­¾å</th><th>æè¿°</th></tr></thead><tbody><tr><td>Always</td><td>ä¸ç®¡ä½¿ç”¨å“ªç§æ¸²æŸ“è·¯å¾„ï¼Œè¯¥Passéƒ½ä¼šè¢«æ¸²æŸ“ï¼Œä½†æ˜¯ä¸ä¼šè®¡ç®—ä»»ä½•å…‰ç…§</td></tr><tr><td>ForwardBase</td><td>ç”¨äº<strong>å‰å‘æ¸²æŸ“</strong>ã€‚è¯¥Passä¼šè®¡ç®—ç¯å¢ƒå…‰ã€æœ€é‡è¦çš„å¹³è¡Œå…‰ã€é€é¡¶ç‚¹/SHå…‰æºå’ŒLightmaps</td></tr><tr><td>ForwardAdd</td><td>ç”¨äº<strong>å‰å‘æ¸²æŸ“</strong>ã€‚è¯¥Passä¼šè®¡ç®—é¢å¤–çš„é€åƒç´ å…‰æºï¼Œæ¯ä¸ªPasså¯¹åº”ä¸€ä¸ªå…‰æº</td></tr><tr><td>Deferred</td><td>ç”¨äº<strong>å»¶è¿Ÿæ¸²æŸ“</strong>ã€‚è¯¥Passä¼šæ¸²æŸ“Gç¼“å†²(G-Buffer)</td></tr><tr><td>ShadowCaster</td><td>æŠŠç‰©ä½“çš„æ·±åº¦ä¿¡æ¯æ¸²æŸ“åˆ°é˜´å½±æ˜ å°„çº¹ç†(shadowmap)æˆ–è€…ä¸€å¼ æ·±åº¦çº¹ç†ä¸­</td></tr><tr><td>PerpassBase</td><td>ç”¨äº<strong>é—ç•™çš„å»¶è¿Ÿæ¸²æŸ“</strong>ã€‚è¯¥Passä¼šæ¸²æŸ“æ³•çº¿å’Œé«˜å…‰åå°„çš„æŒ‡æ•°éƒ¨åˆ†</td></tr><tr><td>PerpassFinal</td><td>ç”¨äºé—ç•™çš„<strong>å»¶è¿Ÿæ¸²æŸ“</strong>ã€‚è¯¥Passé€šè¿‡åˆå¹¶çº¹ç†ã€å…‰ç…§å’Œè‡ªå‘å…‰æ¥æ¸²æŸ“å¾—åˆ°æœ€åçš„é¢œè‰²</td></tr><tr><td>Vertexã€VertexLMRGBMå’ŒVertexLM</td><td>ç”¨äº<strong>é—ç•™çš„é¡¶ç‚¹ç…§æ˜æ¸²</strong>æŸ“</td></tr></tbody></table><p>é‚£ä¹ˆæŒ‡å®šæ¸²æŸ“è·¯å¾„åˆ°åº•æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿå¦‚æœä¸€ä¸ªPassæ²¡æœ‰æŒ‡å®šä»»ä½•æ¸²æŸ“è·¯å¾„ä¼šæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿé€šä¿—æ¥è®²ï¼ŒæŒ‡å®šæ¸²æŸ“è·¯å¾„æ˜¯æˆ‘ä»¬å’ŒUnityçš„åº•å±‚æ¸²æŸ“å¼•æ“çš„ä¸€æ¬¡é‡è¦çš„æ²Ÿé€šã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬ä¸ºä¸€ä¸ªPassè®¾ç½®äº†å‰å‘æ¸²æŸ“è·¯å¾„çš„æ ‡ç­¾ï¼Œç›¸å½“äºä¼šå‘Šè¯‰Unityå¼•æ“ï¼šâ€œå˜¿ï¼Œæˆ‘å‡†å¤‡ä½¿ç”¨å‰å‘æ¸²æŸ“äº†ï¼Œä½ æŠŠè¿™äº›å…‰ç…§å±æ€§éƒ½æŒ‰ç…§å‰å‘æ¸²æŸ“çš„æµç¨‹ç»™æˆ‘å‡†å¤‡å¥½ï¼Œæˆ‘ä¸€ä¼šå„¿è¦ç”¨ï¼â€éšåï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Unityæä¾›çš„å†…ç½®å…‰ç…§å˜é‡æ¥è®¿é—®è¿™äº›å±æ€§ã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šä»»ä½•æ¸²æŸ“è·¯å¾„ï¼Œé‚£ä¹ˆä¸€äº›å…‰ç…§å˜é‡å¾ˆå¯èƒ½ä¸ä¼šè¢«æ­£ç¡®èµ‹å€¼ï¼Œæˆ‘ä»¬è®¡ç®—å‡ºçš„æ•ˆæœä¹Ÿå°±å¾ˆå¯èƒ½æ˜¯é”™è¯¯çš„ã€‚é‚£ä¹ˆUnityçš„æ¸²æŸ“å¼•æ“æ˜¯å¦‚ä½•å¤„ç†è¿™äº›æ¸²æŸ“è·¯å¾„çš„å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬ä¼šå¯¹è¿™äº›æ¸²æŸ“è·¯å¾„è¿›è¡Œæ›´åŠ è¯¦ç»†çš„è§£é‡Šã€‚</p><h2 id="å‰å‘æ¸²æŸ“è·¯å¾„">å‰å‘æ¸²æŸ“è·¯å¾„</h2><p>å‰å‘æ¸²æŸ“è·¯å¾„æ˜¯ä¼ ç»Ÿçš„æ¸²æŸ“æ–¹å¼ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„ä¸€ç§æ¸²æŸ“è·¯å¾„ã€‚åœ¨æœ¬èŠ‚ï¼Œæˆ‘ä»¬é¦–å…ˆä¼šæ¦‚æ‹¬å‰å‘æ¸²æŸ“è·¯å¾„çš„åŸç†ï¼Œç„¶åå†ç»™å‡ºUnityå¯¹äºå‰å‘æ¸²æŸ“è·¯å¾„çš„å®ç°ç»†èŠ‚å’Œè¦æ±‚ï¼Œæœ€åç»™å‡ºUnity Shaderä¸­å“ªäº›å†…ç½®å˜é‡æ˜¯ç”¨äºå‰å‘æ¸²æŸ“è·¯å¾„çš„ã€‚</p><ol><li>å‰å‘æ¸²æŸ“è·¯å¾„åŸç†</li></ol><p>æ¯è¿›è¡Œä¸€æ¬¡å®Œæ•´çš„å‰å‘æ¸²æŸ“ï¼Œæˆ‘ä»¬éœ€è¦æ¸²æŸ“è¯¥å¯¹è±¡çš„æ¸²æŸ“å›¾å…ƒï¼Œå¹¶è®¡ç®—ä¸¤ä¸ªç¼“å†²åŒºçš„ä¿¡æ¯ï¼Œä¸€ä¸ªæ˜¯é¢œè‰²ç¼“å†²åŒºï¼Œä¸€ä¸ªæ˜¯æ·±åº¦ç¼“å†²åŒºã€‚æˆ‘ä»¬åˆ©ç”¨æ·±åº¦ç¼“å†²æ¥å†³å®šä¸€ä¸ªç‰‡å…ƒæ˜¯å¦å¯è§ï¼Œå¦‚æœå¯è§å°±æ›´æ–°é¢œè‰²ç¼“å†²åŒºçš„é¢œè‰²å€¼ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„ä¼ªä»£ç æ¥æè¿°å‰å‘æ¸²æŸ“è·¯å¾„çš„å¤§è‡´è¿‡ç¨‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Pass&#123;</span><br><span class="line">    for(each primitive in this model)&#123;</span><br><span class="line">        // primitive å°±æ˜¯å›¾å…ƒçš„æ„æ€</span><br><span class="line">        for(each fragment coverd by this primitive)&#123;</span><br><span class="line">            if(failed in depth test)&#123;</span><br><span class="line">                // å¦‚æœæ²¡æœ‰é€šè¿‡æ·±åº¦æµ‹è¯•ï¼Œå°±ä¸¢å¼ƒ</span><br><span class="line">                discard;</span><br><span class="line">            &#125;else&#123;</span><br><span class="line"></span><br><span class="line">                // å¦‚æœè¯¥ç‰‡å…ƒå¯è§å°±è¿›è¡Œå…‰ç…§è®¡ç®—</span><br><span class="line">                float4 color = Shading(materialInfo, pos, normal, lightDir, viewDir);</span><br><span class="line"></span><br><span class="line">                // å°†é¢œè‰²å†™å…¥é¢œè‰²ç¼“å†²</span><br><span class="line">                writeFrameBuffer(fragment, color);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºæ¯ä¸ªé€åƒç´ å…‰æºï¼Œæˆ‘ä»¬éƒ½éœ€è¦åŠé€†è¡Œä¸Šé¢ä¸€æ¬¡å®Œæ•´çš„æ¸²æŸ“æµç¨‹ã€‚å¦‚æœä¸€ä¸ªç‰©ä½“å†å¤šä¸ªé€åƒç´ å…‰æºçš„å½±å“åŒºåŸŸå†…ï¼Œé‚£ä¹ˆè¯¥ç‰©ä½“å°±éœ€è¦æ‰§è¡Œå¤šä¸ªPassï¼Œæ¯ä¸ªPassè®¡ç®—ä¸€ä¸ªé€åƒç´ å…‰æºçš„å…‰ç…§ç»“æœï¼Œé‚£ä¹ˆè¯¥ç‰©ä½“å°±éœ€è¦æ‰§è¡Œå¤šä¸ªPassï¼Œæ¯ä¸ªPassè®¡ç®—ä¸€ä¸ªé€åƒç´ å…‰æºçš„å…‰ç…§ç»“æœï¼Œç„¶åå†å¸§ç¼“å†²ä¸­æŠŠè¿™äº›å…‰ç…§ç»“æœæ··åˆèµ·æ¥å¾—åˆ°æœ€ç»ˆçš„é¢œè‰²å€¼ã€‚å‡è®¾ï¼Œåœºæ™¯ä¸­æœ‰Nä¸ªç‰©ä½“ï¼Œæ¯ä¸ªç‰©ä½“å—Mä¸ªå…‰æºçš„å½±å“ï¼Œé‚£ä¹ˆæ¸²æŸ“æ•´ä¸ªåœºæ™¯ä¸€å…±éœ€è¦N*Mä¸ªPassã€‚å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœæœ‰å¤§é‡é€åƒç´ å…‰ç…§ï¼Œé‚£ä¹ˆæ‰§è¡Œçš„Passæ•°ç›®ä¹Ÿä¼šå¾ˆå¤§ã€‚å› æ­¤ï¼Œæ¸²æŸ“å¼•æ“é€šå¸¸ä¼šé™åˆ¶æ¯ä¸ªç‰©ä½“çš„é€åƒç´ å…‰ç…§çš„æ•°ç›®ã€‚</p><ol start="2"><li>Unityä¸­çš„å‰å‘æ¸²æŸ“</li></ol><p>äº‹å®ä¸Šï¼Œä¸€ä¸ªPassä¸ä»…ä»…å¯ä»¥ç”¨æ¥è®¡ç®—é€åƒç´ å…‰ç…§ï¼Œå®ƒä¹Ÿå¯ä»¥ç”¨æ¥è®¡ç®—é€é¡¶ç‚¹ç­‰å…¶ä»–å…‰ç…§ï¼Œè¿™å–å†³äºå…‰ç…§è®¡ç®—æ‰€å¤„æµæ°´çº¿é˜¶æ®µä»¥åŠè®¡ç®—æ—¶ä½¿ç”¨çš„æ•°å­¦æ¨¡å‹ã€‚å½“æˆ‘ä»¬æ¸²æŸ“ä¸€ä¸ªç‰©ä½“æ—¶ï¼ŒUnityä¼šè®¡ç®—å“ªäº›å…‰æºç…§äº®äº†å®ƒï¼Œä»¥åŠè¿™äº›å…‰ç…§äº®è¯¥ç‰©ä½“çš„æ–¹å¼ã€‚</p><p>åœ¨Unityä¸­ï¼Œå‰å‘æ¸²æŸ“è·¯å¾„æœ‰3ç§å¤„ç†å…‰ç…§(å³ç…§äº®ç‰©ä½“)çš„æ–¹å¼ï¼šé€é¡¶ç‚¹å¤„ç†ã€é€åƒç´ å¤„ç†ã€çƒè°å‡½æ•°(Spherical harmonics, SH)å¤„ç†ã€‚è€Œå†³å®šä¸€ä¸ªå…‰æºä½¿ç”¨å“ªç§å¤„ç†æ¨¡å¼å–å†³äºå®ƒçš„ç±»å‹å’Œæ¸²æŸ“æ¨¡å¼ã€‚å…‰æºç±»å‹æŒ‡çš„æ˜¯å…‰æºæ˜¯å¹³è¡Œå…‰è¿˜æ˜¯å…¶ä»–ç±»å‹çš„å…‰æºï¼Œè€Œå…‰æºçš„æ¸²æŸ“æ¨¡å¼æŒ‡çš„æ˜¯è¯¥å…‰æºæ˜¯å¦æ˜¯é‡è¦çš„ã€‚å¦‚æœæˆ‘ä»¬æŠŠä¸€ä¸ªå…‰ç…§çš„æ¨¡å¼è®¾ç½®ä¸ºImportantï¼Œæ„å‘³ç€æˆ‘ä»¬å‘Šè¯‰Unityâ€œå˜¿è€å…„ï¼Œè¿™ä¸ªå…‰æºå¾ˆé‡è¦ï¼Œæˆ‘å¸Œæœ›ä½ å¯ä»¥è®¤çœŸå¯¹å¾…å®ƒï¼ŒæŠŠå®ƒå½“æˆä¸€ä¸ªé€åƒç´ å…‰æºæ¥å¤„ç†ï¼â€æˆ‘ä»¬å¯ä»¥åœ¨å…‰æºçš„Lightç»„ä»¶ä¸­è®¾ç½®è¿™äº›å±æ€§ã€‚</p><p>åœ¨å‰å‘æ¸²æŸ“ä¸­ï¼Œå½“æˆ‘ä»¬æ¸²æŸ“ä¸€ä¸ªç‰©ä½“æ—¶ï¼ŒUnityä¼šæ ¹æ®åœºæ™¯ä¸­å„ä¸ªå…‰æºçš„è®¾ç½®ä»¥åŠè¿™äº›å…‰æºå¯¹ç‰©ä½“çš„å½±å“ç¨‹åº¦(ä¾‹å¦‚ï¼Œè·ç¦»è¯¥ç‰©ä½“çš„è¿œè¿‘ã€å…‰æºå¼ºåº¦ç­‰)å¯¹è¿™äº›å…‰æºè¿›è¡Œä¸€ä¸ªé‡è¦ç¨‹åº¦çš„æ’åºã€‚å…¶ä¸­ï¼Œä¸€å®šæ•°ç›®çš„å…‰æºä¼šæŒ‰ç…§é€åƒç´ çš„æ–¹å¼å¤„ç†ï¼Œç„¶åæœ€å¤šæœ‰4ä¸ªå…‰æºæŒ‰ç…§é€é¡¶ç‚¹çš„æ–¹å¼å¤„ç†ï¼Œå‰©ä¸‹çš„å…‰æºå¯ä»¥æŒ‰ç…§SHçš„æ–¹å¼å¤„ç†.Unityä½¿ç”¨çš„åˆ¤æ–­è§„åˆ™å¦‚ä¸‹:</p><ul><li>åœºæ™¯ä¸­æœ€äº®çš„å¹³è¡Œå…‰æ€»æ˜¯æŒ‰åƒç´ å¤„ç†çš„ã€‚</li><li>æ¸²æŸ“æ¨¡å¼è¢«è®¾ç½®æˆNot Importantçš„å…‰æºï¼Œä¼šæŒ‰ç…§é€é¡¶ç‚¹æˆ–è€…SHå¤„ç†</li><li>æ¸²æŸ“æ¨¡å¼è¢«è®¾ç½®æˆImportantçš„å…‰æºï¼Œä¼šæŒ‰é€åƒç´ å¤„ç†</li><li>å¦‚æœæ ¹æ®ä»¥ä¸Šè§„åˆ™å¾—åˆ°é€åƒç´ å…‰æºæ•°é‡å°äºQuality Settingä¸­çš„é€åƒç´ å…‰æºæ•°é‡(Pixel Light Count)ï¼Œä¼šæœ‰æ›´å¤šçš„å…‰æºä»¥é€åƒç´ çš„æ–¹å¼è¿›è¡Œæ¸²æŸ“ã€‚</li></ul><p>é‚£ä¹ˆï¼Œåœ¨å“ªé‡Œè¿›è¡Œå…‰ç…§è®¡ç®—å‘¢ï¼Ÿå½“ç„¶æ˜¯åœ¨Passé‡Œï¼Œå‰é¢æåˆ°è¿‡ï¼Œå‰å‘æ¸²æŸ“è·¯å¾„æœ‰ä¸¤ç§Pass:Base Passå’ŒAdditional Passã€‚é€šå¸¸æ¥è¯´ï¼Œè¿™ä¸¤ç§Passè¿›è¡Œçš„æ ‡ç­¾å’Œæ¸²æŸ“è®¾ç½®ä»¥åŠå¸¸è§„å…‰ç…§è®¡ç®—å¦‚ä¸‹å›¾ï¼š</p><img src="/posts/e52a9ff3/image.png" class=""><p>å›¾ä¸­æœ‰å‡ ç‚¹è¦è¯´æ˜çš„åœ°æ–¹</p><ul><li>é¦–å…ˆï¼Œå¯ä»¥å‘ç°åœ¨æ¸²æŸ“è®¾ç½®ä¸­ï¼Œæˆ‘ä»¬é™¤äº†è®¾ç½®Passçš„æ ‡ç­¾ä»¥å¤–ï¼Œè¿˜æ˜¯ç”¨äº†<code>#pragma multi_compile_fwdbase</code>è¿™æ ·çš„ç¼–è¯‘æŒ‡ä»¤ã€‚æ ¹æ®å®˜æ–¹æ–‡æ¡£ä¸­çš„è§£é‡Šï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œè¿™äº›ç¼–è¯‘æŒ‡ä»¤ä¼šä¿è¯Unityå¯ä»¥ä¸ºç›¸åº”çš„Passç”Ÿæˆæ‰€æœ‰éœ€è¦çš„Shaderå˜ç§ï¼Œè¿™äº›å˜ç§ä¼šå¤„ç†ä¸åŒæ¡ä»¶ä¸‹çš„æ¸²æŸ“é€»è¾‘ï¼Œä¾‹å¦‚æ˜¯å¦ä½¿ç”¨å…‰ç…§è´´å›¾ã€å½“å‰å¤„ç†å“ªç§å…‰æºç±»å‹ã€æ˜¯å¦å¼€å¯äº†é˜´å½±ç­‰ï¼ŒåŒæ—¶Unityä¹Ÿä¼šåœ¨èƒŒåå£°æ˜ç›¸å…³çš„å†…ç½®å˜é‡å¹¶ä¼ é€’åˆ°Shaderä¸­ã€‚é€šä¿—æ¥è®²ï¼Œåªæœ‰åˆ†åˆ«ä¸ºBase Passå’ŒAdditional Passä½¿ç”¨è¿™ä¸¤ä¸ªç¼–è¯‘æŒ‡ä»¤ï¼Œæˆ‘ä»¬æ‰å¯ä»¥åœ¨ç›¸å…³çš„Passä¸­å¾—åˆ°ä¸€äº›æ­£ç¡®çš„å…‰ç…§å˜é‡ï¼Œä¾‹å¦‚å…‰ç…§è¡°å‡å€¼ç­‰ã€‚</li><li>Base Passæ—è¾¹çš„æ ‡æ³¨ç»™å‡ºäº†Base Passä¸­æ”¯æŒçš„ä¸€äº›äºŒå…‰ç…§ç‰¹æ€§ã€‚ä¾‹å¦‚åœ¨Base Passä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®å…‰ç…§çº¹ç†(light map)ã€‚</li><li>Base Passä¸­æ¸²æŸ“çš„å¹³è¡Œå…‰é»˜è®¤æ˜¯æ”¯æŒé˜´å½±çš„(å¦‚æœå¼€å¯äº†å…‰æºçš„é˜´å½±åŠŸèƒ½)ï¼Œè€ŒAdditional Passä¸­æ¸²æŸ“çš„å…‰æºåœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯æ²¡æœ‰é˜´å½±çš„ï¼Œå³ä¾¿æˆ‘ä»¬åœ¨å®ƒçš„Lightç»„ä»¶ä¸­è®¾ç½®äº†æœ‰é˜´å½±çš„Shadow Typeã€‚ä½†æˆ‘ä»¬å¯ä»¥åœ¨Additional Passä¸­ä½¿ç”¨ #pragma_multi_compile_fwdadd_fullshadowsä»£æ›¿#pragma_multi_compile_fwdaddç¼–è¯‘æŒ‡ä»¤ï¼Œä¸ºç‚¹å…‰æºå’Œèšå…‰ç¯å¼€å¯é˜´å½±æ•ˆæœï¼Œä½†è¿™éœ€è¦Unityåœ¨å†…éƒ¨ä½¿ç”¨æ›´å¤šçš„Shaderå˜ç§ã€‚</li><li>ç¯å¢ƒå…‰å’Œè‡ªå‘å…‰ä¹Ÿæ˜¯åœ¨Base Passä¸­è®¡ç®—çš„ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¯¹äºä¸€ä¸ªç‰©ä½“æ¥è¯´ï¼Œç¯å¢ƒå…‰å’Œè‡ªå‘å…‰æˆ‘ä»¬åªå¸Œæœ›è®¡ç®—ä¸€æ¬¡å³å¯ï¼Œè€Œå¦‚æœæˆ‘ä»¬åœ¨Additional Passä¸­è®¡ç®—ä¸¤ç§å…‰ç…§ï¼Œå°±ä¼šé€ æˆå åŠ å¤šæ¬¡ç¯å¢ƒå…‰å’Œè‡ªå‘å…‰ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</li><li>åœ¨Additional Passçš„æ¸²æŸ“è®¾ç½®ä¸­ï¼Œæˆ‘ä»¬è¿˜å¼€å¯å’Œè®¾ç½®äº†æ··åˆæ¨¡å¼ã€‚è¿™æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬å¸Œæœ›æ¯ä¸ªAdditional Passå¯ä»¥ä¸ä¸Šä¸€æ¬¡çš„å…‰ç…§ç»“æœåœ¨å¸§ç¼“å­˜ä¸­è¿›è¡Œå åŠ ï¼Œä»è€Œå¾—åˆ°æœ€ç»ˆçš„æœ‰å¤šä¸ªå…‰ç…§çš„æ¸²æŸ“ç»“æœã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰å¼€å¯å’Œè®¾ç½®æ··åˆæ¨¡å¼ï¼Œé‚£ä¹ˆAdditional Passçš„æ¸²æŸ“ç»“æœä¼šè¦†ç›–æ‰ä¹‹å‰çš„æ¸²æŸ“ç»“æœï¼Œçœ‹èµ·æ¥å°±å¥½åƒè¯¥ç‰©ä½“åªå—è¯¥å…‰æºçš„å½±å“ã€‚é€šå¸¸å¢ƒå†µä¸‹ï¼Œæˆ‘ä»¬é€‰æ‹©çš„æ··åˆæ¨¡å¼æ˜¯<code>Blend One One</code>ã€‚</li><li>å¯¹äºå‰å‘æ¸²æŸ“æ¥è¯´ï¼Œä¸€ä¸ªUnity Shaderé€šå¸¸ä¼šå®šä¹‰ä¸€ä¸ªBase Pass(Base Passä¹Ÿå¯ä»¥å®šä¹‰å¤šæ¬¡ï¼Œä¾‹å¦‚éœ€è¦åŒé¢æ¸²æŸ“çš„æƒ…å†µ)ä»¥åŠä¸€ä¸ªAdditional Passã€‚ä¸€ä¸ªBase Passä»…ä¼šæ‰§è¡Œä¸€æ¬¡(å®šä¹‰äº†å¤šä¸ªBase Passçš„æƒ…å†µé™¤å¤–)ï¼Œè€Œä¸€ä¸ªAdditional Passä¼šæ ¹æ®å½±å“ç‰©ä½“çš„å…¶ä»–é€åƒç´ å…‰æºçš„æ•°ç›®è€Œè¢«å¤šæ¬¡è°ƒç”¨ï¼Œå³æ¯ä¸ªé€åƒç´ çš„å…‰æºéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡Additional Passã€‚</li></ul><p>ä¸Šå›¾ä¸­ç»™å‡ºçš„å…‰ç…§è®¡ç®—æ˜¯é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬åœ¨æ¯ç§Passä¸­è¿›è¡Œçš„è®¡ç®—ã€‚å®é™…ä¸Šï¼Œæ¸²æŸ“è·¯å¾„çš„è®¾ç½®ç”¨äºå‘Šè¯‰Unityè¯¥Passåœ¨å‰å‘æ¸²æŸ“è·¯å¾„ä¸­çš„ä½ç½®ï¼Œç„¶ååº•å±‚çš„æ¸²æŸ“å¼•æ“ä¼šè¿›è¡Œç›¸å…³çš„è®¡ç®—å¹¶å¡«å……ä¸€äº›å†…ç½®å˜é‡æ¯”å¦‚_Lightcolor0ç­‰ï¼Œå¦‚ä½•ä½¿ç”¨è¿™äº›å†…ç½®å˜é‡è¿›è¡Œè®¡ç®—å®Œå…¨å–å†³äºå¼€å‘è€…çš„é€‰æ‹©ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ©ç”¨Unityæä¾›çš„å†…ç½®å˜é‡åœ¨Base Passä¸­åªè¿›è¡Œé€é¡¶ç‚¹çš„å…‰ç…§ï¼›åŒæ ·æˆ‘ä»¬ä¹Ÿå®Œå…¨å¯ä»¥åœ¨Additional Passä¸­æŒ‰é€é¡¶ç‚¹çš„æ–¹å¼è¿›è¡Œå…‰ç…§è®¡ç®—ï¼Œä¸è¿›è¡Œä»»ä½•é€åƒç´ å…‰ç…§è®¡ç®—ã€‚</p><ol start="3"><li>å†…ç½®çš„å…‰ç…§å˜é‡å’Œå‡½æ•°</li></ol><p>å‰é¢è¯´è¿‡ï¼Œæ ¹æ®æˆ‘ä»¬ä½¿ç”¨çš„æ¸²æŸ“è·¯å¾„ï¼ŒUnityä¼šæŠŠä¸åŒçš„å…‰ç…§å˜é‡ä¼ é€’ç»™Shaderã€‚<br>åœ¨Unity5ä¸­ï¼Œå¯¹äºå‰å‘æ¸²æŸ“ForwardBaseå’ŒForwardAddæ¥è¯´ï¼Œä¸‹è¡¨ç»™å‡ºäº†æˆ‘ä»¬å¯ä»¥åœ¨Shaderä¸­è®¿é—®åˆ°çš„å…‰ç…§å˜é‡</p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>_LightColor0</td><td>float4</td><td>è¯¥Passå¤„ç†çš„é€åƒç´ å…‰æºçš„é¢œè‰²</td></tr><tr><td>_WorldSpaceLight0</td><td>float4</td><td>_WorldSpaceLightPos0.xyzæ˜¯è¯¥Passå¤„ç†çš„é€åƒç´ å…‰æºçš„ä½ç½®ã€‚å¦‚æœè¯¥å…‰æºæ˜¯å¹³è¡Œå…‰ï¼Œé‚£ä¹ˆ_WorldSpaceLightPos0.wæ˜¯0ï¼Œå…¶ä»–å…‰æºç±»å‹çš„wå€¼ä¸º1</td></tr><tr><td>_LightMatrix0</td><td>float4$\times$4</td><td>ä»ä¸–ç•Œç©ºé—´åˆ°å…‰æºç©ºé—´çš„å˜æ¢çŸ©é˜µã€‚å¯ä»¥ç”¨äºé‡‡æ ·cookieå’Œå…‰å¼ºè¡°å‡(attenuation)çº¹ç†</td></tr><tr><td>unity_4LightPosX0ï¼Œunity_4LightPosY0,unity_4LightPosZ0ã€</td><td>float4</td><td>ä»…ç”¨äºBasePass å‰4ä¸ªéé‡è¦çš„ç‚¹å…‰æºåœ¨ä¸–ç•Œç©ºé—´ä¸­çš„ä½ç½®</td></tr><tr><td>unity_4LightAtten0</td><td>float4</td><td>ä»…ç”¨äºBasePass                                                                                                               ã€‚å­˜å‚¨äº†å‰4ä¸ªéé‡è¦çš„ç‚¹å…‰æºçš„è¡°å‡å› å­</td></tr><tr><td>unity_LightColor</td><td>half[4]</td><td>ä»…ç”¨äºBasePassã€‚å­˜å‚¨äº†å‰4ä¸ªéå¸¸é‡è¦çš„ç‚¹å…‰æºçš„é¢œè‰²ã€‚</td></tr></tbody></table><p>æˆ‘ä»¬åœ¨ä¹‹å‰çš„å­¦ä¹ ä¸­å·²ç»ç»™å‡ºäº†ä¸€äº›å¯ä»¥ç”¨äºå‰å‘æ¸²æŸ“è·¯å¾„çš„å‡½æ•°ï¼Œä¾‹å¦‚WorlSpaceLightDirã€UnityWorldSpaceLightDirå’ŒObjSpaceLightDirã€‚ä¸ºäº†å®Œæ•´æ€§ï¼Œä¸‹è¡¨å†æ¬¡ç»™å‡ºäº†å‰å‘æ¸²æŸ“ä¸­å¯ä»¥ä½¿ç”¨çš„å†…ç½®å…‰ç…§å‡½æ•°</p><table><thead><tr><th>å‡½æ•°å</th><th>æè¿°</th></tr></thead><tbody><tr><td>float3 WorldSpaceLightDir(float4 v)</td><td><strong>ä»…å¯ä»¥ç”¨äºå‰å‰å‘æ¸²æŸ“ä¸­</strong>ã€‚è¾“å…¥ä¸€ä¸ªæ¨¡å‹ç©ºé—´ä¸­çš„é¡¶ç‚¹ä½ç½®ï¼Œè¿”å›ä¸–ç•Œç©ºé—´ä¸­ä»è¯¥ç‚¹åˆ°å…‰æºçš„å…‰ç…§æ–¹å‘ã€‚å†…éƒ¨å®ç°ä½¿ç”¨äº†UnityWorldSpaceLightDirå‡½æ•°ï¼Œæ²¡æœ‰è¢«å½’ä¸€åŒ–</td></tr><tr><td>float3 UnityWorldSpaceLightDir(float4 v)</td><td><strong>ä»…å¯ä»¥ç”¨äºå‰å‘æ¸²æŸ“ä¸­</strong>ã€‚è¾“å…¥ä¸€ä¸ªä¸–ç•Œç©ºé—´ä¸­çš„é¡¶ç‚¹ä½ç½®ï¼Œè¿”å›ä¸–ç•Œç©ºé—´ä¸­ä»è¯¥ç‚¹åˆ°å…‰æºçš„å…‰ç…§æ–¹å‘ã€‚æ²¡æœ‰è¢«å½’ä¸€åŒ–ã€‚</td></tr><tr><td>float3 ObjSpaceLightDir(float4 v)</td><td><strong>ä»…å¯ä»¥ç”¨äºå‰å‘æ¸²æŸ“ä¸­</strong>ã€‚è¾“å…¥ä¸€ä¸ªæ¨¡å‹ç©ºé—´ä¸­çš„é¡¶ç‚¹ä½ç½®ï¼Œè¿”å›æ¨¡å‹ç©ºé—´ä¸­ä»è¯¥ç‚¹åˆ°å…‰æºçš„å…‰ç…§æ–¹å‘ï¼Œæ²¡æœ‰è¢«å½’ä¸€åŒ–ã€‚</td></tr><tr><td>float3 Shade4PointLights(â€¦)</td><td><strong>ä»…å¯ç”¨äºå‰å‘æ¸²æŸ“ä¸­</strong>ã€‚è®¡ç®—å››ä¸ªå…‰æºçš„å…‰ç…§ï¼Œå®ƒçš„å‚æ•°æ˜¯å·²ç»æ‰“åŒ…è¿›çŸ¢é‡çš„å…‰ç…§æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¸Šå¼ è¡¨ä¸­çš„å†…ç½®å˜é‡ï¼Œå¦‚unity_4LightPosX0ï¼Œunity_4LightPosY0,unity_4LightPosZ0ã€unity_LightColorå’Œunity_4LightAtten0ç­‰ã€‚å‰å‘æ¸²æŸ“é€šå¸¸ä¼šä½¿ç”¨è¿™ä¸ªå‡½æ•°æ¥è®¡ç®—é€é¡¶ç‚¹å…‰ç…§</td></tr></tbody></table><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œä¸Šé¢ç»™å‡ºçš„å˜é‡å’Œå‡½æ•°å¹¶ä¸æ˜¯å®Œæ•´çš„ï¼Œä¸€äº›å‰å‘æ¸²æŸ“å¯ä»¥ä½¿ç”¨çš„å†…ç½®å˜é‡å’Œå‡½æ•°å®˜æ–¹æ–‡æ¡£ä¸­å¹¶æ²¡æœ‰ç»™å‡ºè¯´æ˜ã€‚åœ¨åé¢çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨åˆ°ä¸€äº›ä¸åœ¨è¿™äº›è¡¨ä¸­çš„å˜é‡å’Œå‡½æ•°ï¼Œé‚£æ—¶æˆ‘ä»¬ä¼šç‰¹åˆ«è¯´æ˜ã€‚</p><h2 id="é¡¶ç‚¹ç…§æ˜æ¸²æŸ“è·¯å¾„">é¡¶ç‚¹ç…§æ˜æ¸²æŸ“è·¯å¾„</h2><p>é¡¶ç‚¹ç…§æ˜è·¯å¾„æ˜¯å¯¹ç¡¬ä»¶é…ç½®è¦æ±‚æœ€å°‘ã€è¿ç®—æ€§èƒ½æœ€é«˜ï¼Œä½†åŒæ—¶ä¹Ÿæ˜¯å¾—åˆ°çš„æ•ˆæœæœ€å·®çš„ä¸€ç§ç±»å‹ï¼Œå®ƒä¸æ”¯æŒé‚£äº›é€åƒç´ æ‰èƒ½å¾—åˆ°çš„æ•ˆæœï¼Œæ¯”å¦‚é˜´å½±ã€æ³•çº¿æ˜ å°„ã€é«˜ç²¾åº¦çš„é«˜å…‰åå°„ç­‰ã€‚å®é™…ä¸Šï¼Œå®ƒä»…ä»…æ˜¯å‰å‘æ¸²æŸ“è·¯å¾„çš„ä¸€ä¸ªå­é›†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰å¯ä»¥åœ¨é¡¶ç‚¹ç…§æ˜è·¯å¾„ä¸­å¯ä»¥å®ç°çš„æ•ˆæœéƒ½èƒ½å¤Ÿåœ¨å‰å‘æ¸²æŸ“è·¯å¾„ä¸­å®ç°ã€‚å°±å¦‚åŒå®ƒçš„åå­—ä¸€æ ·ï¼Œé¡¶ç‚¹ç…§æ˜è·¯å¾„åªæ˜¯ä½¿ç”¨äº†é€é¡¶ç‚¹çš„æ–¹å¼æ¥è®¡ç®—å…‰ç…§ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆç¥å¥‡çš„åœ°æ–¹ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬åœ¨å‰å‘æ¸²æŸ“è·¯å¾„ä¸­ä¹Ÿå¯ä»¥è®¡ç®—ä¸€äº›é€é¡¶ç‚¹çš„å…‰ç…§ã€‚ä½†æ˜¯å¦‚æœé€‰æ‹©ä½¿ç”¨é¡¶ç‚¹ç…§æ˜æ¸²æŸ“è·¯å¾„ï¼Œé‚£ä¹ˆUnityåªä¼šå¡«å……å“ªäº›é€é¡¶ç‚¹ç›¸å…³çš„å˜é‡ï¼Œæ„å‘³ç€æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ä¸€äº›é€åƒç´ çš„å…‰ç…§å˜é‡ã€‚</p><ol><li>Unityä¸­çš„é¡¶ç‚¹ç…§æ˜æ¸²æŸ“<br>é¡¶ç‚¹ç…§æ˜æ¸²æŸ“è·¯å¾„é€šå¸¸åœ¨ä¸€ä¸ªPassä¸­å°±å¯ä»¥å®Œæˆå¯¹ç‰©ä½“çš„æ¸²æŸ“ã€‚åœ¨è¿™ä¸ªPassä¸­ï¼Œæˆ‘ä»¬ä¼šè®¡ç®—æˆ‘ä»¬å…³å¿ƒçš„æ‰€æœ‰å…‰æºå¯¹è¯¥ç‰©ä½“çš„ç…§æ˜ï¼Œå¹¶ä¸”è¿™ä¸ªè®¡ç®—æ˜¯æŒ‰ç…§é€é¡¶ç‚¹çš„æ–¹å¼å¤„ç†çš„ã€‚è¿™æ˜¯Unityä¸­æœ€å¿«é€Ÿçš„æ¸²æŸ“è·¯å¾„ï¼Œå¹¶ä¸”å…·æœ‰æœ€å¹¿æ³›çš„ç¡¬ä»¶æ”¯æŒã€‚ç”±äºé¡¶ç‚¹ç…§æ˜æ¸²æŸ“è·¯å¾„ä»…ä»…æ˜¯å‰å‘æ¸²æŸ“è·¯å¾„çš„ä¸€ä¸ªå­é›†ï¼Œå› æ­¤ç°åœ¨Unityå…¶å®å·²ç»æŠ›å¼ƒè¿™ç§æ¸²æŸ“è·¯å¾„äº†ã€‚</li><li>å¯è®¿é—®çš„å†…ç½®å˜é‡å’Œå‡½æ•°<br>åœ¨Unityä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªé¡¶ç‚¹ç…§æ˜çš„Passä¸­æœ€å¤šè®¿é—®åˆ°8ä¸ªé€é¡¶ç‚¹å…‰æºã€‚å¦‚æœæˆ‘ä»¬åªéœ€è¦æ¸²æŸ“å…¶ä¸­ä¸¤ä¸ªå…‰æºå¯¹ç‰©ä½“çš„ç…§æ˜ã€‚å¯ä»¥ä»…ä½¿ç”¨ä¸‹è¡¨ä¸­å†…ç½®å…‰ç…§æ•°æ®çš„å‰ä¸¤ä¸ªã€‚å¦‚æœå½±å“è¯¥ç‰©ä½“çš„å…‰æºæ•°ç›®å°äº8ä¸ªï¼Œé‚£ä¹ˆæ•°ç»„ä¸­å‰©ä¸‹çš„å…‰æºé¢œè‰²éƒ½ä¼šè¢«è®¾ç½®æˆé»‘è‰²ã€‚</li></ol><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>unity_LightColor</td><td>half4[8]</td><td>å…‰æºé¢œè‰²</td></tr><tr><td>unity_LightPosition</td><td>float4[8]</td><td>xyzåˆ†é‡æ˜¯è§†è§’ç©ºé—´ä¸­çš„å…‰æºä½ç½®ã€‚å¦‚æœå…‰æºæ˜¯å¹³è¡Œå…‰ ï¼Œé‚£ä¹ˆzåˆ†é‡å€¼ä¸º0ï¼Œå…¶ä»–å…‰æºç±»å‹zåˆ†é‡å€¼ä¸º1</td></tr><tr><td>unity_LightAtten</td><td>half4[8]</td><td>å…‰æºè¡°å‡å› å­ã€‚å¦‚æœå…‰æºæ˜¯èšå…‰ç¯ï¼Œxåˆ†é‡æ˜¯cos(spotAngle/2)ï¼Œyåˆ†é‡æ˜¯1/cos(spotAngle/4)ï¼›å¦‚æœæ˜¯å…¶ä»–ç±»å‹çš„å…‰æºï¼Œxåˆ†é‡æ˜¯-1ï¼Œyåˆ†é‡æ˜¯1.zåˆ†é‡æ˜¯è¡°å‡çš„å¹³æ–¹ï¼Œwåˆ†é‡æ˜¯å…‰æºèŒƒå›´å¼€æ ¹å·çš„ç»“æœ</td></tr><tr><td>unity_SpotDirection</td><td>float4[8]</td><td>å¦‚æœå…‰æºæ˜¯èšå…‰ç¯çš„è¯ï¼Œå€¼ä¸ºè§†è§’ç©ºé—´çš„èšå…‰ç¯çš„ä½ç½®ï¼›å¦‚æœæ˜¯å…¶ä»–ç±»å‹çš„å…‰æºï¼Œå€¼ä¸º(0,0,1,0)</td></tr></tbody></table><p>å¯ä»¥çœ‹å‡ºï¼Œä¸€äº›å˜é‡æˆ‘ä»¬åŒæ ·å¯ä»¥åœ¨å‰å‘æ¸²æŸ“è·¯å¾„ä¸­ä½¿ç”¨ï¼Œä¾‹å¦‚unity_LightColorã€‚ä½†æ˜¯è¿™äº›å˜é‡çš„æ•°ç»„çš„ç»´åº¦å’Œæ•°å€¼åœ¨ä¸åŒæ¸²æŸ“è·¯å¾„ä¸‹çš„å€¼æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><p>ä¸‹è¡¨ç»™å‡ºäº†é¡¶ç‚¹ç…§æ˜è·¯å¾„ä¸­å¯ä»¥ä½¿ç”¨çš„å†…ç½®å‡½æ•°ã€‚</p><table><thead><tr><th>å‡½æ•°å</th><th>æè¿°</th></tr></thead><tbody><tr><td>float3 ShadeVertexLights(float4 vertex, float3 normal)</td><td>è¾“å…¥æ¨¡å‹ç©ºé—´ä¸­é¡¶ç‚¹ä½ç½®å’Œæ³•çº¿ï¼Œè®¡ç®—å››ä¸ªé€é¡¶ç‚¹å…‰æºçš„å…‰ç…§ä»¥åŠç¯å¢ƒå…‰ï¼Œå†…éƒ¨å®ç°å®é™…ä¸Šè°ƒç”¨äº†ShadeVertexLightsFullå‡½æ•°</td></tr><tr><td>float3 ShadeVertexLightsFull(float3 vertex, float3 normal, int lightCount, bool spotlight)</td><td>è¾“å…¥æ¨¡å‹ç©ºé—´ä¸­çš„é¡¶ç‚¹ä½ç½®å’Œæ³•çº¿ï¼Œè®¡ç®—lightCountä¸ªå…‰æºçš„å…‰ç…§ä»¥åŠç¯å¢ƒå…‰ã€‚å¦‚æœspotLightå€¼ä¸ºtrueï¼Œé‚£ä¹ˆè¿™äº›å…‰æºä¼šè¢«å½“æˆèšå…‰ç¯æ¥å¤„ç†ï¼Œè™½ç„¶ç»“æœæ›´åŠ ç²¾ç¡®ï¼Œä½†æ˜¯è®¡ç®—æ›´åŠ è€—æ—¶ï¼›å¦åˆ™æŒ‰ç…§ç‚¹å…‰æºå¤„ç†</td></tr></tbody></table><h2 id="å»¶è¿Ÿæ¸²æŸ“è·¯å¾„">å»¶è¿Ÿæ¸²æŸ“è·¯å¾„</h2><p>å‰å‘æ¸²æŸ“çš„é—®é¢˜æ˜¯ï¼šå½“åœºæ™¯ä¸­åŒ…å«å¤§é‡çš„å®æ—¶å…‰æºæ—¶ï¼Œå‰å‘æ¸²æŸ“çš„æ€§èƒ½ä¼šæŠ€æœ¯ä¸‹é™ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬åœ¨åœºæ™¯çš„æŸä¸€å—åŒºåŸŸæ”¾ç½®äº†å¤šä¸ªå…‰æºï¼Œè¿™äº›å…‰æºå½±å“çš„åŒºåŸŸäº’ç›¸é‡å ï¼Œé‚£ä¹ˆä¸ºäº†å¾—åˆ°æœ€ç»ˆçš„å…‰ç…§æ•ˆæœï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸ºè¯¥åŒºåŸŸå†…çš„æ¯ä¸ªç‰©ä½“æ‰§è¡Œå¤šä¸ªPassæ¥è®¡ç®—ä¸åŒå…‰æºå¯¹è¯¥ç‰©ä½“çš„å…‰ç…§ç»“æœï¼Œç„¶ååœ¨é¢œè‰²ç¼“å†²ä¸­æŠŠè¿™äº›ç»“æœæ··åˆèµ·æ¥å¾—åˆ°æœ€ç»ˆçš„å…‰ç…§ã€‚ç„¶è€Œï¼Œæ¯æ‰§è¡Œä¸€ä¸ªPassæˆ‘ä»¬éƒ½éœ€è¦é‡æ–°æ¸²æŸ“ä¸€éç‰©ä½“ï¼Œä½†æ˜¯å¾ˆå¤šçš„è®¡ç®—æ˜¯é‡å¤çš„ã€‚</p><p>å»¶è¿Ÿæ¸²æŸ“æ˜¯ä¸€ç§æ›´åŠ å¤è€çš„ç®—æ³•ï¼Œä½†æ˜¯ç”±äºä¸Šè¿°å‰å‘æ¸²æŸ“å¯èƒ½é€ æˆç“¶é¢ˆé—®é¢˜ï¼Œè¿‘å‡ å¹´æ¥åˆæµè¡Œèµ·æ¥ã€‚é™¤äº†å‰å‘æ¸²æŸ“ä¸­ä½¿ç”¨çš„é¢œè‰²ç¼“å†²å’Œæ·±åº¦ç¼“å†²å¤–ï¼Œå»¶è¿Ÿæ¸²æŸ“è¿˜ä¼šåˆ©ç”¨é¢å¤–çš„ç¼“å†²åŒºï¼Œè¿™äº›ç¼“å†²åŒºä¹Ÿè¢«ç§°ä¸ºGç¼“å†²(G-buffer)ï¼Œå…¶ä¸­Gæ˜¯è‹±æ–‡Geometryçš„ç¼©å†™ã€‚Gç¼“å†²å­˜å‚¨äº†æˆ‘ä»¬æ‰€å…³å¿ƒçš„è¡¨é¢(é€šå¸¸æ˜¯æŒ‡ç¦»æ‘„åƒæœºæ›´è¿‘çš„è¡¨é¢)çš„å…¶ä»–ä¿¡æ¯ã€‚ä¾‹å¦‚è¯¥è¡¨é¢çš„æ³•çº¿ã€ä½ç½®ã€ç”¨äºå…‰ç…§è®¡ç®—çš„æè´¨å±æ€§ç­‰ã€‚</p><ol><li>å»¶è¿Ÿæ¸²æŸ“çš„åŸç†<br>å»¶è¿Ÿæ¸²æŸ“ä¸»è¦åŒ…æ‹¬äº†ä¸¤ä¸ªPassã€‚åœ¨ç¬¬ä¸€ä¸ªPassä¸­ï¼Œæˆ‘ä»¬ä¸è¿›è¡Œä»»ä½•çš„å…‰ç…§è®¡ç®—ï¼Œè€Œæ˜¯ä»…ä»…è®¡ç®—å“ªäº›ç‰‡å…ƒæ˜¯å¯è§çš„ï¼Œè¿™ä¸»è¦æ˜¯é€šè¿‡æ·±åº¦ç¼“å†²æŠ€æœ¯æ¥å®ç°çš„ï¼Œå½“å‘ç°ä¸€ä¸ªç‰‡å…ƒæ˜¯å¯è§çš„ï¼Œæˆ‘ä»¬å°±æŠŠå®ƒçš„ç›¸å…³ä¿¡æ¯å­˜å‚¨åˆ°Gç¼“å†²åŒºä¸­ã€‚ç„¶åï¼Œåœ¨ç¬¬äºŒä¸ªPassä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨Gç¼“å†²åŒºçš„å„ä¸ªç‰‡å…ƒä¿¡æ¯ï¼Œä¾‹å¦‚è¡¨é¢æ³•çº¿ã€è§†è§’æ–¹å‘ã€æ¼«åå°„ç³»æ•°ç­‰ï¼Œè¿›è¡ŒçœŸæ­£çš„å…‰ç…§è®¡ç®—ã€‚<br>å»¶è¿Ÿæ¸²æŸ“çš„è¿‡ç¨‹å¤§è‡´å¯ä»¥ç”¨ä¸‹é¢çš„ä¼ªä»£ç æ¥æè¿°</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Pass 1&#123;</span><br><span class="line">    // ç¬¬ä¸€ä¸ªPassä¸è¿›è¡ŒçœŸæ­£çš„å…‰ç…§è®¡ç®—</span><br><span class="line">    // ä»…ä»…æŠŠå…‰ç…§è®¡ç®—éœ€è¦çš„ä¿¡æ¯å­˜å‚¨åˆ°Gç¼“å†²ä¸­</span><br><span class="line"></span><br><span class="line">    for(each primitive in this model)&#123;</span><br><span class="line">        for(each fragment cover by this primitive)&#123;</span><br><span class="line">            if(failed in depth test)&#123;</span><br><span class="line">                // æ²¡æœ‰é€šè¿‡æ·±åº¦æµ‹è¯•ï¼Œè¯´æ˜è¯¥ç‰‡å…ƒæ˜¯ä¸å¯è§çš„</span><br><span class="line">                discard;</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                // å¦‚æœè¯¥ç‰‡å…ƒå¯è§</span><br><span class="line">                // å°±æŠŠéœ€è¦çš„ä¿¡æ¯å­˜å‚¨åˆ°Gç¼“å†²ä¸­</span><br><span class="line">                writeGBuffer(materialInfo, pos, normal);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Pass 2&#123;</span><br><span class="line">    // åˆ©ç”¨Gç¼“å†²ä¸­çš„ä¿¡æ¯è¿›è¡ŒçœŸæ­£çš„å…‰ç…§è®¡ç®—</span><br><span class="line"></span><br><span class="line">    for(each pixel in the screen)&#123;</span><br><span class="line">        if(the pixel is valid)&#123;</span><br><span class="line">            // å¦‚æœè¯¥åƒç´ æ˜¯æœ‰æ•ˆçš„</span><br><span class="line">            // è¯»å–å®ƒå¯¹åº”çš„Gç¼“å†²ä¸­çš„ä¿¡æ¯</span><br><span class="line">            readGBuffer(pixel, materialInfo, pos, normal);</span><br><span class="line"></span><br><span class="line">            // æ ¹æ®è¯»å–åˆ°çš„ä¿¡æ¯è¿›è¡Œå…‰ç…§è®¡ç®—</span><br><span class="line">            float4 color = Shading(materialInfo, pos, normal, lightDir, viewDir);</span><br><span class="line"></span><br><span class="line">            // æ›´æ–°å¸§ç¼“å†²</span><br><span class="line">            writeFrameBuffer(pixel, color)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œå»¶è¿Ÿæ¸²æŸ“ä½¿ç”¨çš„Passæ•°é€šå¸¸å°±æ˜¯ä¸¤ä¸ªï¼Œè¿™è·Ÿåœºæ™¯ä¸­åŒ…å«çš„å…‰æºæ•°é‡æ˜¯æ²¡æœ‰å…³ç³»çš„ã€‚æ¢å¥è¯è¯´ï¼Œå»¶è¿Ÿæ¸²æŸ“çš„æ•ˆç‡ä¸ä¾èµ–äºåœºæ™¯çš„å¤æ‚åº¦ï¼Œè€Œæ˜¯å’Œæˆ‘ä»¬ä½¿ç”¨çš„å±å¹•ç©ºé—´çš„å¤§å°æœ‰å…³ã€‚è¿™æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯éƒ½å­˜å‚¨åœ¨ç¼“å†²åŒºä¸­ï¼Œè€Œè¿™äº›ç¼“å†²åŒºå¯ä»¥ç†è§£æˆæ˜¯ä¸€å¼ å¼ 2Då›¾åƒï¼Œæˆ‘ä»¬çš„è®¡ç®—å®é™…ä¸Šå°±æ˜¯åœ¨è¿™äº›å›¾åƒç©ºé—´ä¸­è¿›è¡Œçš„ã€‚</p><ol start="2"><li>Unityä¸­çš„å»¶è¿Ÿæ¸²æŸ“<br>ç¬¬äºŒä¸ªPassç”¨äºè®¡ç®—çœŸæ­£çš„å…‰ç…§æ¨¡å‹ï¼Œè¿™ä¸ªPassä¼šä½¿ç”¨ä¸Šä¸€ä¸ªPassä¸­çš„æ¸²æŸ“æ•°æ®æ¥è®¡ç®—æœ€ç»ˆçš„å…‰ç…§é¢œè‰²ï¼Œå†å­˜å‚¨åˆ°å¸§ç¼“å†²ä¸­ã€‚<br>é»˜è®¤çš„Gç¼“å†²åŒºï¼Œæ³¨æ„ä¸åŒçš„Unityç‰ˆæœ¬çš„æ¸²æŸ“çº¹ç†å­˜å‚¨å†…å®¹ä¼šæœ‰æ‰€ä¸åŒï¼ŒåŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªæ¸²æŸ“çº¹ç†(Render Texture, RT)ã€‚<ul><li>RT0: æ ¼å¼æ˜¯ARGB32ï¼ŒRGBé€šé“ç”¨äºå­˜å‚¨æ¼«åå°„é¢œè‰²ï¼ŒAé€šé“æ²¡æœ‰è¢«ä½¿ç”¨</li><li>RT1: æ ¼å¼æ˜¯ARGB32ï¼ŒRGBé€šé“ç”¨äºå­˜å‚¨é«˜å…‰åå°„é¢œè‰²ï¼ŒAé€šé“ç”¨äºå­˜å‚¨é«˜å…‰åå°„çš„æŒ‡æ•°éƒ¨åˆ†ã€‚</li><li>RT2: æ ¼å¼æ˜¯ARGB2101010ï¼ŒRGBç”¨äºå­˜å‚¨æ³•çº¿ï¼ŒAé€šé“æ²¡æœ‰è¢«ä½¿ç”¨ã€‚</li><li>RT3: æ ¼å¼æ˜¯ARGB32(éHDR)æˆ–ARGBHalf(HDR)ï¼Œç”¨äºå­˜å‚¨è‡ªå‘å…‰+lightmap+åå°„æ¢é’ˆ(reflection probes)</li><li>æ·±åº¦ç¼“å†²å’Œæ¨¡æ¿ç¼“å†²<br>åœ¨ç¬¬äºŒä¸ªPassä¸­è®¡ç®—å…‰ç…§æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹å°½å¯ä»¥ä½¿ç”¨Unityå†…ç½®çš„Standardå…‰ç…§æ¨¡å‹ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨å…¶ä»–çš„å…‰ç…§æ¨¡å‹ï¼Œå°±éœ€è¦æ›¿ä»£æ‰åŸæœ‰çš„Internal-DeferredShading.shaderæ–‡ä»¶ã€‚</li></ul></li><li>å¯è®¿é—®çš„å†…ç½®å˜é‡å’Œå‡½æ•°<br>ä¸‹è¡¨ç»™é™¤äº†å¤„ç†å»¶è¿Ÿæ¸²æŸ“è·¯å¾„å¯ä»¥ä½¿ç”¨çš„å…‰ç…§å˜é‡ã€‚è¿™äº›å˜é‡éƒ½å¯ä»¥åœ¨<code>UnityDeferredLibrary.cginc</code>æ–‡ä»¶ä¸­æ‰¾åˆ°å®ƒä»¬çš„å£°æ˜ã€‚</li></ol><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>_LightColor</td><td>float4</td><td>å…‰æºé¢œè‰²</td></tr><tr><td>_LightMatrix0</td><td>float4 $\times$ 4</td><td>ä»ä¸–ç•Œç©ºé—´åˆ°å…‰æºç©ºé—´çš„å˜æ¢çŸ©é˜µï¼Œå¯ä»¥ç”¨äºé‡‡æ ·cookieå’Œå…‰å¼ºè¡°å‡çº¹ç†</td></tr></tbody></table><h1>Unityä¸­çš„å…‰æºç±»å‹</h1><p>Unityä¸€å…±æ”¯æŒ4ç§ç±»å‹çš„å…‰æºï¼šå¹³è¡Œå…‰ã€ç‚¹å…‰æºã€èšå…‰ç¯å’Œé¢å…‰æº(area light)ã€‚é¢å…‰æºä»…åœ¨çƒ˜åŸ¹æ—¶æ‰å¯ä»¥å‘æŒ¥ä½œç”¨ï¼Œå› æ­¤ä¸åœ¨æœ¬ä¹¦çš„è®¨è®ºèŒƒå›´å†…ã€‚ç”±äºæ¯ç§å…‰æºçš„å‡ ä½•å®šä¹‰ä¸åŒï¼Œå› æ­¤å®ƒä»¬å¯¹åº”çš„å…‰æºå±æ€§ä¹Ÿå°±å„ä¸ç›¸åŒã€‚è¿™å°±è¦æ±‚æˆ‘ä»¬è¦åŒºåˆ«å¯¹å¾…å®ƒä»¬ã€‚å¹¸è¿çš„æ˜¯Unityæä¾›äº†å¾ˆå¤šå†…ç½®å‡½æ•°å¸®åŠ©æˆ‘ä»¬å¤„ç†è¿™äº›å…‰æºï¼Œåœ¨æœ¬ç« æœ€åæˆ‘ä»¬ä¼šä»‹ç»è¿™äº›å‡½æ•°ï¼Œä½†é¦–å…ˆï¼Œæˆ‘ä»¬è¦å…ˆæ¥äº†è§£å®ƒä»¬èƒŒåçš„åŸç†ã€‚</p><h2 id="å…‰æºç±»å‹æœ‰ä»€ä¹ˆå½±å“">å…‰æºç±»å‹æœ‰ä»€ä¹ˆå½±å“</h2><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å…‰æºç±»å‹çš„ä¸åŒåˆ°åº•ä¼šç»™Shaderå¸¦æ¥å“ªäº›å½±å“ã€‚æˆ‘ä»¬å¯ä»¥è€ƒè™‘Shaderç§ä½¿ç”¨äº†å…‰æºçš„å“ªäº›å±æ€§ã€‚æœ€å¸¸ç”¨çš„å…‰æºå±æ€§æœ‰å…‰æºçš„**ä½ç½®ã€æ–¹å‘ï¼ˆæ›´å…·ä½“çš„è¯´æ—¶åˆ°æŸç‚¹çš„æ–¹å‘ï¼‰ã€é¢œè‰²ã€å¼ºåº¦ä»¥åŠè¡°å‡ï¼ˆæ›´å…·ä½“åœ°è¯´æ˜¯åˆ°æŸç‚¹çš„è¡°å‡ï¼Œä¸è¯¥ç‚¹åˆ°å…‰æºçš„è·ç¦»æœ‰å…³ï¼‰**è¿™5ä¸ªå±æ€§ã€‚è€Œè¿™äº›å±æ€§ä¸å®ƒä»¬çš„å‡ ä½•å®šä¹‰æ¯æ¯ç›¸å…³ã€‚</p><ol><li><p>å¹³è¡Œå…‰<br>å¯¹äºæˆ‘ä»¬èƒ½ä¹‹å‰ä½¿ç”¨çš„å¹³è¡Œå…‰æ¥è¯´ï¼Œå®ƒçš„å‡ ä½•å®šä¹‰æ˜¯æœ€ç®€å•çš„ã€‚å¹³è¡Œå…‰å¯ä»¥ç…§äº®çš„èŒƒå›´æ˜¯æ²¡æœ‰é™åˆ¶çš„ï¼Œå®ƒé€šå¸¸æ˜¯ä½œä¸ºå¤ªé˜³è¿™æ ·çš„è§’è‰²åœ¨åœºæ™¯ä¸­å‡ºç°çš„ã€‚<br>å¹³è¡Œå…‰ä¹‹æ‰€ä»¥ç®€å•ï¼Œæ˜¯å› ä¸ºå®ƒæ²¡æœ‰ä¸€ä¸ªå”¯ä¸€çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¯ä»¥æ”¾åœ¨åœºæ™¯ä¸­çš„ä»»æ„ä½ç½®ï¼Œå®ƒçš„å‡ ä½•å±æ€§åªæœ‰æ–¹å‘ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒæ•´å¹³è¡Œå…‰çš„Transformç»„ä»¶ä¸­çš„Rotationå±æ€§æ¥æ”¹å˜å®ƒçš„å…‰æºæ–¹å‘ï¼Œè€Œä¸”å¹³è¡Œå…‰åˆ°åœºæ™¯ä¸­æ‰€æœ‰ç‚¹çš„æ–¹å‘éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™ä¹Ÿæ˜¯å¹³è¡Œå…‰çš„ç”±æ¥ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç”±äºå¹³è¡Œå…‰æ²¡æœ‰ä¸€ä¸ªå…·ä½“çš„ä½ç½®ï¼Œå› æ­¤ä¹Ÿæ²¡æœ‰è¡°å‡çš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå…‰ç…§å¼ºåº¦ä¸ä¼šéšç€è·ç¦»è€Œå‘ç”Ÿå˜åŒ–ã€‚</p></li><li><p>ç‚¹å…‰æº<br>ç‚¹å…‰æºçš„ç…§äº®ç©ºé—´åˆ™æ˜¯æœ‰é™çš„ï¼Œå®ƒæ˜¯ç”±ç©ºé—´ä¸­çš„ä¸€ä¸ªçƒä½“å®šä¹‰çš„ã€‚ç‚¹å…‰æºå¯ä»¥è¡¨ç¤ºç”±ä¸€ä¸ªç‚¹å‘å‡ºçš„ã€å‘æ‰€æœ‰æ–¹å‘æ— é™å»¶ä¼¸çš„å…‰ã€‚éœ€è¦æ³¨æ„ï¼Œæˆ‘ä»¬è¦åœ¨Sceneè§†å›¾ä¸­å¼€å¯å…‰ç…§æ‰èƒ½çœ‹åˆ°é¢„è§ˆå…‰æºæ˜¯å¦‚ä½•å½±å“åœºæ™¯ä¸­çš„ç‰©ä½“çš„ã€‚<br>çƒä½“çš„åŠå¾„å¯ä»¥ç”±é¢æ¿ä¸­çš„Rangeå±æ€§æ¥è°ƒæ•´ï¼Œä¹Ÿå¯ä»¥åœ¨Sceneè§†å›¾ä¸­ç›´æ¥æ‹–æ‹‰ç‚¹å…‰æºçš„çº¿æ¡†æ¥ä¿®æ”¹å®ƒçš„å±æ€§ã€‚ç‚¹å…‰æºæ˜¯æœ‰ä½ç½®å±æ€§çš„ï¼Œå®ƒæ˜¯ç”±ç‚¹å…‰æºçš„Transformç»„ä»¶ä¸­çš„Positionå±æ€§å®šä¹‰çš„ã€‚å¯¹äºæ–¹å‘å±æ€§ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ç‚¹å…‰æºçš„ä½ç½®å‡å»æŸç‚¹çš„ä½ç½®æ¥å¾—åˆ°å®ƒåˆ°è¯¥ç‚¹çš„æ–¹å‘ã€‚è€Œç‚¹å…‰æºçš„é¢œè‰²å’Œå¼ºåº¦å¯ä»¥åœ¨Lightç»„ä»¶é¢æ¿ä¸­è°ƒæ•´ã€‚åŒæ—¶ï¼Œç‚¹å…‰æºä¹Ÿæ˜¯ä¼šè¡°å‡çš„ï¼Œéšç€ç‰©ä½“é€æ¸è¿œç¦»ç‚¹å…‰æºï¼Œå®ƒæ¥æ”¶åˆ°çš„å…‰ç…§å¼ºåº¦ä¹Ÿä¼šé€æ¸å‡å°ã€‚ç‚¹å…‰æºçƒå¿ƒå¤„çš„å…‰ç…§å¼ºåº¦æœ€å¼ºï¼Œçƒä½“è¾¹ç•Œå¤„çš„æœ€å¼±ï¼Œå€¼ä¸º0.å…¶ä¸­é—´çš„è¡°å‡å€¼å¯ä»¥ç”±ä¸€ä¸ªå‡½æ•°å®šä¹‰ã€‚</p></li><li><p>èšå…‰ç¯<br>èšå…‰ç¯æ˜¯è¿™ä¸‰ç§å…‰æºä¸­æœ€å¤æ‚çš„ä¸€ç§ã€‚å®ƒçš„ç…§äº®ç©ºé—´åŒæ ·æ˜¯æœ‰é™çš„ï¼Œä½†ä¸å†æ˜¯ç®€å•çš„çƒä½“ï¼Œè€Œæ˜¯ç”±ç©ºé—´ä¸­çš„ä¸€å—é”¥å½¢åŒºåŸŸå®šä¹‰çš„ã€‚èšå…‰ç¯å¯ä»¥ç”¨äºè¡¨ç¤ºç”±ä¸€ä¸ªç‰¹å®šä½ç½®è§¦å‘ã€å‘ç‰¹å®šæ–¹å‘å»¶ä¼¸çš„å…‰ã€‚<br>è¿™å—é”¥å½¢åŒºåŸŸçš„åŠå¾„ç”±é¢æ¿ä¸­çš„Rangeå±æ€§å†³å®šï¼Œè€Œé”¥ä½“çš„å¼ å¼€è§’åº¦ç”±SpotAngleå±æ€§å†³å®šã€‚æˆ‘ä»¬åŒæ ·ä¹Ÿå¯ä»¥åœ¨Sceneè§†å›¾ä¸­ç›´æ¥æ‹–æ‹‰èšå…‰ç¯çš„çº¿æ¡†æ¥ä¿®æ”¹å®ƒçš„å±æ€§ã€‚èšå…‰ç¯çš„ä½ç½®åŒæ ·æ˜¯ç”±Transformç»„ä»¶ä¸­çš„Positionå±æ€§å®šä¹‰çš„ã€‚å¯¹äºæ–¹å‘å±æ€§ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨èšå…‰ç¯çš„ä½ç½®å‡å»æŸç‚¹çš„ä½ç½®æ¥å¾—åˆ°å®ƒåˆ°è¯¥ç‚¹çš„æ–¹å‘ã€‚èšå…‰ç¯çš„è¡°å‡ä¹Ÿæ˜¯éšç€ç‰©ä½“é€æ¸è¿œç¦»å…‰æºè€Œé€æ¸å‡å°ï¼Œåœ¨é”¥å½¢çš„é¡¶ç‚¹å¤„å…‰ç…§å¼ºåº¦æœ€å¼ºï¼Œåœ¨é”¥å½¢çš„è¾¹ç•Œå¤„å¼ºåº¦ä¸º0.å…¶ä¸­çš„è¡°å‡å€¼å¯ä»¥ç”±ä¸€ä¸ªå‡½æ•°å®šä¹‰ï¼Œè¿™ä¸ªå‡½æ•°ç›¸å¯¹äºç‚¹å…‰æºè¡°å‡è®¡ç®—å…¬å¼è¦æ›´åŠ å¤æ‚ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦åˆ¤æ–­ä¸€ä¸ªç‚¹æ˜¯å¦åœ¨é”¥ä½“èŒƒå›´å†…ã€‚</p></li></ol><h2 id="åœ¨å‰å‘æ¸²æŸ“ä¸­å¤„ç†ä¸åŒçš„å…‰æºç±»å‹">åœ¨å‰å‘æ¸²æŸ“ä¸­å¤„ç†ä¸åŒçš„å…‰æºç±»å‹</h2><p>åœ¨äº†è§£äº†ä¸‰ç§å…‰æºçš„å‡ ä½•å®šä¹‰ä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨Unity Shaderä¸­è®¿é—®å®ƒä»¬çš„5ä¸ª å±æ€§ï¼šä½ç½®ã€æ–¹å‘ã€é¢œè‰²ã€å¼ºåº¦ä»¥åŠè¡°å‡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬æœ¬èŠ‚éƒ½æ˜¯å»ºç«‹åœ¨ä½¿ç”¨å‰å‘æ¸²æŸ“è·¯å¾„çš„åŸºç¡€ä¸Šã€‚</p><ol><li>å®è·µ<br>æˆ‘ä»¬çš„ä»£ç ä½¿ç”¨äº†Blinn-Phongå…‰ç…§æ¨¡å‹ï¼Œå¹¶ä¸ºå‰å‘æ¸²æŸ“å®šä¹‰äº†BasePasså’ŒAdditional Passæ¥å¤„ç†å¤šä¸ªå…‰æºã€‚</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line">// Upgrade NOTE: replaced &#x27;_LightMatrix0&#x27; with &#x27;unity_WorldToLight&#x27;</span><br><span class="line"></span><br><span class="line">// Upgrade NOTE: replaced &#x27;_LightMatrix0&#x27; with &#x27;unity_WorldToLight&#x27;</span><br><span class="line"></span><br><span class="line">Shader &quot;UnityShaderBook/Chapter 9/ForwardRendering&quot;</span><br><span class="line">&#123;</span><br><span class="line">   // ä½¿ç”¨Blinn-Phongå…‰ç…§æ¨¡å‹</span><br><span class="line">   </span><br><span class="line">   Properties</span><br><span class="line">   &#123;</span><br><span class="line">      _Specular (&quot;Specular&quot;, Color) = (1,1,1,1)</span><br><span class="line">      _Diffuse (&quot;Diffuse&quot;, Color) = (1,1,1,1)</span><br><span class="line">      _Gloss (&quot;Gloss&quot;, Range(8.0, 256)) = 20      </span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   SubShader</span><br><span class="line">   &#123;</span><br><span class="line">      Pass</span><br><span class="line">      &#123;</span><br><span class="line">         Tags</span><br><span class="line">         &#123;</span><br><span class="line">            &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">         &#125;     </span><br><span class="line">         </span><br><span class="line">         CGPROGRAM</span><br><span class="line"></span><br><span class="line">         #include &quot;Lighting.cginc&quot;</span><br><span class="line">         #pragma multi_compile_fwdbase</span><br><span class="line">         #pragma vertex vert</span><br><span class="line">         #pragma fragment frag</span><br><span class="line">         </span><br><span class="line">         fixed4 _Specular;</span><br><span class="line">         fixed4 _Diffuse;</span><br><span class="line">         float _Gloss;</span><br><span class="line">         </span><br><span class="line">         struct a2v</span><br><span class="line">         &#123;</span><br><span class="line">            float4 vertex : POSITION;</span><br><span class="line">            float3 normal : NORMAL;</span><br><span class="line">         &#125;;</span><br><span class="line">         </span><br><span class="line">         struct v2f</span><br><span class="line">         &#123;</span><br><span class="line">            float4 pos : SV_POSITION;</span><br><span class="line">            float3 worldNormal : TEXCOORD0;</span><br><span class="line">            float3 worldPos : TEXCOORD1;</span><br><span class="line">         &#125;;</span><br><span class="line"></span><br><span class="line">         v2f vert(a2v v)</span><br><span class="line">         &#123;</span><br><span class="line">            v2f o;</span><br><span class="line"></span><br><span class="line">            o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line">            o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line">            o.worldPos = mul(unity_ObjectToWorld, v.vertex);</span><br><span class="line">            </span><br><span class="line">            return o;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         fixed4 frag(v2f i) : SV_Target&#123;</span><br><span class="line">            </span><br><span class="line">            fixed3 worldViewDir = normalize(UnityWorldSpaceViewDir(i.worldPos));</span><br><span class="line">            fixed3 lightDir = normalize(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line">            fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line">            </span><br><span class="line">            fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz;</span><br><span class="line"></span><br><span class="line">            fixed3 diffuse = _LightColor0.rgb * _Diffuse.rgb * saturate(dot(worldNormal,lightDir));</span><br><span class="line">            </span><br><span class="line">            fixed3 halfDir = normalize(worldViewDir + lightDir);      </span><br><span class="line">            </span><br><span class="line">            fixed3 specular = _LightColor0.rgb * _Specular.rgb * pow(saturate(dot(i.worldNormal, halfDir)),_Gloss);</span><br><span class="line"></span><br><span class="line">            return fixed4(ambient + diffuse + specular, 1.0);</span><br><span class="line">         &#125;</span><br><span class="line">         </span><br><span class="line">         ENDCG</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      Pass</span><br><span class="line">      &#123;</span><br><span class="line">         Tags</span><br><span class="line">         &#123;</span><br><span class="line">            &quot;LightMode&quot;=&quot;ForwardAdd&quot;  </span><br><span class="line">         &#125;</span><br><span class="line">         </span><br><span class="line">         Blend One One</span><br><span class="line">         </span><br><span class="line">         CGPROGRAM</span><br><span class="line"></span><br><span class="line">         #pragma multi_compile_fwdadd</span><br><span class="line">         </span><br><span class="line">         #include &quot;Lighting.cginc&quot;</span><br><span class="line">         #include &quot;AutoLight.cginc&quot;</span><br><span class="line">         </span><br><span class="line">         #pragma vertex vert</span><br><span class="line">         #pragma fragment frag</span><br><span class="line">         </span><br><span class="line">         fixed4 _Specular;</span><br><span class="line">         fixed4 _Diffuse;</span><br><span class="line">         float _Gloss;</span><br><span class="line">         </span><br><span class="line">         struct a2v</span><br><span class="line">         &#123;</span><br><span class="line">            float4 vertex : POSITION;</span><br><span class="line">            float3 normal : NORMAL;</span><br><span class="line">         &#125;;</span><br><span class="line">         </span><br><span class="line">         struct v2f</span><br><span class="line">         &#123;</span><br><span class="line">            float4 pos : SV_POSITION;</span><br><span class="line">            float3 worldNormal : TEXCOORD0;</span><br><span class="line">            float3 worldPos : TEXCOORD1;</span><br><span class="line">         &#125;;</span><br><span class="line"></span><br><span class="line">         v2f vert(a2v v)</span><br><span class="line">         &#123;</span><br><span class="line">            v2f o;</span><br><span class="line"></span><br><span class="line">            o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line">            o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line">            o.worldPos = mul(unity_ObjectToWorld, v.vertex);</span><br><span class="line">            </span><br><span class="line">            return o;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         fixed4 frag(v2f i) : SV_Target&#123;</span><br><span class="line">            </span><br><span class="line">            fixed3 worldViewDir = normalize(UnityWorldSpaceViewDir(i.worldPos));</span><br><span class="line"></span><br><span class="line">#ifdef USING_DIRECTIONAL_LIGHT</span><br><span class="line">            fixed3 lightDir = normalize(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line">#else</span><br><span class="line">            fixed3 lightDir = normalize(_WorldSpaceLightPos0.xyz - i.worldPos.xyz);</span><br><span class="line">#endif</span><br><span class="line">            </span><br><span class="line">            fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line"></span><br><span class="line">            fixed3 diffuse = _LightColor0.rgb * _Diffuse.rgb * saturate(dot(worldNormal,lightDir));</span><br><span class="line">            </span><br><span class="line">            fixed3 halfDir = normalize(worldViewDir + lightDir);      </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#ifdef USING_DIRECTIONAL_LIGHT</span><br><span class="line">            fixed atten = 1.0;</span><br><span class="line">#else</span><br><span class="line">            float3 lightCoord = mul(unity_WorldToLight, float4(i.worldPos, 1)).xyz;</span><br><span class="line">            fixed atten = tex2D(_LightTexture0, dot(lightCoord, lightCoord).rr).UNITY_ATTEN_CHANNEL;</span><br><span class="line">#endif</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            fixed3 specular = _LightColor0.rgb * _Specular.rgb * pow(saturate(dot(i.worldNormal, halfDir)),_Gloss);</span><br><span class="line"></span><br><span class="line">            return fixed4( diffuse + specular, 1.0);</span><br><span class="line">            &#125;</span><br><span class="line">         ENDCG</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   Fallback &quot;Specular&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li>å®éªŒï¼šBase Pass å’Œ Additional Passçš„è°ƒç”¨<br>æˆ‘ä»¬åœ¨ä»‹ç»å‰å‘æ¸²æŸ“åŸç†çš„ç« èŠ‚ä¸­è§£é‡Šäº†Unityæ˜¯å¦‚ä½•å†³å®šå“ªäº›å…‰æºæ˜¯é€åƒç´ å…‰ï¼Œè€Œå“ªäº›æ˜¯é€é¡¶ç‚¹æˆ–SHå…‰ã€‚ä¸‹é¢æˆ‘ä»¬åšä¸€ä¸ªå®éªŒï¼š<br>æ–°å»ºä¸€ä¸ªåœºæ™¯ï¼Œåˆ›å»ºä¸€ä¸ªèƒ¶å›Šä½“ï¼Œå¹¶ç»™å®ƒé™„ä¸Šæˆ‘ä»¬ä¸Šä¸€å°èŠ‚ä¸­å®ç°çš„æè´¨ï¼Œåœ¨åœºæ™¯ä¸­åˆ›å»ºä¸€ä¸ªç»¿è‰²çš„å¹³è¡Œå…‰å’Œå››ä¸ªçº¢è‰²çš„ç‚¹å…‰ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¼šå¾—åˆ°å¦‚ä¸‹çš„æ•ˆæœï¼š<img src="/posts/e52a9ff3/image1.png" class="">é‚£ä¹ˆï¼Œè¿™æ ·çš„ç»“æœæ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå…‰æºæ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒçš„Render Mode(å¯ä»¥åœ¨Lightç»„ä»¶ä¸­è®¾ç½®)æ˜¯Autoã€‚è¿™æ„å‘³ç€ï¼ŒUnityä¼šåœ¨èƒŒåä¸ºæˆ‘ä»¬åˆ¤æ–­å“ªäº›å…‰æºä¼šæŒ‰ç…§é€åƒç´ å¤„ç†ï¼Œè€Œå“ªäº›æŒ‰ç…§é€é¡¶ç‚¹æˆ–SHçš„æ–¹å¼å¤„ç†ã€‚ç”±äºæˆ‘ä»¬æ²¡æœ‰æ›´æ”¹<code>Edit -&gt; ProjectSettings -&gt; Quality -&gt; Pixel Light Count</code>ä¸­çš„æ•°å€¼ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹ä¸€ä¸ªç‰©ä½“å¯ä»¥æ¥æ”¶é™¤æœ€äº®çš„å¹³è¡Œå…‰å¤–çš„4ä¸ªé€åƒç´ å…‰ç…§ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåœºæ™¯ä¸­ä¸€å…±åŒ…å«äº†5ä¸ªå…‰æºï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯å¹³è¡Œå…‰ï¼Œå®ƒä¼šåœ¨æˆ‘ä»¬Shaderçš„BasePassä¸­æŒ‰ç…§é€åƒç´ çš„æ–¹å¼è¢«å¤„ç†ï¼›å…¶ä½™4ä¸ªéƒ½æ˜¯ç‚¹å…‰æºï¼Œç”±äºå®ƒä»¬çš„Render Modeä¸ºAutoä¸”æ•°ç›®æ­£å¥½ä¸º4ï¼Œå› æ­¤éƒ½ä¼šåœ¨Shaderä¸­çš„Additional Passä¸­é€åƒç´ çš„æ–¹å¼è¢«å¤„ç†ï¼Œæ¯ä¸ªå…‰æºéƒ½ä¼šè°ƒç”¨ä¸€æ¬¡Additional Passã€‚<br>æˆ‘ä»¬å¯ä»¥é€šè¿‡Frame Debuggeræ¥æŸ¥çœ‹åœºæ™¯çš„ç»˜åˆ¶è¿‡ç¨‹ã€‚ä»Frame Debuggerä¸­å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªåœºæ™¯Unityä¸€å…±è¿›è¡Œäº†6æ­¤æ¸²æŸ“å®è·µï¼Œç”±äºæœ¬ä¾‹åªåˆ›å»ºäº†ä¸€ä¸ªç‰©ä½“ï¼Œå› æ­¤è¿™6ä¸ªæ¸²æŸ“äº‹ä»¶å‡ ä¹éƒ½æ˜¯ç”¨äºæ¸²æŸ“ç‰©ä½“çš„å…‰ç…§ç»“æœã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¾æ¬¡å•å‡»Frame Debuggerä¸­çš„æ¸²æŸ“äº‹ä»¶ï¼Œæ¥çœ‹çœ‹Unityæ˜¯æ€ä¹ˆæ ·æ¸²æŸ“ç‰©ä½“çš„ï¼š <img src="/posts/e52a9ff3/image3.png" class=""> <img src="/posts/e52a9ff3/image4.png" class=""></li></ol><p>ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼šåœ¨ç¬¬ä¸€ä¸ªæ¸²æŸ“äº‹ä»¶ä¸­Unityé¦–å…ˆæ¸…é™¤é¢œè‰²ã€æ·±åº¦å’Œæ¨¡æ¿ç¼“å†²ï¼Œä¸ºåé¢çš„æ¸²æŸ“åšå‡†å¤‡ï¼›åœ¨ç¬¬äºŒä¸ªæ¸²æŸ“äº‹ä»¶ä¸­ï¼ŒUnityåˆ©ç”¨Shaderçš„ç¬¬ä¸€ä¸ªPassï¼Œå³BasePassï¼Œå°†å¹³è¡Œå…‰çš„å…‰ç…§æ¸²æŸ“åˆ°å¸§ç¼“å­˜ä¸­ï¼›åœ¨åé¢çš„4ä¸ªäº‹ä»¶ä¸­ï¼ŒUnityä½¿ç”¨ç¬¬äºŒä¸ªPassä¾æ¬¡å°†4ä¸ªç‚¹å…‰æºçš„å…‰ç…§åº”ç”¨åˆ°ç‰©ä½“ä¸Šï¼Œå¾—åˆ°æœ€ç»ˆçš„æ¸²æŸ“ç»“æœã€‚</p><p>å¯ä»¥æ³¨æ„åˆ°ï¼ŒUnityå¤„ç†è¿™äº›ç‚¹å…‰æºçš„é¡ºåºæ˜¯æŒ‰ç…§å®ƒä»¬çš„é‡è¦ç¨‹åº¦æ¥æ’åºçš„ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”±äºæ‰€æœ‰çš„ç‚¹å…‰æºçš„é¢œè‰²å’Œå¼ºåº¦éƒ½ç›¸åŒï¼Œå› æ­¤å®ƒä»¬çš„é‡è¦æˆéƒ½å–å†³äºå®ƒä»¬è·ç¦»èƒ¶å›Šä½“çš„è¿œè¿‘ï¼Œå› æ­¤åœ¨ä¸Šå›¾ä¸­é¦–å…ˆç»˜åˆ¶çš„æ˜¯è·ç¦»èƒ¶å›Šä½“æœ€è¿‘çš„ç‚¹å…‰æºã€‚ä½†æ˜¯å¦‚æœå…‰æºçš„å¼ºåº¦å’Œé¢œè‰²äº’ä¸ç›¸åŒï¼Œé‚£ä¹ˆè·ç¦»å°±ä¸å†æ˜¯å”¯ä¸€çš„è¡¡é‡æ ‡å‡†ã€‚ä¾‹å¦‚å¦‚æœæˆ‘ä»¬æŠŠç°åœ¨è·ç¦»æœ€è¿‘çš„ç‚¹å…‰æºçš„å¼ºåº¦è®¾ç½®ä¸º0.2ï¼Œé‚£ä¹ˆä»FrameDebuggerä¸­æˆ‘ä»¬å¯ä»¥å‘ç°ç»˜åˆ¶é¡ºåºå‘ç”Ÿäº†å˜åŒ–ï¼Œæ­¤æ—¶é¦–å…ˆç»˜åˆ¶çš„æ˜¯è·ç¦»èƒ¶å›Šä½“ç¬¬äºŒè¿‘çš„ç‚¹å…‰æºï¼Œæœ€è¿‘çš„ç‚¹å…‰æºåˆ™ä¼šåœ¨æœ€åè¢«æ¸²æŸ“ã€‚Unityå®˜æ–¹å¹¶æ²¡æœ‰ç»™å‡ºå…‰æºå¼ºåº¦ã€é¢œè‰²å’Œè·ç¦»ç‰©ä½“çš„è¿œè¿‘æ˜¯å¦‚ä½•å…·ä½“å½±å“å…‰æºçš„é‡è¦ç¨‹åº¦æ’åºçš„ï¼Œæˆ‘ä»¬ä»…çŸ¥é“æ’åºç»“æœå’Œè¿™ä¸‰è€…éƒ½æœ‰å…³ç³»ã€‚</p><p>å¯¹äºåœºæ™¯ä¸­çš„ä¸€ä¸ªç‰©ä½“ï¼Œå¦‚æœå®ƒä¸åœ¨ä¸€ä¸ªå…‰æºçš„å…‰ç…§èŒƒå›´å†…ï¼ŒUnityæ˜¯ä¸ä¼šä¸ºè¿™ä¸ªç‰©ä½“è°ƒç”¨Passæ¥å¤„ç†è¿™ä¸ªå…‰æºçš„ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè·ç¦»æœ€è¿œçš„ç‚¹å…‰æºçš„èŒƒå›´ç¼©å°ï¼Œä½¿å¾—èƒ¶å›Šä½“åœ¨å®ƒçš„ç…§äº®èŒƒå›´å¤–ã€‚æ­¤æ—¶å†çœ‹FrameDebuggerï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æ¸²æŸ“äº‹ä»¶æ¯”ä¹‹å‰å°‘äº†ä¸€ä¸ªï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¦‚æœä¸€ä¸ªç‰©ä½“ä¸åœ¨æŸä¸ªèšå…‰ç¯èŒƒå›´å†…ï¼ŒUnityä¹Ÿæ˜¯ä¸ä¼šä¸ºè¯¥ç‰©ä½“è°ƒç”¨ç›¸å…³çš„æ¸²æŸ“äº‹ä»¶çš„ã€‚</p> <img src="/posts/e52a9ff3/image1.png" class=""><p>æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœé€åƒç´ çš„å…‰æºæ•°ç›®å¾ˆå¤šçš„è¯ï¼Œè¯¥ç‰©ä½“çš„Additional Passå°±ä¼šè¢«å¤šæ¬¡è°ƒç”¨ï¼Œå½±å“æ€§èƒ½ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æŠŠå…‰æºçš„Render Modeè®¾ç½®ä¸ºNot Importantæ¥å‘Šè¯‰Unityï¼Œæˆ‘ä»¬ä¸å¸Œæœ›æŠŠè¿™ä¸ªå…‰æºå½“æˆé€åƒç´ å¤„ç†ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå››ä¸ªç‚¹å…‰æºçš„RenderModeéƒ½è®¾ç½®ä¸ºNot Importantï¼Œå°±å¯ä»¥å¾—åˆ°ä¸‹é¢çš„ç»“æœï¼š</p> <img src="/posts/e52a9ff3/image2.png" class=""><p>ç”±äºæˆ‘ä»¬æ²¡æœ‰åœ¨Shaderè„šæœ¬çš„BasePassä¸­è®¡ç®—é€é¡¶ç‚¹å’ŒSHå…‰æºï¼Œå› æ­¤åœºæ™¯ä¸­çš„è¿™å››ä¸ªç‚¹å…‰æºå®é™…ä¸Šä¸ä¼šå¯¹ç‰©ä½“é€ æˆä»»ä½•å½±å“ã€‚åŒæ ·ï¼Œå¦‚æœæˆ‘ä»¬æŠŠå¹³è¡Œå…‰çš„Render Modeä¹Ÿè®¾ç½®ä¸ºNot Importantï¼Œç‰©ä½“å°±ä»…ä»…ä¼šæ˜¾ç¤ºç¯å¢ƒå…‰çš„å…‰ç…§ç»“æœäº†ã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•åœ¨å‰å‘æ¸²æŸ“è·¯å¾„çš„BasePassä¸­è®¡ç®—é€é¡¶ç‚¹è®¡ç®—å’ŒSHå…‰å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ç”¨å‰é¢ç« èŠ‚æåˆ°çš„å†…ç½®å˜é‡å’Œå‡½æ•°æ¥è®¡ç®—è¿™äº›å…‰æºçš„å…‰ç…§æ•ˆæœã€‚</p><h1>Unityçš„å…‰ç…§è¡°å‡</h1><p>åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬æåˆ°äº†Unityä½¿ç”¨ä¸€å¼ çº¹ç†ä½œä¸ºæŸ¥æ‰¾è¡¨æ¥åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­è®¡ç®—é€åƒç´ å…‰ç…§çš„è¡°å‡ã€‚è¿™æ ·çš„å¥½å¤„åœ¨äºï¼Œè®¡ç®—è¡°å‡ä¸ä¾èµ–äºæ•°å­¦å…¬å¼çš„å¤æ‚æ€§ï¼Œæˆ‘ä»¬åªè¦ä½¿ç”¨ä¸€ä¸ªå‚æ•°å€¼å»çº¹ç†ä¸­é‡‡æ ·å³å¯ã€‚ä½†æ˜¯ä½¿ç”¨çº¹ç†æŸ¥æ‰¾æŸ¥æ‰¾æ¥è®¡ç®—è¡°å‡ä¹Ÿæœ‰ä¸€äº›å¼Šç«¯ã€‚</p><ul><li>éœ€è¦é¢„å¤„ç†å¾—åˆ°é‡‡æ ·çº¹ç†ï¼Œè€Œä¸”çº¹ç†çš„å¤§å°ä¹Ÿä¼šå½±å“è¡°å‡çš„ç²¾åº¦ã€‚</li><li>ä¸ç›´è§‚ï¼ŒåŒæ—¶ä¹Ÿä¸æ–¹ä¾¿ï¼Œå› æ­¤ä¸€æ—¦æŠŠæ•°æ®å­˜å‚¨åˆ°æŸ¥æ‰¾è¡¨ä¸­ï¼Œæˆ‘ä»¬å°±æ— æ³•ä½¿ç”¨å…¶ä»–çš„æ•°å­¦å…¬å¼æ¥è®¡ç®—è¡°å‡ã€‚</li></ul><p>ä½†æ˜¯å› ä¸ºè¿™ç§æ–¹æ³•åœ¨ä¸€å®šç¨‹åº¦ä¸Šæå‡æ€§èƒ½ï¼Œè€Œä¸”å¾—åˆ°çš„æ•ˆæœåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ˜¯è‰¯å¥½çš„ï¼Œå› æ­¤Unityé»˜è®¤å°±æ˜¯ä½¿ç”¨è¿™ç§çº¹ç†æŸ¥æ‰¾çš„æ–¹å¼æ¥è®¡ç®—é€åƒç´ çš„ç‚¹å…‰æºå’Œèšå…‰ç¯çš„è¡°å‡çš„ã€‚</p><h2 id="ç”¨äºå…‰ç…§è¡°å‡çš„çº¹ç†">ç”¨äºå…‰ç…§è¡°å‡çš„çº¹ç†</h2><p>Unityåœ¨å†…éƒ¨ä½¿ç”¨äº†ä¸€å¼ åä¸º_LightTexture0çš„çº¹ç†æ¥è®¡ç®—å…‰æºè¡°å‡ã€‚éœ€è¦æ³¨æ„çš„æ—¶ï¼Œå¦‚æœæˆ‘ä»¬å¯¹è¯¥å…‰æºä½¿ç”¨äº†cookieï¼Œé‚£ä¹ˆè¡°å‡æŸ¥æ‰¾çº¹ç†æ—¶_LightTextureB0ï¼Œä½†è¿™é‡Œä¸è®¨è®ºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬é€šå¸¸åªå…³å¿ƒ_LightTexture0å¯¹è§’çº¿ä¸Šçš„çº¹ç†é¢œè‰²å€¼ï¼Œè¿™äº›å€¼è¡¨æ˜äº†åœ¨å…‰æºç©ºé—´ä¸­ä¸åŒä½ç½®çš„ç‚¹çš„è¡°å‡å€¼ã€‚ä¾‹å¦‚(0,0)è¡¨æ˜äº†ä¸å…‰æºä½ç½®é‡åˆçš„ç‚¹çš„è¡°å‡å€¼ï¼Œè€Œ(1,1)è¡¨æ˜äº†åœ¨å…‰æºç©ºé—´ä¸­æ‰€å…³å¿ƒçš„è·ç¦»æœ€è¿œçš„ç‚¹çš„è¡°å‡ã€‚</p><p>ä¸ºäº†å¯¹_LightTexture0çº¹ç†é‡‡æ ·å¾—åˆ°ç»™å®šç‚¹åˆ°è¯¥å…‰æºçš„è¡°å‡å€¼ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å¾—åˆ°è¯¥ç‚¹åœ¨å…‰æºç©ºé—´ä¸­çš„ä½ç½®ï¼Œè¿™æ˜¯é€šè¿‡_LightMatrix0å˜æ¢çŸ©é˜µå¾—åˆ°çš„ã€‚åœ¨ä¸Šé¢å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“_LightMatrix0å¯ä»¥æŠŠé¡¶ç‚¹ä»ä¸–ç•Œç©ºé—´å˜æ¢åˆ°å…‰æºç©ºé—´ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠ_LightMatrix0å’Œä¸–ç•Œç©ºé—´ä¸­çš„é¡¶ç‚¹åæ ‡ç›¸ä¹˜å³å¯å¾—åˆ°å…‰æºç©ºé—´ä¸­çš„ç›¸åº”ä½ç½®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">float3 lightCoord = mul(_LightMatirx0, float4(i.worldPosition,1)).xyz;</span><br></pre></td></tr></table></figure><p><code>.rr</code>è¿™æ˜¯ä¸€ä¸ªswizzleæ“ä½œï¼Œç”¨äºä»å‘é‡ä¸­é€‰æ‹©ç»„ä»¶ã€‚åœ¨è¿™é‡Œï¼Œrrè¡¨ç¤ºé‡å¤é€‰å–ç‚¹ç§¯ç»“æœï¼ˆä¸€ä¸ªæ ‡é‡ï¼Œå› æ­¤å®ƒçš„æ¯ä¸ªç»„ä»¶éƒ½æ˜¯ç›¸åŒçš„å€¼ï¼‰ä½œä¸ºä¸€ä¸ªæ–°çš„äºŒç»´å‘é‡çš„ä¸¤ä¸ªç»„ä»¶ã€‚åœ¨GLSLæˆ–HLSLè¿™æ ·çš„ç€è‰²è¯­è¨€ä¸­ï¼Œswizzleæ“ä½œå…è®¸ä½ é‡æ–°æ’åˆ—æˆ–é‡å¤å‘é‡ä¸­çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªå‘é‡v = (x, y, z, w)ï¼Œv.xyä¼šå¾—åˆ°(x, y)ï¼Œè€Œv.zwzwä¼šå¾—åˆ°(z, w, z, w)ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªåæ ‡çš„æ¨¡çš„å¹³æ–¹å¯¹è¡°å‡çº¹ç†è¿›è¡Œé‡‡æ ·ï¼Œå¾—åˆ°è¡°å‡å€¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fixed atten = tex2D(_LightTexture0, dot(lightCoord, lightCoord).rr).UNITY_ATTEN_CHANNEL;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼Œåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å…‰æºç©ºé—´ä¸­é¡¶ç‚¹è·ç¦»çš„å¹³æ–¹(é€šè¿‡dotå‡½æ•°æ¥å¾—åˆ°)æ¥å¯¹çº¹ç†é‡‡æ ·ï¼Œä¹‹æ‰€ä»¥æ²¡æœ‰ä½¿ç”¨è·ç¦»å€¼æ¥é‡‡æ ·æ˜¯å› ä¸ºè¿™ç§æ–¹æ³•å¯ä»¥é¿å…å¼€æ–¹æ“ä½œã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨å®UNITY_ATTEN_CHANNELæ¥å¾—åˆ°è¡°å‡çº¹ç†ä¸­è¡°å‡å€¼æ‰€åœ¨çš„åˆ†é‡ï¼Œä»¥å¾—åˆ°æœ€ç»ˆçš„è¡°å‡å€¼</p><h2 id="ä½¿ç”¨æ•°å­¦å…¬å¼è®¡ç®—è¡°å‡">ä½¿ç”¨æ•°å­¦å…¬å¼è®¡ç®—è¡°å‡</h2><p>å°½ç®¡çº¹ç†é‡‡æ ·çš„æ–¹æ³•å¯ä»¥å‡å°‘è®¡ç®—è¡°å‡æ—¶çš„å¤æ‚åº¦ï¼Œä½†æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›å¯ä»¥åœ¨ä»£ç ä¸­åˆ©ç”¨å…¬å¼æ¥è®¡ç®—å…‰æºçš„è¡°å‡ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä»£ç å¯ä»¥è®¡ç®—å…‰æºçš„çº¿æ€§è¡°å‡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">float distance = length(_WorldSpaceLightPos0.xyz - i.worldPosition.xyz);</span><br><span class="line">atten = 1.0 / distance;</span><br></pre></td></tr></table></figure><p>å¯æƒœçš„æ˜¯ï¼ŒUnityæ²¡æœ‰åœ¨æ–‡æ¡£ä¸­ç»™å‡ºå†…ç½®è¡°å‡è®¡ç®—çš„ç›¸å…³è¯´æ˜ã€‚å°½ç®¡æˆ‘ä»¬ä»ç„¶å¯ä»¥åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­åˆ©ç”¨ä¸€äº›æ•°å­¦å…¬å¼æ¥è®¡ç®—è¡°å‡ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬æ— æ³•åœ¨Shaderä¸­é€šè¿‡å†…ç½®å˜é‡å¾—åˆ°å…‰æºçš„èŒƒå›´ã€èšå…‰ç¯çš„æœå‘ã€å¼ å¼€çš„è§’åº¦ç­‰ä¿¡æ¯ï¼Œå› æ­¤å¾—åˆ°çš„æ•ˆæœå¾€å¾€åœ¨æœ‰äº›æ—¶å€™ä¸å°½äººæ„ï¼Œå°¤å…¶æ¥ç‰©ä½“ç¦»å¼€å…‰æºçš„ç…§æ˜èŒƒå›´æ—¶ä¼šå‘ç”Ÿçªå˜ï¼ˆè¿™æ˜¯å› ä¸ºï¼Œå¦‚æœç‰©ä½“ä¸åœ¨è¯¥å…‰æºçš„ç…§æ˜èŒƒå›´å†…ï¼ŒUnityå°±ä¸ä¼šä¸ºç‰©ä½“æ‰§è¡Œä¸€ä¸ªAdditional Passï¼‰ã€‚å½“ç„¶æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è„šæœ¬å°†å…‰æºçš„ç›¸å…³ä¿¡æ¯ä¼ é€’ç»™Shaderï¼Œä½†è¿™æ ·çš„çµæ´»æ€§æ›´ä½ã€‚æˆ‘ä»¬åªèƒ½æœŸå¾…æœªæ¥Unityç‰ˆæœ¬å¯ä»¥å¼€æ”¾æ›´å¤šçš„å‚æ•°ç»™æˆ‘ä»¬ä½¿ç”¨ã€‚</p><h1>Unityçš„é˜´å½±</h1><h2 id="é˜´å½±æ˜¯å¦‚ä½•å®ç°çš„">é˜´å½±æ˜¯å¦‚ä½•å®ç°çš„</h2><p>æˆ‘ä»¬å¯ä»¥å…ˆè€ƒè™‘ä¸‹ç”Ÿæ´»ä¸­çš„é˜´å½±æ˜¯å¦‚ä½•äº§ç”Ÿçš„ã€‚å½“ä¸€ä¸ªå…‰æºå‘å°„çš„ä¸€æ¡å…‰çº¿é‡åˆ°ä¸€ä¸ªä¸é€æ˜çš„ç‰©ä½“æ—¶ï¼Œè¿™æ¡å…‰çº¿å°±ä¸å¯ä»¥å†ç»§ç»­ç…§äº®å…¶ä»–çš„ç‰©ä½“ï¼ˆè¿™é‡Œä¸è€ƒè™‘å…‰çº¿çš„åå°„ï¼‰ã€‚å› æ­¤ï¼Œè¿™ä¸ªç‰©ä½“ä¼šå‘å®ƒæ—è¾¹çš„ç‰©ä½“æŠ•å°„é˜´å½±ï¼Œé‚£äº›é˜´å½±åŒºåŸŸçš„äº§ç”Ÿæ—¶å› ä¸ºå…‰çº¿æ— æ³•åˆ°è¾¾è¿™äº›åŒºåŸŸã€‚</p><p>åœ¨å®æ—¶æ¸²æŸ“ä¸­ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„æ˜¯ä¸€ç§åä¸ºShadowMapçš„æŠ€æœ¯ã€‚è¿™ç§æŠ€æœ¯ç†è§£èµ·æ¥éå¸¸ç®€å•ï¼Œå®ƒé¦–å…ˆä¼šæŠŠæ‘„åƒæœºçš„ä½ç½®æ”¾åœ¨ä¸å…‰æºé‡åˆçš„ä½ç½®ä¸Šï¼Œé‚£ä¹ˆåœºæ™¯ä¸­è¯¥å…‰æºçš„é˜´å½±åŒºåŸŸå°±æ˜¯é‚£äº›æ‘„åƒæœºçœ‹ä¸åˆ°çš„åœ°æ–¹ã€‚è€ŒUnityå°±æ˜¯ä½¿ç”¨çš„è¿™ç§æŠ€æœ¯ã€‚</p><p>åœ¨å‰å‘æ¸²æŸ“è·¯å¾„ä¸­ï¼Œå¦‚æœåœºæ™¯ä¸­æœ€é‡è¦çš„å¹³è¡Œå…‰å¼€å¯äº†é˜´å½±ï¼ŒUnityå°±ä¼šä¸ºè¯¥å…‰æºè®¡ç®—å®ƒçš„é˜´å½±æ˜ å°„çº¹ç†(shadowmap)ã€‚è¿™å¼ é˜´å½±æ˜ å°„çº¹ç†æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€å¼ æ·±åº¦å›¾ï¼Œå®ƒè®°å½•äº†ä»è¯¥å…‰æºçš„ä½ç½®å‡ºå‘ã€èƒ½çœ‹åˆ°åœºæ™¯ä¸­è·ç¦»å®ƒæœ€è¿‘çš„è¡¨é¢ä½ç½®ï¼ˆæ·±åº¦ä¿¡æ¯ï¼‰ã€‚</p><p>é‚£ä¹ˆåœ¨è®¡ç®—é˜´å½±æ˜ å°„çº¹ç†æ—¶ï¼Œæˆ‘ä»¬å¦‚ä½•åˆ¤å®šè·ç¦»å®ƒæœ€è¿‘çš„è¡¨é¢ä½ç½®å‘¢ï¼Ÿä¸€ç§æ–¹æ³•æ˜¯ï¼Œå…ˆæŠŠæ‘„åƒæœºæ”¾ç½®åœ¨å…‰æºä½ç½®ä¸Šï¼Œç„¶åæŒ‰ç…§æ­£å¸¸çš„æ¸²æŸ“æµç¨‹ï¼Œå³è°ƒç”¨Base Pass å’Œ Additional Passæ¥æ›´æ–°æ·±åº¦ä¿¡æ¯ï¼Œå¾—åˆ°é˜´å½±æ˜ å°„çº¹ç†ã€‚è¿™ç§æ–¹æ³•ä¼šå¯¹æ€§èƒ½é€ æˆä¸€å®šçš„æµªè´¹ï¼Œå› ä¸ºæˆ‘ä»¬å®é™…ä¸Šä»…ä»…éœ€è¦é€‰æ‹©ä½¿ç”¨ä¸€ä¸ªé¢å¤–çš„Passæ¥ä¸“é—¨æ›´æ–°å…‰æºçš„é˜´å½±æ˜ å°„çº¹ç†ï¼Œè¿™ä¸ªPasså°±æ˜¯LightModeæ ‡ç­¾è¢«è®¾ç½®ä¸ºShadowCasterçš„Passã€‚è¿™ä¸ªPassçš„æ¸²æŸ“ç›®æ ‡ä¸æ˜¯å¸§ç¼“å­˜ï¼Œè€Œæ˜¯é˜´å½±æ˜ å°„çº¹ç†ï¼ˆæˆ–è€…æ·±åº¦çº¹ç†ï¼‰ã€‚Unityé¦–å…ˆæŠŠæ‘„åƒæœºæ”¾ç½®åœ¨å…‰æºä½ç½®ä¸Šï¼Œç„¶åè°ƒç”¨è¯¥Passï¼Œé€šè¿‡å¯¹é¡¶ç‚¹å˜æ¢åå¾—åˆ°å…‰æºç©ºé—´ä¸‹çš„ä½ç½®ï¼Œå¹¶æ®æ­¤æ¥è¾“å‡ºæ·±åº¦ä¿¡æ¯åˆ°é˜´å½±æ˜ å°„çº¹ç†ä¸­ã€‚å› æ­¤ï¼Œå½“å¼€å¯äº†å…‰æºçš„é˜´å½±æ•ˆæœåï¼Œåº•å±‚æ¸²æŸ“å¼•æ“é¦–å…ˆä¼šåœ¨å½“å‰æ¸²æŸ“ç‰©ä½“çš„Unity Shaderä¸­æ‰¾åˆ°LightModeä¸ºShadowCaterçš„Passï¼Œå¦‚æœæ²¡æœ‰ï¼Œå®ƒå°±ä¼šåœ¨Fallbackä¸­æŒ‡å®šçš„UnityShaderä¸­ç»§ç»­å¯»æ‰¾ï¼Œå¦‚æœä»ç„¶æ²¡æœ‰æ‰¾åˆ°ï¼Œè¯¥ç‰©ä½“å°±æ²¡æœ‰åŠæ³•å‘å…¶ä»–ç‰©ä½“æŠ•å°„é˜´å½±ï¼Œä½†å®ƒä»ç„¶å¯ä»¥æ¥æ”¶æ¥è‡ªå…¶ä»–ç‰©ä½“çš„é˜´å½±ã€‚å½“æ‰¾åˆ°äº†ä¸€ä¸ªLightModeä¸ºShadowCasterçš„Passåï¼ŒUnityä¼šä½¿ç”¨è¯¥Passæ¥æ›´æ–°å…‰æºçš„é˜´å½±æ˜ å°„çº¹ç†ã€‚</p><p>åœ¨ä¼ ç»Ÿçš„é˜´å½±æ˜ å°„çº¹ç†çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬ä¼šåœ¨æ­£å¸¸æ¸²æŸ“çš„Passä¸­æŠŠé¡¶ç‚¹ä½ç½®å˜æ¢åˆ°å…‰æºç©ºé—´ä¸‹ï¼Œä»¥å¾—åˆ°å®ƒåœ¨å…‰æºç©ºé—´ä¸­çš„ä¸‰ç»´ä½ç½®ä¿¡æ¯ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨xyåˆ†é‡å¯¹é˜´å½±æ˜ å°„çº¹ç†è¿›è¡Œé‡‡æ ·ï¼Œå¾—åˆ°é˜´å½±æ˜ å°„çº¹ç†ä¸­è¯¥ä½ç½®çš„æ·±åº¦ä¿¡æ¯ã€‚å¦‚æœè¯¥æ·±åº¦å€¼å°äºè¯¥é¡¶ç‚¹çš„æ·±åº¦å€¼ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨xyåˆ†é‡å¯¹é˜´å½±æ˜ å°„çº¹ç†è¿›è¡Œé‡‡æ ·ï¼Œå¾—åˆ°é˜´å½±æ˜ å°„çº¹ç†ä¸­è¯¥ä½ç½®çš„æ·±åº¦ä¿¡æ¯ã€‚å¦‚æœè¯¥æ·±åº¦å€¼å°äºè¯¥é¡¶ç‚¹çš„æ·±åº¦å€¼ï¼ˆé€šå¸¸ç”±zåˆ†é‡å¾—åˆ°ï¼‰ï¼Œé‚£ä¹ˆè¯´æ˜è¯¥ç‚¹ä½äºé˜´å½±ä¸­ã€‚ä½†åœ¨Unity5ä¸­ï¼ŒUnityä½¿ç”¨äº†ä¸åŒäºè¿™ç§ä¼ ç»Ÿçš„é˜´å½±é‡‡æ ·æŠ€æœ¯ï¼Œå³å±å¹•ç©ºé—´çš„é˜´å½±æ˜ å°„æŠ€æœ¯ï¼ˆScreenSpace Shadow Mapï¼‰ã€‚å±å¹•ç©ºé—´çš„é˜´å½±æ˜ å°„åŸæœ¬æ˜¯å»¶è¿Ÿæ¸²æŸ“ä¸­äº§ç”Ÿé˜´å½±çš„æ–¹æ³•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰å¹³å°Unityéƒ½ä¼šä½¿ç”¨è¿™ç§æŠ€æœ¯ã€‚è¿™æ˜¯å› ä¸ºï¼Œå±å¹•ç©ºé—´çš„é˜´å½±æ˜ å°„éœ€è¦æ˜¾å¡æ”¯æŒMRTï¼ˆMultiple Render Textureï¼‰ï¼Œè€Œæœ‰äº›ç§»åŠ¨å¹³å°ä¸æ”¯æŒè¿™ç§ç‰¹æ€§ã€‚</p><p>å½“ä½¿ç”¨äº†å±å¹•ç©ºé—´çš„é˜´å½±æ˜ å°„æŠ€æœ¯æ—¶ï¼ŒUnityé¦–å…ˆä¼šé€šè¿‡è°ƒç”¨LightModeä¸ºShadowCasterçš„Passæ¥å¾—åˆ°å¯æŠ•å°„é˜´å½±çš„å…‰æºçš„é˜´å½±æ˜ å°„çº¹ç†ä»¥åŠæ‘„åƒæœºçš„æ·±åº¦çº¹ç†ã€‚ç„¶åï¼Œæ ¹æ®å…‰æºçš„é˜´å½±æ˜ å°„çº¹ç†å’Œæ‘„åƒæœºçš„æ·±åº¦çº¹ç†æ¥å¾—åˆ°å±å¹•ç©ºé—´çš„é˜´å½±å›¾ã€‚å¦‚æœæ‘„åƒæœºçš„æ·±åº¦å›¾ä¸­è®°å½•çš„è¡¨é¢æ·±åº¦å¤§äºè½¬æ¢åˆ°é˜´å½±æ˜ å°„çº¹ç†ä¸­çš„æ·±åº¦å€¼ï¼Œå°±è¯´æ˜è¯¥è¡¨é¢è™½ç„¶æ˜¯å¯è§çš„ï¼Œä½†æ˜¯å´å¤„äºè¯¥å…‰æºçš„é˜´å½±ä¸­ã€‚é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œé˜´å½±å›¾å°±åŒ…å«äº†å±å¹•ç©ºé—´çš„ä¸­æ‰€æœ‰çš„é˜´å½±åŒºåŸŸã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦ä¸€ä¸ªç‰©ä½“æ¥æ”¶æ¥è‡ªå…¶ä»–ç‰©ä½“çš„é˜´å½±ï¼Œåªéœ€è¦åœ¨Shaderä¸­å¯¹é˜´å½±å›¾è¿›è¡Œé‡‡æ ·ã€‚ç”±äºé˜´å½±å›¾æ˜¯å±å¹•ç©ºé—´ä¸‹çš„ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æŠŠè¡¨é¢åæ ‡ä»æ¨¡å‹ç©ºé—´å˜æ¢åˆ°å±å¹•ç©ºé—´ä¸­ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªåæ ‡å¯¹é˜´å½±å›¾è¿›è¡Œé‡‡æ ·å³å¯ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œä¸€ä¸ªç‰©ä½“æ¥æ”¶æ¥è‡ªå…¶ä»–ç‰©ä½“çš„é˜´å½±ï¼Œä»¥åŠå®ƒå‘å…¶ä»–ç‰©ä½“æŠ•å°„é˜´å½±æ˜¯ä¸¤ä¸ªè¿‡ç¨‹</p><ul><li>å¦‚æœæˆ‘ä»¬æƒ³è¦ä¸€ä¸ªç‰©ä½“æ¥æ”¶æ¥è‡ªå…¶ä»–ç‰©ä½“çš„é˜´å½±ï¼Œå°±å¿…é¡»åœ¨Shaderä¸­å¯¹é˜´å½±æ˜ å°„çº¹ç†ï¼ˆåŒ…æ‹¬å±å¹•ç©ºé—´çš„é˜´å½±å›¾ï¼‰è¿›è¡Œé‡‡æ ·ï¼ŒæŠŠé‡‡æ ·ç»“æœå’Œæœ€åçš„å…‰ç…§ç»“æœç›¸ä¹˜æ¥äº§ç”Ÿé˜´å½±ç»“æœã€‚</li><li>å¦‚æœæˆ‘ä»¬æƒ³è¦ä¸€ä¸ªç‰©ä½“å‘å…¶ä»–ç‰©ä½“æŠ•å°„é˜´å½±ï¼Œå°±å¿…é¡»æŠŠè¯¥ç‰©ä½“åŠ å…¥åˆ°å…‰æºçš„é˜´å½±æ˜ å°„çº¹ç†çš„è®¡ç®—ä¸­ï¼Œä»è€Œè®©å…¶ä»–ç‰©ä½“åœ¨å¯¹é˜´å½±æ˜ å°„çº¹ç†é‡‡æ ·æ—¶å¯ä»¥å¾—åˆ°è¯¥ç‰©ä½“çš„ç›¸å…³ä¿¡æ¯ã€‚åœ¨Unityä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯é€šè¿‡ä¸ºè¯¥ç‰©ä½“æ‰§è¡ŒLightModeä¸ºShadowCasterçš„Passæ¥å®ç°çš„ã€‚å¦‚æœä½¿ç”¨äº†å±å¹•ç©ºé—´çš„æŠ•å½±æ˜ å°„æŠ€æœ¯ï¼ŒUnityè¿˜ä¼šä½¿ç”¨è¿™ä¸ªPassäº§ç”Ÿä¸€å¼ æ‘„åƒæœºçš„æ·±åº¦çº¹ç†ã€‚</li></ul><h2 id="ä¸é€æ˜ç‰©ä½“çš„é˜´å½±">ä¸é€æ˜ç‰©ä½“çš„é˜´å½±</h2><p>æ–°å»ºä¸€ä¸ªåœºæ™¯ï¼Œåˆ›å»ºä¸€ä¸ªæ­£æ–¹ä½“ï¼Œä¸ºå®ƒæ·»åŠ ä¸Šä¸€èŠ‚å®ç°çš„å‰å‘æ¸²æŸ“è·¯å¾„ä¸‹çš„åŒ…å«Base Passå’ŒAdditional Passçš„Shaderçš„æè´¨ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦åœ¨æƒ³è¦äº§ç”Ÿé˜´å½±çš„å…‰æºçš„<code>Inspector</code>çª—å£ä¸­è®¾ç½®å®ƒçš„<code>ShadowType</code>å±æ€§ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©äº†è½¯é˜´å½±ï¼ˆSoft Shadowsï¼‰ã€‚</p><p>ç„¶åæˆ‘ä»¬æ¥è¯´ä¸€ä¸‹å¦‚ä½•è®©ç‰©ä½“æŠ•å°„é˜´å½±ä»¥åŠå¦‚ä½•è®©ç‰©ä½“æ¥æ”¶é˜´å½±ã€‚</p><ol><li>è®©ç‰©ä½“æŠ•å°„é˜´å½±</li></ol><p>åœ¨Unityä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æ˜¯å¦è®©ä¸€ä¸ªç‰©ä½“æŠ•å°„æˆ–è€…æ¥æ”¶é˜´å½±ï¼Œè¿™æ˜¯é€šè¿‡è®¾ç½®Mesh Rendererä¸­çš„Cast Shadowså’ŒReceive Shadowså±æ€§æ¥å®ç°çš„ã€‚</p><p>Cast Shadowså¯ä»¥è¢«è®¾ç½®ä¸ºå¼€å¯æˆ–è€…å…³é—­ã€‚å¦‚æœå¼€å¯äº†Cast Shadowså±æ€§ï¼Œé‚£ä¹ˆUnityå°±ä¼šæŠŠè¯¥ç‰©ä½“åŠ å…¥åˆ°å…‰æºçš„é˜´å½±æ˜ å°„çº¹ç†çš„è®¡ç®—ä¸­ï¼Œä»è€Œè®©å…¶ä»–ç‰©ä½“åœ¨å¯¹é˜´å½±æ˜ å°„çº¹ç†é‡‡æ ·æ—¶å°±å¯ä»¥å¾—åˆ°è¯¥ç‰©ä½“çš„ç›¸å…³ä¿¡æ¯ã€‚æ­£å¦‚ä¹‹å‰æ‰€è¯´ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯é€šè¿‡ä¸ºè¯¥ç‰©ä½“æ‰§è¡ŒLightModeä¸ºShadowCasterçš„Passæ¥å®ç°çš„ã€‚Receive Shadowsåˆ™å¯ä»¥é€‰æ‹©æ˜¯å¦è®©ç‰©ä½“æ¥æ”¶æ¥è‡ªå…¶ä»–ç‰©ä½“çš„é˜´å½±ï¼Œå¦‚æœæ²¡æœ‰å¼€å¯Receive Shadowsï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬è°ƒç”¨Unityçš„å†…ç½®å®å’Œå˜é‡è®¡ç®—é˜´å½±æ—¶ï¼Œè¿™äº›å®é€šè¿‡åˆ¤æ–­è¯¥ç‰©ä½“æœ‰æ²¡æœ‰å¼€å¯æ¥æ”¶é˜´å½±çš„åŠŸèƒ½ï¼Œå°±ä¸ä¼šåœ¨å†…éƒ¨ä¸ºæˆ‘ä»¬è®¡ç®—é˜´å½±ã€‚</p><p>æˆ‘ä»¬æŠŠæ­£æ–¹ä½“å’Œä¸¤ä¸ªå¹³é¢çš„Cast Shadowså’ŒReceive Shadowséƒ½è®¾ç½®ä¸ºå¼€å¯çŠ¶æ€ã€‚å°±ä¼šå¾—åˆ°ä¸‹é¢çš„ç»“æœï¼š</p> <img src="/posts/e52a9ff3/image5.png" class=""><p>åœ¨ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå°½ç®¡æˆ‘ä»¬æ²¡æœ‰å¯¹Shaderåšä»»ä½•ä¿®æ”¹ï¼Œä½†æ˜¯æ­£æ–¹ä½“ä»ç„¶å¯ä»¥å‘ä¸‹é¢çš„å¹³é¢æŠ•å°„é˜´å½±ã€‚è¿™æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬åœ¨Shaderä¸­æ·»åŠ äº†Fallbackè¯­ä¹‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fallback &quot;Specular&quot;</span><br></pre></td></tr></table></figure><p>åœ¨æˆ‘ä»¬çš„Shaderä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸ºå®ƒçš„FallbackæŒ‡å®šäº†ä¸€ä¸ªç”¨äºå›è°ƒçš„Unity Shaderï¼Œå³å†…ç½®çš„Specularã€‚è™½ç„¶Specularæœ¬èº«ä¹Ÿæ²¡æœ‰åŒ…å«è¿™æ ·ä¸€ä¸ªPassï¼Œä½†æ˜¯ç”±äºå®ƒçš„Fallbackè°ƒç”¨äº†VertexLitï¼Œå®ƒä¼šç»§ç»­å›è°ƒï¼Œå¹¶æœ€ç»ˆå›è°ƒåˆ°å†…ç½®çš„VertexLitã€‚æˆ‘ä»¬å¯ä»¥åœ¨Unityå†…ç½®çš„ç€è‰²å™¨ä¸­æ‰¾åˆ°å®ƒï¼Œå®ç°LightModeä¸ºShadowCasterçš„Passä»£ç å¤§è‡´å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Pass&#123;</span><br><span class="line">    Name &quot;ShadowCaster&quot;</span><br><span class="line">    Tags &#123;&quot;LightMode&quot;=&quot;ShadowCaster&quot;&#125;</span><br><span class="line"></span><br><span class="line">    CGPROGRAM</span><br><span class="line"></span><br><span class="line">    #pragma vertex vert</span><br><span class="line">    #pragma fragment frag</span><br><span class="line">    #pragma multi_compile_shadowcaster</span><br><span class="line">    #include &quot;UnityCG.cginc&quot;</span><br><span class="line"></span><br><span class="line">    struct v2f&#123;</span><br><span class="line">        V2F_SHADOW_CASTER;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    v2f vert(appdata_base v)&#123;</span><br><span class="line">        v2f o;</span><br><span class="line">        TRANSFER_SHADOW_CASTER_NORMALOFFSET(o)</span><br><span class="line">        retrun o;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    float4 frag(v2f i) : SV_Target&#123;</span><br><span class="line">        SHADOW_CASTER_FRAGMENT(i)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ENDCG</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç éå¸¸çŸ­ï¼Œå°½ç®¡æœ‰ä¸€äº›æŒ‡ä»¤å’Œå®æ˜¯æˆ‘ä»¬ä¹‹å‰æ²¡æœ‰é‡åˆ°è¿‡çš„ï¼Œä½†å®ƒä»¬çš„ç”¨å¤„å®é™…ä¸Šå°±æ˜¯ä¸ºäº†æŠŠæ·±åº¦ä¿¡æ¯å†™å…¥æ¸²æŸ“ç›®æ ‡ä¸­ã€‚åœ¨unity5ä¸­ï¼Œè¿™ä¸ªPassçš„æ¸²æŸ“ç›®æ ‡å¯ä»¥æ˜¯å…‰æºçš„é˜´å½±æ˜ å°„çº¹ç†ï¼Œæˆ–æ˜¯æ‘„åƒæœºçš„æ·±åº¦çº¹ç†ã€‚</p><p>å¦‚æœæˆ‘ä»¬æŠŠæˆ‘ä»¬Shaderä»£ç ä¸­çš„Fallbackæ³¨é‡Šæ‰ï¼Œå°±å¯ä»¥æ³•çº¿æ­£æ–¹ä½“ä¸ä¼šå†å‘å¹³é¢æŠ•å°„é˜´å½±äº†ã€‚å½“ç„¶æˆ‘ä»¬å¯ä»¥é¢ä¸ä¾èµ–Fallbackï¼Œè€Œè‡ªè¡Œåœ¨SubShaderä¸­å®šä¹‰è‡ªå·±çš„LightModeä¸ºShadowCasterçš„Passã€‚è¿™ç§è‡ªå®šä¹‰çš„Passå¯ä»¥è®©æˆ‘ä»¬æ›´åŠ çµæ´»åœ°æ§åˆ¶é˜´å½±çš„äº§ç”Ÿã€‚ä½†ç”±äºè¿™ä¸ªPassåœ°åŠŸèƒ½é€šå¸¸æ˜¯å¯ä»¥åœ¨å¤šä¸ªUnityShaderä¸­é€šç”¨åœ°ï¼Œå› æ­¤ç›´æ¥Fallbackæ˜¯ä¸€ä¸ªæ›´åŠ æ–¹ä¾¿çš„ç”¨æ³•ã€‚åœ¨ä¹‹å‰çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬æœ‰æ—¶ä¹Ÿåœ¨Fallbackä¸­ä½¿ç”¨å†…ç½®çš„Diffuseï¼Œè™½ç„¶Diffuseæœ¬èº«ä¹Ÿæ²¡æœ‰åŒ…å«è¿™æ ·ä¸€ä¸ªPassï¼Œä½†æ˜¯ç”±äºå®ƒçš„Fallbackè°ƒç”¨äº†VertexLitï¼Œå› æ­¤Unityæœ€ç»ˆè¿˜æ˜¯ä¼šæ‰¾åˆ°ä¸€ä¸ªLightModeä¸ºShadowCasterçš„Passï¼Œä»è€Œå¯ä»¥è®©ç‰©ä½“äº§ç”Ÿé˜´å½±ã€‚åœ¨ä¸‹é¢å°èŠ‚ä¸­æˆ‘ä»¬å°†ç»§ç»­çœ‹åˆ°LightModeä¸ºShadowCasterçš„Passå¯¹äº§ç”Ÿæ­£ç¡®çš„é˜´å½±çš„é‡è¦æ€§ã€‚</p><p>å¦å¤–ï¼Œä¸Šå›¾ä¸­è¿˜æœ‰ä¸€ä¸ªæœ‰æ„æ€çš„ç°è±¡ï¼Œå°±æ˜¯å³ä¾§çš„å¹³é¢å¹¶æ²¡æœ‰å‘æœ€ä¸‹é¢çš„å¹³é¢æŠ•å°„é˜´å½±ï¼Œå°½ç®¡å®ƒçš„Caster Shadowså·²ç»è¢«å¼€å¯äº†ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åœ¨è®¡ç®—å…‰æºçš„é˜´å½±æ˜ å°„çº¹ç†æ—¶ä¼šå‰”é™¤æ‰ç‰©ä½“çš„èƒŒé¢ã€‚ä½†å¯¹äºå†…ç½®çš„å¹³é¢æ¥è¯´ï¼Œå®ƒåªæœ‰ä¸€ä¸ªé¢ï¼Œå› æ­¤åœ¨æœ¬ä¾‹ä¸­å½“è®¡ç®—é˜´å½±çº¹ç†æ˜ å°„æ—¶ï¼Œç”±äºåœ¨å³ä¾§çš„å¹³é¢åœ¨å…‰æºç©ºé—´ä¸‹æ²¡æœ‰ä»»ä½•æ­£é¢(frontface)ï¼Œå› æ­¤å°±ä¸ä¼šæ·»åŠ åˆ°é˜´å½±æ˜ å°„çº¹ç†ä¸­ã€‚æˆ‘ä»¬å¯ä»¥å°†CastShadowsè®¾ç½®ä¸ºTwo Sidedæ¥å…è®¸å¯¹ç‰©ä½“çš„æ‰€æœ‰é¢éƒ½è®¡ç®—é˜´å½±ä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°äº†ä¸‹é¢çš„æ•ˆæœï¼š</p> <img src="/posts/e52a9ff3/image6.png" class=""><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œæœ€ä¸‹é¢çš„å¹³é¢ä¹‹æ‰€ä»¥å¯ä»¥æ¥æ”¶é˜´å½±æ˜¯å› ä¸ºå®ƒä½¿ç”¨äº†å†…ç½®çš„Standard Shaderï¼Œè€Œè¿™ä¸ªå†…ç½®çš„Shaderè¿›è¡Œäº†æ¥å—é˜´å½±çš„ç›¸å…³æ“ä½œã€‚ä½†æ˜¯ç”±äºæ­£æ–¹ä½“ä½¿ç”¨äº†æˆ‘ä»¬è‡ªå·±å®ç°çš„Shaderå¹¶æ²¡æœ‰å¯¹é˜´å½±è¿›è¡Œä»»ä½•å¤„ç†ï¼Œå› æ­¤å®ƒä¸ä¼šæ˜¾ç¤ºå‡ºå³ä¾§å¹³é¢æŠ•å°„æ¥çš„é˜´å½±ï¼Œåœ¨ä¸‹ä¸€å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•è®©æ­£æ–¹ä½“ä¹Ÿå¯ä»¥æ¥æ”¶é˜´å½±ã€‚</p><ol start="2"><li>è®©ç‰©ä½“æ¥æ”¶é˜´å½±</li></ol><p>ä¸ºäº†è®©æ­£æ–¹ä½“å¯ä»¥æ¥æ”¶é˜´å½±ï¼Œæˆ‘ä»¬é¦–å…ˆæ–°å»ºä¸€ä¸ªUnityShaderï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line">// Upgrade NOTE: replaced &#x27;_LightMatrix0&#x27; with &#x27;unity_WorldToLight&#x27;</span><br><span class="line"></span><br><span class="line">// Upgrade NOTE: replaced &#x27;_LightMatrix0&#x27; with &#x27;unity_WorldToLight&#x27;</span><br><span class="line"></span><br><span class="line">Shader &quot;UnityShaderBook/Chapter 9/Shadow&quot;</span><br><span class="line">&#123;</span><br><span class="line">   // ä½¿ç”¨Blinn-Phongå…‰ç…§æ¨¡å‹</span><br><span class="line">   </span><br><span class="line">   Properties</span><br><span class="line">   &#123;</span><br><span class="line">      _Specular (&quot;Specular&quot;, Color) = (1,1,1,1)</span><br><span class="line">      _Diffuse (&quot;Diffuse&quot;, Color) = (1,1,1,1)</span><br><span class="line">      _Gloss (&quot;Gloss&quot;, Range(8.0, 256)) = 20      </span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   SubShader</span><br><span class="line">   &#123;</span><br><span class="line">      Pass</span><br><span class="line">      &#123;</span><br><span class="line">         Tags</span><br><span class="line">         &#123;</span><br><span class="line">            &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">         &#125;     </span><br><span class="line">         </span><br><span class="line">         CGPROGRAM</span><br><span class="line"></span><br><span class="line">         #include &quot;Lighting.cginc&quot;</span><br><span class="line">         #include &quot;AutoLight.cginc&quot;</span><br><span class="line">         #pragma multi_compile_fwdbase</span><br><span class="line">         #pragma vertex vert</span><br><span class="line">         #pragma fragment frag</span><br><span class="line">         </span><br><span class="line">         fixed4 _Specular;</span><br><span class="line">         fixed4 _Diffuse;</span><br><span class="line">         float _Gloss;</span><br><span class="line">         </span><br><span class="line">         struct a2v</span><br><span class="line">         &#123;</span><br><span class="line">            float4 vertex : POSITION;</span><br><span class="line">            float3 normal : NORMAL;</span><br><span class="line">         &#125;;</span><br><span class="line">         </span><br><span class="line">         struct v2f</span><br><span class="line">         &#123;</span><br><span class="line">            float4 pos : SV_POSITION;</span><br><span class="line">            float3 worldNormal : TEXCOORD0;</span><br><span class="line">            float3 worldPos : TEXCOORD1;</span><br><span class="line">            SHADOW_COORDS(2)</span><br><span class="line">         &#125;;</span><br><span class="line"></span><br><span class="line">         v2f vert(a2v v)</span><br><span class="line">         &#123;</span><br><span class="line">            v2f o;</span><br><span class="line"></span><br><span class="line">            o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line">            o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line">            o.worldPos = mul(unity_ObjectToWorld, v.vertex);</span><br><span class="line"></span><br><span class="line">            TRANSFER_SHADOW(o);</span><br><span class="line">            </span><br><span class="line">            return o;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         fixed4 frag(v2f i) : SV_Target&#123;</span><br><span class="line">            </span><br><span class="line">            fixed3 worldViewDir = normalize(UnityWorldSpaceViewDir(i.worldPos));</span><br><span class="line">            fixed3 lightDir = normalize(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line">            fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line">            </span><br><span class="line">            fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz;</span><br><span class="line"></span><br><span class="line">            fixed shadow = SHADOW_ATTENUATION(i);</span><br><span class="line"></span><br><span class="line">            fixed3 diffuse = _LightColor0.rgb * _Diffuse.rgb * saturate(dot(worldNormal,lightDir)) * shadow;</span><br><span class="line">            </span><br><span class="line">            fixed3 halfDir = normalize(worldViewDir + lightDir);      </span><br><span class="line">            </span><br><span class="line">            fixed3 specular = _LightColor0.rgb * _Specular.rgb * pow(saturate(dot(i.worldNormal, halfDir)),_Gloss) * shadow;</span><br><span class="line">            </span><br><span class="line">            return fixed4(ambient + diffuse + specular, 1.0);</span><br><span class="line">         &#125;</span><br><span class="line">         </span><br><span class="line">         ENDCG</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      Pass</span><br><span class="line">      &#123;</span><br><span class="line">         Tags</span><br><span class="line">         &#123;</span><br><span class="line">            &quot;LightMode&quot;=&quot;ForwardAdd&quot;  </span><br><span class="line">         &#125;</span><br><span class="line">         </span><br><span class="line">         Blend One One</span><br><span class="line">         </span><br><span class="line">         CGPROGRAM</span><br><span class="line"></span><br><span class="line">         #pragma multi_compile_fwdadd</span><br><span class="line">         </span><br><span class="line">         #include &quot;Lighting.cginc&quot;</span><br><span class="line">         #include &quot;AutoLight.cginc&quot;</span><br><span class="line">         </span><br><span class="line">         #pragma vertex vert</span><br><span class="line">         #pragma fragment frag</span><br><span class="line">         </span><br><span class="line">         fixed4 _Specular;</span><br><span class="line">         fixed4 _Diffuse;</span><br><span class="line">         float _Gloss;</span><br><span class="line">         </span><br><span class="line">         struct a2v</span><br><span class="line">         &#123;</span><br><span class="line">            float4 vertex : POSITION;</span><br><span class="line">            float3 normal : NORMAL;</span><br><span class="line">         &#125;;</span><br><span class="line">         </span><br><span class="line">         struct v2f</span><br><span class="line">         &#123;</span><br><span class="line">            float4 pos : SV_POSITION;</span><br><span class="line">            float3 worldNormal : TEXCOORD0;</span><br><span class="line">            float3 worldPos : TEXCOORD1;</span><br><span class="line">         &#125;;</span><br><span class="line"></span><br><span class="line">         v2f vert(a2v v)</span><br><span class="line">         &#123;</span><br><span class="line">            v2f o;</span><br><span class="line"></span><br><span class="line">            o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line">            o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line">            o.worldPos = mul(unity_ObjectToWorld, v.vertex);</span><br><span class="line">            </span><br><span class="line">            return o;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         fixed4 frag(v2f i) : SV_Target&#123;</span><br><span class="line">            </span><br><span class="line">            fixed3 worldViewDir = normalize(UnityWorldSpaceViewDir(i.worldPos));</span><br><span class="line"></span><br><span class="line">#ifdef USING_DIRECTIONAL_LIGHT</span><br><span class="line">            fixed3 lightDir = normalize(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line">#else</span><br><span class="line">            fixed3 lightDir = normalize(_WorldSpaceLightPos0.xyz - i.worldPos.xyz);</span><br><span class="line">#endif</span><br><span class="line">            </span><br><span class="line">            fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line"></span><br><span class="line">            fixed3 diffuse = _LightColor0.rgb * _Diffuse.rgb * saturate(dot(worldNormal,lightDir));</span><br><span class="line">            </span><br><span class="line">            fixed3 halfDir = normalize(worldViewDir + lightDir);      </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#ifdef USING_DIRECTIONAL_LIGHT</span><br><span class="line">            fixed atten = 1.0;</span><br><span class="line">#else</span><br><span class="line">            float3 lightCoord = mul(unity_WorldToLight, float4(i.worldPos, 1)).xyz;</span><br><span class="line">            fixed atten = tex2D(_LightTexture0, dot(lightCoord, lightCoord).rr).UNITY_ATTEN_CHANNEL;</span><br><span class="line">#endif</span><br><span class="line">            </span><br><span class="line">            fixed3 specular = _LightColor0.rgb * _Specular.rgb * pow(saturate(dot(i.worldNormal, halfDir)),_Gloss);</span><br><span class="line"></span><br><span class="line">            return fixed4( (diffuse + specular) * atten, 1.0);</span><br><span class="line">         &#125;</span><br><span class="line">         ENDCG</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   Fallback &quot;Specular&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨é¡¶ç‚¹ç€è‰²å™¨çš„è¾“å‡ºç»“æ„ä½“ä¸­æ·»åŠ äº†ä¸€ä¸ªå†…ç½®å®<strong>SHADOW_COORDS</strong>ï¼Œè¿™ä¸ªå®çš„ä½œç”¨å¾ˆç®€å•ï¼Œå°±æ˜¯å£°æ˜ä¸€ä¸ªç”¨äºå¯¹é˜´å½±çº¹ç†é‡‡æ ·çš„åæ ‡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªå®çš„å‚æ•°éœ€è¦æ˜¯ä¸‹ä¸€ä¸ªå¯ç”¨çš„æ’å€¼å¯„å­˜å™¨çš„ç´¢å¼•å€¼ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œ<strong>TEXCOORD0</strong>å’Œ<strong>TEXCOORD1</strong>æ’å€¼å¯„å­˜å™¨è¢«ç”¨ä½œå­˜å‚¨worldPoså’ŒworldNormalï¼Œå› æ­¤éœ€è¦å‘è¯¥å®ä¸­ä¼ é€’çš„å‚æ•°æ˜¯2ã€‚<br>ç„¶åæˆ‘ä»¬åœ¨é¡¶ç‚¹ç€è‰²å™¨è¿”å›ä¹‹å‰æ·»åŠ å¦ä¸€ä¸ªå†…ç½®å®<strong>TRANSFER_SHADOW</strong>ï¼Œè¿™ä¸ªå®ç”¨äºåœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­è®¡ç®—ä¸Šä¸€æ­¥ä¸­å£°æ˜çš„é˜´å½±çº¹ç†åæ ‡ã€‚</p><p>æ¥ç€ï¼Œæˆ‘ä»¬åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­è®¡ç®—é˜´å½±å€¼ï¼Œè¿™åŒæ ·ä½¿ç”¨äº†ä¸€ä¸ªå†…ç½®å®<strong>SHADOW_ATTENUATION</strong>ã€‚</p><p><strong>SHADOW_COORDS</strong>ã€<strong>TRANSFER_SHADOW</strong>ã€<strong>SHADOW_ATTENUATION</strong>æ˜¯è®¡ç®—é˜´å½±æ—¶çš„ä¸‰å‰‘å®¢ã€‚è¿™äº›å†…ç½®å®å¸®åŠ©æˆ‘ä»¬åœ¨å¿…è¦æ—¶è®¡ç®—å…‰æºçš„é˜´å½±ã€‚æˆ‘ä»¬å¯ä»¥åœ¨<code>AutoLight.cginc</code>ä¸­æ‰¾åˆ°å®ƒä»¬çš„å£°æ˜ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">// ----------------</span><br><span class="line">//  Shadow helpers</span><br><span class="line">// ----------------</span><br><span class="line"></span><br><span class="line">// If none of the keywords are defined, assume directional?</span><br><span class="line">#if !defined(POINT) &amp;&amp; !defined(SPOT) &amp;&amp; !defined(DIRECTIONAL) &amp;&amp; !defined(POINT_COOKIE) &amp;&amp; !defined(DIRECTIONAL_COOKIE)</span><br><span class="line">    #define DIRECTIONAL 1</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">// ---- Screen space direction light shadows helpers (any version)</span><br><span class="line">#if defined (SHADOWS_SCREEN)</span><br><span class="line"></span><br><span class="line">    #if defined(UNITY_NO_SCREENSPACE_SHADOWS)</span><br><span class="line">        UNITY_DECLARE_SHADOWMAP(_ShadowMapTexture);</span><br><span class="line">        #define TRANSFER_SHADOW(a) a._ShadowCoord = mul( unity_WorldToShadow[0], mul( unity_ObjectToWorld, v.vertex ) );</span><br><span class="line">        #define TRANSFER_SHADOW_WPOS(a, wpos) a._ShadowCoord = mul( unity_WorldToShadow[0], float4(wpos.xyz, 1.0f) );</span><br><span class="line">        inline fixed unitySampleShadow (unityShadowCoord4 shadowCoord)</span><br><span class="line">        &#123;</span><br><span class="line">            #if defined(SHADOWS_NATIVE)</span><br><span class="line">                fixed shadow = UNITY_SAMPLE_SHADOW(_ShadowMapTexture, shadowCoord.xyz);</span><br><span class="line">                shadow = _LightShadowData.r + shadow * (1-_LightShadowData.r);</span><br><span class="line">                return shadow;</span><br><span class="line">            #else</span><br><span class="line">                unityShadowCoord dist = SAMPLE_DEPTH_TEXTURE(_ShadowMapTexture, shadowCoord.xy);</span><br><span class="line">                // tegra is confused if we useÂ _LightShadowData.x directly</span><br><span class="line">                // with &quot;ambiguous overloaded function reference max(mediump float, float)&quot;</span><br><span class="line">                unityShadowCoord lightShadowDataX = _LightShadowData.x;</span><br><span class="line">                unityShadowCoord threshold = shadowCoord.z;</span><br><span class="line">                return max(dist &gt; threshold, lightShadowDataX);</span><br><span class="line">            #endif</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    #else // UNITY_NO_SCREENSPACE_SHADOWS</span><br><span class="line">        UNITY_DECLARE_SCREENSPACE_SHADOWMAP(_ShadowMapTexture);</span><br><span class="line">        #define TRANSFER_SHADOW(a) a._ShadowCoord = ComputeScreenPos(a.pos);</span><br><span class="line">        #define TRANSFER_SHADOW_WPOS(a, wpos) a._ShadowCoord = ComputeScreenPos(a.pos);</span><br><span class="line">        inline fixed unitySampleShadow (unityShadowCoord4 shadowCoord)</span><br><span class="line">        &#123;</span><br><span class="line">            fixed shadow = UNITY_SAMPLE_SCREEN_SHADOW(_ShadowMapTexture, shadowCoord);</span><br><span class="line">            return shadow;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    #endif</span><br><span class="line"></span><br><span class="line">    #define SHADOW_COORDS(idx1) unityShadowCoord4 _ShadowCoord : TEXCOORD##idx1;</span><br><span class="line">    #define SHADOW_ATTENUATION(a) unitySampleShadow(a._ShadowCoord)</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// ---- Shadows off</span><br><span class="line">#if !defined (SHADOWS_SCREEN) &amp;&amp; !defined (SHADOWS_DEPTH) &amp;&amp; !defined (SHADOWS_CUBE)</span><br><span class="line">#define SHADOW_COORDS(idx1)</span><br><span class="line">#define TRANSFER_SHADOW(a)</span><br><span class="line">#define TRANSFER_SHADOW_WPOS(a, wpos)</span><br><span class="line">#define SHADOW_ATTENUATION(a) 1.0</span><br><span class="line">#define READ_SHADOW_COORDS(a) 0</span><br><span class="line">#else</span><br><span class="line">#ifndef READ_SHADOW_COORDS</span><br><span class="line">#define READ_SHADOW_COORDS(a) a._ShadowCoord</span><br><span class="line">#endif</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç å®é™…ä¸Šåªæ˜¯Unityä¸ºäº†å¤„ç†ä¸åŒçš„å…‰æºç±»å‹ã€ä¸åŒå¹³å°è€Œå®šä¹‰äº†å¤šä¸ªç‰ˆæœ¬çš„å®ã€‚åœ¨å‰å‘æ¸²æŸ“ä¸­ï¼Œå®<strong>SHADOW_COORDS</strong>å®é™…ä¸Šå°±æ˜¯å£°æ˜äº†ä¸€ä¸ªåä¸º_ShadowCoordçš„é˜´å½±çº¹ç†åæ ‡å˜é‡ã€‚è€Œ<strong>TRANSFER_SHADOW</strong>çš„å®ç°ä¼šæ ¹æ®å¹³å°ä¸åŒè€Œæœ‰æ‰€å·®å¼‚ã€‚å¦‚æœå½“å‰å¹³å°å¯ä»¥ä½¿ç”¨å±å¹•ç©ºé—´çš„é˜´å½±æ˜ å°„æŠ€æœ¯(é€šè¿‡åˆ¤æ–­æ˜¯å¦å®šä¹‰äº†<strong>UNITY_NO_SCREENSPACE_SHADOWS</strong>æ¥å¾—åˆ°)ï¼Œ<strong>TRANSFER_SHADOW</strong>ä¼šè°ƒç”¨å†…ç½®çš„ComputeScreenPoså‡½æ•°æ¥è®¡ç®—_ShadowCoordï¼›å¦‚æœè¯¥å¹³å°ä¸æ”¯æŒå±å¹•ç©ºé—´çš„é˜´å½±æ˜ å°„æŠ€æœ¯ï¼Œå°±ä¼šä½¿ç”¨ä¼ ç»Ÿçš„é˜´å½±æ˜ å°„æŠ€æœ¯ï¼Œ<strong>TRANSFER_SHADOW</strong>ä¼šæŠŠé¡¶ç‚¹åæ ‡ä»æ¨¡å‹ç©ºé—´å˜æ¢åˆ°å…‰æºç©ºé—´åå­˜å‚¨åˆ°_ShadowCoordä¸­ã€‚ç„¶å<strong>SHADOW_ATTENUATION</strong>è´Ÿè´£ä½¿ç”¨_ShadowCoordå¯¹ç›¸å…³çš„çº¹ç†è¿›è¡Œé‡‡æ ·ï¼Œå¾—åˆ°é˜´å½±ä¿¡æ¯ã€‚</p><p>æ³¨æ„åˆ°ï¼Œä¸Šé¢çš„å†…ç½®ä»£ç çš„æœ€åå®šä¹‰äº†åœ¨å…³é—­é˜´å½±çš„æ—¶å€™çš„å¤„ç†ä»£ç ã€‚å¯ä»¥çœ‹å‡ºï¼Œå½“å…³é—­äº†é˜´å½±åï¼Œ<strong>SHADOW_COORDS</strong>å’Œ<strong>TRANSFER_SHADOW</strong>å®é™…æ²¡æœ‰ä»»ä½•ä½œç”¨ï¼Œè€Œ<strong>SHADOW_ATTENUATION</strong>çš„å€¼ä¼šç›´æ¥ç­‰äºæ•°å€¼1ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºè¿™äº›å®ä¼šä½¿ç”¨ä¸Šä¸‹æ–‡å˜é‡æ¥è¿›è¡Œç›¸å…³è®¡ç®—ï¼Œä¾‹å¦‚TRANSFER_SHADOWä¼šä½¿ç”¨v.vertexæˆ–a.posæ¥è®¡ç®—åæ ‡ï¼Œå› æ­¤ä¸ºäº†èƒ½å¤Ÿè®©è¿™äº›å®å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯è‡ªå®šä¹‰çš„å˜é‡åå’Œè¿™äº›å®ä¸­ä½¿ç”¨çš„å˜é‡åç›¸åŒ¹é…ã€‚<strong>æˆ‘ä»¬éœ€è¦ä¿è¯ï¼ša2vç»“æ„ä½“çš„é¡¶ç‚¹åæ ‡å˜é‡åå¿…é¡»æ˜¯vertexï¼Œé¡¶ç‚¹ç€è‰²å™¨çš„è¾“å…¥ç»“æ„ä½“a2vå¿…é¡»å‘½åä¸ºvï¼Œä¸”v2fä¸­çš„é¡¶ç‚¹ä½ç½®å˜é‡å¿…é¡»å‘½åä¸ºposã€‚</strong></p><p>åœ¨å®Œæˆäº†ä¸Šé¢çš„æ‰€æœ‰æ“ä½œä¹‹åï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠé˜´å½±å€¼shadowå’Œæ¼«åå°„ä»¥åŠé«˜å…‰åå°„é¢œè‰²ç›¸ä¹˜å³å¯ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨ä»£ç ä¸­åªæ›´æ”¹äº†Base Passä¸­çš„ä»£ç ï¼Œä½¿å…¶å¯ä»¥å¾—åˆ°é˜´å½±æ•ˆæœï¼Œè€Œæ²¡æœ‰å¯¹Additional Passè¿›è¡Œä»»ä½•æ›´æ”¹ã€‚å¤§ä½“ä¸Šï¼ŒAdditional Passçš„é˜´å½±å¤„ç†å’ŒBase Passæ˜¯ä¸€æ ·çš„ã€‚æœ¬å°èŠ‚å®ç°çš„ä»£ç åªæ˜¯ä¸ºäº†è§£é‡Šå¦‚ä½•è®©ç‰©ä½“æ¥æ”¶é˜´å½±ï¼Œä¸å¯ä»¥ç›´æ¥ç”¨äºé¡¹ç›®ä¸­ã€‚æˆ‘ä»¬åœ¨æœ¬ç¯‡æ–‡ç« çš„æœ€åä¼šç»™å‡ºå®Œæ•´çš„åŒ…å«å…‰ç…§å¤„ç†çš„Unity Shader</p><h2 id="ä½¿ç”¨Frame-DebuggeræŸ¥çœ‹é˜´å½±çš„ç»˜åˆ¶è¿‡ç¨‹">ä½¿ç”¨Frame DebuggeræŸ¥çœ‹é˜´å½±çš„ç»˜åˆ¶è¿‡ç¨‹</h2><p>é€šè¿‡FrameDebuggerï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç»˜åˆ¶ä¸Šé¢çš„åœºæ™¯çš„æ¸²æŸ“äº‹ä»¶å¯ä»¥è¢«åˆ†æˆå››ä¸ªéƒ¨åˆ†ï¼šUpdateDepthTextureï¼Œå³æ›´æ–°æ‘„åƒæœºçš„æ·±åº¦çº¹ç†ï¼›RenderShadowmapï¼Œå³æ¸²æŸ“å¾—åˆ°å¹³è¡Œå…‰çš„é˜´å½±æ˜ å°„çº¹ç†ï¼›CollectShadowsï¼Œå³æ ¹æ®æ·±åº¦çº¹ç†å’Œé˜´å½±æ˜ å°„çº¹ç†å¾—åˆ°å±å¹•ç©ºé—´çš„é˜´å½±å›¾ï¼›æœ€åç»˜åˆ¶æ¸²æŸ“ç»“æœã€‚</p> <img src="/posts/e52a9ff3/image7.png" class=""><h2 id="ç»Ÿä¸€ç®¡ç†å…‰ç…§è¡°å‡å’Œé˜´å½±">ç»Ÿä¸€ç®¡ç†å…‰ç…§è¡°å‡å’Œé˜´å½±</h2><p>æˆ‘ä»¬å·²ç»è®²è¿‡å¦‚ä½•åœ¨Unity Shaderçš„å‰å‘æ¸²æŸ“è·¯å¾„ä¸­è®¡ç®—å…‰ç…§è¡°å‡â€”â€”åœ¨Base Passä¸­ï¼Œå¹³è¡Œå…‰çš„è¡°å‡å› å­æ€»æ˜¯ç­‰äº1ï¼Œè€Œåœ¨Additional Passä¸­ï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­è¯¥Passå¤„ç†çš„å…‰æºç±»å‹ï¼Œå†ä½¿ç”¨å†…ç½®å˜é‡å’Œå®å»è®¡ç®—è¡°å‡å› å­ã€‚å®é™…ä¸Šï¼Œå…‰ç…§è¡°å‡å’Œé˜´å½±å¯¹ç‰©ä½“æœ€ç»ˆçš„æ¸²æŸ“ç»“æœçš„å½±å“æœ¬è´¨ä¸Šæ˜¯ç›¸åŒçš„â€”â€”æˆ‘ä»¬éƒ½æ˜¯æŠŠå…‰ç…§è¡°å‡å› å­å’Œé˜´å½±å€¼åŠå…‰ç…§ç»“æœç›¸ä¹˜å¾—åˆ°æœ€ç»ˆçš„æ¸²æŸ“ç»“æœã€‚é‚£ä¹ˆï¼Œæ˜¯ä¸æ˜¯æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥åŒæ—¶è®¡ç®—ä¸¤ä¸ªä¿¡æ¯å‘¢ï¼Ÿåœ¨Unityä¸­è¿™ä¸ªåŠŸèƒ½ä¸»è¦æ˜¯é€šè¿‡å†…ç½®çš„<strong>UNITY_LIGHT_ATTENUATION</strong>å®æ¥å®ç°çš„ã€‚</p><p>å°½ç®¡ä¹‹å‰çš„Shaderä»£ç å·²ç»å¯ä»¥å¾—åˆ°æ­£ç¡®çš„é˜´å½±æ•ˆæœäº†ï¼Œä½†æ˜¯åœ¨å®è·µä¸­æˆ‘ä»¬é€šå¸¸è¿˜æ˜¯ä¼šä½¿ç”¨Unityçš„å†…ç½®å®å’Œå‡½æ•°åœ¨è®¡ç®—è¡°å‡å’Œé˜´å½±ï¼Œä»è€Œéšè—ä¸€äº›ç»†èŠ‚ã€‚</p><h2 id="é€æ˜åº¦ç‰©ä½“çš„é˜´å½±">é€æ˜åº¦ç‰©ä½“çš„é˜´å½±</h2><p>æˆ‘ä»¬ä»ä¸€å¼€å§‹å°±å¼ºè°ƒï¼Œæƒ³è¦åœ¨Unityä¸­è®©ç‰©ä½“èƒ½å¤Ÿå‘å…¶ä»–ç‰©ä½“æŠ•å°„é˜´å½±ï¼Œä¸€å®šè¦åœ¨å®ƒä½¿ç”¨çš„UnityShaderä¸­æä¾›ä¸€ä¸ªLightModeä¸ºShadowCasterçš„Passã€‚åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å†…ç½®çš„VertexLitä¸­æä¾›çš„ShadowCasteræ¥æŠ•å°„é˜´å½±ã€‚VertexLitä¸­çš„ShadowCasterå®ç°å¾ˆç®€å•ï¼Œå®ƒä¼šæ­£å¸¸æ¸²æŸ“æ•´ä¸ªç‰©ä½“ï¼Œç„¶åæŠŠæ·±åº¦ç»“æœè¾“å‡ºåˆ°ä¸€å¼ æ·±åº¦å›¾æˆ–é˜´å½±æ˜ å°„çº¹ç†ä¸­ã€‚</p><p>å¯¹äºå¤§å¤šæ•°ä¸é€æ˜çš„ç‰©ä½“æ¥è¯´ï¼ŒæŠŠFallbackè®¾ä¸ºVertexLitå°±å¯ä»¥å¾—åˆ°æ­£ç¡®çš„é˜´å½±ã€‚ä½†æ˜¯å¯¹äºé€æ˜ç‰©ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å°±éœ€è¦å°å¿ƒå¤„ç†å®ƒçš„é˜´å½±ã€‚é€æ˜ç‰©ä½“çš„å®ç°é€šå¸¸ä¼šä½¿ç”¨é€æ˜åº¦æµ‹è¯•æˆ–è€…é€æ˜åº¦æ··åˆï¼Œæˆ‘ä»¬éœ€è¦å°å¿ƒè®¾ç½®è¿™äº›ç‰©ä½“çš„Fallbackã€‚</p><p>é€æ˜åº¦æµ‹è¯•çš„å¤„ç†æ¯”è¾ƒç®€å•ï¼Œå¦‚æœæˆ‘ä»¬ä»ç„¶ç›´æ¥ä½¿ç”¨VertexLitã€Diffuseã€Specularç­‰ä½œä¸ºå›è°ƒï¼Œå¾€å¾€æ— æ³•å¾—åˆ°æ­£ç¡®çš„é˜´å½±ã€‚è¿™æ˜¯å› ä¸ºé€æ˜åº¦æµ‹è¯•éœ€è¦åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­èˆå¼ƒæŸäº›ç‰‡å…ƒï¼Œè€ŒVertexLitä¸­çš„é˜´å½±æŠ•å°„çº¹ç†æ²¡æœ‰è¿™æ ·çš„æ“ä½œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Unity Shader Book/Chapter 9/AlphaTestWithShadow&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Color (&quot;Main Tint&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _MainTex (&quot;Texture&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _Cutoff (&quot;Alpha Cutoff&quot;, Range(0,1)) = 0.5</span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">       Tags</span><br><span class="line">       &#123;</span><br><span class="line">           &quot;Queue&quot;=&quot;AlphaTest&quot;</span><br><span class="line">           &quot;IgnoreProjector&quot;=&quot;True&quot;</span><br><span class="line">           &quot;RenderType&quot;=&quot;TransparentCutout&quot;</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">       Pass</span><br><span class="line">       &#123;</span><br><span class="line">           Tags</span><br><span class="line">           &#123;</span><br><span class="line">               &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">           &#125;</span><br><span class="line">           </span><br><span class="line">           CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            #include &quot;Lighting.cginc&quot;</span><br><span class="line">            #include &quot;AutoLight.cginc&quot;</span><br><span class="line">            </span><br><span class="line">            fixed4 _Color;</span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line">            fixed _Cutoff;</span><br><span class="line"></span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">               float4 vertex : POSITION;</span><br><span class="line">               float3 normal : NORMAL;</span><br><span class="line">               float4 texcoord : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line">            </span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float3 worldNormal : TEXCOORD0;</span><br><span class="line">                float3 worldPos : TEXCOORD1;</span><br><span class="line">                float2 uv : TEXCOORD2;</span><br><span class="line">                SHADOW_COORDS(3)</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)&#123;</span><br><span class="line"></span><br><span class="line">                v2f o;</span><br><span class="line">                o.pos = mul(unity_MatrixMVP,v.vertex);</span><br><span class="line">                o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line">                o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;</span><br><span class="line">                o.uv = TRANSFORM_TEX(v.texcoord, _MainTex);</span><br><span class="line">                TRANSFER_SHADOW(o);</span><br><span class="line">                return o;                </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target&#123;</span><br><span class="line">                fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line">                fixed3 worldLightDir = normalize(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line"></span><br><span class="line">                fixed4 texColor = tex2D(_MainTex, i.uv);</span><br><span class="line"></span><br><span class="line">                clip(texColor.a - _Cutoff);</span><br><span class="line"></span><br><span class="line">                // if((texColor.a - _Cutoff) &lt; 0.0)</span><br><span class="line">                // &#123;</span><br><span class="line">                //     discard;</span><br><span class="line">                // &#125;</span><br><span class="line"></span><br><span class="line">                fixed3 albedo = texColor.rgb * _Color.rgb;</span><br><span class="line"></span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz * albedo;</span><br><span class="line"></span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * albedo * max(0, dot(worldNormal, worldLightDir));</span><br><span class="line"></span><br><span class="line">                UNITY_LIGHT_ATTENUATION(atten, i, i.worldPos);</span><br><span class="line"></span><br><span class="line">                return fixed4(ambient + diffuse * atten, 1.0);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">           ENDCG</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Fallback &quot;VertexLit&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸ºäº†è®©ä½¿ç”¨é€æ˜åº¦æµ‹è¯•çš„ç‰©ä½“å¾—åˆ°æ­£ç¡®çš„é˜´å½±æ•ˆæœï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨Unity Shaderä¸­æ›´æ”¹ä¸€è¡Œä»£ç ï¼Œå³æŠŠFallbackè®¾ç½®ä¸ºTransparent/Cutout/VertexLitï¼Œåœ¨è¿™ä¸ªShaderä»£ç ä¸­çš„ShadowCaster Passä¹Ÿè®¡ç®—äº†é€æ˜åº¦æµ‹è¯•ï¼Œå› æ­¤ä¼šæŠŠè£å‰ªåçš„ç‰©ä½“æ·±åº¦ä¿¡æ¯å†™å…¥æ·±åº¦å›¾å’Œé˜´å½±æ˜ å°„çº¹ç†ä¸­ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºTransparent/Cutout/VertexLitä¸­è®¡ç®—é€æ˜åº¦æµ‹è¯•æ—¶ï¼Œä½¿ç”¨äº†åä¸º_Cutoffçš„å±æ€§æ¥è¿›è¡Œé€æ˜åº¦æµ‹è¯•ï¼Œå› æ­¤ï¼Œè¿™å°±è¦æ±‚æˆ‘ä»¬çš„Shaderä¸­ä¹Ÿå¿…é¡»æä¾›åä¸º_Cutoffçš„å±æ€§ã€‚å¦åˆ™å°±æ— æ³•å¾—åˆ°æ­£ç¡®çš„é˜´å½±ç»“æœã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Unity Shader Book/Chapter 9/AlphaTestWithShadow&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Color (&quot;Main Tint&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _MainTex (&quot;Texture&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _Cutoff (&quot;Alpha Cutoff&quot;, Range(0,1)) = 0.5</span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">       Tags</span><br><span class="line">       &#123;</span><br><span class="line">           &quot;Queue&quot;=&quot;AlphaTest&quot;</span><br><span class="line">           &quot;IgnoreProjector&quot;=&quot;True&quot;</span><br><span class="line">           &quot;RenderType&quot;=&quot;TransparentCutout&quot;</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">       Pass</span><br><span class="line">       &#123;</span><br><span class="line">           Tags</span><br><span class="line">           &#123;</span><br><span class="line">               &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">           &#125;</span><br><span class="line">           </span><br><span class="line">           CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            #include &quot;Lighting.cginc&quot;</span><br><span class="line">            #include &quot;AutoLight.cginc&quot;</span><br><span class="line">            </span><br><span class="line">            fixed4 _Color;</span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line">            fixed _Cutoff;</span><br><span class="line"></span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">               float4 vertex : POSITION;</span><br><span class="line">               float3 normal : NORMAL;</span><br><span class="line">               float4 texcoord : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line">            </span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float3 worldNormal : TEXCOORD0;</span><br><span class="line">                float3 worldPos : TEXCOORD1;</span><br><span class="line">                float2 uv : TEXCOORD2;</span><br><span class="line">                SHADOW_COORDS(3)</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)&#123;</span><br><span class="line"></span><br><span class="line">                v2f o;</span><br><span class="line">                o.pos = mul(unity_MatrixMVP,v.vertex);</span><br><span class="line">                o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line">                o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;</span><br><span class="line">                o.uv = TRANSFORM_TEX(v.texcoord, _MainTex);</span><br><span class="line">                TRANSFER_SHADOW(o);</span><br><span class="line">                return o;                </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target&#123;</span><br><span class="line">                fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line">                fixed3 worldLightDir = normalize(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line"></span><br><span class="line">                fixed4 texColor = tex2D(_MainTex, i.uv);</span><br><span class="line"></span><br><span class="line">                clip(texColor.a - _Cutoff);</span><br><span class="line"></span><br><span class="line">                // if((texColor.a - _Cutoff) &lt; 0.0)</span><br><span class="line">                // &#123;</span><br><span class="line">                //     discard;</span><br><span class="line">                // &#125;</span><br><span class="line"></span><br><span class="line">                fixed3 albedo = texColor.rgb * _Color.rgb;</span><br><span class="line"></span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz * albedo;</span><br><span class="line"></span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * albedo * max(0, dot(worldNormal, worldLightDir));</span><br><span class="line"></span><br><span class="line">                UNITY_LIGHT_ATTENUATION(atten, i, i.worldPos);</span><br><span class="line"></span><br><span class="line">                return fixed4(ambient + diffuse * atten, 1.0);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">           ENDCG</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Fallback &quot;Transparent/Cutout/VertexLit&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œè¿™æ ·çš„ç»“æœä»ç„¶æœ‰äº›é—®é¢˜ï¼Œä¾‹å¦‚å‡ºç°äº†ä¸€äº›ä¸åº”è¯¥é€è¿‡å…‰çš„é—®é¢˜ã€‚å‡ºç°è¿™ç§æƒ…å†µçš„åŸå› æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹æŠŠç‰©ä½“æ¸²æŸ“åˆ°æ·±åº¦å›¾å’Œé˜´å½±æ˜ å°„çº¹ç†ä¸­ä»…è€ƒè™‘ç‰©ä½“çš„æ­£é¢ã€‚ä½†å¯¹äºæœ¬ä¾‹çš„æ­£æ–¹ä½“æ¥è¯´ï¼Œç”±äºä¸€äº›é¢å®Œå…¨èƒŒå¯¹å…‰æºï¼Œå› æ­¤è¿™äº›é¢çš„æ·±åº¦ä¿¡æ¯å¹¶æ²¡æœ‰åŠ å…¥åˆ°é˜´å½±æ˜ å°„çº¹ç†çš„è®¡ç®—ä¸­ã€‚ä¸ºäº†å¾—åˆ°æ­£ç¡®çš„ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥å°†æ­£æ–¹ä½“çš„MeshRendererç»„ä»¶ä¸­çš„CastShadowså±æ€§è®¾ç½®ä¸ºTwo Sidedï¼Œå¼ºåˆ¶Unityåœ¨è®¡ç®—é˜´å½±æ˜ å°„çº¹ç†æ—¶è®¡ç®—æ‰€æœ‰é¢çš„æ·±åº¦ä¿¡æ¯ã€‚</p><p>ä¸é€æ˜åº¦æµ‹è¯•çš„ç‰©ä½“ç›¸æ¯”ï¼Œæƒ³è¦ä¸ºä½¿ç”¨é€æ˜åº¦æ··åˆçš„ç‰©ä½“æ·»åŠ é˜´å½±æ˜¯ä¸€ä»¶æ¯”è¾ƒå¤æ‚çš„äº‹æƒ…ã€‚å®é™…ä¸Šï¼Œæ‰€æœ‰å†…ç½®çš„é€æ˜åº¦æ··åˆçš„UnityShaderï¼Œå¦‚Transparent/VertexLitç­‰ï¼Œéƒ½æ²¡æœ‰åŒ…å«é˜´å½±æŠ•å°„çš„Passï¼Œè¿™æ„å‘³ç€ï¼Œè¿™äº›åŠé€æ˜ç‰©ä½“ä¸ä¼šå‚ä¸æ·±åº¦å›¾å’Œé˜´å½±æ˜ å°„çº¹ç†è®¡ç®—ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬ä¸ä¼šå‘å…¶ä»–ç‰©ä½“æŠ•å°„é˜´å½±ï¼ŒåŒæ ·çš„ï¼Œå®ƒä»¬ä¹Ÿä¸ä¼šæ¥æ”¶æ¥è‡ªå…¶ä»–ç‰©ä½“çš„é˜´å½±ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">// Upgrade NOTE: replaced &#x27;mul(UNITY_MATRIX_MVP,*)&#x27; with &#x27;UnityObjectToClipPos(*)&#x27;</span><br><span class="line"></span><br><span class="line">Shader &quot;Shader Book/Chapter 9/AlphaBlendWithShadow&quot;</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Color (&quot;ColorTine&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _MainTex (&quot;MainTex&quot;, 2D) = &quot;white&quot;&#123;&#125;</span><br><span class="line">        _AlphaScale (&quot;AlphaScle&quot;, Range(0,1)) = 1</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Queue&quot;=&quot;Transparent&quot;</span><br><span class="line">            &quot;IgnoreProjector&quot;=&quot;True&quot;</span><br><span class="line">            &quot;RenderType&quot;=&quot;Transparent&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags&#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            Blend SrcAlpha OneMinusSrcAlpha</span><br><span class="line">            ZWrite Off</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            #include&quot;Lighting.cginc&quot;</span><br><span class="line">            #include&quot;AutoLight.cginc&quot;</span><br><span class="line">            </span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line">            fixed _AlphaScale;</span><br><span class="line">            fixed4 _Color;</span><br><span class="line"></span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                // å› ä¸ºéœ€è¦åšMVPå˜æ¢ éœ€è¦ä¸€ä¸ªå››ç»´çŸ©é˜µ</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">                float4 texcoord : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float3 worldNormal : TEXCOORD0;</span><br><span class="line">                float3 worldPos : TEXCOORD1;</span><br><span class="line">                float2 uv : TEXCOORD2;</span><br><span class="line">                SHADOW_COORDS(3)</span><br><span class="line">            &#125;;</span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">                o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line">                o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;</span><br><span class="line">                o.uv = TRANSFORM_TEX(v.texcoord, _MainTex);</span><br><span class="line">                TRANSFER_SHADOW(o)</span><br><span class="line">                </span><br><span class="line">                return o; </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line">                fixed3 worldLightDir = normalize(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line"></span><br><span class="line">                fixed4 texColor = tex2D(_MainTex, i.uv);</span><br><span class="line">                fixed3 albedo = texColor.rgb * _Color.rgb;</span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz * albedo;</span><br><span class="line">                UNITY_LIGHT_ATTENUATION(atten, i, i.worldPos);</span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * albedo * max(0, dot(worldNormal, worldLightDir));</span><br><span class="line"></span><br><span class="line">                return fixed4(ambient + diffuse * atten, texColor.a * _AlphaScale);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Fallback &quot;Transparent/VertexLit&quot;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Unityä¼šè¿™æ ·å¤„ç†åŠé€æ˜çš„ç‰©ä½“æ˜¯æœ‰å®ƒçš„åŸå› çš„ã€‚ç”±äºé€æ˜åº¦æ··åˆéœ€è¦å…³é—­æ·±åº¦å†™å…¥ï¼Œç”±æ­¤å¸¦æ¥çš„é—®é¢˜ä¹Ÿå½±å“äº†é˜´å½±çš„ç”Ÿæˆã€‚æ€»å°æ¥è¯´ï¼Œæƒ³è¦ä¸ºè¿™äº›åŠé€æ˜çš„ç‰©ä½“äº§ç”Ÿæ­£ç¡®çš„é˜´å½±ï¼Œéœ€è¦åœ¨æ¯ä¸ªå…‰æºç©ºé—´ä¸‹ä¸¥æ ¼æŒ‰ç…§ä»åå¾€å‰çš„é¡ºåºè¿›è¡Œæ¸²æŸ“ï¼Œè¿™ä¼šè®©é˜´å½±å¤„ç†å˜å¾—ååˆ†å¤æ‚ï¼Œè€Œä¸”ä¹Ÿä¼šå½±å“æ€§èƒ½ã€‚å› æ­¤ï¼Œåœ¨Unityä¸­ï¼Œæ‰€æœ‰çš„åŠé€æ˜Shaderéƒ½æ˜¯ä¸ä¼šäº§ç”Ÿä»»ä½•é˜´å½±æ•ˆæœçš„ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›dirty trickæ¥å¼ºåˆ¶ä¸ºåŠé€æ˜çš„ç‰©ä½“ç”Ÿæˆé˜´å½±ï¼Œè¿™å¯ä»¥é€šè¿‡æŠŠå®ƒä»¬çš„Fallbackè®¾ç½®ä¸ºVertexLitã€Diffuseè¿™äº›ä¸é€æ˜ç‰©ä½“ä½¿ç”¨çš„UnityShaderï¼Œè¿™æ ·Unityå°±ä¼šåœ¨å®ƒä»¬çš„Fallbackä¸Šæ‰¾åˆ°ä¸€ä¸ªé˜´å½±æŠ•å°„çš„Passã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç‰©ä½“çš„Mesh Rendererç»„ä»¶ä¸Šçš„Cast Shadowså’ŒReveive Shadowsé€‰é¡¹æ¥æ§åˆ¶æ—¶å€™éœ€è¦å‘å…¶ä»–ç‰©ä½“æŠ•å°„æˆ–æ¥æ”¶é˜´å½±ã€‚å¦‚ä¸‹å›¾ï¼Œå¯ä»¥çœ‹å‡ºï¼Œæ­¤æ—¶å³ä¾§å¹³é¢çš„é˜´å½±æŠ•å°„åˆ°äº†åŠé€æ˜çš„ç«‹æ–¹ä½“ä¸Šï¼Œä½†æ˜¯å®ƒä¸ä¼šå†ç©¿é€ç«‹æ–¹ä½“æŠŠé˜´å½±æŠ•å°„åˆ°ä¸‹æ–¹çš„å¹³é¢ä¸Šï¼Œè¿™å…¶å®æ˜¯ä¸å¯¹çš„ã€‚åŒæ—¶ï¼Œç«‹æ–¹ä½“ä¹Ÿå¯ä»¥æŠŠè‡ªèº«çš„é˜´å½±æŠ•å°„åœ¨ä¸‹é¢çš„å¹³é¢ä¸Šã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">// Upgrade NOTE: replaced &#x27;mul(UNITY_MATRIX_MVP,*)&#x27; with &#x27;UnityObjectToClipPos(*)&#x27;</span><br><span class="line"></span><br><span class="line">Shader &quot;Shader Book/Chapter 9/AlphaBlendWithShadow&quot;</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Color (&quot;ColorTine&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _MainTex (&quot;MainTex&quot;, 2D) = &quot;white&quot;&#123;&#125;</span><br><span class="line">        _AlphaScale (&quot;AlphaScle&quot;, Range(0,1)) = 1</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Queue&quot;=&quot;Transparent&quot;</span><br><span class="line">            &quot;IgnoreProjector&quot;=&quot;True&quot;</span><br><span class="line">            &quot;RenderType&quot;=&quot;Transparent&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags&#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            Blend SrcAlpha OneMinusSrcAlpha</span><br><span class="line">            ZWrite Off</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            #include&quot;Lighting.cginc&quot;</span><br><span class="line">            #include&quot;AutoLight.cginc&quot;</span><br><span class="line">            </span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line">            fixed _AlphaScale;</span><br><span class="line">            fixed4 _Color;</span><br><span class="line"></span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                // å› ä¸ºéœ€è¦åšMVPå˜æ¢ éœ€è¦ä¸€ä¸ªå››ç»´çŸ©é˜µ</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">                float4 texcoord : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float3 worldNormal : TEXCOORD0;</span><br><span class="line">                float3 worldPos : TEXCOORD1;</span><br><span class="line">                float2 uv : TEXCOORD2;</span><br><span class="line">                SHADOW_COORDS(3)</span><br><span class="line">            &#125;;</span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">                o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line">                o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;</span><br><span class="line">                o.uv = TRANSFORM_TEX(v.texcoord, _MainTex);</span><br><span class="line">                TRANSFER_SHADOW(o)</span><br><span class="line">                </span><br><span class="line">                return o; </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line">                fixed3 worldLightDir = normalize(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line"></span><br><span class="line">                fixed4 texColor = tex2D(_MainTex, i.uv);</span><br><span class="line">                fixed3 albedo = texColor.rgb * _Color.rgb;</span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz * albedo;</span><br><span class="line">                UNITY_LIGHT_ATTENUATION(atten, i, i.worldPos);</span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * albedo * max(0, dot(worldNormal, worldLightDir));</span><br><span class="line"></span><br><span class="line">                return fixed4(ambient + diffuse * atten, texColor.a * _AlphaScale);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Fallback &quot;VertexLit&quot;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ ‡å‡†çš„Unity-Shader">æ ‡å‡†çš„Unity Shader</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br></pre></td></tr></table></figure><pre><code></code></pre>]]></content>
      
      
      <categories>
          
          <category> UnityShader </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity </tag>
            
            <tag> Shader </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UnityShaderå…¥é—¨ç²¾è¦ç¬”è®°ï¼ˆå…«ï¼‰â€”â€”é€æ˜æ•ˆæœ</title>
      <link href="/posts/b4321fd8/"/>
      <url>/posts/b4321fd8/</url>
      
        <content type="html"><![CDATA[<p>Unityä¸­å®ç°é€æ˜æ•ˆæœæœ‰ä¸¤ç§æ–¹å¼ï¼Œé€æ˜åº¦æµ‹è¯•(Alpha Test)å’Œé€æ˜åº¦æ··åˆ(Alpha Blend)</p><h1>æ¸²æŸ“é¡ºåºå¾ˆé‡è¦</h1><p>åœ¨ä½¿ç”¨é€æ˜åº¦æ··åˆæŠ€æœ¯çš„æ—¶å€™éœ€è¦å…³é—­æ·±åº¦å†™å…¥ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœä¸å…³é—­æ·±åº¦å†™å…¥çš„è¯ï¼Œä¸€ä¸ªåŠé€æ˜çš„ç‰©ä½“è¡¨é¢èƒŒåçš„è¡¨é¢æœ¬æ¥æ˜¯å¯ä»¥é€è¿‡å®ƒè¢«æˆ‘ä»¬çœ‹åˆ°çš„ï¼Œä½†æ˜¯ç”±äºæ·±åº¦æµ‹è¯•æ—¶åˆ¤æ–­ç»“æœæ—¶è¯¥åŠé€æ˜è¡¨é¢è·ç¦»æ‘„åƒæœºæ›´è¿‘ï¼Œå¯¼è‡´åé¢çš„è¡¨é¢å°†ä¼šè¢«å‰”é™¤ï¼Œæˆ‘ä»¬ä¹Ÿå°±æ— æ³•é€šè¿‡åŠé€æ˜è¡¨é¢çœ‹åˆ°åé¢çš„ç‰©ä½“äº†ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ç”±æ­¤ä¹Ÿç ´åäº†æ·±åº¦ç¼“å†²çš„å·¥ä½œæœºåˆ¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆç³Ÿç³•çš„äº‹æƒ…ï¼Œå°½ç®¡æˆ‘ä»¬ä¸å¾—ä¸è¿™æ ·åšã€‚</p><p>æ¸²æŸ“å¼•æ“ä¸€èˆ¬éƒ½ä¼šå…ˆå¯¹ç‰©ä½“è¿›è¡Œæ’åºï¼Œå†æ¸²æŸ“ã€‚å¸¸ç”¨çš„æ–¹æ³•æ˜¯ï¼š</p><ol><li>å…ˆæ¸²æŸ“æ‰€æœ‰ä¸é€æ˜çš„ç‰©ä½“ï¼Œå¹¶ä¸”å¼€å¯å®ƒä»¬çš„æ·±åº¦æµ‹è¯•å’Œæ·±åº¦å†™å…¥</li><li>æŠŠåŠé€æ˜ç‰©ä½“æŒ‰ç…§å®ƒä»¬è·ç¦»æ‘„åƒæœºçš„è¿œè¿‘è¿›è¡Œæ’åºï¼Œç„¶åæŒ‰ç…§ä»åå¾€å‰çš„é¡ºåºæ¸²æŸ“é€æ˜ç‰©ä½“ï¼Œå¹¶å¼€å¯å®ƒä»¬çš„æ·±åº¦æµ‹è¯•ï¼Œä½†å…³é—­æ·±åº¦å†™å…¥ã€‚</li></ol><p>ä¸ºäº†å‡å°‘é”™è¯¯æ’åºçš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥å°½å¯èƒ½è®©æ¨¡å‹æ˜¯å‡¸é¢ä½“ã€‚å¹¶ä¸”è€ƒè™‘å°†å¤æ‚çš„æ¨¡å‹æ‹†æˆå¯ä»¥ç‹¬ç«‹æ’åºçš„å­æ¨¡å‹ç­‰ã€‚å…¶å®å°±ç®—æ’åºé”™è¯¯ç»“æœæœ‰æ—¶ä¹Ÿä¸ä¼šéå¸¸ç³Ÿç³•ï¼Œå¦‚æœæˆ‘ä»¬ä¸æƒ³åˆ†å‰²ç½‘æ ¼ï¼Œå¯ä»¥è¯•ç€è®©é€æ˜é€šé“æ›´åŠ æŸ”å’Œï¼Œä½¿ç©¿æ’çœ‹èµ·æ¥å¹¶ä¸æ˜¯é‚£ä¹ˆæ˜æ˜¾ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å¼€å¯äº†æ·±åº¦å†™å…¥çš„åŠé€æ˜æ•ˆæœæ¥è¿‘ä¼¼æ¨¡æ‹Ÿç‰©ä½“çš„åŠé€æ˜ã€‚</p><h1>é€æ˜åº¦æµ‹è¯•</h1><p>é€æ˜åº¦æµ‹è¯•çš„åŸç†æ˜¯ï¼šç»™å®šä¸€ä¸ªé€æ˜åº¦é˜ˆå€¼ï¼Œå½“ç‰‡å…ƒçš„é€æ˜åº¦ä½äºè¿™ä¸ªå€¼çš„æ—¶å€™ï¼Œç›´æ¥èˆå¼ƒè¯¥ç‰‡å…ƒã€‚<br>è¿™ç§æ–¹å¼è™½ç„¶ç®€å•ï¼Œä½†æ˜¯æ— æ³•å®ç°çœŸæ­£çš„åŠé€æ˜æ•ˆæœï¼Œè¦ä¹ˆæ˜¯å®Œå…¨é€æ˜çš„ï¼Œä»€ä¹ˆä¹Ÿçœ‹ä¸åˆ°ï¼›è¦ä¹ˆæ˜¯å®Œå…¨ä¸é€æ˜çš„ï¼Œå°±åƒä¸é€æ˜çš„ç‰©ä½“ä¸€æ ·ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Unity Shader Book/Chapter 8/Alpha Test&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties&#123;</span><br><span class="line">        //</span><br><span class="line">        _MainTex (&quot;MainTex&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        //</span><br><span class="line">        _Color (&quot;MainTint&quot;, Color) = (1,1,1,1)</span><br><span class="line">        </span><br><span class="line">        // é˜ˆå€¼ï¼Œ</span><br><span class="line">        _Cutoff (&quot;Cutoff&quot;, Range(0,1)) = 0.5</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    SubShader&#123;</span><br><span class="line"></span><br><span class="line">        Tags&#123;</span><br><span class="line">            &quot;Queue&quot;=&quot;AlphaTest&quot;</span><br><span class="line">            &quot;IgnoreProjector&quot;=&quot;True&quot;</span><br><span class="line">            &quot;RenderType&quot;=&quot;TransparentCutout&quot;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Pass&#123;</span><br><span class="line">            Tags&#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            CGPROGRAM</span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰çš„ç‰‡å…ƒç€è‰²å™¨æ–¹æ³•çš„è¿”å›å€¼éƒ½æ˜¯fixed4çš„ï¼Œå®ƒä»£è¡¨çš„å°±æ˜¯è¾“å‡ºåˆ°å±å¹•ä¸Šçš„æ¯ä¸ªåƒç´ çš„é¢œè‰²ï¼Œ</p><h1>é€æ˜åº¦æ··åˆ</h1><p>é€æ˜åº¦æ··åˆçš„åŸç†æ˜¯ï¼šå®ƒä¼šä½¿ç”¨å½“å‰ç‰‡å…ƒçš„é€æ˜åº¦ä½œä¸ºæ··åˆå› å­ï¼Œä¸å·²ç»å­˜å‚¨åœ¨é¢œè‰²ç¼“å†²ä¸­çš„é¢œè‰²å€¼è¿›è¡Œæ··åˆï¼Œå¾—åˆ°æ–°çš„é¢œè‰²ã€‚ä½†æ˜¯é€æ˜åº¦æ··åˆå…³é—­äº†æ·±åº¦å†™å…¥ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬éœ€è¦ååˆ†å°å¿ƒç‰©ä½“çš„æ¸²æŸ“é¡ºåºã€‚è¿™ç§æ–¹æ³•å¯ä»¥å¾—åˆ°çœŸæ­£çš„åŠé€æ˜æ•ˆæœã€‚</p><p>ä¸ºäº†è¿›è¡Œæ··åˆï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨Unityæä¾›çš„æ··åˆå‘½ä»¤â€”â€”Blendï¼ŒBlendæ˜¯Unityæä¾›çš„è®¾ç½®æ··åˆçš„å‘½ä»¤ã€‚æƒ³è¦å®ç°åŠé€æ˜çš„æ•ˆæœå°±éœ€è¦æŠŠå½“å‰è‡ªèº«çš„é¢œè‰²å’Œå·²ç»å­˜åœ¨äºé¢œè‰²ç¼“å†²ä¸­çš„é¢œè‰²å€¼è¿›è¡Œæ··åˆï¼Œæ··åˆæ—¶ä½¿ç”¨çš„å‡½æ•°å°±æ˜¯ç”±è¯¥æŒ‡ä»¤å†³å®šçš„ã€‚ä¸‹è¡¨ç»™å‡ºäº†Blendå‘½ä»¤çš„è¯­ä¹‰ï¼š</p><p>ä¸¤ä¸ªé€æ˜ç‰©ä½“çš„æ¸²æŸ“é¡ºåºä¹Ÿå¾ˆé‡è¦</p><p>Aå’ŒBä¸¤ä¸ªç‰©ä½“ï¼Œå¦‚æœè°å…ˆæ¸²æŸ“ï¼Œæœ€ç»ˆæ˜¾ç¤ºåœ¨å±å¹•ä¸Šçœ‹èµ·æ¥å°±æ˜¯è°è¢«æŒ¡åœ¨äº†åé¢ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ··åˆæ“ä½œçš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</p><table><thead><tr><th>è¯­ä¹‰</th><th>æè¿°</th></tr></thead><tbody><tr><td>BlendOff</td><td>å…³é—­æ··åˆ</td></tr><tr><td>Blend SrcFactor DstFactor</td><td>å¼€å¯æ··åˆï¼Œå¹¶è®¾ç½®æ··åˆå› å­ã€‚æºé¢œè‰²ï¼ˆè¯¥ç‰‡å…ƒäº§ç”Ÿçš„é¢œè‰²ï¼‰ä¼šä¹˜ä»¥SrcFactorï¼Œè€Œç›®æ ‡é¢œè‰²ï¼ˆå·²ç»å­˜åœ¨äºé¢œè‰²ç¼“å†²ä¸­çš„é¢œè‰²ï¼‰ä¼šä¹˜ä»¥DstFactorï¼Œç„¶åæŠŠä¸¤è€…ç›¸åŠ åå†å­˜å…¥é¢œè‰²ç¼“å†²ä¸­</td></tr><tr><td>Blend SrcFactor DstFactor SrcFactorA DstFactorA</td><td>å’Œä¸Šé¢å‡ ä¹ä¸€æ · åªæ˜¯ä½¿ç”¨äº†ä¸åŒçš„æ··åˆå› å­æ¥æ··åˆé€æ˜é€šé“</td></tr><tr><td>BlendOp BlendOperation</td><td>å¹¶éæ˜¯æŠŠæºé¢œè‰²å’Œç›®æ ‡é¢œè‰²ç®€å•ç›¸åŠ åæ··åˆï¼Œè€Œæ˜¯ä½¿ç”¨BlendOperationå¯¹ä»–ä»¬è¿›è¡Œå…¶ä»–æ“ä½œ</td></tr></tbody></table><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ä¸Šè¡¨ä¸­çš„ç¬¬äºŒç§è¯­ä¹‰ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¼šæŠŠæºé¢œè‰²çš„æ··åˆå› å­SrcFactorè®¾ç½®æˆSrcAlphaï¼Œè€Œç›®æ ‡é¢œè‰²çš„æ··åˆå› å­DstFactorè®¾ç½®ä¸ºOneMinusSrcAlphaã€‚è¿™æ„å‘³ç€ï¼Œç»è¿‡æ··åˆåçš„æ–°é¢œè‰²æ˜¯ï¼š<br>$$DstColor_{new} = SrcAlpha \times SrcColor + (1 - SrcAlpha) \times DstColor_{old}$$</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">// Upgrade NOTE: replaced &#x27;mul(UNITY_MATRIX_MVP,*)&#x27; with &#x27;UnityObjectToClipPos(*)&#x27;</span><br><span class="line"></span><br><span class="line">Shader &quot;Shader Book/Chapter 8/AlphaBlend&quot;</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Color (&quot;ColorTine&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _MainTex (&quot;MainTex&quot;, 2D) = &quot;white&quot;&#123;&#125;</span><br><span class="line">        _AlphaScale (&quot;AlphaScle&quot;, Range(0,1)) = 1</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Queue&quot;=&quot;Transparent&quot;</span><br><span class="line">            &quot;IgnoreProjector&quot;=&quot;True&quot;</span><br><span class="line">            &quot;RenderType&quot;=&quot;Transparent&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags&#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            Blend SrcAlpha OneMinusSrcAlpha</span><br><span class="line">            ZWrite Off</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            #include&quot;Lighting.cginc&quot;</span><br><span class="line"></span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line">            fixed _AlphaScale;</span><br><span class="line">            fixed4 _Color;</span><br><span class="line"></span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                // å› ä¸ºéœ€è¦åšMVPå˜æ¢ éœ€è¦ä¸€ä¸ªå››ç»´çŸ©é˜µ</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">                float4 texcoord : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float3 worldNormal : TEXCOORD0;</span><br><span class="line">                float3 worldPos : TEXCOORD1;</span><br><span class="line">                float2 uv : TEXCOORD2;</span><br><span class="line">            &#125;;</span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">                o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line">                o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;</span><br><span class="line">                o.uv = TRANSFORM_TEX(v.texcoord, _MainTex);</span><br><span class="line">                </span><br><span class="line">                return o; </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line">                fixed3 worldLightDir = normalize(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line"></span><br><span class="line">                fixed4 texColor = tex2D(_MainTex, i.uv);</span><br><span class="line">                fixed3 albedo = texColor.rgb * _Color.rgb;</span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz * albedo;</span><br><span class="line">                </span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * albedo * max(0, dot(worldNormal, worldLightDir));</span><br><span class="line"></span><br><span class="line">                return fixed4(ambient + diffuse, texColor.a * _AlphaScale);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Fallback &quot;Transparent/VertexLit&quot;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å‰é¢æåˆ°äº†å…³é—­æ·±åº¦å†™å…¥å¸¦æ¥çš„ç§ç§é—®é¢˜ï¼Œå½“æ¨¡å‹æœ¬èº«æœ‰ååˆ†å¤æ‚çš„é®æŒ¡å…³ç³»æˆ–è€…æ˜¯åŒ…å«äº†å¤æ‚çš„éå‡¸ç½‘æ ¼çš„æ—¶å€™ï¼Œå°±ä¼šæœ‰å„ç§å› ä¸ºæ’åºé”™è¯¯è€Œäº§ç”Ÿçš„é”™è¯¯çš„é€æ˜æ•ˆæœã€‚</p><p>å› æ­¤æˆ‘ä»¬éœ€è¦æƒ³åŠæ³•é‡æ–°åˆ©ç”¨æ·±åº¦å†™å…¥ï¼Œè®©æ¨¡å‹å¯ä»¥åƒåŠé€æ˜ç‰©ä½“ä¸€æ ·æ·¡å…¥æ·¡å‡ºã€‚</p><h1>å¼€å¯æ·±åº¦å†™å…¥çš„åŠé€æ˜æ•ˆæœ</h1><p>ä¸Šä¸€å°ç»“æœ€åæˆ‘ä»¬æåˆ°äº†ç”±äºå…³é—­æ·±åº¦å†™å…¥è€Œå¯¼è‡´é”™è¯¯æ’åºçš„æƒ…å†µã€‚ä¸€ç§è§£å†³æ–¹æ³•æ˜¯<strong>ä½¿ç”¨ä¸¤ä¸ªPass</strong>æ¥æ¸²æŸ“æ¨¡å‹ï¼šç¬¬ä¸€ä¸ªPasså¼€å¯æ·±åº¦å†™å…¥ï¼Œä½†æ˜¯ä¸è¾“å‡ºé¢œè‰²ï¼Œå®ƒçš„ç›®çš„ä»…ä»…æ˜¯æŠŠæ¨¡å‹çš„æ·±åº¦å€¼å†™å…¥æ·±åº¦ç¼“å†²ä¸­ï¼›ç¬¬äºŒä¸ªPassè¿›è¡Œæ­£å¸¸çš„é€æ˜åº¦æ··åˆï¼Œç”±äºä¸Šä¸€ä¸ªPasså·²ç»å¾—åˆ°äº†é€åƒç´ çš„æ­£ç¡®æ·±åº¦ä¿¡æ¯ï¼Œè¯¥Passå°±å¯ä»¥æŒ‰ç…§é€åƒç´ çº§åˆ«çš„æ·±åº¦æ’åºç»“æœè¿›è¡Œé€æ˜æ¸²æŸ“ã€‚ä½†è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹å°±æ˜¯ä¼šå¯¹æ€§èƒ½é€ æˆä¸€å®šçš„å¼€é”€ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥å®ç°æ¨¡å‹ä¸å®ƒåé¢çš„èƒŒæ™¯çš„æ··åˆæ•ˆæœï¼Œä½†æ˜¯æ¨¡å‹å†…éƒ¨ä¹‹é—´ä¸ä¼šæœ‰ä»»ä½•çœŸæ­£çš„åŠé€æ˜æ•ˆæœã€‚</p><p>æœ¬èŠ‚ä½¿ç”¨çš„Shaderä»£ç å’Œä¸Šä¸€èŠ‚ä¸­çš„ä»£ç å‡ ä¹ä¸€æ ·ï¼Œåªæ˜¯åœ¨Passå‰é¢æ–°æ·»åŠ ä¸€ä¸ªPassï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">// Upgrade NOTE: replaced &#x27;mul(UNITY_MATRIX_MVP,*)&#x27; with &#x27;UnityObjectToClipPos(*)&#x27;</span><br><span class="line"></span><br><span class="line">Shader &quot;Shader Book/Chapter 8/AlphaBlendZWrite&quot;</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Color (&quot;ColorTine&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _MainTex (&quot;MainTex&quot;, 2D) = &quot;white&quot;&#123;&#125;</span><br><span class="line">        _AlphaScale (&quot;AlphaScle&quot;, Range(0,1)) = 1</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Queue&quot;=&quot;Transparent&quot;</span><br><span class="line">            &quot;IgnoreProjector&quot;=&quot;True&quot;</span><br><span class="line">            &quot;RenderType&quot;=&quot;Transparent&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            ColorMask 0</span><br><span class="line">            ZWrite On</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags&#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            Blend SrcAlpha OneMinusSrcAlpha</span><br><span class="line">            ZWrite Off</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            #include&quot;Lighting.cginc&quot;</span><br><span class="line"></span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line">            fixed _AlphaScale;</span><br><span class="line">            fixed4 _Color;</span><br><span class="line"></span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                // å› ä¸ºéœ€è¦åšMVPå˜æ¢ éœ€è¦ä¸€ä¸ªå››ç»´çŸ©é˜µ</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">                float4 texcoord : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float3 worldNormal : TEXCOORD0;</span><br><span class="line">                float3 worldPos : TEXCOORD1;</span><br><span class="line">                float2 uv : TEXCOORD2;</span><br><span class="line">            &#125;;</span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">                o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line">                o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;</span><br><span class="line">                o.uv = TRANSFORM_TEX(v.texcoord, _MainTex);</span><br><span class="line">                </span><br><span class="line">                return o; </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line">                fixed3 worldLightDir = normalize(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line"></span><br><span class="line">                fixed4 texColor = tex2D(_MainTex, i.uv);</span><br><span class="line">                fixed3 albedo = texColor.rgb * _Color.rgb;</span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz * albedo;</span><br><span class="line">                </span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * albedo * max(0, dot(worldNormal, worldLightDir));</span><br><span class="line"></span><br><span class="line">                return fixed4(ambient + diffuse, texColor.a * _AlphaScale);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Fallback &quot;Transparent/VertexLit&quot;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–°æ·»åŠ çš„Passçš„ç›®çš„ä»…ä»…æ˜¯ä¸ºäº†æŠŠæ¨¡å‹çš„æ·±åº¦ä¿¡æ¯å†™å…¥æ·±åº¦ç¼“å†²ä¸­ï¼Œä»è€Œå‰”é™¤æ¨¡å‹ä¸­è¢«è‡ªèº«é®æŒ¡çš„ç‰‡å…ƒã€‚å› æ­¤ï¼ŒPassçš„ç¬¬ä¸€è¡Œå¼€å¯äº†æ·±åº¦å†™å…¥ã€‚åœ¨ç¬¬äºŒè¡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªæ–°çš„æ¸²æŸ“å‘½ä»¤â€”â€”<strong>ColorMask</strong>ï¼Œåœ¨ShaderLabä¸­ï¼ŒColorMaskç”¨äºè®¾ç½®é¢œè‰²é€šé“çš„å†™æ©ç ï¼ˆwrite maskï¼‰ï¼Œå®ƒçš„è¯­ä¹‰å¦‚ä¸‹ï¼š<br>ColorMask RGB | A | 0 | å…¶ä»–ä»»ä½•Rã€Gã€Bã€Açš„ç»„åˆ<br>å½“ColorMaskè®¾ç½®ä¸º0æ—¶ï¼Œæ„å‘³ç€è¯¥Passä¸å†™å…¥ä»»ä½•é¢œè‰²é€šé“ï¼Œå³ä¸ä¼šè¾“å‡ºä»»ä½•é¢œè‰²ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬éœ€è¦çš„â€”â€”è¯¥Passåªéœ€è¦å†™å…¥æ·±åº¦ç¼“å­˜å³å¯ã€‚</p><h1>ShaderLabçš„æ··åˆå‘½ä»¤</h1><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹æ··åˆæ˜¯å¦‚ä½•å®ç°çš„ã€‚å½“ç‰‡å…ƒç€è‰²å™¨äº§ç”Ÿä¸€ä¸ªé¢œè‰²çš„æ—¶å€™ï¼Œå¯ä»¥é€‰æ‹©ä¸é¢œè‰²ç¼“å­˜ä¸­çš„é¢œè‰²è¿›è¡Œæ··åˆï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ··åˆå°±å’Œä¸¤ä¸ªæ“ä½œæ•°æœ‰å…³ï¼šæºé¢œè‰²ï¼ˆSource Colorï¼‰å’Œç›®æ ‡é¢œè‰²ï¼ˆDestination Colorï¼‰ï¼Œæºé¢œè‰²æˆ‘ä»¬ç”¨<strong>S</strong>æ¥è¡¨ç¤ºï¼ŒæŒ‡çš„æ˜¯ç”±ç‰‡å…ƒç€è‰²å™¨äº§ç”Ÿçš„é¢œè‰²å€¼ï¼›ç›®æ ‡é¢œè‰²æˆ‘ä»¬ç”¨<strong>D</strong>æ¥è¡¨ç¤ºï¼ŒæŒ‡çš„æ˜¯ä»é¢œè‰²ç¼“å†²ä¸­è¯»å–åˆ°çš„é¢œè‰²å€¼ã€‚å¯¹å®ƒä»¬è¿›è¡Œæ··åˆåå¾—åˆ°çš„è¾“å‡ºé¢œè‰²ï¼Œæˆ‘ä»¬ç”¨<strong>O</strong>è¡¨ç¤ºï¼Œå®ƒä¼šé‡æ–°å†™å…¥é¢œè‰²ç¼“å†²ä¸­ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“æˆ‘ä»¬è°ˆåŠæ··åˆä¸­çš„æºé¢œè‰²ã€ç›®æ ‡é¢œè‰²å’Œè¾“å‡ºé¢œè‰²çš„æ—¶å€™ï¼Œå®ƒä»¬éƒ½åŒ…å«äº†RGBAå››ä¸ªé€šé“çš„å€¼ï¼Œè€Œå¹¶éRGBé€šé“ã€‚</p><h2 id="æ··åˆç­‰å¼å’Œå‚æ•°">æ··åˆç­‰å¼å’Œå‚æ•°</h2><p>åœ¨ä¹‹å‰çš„ç« èŠ‚ä¸­æˆ‘ä»¬æåˆ°è¿‡ï¼Œæ··åˆæ˜¯ä¸€ä¸ªé€ç‰‡å…ƒçš„æ“ä½œï¼Œè€Œä¸”å®ƒæ˜¯ä¸å¯ç¼–ç¨‹çš„ï¼Œä½†å´æ˜¯é«˜åº¦å¯é…ç½®çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®æ··åˆæ—¶ä½¿ç”¨çš„è¿ç®—æ“ä½œã€æ··åˆå› å­ç­‰æ¥å½±å“æ··åˆã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²çŸ¥ä¸¤ä¸ªæ“ä½œæ•°ï¼šæºé¢œè‰²Så’Œç›®æ ‡é¢œè‰²Dï¼Œæƒ³è¦å¾—è¾“å‡ºé¢œè‰²Oå°±å¿…é¡»ä½¿ç”¨ä¸€ä¸ªç­‰å¼æ¥è®¡ç®—ã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªç­‰å¼æˆä¸º<strong>æ··åˆç­‰å¼ï¼ˆblend equationï¼‰<strong>å½“è¿›è¡Œæ··åˆæ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ä¸ªæ··åˆç­‰å¼ï¼šä¸€ä¸ªç”¨äºæ··åˆRGBé€šé“ï¼Œä¸€ä¸ªç”¨äºæ··åˆAé€šé“ã€‚å½“è®¾ç½®æ··åˆçŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šè®¾ç½®çš„å°±æ˜¯æ··åˆç­‰å¼ä¸­çš„</strong>æ“ä½œ</strong>å’Œ<strong>å› å­</strong>ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ··åˆç­‰å¼ä½¿ç”¨çš„æ“ä½œéƒ½æ˜¯åŠ æ“ä½œï¼ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ“ä½œï¼‰ï¼Œæˆ‘ä»¬åªéœ€è¦å†è®¾ç½®ä¸€ä¸‹æ··åˆå› å­å³å¯ã€‚ç”±äºéœ€è¦ä¸¤ä¸ªç­‰å¼ï¼ˆåˆ†åˆ«ç”¨äºæ··åˆRGBé€šé“å’ŒAé€šé“ï¼‰ï¼Œæ¯ä¸ªç­‰å¼éƒ½æœ‰ä¸¤ä¸ªå› å­ï¼ˆä¸€ä¸ªç”¨äºå’Œæºé¢œè‰²ç›¸ä¹˜ï¼Œå¦ä¸€ä¸ªç”¨äºå’Œç›®æ ‡é¢œè‰²ç›¸ä¹˜ï¼‰ï¼Œå› æ­¤ä¸€å…±éœ€è¦å››ä¸ªå› å­ã€‚</p><table><thead><tr><th>è¯­ä¹‰</th><th>æè¿°</th></tr></thead><tbody><tr><td>Blend SrcFactor DstFactor</td><td>å¼€å¯æ··åˆï¼Œå¹¶è®¾ç½®æ··åˆå› å­ã€‚æºé¢œè‰²ï¼ˆè¯¥ç‰‡å…ƒäº§ç”Ÿçš„é¢œè‰²ï¼‰ä¼šä¹˜ä»¥SrcFactorï¼Œè€Œç›®æ ‡é¢œè‰²ï¼ˆå·²ç»å­˜åœ¨äºé¢œè‰²ç¼“å†²ä¸­çš„é¢œè‰²ï¼‰ä¼šä¹˜ä»¥DstFactorï¼Œç„¶åæŠŠä¸¤è€…ç›¸åŠ åå†å­˜å…¥é¢œè‰²ç¼“å†²ä¸­</td></tr><tr><td>Blend SrcFactor DstFactor SrcFactorA DstFactorA</td><td>å’Œä¸Šé¢å‡ ä¹ä¸€æ · åªæ˜¯ä½¿ç”¨äº†ä¸åŒçš„æ··åˆå› å­æ¥æ··åˆé€æ˜é€šé“</td></tr></tbody></table><p>å¯ä»¥å‘ç°ï¼Œä¸Šé¢è¿™ä¸ªè¡¨ä¸­çš„ç¬¬ä¸€ä¸ªè¯­ä¹‰åªæä¾›äº†ä¸¤ä¸ªå› å­ï¼Œè¿™æ„å‘³ç€å°†ä½¿ç”¨åŒæ ·çš„æ··åˆå› å­æ¥æ··åˆRGBé€šé“å’ŒAé€šé“ï¼Œå³æ­¤æ—¶SrcFactorAå°†ç­‰äºSrcFactorï¼ŒDstFactorAå°†ç­‰äºDstFactorã€‚ä¸‹é¢å°±æ˜¯ä½¿ç”¨è¿™äº›å› å­è¿›è¡ŒåŠ æ³•æ··åˆæ—¶çš„å…¬å¼ï¼š<br>$$ O_{rgb} = SrcFactor \times S_{rgb} + DstFactor \times D_{rgb} $$<br>$$ O_{a} = SrcFactor \times S_{a} + DstFactor \times D_{a} $$<br>ä¸‹è¡¨ç»™å‡ºäº†ShaderLabæ”¯æŒçš„æ··åˆå› å­</p><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>One</td><td>å› å­ä¸º1</td></tr><tr><td>Zero</td><td>å› å­ä¸º0</td></tr><tr><td>SrcColor</td><td>å› å­ä¸ºæºé¢œè‰²å€¼ï¼Œå½“ç”¨äºæ··åˆRGBçš„æ··åˆç­‰å¼æ—¶ï¼Œä½¿ç”¨SrcColorçš„RGBåˆ†é‡ä½œä¸ºæ··åˆå› å­ï¼›å½“ç”¨äºæ··åˆAçš„æ··åˆç­‰å¼æ—¶ï¼Œä½¿ç”¨SrcColorçš„Aåˆ†é‡ä½œä¸ºæ··åˆå› å­</td></tr><tr><td>SrcAlpha</td><td>æ··åˆå› å­ä¸ºæºé¢œè‰²çš„é€æ˜åº¦å€¼ï¼ˆAé€šé“ï¼‰</td></tr><tr><td>DstColor</td><td>å› å­ä¸ºç›®æ ‡é¢œè‰²å€¼ï¼Œå½“ç”¨äºæ··åˆRGBé€šé“ç­‰å¼æ—¶ï¼Œä½¿ç”¨DstColorçš„RGBåˆ†é‡ä½œä¸ºæ··åˆå› å­ï¼›å½“ç”¨äºæ··åˆAé€šé“çš„</td></tr><tr><td>DstAlpha</td><td>å› å­ä¸ºç›®æ ‡é¢œè‰²çš„é€æ˜åº¦å€¼ï¼ˆAé€šé“ï¼‰</td></tr><tr><td>DsrColor</td><td>å› å­ä¸ºç›®æ ‡é¢œè‰²å€¼ï¼Œå½“ç”¨äºæ··åˆRGBé€šé“çš„æ··åˆç­‰å¼æ—¶ï¼Œä½¿ç”¨ç»“æœçš„RGBåˆ†é‡ä½œä¸ºæ··åˆå› å­ï¼›å½“ç”¨äºæ··åˆAé€šé“çš„æ··åˆç­‰å¼æ—¶ï¼Œä½¿ç”¨DstColorçš„Aåˆ†é‡ä½œä¸ºæ··åˆå› å­</td></tr><tr><td>OneMinusSrcColor</td><td>å› å­ä¸º(1-æºé¢œè‰²)ï¼Œå½“ç”¨äºæ··åˆRGBçš„æ··åˆç­‰å¼æ—¶ï¼Œä½¿ç”¨ç»“æœçš„RGBåˆ†é‡ä½œä¸ºæ··åˆå› å­ï¼›å½“ç”¨äºæ··åˆAçš„æ··åˆç­‰å¼æ—¶ï¼Œä½¿ç”¨ç»“æœçš„Aåˆ†é‡ä½œä¸ºæ··åˆå› å­</td></tr><tr><td>OneMinusSrcAlpha</td><td>å› å­ä¸º(1-æºé¢œè‰²çš„é€æ˜åº¦å€¼)</td></tr><tr><td>OneMinusDstColor</td><td>å› å­ä¸º(1-ç›®æ ‡é¢œè‰²çš„é¢œè‰²å€¼)ã€‚å½“ç”¨äºæ··åˆRGBçš„æ··åˆç­‰å¼æ—¶ï¼Œä½¿ç”¨ç»“æœçš„RGBåˆ†é‡ä½œä¸ºæ··åˆå› å­ï¼›å½“ç”¨äºæ··åˆAçš„æ··åˆç­‰å¼æ—¶ï¼Œä½¿ç”¨ç»“æœçš„Aåˆ†é‡ä½œä¸ºæ··åˆå› å­</td></tr><tr><td>OneMinusDstAlpha</td><td>å› å­ä¸º(1-ç›®æ ‡é¢œè‰²çš„é€æ˜åº¦å€¼)</td></tr></tbody></table><h2 id="æ··åˆæ“ä½œ">æ··åˆæ“ä½œ</h2><p>åœ¨ä¸Šé¢æ¶‰åŠçš„æ··åˆç­‰å¼ä¸­ï¼Œå½“æŠŠæºé¢œè‰²å’Œç›®æ ‡é¢œè‰²ä¸å®ƒä»¬å¯¹åº”çš„æ··åˆå› å­ç›¸ä¹˜ä¹‹åï¼Œæˆ‘ä»¬éƒ½æ˜¯æŠŠå®ƒä»¬çš„ç»“æœç›¸åŠ èµ·æ¥ä½œä¸ºè¾“å‡ºé¢œè‰²çš„ã€‚é‚£ä¹ˆå¯ä¸å¯ä»¥é€‰æ‹©ä¸ä½¿ç”¨åŠ æ³•ï¼Œè€Œä½¿ç”¨å‡æ³•å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ShaderLabçš„<strong>BlendOp BlendOperation</strong>å‘½ä»¤ï¼Œå³æ··åˆæ“ä½œå‘½ä»¤ã€‚ä¸‹è¡¨ç»™å‡ºäº†ShaderLabä¸­æ”¯æŒçš„æ··åˆæ“ä½œ</p><table><thead><tr><th>æ“ä½œ</th><th>æè¿°</th></tr></thead><tbody><tr><td>Add</td><td>å°†æ··åˆåçš„æºé¢œè‰²å’Œç›®æ ‡é¢œè‰²ç›¸åŠ ã€‚é»˜è®¤çš„æ··åˆæ“ä½œã€‚ä½¿ç”¨çš„æ··åˆç­‰å¼æ˜¯ï¼š<br>$O_{rgb} = SrcFactor \times S_{rgb} + DstFactor \times D_{rgb}$ <br>$O_{a} = SrcFactorA \times DstFactorA$</td></tr><tr><td>Sub</td><td>ç”¨æ··åˆåçš„æºé¢œè‰²å‡å»æ··åˆåçš„ç›®æ ‡é¢œè‰²ã€‚ä½¿ç”¨çš„æ··åˆç­‰å¼æ˜¯ï¼š<br>$O_{rgb} = SrcFactor \times S_{rgb} - DstFactor \times D_{rgb}$ <br> $O_{a} = SrcFactorA \times S_{a} - DstFactorA \times D_{a}$</td></tr><tr><td>RevSub</td><td>ä½¿ç”¨æ··åˆåçš„ç›®æ ‡é¢œè‰²å‡å»æ··åˆåçš„æºé¢œè‰²ã€‚ä½¿ç”¨çš„æ··åˆç­‰å¼æ˜¯: <br> $O_{rgb} = DstFactor \times D_{rgb} - SrcFactor \times S_{rgb}$ <br>$O_{a} = DstFactorA \times D_{a} - SrcFactor \times S_{a}$</td></tr><tr><td>Min</td><td>ä½¿ç”¨æºé¢œè‰²å’Œç›®æ ‡é¢œè‰²ä¸­è¾ƒå°çš„å€¼ï¼Œæ˜¯é€åˆ†é‡æ¯”è¾ƒçš„ï¼Œä½¿ç”¨çš„æ··åˆç­‰å¼æ˜¯ï¼š<br> $O_{rgba} = (min(S_{r}, D{r}),min(S_{g}, D{g}),min(S_{b}, D{b}),min(S_{a}, D{a}))$</td></tr><tr><td>Max</td><td>ä½¿ç”¨æºé¢œè‰²å’Œç›®æ ‡é¢œè‰²ä¸­è¾ƒå¤§çš„å€¼ï¼Œæ˜¯é€åˆ†é‡æ¯”è¾ƒçš„ï¼Œä½¿ç”¨çš„æ··åˆç­‰å¼æ˜¯: <br> $O_{rgba} = (max(S_{r}, D{r}),max(S_{g}, D{g}),max(S_{b}, D{b}),max(S_{a}, D{a}))$</td></tr><tr><td>å…¶ä»–é€»è¾‘æ“ä½œ</td><td>åªåœ¨DirectX 11.1ä¸­æ”¯æŒ</td></tr></tbody></table><p>æ··åˆæ“ä½œå‘½ä»¤é€šå¸¸æ˜¯ä¸æ··åˆå› å­å‘½ä»¤ä¸€èµ·å·¥ä½œçš„ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä½¿ç”¨<strong>Min</strong>å’Œ<strong>Max</strong>æ··åˆæ“ä½œçš„æ—¶å€™ï¼Œæ··åˆå› å­å®é™…ä¸Šæ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œå®ƒä»¬ä»…ä¼šåˆ¤æ–­åŸå§‹çš„æºé¢œè‰²å’Œç›®æ ‡é¢œè‰²ä¹‹é—´çš„æ¯”è¾ƒç»“æœã€‚</p><h2 id="å¸¸è§çš„æ··åˆç±»å‹">å¸¸è§çš„æ··åˆç±»å‹</h2><p>é€šè¿‡æ··åˆæ“ä½œå’Œæ··åˆå› å­å‘½ä»¤çš„ç»„åˆï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€äº›ç±»ä¼¼PhotoShopæ··åˆæ¨¡å¼ä¸­çš„æ··åˆæ•ˆæœ</p><ul><li><p>æ­£å¸¸(Normal) å³é€æ˜åº¦æ··åˆ</p><p>Blend SrcAlpha OneMinusSrcAlpha</p></li><li><p>æŸ”å’Œç›¸åŠ (Soft Additive)</p><p>Blend OneMinusDstColor One</p></li><li><p>ä¸¤å€ç›¸ä¹˜(2x Multiply)</p><p>Blend DstColor SrcColor</p></li><li><p>å˜æš—(Darken)</p><p>BlendOp Min<br>Blend One One</p></li><li><p>å˜äº®(Lighting)</p><p>BlendOp Max<br>Blend One one</p></li><li><p>æ»¤è‰²(Screen)</p><p>Blend OneMinusDstColor One</p><p>// ç­‰åŒäº<br>Blend One OneMinusSrcColor</p></li><li><p>çº¿æ€§å‡æ·¡(Linear Doge)</p><p>Blend One one</p></li></ul><img src="/posts/b4321fd8/image.png" class="" title="alt text"><h1>åŒé¢æ¸²æŸ“çš„é€æ˜æ•ˆæœ</h1><p>åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œå¦‚æœä¸€ä¸ªç‰©ä½“æ˜¯é€æ˜çš„ï¼Œå› ä¸ºç€æˆ‘ä»¬ä¸ä»…å¯ä»¥æŠ•å“¦è¿‡å®ƒçœ‹åˆ°å…¶ä»–ç‰©ä½“çš„æ ·å­ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°å®ƒçš„å†…éƒ¨ç»“æ„ã€‚ä½†åœ¨å‰é¢å®ç°çš„é€æ˜æ•ˆæœä¸­ï¼Œæ— è®ºæ˜¯é€æ˜åº¦æµ‹è¯•è¿˜æ˜¯é€æ˜åº¦æ··åˆï¼Œæˆ‘ä»¬éƒ½æ— æ³•è§‚å¯Ÿåˆ°æ­£æ–¹ä½“å†…éƒ¨å’Œå…¶èƒŒé¢çš„å½¢çŠ¶ï¼Œå¯¼è‡´ç‰©ä½“çœ‹èµ·æ¥åªæœ‰åŠä¸ªä¸€æ ·ã€‚è¿™æ˜¯å› ä¸ºï¼Œé»˜è®¤æƒ…å†µä¸‹æ¸²æŸ“å¼•æ“å‰”é™¤äº†ç‰©ä½“èƒŒé¢(ç›¸å¯¹äºæ‘„åƒæœºæ–¹å‘)çš„æ¸²æŸ“å›¾å…ƒï¼Œè€Œåªæ¸²æŸ“äº†ç‰©ä½“çš„æ­£é¢ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦å¾—åˆ°åŒé¢æ¸²æŸ“çš„æ•ˆæœï¼Œå¯ä»¥ä½¿ç”¨CullæŒ‡ä»¤æ¥æ§åˆ¶éœ€è¦å‰”é™¤å“ªä¸ªé¢çš„æ¸²æŸ“å›¾å…ƒã€‚åœ¨Unityä¸­ï¼ŒCullæŒ‡ä»¤çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><blockquote><p>Cull Back | Front | Off</p></blockquote><p>å¦‚æœè®¾ç½®ä¸ºBackï¼Œé‚£ä¹ˆé‚£äº›èƒŒå¯¹ç€æ‘„åƒæœºçš„æ¸²æŸ“å›¾å…ƒå°±ä¸ä¼šè¢«æ¸²æŸ“ï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤æƒ…å†µä¸‹çš„å‰”é™¤çŠ¶æ€ï¼›å¦‚æœè®¾ç½®ä¸ºFrontï¼Œé‚£ä¹ˆé‚£äº›æœå‘æ‘„åƒæœºçš„æ¸²æŸ“å›¾å…ƒå°±ä¸ä¼šè¢«æ¸²æŸ“ï¼›å¦‚æœè®¾ç½®ä¸ºOffï¼Œå°±ä¼šå…³é—­å‰”é™¤åŠŸèƒ½ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„å›¾å…ƒéƒ½ä¼šè¢«æ¸²æŸ“ï¼Œä½†ç”±äºè¿™æ—¶éœ€è¦æ¸²æŸ“çš„å›¾å…ƒæ•°ç›®ä¼šæˆå€å¢åŠ ï¼Œå› æ­¤é™¤éæ˜¯ç”¨äºç‰¹æ®Šæ•ˆæœï¼Œä¾‹å¦‚è¿™é‡Œçš„åŒé¢æ¸²æŸ“çš„é€æ˜æ•ˆæœï¼Œé€šå¸¸æƒ…å†µä¸‹æ˜¯ä¸ä¼šå…³é—­å‰”é™¤åŠŸèƒ½çš„ã€‚</p><h2 id="span-id-1-é€æ˜åº¦æµ‹è¯•çš„åŒé¢æ¸²æŸ“-span"><span id = 1>é€æ˜åº¦æµ‹è¯•çš„åŒé¢æ¸²æŸ“</span></h2><p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€ä¸‹ï¼Œå¦‚ä½•è®©ä½¿ç”¨äº†é€æ˜åº¦æµ‹è¯•çš„ç‰©ä½“å®ç°åŒé¢æ¸²æŸ“çš„æ•ˆæœï¼Œè¿™éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨Passçš„æ¸²æŸ“è®¾ç½®ä¸­ä½¿ç”¨CullæŒ‡ä»¤æ¥å…³é—­å‰”é™¤å³å¯ã€‚å› æ­¤æ‹·è´AlphaTestå°èŠ‚éƒ¨åˆ†çš„ä»£ç ï¼Œå¹¶åŠ å…¥<code>Cull off</code>:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Unity Shader Book/Chapter 8/AlphaTestBothSides&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Color (&quot;Main Tint&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _MainTex (&quot;Texture&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _Cutoff (&quot;Alpha Cutoff&quot;, Range(0,1)) = 0.5</span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">       Tags</span><br><span class="line">       &#123;</span><br><span class="line">           &quot;Queue&quot;=&quot;AlphaTest&quot;</span><br><span class="line">           &quot;IgnoreProjector&quot;=&quot;True&quot;</span><br><span class="line">           &quot;RenderType&quot;=&quot;TransparentCutout&quot;</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">       Cull Off</span><br><span class="line">       </span><br><span class="line">       Pass</span><br><span class="line">       &#123;</span><br><span class="line">           Tags</span><br><span class="line">           &#123;</span><br><span class="line">               &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">           &#125;</span><br><span class="line">           </span><br><span class="line">           CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            #include &quot;Lighting.cginc&quot;</span><br><span class="line"></span><br><span class="line">            fixed4 _Color;</span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line">            fixed _Cutoff;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">               float4 vertex : POSITION;</span><br><span class="line">               float3 normal : NORMAL;</span><br><span class="line">               float4 texcoord : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line">            </span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">               float4 pos : SV_POSITION;</span><br><span class="line">               float3 worldNormal : TEXCOORD0;</span><br><span class="line">               float3 worldPos : TEXCOORD1;</span><br><span class="line">               float2 uv : TEXCOORD2;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)&#123;</span><br><span class="line"></span><br><span class="line">                v2f o;</span><br><span class="line">                o.pos = mul(unity_MatrixMVP,v.vertex);</span><br><span class="line">                o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line">                o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;</span><br><span class="line">                o.uv = TRANSFORM_TEX(v.texcoord, _MainTex);</span><br><span class="line">                return o;                </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target&#123;</span><br><span class="line">                fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line">                fixed3 worldLightDir = normalize(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line"></span><br><span class="line">                fixed4 texColor = tex2D(_MainTex, i.uv);</span><br><span class="line"></span><br><span class="line">                clip(texColor.a - _Cutoff);</span><br><span class="line"></span><br><span class="line">                // if((texColor.a - _Cutoff) &lt; 0.0)</span><br><span class="line">                // &#123;</span><br><span class="line">                //     discard;</span><br><span class="line">                // &#125;</span><br><span class="line"></span><br><span class="line">                fixed3 albedo = texColor.rgb * _Color.rgb;</span><br><span class="line"></span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz * albedo;</span><br><span class="line"></span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * albedo * max(0, dot(worldNormal, worldLightDir));</span><br><span class="line"></span><br><span class="line">                return fixed4(ambient + diffuse, 1.0);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">           ENDCG</span><br><span class="line">       &#125;</span><br><span class="line">        </span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é€æ˜åº¦æ··åˆçš„åŒé¢æ¸²æŸ“">é€æ˜åº¦æ··åˆçš„åŒé¢æ¸²æŸ“</h2><p>å’Œé€æ˜åº¦æµ‹è¯•ç›¸æ¯”ï¼Œæƒ³è¦è®©é€æ˜åº¦æ··åˆå®ç°åŒé¢æ¸²æŸ“å¯èƒ½ä¼šæ›´å¤æ‚ä¸€ç‚¹ï¼Œè¿™æ˜¯å› ä¸ºé€æ˜åº¦æ··åˆéœ€è¦å…³é—­æ·±åº¦å†™å…¥ï¼Œè€Œè¿™æ˜¯â€œä¸€åˆ‡æ··ä¹±çš„å¼€ç«¯â€ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œæƒ³è¦å¾—åˆ°æ­£ç¡®çš„é€æ˜æ•ˆæœï¼Œæ¸²æŸ“é¡ºåºæ˜¯ååˆ†é‡è¦çš„â€”â€”<strong>æˆ‘ä»¬éœ€è¦ä¿è¯å›¾å…ƒæ˜¯ä»åå¾€å‰æ¸²æŸ“çš„</strong>ã€‚å¯¹äºé€æ˜åº¦æµ‹è¯•æ¥è¯´ï¼Œç”±äºæˆ‘ä»¬æ²¡æœ‰å…³é—­æ·±åº¦å†™å…¥ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨æ·±åº¦ç¼“å†²æŒ‰é€åƒç´ çš„ç²’åº¦è¿›è¡Œæ’åºï¼Œä»è€Œä¿è¯æ¸²æŸ“çš„æ­£ç¡®æ€§ã€‚ç„¶è€Œä¸€æ—¦å…³é—­äº†æ·±åº¦å†™å…¥ï¼Œæˆ‘ä»¬å°±éœ€è¦å°å¿ƒåœ°æ§åˆ¶æ¸²æŸ“é¡ºåºæ¥å¾—åˆ°æ­£ç¡®çš„æ·±åº¦å…³ç³»ã€‚å¦‚æœæˆ‘ä»¬ä»ç„¶é‡‡ç”¨<a href="#1"><strong>é€æ˜åº¦æµ‹è¯•çš„åŒé¢æ¸²æŸ“</strong></a>å°èŠ‚ä¸­çš„æ–¹æ³•ç›´æ¥å…³é—­å‰”é™¤åŠŸèƒ½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ— æ³•ä¿è¯åŒä¸€ä¸ªç‰©ä½“çš„æ­£é¢å’ŒèƒŒé¢å›¾å…ƒçš„æ¸²æŸ“é¡ºåºï¼Œå°±æœ‰å¯èƒ½å¾—åˆ°é”™è¯¯çš„åŠé€æ˜æ•ˆæœã€‚</p><p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬é€‰æ‹©æŠŠåŒé¢æ¸²æŸ“çš„å·¥ä½œåˆ†æˆä¸¤ä¸ªPassâ€”â€”ç¬¬ä¸€ä¸ªPassåªæ¸²æŸ“èƒŒé¢ï¼Œç¬¬äºŒä¸ªPassåªæ¸²æŸ“æ­£é¢ï¼Œç”±äºUnityä¼šé¡ºåºæ‰§è¡ŒSubShaderä¸­çš„å„ä¸ªPassï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¿è¯èƒŒé¢æ€»æ˜¯åœ¨æ­£é¢æ¸²æŸ“ä¹‹å‰æ¸²æŸ“ï¼Œä»è€Œå¯ä»¥ä¿è¯æ­£ç¡®çš„æ·±åº¦å…³ç³»ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line">// Upgrade NOTE: replaced &#x27;mul(UNITY_MATRIX_MVP,*)&#x27; with &#x27;UnityObjectToClipPos(*)&#x27;</span><br><span class="line"></span><br><span class="line">Shader &quot;Shader Book/Chapter 8/AlphaBlendBothSides&quot;</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Color (&quot;ColorTine&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _MainTex (&quot;MainTex&quot;, 2D) = &quot;white&quot;&#123;&#125;</span><br><span class="line">        _AlphaScale (&quot;AlphaScle&quot;, Range(0,1)) = 1</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Queue&quot;=&quot;Transparent&quot;</span><br><span class="line">            &quot;IgnoreProjector&quot;=&quot;True&quot;</span><br><span class="line">            &quot;RenderType&quot;=&quot;Transparent&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags&#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            Cull Front</span><br><span class="line">            </span><br><span class="line">            Blend SrcAlpha OneMinusSrcAlpha</span><br><span class="line">            ZWrite Off</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            #include&quot;Lighting.cginc&quot;</span><br><span class="line"></span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line">            fixed _AlphaScale;</span><br><span class="line">            fixed4 _Color;</span><br><span class="line"></span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                // å› ä¸ºéœ€è¦åšMVPå˜æ¢ éœ€è¦ä¸€ä¸ªå››ç»´çŸ©é˜µ</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">                float4 texcoord : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float3 worldNormal : TEXCOORD0;</span><br><span class="line">                float3 worldPos : TEXCOORD1;</span><br><span class="line">                float2 uv : TEXCOORD2;</span><br><span class="line">            &#125;;</span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">                o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line">                o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;</span><br><span class="line">                o.uv = TRANSFORM_TEX(v.texcoord, _MainTex);</span><br><span class="line">                </span><br><span class="line">                return o; </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line">                fixed3 worldLightDir = normalize(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line"></span><br><span class="line">                fixed4 texColor = tex2D(_MainTex, i.uv);</span><br><span class="line">                fixed3 albedo = texColor.rgb * _Color.rgb;</span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz * albedo;</span><br><span class="line">                </span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * albedo * max(0, dot(worldNormal, worldLightDir));</span><br><span class="line"></span><br><span class="line">                return fixed4(ambient + diffuse, texColor.a * _AlphaScale);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags&#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            Cull Back</span><br><span class="line">            </span><br><span class="line">            Blend SrcAlpha OneMinusSrcAlpha</span><br><span class="line">            ZWrite Off</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            #include&quot;Lighting.cginc&quot;</span><br><span class="line"></span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line">            fixed _AlphaScale;</span><br><span class="line">            fixed4 _Color;</span><br><span class="line"></span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                // å› ä¸ºéœ€è¦åšMVPå˜æ¢ éœ€è¦ä¸€ä¸ªå››ç»´çŸ©é˜µ</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">                float4 texcoord : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float3 worldNormal : TEXCOORD0;</span><br><span class="line">                float3 worldPos : TEXCOORD1;</span><br><span class="line">                float2 uv : TEXCOORD2;</span><br><span class="line">            &#125;;</span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">                o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line">                o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;</span><br><span class="line">                o.uv = TRANSFORM_TEX(v.texcoord, _MainTex);</span><br><span class="line">                </span><br><span class="line">                return o; </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line">                fixed3 worldLightDir = normalize(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line"></span><br><span class="line">                fixed4 texColor = tex2D(_MainTex, i.uv);</span><br><span class="line">                fixed3 albedo = texColor.rgb * _Color.rgb;</span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz * albedo;</span><br><span class="line">                </span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * albedo * max(0, dot(worldNormal, worldLightDir));</span><br><span class="line"></span><br><span class="line">                return fixed4(ambient + diffuse, texColor.a * _AlphaScale);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Fallback &quot;Transparent/VertexLit&quot;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> UnityShader </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity </tag>
            
            <tag> Shader </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UnityShaderå…¥é—¨ç²¾è¦ç¬”è®°ï¼ˆä¸ƒï¼‰â€”â€”åŸºç¡€çº¹ç†</title>
      <link href="/posts/5fb55013/"/>
      <url>/posts/5fb55013/</url>
      
        <content type="html"><![CDATA[<p>çº¹ç†çš„ä½œç”¨åƒæ˜¯ç›–åœ¨æ¨¡å‹è¡¨é¢çš„è¡£æœï¼Œçº¹ç†å†³å®šäº†æ¨¡å‹è¡¨é¢çœ‹èµ·æ¥æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚</p><h1>å•å¼ çº¹ç†</h1><p>æˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨ä¸€å¼ çº¹ç†æ¥ä»£æ›¿ç‰©ä½“çš„æ¼«åå°„é¢œè‰²ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;unityShaderBook/Chapter 7/Single Texture&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _MainTex (&quot;MainTex&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _Color (&quot;Color&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _Gloss (&quot;Gloss&quot;, Range(8.0, 256)) = 20</span><br><span class="line">        _Specular (&quot;Specular&quot;, Color) = (1,1,1,1)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            </span><br><span class="line">            Tags</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line">            </span><br><span class="line">            #include&quot;Lighting.cginc&quot;</span><br><span class="line">            </span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line">            fixed4 _Color;</span><br><span class="line">            fixed4 _Specular;</span><br><span class="line">            float _Gloss;</span><br><span class="line">            </span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">                float4 texcoord : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float3 worldNormal : TEXCOORD0;</span><br><span class="line">                float3 worldPos : TEXCOORD1;</span><br><span class="line">                float2 uv : TEXCOORD2;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line">                o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;</span><br><span class="line">                o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line">                o.uv = v.texcoord.xy * _MainTex_ST.xy + _MainTex_ST.zw;</span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line">                fixed3 worldLightDir = normalize(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line">                </span><br><span class="line">                fixed3 albedo = tex2D(_MainTex, i.uv).rgb * _Color.rgb;</span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz * albedo;</span><br><span class="line">                </span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * albedo.rgb * saturate(dot(worldNormal, worldLightDir));</span><br><span class="line">                </span><br><span class="line">                fixed3 viewDir = normalize(UnityWorldSpaceViewDir(i.worldPos));</span><br><span class="line">                fixed3 halfDir = normalize(viewDir+worldLightDir);</span><br><span class="line">                fixed3 specular = _LightColor0.rgb * _Specular.rgb * pow(saturate(dot(worldNormal, halfDir)), _Gloss);</span><br><span class="line">                </span><br><span class="line">                return fixed4(ambient + diffuse + specular, 1.0);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Fallback &quot;Specular&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>å‡¹å‡¸æ˜ å°„</h1><p>çº¹ç†çš„å¦ä¸€ç§å¸¸è§çš„åº”ç”¨å°±æ˜¯å‡¹å‡¸æ˜ å°„(bump mapping)ã€‚å‡¹å‡¸æ˜ å°„çš„ç›®çš„æ˜¯ä½¿ç”¨ä¸€å¼ çº¹ç†æ¥ä¿®æ”¹æ¨¡å‹è¡¨é¢çš„æ³•çº¿ï¼Œä»¥ä¾¿ä¸ºæ¨¡å‹æä¾›æ›´å¤šçš„ç»†èŠ‚ã€‚è¿™ç§æ–¹æ³•ä¸ä¼šçœŸçš„æ”¹å˜æ¨¡å‹çš„é¡¶ç‚¹ä½ç½®ï¼Œåªæ˜¯è®©æ¨¡å‹çœ‹èµ·æ¥å¥½åƒæ˜¯å‡¹å‡¸ä¸å¹³çš„ï¼Œä½†å¯ä»¥ä»æ¨¡å‹çš„è½®å»“å¤„çœ‹å‡ºç ´ç»½ã€‚</p><p>æœ‰ä¸¤ç§ä¸»è¦çš„æ–¹æ³•å¯ä»¥ç”¨æ¥è¿›è¡Œå‡¹å‡¸æ˜ å°„ï¼šä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ä¸€å¼ é«˜åº¦çº¹ç†(height map)æ¥æ¨¡æ‹Ÿè¡¨é¢ä½ç§»(displacement),ç„¶åå¾—åˆ°ä¸€ä¸ªä¿®æ”¹åçš„æ³•çº¿å€¼ï¼Œè¿™ç§æ–¹æ³•ä¹Ÿè¢«ç§°ä¸ºé«˜åº¦æ˜ å°„(height mapping)ï¼›å¦ä¸€ç§æ–¹æ³•åˆ™æ˜¯ä½¿ç”¨ä¸€å¼ æ³•çº¿çº¹ç†(normal map)æ¥ç›´æ¥å­˜å‚¨è¡¨é¢æ³•çº¿ï¼Œè¿™ç§æ–¹æ³•åˆè¢«ç§°ä¸ºæ³•çº¿æ˜ å°„(normal mapping)ã€‚å°½ç®¡æˆ‘ä»¬å¸¸å¸¸å°†å‡¹å‡¸æ˜ å°„å’Œæ³•çº¿æ˜ å°„å½“æˆæ˜¯ç›¸åŒçš„æŠ€æœ¯ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯éœ€è¦çŸ¥é“å®ƒä»¬ä¹‹é—´çš„ä¸åŒã€‚</p><h2 id="é«˜åº¦çº¹ç†">é«˜åº¦çº¹ç†</h2><p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ç¬¬ä¸€ç§æŠ€æœ¯ï¼Œå³ä½¿ç”¨ä¸€å¼ é«˜åº¦å›¾æ¥å®ç°å‡¹å‡¸æ˜ å°„ã€‚é«˜åº¦å›¾ä¸­å­˜å‚¨çš„æ˜¯å¼ºåº¦å€¼(intensity)ï¼Œå®ƒç”¨äºè¡¨ç¤ºæ¨¡å‹è¡¨é¢å±€éƒ¨çš„æµ·æ‹”é«˜åº¦ã€‚å› æ­¤ï¼Œé¢œè‰²è¶Šæµ…çš„åœ°æ–¹è¡¨æ˜è¯¥ä½ç½®çš„è¡¨é¢è¶Šå‘å¤–å‡¸èµ·ï¼Œè€Œé¢œè‰²è¶Šæ·±çš„åœ°æ–¹è¡¨æ˜è¯¥ä½ç½®è¶Šæƒ³é‡Œå‡¹ã€‚è¿™ç§æ–¹æ³•çš„å¥½å¤„æ˜¯éå¸¸ç›´è§‚ï¼Œæˆ‘ä»¬å¯ä»¥ä»é«˜åº¦å›¾ä¸­æ˜ç¡®åœ°çŸ¥é“ä¸€ä¸ªæ¨¡å‹è¡¨é¢çš„å‡¹å‡¸æƒ…å†µï¼Œä½†ç¼ºç‚¹æ˜¯è®¡ç®—æ›´åŠ å¤æ‚ï¼Œåœ¨å®æ—¶è®¡ç®—çš„æ—¶å€™ä¸èƒ½ç›´æ¥å¾—åˆ°è¡¨é¢æ³•çº¿ï¼Œè€Œæ˜¯éœ€è¦ç”±åƒç´ çš„ç°åº¦å€¼è®¡ç®—è€Œå¾—ï¼Œå› æ­¤éœ€è¦æ¶ˆè€—æ›´å¤šçš„æ€§èƒ½ã€‚</p><p>é«˜åº¦å›¾é€šå¸¸ä¼šå’Œæ³•çº¿æ˜ å°„ä¸€èµ·ä½¿ç”¨ï¼Œç”¨äºç»™å‡ºè¡¨é¢å‡¹å‡¸çš„é¢å¤–ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨æ³•çº¿æ˜ å°„æ¥ä¿®æ”¹å…‰ç…§ã€‚</p><h2 id="æ³•çº¿çº¹ç†">æ³•çº¿çº¹ç†</h2><p>è€Œæ³•çº¿çº¹ç†ä¸­å­˜å‚¨çš„å°±æ˜¯è¡¨é¢æ³•çº¿çš„æ–¹å‘ã€‚ç”±äºæ³•çº¿æ–¹å‘çš„åˆ†é‡èŒƒå›´åœ¨[-1,1]ï¼Œè€Œåƒç´ çš„åˆ†é‡èŒƒå›´ä¸º[0,1]ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åšä¸€ä¸ªæ˜ å°„ï¼Œé€šå¸¸ä½¿ç”¨çš„æ˜ å°„å°±æ˜¯ï¼š<br>$$pixel = \frac{normal + 1}{2}$$</p><p>è¿™å°±è¦æ±‚ï¼Œæˆ‘ä»¬åœ¨Shaderä¸­å¯¹æ³•çº¿çº¹ç†è¿›è¡Œçº¹ç†é‡‡æ ·åï¼Œè¿˜éœ€è¦å¯¹ç»“æœè¿›è¡Œä¸€æ¬¡åæ˜ å°„çš„è¿‡ç¨‹ï¼Œä»¥å¾—åˆ°åŸå…ˆçš„æ³•çº¿æ–¹å‘ã€‚åæ˜ å°„çš„è¿‡ç¨‹å®é™…ä¸Šå°±æ˜¯ä½¿ç”¨ä¸Šé¢çš„æ˜ å°„å‡½æ•°çš„é€†å‡½æ•°:<br>$$normal = pixel \times 2 - 1$$</p><p>ç„¶è€Œï¼Œç”±äºæ–¹å‘æ˜¯ç›¸å¯¹äºåæ ‡ç©ºé—´æ¥è¯´çš„ï¼Œé‚£ä¹ˆæ³•çº¿çº¹ç†ä¸­å­˜å‚¨çš„æ³•çº¿æ–¹å‘åœ¨å“ªä¸ªåæ ‡ç©ºé—´ä¸­å‘¢ï¼Ÿå¯¹äºæ¨¡å‹é¡¶ç‚¹è‡ªå¸¦çš„æ³•çº¿ï¼Œå®ƒä»¬æ˜¯å®šä¹‰åœ¨æ¨¡å‹ç©ºé—´ä¸­çš„ï¼Œå› æ­¤ä¸€ç§ç›´æ¥çš„æƒ³æ³•å°±æ˜¯å°†ä¿®æ”¹åçš„æ¨¡å‹ç©ºé—´ä¸­çš„è¡¨é¢æ³•çº¿å­˜å‚¨åœ¨ä¸€å¼ çº¹ç†ä¸­ï¼Œè¿™ç§çº¹ç†è¢«ç§°ä¸ºæ˜¯æ¨¡å‹ç©ºé—´çš„æ³•çº¿çº¹ç†(object-space normal map)ã€‚ç„¶è€Œï¼Œåœ¨å®é™…åˆ¶ä½œä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šé‡‡ç”¨å¦ä¸€ç§åæ ‡ç©ºé—´ï¼Œå³æ¨¡å‹é¡¶ç‚¹çš„åˆ‡çº¿ç©ºé—´(tangent space)æ¥å­˜å‚¨æ³•çº¿ã€‚å¯¹äºæ¨¡å‹çš„æ¯ä¸ªé¡¶ç‚¹ï¼Œå®ƒéƒ½æœ‰å±äºè‡ªå·±çš„ä¸€ä¸ªåˆ‡çº¿ç©ºé—´ï¼Œè¿™ä¸ªåˆ‡çº¿ç©ºé—´çš„åŸç‚¹å°±æ˜¯è¯¥é¡¶ç‚¹æœ¬èº«ï¼Œè€Œzè½´æ˜¯é¡¶ç‚¹çš„æ³•çº¿æ–¹å‘(n),xè½´æ˜¯é¡¶ç‚¹çš„åˆ‡çº¿æ–¹å‘(t),è€Œyè½´åˆ™å¯ç”±æ³•çº¿å’Œåˆ‡çº¿çš„å‰ä¹˜ç§¯è€Œå¾—ï¼Œä¹Ÿè¢«ç§°ä¸ºæ˜¯å‰¯åˆ‡çº¿(bitangent,b)æˆ–è€…å‰¯æ³•çº¿ã€‚åˆ‡çº¿ç©ºé—´åæ ‡ç³»æ˜¯å³æ‰‹åæ ‡ç³»ã€‚</p><p>è¿™ç§çº¹ç†è¢«ç§°ä¸ºæ˜¯åˆ‡çº¿ç©ºé—´çš„æ³•çº¿çº¹ç†(tangent-space normal map)</p><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ¨¡å‹ç©ºé—´ä¸‹çš„æ³•çº¿çº¹ç†çœ‹èµ·æ¥æ˜¯äº”é¢œå…­è‰²çš„ï¼Œè¿™æ˜¯å› ä¸ºï¼Œæ‰€æœ‰æ³•çº¿æ‰€åœ¨çš„åæ ‡ç©ºé—´æ˜¯åŒä¸€ä¸ªåæ ‡ç©ºé—´ï¼Œå³æ¨¡å‹ç©ºé—´ï¼Œè€Œæ¯ä¸ªç‚¹å­˜å‚¨çš„æ³•çº¿æ–¹å‘æ˜¯å„å¼‚çš„ï¼Œæœ‰çš„æ˜¯(0,1,0)ï¼Œç»è¿‡æ˜ å°„åå­˜å‚¨åˆ°çº¹ç†ä¸­å°±å¯¹åº”äº†RGB(0.5,1,0.5)æµ…ç»¿è‰²ï¼Œæœ‰çš„æ˜¯(0,-1,0)ï¼Œç»è¿‡æ˜ å°„åå­˜å‚¨åˆ°çº¹ç†ä¸­å°±å¯¹åº”äº†(0.5,0,0.5)ç´«è‰²ã€‚è€Œåˆ‡çº¿ç©ºé—´ä¸‹çš„æ³•çº¿çº¹ç†çœ‹èµ·æ¥å‡ ä¹å…¨éƒ¨æ˜¯æµ…è“è‰²ã€‚è¿™æ˜¯å› ä¸ºï¼Œæ¯ä¸ªæ³•çº¿æ–¹å‘æ‰€åœ¨çš„åæ ‡ç©ºé—´æ˜¯ä¸ä¸€æ ·çš„ï¼Œå³æ˜¯è¡¨éš¾å…æ¯ä¸ªç‚¹å„è‡ªçš„åˆ‡çº¿ç©ºé—´ã€‚è¿™ç§æ³•çº¿çº¹ç†å…¶å®å°±æ˜¯å­˜å‚¨äº†æ¯ä¸ªç‚¹åœ¨å„è‡ªçš„ä¸”å‰ç©ºé—´ä¸­çš„æ³•çº¿æ‰°åŠ¨æ–¹å‘ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªç‚¹çš„æ³•çº¿æ–¹å‘ä¸å˜ï¼Œé‚£ä¹ˆåœ¨å®ƒçš„åˆ‡çº¿ç©ºé—´ä¸­ï¼Œæ–°çš„æ³•çº¿æ–¹å‘å°±æ˜¯zè½´æ–¹å‘ï¼Œå³å€¼ä¸º(0,0,1)ï¼Œç»è¿‡æ˜ å°„åå­˜å‚¨åœ¨çº¹ç†ä¸­å°±å¯¹åº”äº†RGB(0.5,0.5,1)æµ…è“è‰²ã€‚è€Œè¿™ä¸ªé¢œè‰²å°±æ˜¯æ³•çº¿çº¹ç†ä¸­å¤§ç‰‡çš„è“è‰²ã€‚è¿™äº›è“è‰²å®é™…ä¸Šè¯´æ˜é¡¶ç‚¹çš„å¤§éƒ¨åˆ†æ³•çº¿æ˜¯å’Œæ¨¡å‹æœ¬èº«æ³•çº¿ä¸€æ ·çš„ï¼Œä¸éœ€è¦æ”¹å˜ã€‚</p><p>æ€»ä½“æ¥è¯´ï¼Œæ¨¡å‹ç©ºé—´ä¸‹çš„æ³•çº¿çº¹ç†æ›´åŠ ç¬¦åˆäººç±»çš„ç›´è§‚è®¤è¯†ï¼Œè€Œæ³•çº¿çº¹ç†æœ¬èº«ä¹Ÿå¾ˆç›´è§‚ï¼Œå®¹æ˜“è°ƒæ•´ï¼Œå› ä¸ºä¸åŒçš„æ³•çº¿æ–¹å‘å°±ä»£è¡¨äº†ä¸åŒçš„é¢œè‰²ã€‚ä½†ç¾æœ¯äººå‘˜å¾€å¾€æ›´å–œæ¬¢ä½¿ç”¨åˆ‡çº¿ç©ºé—´ä¸‹çš„æ³•çº¿çº¹ç†ã€‚é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆä»–ä»¬æ›´å–œæ¬¢ä½¿ç”¨è¿™ä¸ªçœ‹èµ·æ¥å¾ˆè¹©è„šçš„åˆ‡çº¿ç©ºé—´å‘¢ï¼Ÿ</p><p>å…¶å®ï¼Œå‘ç°æœ¬èº«å­˜å‚¨åœ¨å“ªä¸ªåæ ‡ç³»ä¸­éƒ½æ˜¯å¯ä»¥çš„ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥é€‰æ‹©å­˜å‚¨åœ¨ä¸–ç•Œç©ºé—´ä¸‹ã€‚ä½†é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯å•çº¯åœ°æƒ³è¦å¾—åˆ°æ³•çº¿ï¼Œåç»­çš„å…‰ç…§è®¡ç®—æ‰æ˜¯æˆ‘ä»¬çš„ç›®çš„ã€‚è€Œé€‰æ‹©å“ªä¸ªåæ ‡ç³»æ„å‘³ç€æˆ‘ä»¬éœ€è¦æŠŠä¸åŒä¿¡æ¯è½¬æ¢åˆ°ç›¸åº”çš„åæ ‡ç³»ä¸­ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé€‰æ‹©äº†åˆ‡çº¿ç©ºé—´ï¼Œæˆ‘ä»¬éœ€è¦æŠŠä»æ³•çº¿çº¹ç†ä¸­å¾—åˆ°çš„æ³•çº¿æ–¹å‘ä»åˆ‡çº¿ç©ºé—´è½¬æ¢åˆ°ä¸–ç•Œç©ºé—´(æˆ–å…¶ä»–ç©ºé—´)ä¸­ã€‚</p><p>æ€»ä½“æ¥è¯´ï¼Œä½¿ç”¨æ¨¡å‹ç©ºé—´æ¥å­˜å‚¨æ³•çº¿çš„ä¼˜ç‚¹å¦‚ä¸‹ã€‚</p><ul><li>å®ç°ç®€å•ï¼Œæ›´åŠ ç›´è§‚ã€‚æˆ‘ä»¬ç”šè‡³éƒ½ä¸éœ€è¦æ¨¡å‹åˆå§‹çš„æ³•çº¿å’Œåˆ‡çº¿ç­‰ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè®¡ç®—æ›´å°‘ã€‚ç”Ÿæˆå®ƒä¹Ÿéå¸¸ç®€å•ï¼Œè€Œå¦‚æœè¦ç”Ÿæˆåˆ‡çº¿ç©ºé—´ä¸‹çš„æ³•çº¿çº¹ç†ï¼Œç”±äºæ¨¡å‹çš„åˆ‡çº¿ä¸€èˆ¬æ˜¯å’ŒUVæ–¹å‘ç›¸åŒï¼Œå› æ­¤æƒ³è¦å¾—åˆ°æ•ˆæœæ¯”è¾ƒå¥½çš„æ³•çº¿æ˜ å°„å°±è¦æ±‚çº¹ç†æ˜ å°„ä¹Ÿæ˜¯è¿ç»­çš„ã€‚</li><li>åœ¨çº¹ç†åæ ‡çš„ç¼åˆå¤„å’Œå°–é”çš„è¾¹è§’éƒ¨åˆ†ï¼Œå¯è§çš„çªå˜(ç¼éš™)è¾ƒå°‘ï¼Œå³å¯ä»¥æä¾›å¹³æ»‘çš„è¾¹ç•Œã€‚è¿™æ˜¯å› ä¸ºæ¨¡å‹ç©ºé—´ä¸‹çš„æ³•çº¿çº¹ç†å­˜å‚¨çš„æ˜¯åŒä¸€åæ ‡ç³»ä¸‹çš„å‘ç°ä¿¡æ¯ï¼Œå› æ­¤åœ¨è¾¹ç•Œå¤„é€šè¿‡æ’å€¼å¾—åˆ°çš„æ³•çº¿å¯ä»¥å¹³æ»‘å˜åŒ–ã€‚è€Œåˆ‡çº¿ç©ºé—´ä¸‹çš„æ³•çº¿çº¹ç†ä¸­çš„æ³•çº¿ä¿¡æ¯æ˜¯ä¾é çº¹ç†åæ ‡çš„æ–¹å‘å¾—åˆ°çš„ç»“æœï¼Œå› æ­¤å¯èƒ½ä¼šåœ¨è¾¹ç¼˜å¤„æˆ–è€…å°–é”çš„éƒ¨åˆ†é€ æˆæ›´å¤šå¯è§çš„ç¼åˆè¿¹è±¡ã€‚</li></ul><p>ä½†æ˜¯ä½¿ç”¨åˆ‡çº¿ç©ºé—´æœ‰æ›´å¤šçš„ä¼˜ç‚¹</p><ul><li>è‡ªç”±åº¦å¾ˆé«˜ã€‚æ¨¡å‹ç©ºé—´ä¸‹çš„æ³•çº¿çº¹ç†è®°å½•çš„æ˜¯<strong>ç»å¯¹æ³•çº¿ä¿¡æ¯</strong>ï¼Œä»…å¯ä»¥ç”¨äºåˆ›å»ºå®ƒæ—¶çš„é‚£ä¸ªæ¨¡å‹ï¼Œè€Œåº”ç”¨åˆ°å…¶ä»–æ¨¡å‹ä¸Šçš„æ•ˆæœå°±å®Œå…¨é”™è¯¯äº†ã€‚è€Œåˆ‡çº¿ç©ºé—´ä¸‹çš„æ³•çº¿çº¹ç†è®°å½•çš„æ˜¯ç›¸å¯¹æ³•çº¿ä¿¡æ¯ï¼Œè¿™æ„å‘³ç€ï¼Œå³ä¾¿æ˜¯æŠŠè¯¥çº¹ç†åº”ç”¨åˆ°ä¸€ä¸ªå®Œå…¨ä¸åŒçš„ç½‘æ ¼ä¸Šï¼Œä¹Ÿå¯ä»¥å¾—åˆ°ä¸€ä¸ªåˆç†çš„ç»“æœã€‚</li><li>å¯è¿›è¡ŒUVåŠ¨ç”»ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ç§»åŠ¨ä¸€ä¸ªçº¹ç†çš„UVåæ ‡æ¥å®ç°ä¸€ä¸ªå‡¹å‡¸ç§»åŠ¨çš„æ•ˆæœï¼Œä½†ä½¿ç”¨æ¨¡å‹ç©ºé—´ä¸‹çš„æ³•çº¿çº¹ç†ä¼šå¾—åˆ°å®Œå…¨é”™è¯¯çš„ç»“æœã€‚åŸå› åŒä¸Šã€‚è¿™ç§UVåŠ¨ç”»åœ¨æ°´æˆ–è€…ç«å±±ç†”å²©è¿™ç§ç±»å‹çš„ç‰©ä½“ä¸Šä¼šç»å¸¸ç”¨åˆ°ã€‚</li><li>å¯ä»¥é‡ç”¨æ³•çº¿çº¹ç†ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªç –å—ï¼Œæˆ‘ä»¬ä»…ä½¿ç”¨ä¸€å¼ å‘ç°çº¹ç†å°±å¯ä»¥ç”¨åˆ°æ‰€æœ‰çš„6ä¸ªé¢ä¸Šï¼ŒåŸå› åŒä¸Šã€‚</li><li>å¯å‹ç¼©ã€‚ç”±äºåˆ‡çº¿ç©ºé—´ä¸‹çš„æ³•çº¿çº¹ç†ä¸­æ³•çº¿Zæ–¹å‘æ€»æ˜¯æ­£æ–¹å‘ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä»…å­˜å‚¨XYæ–¹å‘ï¼Œè¿›è€Œæ¨åˆ°Zæ–¹å‘ã€‚è€Œæ¨¡å‹ç©ºé—´ä¸‹çš„æ³•çº¿çº¹ç†ç”±äºæ¯ä¸ªæ–¹å‘éƒ½æ˜¯å¯èƒ½çš„ï¼Œå› æ­¤å¿…é¡»å­˜å‚¨3ä¸ªæ–¹å‘çš„å€¼ï¼Œä¸å¯å‹ç¼©ã€‚</li></ul><p>åˆ‡çº¿ç©ºé—´ä¸‹çš„æ³•çº¿çº¹ç†çš„å‰ä¸¤ä¸ªä¼˜ç‚¹è¶³ä»¥è®©å¾ˆå¤šäººæ”¾å¼ƒæ¨¡å‹ç©ºé—´ä¸‹çš„æ³•çº¿çº¹ç†è€Œé€‰æ‹©å®ƒã€‚ä»ä¸Šé¢çš„ä¼˜ç‚¹å¯ä»¥çœ‹å‡ºï¼Œåˆ‡çº¿ç©ºé—´åœ¨å¾ˆå¤šæƒ…å†µä¸‹éƒ½ä¼˜äºæ¨¡å‹ç©ºé—´ï¼Œè€Œä¸”å¯ä»¥èŠ‚çœç¾æœ¯äººå‘˜çš„å·¥ä½œï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿä¼šä¸»è¦ä½¿ç”¨åˆ‡çº¿ç©ºé—´ä¸‹çš„æ³•çº¿çº¹ç†ã€‚</p><h3 id="å®è·µ">å®è·µ</h3><p>æˆ‘ä»¬éœ€è¦åœ¨è®¡ç®—å…‰ç…§æ¨¡å‹ä¸­ç»Ÿä¸€å„ä¸ªæ–¹å‘çŸ¢é‡æ‰€åœ¨çš„åæ ‡ç©ºé—´ã€‚ç”±äºæ³•çº¿çº¹ç†ä¸­å­˜å‚¨çš„æ³•çº¿æ˜¯åˆ‡çº¿ç©ºé—´ä¸‹çš„æ–¹å‘ï¼Œå› æ­¤æˆ‘ä»¬é€šå¸¸æœ‰ä¸¤ç§é€‰æ‹©ï¼šä¸€ç§é€‰æ‹©æ˜¯åœ¨åˆ‡çº¿ç©ºé—´ä¸‹è¿›è¡Œå…‰ç…§è®¡ç®—ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦æŠŠå…‰ç…§æ–¹å‘ã€è§†è§’æ–¹å‘å˜æ¢åˆ°åæ ‡ç©ºé—´ä¸‹ï¼›å¦ä¸€ç§é€‰æ‹©æ˜¯åœ¨åˆ‡çº¿ç©ºé—´ä¸‹è¿›è¡Œå…‰ç…§è®¡ç®—ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦æŠŠé‡‡æ ·å¾—åˆ°çš„æ³•çº¿æ–¹å‘å˜æ¢åˆ°åˆ‡çº¿ç©ºé—´ä¸‹ï¼Œå†å’Œä¸–ç•Œç©ºé—´ä¸‹çš„å…‰ç…§æ–¹å‘å’Œè§†è§’æ–¹å‘è¿›è¡Œè®¡ç®—ã€‚ä»æ•ˆç‡ä¸Šæ¥è¯´ï¼Œç¬¬ä¸€ç§æ–¹å¼è¦ç”±äºç¬¬äºŒç§æ–¹å¼ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­å®Œæˆå¯¹å…‰ç…§æ–¹å‘å’Œè§†è§’æ–¹å‘çš„è½¬å˜ï¼Œè€Œç¬¬äºŒç§æ–¹æ³•ç”±äºè¦å…ˆå¯¹æ³•çº¿çº¹ç†è¿›è¡Œé‡‡æ ·ï¼Œæ‰€ä»¥å˜æ¢è¿‡ç¨‹å¿…é¡»åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­å®ç°ï¼Œè¿™å°±æ„å‘³ç€æˆ‘ä»¬åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­è¦è¿›è¡Œä¸€æ¬¡çŸ©é˜µæ“ä½œã€‚ä½†ä»é€šç”¨æ€§è§’åº¦æ¥è¯´ï¼Œç¬¬äºŒç§æ–¹æ³•è¦ä¼˜äºç¬¬ä¸€ç§æ–¹æ³•ï¼Œå› ä¸ºæœ‰çš„æ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨ä¸–ç•Œç©ºé—´ä¸‹è¿›è¡Œä¸€äº›è®¡ç®—ï¼Œä¾‹å¦‚åœ¨ä½¿ç”¨Cubemapè¿›è¡Œç¯å¢ƒæ˜ å°„ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸–ç•Œç©ºé—´ä¸‹çš„åå°„æ–¹å‘å¯¹Cubmapè¿›è¡Œé‡‡æ ·ã€‚å¦‚æœåŒæ—¶éœ€è¦è¿›è¡Œæ³•çº¿æ˜ å°„ï¼Œæˆ‘ä»¬å°±éœ€è¦æŠŠæ³•çº¿æ–¹å‘å˜æ¢åˆ°ä¸–ç•Œç©ºé—´ä¸‹ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–åæ ‡ç©ºé—´è¿›è¡Œè®¡ç®—ï¼Œä¾‹å¦‚æ¨¡å‹ç©ºé—´ï¼Œä½†æ˜¯åˆ‡çº¿ç©ºé—´å’Œä¸–ç•Œç©ºé—´æ˜¯æœ€ä¸ºå¸¸ç”¨çš„ä¸¤ç§ç©ºé—´ï¼Œæœ¬èŠ‚ä¼šä¾æ¬¡å®ç°ä¸Šé¢ä¸¤ç§æ–¹æ³•ã€‚</p><ol><li>åœ¨åˆ‡çº¿ç©ºé—´ä¸‹è®¡ç®—</li></ol><p>æˆ‘ä»¬é¦–å…ˆæ¥å®ç°ç¬¬ä¸€ç§æ–¹æ³•ï¼Œå³åœ¨åˆ‡çº¿ç©ºé—´ä¸‹è®¡ç®—å…‰ç…§æ¨¡å‹ã€‚åŸºæœ¬æ€è·¯æ˜¯ï¼šåœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­é€šè¿‡çº¹ç†é‡‡æ ·å¾—åˆ°åˆ‡çº¿ç©ºé—´ä¸‹çš„æ³•çº¿ï¼Œç„¶åå†ä¸åˆ‡çº¿ç©ºé—´ä¸‹çš„è§†è§’æ–¹å‘ã€å…‰ç…§æ–¹å‘ç­‰è¿›è¡Œè®¡ç®—ï¼Œå¾—åˆ°æœ€ç»ˆçš„å…‰ç…§ç»“æœã€‚</p><p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­æŠŠè§†è§’æ–¹å‘å’Œå…‰ç…§æ–¹å‘ä»æ¨¡å‹ç©ºé—´å˜æ¢åˆ°åˆ‡çº¿ç©ºé—´ä¸­ï¼Œå³æˆ‘ä»¬éœ€è¦çŸ¥é“ä»æ¨¡å‹ç©ºé—´åˆ°åˆ‡çº¿ç©ºé—´çš„å˜æ¢çŸ©é˜µã€‚è¿™ä¸ªå˜æ¢çŸ©é˜µçš„é€†çŸ©é˜µï¼Œå³ä»åˆ‡çº¿ç©ºé—´åˆ°æ¨¡å‹ç©ºé—´çš„å˜æ¢çŸ©é˜µæ˜¯éå¸¸å®¹æ˜“æ±‚çš„ï¼Œæˆ‘ä»¬åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­æŒ‰åˆ‡çº¿(xè½´)ã€å‰¯åˆ‡çº¿(yè½´)ã€æ³•çº¿(zè½´)çš„é¡ºåºæŒ‰<strong>åˆ—</strong>æ’åˆ—å³å¯ã€‚æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œå¦‚æœä¸€ä¸ªå˜æ¢ä¸­ä»…æœ‰å¹³ç§»å’Œæ—‹è½¬å˜æ¢ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜æ¢çš„é€†å˜æ¢çŸ©é˜µå°±ç­‰äºå®ƒçš„è½¬ç½®çŸ©é˜µï¼Œè€Œä»åˆ‡çº¿ç©ºé—´åˆ°æ¨¡å‹ç©ºé—´çš„å˜æ¢æ­£æ˜¯ç¬¦åˆè¿™æ ·è¦æ±‚çš„å˜æ¢ã€‚å› æ­¤ï¼Œä»æ¨¡å‹ç©ºé—´åˆ°åˆ‡çº¿ç©ºé—´çš„å˜æ¢çŸ©é˜µå°±æ˜¯ä»åˆ‡çº¿ç©ºé—´åˆ°æ¨¡å‹ç©ºé—´å˜æ¢çŸ©é˜µçš„è½¬ç½®çŸ©é˜µï¼Œæˆ‘ä»¬æŠŠåˆ‡çº¿(xè½´)ã€å‰¯åˆ‡çº¿(yè½´)ã€æ³•çº¿(zè½´)çš„é¡ºåºæŒ‰<strong>è¡Œ</strong>æ’åˆ—å³å¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;UnityShaderBook/Chapter 7/NormalMapInTangentSpace&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Color (&quot;Colcor Tint&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _MainTex (&quot;MainTex&quot;,2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _BumpMap (&quot;Normal Map&quot;, 2D) = &quot;bump&quot; &#123;&#125;</span><br><span class="line">        _BumpScale (&quot;Bump Scale&quot;, Float) = 1.0</span><br><span class="line">        _Specular (&quot;Specular&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _Gloss (&quot;Gloss&quot;, Range(8.0,256)) = 20</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;  </span><br><span class="line">            &#125;</span><br><span class="line">             </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line">            #include&quot;Lighting.cginc&quot;</span><br><span class="line"></span><br><span class="line">            fixed4 _Color;</span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            fixed4 _MainTex_ST;</span><br><span class="line">            sampler2D _BumpMap;</span><br><span class="line">            float4 _BumpMap_ST;</span><br><span class="line">            float _BumpScale;</span><br><span class="line">            fixed4 _Specular;</span><br><span class="line">            float _Gloss;</span><br><span class="line"></span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">                float4 tangent : TANGENT;</span><br><span class="line">                float4 texcoord : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float4 uv : TEXCOORD0;</span><br><span class="line">                float3 lightDir : TEXCOORD1;</span><br><span class="line">                float3 viewDir : TEXCOORD2;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line">                o.uv.xy = v.texcoord.xy * _MainTex_ST.xy + _MainTex_ST.zw;</span><br><span class="line">                o.uv.zw = v.texcoord.xy * _BumpMap_ST.xy + _BumpMap_ST.zw;</span><br><span class="line"></span><br><span class="line">                TANGENT_SPACE_ROTATION;</span><br><span class="line"></span><br><span class="line">                o.lightDir = mul(rotation, ObjSpaceLightDir(v.vertex)).xyz;</span><br><span class="line"></span><br><span class="line">                o.viewDir = mul(rotation, ObjSpaceViewDir(v.vertex)).xyz;</span><br><span class="line">                </span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line"></span><br><span class="line">                fixed3 tangentLightDir = normalize(i.lightDir);</span><br><span class="line">                fixed3 tangentViewDir = normalize(i.viewDir);</span><br><span class="line"></span><br><span class="line">                fixed4 packedNormal = tex2D(_BumpMap, i.uv.zw);</span><br><span class="line">                fixed3 tangentNormal;</span><br><span class="line"></span><br><span class="line">                tangentNormal = UnpackNormal(packedNormal);</span><br><span class="line">                tangentNormal.xy *= _BumpScale;</span><br><span class="line">                tangentNormal.z = sqrt(1.0 - saturate(dot(tangentNormal.xy,tangentNormal.xy)));</span><br><span class="line"></span><br><span class="line">                fixed3 albedo = tex2D(_MainTex,i.uv.xy).xyz * _Color.rgb;</span><br><span class="line"></span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz * albedo;</span><br><span class="line"></span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * albedo * saturate(dot(tangentNormal, tangentLightDir));</span><br><span class="line"></span><br><span class="line">                fixed3 halfDir = normalize(tangentViewDir + tangentLightDir);</span><br><span class="line">                fixed3 specular = _LightColor0.rgb * _Specular.rgb * pow(saturate(dot(tangentNormal, halfDir)), _Gloss);</span><br><span class="line">                </span><br><span class="line">                return fixed4(ambient + diffuse + specular,1);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Fallback &quot;Specular&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li>åœ¨ä¸–ç•Œç©ºé—´ä¸‹è®¡ç®—<br>ç°åœ¨æˆ‘ä»¬æ¥å®ç°ç¬¬äºŒç§æ–¹æ³•ï¼Œå³åœ¨ä¸–ç•Œç©ºé—´ä¸‹è®¡ç®—å…‰ç…§æ¨¡å‹ã€‚æˆ‘ä»¬éœ€è¦åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­æŠŠæ³•çº¿æ–¹å‘ä»åˆ‡çº¿ç©ºé—´å˜æ¢åˆ°ä¸–ç•Œç©ºé—´ä¸‹ã€‚è¿™ç§æ–¹æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šåœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Unity Shader Book/Chapter 7/NormalMapWorldSpace&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _MainTex (&quot;MainTex&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _BumpMap (&quot;BumpMap&quot;, 2D) = &quot;bump&quot; &#123;&#125;</span><br><span class="line">        _Specular (&quot;Specular&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _BumpScale (&quot;BumpScale&quot;, Float) = 1.0</span><br><span class="line">        _Gloss (&quot;Gloss&quot;, Range(8.0, 256)) = 20</span><br><span class="line">        _Color (&quot;Color Tint&quot;, Color) = (1,1,1,1)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line">            #include &quot;Lighting.cginc&quot;</span><br><span class="line"></span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            fixed4 _MainTex_ST;</span><br><span class="line">            sampler2D _BumpMap;</span><br><span class="line">            fixed4 _BumpMap_ST;</span><br><span class="line">            fixed4 _Color;</span><br><span class="line">            fixed4 _Specular;</span><br><span class="line">            float _Gloss;</span><br><span class="line">            float _BumpScale;</span><br><span class="line">            </span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">                float4 tangent : TANGENT;</span><br><span class="line">                float4 texcoord : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : POSITION;</span><br><span class="line">                float4 uv : TEXCOORD0;</span><br><span class="line">                float4 TtoW0 : TEXCOORD1;</span><br><span class="line">                float4 TtoW1 : TEXCOORD2;</span><br><span class="line">                float4 TtoW2 : TEXCOORD3;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line">                o.uv.xy = v.texcoord.xy * _MainTex_ST.xy + _MainTex_ST.zw;</span><br><span class="line">                o.uv.zw = v.texcoord.xy * _BumpMap_ST.xy + _BumpMap_ST.zw;</span><br><span class="line"></span><br><span class="line">                // æ±‚å˜æ¢çŸ©é˜µ</span><br><span class="line">                float3 worldPos = mul(unity_ObjectToWorld, v.vertex);</span><br><span class="line"></span><br><span class="line">                fixed3 worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line">                fixed3 worldTangent = UnityObjectToWorldDir(v.tangent);</span><br><span class="line">                fixed3 worldBinormal = cross(worldNormal, worldTangent) * v.tangent.w;</span><br><span class="line"></span><br><span class="line">                o.TtoW0 = float4(worldTangent.x, worldBinormal.x, worldNormal.x, worldPos.x);</span><br><span class="line">                o.TtoW1 = float4(worldTangent.y, worldBinormal.y, worldNormal.y, worldPos.y);</span><br><span class="line">                o.TtoW2 = float4(worldTangent.z, worldBinormal.z, worldNormal.z, worldPos.z);</span><br><span class="line">                </span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line"></span><br><span class="line">                float3 worldPos = float3(i.TtoW0.w, i.TtoW1.w, i.TtoW2.w);</span><br><span class="line">                fixed3 worldLightDir = normalize(UnityWorldSpaceLightDir(worldPos));</span><br><span class="line">                fixed3 viewDir = normalize(UnityWorldSpaceViewDir(worldPos));</span><br><span class="line"></span><br><span class="line">                fixed3 bump = UnpackNormal(tex2D(_BumpMap, i.uv.zw));</span><br><span class="line">                bump.xy *= _BumpScale;</span><br><span class="line">                bump.z = sqrt(1.0 - saturate(dot(bump.xy, bump.xy)));</span><br><span class="line">                bump = normalize(half3(dot(i.TtoW0.xyz, bump), dot(i.TtoW1.xyz, bump), dot(i.TtoW2.xyz, bump)));</span><br><span class="line"></span><br><span class="line">                fixed3 albedo = tex2D(_MainTex, i.uv.xy).rgb * _Color.rgb;</span><br><span class="line"></span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz * albedo;</span><br><span class="line"></span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * albedo.rgb * saturate(dot(bump, worldLightDir));</span><br><span class="line"></span><br><span class="line">                fixed3 halfDir = normalize(bump + worldLightDir);</span><br><span class="line">                fixed3 specular = _LightColor0.rgb * _Specular.rgb * pow(saturate(dot(bump, halfDir)), _Gloss);</span><br><span class="line">                </span><br><span class="line">                return fixed4(ambient + diffuse + specular, 1.0);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Unityä¸­çš„æ³•çº¿çº¹ç†ç±»å‹">Unityä¸­çš„æ³•çº¿çº¹ç†ç±»å‹</h2><p>å°†æ³•çº¿çº¹ç†çš„çº¹ç†ç±»å‹æ ‡è¯†æˆNormal Mapæ—¶ï¼Œå¯ä»¥ä½¿ç”¨Unityçš„å†…ç½®å‡½æ•°UnpackNormalæ¥å¾—åˆ°æ­£ç¡®çš„æ³•çº¿æ–¹å‘ã€‚<br>å½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨é‚£äº›åŒ…å«äº†æ³•çº¿æ˜ å°„çš„å†…ç½®çš„Unity Shaderæ—¶ï¼Œå¿…é¡»æŠŠä½¿ç”¨çš„æ³•çº¿çº¹ç†æŒ‰ç…§ä¸Šé¢çš„æ–¹å¼æ ‡è¯†æˆNormal mapæ‰èƒ½å¾—åˆ°æ­£ç¡®çš„ç»“æœ(å³ä½¿ä½ å¿˜äº†è¿™ä¹ˆåšï¼ŒUnityä¹Ÿä¼šåœ¨æè´¨é¢æ¿ä¸­æé†’ä½ ä¿®æ­£è¿™ä¸ªé—®é¢˜)ï¼Œè¿™æ˜¯å› ä¸ºè¿™äº›Unity Shaderéƒ½ä½¿ç”¨äº†å†…ç½®çš„unpackNormalå‡½æ•°æ¥é‡‡æ ·æ³•çº¿æ–¹å‘ã€‚é‚£ä¹ˆï¼Œå½“æˆ‘ä»¬æŠŠçº¹ç†ç±»å‹è®¾ç½®æˆNormal mapçš„æ—¶å€™åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿ<br>ç®€å•æ¥è¯´ï¼Œè¿™ä¹ˆåšå¯ä»¥è®©Unityæ ¹æ®ä¸åŒå¹³å°å¯¹çº¹ç†è¿›è¡Œå‹ç¼©ï¼Œä¾‹å¦‚ä½¿ç”¨DXT5nmæ ¼å¼ï¼Œå†é€šè¿‡UnpackNormalå‡½æ•°æ¥é’ˆå¯¹ä¸åŒçš„å‹ç¼©æ ¼å¼å¯¹æ³•çº¿çº¹ç†è¿›è¡Œæ­£ç¡®çš„é‡‡æ ·ã€‚æˆ‘ä»¬å¯ä»¥å†UnityCG.cgincé‡Œé¢æ‰¾åˆ°UnpackNormalå‡½æ•°çš„å†…éƒ¨å®ç°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">inline fixed3 UnpackNormalDXT5nm(fixed4 packednormal)&#123;</span><br><span class="line">    fixed3 normal;</span><br><span class="line">    normal.xy = packednormal.wy *2 - 1;</span><br><span class="line">    normal.z = sqrt(1 - saturate(dot(normal.xy, normal.xy)));</span><br><span class="line">    return normal; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">inline fixed3 UnpackNormal(fixed4 packnormal)&#123;</span><br><span class="line">#if defined(UNITY_NO_DXT5nm)</span><br><span class="line">    return packednormal.xyz * 2 - 1;</span><br><span class="line">#else</span><br><span class="line">    return UnpackNormalDXT5nm(packednormal);</span><br><span class="line">#endif</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œåœ¨æŸäº›å¹³å°ä¸Šç”±äºä½¿ç”¨äº†DXT5nmçš„å‹ç¼©æ ¼å¼ï¼Œå› æ­¤éœ€è¦é’ˆå¯¹è¿™ç§æ ¼å¼å¯¹æ³•çº¿è¿›è¡Œè§£ç ã€‚åœ¨DXT5nmæ ¼å¼çš„æ³•çº¿çº¹ç†ä¸­ï¼Œçº¹ç´ çš„aé€šé“(å³wåˆ†é‡)å¯¹åº”äº†æ³•çº¿çš„xåˆ†é‡ï¼Œgé€šé“å¯¹åº”äº†æ³•çº¿çš„yåˆ†é‡ï¼Œè€Œçº¹ç†çš„rå’Œbé€šé“åˆ™ä¼šè¢«èˆå¼ƒæ³•çº¿çš„zåˆ†é‡å¯ä»¥ç”±xyåˆ†é‡æ¨å¯¼è€Œå¾—ã€‚ä¸ºä»€ä¹ˆä¹‹å‰çš„æ™®é€šçº¹ç†ä¸èƒ½æŒ‰ç…§è¿™ç§æ–¹å¼å‹ç¼©ï¼Œè€Œæ³•çº¿å°±éœ€è¦ä½¿ç”¨DXT5nmæ ¼å¼æ¥è¿›è¡Œå‹ç¼©å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºï¼ŒæŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çš„å¤„ç†æ–¹å¼ï¼Œæ³•çº¿çº¹ç†è¢«å½“æˆä¸€ä¸ªå’Œæ™®é€šçº¹ç†æ— å¼‚çš„å›¾ï¼Œä½†å®é™…ä¸Šï¼Œå®ƒåªæœ‰ä¸¤ä¸ªé€šé“æ˜¯çœŸæ­£å¿…ä¸å¯å°‘çš„ï¼Œå› ä¸ºç¬¬ä¸‰ä¸ªé€šé“çš„å€¼å¯ä»¥ç”¨å¦å¤–ä¸¤ä¸ªæ¨å¯¼å‡ºæ¥(æ³•çº¿æ˜¯å•ä½å‘é‡ï¼Œå¹¶ä¸”åˆ‡çº¿ç©ºé—´ä¸‹çš„æ³•çº¿æ–¹å‘çš„zåˆ†é‡å§‹ç»ˆä¸ºæ­£)ã€‚ä½¿ç”¨è¿™ç§å‹ç¼©æ–¹æ³•å°±å¯ä»¥å‡å°‘æ³•çº¿çº¹ç†å ç”¨çš„å†…å­˜ç©ºé—´ã€‚</p><p>å½“æˆ‘ä»¬æŠŠçº¹ç†ç±»å‹è®¾ç½®æˆnormal mapä¹‹åï¼Œè¿˜æœ‰ä¸€ä¸ªå¤é€‰æ¡†æ˜¯Creat from Grayscaleï¼Œé‚£ä¹ˆå®ƒæ˜¯åšä»€ä¹ˆç”¨çš„å‘¢ï¼Ÿè¿˜è®°å¾—æˆ‘ä»¬åœ¨æœ¬èŠ‚ä¸€å¼€å§‹æåˆ°çš„å¦ä¸€ç§å‡¹å‡¸æ˜ å°„çš„æ–¹æ³•ï¼Œå³ä½¿ç”¨é«˜åº¦å›¾ï¼Œè€Œè¿™ä¸ªå¤é€‰æ¡†å°±æ˜¯ç”¨äºä»é«˜åº¦å›¾ä¸­ç”Ÿæˆæ³•çº¿çº¹ç†çš„ã€‚é«˜åº¦å›¾æœ¬èº«è®°å½•çš„æ˜¯ç›¸å¯¹é«˜åº¦ï¼Œæ˜¯ä¸€å¼ ç°åº¦å›¾ï¼Œç™½è‰²éƒ¨åˆ†ç›¸å¯¹æ›´é«˜ï¼Œé»‘è‰²è¡¨ç¤ºç›¸å¯¹æ›´ä½ã€‚å½“æˆ‘ä»¬æŠŠä¸€å¼ é«˜åº¦å›¾å¯¼å…¥Unityåï¼Œé™¤äº†éœ€è¦æŠŠå®ƒçš„çº¹ç†ç±»å‹è®¾ç½®æˆNormal mapå¤–ï¼Œè¿˜éœ€è¦å‹¾é€‰Create from Grayscaleï¼Œè¿™æ ·å°±å¯ä»¥å¾—åˆ°ç±»ä¼¼ä¸‹å›¾çš„ç»“æœã€‚ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå®ƒå’Œåˆ‡çº¿ç©ºé—´ä¸‹çš„æ³•çº¿çº¹ç†ç­‰åŒå¯¹å¾…äº†ã€‚</p><h1>æ¸å˜çº¹ç†</h1><p>å°½ç®¡åœ¨ä¸€å¼€å§‹ï¼Œæˆ‘ä»¬åœ¨æ¸²æŸ“ä¸­ä½¿ç”¨çº¹ç†æ˜¯ä¸ºäº†å®šä¹‰ä¸€ä¸ªç‰©ä½“çš„é¢œè‰²ï¼Œä½†æ˜¯åæ¥äººä»¬å‘ç°ï¼Œçº¹ç†å…¶å®å¯ä»¥ç”¨äºå­˜å‚¨ä»»ä½•è¡¨é¢å±æ€§ã€‚ä¸€ç§å¸¸è§çš„ç”¨æ³•å°±æ˜¯ä½¿ç”¨æ¸å˜çº¹ç†æ¥æ§åˆ¶æ¼«åå°„çš„å…‰ç…§ç»“æœã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Unity Shader Book/Chapter 7/Ramp Texture&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _RampTex (&quot;Ramp&quot;, 2D) = &quot;white&quot;&#123;&#125;</span><br><span class="line">        _Color (&quot;Color Tint&quot;, Color) = (1,1,1,1)git</span><br><span class="line">        _Specular (&quot;Specular&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _Gloss (&quot;Gloss&quot;, Range(8.0, 256)) = 20</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">            &#125;</span><br><span class="line">               </span><br><span class="line">            CGPROGRAM</span><br><span class="line">            </span><br><span class="line">            #include &quot;Lighting.cginc&quot;</span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            fixed4 _Color;</span><br><span class="line">            sampler2D _RampTex;</span><br><span class="line">            fixed4 _Specular;</span><br><span class="line">            fixed4 _RampTex_ST;</span><br><span class="line">            float _Gloss;</span><br><span class="line">            </span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">                float4 texcoord : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line">            </span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : POSITION;</span><br><span class="line">                float3 worldNormal : TEXCOORD0;</span><br><span class="line">                float3 worldPos : TEXCOORD1;</span><br><span class="line">                float2 uv : TEXCOORD2;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line">                o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line">                o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;</span><br><span class="line">                // æŠŠUVä¼ è¿‡å»ä¹Ÿä¸ç”¨</span><br><span class="line">                // å¯ä»¥æŠŠuvè¿™ä¸ªå­—æ®µç§»é™¤æ‰</span><br><span class="line">                o.uv = TRANSFORM_TEX(v.texcoord, _RampTex);</span><br><span class="line">                </span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) :SV_Target&#123;</span><br><span class="line"></span><br><span class="line">                fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line">                fixed3 lightDir = normalize(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line"></span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz;</span><br><span class="line"></span><br><span class="line">                fixed halfLambert = 0.5 * dot(worldNormal, lightDir) + 0.5;</span><br><span class="line"></span><br><span class="line">                fixed3 diffuseColor = tex2D(_RampTex, fixed2(halfLambert, halfLambert)).rgb * _Color.rgb;</span><br><span class="line"></span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * diffuseColor;</span><br><span class="line"></span><br><span class="line">                fixed3 viewDir = UnityWorldSpaceViewDir(i.worldPos);</span><br><span class="line"></span><br><span class="line">                fixed3 halfDir = normalize(viewDir + lightDir);</span><br><span class="line">                fixed3 specular = _LightColor0.rgb * _Specular.rgb * pow(saturate(dot(worldNormal, halfDir)), _Gloss);</span><br><span class="line"></span><br><span class="line">                return fixed4(diffuse + ambient + specular,1.0);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Fallback &quot;Specular&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ¸å˜çº¹ç†çš„Wrap Modeè®¾ä¸º<code>Clamp</code>æ¨¡å¼ï¼Œä»¥é˜²æ­¢å¯¹çº¹ç†è¿›è¡Œé‡‡æ ·æ—¶ç”±äºæµ®ç‚¹æ•°çš„ç²¾åº¦è€Œé€ æˆçš„é—®é¢˜ã€‚</p><h1>é®ç½©çº¹ç†</h1><p>é®ç½©çº¹ç†(mask texture)æ˜¯æœ¬ç« è¦ä»‹ç»çš„æœ€åä¸€ç§çº¹ç†ï¼Œå®ƒéå¸¸æœ‰ç”¨ï¼Œåœ¨å¾ˆå¤šå•†ä¸šæ¸¸æˆä¸­éƒ½å¯ä»¥è§åˆ°å®ƒçš„èº«å½±ã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯é®ç½©å‘¢ï¼Ÿç®€å•æ¥è®²ï¼Œé®ç½©å…è®¸æˆ‘ä»¬å¯ä»¥ä¿æŠ¤æŸäº›åŒºåŸŸï¼Œä½¿å®ƒä»¬å…äºæŸäº›ä¿®æ”¹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;ShaderBook/Chapter7/MaskTexture&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Color (&quot;Color Tint&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _MainTex (&quot;Main Tex&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _BumpMap (&quot;Normal Map&quot;, 2D) = &quot;bump&quot; &#123;&#125;</span><br><span class="line">        _BumpScale (&quot;Bump Scale&quot;, Float) = 1.0</span><br><span class="line">        </span><br><span class="line">        _SpecularMask (&quot;Specular Mask&quot;, 2D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        _SpecularScale (&quot;SpecularScale&quot;, Float) = 1.0</span><br><span class="line">        _Specular (&quot;Specular&quot;, Color) = (1,1,1,1)</span><br><span class="line">        </span><br><span class="line">        _Gloss (&quot;Gloss&quot;, Range(8.0, 256)) = 8.0</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">            &#125;            </span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #include &quot;Lighting.cginc&quot;</span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line">            </span><br><span class="line">            fixed4 _Color;</span><br><span class="line">            sampler2D _MainTex;</span><br><span class="line">            fixed4 _MainTex_ST;</span><br><span class="line"></span><br><span class="line">            sampler2D _BumpMap;</span><br><span class="line">            float _BumpScale;</span><br><span class="line"></span><br><span class="line">            sampler2D _SpecularMask;</span><br><span class="line">            float _SpecularScale;</span><br><span class="line"></span><br><span class="line">            fixed4 _Specular;</span><br><span class="line"></span><br><span class="line">            float _Gloss;</span><br><span class="line">            </span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;****</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">                float4 tangent : TANGENT;</span><br><span class="line">                float4 texcoord : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float2 uv : TEXCOORD0;</span><br><span class="line">                float3 lightDir : TEXCOORD1;</span><br><span class="line">                float3 viewDir : TEXCOORD2;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line">                o.uv.xy = v.texcoord.xy * _MainTex_ST.xy + _MainTex_ST.zw;</span><br><span class="line"></span><br><span class="line">                TANGENT_SPACE_ROTATION;</span><br><span class="line">                o.lightDir = mul(rotation, ObjSpaceLightDir(v.vertex)).xyz;</span><br><span class="line">                o.viewDir = mul(rotation, ObjSpaceViewDir(v.vertex)).xyz;</span><br><span class="line"></span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                fixed3 tangentLightDir = normalize(i.lightDir);</span><br><span class="line">                fixed3 tangentViewDir = normalize(i.viewDir);</span><br><span class="line"></span><br><span class="line">                fixed3 tangentNormal = UnpackNormal(tex2D(_BumpMap, i.uv));</span><br><span class="line">                tangentNormal.xy *= _BumpScale;</span><br><span class="line">                tangentNormal.z = sqrt(1 - saturate(dot(tangentNormal.xy, tangentNormal.xy)));</span><br><span class="line"></span><br><span class="line">                fixed3 albedo = tex2D(_MainTex, i.uv).rgb * _Color.rgb;</span><br><span class="line"></span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz * albedo;;</span><br><span class="line"></span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * albedo * saturate(dot(tangentNormal, tangentLightDir));</span><br><span class="line">                </span><br><span class="line">                fixed3 halfDir = normalize(tangentViewDir + tangentLightDir);</span><br><span class="line"></span><br><span class="line">                fixed specularMask = tex2D(_SpecularMask, i.uv).r * _SpecularScale;</span><br><span class="line"></span><br><span class="line">                fixed3 specular = _LightColor0.rgb * _Specular.rgb * pow(saturate(dot(tangentNormal, halfDir)), _Gloss) * specularMask;</span><br><span class="line"></span><br><span class="line">                return fixed4(diffuse + specular + ambient, 1.0);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Fallback &quot;Specular&quot;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> UnityShader </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity </tag>
            
            <tag> Shader </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unityæ€§èƒ½ä¼˜åŒ–</title>
      <link href="/posts/6e973c22/"/>
      <url>/posts/6e973c22/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡æ˜¯ç¬”è€…è¿‘æœŸå¼€å±•æ€§èƒ½ä¼˜åŒ–å·¥ä½œçš„çŸ¥è¯†ç‚¹è®°å½•ï¼Œæ€§èƒ½ä¼˜åŒ–æ¶‰åŠæ¸²æŸ“ã€å†…å­˜ä»£ç é€»è¾‘ç­‰æ–¹æ–¹é¢é¢ï¼Œå†…å®¹ç‰¹åˆ«ç¹æ‚ã€‚ä»¥ç¬”è€…ç›®å‰çš„èƒ½åŠ›æ²¡æœ‰åŠæ³•å°†è¿™äº›çŸ¥è¯†ç³»ç»Ÿæ¢³ç†ï¼Œå› æ­¤æœ¬æ–‡æ¯å°èŠ‚ä¹‹é—´å¹¶æ— å…³è”æ€§ï¼Œæ˜¯ä¸€ä¸ªä¸ªç‹¬ç«‹çš„çŸ¥è¯†ç‚¹ã€‚</p><h1>æ€§èƒ½ä¼˜åŒ–çš„åŸåˆ™</h1><p>æœ¬å°ç»“ç¿»è¯‘è‡ª<a href="https://unity.com/cn/resources/ultimate-guide-to-profiling-unity-games">Unityå®˜æ–¹çš„æ€§èƒ½ä¼˜åŒ–æŒ‡å¯¼ä¹¦</a></p><img src="/posts/6e973c22/Ultimate_Guide_to_Profiling_Unity_Games-19.jpg" class=""><h2 id="è®¾ç½®å¸§ç‡é¢„ç®—">è®¾ç½®å¸§ç‡é¢„ç®—</h2><h1>å†…å­˜åˆ†æ</h1><p>å†…å­˜å¯¹è¿è¡Œæ—¶çš„æ€§èƒ½è¡¨ç°çš„å½±å“å¾®ä¹å…¶å¾®ï¼Œ</p><p>åœ¨Unityä¸­æœ‰ä¸¤ç§æ–¹æ³•æ¥åˆ†ææ¸¸æˆçš„å†…å­˜å ç”¨:</p><ul><li>Memory Profiler module: è¿™æ˜¯Unityå†…ç½®çš„æ¨¡å—ï¼Œé€šè¿‡è¯¥æ¨¡å—æˆ‘ä»¬å¯ä»¥åˆ†ææˆ‘ä»¬çš„æ¸¸æˆåŸºæœ¬çš„å†…å­˜å ç”¨æƒ…å†µ</li><li>Memory Profiler package: è¿™æ˜¯ä¸€ä¸ªUnity Packageä½ å¯ä»¥å°†å…¶å®‰è£…åˆ°ä½ çš„Unityé¡¹ç›®ä¸­ã€‚è¿™ä¸ªæ¨¡å—ä¸ºUnity Editoræ·»åŠ äº†é¢å¤–çš„Memory Profilerçª—å£ï¼Œè®©ä½ èƒ½å¤Ÿæ›´åŠ è¯¦ç»†åœ°åˆ†æé¡¹ç›®çš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚</li></ul><h1>Unity æ€§èƒ½åˆ†æå·¥å…·</h1><p>Unityå®˜æ–¹æä¾›çš„æ€§èƒ½åˆ†æå·¥å…·æœ‰ â€˜Profilerâ€™ â€˜Frame Debuggerâ€™ â€˜Memory Profilerâ€™ â€˜Profile Analyzerâ€™<br>ç¬”è€…ä½“éªŒä¸‹æ¥è§‰å¾—è¿™å‡ ä¸ªå·¥å…·çš„ä½¿ç”¨è¿˜æ˜¯å¾ˆå®¹æ˜“ä¸Šæ‰‹ä½“éªŒå¾ˆå¥½çš„</p><h2 id="åˆ¤æ–­æ˜¯CPUç“¶é¢ˆè¿˜æ˜¯GPUç“¶é¢ˆ">åˆ¤æ–­æ˜¯CPUç“¶é¢ˆè¿˜æ˜¯GPUç“¶é¢ˆ</h2><h2 id="Unity-Profiler">Unity Profiler</h2><p>åœ¨Unity Profilerä¸­æ‰çœ‹åˆ°çš„CPU Usage Moduleä¸­ ä¼šçœ‹åˆ°ä¸€ä¸ªMain Threadå’ŒRender Threadä»–ä»¬ä¸¤ä¸ªçš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ<br><a href="https://forum.unity.com/threads/what-exactly-is-happening-in-the-renderthread.1011172/">Unity Forumçš„è§£ç­”</a></p><h3 id="CPUUsage-TimeLineè§†å›¾ä¸­å¸¸è§çš„Marker">CPUUsage TimeLineè§†å›¾ä¸­å¸¸è§çš„Marker</h3><ul><li>Gfx.WaitForGfxCommandsFromMainThread : æ­¤Markerä¼šå‡ºç°åœ¨RenderThreadä¸Šï¼Œ</li></ul><img src="/posts/6e973c22/image.png" class=""><h2 id="Memory-Profiler">Memory Profiler</h2><h2 id="Frame-Debugger">Frame Debugger</h2><h1>å¯¹DrawCall Batch SetCallPassçš„ç†è§£</h1><p>åœ¨Unityçš„Gameçª—å£çš„å·¥å…·æ ä¸Šæœ‰ä¸€ä¸ªLabelå«Statsï¼Œæ¿€æ´»è¯¥Labelåœ¨Gameçª—å£ä¸­ä¼šå‡ºç°ä¸€ä¸ªåå«Statisticçš„å°å¼¹çª—ã€‚<br>ä½ å¯ä»¥åœ¨è¿™ä¸ªå°å¼¹çª—ä¸­æ‰¾åˆ°Batcheså’ŒSetPass callsä¸¤ä¸ªå­—æ®µã€‚</p><p>é‚£ä¹ˆSetPass Callså’ŒBatchesæ˜¯ä»€ä¹ˆï¼Ÿ<br>DrawCallåˆæ˜¯ä»€ä¹ˆï¼Ÿ<br>SetPass Call Batchå’ŒDrawCallçš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ<br>DrawCallæ˜¯ä¸€ä¸ªåœ¨CPUä¸Šçš„æ“ä½œï¼Œå®ƒæŒ‡çš„æ˜¯CPUå‘GPUå‘é€ä¸€æ¬¡ç»˜åˆ¶æ“ä½œçš„å‘½ä»¤ï¼Œ</p><p>åœ¨ä»‹ç»SetPassCallä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç¡®ä¿æˆ‘ä»¬èƒ½å¤Ÿå¯¹Shaderæœ‰ä¸€ä¸ªåŸºæœ¬çš„äº†è§£ï¼ŒShaderçš„ç»“æ„ä¸­ä¼šå«æœ‰ä¸€ä¸ªPass<br>SetPassCallå°±å’Œåœºæ™¯ä¸­æ‰€æœ‰çš„Materialä½¿ç”¨çš„Shaderçš„Passçš„ä¸ªæ•°æœ‰å…³ï¼Œ SetPassCallä¹Ÿæ˜¯CPUå‘GPUå‘é€çš„ä¸€ç§æŒ‡ä»¤ï¼Œç”¨æ¥å‘Šè¯‰GPUè¦æ›´æ¢ä½¿ç”¨çš„Pass</p><p>Batchesç¿»è¯‘è¿‡æ¥æ˜¯æ‰¹æ¬¡ï¼Œå®ƒä»£è¡¨ç€åœ¨è¿™ä¸€å¸§ä¸­CPUå‘GPUè¾“é€çš„ç»˜åˆ¶ç‰©ä½“çš„æ¬¡æ•°</p><p>è¿™æ˜¯Unityçš„Dynamic BatchingæŠ€æœ¯ï¼Œå¦‚æœæ²¡æœ‰è¿™é¡¹æŠ€æœ¯çš„è¯ï¼Œå°±ä¼šäº§ç”Ÿå¤§é‡çš„DrawCallï¼ŒBatchçš„æ„æ€æ˜¯å°†å¤šä¸ªDrawCallåˆå¹¶æˆä¸€ä¸ªDrawCall Batchçš„æ•°é‡ä¹Ÿå°±æ˜¯CPUå‘GPUå‘é€ç»˜åˆ¶å‘½ä»¤çš„æ¬¡æ•°</p><p>åœ¨è¯´Batcheså­—æ®µçš„å«ä¹‰ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹Unityçš„<a href="https://docs.unity3d.com/Manual/DrawCallBatching.html">åˆæ‰¹(Batching)</a>æŠ€æœ¯ï¼Œè¿™é¡¹æŠ€æœ¯é€šè¿‡æŠŠä¸€äº›æ¸²æŸ“ä¿¡æ¯ç›¸åŒçš„ç‰©ä½“åˆå¹¶åœ¨ä¸€èµ·æ‰“åŒ…ä¸€å¹¶å‘é€ç»™GPUæ¸²æŸ“ï¼Œè¿™äº›ç‰©ä½“æœ¬æ¥è¦åˆ†æ‰¹æ¬¡å‘é€ç»™GPUï¼Œç°åœ¨åªéœ€è¦å‘é€ä¸€æ¬¡ï¼Œè¿™æ ·å°±é™ä½äº†CPUå’ŒGPUçš„æ¸²æŸ“æ¬¡æ•°ã€‚æ‰€ä»¥Batchesçš„å«ä¹‰å°±æ˜¯åœ¨ä¸€å¸§å†…CPUæœ€ç»ˆå‘GPUå‘é€ç»˜åˆ¶å‘½ä»¤çš„æ¬¡æ•°ï¼Œæˆ–è€…å«DrawCallæ•°ã€‚ä½†æ˜¯æŠŠBatcheså«åšDrawCallåœ¨å®˜æ–¹çš„è¯´æ³•ä¸­æ²¡æœ‰è¯´çš„å¾ˆæ˜ç¡®ï¼Œç¬”è€…è§‰å¾—å®˜æ–¹æ²¡æŠŠBatchå’ŒDrawCallçš„å…³ç³»è¯´çš„å¾ˆæ¸…æ¥šï¼ŒæŒ‰ç…§ç¬”è€…çš„ç†è§£ï¼ŒBatchingæŠ€æœ¯æŠŠåŸæœ¬éœ€è¦ç”¨å¤šä¸ªDrawCallå®Œæˆçš„ç»˜åˆ¶å‘½ä»¤åˆå¹¶åˆ°ä¸€ä¸ªæˆ–è€…å‡ ä¸ªDrawCall ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„åˆæ‰¹ï¼Œä¸è¿‡æœ‰å¯èƒ½è¿™äº›ç‰©ä½“çš„æ¸²æŸ“çŠ¶æ€ä¹Ÿç›¸åŒï¼Œä½†æ˜¯æœ€åè¿˜æ˜¯å› ä¸ºå„ç§åŸå› ä¸èƒ½åˆæ‰¹ï¼Œæœ‰å¯èƒ½åŸæœ¬åä¸ªDrawCallä¸èƒ½åˆå¹¶æˆä¸€ä¸ª ä½†æ˜¯èƒ½åˆå¹¶æˆä¸¤ä¸ªã€‚</p><ul><li>å¦‚æœCanvasä¸­çš„UIå…ƒç´ çš„Zè½´ä¸ä¸º0 å®ƒä»¬å°±æ— æ³•è¢«åˆæ‰¹</li></ul><h1>ä¸€äº›æƒ³è¯´çš„</h1><p>æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªååˆ†çç¢çš„äº‹ï¼Œåœ¨æ€§èƒ½ä¼˜åŒ–çš„è¿‡ç¨‹ä¸­äº†è§£äº†Unityåº•å±‚çš„æ‰§è¡Œé¡ºåºã€å†…å­˜ç®¡ç†ç­‰</p><h1>å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://unity.com/cn/resources/ultimate-guide-to-profiling-unity-games">Unityå®˜æ–¹æ€§èƒ½ä¼˜åŒ–æŒ‡å¯¼ä¹¦</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¡¬æŠ€èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
            <tag> Unity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‘å¸ƒè‡ªå®šä¹‰UnityPackageåˆ°ä»£ç æ‰˜ç®¡å¹³å°</title>
      <link href="/posts/a795165c/"/>
      <url>/posts/a795165c/</url>
      
        <content type="html"><![CDATA[<h1>èƒŒæ™¯</h1><p>ç¬”è€…æ­£ç­¹åˆ’æ­å»ºè‡ªå·±çš„æ¸¸æˆæ¡†æ¶ï¼Œå¹¶å¸Œæœ›åŸºäºGithubå’ŒGiteeè¿™ç±»ä»£ç æ‰˜ç®¡å¹³å°ç»´æŠ¤å’Œè¿­ä»£ï¼Œå®ç°åœ¨å¼€å‘æ–°æ¸¸æˆæ—¶å¿«é€Ÿç§»æ¤ã€‚æœ¬æ–‡è®°å½•ç¬”è€…å°†ä»£ç å‘å¸ƒåˆ°Giteeä¸Šçš„è¿‡ç¨‹ã€‚</p><h1>åˆ¶å®šè§„èŒƒ</h1><p>ä¸€ä¸ªæ ‡å‡†UnityPackageçš„å†…éƒ¨ç»“æ„å¤§è‡´å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ CHANGELOG.md</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ LICENSE.md</span><br><span class="line">â”œâ”€â”€ Code</span><br><span class="line">â””â”€â”€ package.json</span><br></pre></td></tr></table></figure><ul><li>READMEç”¨æ¥ä»‹ç»Packageçš„åŠŸèƒ½å’Œç”¨æ³•ï¼›CHANGELOGç”¨æ¥è®°å½•Packageæ‰€æœ‰å†å²ç‰ˆæœ¬åŠŸèƒ½ä¿®æ”¹ã€æ–°å¢å’Œç»´æŠ¤æ—¥å¿—ï¼›READMEå’ŒCHANGELOGä¸æ˜¯å¿…é¡»çš„ï¼Œä½†å®ƒä»¬å¯ä»¥ä½œä¸ºè¾…åŠ©æ–‡æ¡£å¸®åŠ©ä½¿ç”¨è€…æ›´å¥½çš„ç†è§£å’Œä½¿ç”¨è¯¥Packageï¼›è€Œä¸”ç»´æŠ¤READMEå’ŒCHANGELOGæ›´æ–°å¯ä»¥ç£ä¿ƒæˆ‘ä»¬å…»æˆè‰¯å¥½çš„å¼€å‘ä¹ æƒ¯ã€‚</li><li>LICENSEæ˜¯å¼€æºè®¸å¯ï¼Œå¦‚æœä½ å¯¹ä½ çš„ä»£ç ç‰ˆæƒä¸æ˜¯å¾ˆé‡è§†çš„è¯ï¼Œè¿™ä¹Ÿæ˜¯éå¿…éœ€çš„ï¼›ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æœ€å®½æ¾çš„<a href="https://opensource.org/license/mit">MITå¼€æºè®¸å¯</a>ã€‚</li><li>Codeæ˜¯Packageä¸­å®ç°åŠŸèƒ½çš„ä»£ç éƒ¨åˆ†äº†ï¼Œè¿™ä¸€éƒ¨åˆ†çš„ç»†èŠ‚ä¼šåœ¨å®è·µç« èŠ‚ä¸­é˜è¿°ã€‚</li><li>package.jsonæ˜¯Packageä¸­æœ€é‡è¦çš„æ–‡ä»¶ï¼Œå®ƒè®°å½•äº†Packageçš„ç‰ˆæœ¬ã€urlç­‰å„ç§èƒ½å¤Ÿæ ‡è¯†è¯¥Packageçš„ä¿¡æ¯ï¼Œæ¨¡æ¿å¯ä»¥å‚è€ƒ<a href="https://docs.npmjs.com/cli/v10/configuring-npm/package-json">npmå®˜æ–¹æ–‡æ¡£</a>ï¼Œç¬”è€…åœ¨å®è·µç« èŠ‚ä¹Ÿä¼šç»™å‡ºè‡ªå·±ä½¿ç”¨åˆ°çš„æ¨¡ç‰ˆä¸­çš„å­—æ®µã€‚</li></ul><h1>å®è·µ</h1><ul><li><p>é¦–å…ˆåˆ›å»ºå¥½æœ¬åœ°é¡¹ç›®å’Œè¿œç«¯çš„ä»“åº“ï¼Œåœ¨Assetä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ä½œä¸ºPackageçš„æ ¹è·¯å¾„ï¼Œä¾æ¬¡åˆ›å»ºå¥½ï¼š<code>README</code>ã€<code>CHANGELOG</code>ã€<code>LICENSE</code>å’Œ<code>package.json</code>æ–‡ä»¶ã€‚</p></li><li><p>ç¼–å†™package.jsonä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;name&quot;: &quot;com.eddielee.candle-gameframework&quot;,</span><br><span class="line">&quot;displayName&quot;: &quot;Candle Game Framework&quot;,</span><br><span class="line">&quot;description&quot;: &quot;This is a game framework&quot;,</span><br><span class="line">&quot;version&quot;: &quot;0.2.2&quot;,</span><br><span class="line">&quot;repository&quot;: &#123;</span><br><span class="line">  &quot;type&quot;: &quot;git&quot;,</span><br><span class="line">  &quot;url&quot;: &quot;git+https://gitee.com/SoIncredible/candle-game-framework.git&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;author&quot;: &#123;</span><br><span class="line">  &quot;name&quot;: &quot;eddie-lee&quot;,</span><br><span class="line">  &quot;email&quot;: &quot;2636060652@qq.com&quot;,</span><br><span class="line">  &quot;url&quot;: &quot;https://soincredible777.com.cn&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;dependencies&quot;: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç¼–å†™Packageä»£ç <br>å¦‚æœæˆ‘ä»¬ä¸åšä»»ä½•æ“ä½œï¼Œæˆ‘ä»¬ç¼–å†™çš„ä»£ç ä¼šè¢«å½’å±åˆ°åä¸º<code>Assembly-CSharp</code>çš„ç¨‹åºé›†ä¸­ï¼Œä½ å¯ä»¥åœ¨Unityé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶ã€‚ä¸ºäº†è®©Packageçš„ä»£ç ç‹¬å±äºä¸€ä¸ªç¨‹åºé›†ï¼Œæˆ‘ä»¬è¦<a href="https://docs.unity3d.com/Manual/ScriptCompilationAssemblyDefinitionFiles.html">åˆ’åˆ†ç¨‹åºé›†</a>ã€‚è™½ç„¶è¿™ä¸€æ­¥æ˜¯éå¿…éœ€çš„ï¼Œä½†æ˜¯æœ‰æ„è¯†çš„åˆ’åˆ†ç¨‹åºé›†èƒ½å¤ŸåŠ å¿«ä½ çš„ç¼–è¯‘é€Ÿåº¦å’Œä»£ç ç»“æ„çš„æ¸…æ™°åº¦ï¼Œä½¿æ•´ä¸ªé¡¹ç›®æ›´æ˜“äºç®¡ç†å’Œç»´æŠ¤ã€‚<br>åœ¨æœ¬æ–‡ç¤ºä¾‹ä¸­ï¼Œç¬”è€…åœ¨Packageæ ¹ç›®å½•ä¸‹åˆ›å»º<code>Editor</code>å’Œ<code>Runtime</code>ä¸¤ä¸ªå­ç›®å½•åŒ…å«åœ¨Editorå’ŒRuntimeä¸‹è¿è¡Œçš„ä»£ç ï¼Œç„¶ååœ¨è¿™ä¸¤ä¸ªç›®å½•ä¸‹æ‰§è¡Œ<code>Assets -&gt; Create -&gt; Assembly Definition</code>, åˆ›å»º<code>asmdef</code>æ–‡ä»¶ã€‚æ³¨æ„ç¨‹åºé›†æ–‡ä»¶çš„åå­—å’Œç¼–è¯‘åç¨‹åºé›†åå­—å’Œè¯¥æ˜¯æ²¡æœ‰å…³ç³»çš„ï¼Œç¨‹åºé›†çš„å‘½åç”±Inspectorçª—å£ä¸­çš„Nameå­—æ®µå†³å®šã€‚å¦å¤–åœ¨Inspectorçª—å£ä¸­ï¼ŒRuntimeç›®å½•ä¸‹çš„ç¨‹åºé›†è¦åœ¨Platformséƒ¨åˆ†å‹¾æ‰€æœ‰å¹³å°éƒ½ä½¿ç”¨ï¼Œè€ŒEditorç›®å½•ä¸‹çš„ç¨‹åºé›†å‹¾é€‰åªåœ¨Editorç¯å¢ƒä¸‹ä½¿ç”¨ã€‚</p></li><li><p>ç¼–å†™å¥½ä»£ç ä¹‹åæˆ‘ä»¬å°±å¯ä»¥å°†æˆ‘ä»¬çš„ä»£ç ä¸Šä¼ äº†ã€‚æŒ‰é¡ºåºè¾“å…¥ä»¥ä¸‹æŒ‡ä»¤</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git subtree split --prefix=Assets/yourPackageName --branch upm</span><br><span class="line"></span><br><span class="line">git tag 1.0.0 upm</span><br><span class="line"></span><br><span class="line">git push origin upm --tags</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><p>å®Œæˆä»¥ä¸Šæ“ä½œæˆ‘ä»¬å°±å®Œæˆäº†UnityPackageçš„å‘å¸ƒã€‚</p><h1>å®‰è£…æˆ‘ä»¬çš„Package</h1><p>æ‰“å¼€Packagesä¸‹é¢çš„manifest.jsonæ–‡ä»¶ï¼Œåœ¨&quot;dependencies&quot;ä¸­è¾“å…¥æˆ‘ä»¬çš„åŒ…åå’ŒGitä»“åº“çš„åœ°å€ï¼Œæ³¨æ„ï¼Œä»æµè§ˆå™¨ä¸Šå¤åˆ¶çš„Gitä»“åº“åœ°å€æ˜¯ä¸å¸¦.gitçš„ï¼Œå¦‚æœä¸å¸¦.git Unityä¼šæç¤ºä½ æ‰¾ä¸åˆ°è¿™ä¸ªä»“åº“ï¼ŒåŒæ—¶æˆ‘ä»¬è¿˜éœ€è¦æ·»åŠ #1.0.0è¿™æ ·çš„æ•°å­—åœ¨æœ«å°¾æ¥å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„Packageç‰ˆæœ¬</p><p>å¼€å‘åç»­ç‰ˆæœ¬çš„æ—¶å€™ï¼Œè®°å¾—æ›´æ–°ChangeLogã€Readmeè¿˜æœ‰package.jsonä¸­çš„ä¿¡æ¯ã€‚</p><h2 id="æ³¨æ„">æ³¨æ„</h2><p>æ³¨æ„åœ¨é…ç½®package.jsonçš„æ—¶å€™ ä¸€å®šè¦åœ¨git repositoryçš„urlå‰é¢æ·»åŠ git+,å¹¶ä¸”åœ¨urlçš„æœ€åæ·»åŠ .gitï¼Œè€Œä¸”åœ¨å…¶ä»–é¡¹ç›®ä¸­å¼•ç”¨è¿™ä¸ªåŒ…çš„æ—¶å€™ä¹Ÿè¦åœ¨urlçš„æœ€åæ·»åŠ .git</p><h1>å‚è€ƒèµ„æ–™</h1><p><a href="https://docs.unity3d.com/cn/2022.3/Manual/CustomPackages.html">Unityå®˜æ–¹åˆ›å»ºè‡ªå®šä¹‰åŒ…</a></p><p><a href="https://semver.org/lang/zh-CN/">è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶ä»‹ç»</a></p><p><a href="https://blog.csdn.net/qq_42672770/article/details/131193440">æ·±å…¥ç†è§£Unityçš„Asmdef</a></p><p><a href="https://zhuanlan.zhihu.com/p/258129649">ã€æ•™ç¨‹ã€‘ä½¿ç”¨gité€šè¿‡umpå‘å¸ƒUnityæ’ä»¶åŒ…ï¼ˆPackageManagerï¼‰</a></p><p><a href="https://www.patreon.com/posts/25070968">Tutorial: How to develop a package for UnityPackageManager</a></p><p><a href="https://yomunchan.moe/Post/582">ä½¿ç”¨OpenUPMå‘å¸ƒè‡ªå·±çš„Unityé¡¹ç›®</a></p><p><a href="https://docs.npmjs.com/cli/v10/configuring-npm/package-json">NPM Doc: package.json</a></p><p><a href="https://www.ruanyifeng.com/blog/2017/10/open-source-license-tutorial.html">å¼€æºè®¸å¯ä»‹ç»</a></p>]]></content>
      
      
      <categories>
          
          <category> ç¡¬æŠ€èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æŠ€æœ¯æ–‡æ¡£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UnityShaderå…¥é—¨ç²¾è¦ç¬”è®°ï¼ˆå…­ï¼‰â€”â€”Unityä¸­çš„åŸºç¡€å…‰ç…§</title>
      <link href="/posts/eb885af0/"/>
      <url>/posts/eb885af0/</url>
      
        <content type="html"><![CDATA[<h1>æˆ‘ä»¬å¦‚ä½•çœ‹åˆ°è¿™ä¸ªä¸–ç•Œ</h1><p>å½“æˆ‘ä»¬è¯´ä¸€ä¸ªç‰©ä½“çš„é¢œè‰²æ˜¯çº¢è‰²æ—¶ï¼Œæ˜¯å› ä¸ºè¿™ä¸ªç‰©ä½“æ›´å¤šåœ°åå°„äº†çº¢å…‰æ³¢é•¿ï¼Œè€Œå¸æ”¶äº†å…¶ä»–æ³¢é•¿ã€‚è¦åœ¨è®¡ç®—æœºä¸Šæ¨¡æ‹ŸçœŸå®çš„å…‰ç…§ç¯å¢ƒæ¥ç”Ÿæˆä¸€å¼ å›¾åƒï¼Œéœ€è¦è€ƒè™‘ä¸‰ä¸ªè¿‡ç¨‹ï¼š</p><ul><li><p>é¦–å…ˆï¼Œ å…‰çº¿ä»å…‰æºä¸­è¢«å‘å°„å‡ºæ¥</p></li><li><p>ç„¶åï¼Œå…‰çº¿å’Œåœºæ™¯ä¸­çš„ä¸€äº›ç‰©ä½“ç›¸äº¤ï¼›ä¸€äº›å…‰çº¿è¢«ç‰©ä½“å¸æ”¶äº†ï¼Œè€Œå¦ä¸€äº›å…‰çº¿è¢«æ•£å°„åˆ°å…¶ä»–æ–¹å‘äº†</p></li><li><p>æœ€åï¼Œæ‘„åƒæœºå¸æ”¶äº†ä¸€äº›å…‰ï¼Œäº§ç”Ÿäº†ä¸€å¼ å›¾åƒ</p></li></ul><h2 id="å…‰æº">å…‰æº</h2><p>åœ¨å…‰å­¦ä¸­ï¼Œä½¿ç”¨<code>è¾ç…§åº¦(irradiance)</code>æ¥é‡åŒ–å…‰ã€‚æˆ‘ä»¬ç”¨<code>l</code>æ¥è¡¨ç¤ºå…‰çº¿çš„ä»å…‰æºå°„å‡ºçš„æ–¹å‘ï¼Œå¯¹äºå¹³è¡Œå…‰æ¥è¯´ï¼Œå®ƒçš„è¾ç…§åº¦å¯ä»¥ç”¨è¿‡è®¡ç®—åœ¨å‚ç›´äº<code>l</code>çš„å•ä½é¢ç§¯ä¸Šå•ä½æ—¶é—´å†…ç©¿è¿‡çš„èƒ½é‡æ¥å¾—åˆ°ã€‚æ³¨æ„è¿™ä¸ªå€¼è¡¨ç¤ºçš„æ˜¯<strong>å‚ç›´</strong>äºå…‰çº¿æ–¹å‘ä¸Šçš„è¾ç…§åº¦ï¼Œè€Œæˆ‘ä»¬åœ¨è®¡ç®—å…‰ç…§æ¨¡å‹ä¸­ï¼Œéœ€è¦çŸ¥é“çš„æ˜¯ç‰©ä½“è¡¨é¢çš„è¾ç…§åº¦ï¼Œç‰©ä½“çš„è¡¨é¢å¾€å¾€æ˜¯ä¸å‚ç›´äº<code>l</code>çš„ï¼Œæ‰€ä»¥ä¸ºäº†å¾—åˆ°ç‰©ä½“è¡¨é¢çš„è¾ç…§åº¦ï¼Œæˆ‘ä»¬éœ€è¦ç”¨å…‰çº¿æ–¹å‘<code>l</code>å’Œç‰©ä½“è¡¨é¢å‘ç°<code>n</code>ä¹‹é—´å¤¹è§’çš„ä½™å¼¦å€¼æ¥å¾—åˆ°ã€‚</p><h2 id="å¸æ”¶å’Œæ•£å°„">å¸æ”¶å’Œæ•£å°„</h2><p>å…‰çº¿ç”±å…‰æºå‘å°„å‡ºæ¥ä¹‹åï¼Œå°±ä¼šå’Œä¸€äº›ç‰©ä½“ç›¸äº¤ã€‚é€šå¸¸ç›¸äº¤çš„ç»“æœæœ‰ä¸¤ä¸ªï¼šæ•£å°„(scattering)å’Œå¸æ”¶(absorption)ã€‚</p><p><strong>æ•£å°„åªæ”¹å˜å…‰çº¿çš„æ–¹å‘ï¼Œä½†æ˜¯ä¸æ”¹å˜å…‰çº¿çš„å¯†åº¦å’Œé¢œè‰²ã€‚è€Œå¸æ”¶åªæ”¹å˜å…‰çº¿çš„å¯†åº¦å’Œé¢œè‰²ï¼Œä¸æ”¹å˜å…‰çš„æ–¹å‘ã€‚</strong></p><p>æˆ‘ä»¬é‡ç‚¹çœ‹æ•£å°„éƒ¨åˆ†ï¼Œæ•£å°„çš„ç»“æœä¹Ÿå¯ä»¥åˆ†æˆä¸¤ç§ï¼Œç¬¬ä¸€ç§æ˜¯æ•£å°„åˆ°ç‰©ä½“å†…éƒ¨ï¼Œè¢«ç§°ä¸ºæŠ˜å°„(refraction)æˆ–è€…é€å°„(transmission)ï¼›ç¬¬äºŒç§æ˜¯æ•£å°„åˆ°å¤–éƒ¨ï¼Œè¢«ç§°ä¸ºåå°„(reflection)ã€‚è¯·åå¤ç†è§£è¿™å¥è¯ï¼š<strong>æ•£å°„åˆ°å†…éƒ¨çš„å…‰ä¼šä¸ç‰©ä½“å†…éƒ¨çš„é¢—ç²’ç›¸äº¤ï¼Œå…¶ä¸­ä¸€äº›å…‰çº¿æœ€åä¼šé‡æ–°å‘å°„å‡ºç‰©ä½“è¡¨é¢ï¼Œè€Œå¦ä¸€äº›åˆ™è¢«ç‰©ä½“å¸æ”¶ï¼Œè¿™äº›ä»ç‰©ä½“è¡¨é¢é‡æ–°å‘å°„å‡ºçš„å…‰çº¿å°†å…·æœ‰å’Œå…¥å°„å…‰çº¿ä¸åŒçš„æ–¹å‘åˆ†å¸ƒå’Œé¢œè‰²ã€‚è¿™ä¸ªè¿‡ç¨‹å³åŒ…æ‹¬æ•£å°„ä¹ŸåŒ…æ‹¬å¸æ”¶ã€‚<strong>ä¸ºäº†åŒºåˆ†è¿™ä¸¤ç§ä¸åŒçš„æ•£å°„æ–¹å‘ï¼Œæˆ‘ä»¬åœ¨å…‰ç…§æ¨¡å‹ä¸­ä½¿ç”¨äº†ä¸åŒçš„éƒ¨åˆ†æ¥è®¡ç®—å®ƒä»¬ï¼š<code>é«˜å…‰åå°„(specular)</code>éƒ¨åˆ†è¡¨ç¤ºç‰©ä½“è¡¨é¢æ˜¯å¦‚ä½•åå°„å…‰çº¿çš„ï¼Œé«˜å…‰åå°„ä¸ä¼šæ”¹å˜å…‰çº¿çš„é¢œè‰²ï¼Œ<code>æ¼«åå°„(diffuse)</code>éƒ¨åˆ†è¡¨ç¤ºæœ‰å¤šå°‘å…‰ä¼š</strong>è¢«æŠ˜å°„ã€å¸æ”¶å’Œæ•£å°„</strong>å‡ºè¡¨é¢ã€‚æ ¹æ®å…¥å°„å…‰çº¿çš„æ•°é‡å’Œæ–¹å‘ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºå°„å…‰çº¿çš„æ•°é‡å’Œæ–¹å‘ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨<code>å‡ºå°„åº¦(exitance)</code>æ¥æè¿°å®ƒã€‚è¾ç…§åº¦å’Œå‡ºå°„åº¦ä¹‹é—´æ˜¯æ»¡è¶³çº¿æ€§å…³ç³»çš„ï¼Œ<strong>å®ƒä»¬ä¹‹é—´çš„æ¯”å€¼å°±æ˜¯æè´¨çš„æ¼«åå°„å’Œé«˜å…‰åå°„å±æ€§</strong>ã€‚</p><img src="/posts/eb885af0/1.png" class=""><h2 id="ç€è‰²">ç€è‰²</h2><p><code>ç€è‰²(Shading)</code>æŒ‡çš„æ˜¯ï¼šæ ¹æ®æè´¨å±æ€§ï¼ˆå¦‚æ¼«åå°„å±æ€§ï¼‰ã€å…‰æºä¿¡æ¯ï¼ˆå¦‚å…‰æºæ–¹å‘ã€è¾ç…§åº¦ï¼‰ï¼Œä½¿ç”¨ä¸€ä¸ªç­‰å¼å»è®¡ç®—<strong>æ²¿ç€æŸä¸ªè§‚å¯Ÿæ–¹å‘çš„å‡ºå°„åº¦</strong>çš„è¿‡ç¨‹ã€‚</p><h2 id="BRDFå…‰ç…§æ¨¡å‹">BRDFå…‰ç…§æ¨¡å‹</h2><p><code>BRDF(Bidirectional Reflectance Distribution Function)</code> å½“ç»™å®šæ¨¡å‹è¡¨é¢ä¸Šä¸€ä¸ªç‚¹æ—¶ï¼ŒBRDFåŒ…å«äº†å¯¹è¯¥ç‚¹å¤–è§‚çš„å®Œæ•´çš„æè¿°ã€‚åœ¨å›¾å½¢å­¦ä¸­ï¼ŒBRDFå¤§å¤šä½¿ç”¨ä¸€ä¸ªæ•°å­¦å…¬å¼æ¥è¡¨ç¤ºï¼Œå¹¶ä¸”æä¾›äº†åœ¨ä¸€äº›å‚æ•°æ¥è°ƒæ•´æè´¨å±æ€§ã€‚åœ¨ç»™å®šå…¥å°„å…‰çº¿çš„æ–¹å‘å’Œè¾ç…§åº¦ä¹‹åï¼ŒBRDFæŸä¸ªå‡ºå°„æ–¹å‘ä¸Šçš„å…‰ç…§èƒ½é‡åˆ†å¸ƒã€‚</p><p><strong>è®¡ç®—æœºå›¾å½¢å­¦ç¬¬ä¸€å®šå¾‹ï¼šå¦‚æœå®ƒçœ‹èµ·æ¥æ˜¯å¯¹çš„ï¼Œé‚£ä¹ˆé‚£å°±æ˜¯å¯¹çš„ã€‚</strong></p><p>ç„¶è€Œæœ‰æ—¶æˆ‘ä»¬å¸Œæœ›å¯ä»¥æ›´åŠ çœŸå®åœ°æ¨¡æ‹Ÿå…‰å’Œç‰©ä½“çš„äº¤äº’ï¼Œè¿™å°±å‡ºç°äº†<strong>åŸºäºç‰©ç†</strong>çš„BRDFæ¨¡å‹ï¼Œåœ¨ä¹‹åçš„ç« èŠ‚ä¼šè¿›è¡Œé˜è¿°ã€‚</p><h1>æ ‡å‡†å…‰ç…§æ¨¡å‹</h1><p>æ ‡å‡†å…‰ç…§æ¨¡å‹ç”±å­¦è€…è£´ç¥¥é£(Bui Tuong Phong)æå‡ºï¼Œæ ‡å‡†å…‰ç…§æ¨¡å‹åªå…³å¿ƒç›´æ¥å…‰ç…§(direct light)ï¼Œä¹Ÿå°±æ˜¯é‚£äº›ç›´æ¥ä»å…‰æºå‘å°„å‡ºæ¥ç…§å°„åˆ°ç‰©ä½“è¡¨é¢åï¼Œç»è¿‡ç‰©ä½“è¡¨é¢çš„ä¸€æ¬¡åå°„ç›´æ¥è¿›å…¥æ‘„åƒæœºçš„å…‰çº¿ã€‚<br>å®ƒçš„åŸºæœ¬æ–¹æ³•æ˜¯ï¼ŒæŠŠè¿›å…¥åˆ°æ‘„åƒæœºå†…çš„å…‰çº¿åˆ†æˆ4ä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†ä½¿ç”¨å¼‚ç§éª¨æ–¹æ³•æ¥è®¡ç®—å®ƒçš„è´¡çŒ®åº¦ã€‚è¿™å››ä¸ªéƒ¨åˆ†æ˜¯ï¼š</p><ul><li><code>è‡ªå‘å…‰(emmissive)</code>éƒ¨åˆ†ï¼Œè¿™ä¸ªéƒ¨åˆ†ç”¨äºæè¿°å½“ç»™å®šä¸€ä¸ªæ–¹å‘æ—¶ï¼Œä¸€ä¸ªè¡¨é¢æœ¬èº«ä¼šå‘è¯¥æ–¹å‘å‘å°„å¤šå°‘è¾å°„é‡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ²¡æœ‰<code>å…¨å±€å…‰ç…§(global illumination)</code>ï¼Œè¿™äº›è‡ªå‘å…‰çš„è¡¨é¢å¹¶ä¸ä¼šçœŸçš„ç…§äº®å‘¨å›´çš„ç‰©ä½“ï¼Œè€Œæ˜¯å®ƒæœ¬èº«çœ‹èµ·æ¥æ›´äº®äº†è€Œå·²ã€‚</li><li><code>é«˜å…‰åå°„(specular)</code>éƒ¨åˆ†ï¼Œè¿™ä¸ªéƒ¨åˆ†ç”¨äºæè¿°å½“å…‰çº¿ä»å…‰æºç…§å°„åˆ°æ¨¡å‹è¡¨é¢æ—¶ï¼Œè¯¥è¡¨é¢ä¼šåœ¨å®Œå…¨é•œé¢åå°„æ–¹å‘æ•£å°„å¤šå°‘è¾å°„é‡ã€‚</li><li><code>æ¼«åå°„(diffuse)</code>éƒ¨åˆ†ï¼Œè¿™ä¸ªéƒ¨åˆ†ç”¨æ¥æè¿°ï¼Œå½“å…‰çº¿ä»å…‰æºç…§å°„åˆ°æ¨¡å‹è¡¨é¢æ—¶ï¼Œè¯¥è¡¨é¢ä¼šå‘æ¯ä¸ªæ–¹å‘æ•£å°„å¤šå°‘è¾å°„é‡ã€‚</li><li><code>ç¯å¢ƒå…‰(ambient)</code>éƒ¨åˆ†ï¼Œç”¨äºæè¿°å…¶ä»–æ‰€æœ‰çš„é—´æ¥å…‰ç…§ã€‚</li></ul><h2 id="ç¯å¢ƒå…‰">ç¯å¢ƒå…‰</h2><p>è™½ç„¶æ ‡å‡†å…‰ç…§æ¨¡å‹çš„é‡ç‚¹åœ¨äºæè¿°ç›´æ¥å…‰ç…§ï¼Œä½†æ˜¯åœ¨çœŸå®ä¸–ç•Œä¸­ï¼Œç‰©ä½“ä¹Ÿæ˜¯å¯ä»¥<code>é—´æ¥å…‰ç…§(indirect light)</code>æ‰€ç…§äº®ã€‚é—´æ¥å…‰ç…§æŒ‡çš„æ˜¯ï¼Œå…‰çº¿é€šå¸¸ä¼šåœ¨å¤šä¸ªç‰©ä½“ä¹‹é—´åå°„ï¼Œæœ€åè¿›å…¥æ‘„åƒæœºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…‰çº¿åœ¨è¿›å…¥æ‘„åƒæœºä¹‹å‰ï¼Œç»è¿‡äº†ä¸æ­¢ä¸€æ¬¡çš„ç‰©ä½“åå°„ã€‚ä¾‹å¦‚åœ¨çº¢è‰²åœ°æ¯¯ä¸Šæ”¾ç½®ä¸€ä¸ªç°è‰²çš„æ²™å‘ï¼Œé‚£ä¹ˆæ²™å‘åº•éƒ¨ä¹Ÿä¼šæœ‰çº¢è‰²ï¼Œè¿™äº›çº¢è‰²æ˜¯ç”±åœ°æ¯¯åå°„äº†ä¸€éƒ¨åˆ†å…‰çº¿ï¼Œå†åå°„åˆ°æ²™å‘ä¸Šçš„ã€‚</p><p>åœ¨æ ‡å‡†å…‰ç…§æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ç§è¢«ç§°ä¸ºç¯å¢ƒå…‰çš„éƒ¨åˆ†æ¥è¿‘ä¼¼æ¨¡æ‹Ÿé—´æ¥å…‰ç…§ã€‚ç¯å¢ƒå…‰çš„è®¡ç®—ååˆ†ç®€å•ï¼Œå®ƒé€šå¸¸æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå³åœºæ™¯ä¸­çš„æ‰€æœ‰ç‰©ä½“éƒ½ä½¿ç”¨è¿™ä¸ªç¯å¢ƒå…‰ã€‚ä¸‹é¢è¿™ä¸ªç­‰å¼ç»™å‡ºäº†è®¡ç®—ç¯å¢ƒå…‰çš„éƒ¨åˆ†ï¼š</p><p>$$c_{ambient} = g_{ambient}$$</p><h2 id="è‡ªå‘å…‰">è‡ªå‘å…‰</h2><p>å…‰çº¿ä¹Ÿå¯ä»¥ç›´æ¥ç”±å…‰æºå‘å°„è¿›å…¥æ‘„åƒæœºï¼Œè€Œä¸éœ€è¦ç»è¿‡ä»»ä½•ç‰©ä½“çš„åå°„ã€‚æ ‡å‡†å…‰ç…§æ¨¡å‹ä½¿ç”¨è‡ªå‘å…‰æ¥è®¡ç®—è¿™ä¸ªéƒ¨åˆ†çš„è´¡çŒ®åº¦ã€‚å®ƒçš„è®¡ç®—ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ç›´æ¥ä½¿ç”¨äº†è¯¥æè´¨çš„è‡ªå‘å…‰é¢œè‰²ï¼š<br>$$c_{emissive} = m_{emissive}$$<br>é€šå¸¸åœ¨å®æ—¶æ¸²æŸ“ä¸­ï¼Œè‡ªå‘å…‰çš„è¡¨é¢å¾€å¾€ä¸ä¼šç…§äº®å‘¨å›´çš„è¡¨é¢ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªç‰©ä½“å¹¶ä¸ä¼šè¢«å½“æˆä¸€ä¸ªå…‰æºã€‚Unity5ä¸­å¼•å…¥äº†å…¨æ–°çš„å…¨å±€å…‰ç…§ç³»ç»Ÿå¯ä»¥æ¨¡æ‹Ÿè¿™ç±»è‡ªå‘å…‰ç‰©ä½“å¯¹å‘¨å›´ç‰©ä½“çš„å½±å“ï¼Œåœ¨ä¹‹åçš„ç« èŠ‚ä¼šé˜è¿°ã€‚</p><h2 id="æ¼«åå°„">æ¼«åå°„</h2><p>æ¼«åå°„å…‰ç…§æ˜¯ç”¨äºå¯¹é‚£äº›è¢«ç‰©ä½“è¡¨é¢éšæœºæ•£å°„åˆ°å„ä¸ªæ–¹å‘çš„è¾å°„åº¦è¿›è¡Œå»ºæ¨¡çš„ã€‚åœ¨æ¼«åå°„ä¸­ï¼Œè§†è§’çš„ä½ç½®æ˜¯ä¸é‡è¦çš„ï¼Œå› ä¸ºåå°„æ˜¯å®Œå…¨éšæœºçš„ï¼Œå› æ­¤å¯ä»¥è®¤ä¸ºåœ¨ä»»ä½•åå°„æ–¹å‘ä¸Šçš„åˆ†å¸ƒéƒ½æ˜¯ä¸€æ ·çš„ã€‚åˆ°é‚£æ—¶ï¼Œå…¥å°„å…‰çº¿çš„è§’åº¦å¾ˆé‡è¦ã€‚<br>æ¼«åå°„å…‰ç…§ç¬¦åˆ<code>å…°ä¼¯ç‰¹å®šå¾‹(Lambert's law)</code>:<strong>åå°„å…‰çº¿çš„å¼ºåº¦ä¸è¡¨é¢æ³•çº¿å’Œå…‰æºæ–¹å‘ä¹‹é—´å¤¹è§’çš„ä½™å¼¦å€¼æˆæ­£æ¯”</strong>ã€‚å› æ­¤ï¼Œæ¼«åå°„éƒ¨åˆ†çš„è®¡ç®—å¦‚ä¸‹ï¼š</p><p>$$c_{diffuse} = (c_{light} Â· m_{diffuse})max(0, \vec{n} Â· \vec{l})$$</p><p>å…¶ä¸­$\vec{n}$æ˜¯è¡¨é¢æ³•çº¿ï¼Œ$\vec{l}$æ˜¯æŒ‡å‘å…‰æºçš„å•ä½çŸ¢é‡ï¼Œ$m_{diffuse}$æ˜¯æè´¨çš„æ¼«åå°„é¢œè‰²ï¼Œ$c_{light}$æ˜¯å…‰æºé¢œè‰²ã€‚éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬éœ€è¦é˜²æ­¢æ³•çº¿å’Œå…‰æºæ–¹å‘ç‚¹ç§¯çš„ç»“æœä¸ºè´Ÿå€¼ï¼Œä¸ºæ­¤æˆ‘ä»¬ä½¿ç”¨å–æœ€å¤§å€¼çš„å‡½æ•°æ¥å°†å…¶æˆªå–åˆ°0ï¼Œè¿™å¯ä»¥é˜²æ­¢ç‰©ä½“è¢«ä»åé¢æ¥çš„å…‰æºç…§äº®ã€‚</p><h2 id="é«˜å…‰åå°„">é«˜å…‰åå°„</h2><p>è¿™é‡Œçš„é«˜å…‰åå°„æ˜¯ä¸€ç§ç»éªŒæ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¹¶ä¸å®Œå…¨ç¬¦åˆçœŸå®ä¸–ç•Œä¸­çš„é«˜å…‰åå°„ç°è±¡ã€‚å®ƒå¯ç”¨äºè®¡ç®—é‚£äº›æ²¿ç€å®Œå…¨é•œé¢åå°„æ–¹å‘è¢«åå°„çš„å…‰çº¿ï¼Œè¿™å¯ä»¥è®©ç‰©ä½“çœ‹èµ·æ¥æ˜¯æœ‰å…‰æ³½çš„ï¼Œä¾‹å¦‚é‡‘å±æè´¨ã€‚</p><p>è®¡ç®—é«˜å…‰åå°„éœ€è¦çŸ¥é“çš„ä¿¡æ¯æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚è¡¨é¢æ³•çº¿ã€è§†è§’æ–¹å‘ã€å…‰æºæ–¹å‘ã€åå°„æ–¹å‘ç­‰ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å‡è®¾è¿™äº›çŸ¢é‡éƒ½æ˜¯å•ä½çŸ¢é‡ã€‚<br>åœ¨è¿™å››ä¸ªçŸ¢é‡ä¸­ï¼Œæˆ‘ä»¬å®é™…ä¸Šåªéœ€è¦çŸ¥é“å…¶ä¸­ä¸‰ä¸ªçŸ¢é‡å³å¯ï¼Œè€Œç¬¬å››ä¸ªçŸ¢é‡â€”â€”åå°„æ–¹å‘å¯ä»¥é€šè¿‡å…¶ä»–ä¿¡æ¯è®¡ç®—å¾—åˆ°ï¼š</p><p>$$\vec{r} = 2(\vec{n} Â· \vec{l})\vec{n} - \vec{l}$$</p><p>è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨Phongæ¨¡å‹æ¥è®¡ç®—é«˜å…‰åå°„çš„éƒ¨åˆ†ï¼š</p><p>$$c_{specular} = (c_{light} Â· m_{specular})max(0, \vec{v} Â· \vec{r})^{m_{gloss}}$$</p><p>å…¶ä¸­ï¼Œm_glowwæ˜¯æè´¨çš„<code>å…‰æ³½åº¦(gloss)</code>ï¼Œä¹Ÿè¢«ç§°ä¸º<code>åå…‰åº¦(shiniess)</code>ã€‚å®ƒç”¨äºæ§åˆ¶é«˜å…‰åŒºåŸŸçš„äº®ç‚¹æœ‰å¤šå®½,$m_{gloss}$è¶Šå¤§ï¼Œäº®ç‚¹å°±è¶Šå°ã€‚$m_{specular}$æ˜¯æè´¨çš„é«˜å…‰åå°„é¢œè‰²ï¼Œå®ƒç”¨äºæ§åˆ¶è¯¥æè´¨å¯¹äºé«˜å…‰åå°„çš„å¼ºåº¦å’Œé¢œè‰²ã€‚$c_{light}$åˆ™æ˜¯å…‰æºçš„é¢œè‰²å’Œå¼ºåº¦ã€‚åŒæ ·ï¼Œè¿™é‡Œä¹Ÿéœ€è¦é˜²æ­¢$\vec{v} Â· \vec{r}$çš„ç»“æœä¸ºè´Ÿæ•°ã€‚</p><p>å’Œä¸Šè¿°Phongæ¨¡å‹ç›¸æ¯”ï¼ŒBlinnæå‡ºäº†ä¸€ä¸ªç®€å•çš„ä¿®æ”¹æ–¹æ³•æ¥å¾—åˆ°ç±»ä¼¼çš„æ•ˆæœã€‚å®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼Œé¿å…è®¡ç®—åå°„æ–¹å‘$\vec{r}$ã€‚ä¸ºæ­¤Blinnæ¨¡å‹å¼•å…¥äº†ä¸€ä¸ªæ–°çš„çŸ¢é‡$\vec{h}$ï¼Œå®ƒæ˜¯é€šè¿‡å¯¹$\vec{v}$å’Œ$\vec{l}$çš„å–å¹³å‡åå†å½’ä¸€åŒ–å¾—åˆ°çš„ã€‚å³</p><p>$$\vec{h} = \frac{\vec{v} + \vec{l}}{|\vec{v} + \vec{l}|}$$</p><p>ç„¶åä½¿ç”¨$\vec{n}$å’Œ$\vec{h}$ä¹‹é—´çš„å¤¹è§’è¿›è¡Œè®¡ç®—ï¼Œè€Œé$\vec{v}$å’Œ$\vec{r}$ä¹‹é—´çš„å¤¹è§’<br>æ€»ç»“ä¸€ä¸‹ï¼ŒBlinnæ¨¡å‹çš„å…¬å¼å¦‚ä¸‹:</p><p>$$c_{specular} = (c_{light} Â· m_{specular})max(0, \vec{n} Â· \vec{h})^{m_{gloss}}$$</p><p>åœ¨ç¡¬ä»¶å®ç°æ—¶ï¼Œå¦‚æœæ‘„åƒæœºå’Œå…‰æºè·ç¦»æ¨¡å‹è¶³å¤Ÿè¿œçš„è¯ï¼ŒBlinnæ¨¡å‹ä¼šå¿«äºPhongæ¨¡å‹ï¼Œè¿™æ˜¯å› ä¸ºï¼Œæ­¤æ—¶å¯ä»¥è®¤ä¸º$\vec{v}$å’Œ$\vec{l}$éƒ½æ˜¯å®šå€¼ï¼Œå› æ­¤$\vec{h}$å°†æ˜¯ä¸€ä¸ªå¸¸é‡ï¼›ä½†æ˜¯å½“$\vec{v}$æˆ–è€…$\vec{l}$ä¸æ˜¯å®šå€¼çš„æ—¶å€™ï¼ŒPhongæ¨¡å‹å¯èƒ½åè€Œæ›´å¿«ä¸€äº›ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸¤ç§å…‰ç…§æ¨¡å‹éƒ½æ˜¯ç»éªŒæ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¸åº”è¯¥è®¤ä¸ºBlinnæ¨¡å‹æ˜¯â€œå¯¹æ­£ç¡®â€çš„Phongæ¨¡å‹çš„è¿‘ä¼¼ï¼Œå®é™…ä¸Šï¼Œåœ¨ä¸€äº›æƒ…å†µä¸‹ï¼ŒBlinnæ¨¡å‹æ›´ç¬¦åˆå®éªŒç»“æœã€‚</p><h2 id="é€åƒç´ è¿˜æ˜¯é€é¡¶ç‚¹">é€åƒç´ è¿˜æ˜¯é€é¡¶ç‚¹</h2><p>ä¸Šé¢æˆ‘ä»¬ç»™å‡ºäº†åŸºæœ¬å…‰ç…§æ¨¡å‹ä½¿ç”¨çš„æ•°å­¦å…¬å¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨å“ªé‡Œè®¡ç®—è¿™äº›å…‰ç…§æ¨¡å‹å‘¢ï¼Ÿé€šå¸¸æ¥è®²ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§é€‰æ‹©ï¼šåœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­è®¡ç®—ï¼Œä¹Ÿè¢«ç§°ä¸º<code>é€åƒç´ å…‰ç…§(per-pixel lighting)</code>ï¼›åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­è®¡ç®—ï¼Œä¹Ÿè¢«ç§°ä¸º<code>é€é¡¶ç‚¹å…‰ç…§(per-vertex lighting)</code>ã€‚<br>åœ¨é€åƒç´ å…‰ç…§ä¸­ï¼Œæˆ‘ä»¬ä¼šä»¥æ¯ä¸ªåƒç´ ä¸ºåŸºç¡€ï¼Œå¾—åˆ°å®ƒçš„æ³•çº¿(å¯ä»¥æ˜¯å¯¹é¡¶ç‚¹æ³•çº¿æ’å€¼å¾—åˆ°çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä»æ³•çº¿çº¹ç†ä¸­é‡‡æ ·å¾—åˆ°çš„)ï¼Œç„¶åè¿›è¡Œå…‰ç…§æ¨¡å‹çš„è®¡ç®—ã€‚è¿™ç§åœ¨é¢ç‰‡ä¹‹é—´å¯¹é¡¶ç‚¹æ³•çº¿è¿›è¡Œæ’å€¼çš„æŠ€æœ¯è¢«ç§°ä¸º<code>Phongç€è‰²(Phong shading)</code>ï¼Œä¹Ÿè¢«ç§°ä¸ºPhongæ’å€¼æˆ–è€…æ³•çº¿æ’å€¼ç€è‰²æŠ€æœ¯ã€‚è¿™ä¸åŒä¸æˆ‘ä»¬å‰é¢é™åˆ°çš„Phongå…‰ç…§æ¨¡å‹ã€‚</p><p>ä¸ä¹‹ç›¸å¯¹çš„æ˜¯é¡¶ç‚¹å…‰ç…§ï¼Œä¹Ÿè¢«ç§°ä¸º<code>é«˜æ´›å¾·ç€è‰²(Gouraud shading)</code>ã€‚åœ¨é€é¡¶ç‚¹å…‰ç…§ä¸­ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ªé¡¶ç‚¹ä¸Šè®¡ç®—å…‰ç…§ï¼Œç„¶åä¼šåœ¨æ¸²æŸ“å›¾å…ƒå†…éƒ¨è¿›è¡Œçº¿æ€§æ’å€¼ï¼Œæœ€åè¾“å‡ºæˆåƒç´ é¢œè‰²ã€‚ä½†æ˜¯ç”±äºé€é¡¶ç‚¹æ•°ç›®å¾€å¾€è¿œå°äºåƒç´ æ•°ç›®ï¼Œå› æ­¤é€é¡¶ç‚¹å…‰ç…§çš„è®¡ç®—é‡å¾€å¾€è¦å°äºé€åƒç´ çš„è®¡ç®—é‡ã€‚ä½†æ˜¯ï¼Œç”±äºé€é¡¶ç‚¹å…‰ç…§ä¾èµ–äºçº¿æ€§æ’å€¼æ¥å¾—åˆ°åƒç´ å…‰ç…§ï¼Œå› æ­¤å½“å…‰ç…§æ¨¡å‹ä¸­æœ‰éçº¿æ€§çš„è®¡ç®—(ä¾‹å¦‚è®¡ç®—é«˜å…‰åå°„æ—¶)ï¼Œé€é¡¶ç‚¹å…‰ç…§å°±ä¼šå‡ºé—®é¢˜ã€‚åœ¨åé¢çš„ç« èŠ‚ä¸­å°±ä¼šçœ‹åˆ°è¿™ç§æƒ…å†µã€‚è€Œä¸”ç”±äºé€é¡¶ç‚¹å…‰ç…§ä¼šåœ¨æ¸²æŸ“å›¾å…ƒå†…éƒ¨å¯¹é¡¶ç‚¹é¢œè‰²è¿›è¡Œæ’å€¼ï¼Œè¿™å›å¯¼è‡´æ¸²æŸ“å›¾å…ƒå†…éƒ¨çš„é¢œè‰²æ€»æ˜¯æš—äºé¡¶ç‚¹å¤„çš„æœ€é«˜é¢œè‰²å€¼ï¼Œè¿™åœ¨æŸäº›æƒ…å†µä¸‹ä¼šäº§ç”Ÿæ˜æ˜¾çš„æ£±è§’ç°è±¡ã€‚</p><p>æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœè¦æ¸²æŸ“ä¸€ä¸ªä¸‰è§’å½¢ï¼Œä½¿ç”¨é€é¡¶ç‚¹å…‰ç…§çš„è®¡ç®—æ–¹å¼æˆ‘ä»¬åªéœ€è¦è®¡ç®—ä¸‰ä¸ªé¡¶ç‚¹çš„å…‰ç…§ï¼Œè€Œå¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨é€åƒç´ çš„æ–¹å¼ï¼Œæ˜¾ç„¶æ„æˆè¿™ä¸ªä¸‰è§’å½¢çš„åƒç´ è¦å¤§äºä¸‰ã€‚å› æ­¤ï¼Œé€åƒç´ å…‰ç…§çš„æ€§èƒ½å¼€é”€è¦é«˜äºé€é¡¶ç‚¹å…‰ç…§ã€‚</p><h2 id="æ€»ç»“">æ€»ç»“</h2><p>è™½ç„¶æ ‡å‡†å…‰ç…§æ¨¡å‹ä»…ä»…æ˜¯ä¸€ä¸ª<strong>ç»éªŒæ¨¡å‹</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¹¶ä¸å®Œå…¨ç¬¦åˆçœŸå®ä¸–ç•Œçš„å…‰ç…§ç°è±¡ã€‚ä½†ç”±äºå®ƒçš„æ˜“ç”¨æ€§ã€è®¡ç®—é€Ÿåº¦å’Œå¾—åˆ°çš„æ•ˆæœéƒ½æ¯”è¾ƒå¥½ï¼Œå› æ­¤ä»ç„¶è¢«å¹¿æ³›ä½¿ç”¨ã€‚è€Œä¹Ÿæ˜¯ç”±äºå®ƒçš„å¹¿æ³›é€‚ç”¨æ€§ï¼Œè¿™ç§æ ‡å‡†å…‰ç…§æ¨¡å‹ç”±å¾ˆå¤šä¸åŒçš„å«æ³•ã€‚ä¾‹å¦‚ä¸€äº›èµ„æ–™ä¸­ç§°å®ƒä¸º<code>Phongå…‰ç…§æ¨¡å‹</code>ï¼Œå› ä¸ºè£´ç¥¥é£é¦–å…ˆæå‡ºäº†ä½¿ç”¨æ¼«åå°„å’Œé«˜å…‰åå°„çš„å’Œæ¥å¯¹åå°„å…‰ç…§å°½æ€§å»ºæ¨¡çš„åŸºæœ¬æ€æƒ³ï¼Œå¹¶ä¸”æå‡ºäº†åŸºäºç»éªŒçš„è®¡ç®—é«˜å…‰åå°„çš„æ–¹æ³•(ç”¨äºè®¡ç®—æ¼«åå°„å…‰ç…§çš„å…°ä¼¯ç‰¹æ¨¡å‹åœ¨é‚£æ—¶å·²ç»è¢«æå‡ºäº†)ã€‚éšåï¼Œç”±äºBlinnçš„æ–¹æ³•ç®€åŒ–äº†è®¡ç®—è€Œä¸”åœ¨æŸäº›æƒ…å†µä¸‹è®¡ç®—æ›´å¿«ï¼Œæˆ‘ä»¬æŠŠè¿™ç§æ¨¡å‹ç§°ä¸º<code>Blinn-Phongå…‰ç…§æ¨¡å‹</code>ã€‚</p><p>ä½†æ˜¯è¿™ç§æ¨¡å‹æœ‰å¾ˆå¤šå±€é™æ€§ã€‚é¦–å…ˆï¼Œæœ‰å¾ˆå¤šé‡è¦çš„ç‰©ç†ç°è±¡æ— æ³•ç”¨Blinn-Phongæ¨¡å‹è¡¨ç°å‡ºæ¥ï¼Œä¾‹å¦‚<code>è²æ¶…è€³åå°„(Fresnel reflection)</code>ã€‚å…¶æ¬¡ï¼ŒBlinn-Phongæ¨¡å‹æ˜¯<code>å„é¡¹åŒæ€§(isotropic)</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬å›ºå®šè§†è§’å’Œå…‰æºæ–¹å‘æ—‹è½¬è¿™ä¸ªè¡¨é¢çš„æ—¶å€™ï¼Œåå°„ä¸ä¼šå‘ç”Ÿä»»ä½•æ”¹å˜ã€‚ä½†æ˜¯æœ‰äº›è¡¨é¢æ˜¯å…·æœ‰<code>å„å‘å¼‚æ€§(anisotropic)</code>åå°„æ€§è´¨çš„ï¼Œä¾‹å¦‚é‡‘å±æ‹‰ä¸ã€æ¯›å‘ç­‰ã€‚åœ¨ç¬¬18ç« ä¸­ä¼šå­¦ä¹ åŸºäºç‰©ç†çš„å…‰ç…§æ¨¡å‹ï¼Œè¿™äº›å…‰ç…§æ¨¡å‹æ›´åŠ å¤æ‚ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æ›´åŠ çœŸå®åœ°ååº”å…‰å’Œç‰©ä½“çš„äº¤äº’ã€‚</p><h1>Unityä¸­çš„ç¯å¢ƒå…‰å’Œè‡ªå‘å…‰</h1><p>åœ¨æ ‡å‡†å…‰ç…§æ¨¡å‹ä¸­ï¼Œç¯å¢ƒå…‰å’Œè‡ªå‘å…‰çš„è®¡ç®—æ˜¯æœ€ç®€å•çš„ã€‚<br>åœ¨Unityä¸­ï¼Œåœºæ™¯ä¸­çš„ç¯å¢ƒå…‰å¯ä»¥åœ¨<code>Window-&gt;Rendering-&gt;Lighting-&gt;Environment-&gt;EnvironmentLighting</code>ä¸­æ§åˆ¶ï¼Œé¦–å…ˆåœ¨Sourceé€‰æ‹©Colorï¼Œç„¶åå°±èƒ½çœ‹åˆ°Ambient Coloré€‰é¡¹äº†ã€‚åœ¨Shaderä¸­æˆ‘ä»¬åªéœ€è¦é€šè¿‡Unityçš„å†…ç½®å˜é‡<code>UNITY_LIGHTMODEL_AMBIENT</code>å°±å¯ä»¥å¾—åˆ°ç¯å¢ƒå…‰çš„é¢œè‰²å’Œå¼ºåº¦ä¿¡æ¯ã€‚</p><p>è€Œå¤§å¤šæ•°ç‰©ä½“æ˜¯æ²¡æœ‰è‡ªå‘å…‰ç‰¹æ€§çš„ï¼Œå› æ­¤åœ¨æœ¬ä¹¦ä¸­ç»å¤§éƒ¨åˆ†çš„Shaderä¸­éƒ½æ²¡æœ‰è®¡ç®—è‡ªå‘å…‰éƒ¨åˆ†ï¼Œå¦‚æœè¦è®¡ç®—è‡ªå‘å…‰ä¹Ÿååˆ†ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ç‰‡å…ƒç€è‰²å™¨è¾“å‡ºæœ€åçš„é¢œè‰²ä¹‹å‰ï¼ŒæŠŠæè´¨çš„è‡ªå‘å…‰é¢œè‰²æ·»åŠ åˆ°è¾“å‡ºé¢œè‰²ä¸Šå³å¯ã€‚</p><h1>åœ¨Unity Shaderä¸­å®ç°æ¼«åå°„å…‰ç…§æ¨¡å‹</h1><p>åœ¨äº†è§£äº†ä¸Šè¿°ç†è®ºä¹‹åï¼Œç°åœ¨æ¥çœ‹ä¸€ä¸‹å¦‚ä½•åœ¨Unityä¸­å®ç°è¿™äº›åŸºæœ¬çš„å…‰ç…§æ¨¡å‹ã€‚é¦–å…ˆæˆ‘ä»¬æ¥å®ç°æ ‡å‡†å…‰ç…§æ¨¡å‹ä¸­çš„æ¼«åå°„éƒ¨åˆ†ã€‚<br>åœ¨å‰é¢çš„ç« èŠ‚ä¸­æˆ‘ä»¬ç»™å‡ºäº†åŸºæœ¬å…‰ç…§æ¨¡å‹ä¸­æ¼«åå°„éƒ¨åˆ†çš„è®¡ç®—å…¬å¼ï¼š<br>$$c_{diffuse} = (c_{light} Â· m_{diffuse})max(0,\vec{n} Â· \vec{l})$$<br>ä»å…¬å¼å¯ä»¥çœ‹å‡ºï¼Œè¦è®¡ç®—æ¼«åå°„éœ€è¦çŸ¥é“4ä¸ªå‚æ•°ï¼šå…¥å°„å…‰çº¿çš„é¢œè‰²å’Œå¼ºåº¦ã€æè´¨çš„æ¼«åå°„ç³»æ•°ã€è¡¨é¢æ³•çº¿$\vec{n}$ä»¥åŠå…‰æºæ–¹å‘$\vec{l}$ã€‚<br>ä¸ºäº†é˜²æ­¢ç‚¹å‡»çš„ç»“æœä¸ºè´Ÿï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨maxæ“ä½œï¼ŒCgæä¾›äº†è¿™æ ·çš„å‡½æ•°<code>saturate(x)</code>å‚æ•°xæ˜¯ç”¨æ¥æ“ä½œçš„æ ‡é‡æˆ–è€…çŸ¢é‡ï¼Œå¯ä»¥æ˜¯floatã€float2ã€float3ç­‰ç±»å‹ã€‚å®ƒåŒæ¥æŠŠxæˆªå–åœ¨[0,1]èŒƒå›´å†…ï¼Œå¦‚æœxæ˜¯ä¸€ä¸ªçŸ¢é‡ï¼Œé‚£ä¹ˆä¼šå¯¹å®ƒçš„æ¯ä¸€ä¸ªåˆ†é‡è¿›è¡Œè¿™ä¸ªæ“ä½œã€‚</p><h2 id="å®è·µï¼šé€é¡¶ç‚¹å…‰ç…§">å®è·µï¼šé€é¡¶ç‚¹å…‰ç…§</h2><h3 id="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ</h3><ul><li>åˆ›å»ºå¥½åœºæ™¯</li><li>åœ¨åœºæ™¯ä¸­æ·»åŠ ä¸€ä¸ªå¹³è¡Œå…‰</li><li>å»æ‰åœºæ™¯ä¸­çš„å¤©ç©ºç›’å­ åœ¨Unity2022ä¸­ï¼Œç¬”è€…æ˜¯é€šè¿‡è®¾ç½®MainCameraä¸­çš„ClearFlagså»é™¤çš„å¤©ç©ºç›’ï¼Œä¸ä¹¦ä¸Šæœ‰äº›å‡ºå…¥</li><li>åˆ›å»ºä¸€ä¸ªèƒ¶å›Šä½“</li></ul><h3 id="ç¼–å†™Shader">ç¼–å†™Shader</h3><p>éœ€è¦æ³¨æ„çš„ç‚¹ï¼š</p><ol><li>è¦åŒ…æ‹¬å¤´æ–‡ä»¶</li><li>è¦æ­£ç¡®è®¾ç½®LightModeï¼Œåªæœ‰è¿™æ ·æˆ‘ä»¬æ‰èƒ½æ­£ç¡®è·å¾—_</li><li>è¦æŠŠDiffuseæš´éœ²åœ¨æè´¨çš„é¢æ¿ä¸Šï¼Œå¹¶å°†è¿™ä¸ªå±æ€§å’ŒShaderä¸­çš„è„šæœ¬è”ç³»èµ·æ¥</li><li>é¡¶ç‚¹çš„æ³•çº¿å’Œå…‰æºæ–¹å‘è¦å½’ä¸€åŒ–ï¼Œè¿˜æ˜¯è¦ææ¸…æ¥š_WorldSpaceLightPos0çš„å«ä¹‰</li></ol><p>Shaderä»£ç å¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Unity Shader Book/Chapter 6/Diffuse Vertex Level&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">          _Diffuse (&quot;Diffuse&quot;, Color) = (1,1,1,1)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            #include &quot;Lighting.cginc&quot;</span><br><span class="line"></span><br><span class="line">            fixed4 _Diffuse;</span><br><span class="line">            </span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">            &#125;;</span><br><span class="line">            </span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                fixed3 color : COLOR;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            // æ¼«åå°„å¦‚ä½•è®¡ç®—ï¼Ÿ</span><br><span class="line">            // é€é¡¶ç‚¹å…‰ç…§éœ€è¦åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­è¿›è¡Œå…‰ç…§çš„è®¡ç®—</span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line"></span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz;</span><br><span class="line">                fixed3 worldNormal = normalize(UnityObjectToWorldNormal(v.normal));</span><br><span class="line">                fixed3 worldLight = normalize(_WorldSpaceLightPos0.xyz);</span><br><span class="line">                fixed3 diffuse =  _LightColor0.rgb * _Diffuse.rgb * saturate(dot(worldNormal, worldLight));</span><br><span class="line">                o.color = ambient + diffuse;</span><br><span class="line">                </span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                return fixed4(i.color, 1);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Fallback &quot;Diffuse&quot;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å®è·µï¼šé€åƒç´ å…‰ç…§">å®è·µï¼šé€åƒç´ å…‰ç…§</h2><p>å‡†å¤‡å·¥ä½œåŒä¸Š</p><p>æˆ‘ä»¬åªéœ€è¦å¯¹Shaderè¿›è¡Œä¸€ç‚¹æ›´æ”¹å°±å¯ä»¥å¾—åˆ°é€åƒç´ çš„æ¼«åå°„æ•ˆæœã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Unity Shader Book/Chapter 6/Diffuse Pixel Level&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Diffuse (&quot;Diffuse&quot;, Color) = (1,1,1,1)    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">            &#125;       </span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            #include&quot;Lighting.cginc&quot;</span><br><span class="line"></span><br><span class="line">            fixed4 _Diffuse;</span><br><span class="line">            </span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float3 worldNormal : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            // åŠå…°ä¼¯ç‰¹æ¨¡å‹æ˜¯åœ¨é€åƒç´ çš„æ¼«åå°„å…‰ç…§æ˜æ¨¡å‹çš„åŸºç¡€ä¸Šå®ç°çš„ã€‚</span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                </span><br><span class="line">                o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line">                o.worldNormal = normalize(UnityObjectToWorldNormal(v.normal));</span><br><span class="line">                </span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line"></span><br><span class="line">                fixed3 amibient = UNITY_LIGHTMODEL_AMBIENT.xyz;</span><br><span class="line">                </span><br><span class="line">                fixed3 worldSpaceLightDir = normalize(_WorldSpaceLightPos0.xyz);</span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * _Diffuse.rgb * saturate(dot(i.worldNormal, worldSpaceLightDir));</span><br><span class="line">                // fixed3 diffuse = _LightColor0.rgb * _Diffuse.rgb * (dot(i.worldNormal, worldSpaceLightDir) * 0.5 + 0.5) ;</span><br><span class="line">                </span><br><span class="line">                fixed3 color = amibient + diffuse;</span><br><span class="line">                return fixed4(color,1.0);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Fallback &quot;Diffuse&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é€åƒç´ å…‰ç…§å¯ä»¥è¾¾åˆ°æ›´åŠ å¹³æ»‘çš„æ•ˆæœï¼Œä½†æ˜¯å³ä¾¿æ˜¯ä½¿ç”¨äº†é€åƒç´ æ¼«åå°„å…‰ç…§ï¼Œæœ‰ä¸€ä¸ªé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œåœ¨å…‰ç…§æ— æ³•åˆ°è¾¾çš„åŒºåŸŸï¼Œæ¨¡å‹çš„å¤–è§‚é€šå¸¸å…¨æ˜¯é»‘è‰²çš„ï¼Œæ²¡æœ‰ä»»ä½•æ˜æš—å˜åŒ–ï¼Œè¿™ä¼šä½¿å¾—æ¨¡å‹çš„èƒŒå…‰åŒºåŸŸçœ‹èµ·æ¥å°±åƒä¸€ä¸ªå¹³é¢ä¸€æ ·ï¼Œå¤±å»äº†æ¨¡å‹ç»†èŠ‚çš„è¡¨ç°ã€‚äº‹å®ä¸Šæˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ ç¯å¢ƒå…‰æ¥å¾—åˆ°éå…¨é»‘çš„æ•ˆæœï¼Œä½†å³ä¾¿è¿™æ ·ä»ç„¶æ— æ³•è§£å†³èƒŒå…‰æ˜æš—ä¸€æ ·çš„ç¼ºç‚¹ã€‚ä¸ºæ­¤ï¼Œæœ‰ä¸€ç§æ”¹å–„æŠ€æœ¯è¢«æå‡ºæ¥ï¼Œè¿™å°±æ˜¯<code>åŠå…°ä¼¯ç‰¹(Half Lambert)å…‰ç…§æ¨¡å‹</code>ã€‚</p><h3 id="ç¼–å†™Shader-2">ç¼–å†™Shader</h3><p>è¿™æ¬¡æˆ‘ä»¬è¦åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­è¿›è¡Œå…‰ç…§çš„è®¡ç®—</p><h2 id="åŠå…°ä¼¯ç‰¹æ¨¡å‹">åŠå…°ä¼¯ç‰¹æ¨¡å‹</h2><p>åœ¨å‰é¢å‡ ä¸ªå°èŠ‚ä¸­æˆ‘ä»¬ä½¿ç”¨åˆ°çš„æ¼«åå°„å…‰ç…§æ¨¡å‹ä¹Ÿè¢«ç§°ä¸ºå…°ä¼¯ç‰¹å…‰ç…§æ¨¡å‹ï¼Œå› ä¸ºå®ƒç¬¦åˆå…°ä¼¯ç‰¹å®šå¾‹â€”â€”åœ¨å¹³é¢æŸç‚¹æ¼«åå°„å…‰çš„å¼ºåº¦ä¸è¯¥åå°„ç‚¹çš„æ³•å‘é‡å’Œå…¥å°„å…‰è§’åº¦çš„ä½™å¼¦å€¼æˆæ­£æ¯”ã€‚<br>ä¸ºäº†æ”¹å–„åœ¨6.4.2å°èŠ‚æœ€åæå‡ºçš„é—®é¢˜ï¼ŒValveå…¬å¸åœ¨å¼€å‘æ¸¸æˆã€ŠåŠæ¡å‘½ã€‹æ—¶æå‡ºäº†ä¸€ç§æŠ€æœ¯ï¼Œç”±äºè¯¥æŠ€æœ¯æ˜¯åœ¨åŸå…°ä¼¯ç‰¹å…‰ç…§æ¨¡å‹çš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¸€ä¸ªç®€å•çš„ä¿®æ”¹ï¼Œå› æ­¤è¢«ç§°ä¸ºåŠå…°ä¼¯ç‰¹å…‰ç…§æ¨¡å‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Unity Shader Book/Chapter 6/Half Lambert&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Diffuse (&quot;Diffuse&quot;, Color) = (1,1,1,1)    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">            &#125;       </span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            #include&quot;Lighting.cginc&quot;</span><br><span class="line"></span><br><span class="line">            fixed4 _Diffuse;</span><br><span class="line">            </span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float3 worldNormal : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            // åŠå…°ä¼¯ç‰¹æ¨¡å‹æ˜¯åœ¨é€åƒç´ çš„æ¼«åå°„å…‰ç…§æ˜æ¨¡å‹çš„åŸºç¡€ä¸Šå®ç°çš„ã€‚</span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                </span><br><span class="line">                o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line">                o.worldNormal = normalize(UnityObjectToWorldNormal(v.normal));</span><br><span class="line">                </span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line"></span><br><span class="line">                fixed3 amibient = UNITY_LIGHTMODEL_AMBIENT.xyz;</span><br><span class="line">                </span><br><span class="line">                fixed3 worldSpaceLightDir = normalize(_WorldSpaceLightPos0.xyz);</span><br><span class="line">                // fixed3 diffuse = _LightColor0.rgb * _Diffuse.rgb * saturate(dot(i.worldNormal, worldSpaceLightDir));</span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * _Diffuse.rgb * (dot(i.worldNormal, worldSpaceLightDir) * 0.5 + 0.5) ;</span><br><span class="line">                </span><br><span class="line">                fixed3 color = amibient + diffuse;</span><br><span class="line">                return fixed4(color,1.0);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Fallback &quot;Diffuse&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åŠå…°ä¼¯ç‰¹æ¨¡å‹æ˜¯æ²¡æœ‰ä»»ä½•ç‰©ç†ä¾æ®çš„ï¼Œå®ƒä»…ä»…æ˜¯ä¸€ä¸ªè§†è§‰åŠ å¼ºæŠ€æœ¯ã€‚</p><h1>åœ¨Unity Shaderä¸­å®ç°é«˜å…‰åå°„å…‰ç…§æ¨¡å‹</h1><p>åŸºæœ¬å…‰ç…§æ¨¡å‹ä¸­çš„é«˜å…‰åå°„éƒ¨åˆ†çš„è®¡ç®—å…¬å¼æ˜¯ï¼š<br>$$c_{specular} = (c_{light} \cdot m_{specular})max(0, \vec{v} \cdot \vec{r})^{m_{gloss}}$$</p><p>ä»å…¬å¼å¯ä»¥çœ‹å‡ºï¼Œè¦è®¡ç®—é«˜å…‰åå°„éœ€è¦çŸ¥é“4ä¸ªå‚æ•°ï¼šå…¥å°„å…‰çº¿çš„é¢œè‰²å’Œå¼ºåº¦$c_{light}$ï¼Œæè´¨çš„é«˜å…‰åå°„ç³»æ•°$m_{specular}$ï¼Œè§†è§’æ–¹å‘$\vec{v}$ä»¥åŠåå°„æ–¹å‘$\vec{r}$ã€‚å…¶ä¸­ï¼Œåå°„æ–¹å‘$\vec{r}$å¯ä»¥ç”±è¡¨é¢æ³•çº¿$\vec{n}$å’Œå…‰æºæ–¹å‘$\vec{l}$è®¡ç®—è€Œå¾—ï¼š<br>$$\vec{r} = \vec{l} - 2(\vec{n} \cdot \vec{l})\vec{n}$$</p><p>ä¸Šè¿°å…¬å¼å¾ˆç®€å•ï¼Œæ›´å¹¸è¿çš„æ˜¯ï¼ŒCgæä¾›äº†è®¡ç®—åå°„æ–¹å‘çš„å‡½æ•°reflectã€‚</p><blockquote><p><strong>å‡½æ•°</strong>ï¼šreflect(i,n)<br><strong>å‚æ•°</strong>ï¼šiï¼Œå…¥å°„æ–¹å‘ï¼›næ³•çº¿æ–¹å‘ã€‚å¯ä»¥æ˜¯floatã€float2ã€float3ç­‰ç±»å‹<br><strong>æè¿°</strong>ï¼šå½“ç»™å®šå…¥å°„æ–¹å‘iå’Œæ³•çº¿æ–¹å‘næ—¶ï¼Œreflectå‡½æ•°å¯ä»¥è¿”å›åå°„æ–¹å‘</p></blockquote><h2 id="å®è·µï¼šé€é¡¶ç‚¹å…‰ç…§-2">å®è·µï¼šé€é¡¶ç‚¹å…‰ç…§</h2><p>é€é¡¶ç‚¹å…‰ç…§çš„é«˜å…‰åå°„æ˜¯åœ¨é€é¡¶ç‚¹æ¼«åå°„å…‰ç…§æ•ˆæœçš„åŸºç¡€ä¸ŠåŠ å…¥é€é¡¶ç‚¹é«˜å…‰åå°„çš„è®¡ç®—å®ç°çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Unity Shader Book/Chapter 6/Specular Vertex Lvel&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Specular (&quot;Specular&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _Gloss (&quot;Gloss&quot;, Range(8.0, 256)) = 20</span><br><span class="line">        _Diffuse (&quot;Diffuse&quot;, Color) = (1,1,1,1)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line">            </span><br><span class="line">            #include&quot;Lighting.cginc&quot;</span><br><span class="line"></span><br><span class="line">            fixed4 _Specular;</span><br><span class="line">            fixed4 _Diffuse;</span><br><span class="line">            float _Gloss;</span><br><span class="line">            </span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                fixed3 color : COLOR;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line">                </span><br><span class="line">                // ç¯å¢ƒå…‰</span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz;</span><br><span class="line">                </span><br><span class="line">                // æ¼«åå°„éƒ¨åˆ†ä¸€æ ·</span><br><span class="line">                // è®¡ç®—ä¸–ç•Œåæ ‡ä¸‹çš„å½’ä¸€åŒ–çš„æ³•çº¿æ–¹å‘</span><br><span class="line">                fixed3 worldNormal = normalize(UnityObjectToWorldNormal(v.normal));</span><br><span class="line"></span><br><span class="line">                fixed3 worldLight = normalize(_WorldSpaceLightPos0.xyz);</span><br><span class="line">                </span><br><span class="line">                // çŸ¥é“å…‰ç…§å¼ºåº¦</span><br><span class="line">                fixed3 diffuse =  _LightColor0.rgb * _Diffuse.rgb * saturate(dot(worldNormal, worldLight));</span><br><span class="line">                </span><br><span class="line">                // é«˜å…‰åå°„éƒ¨åˆ†</span><br><span class="line"></span><br><span class="line">                fixed3 viewDir = normalize(_WorldSpaceCameraPos.xyz - mul(unity_ObjectToWorld, v.vertex).xyz);</span><br><span class="line"></span><br><span class="line">                fixed3 reflectDir = normalize(reflect(-worldLight,worldNormal));</span><br><span class="line">                </span><br><span class="line">                fixed3 specular = _LightColor0.rgb * _Specular.rgb * pow(saturate(dot(viewDir , reflectDir)), _Gloss);</span><br><span class="line">                </span><br><span class="line">                o.color = diffuse + ambient + specular;</span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target&#123;</span><br><span class="line">                return fixed4 (i.color,1);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Fallback &quot;Specular&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯¹äºé«˜å…‰åå°„éƒ¨åˆ†ï¼Œæˆ‘ä»¬é¦–å…ˆè®¡ç®—äº†å…¥å°„å…‰çº¿æ–¹å‘å…³äºè¡¨é¢æ³•çº¿çš„åå°„æ–¹å‘reflectDirã€‚ç”±äºCgçš„relectå‡½æ•°çš„å…¥å°„æ–¹å‘è¦æ±‚æ˜¯ç”±å…‰æºæŒ‡å‘äº¤ç‚¹å¤„çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¯¹worldLightDirå–ååå†ä¼ ç»™reflectå‡½æ•°ã€‚ç„¶åæˆ‘ä»¬é€šè¿‡_WorldSpaceCameraPoså¾—åˆ°äº†ä¸–ç•Œç©ºé—´ä¸­æ‘„åƒæœºçš„ä½ç½®ï¼Œå†æŠŠé¡¶ç‚¹ä½ç½®ä»æ¨¡å‹ç©ºé—´å˜æ¢åˆ°ä¸–ç•Œç©ºé—´ä¸‹ï¼Œå†é€šè¿‡å’Œ_WorldSpaceCameraPosç›¸å‡å³å¯å¾—åˆ°ä¸–ç•Œç©ºé—´ä¸‹çš„è§†è§’æ–¹å‘ã€‚</p><p>ç”±æ­¤ï¼Œæˆ‘ä»¬å·²ç»å¾—åˆ°äº†æ‰€æœ‰çš„å››ä¸ªå‚æ•°ï¼Œä»£å…¥å…¬å¼å³å¯å¾—åˆ°é«˜å…‰åå°„çš„å…‰ç…§éƒ¨åˆ†ã€‚æœ€åï¼Œå†å’Œç¯å¢ƒå…‰ã€æ¼«åå°„ç›¸åŠ å­˜å‚¨åˆ°æœ€åçš„é¢œè‰²ä¸­ã€‚</p><h2 id="å®è·µï¼šé€åƒç´ å…‰ç…§-2">å®è·µï¼šé€åƒç´ å…‰ç…§</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Unity Shader Book/Chapter 6/Specular Pixel Level&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Diffuse (&quot;Diffuse&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _Specular (&quot;Specular&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _Gloss (&quot;Gloss&quot;, Range(8,256))  = 20</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">            &#125;       </span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            #include&quot;Lighting.cginc&quot;</span><br><span class="line"></span><br><span class="line">            fixed4 _Diffuse;</span><br><span class="line">            fixed4 _Specular;</span><br><span class="line">            float _Gloss;</span><br><span class="line">            </span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float4 worldPos : TEXCOORD0;</span><br><span class="line">                float3 worldNormal : TEXCOORD1;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line">                o.worldPos = mul(unity_ObjectToWorld, v.vertex);</span><br><span class="line">                o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line"></span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz;</span><br><span class="line"></span><br><span class="line">                fixed3 lightDir = normalize(_WorldSpaceLightPos0);</span><br><span class="line">                fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line">                </span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * _Diffuse.rgb * saturate(dot(worldNormal, lightDir)); </span><br><span class="line"></span><br><span class="line">                fixed3 viewDir = normalize(_WorldSpaceCameraPos.xyz - i.worldPos.xyz);</span><br><span class="line">                fixed3 reflectDir = normalize(reflect(-lightDir,worldNormal));</span><br><span class="line">                </span><br><span class="line">                fixed3 specular = _LightColor0.rgb * _Specular.rgb * pow(saturate(dot(viewDir, reflectDir)), _Gloss);</span><br><span class="line"></span><br><span class="line">                fixed3 color = diffuse + ambient + specular;</span><br><span class="line">                return fixed4(color,1.0);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Fallback &quot;Specular&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Blinn-Phongå…‰ç…§æ¨¡å‹">Blinn-Phongå…‰ç…§æ¨¡å‹</h2><p>åœ¨6.5.2å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬ç»™å‡ºäº†Phongå…‰ç…§æ¨¡å‹åœ¨Unityä¸­çš„å®ç°ï¼Œè€Œåœ¨6.2.4å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬è¿˜æåˆ°äº†å¦ä¸€ç§é«˜å…‰åå°„çš„å®ç°æ–¹æ³•â€”â€”Blinnå…‰ç…§æ¨¡å‹ã€‚å›å¿†ä¸€ä¸‹ï¼ŒBlinnæ¨¡å‹æ²¡æœ‰ä½¿ç”¨åå°„æ–¹å‘ï¼Œè€Œæ˜¯å¼•å…¥äº†ä¸€ä¸ªæ–°çš„çŸ¢é‡$\vec{h}$ï¼Œå®ƒæ˜¯é€šè¿‡å¯¹è§†è§’æ–¹å‘$\vec{v}$å’Œå…‰ç…§æ–¹å‘$\vec{l}$ç›¸åŠ åå†å½’ä¸€åŒ–å¾—åˆ°çš„ã€‚å³<br>$$\vec{h} = \frac{\vec{v} + \vec{l}}{|\vec{v} + \vec{l}|}$$</p><p>è€ŒBlinnæ¨¡å‹è®¡ç®—é«˜å…‰åå°„çš„å…¬å¼å¦‚ä¸‹ï¼š<br>$$c_{specular} = (c_{light} \cdot m_{specular}) max(0, \vec{n} \cdot \vec{h})^{m_{gloss}}$$</p><p>Blinn-Phongæ¨¡å‹çš„å®ç°å’Œ6.5.2èŠ‚ä¸­çš„ä»£ç å¾ˆç±»ä¼¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Unity Shader Book/Chapter 6/Blinn-Phong&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Diffuse (&quot;Diffuse&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _Specular (&quot;Specular&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _Gloss (&quot;Gloss&quot;, Range(8,256))  = 20</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">            &#125;       </span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            #include&quot;Lighting.cginc&quot;</span><br><span class="line"></span><br><span class="line">            fixed4 _Diffuse;</span><br><span class="line">            fixed4 _Specular;</span><br><span class="line">            float _Gloss;</span><br><span class="line">            </span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float4 worldPos : TEXCOORD0;</span><br><span class="line">                float3 worldNormal : TEXCOORD1;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line">                o.worldPos = mul(unity_ObjectToWorld, v.vertex);</span><br><span class="line">                o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line"></span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz;</span><br><span class="line"></span><br><span class="line">                fixed3 lightDir = normalize(_WorldSpaceLightPos0);</span><br><span class="line">                fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line">                </span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * _Diffuse.rgb * saturate(dot(worldNormal, lightDir)); </span><br><span class="line">                </span><br><span class="line">                fixed3 viewDir = normalize(_WorldSpaceCameraPos.xyz - i.worldPos.xyz);</span><br><span class="line"></span><br><span class="line">                fixed3 halfDir = normalize(viewDir+lightDir);</span><br><span class="line">                </span><br><span class="line">                fixed3 specular = _LightColor0.rgb * _Specular.rgb * pow(saturate(dot(worldNormal, halfDir)), _Gloss);</span><br><span class="line"></span><br><span class="line">                fixed3 color = diffuse + ambient + specular;</span><br><span class="line">                return fixed4(color,1.0);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Fallback &quot;Specular&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>å¬å”¤ç¥é¾™â€”â€”ä½¿ç”¨Unityå†…ç½®å‡½æ•°</h1><p>åœ¨è®¡ç®—å…‰ç…§æ¨¡å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦å¾—åˆ°å…‰æºçš„æ–¹å‘ã€è§†è§’æ–¹å‘è¿™ä¸¤ä¸ªåŸºæœ¬çš„ä¿¡æ¯ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éƒ½æ˜¯è‡ªè¡Œåœ¨ä»£ç ä¸­è®¡ç®—çš„ï¼Œä¾‹å¦‚ä½¿ç”¨normalize(_WorldSpaceLightPos0.xyz)æ¥å¾—åˆ°å…‰æºçš„æ–¹å‘ï¼ˆè¿™ç§æ–¹æ³•å®é™…åªä½¿ç”¨äºå¹³è¡Œå…‰ï¼‰ï¼Œä½¿ç”¨normalize(_WorldSpacecameraPos.xyz - i.worldPosition.xyz)æ¥å¾—åˆ°è§†è§’æ–¹å‘ã€‚ä½†å¦‚æœéœ€è¦å¤„ç†æ›´å¤æ‚çš„å…‰ç…§ç±»å‹ï¼Œå¦‚ç‚¹å…‰æºå’Œèšå…‰ç¯ï¼Œæˆ‘ä»¬è®¡ç®—å…‰æºæ–¹å‘çš„æ–¹æ³•å°±æ˜¯é”™è¯¯çš„ã€‚è¿™éœ€è¦æˆ‘ä»¬åœ¨ä»£ç ä¸­å…ˆåˆ¤æ–­å…‰æºçš„ç±»å‹ï¼Œå†è®¡ç®—å…‰æºçš„ä¿¡æ¯ã€‚</p><p>æ‰‹åŠ¨è®¡ç®—è¿™äº›å…‰æºä¿¡æ¯çš„è¿‡ç¨‹æ¯”è¾ƒéº»çƒ¦ï¼Œå¹¸è¿çš„æ˜¯ï¼ŒUnityæä¾›äº†ä¸€äº›å†…ç½®å‡½æ•°æ¥å¸®åŠ©æˆ‘ä»¬è®¡ç®—è¿™äº›ä¿¡æ¯ã€‚åœ¨ä¹‹å‰çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬ç»™å‡ºäº†unityCG.cgincé‡Œé¢ä¸€äº›éå¸¸æœ‰ç”¨çš„å¸®åŠ©å‡½æ•°ï¼Œè¿™é‡Œæˆ‘ä»¬å†æ¬¡å›é¡¾ä¸€ä¸‹ä»–ä»¬ï¼š</p><table><thead><tr><th>å‡½æ•°å</th><th>æè¿°</th></tr></thead><tbody><tr><td>float3 WorldSpaceViewDir(float4 v)</td><td>è¾“å…¥ä¸€ä¸ªæ¨¡å‹ç©ºé—´ä¸­çš„é¡¶ç‚¹ä½ç½®ï¼Œè¿”å›ä¸–ç•Œç©ºé—´ä¸­ä»è¯¥ç‚¹åˆ°æ‘„åƒæœºçš„è§‚å¯Ÿæ–¹å‘ã€‚å†…éƒ¨å®ç°äº†ä½¿ç”¨UnityWorldSpaceViewDirå‡½æ•°</td></tr><tr><td>float3 UnityWorldSpaceviewDir(float4 v)</td><td>è¾“å…¥ä¸€ä¸ªä¸–ç•Œç©ºé—´ä¸­çš„é¡¶ç‚¹ä½ç½®ï¼Œè¿”å›ä¸–ç•Œç©ºé—´ä¸­ä»è¯¥ç‚¹åˆ°æ‘„åƒæœºçš„è§‚å¯Ÿæ–¹å‘</td></tr><tr><td>float3 ObjSpaceViewDir(float4 v)</td><td>è¾“å…¥ä¸€ä¸ªæ¨¡å‹ç©ºé—´ä¸­çš„é¡¶ç‚¹ä½ç½®ï¼Œè¿”å›æ¨¡å‹ç©ºé—´ä¸­ä»è¯¥ç‚¹åˆ°æ‘„åƒæœºçš„è§‚å¯Ÿæ–¹å‘</td></tr><tr><td>float3 WorldSpaceLightDir(float4 v)</td><td><strong>ä»…å¯ä»¥ç”¨äºå‰å‰å‘æ¸²æŸ“ä¸­</strong>ã€‚è¾“å…¥ä¸€ä¸ªæ¨¡å‹ç©ºé—´ä¸­çš„é¡¶ç‚¹ä½ç½®ï¼Œè¿”å›ä¸–ç•Œç©ºé—´ä¸­ä»è¯¥ç‚¹åˆ°å…‰æºçš„å…‰ç…§æ–¹å‘ã€‚å†…éƒ¨å®ç°ä½¿ç”¨äº†UnityWorldSpaceLightDirå‡½æ•°ï¼Œæ²¡æœ‰è¢«å½’ä¸€åŒ–</td></tr><tr><td>float3 UnityWorldSpaceLightDir(float4 v)</td><td><strong>ä»…å¯ä»¥ç”¨äºå‰å‘æ¸²æŸ“ä¸­</strong>ã€‚è¾“å…¥ä¸€ä¸ªä¸–ç•Œç©ºé—´ä¸­çš„é¡¶ç‚¹ä½ç½®ï¼Œè¿”å›ä¸–ç•Œç©ºé—´ä¸­ä»è¯¥ç‚¹åˆ°å…‰æºçš„å…‰ç…§æ–¹å‘ã€‚æ²¡æœ‰è¢«å½’ä¸€åŒ–ã€‚</td></tr><tr><td>float3 ObjSpaceLightDir(float4 v)</td><td><strong>ä»…å¯ä»¥ç”¨äºå‰å‘æ¸²æŸ“ä¸­</strong>ã€‚è¾“å…¥ä¸€ä¸ªæ¨¡å‹ç©ºé—´ä¸­çš„é¡¶ç‚¹ä½ç½®ï¼Œè¿”å›æ¨¡å‹ç©ºé—´ä¸­ä»è¯¥ç‚¹åˆ°å…‰æºçš„å…‰ç…§æ–¹å‘ï¼Œæ²¡æœ‰è¢«å½’ä¸€åŒ–ã€‚</td></tr><tr><td>float3 UnityObjectToWorldNormal(float3 norm)</td><td>æŠŠæ³•çº¿æ–¹å‘ä»æ¨¡å‹ç©ºé—´è½¬æ¢åˆ°ä¸–ç•Œç©ºé—´ä¸­</td></tr><tr><td>float UnityObjectToWorldDir(float3 dir)</td><td>æŠŠæ–¹å‘çŸ¢é‡ä»æ¨¡å‹ç©ºé—´å˜æ¢åˆ°ä¸–ç•Œç©ºé—´ä¸­</td></tr><tr><td>float3 unityWorldToObjectDir(float3 dir)</td><td>æŠŠæ–¹å‘çŸ¢é‡ä»æ˜¯ä¸–ç•Œç©ºé—´å˜æ¢åˆ°æ¨¡å‹ç©ºé—´ä¸­</td></tr></tbody></table><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›å‡½æ•°éƒ½æ²¡æœ‰ä¿è¯å¾—åˆ°çš„æ–¹å‘çŸ¢é‡æ˜¯å•ä½çŸ¢é‡ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä½¿ç”¨å‰æŠŠå®ƒä»¬å½’ä¸€åŒ–ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨Unityå†…ç½®çš„å‡½æ•°ä¿®æ”¹æˆ‘ä»¬å†Blinn-Phongå°èŠ‚çš„Shaderä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Unity Shader Book/Chapter 6/Blinn-Phong&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Diffuse (&quot;Diffuse&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _Specular (&quot;Specular&quot;, Color) = (1,1,1,1)</span><br><span class="line">        _Gloss (&quot;Gloss&quot;, Range(8,256))  = 20</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">            &#125;       </span><br><span class="line">            </span><br><span class="line">            CGPROGRAM</span><br><span class="line"></span><br><span class="line">            #pragma vertex vert</span><br><span class="line">            #pragma fragment frag</span><br><span class="line"></span><br><span class="line">            #include&quot;Lighting.cginc&quot;</span><br><span class="line"></span><br><span class="line">            fixed4 _Diffuse;</span><br><span class="line">            fixed4 _Specular;</span><br><span class="line">            float _Gloss;</span><br><span class="line">            </span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float3 normal : NORMAL;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float4 worldPos : TEXCOORD0;</span><br><span class="line">                float3 worldNormal : TEXCOORD1;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                o.pos = mul(unity_MatrixMVP, v.vertex);</span><br><span class="line">                o.worldPos = mul(unity_ObjectToWorld, v.vertex);</span><br><span class="line">                o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line"></span><br><span class="line">                return o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz;</span><br><span class="line"></span><br><span class="line">                fixed3 lightDir = normalize(WorldSpaceLightDir(i.worldPos));</span><br><span class="line">                fixed3 worldNormal = normalize(i.worldNormal);</span><br><span class="line">                </span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * _Diffuse.rgb * saturate(dot(worldNormal, lightDir)); </span><br><span class="line">                </span><br><span class="line">                fixed3 viewDir = normalize(UnityWorldSpaceViewDir(i.worldPos));</span><br><span class="line"></span><br><span class="line">                fixed3 halfDir = normalize(viewDir+lightDir);</span><br><span class="line">                </span><br><span class="line">                fixed3 specular = _LightColor0.rgb * _Specular.rgb * pow(saturate(dot(worldNormal, halfDir)), _Gloss);</span><br><span class="line"></span><br><span class="line">                fixed3 color = diffuse + ambient + specular;</span><br><span class="line">                return fixed4(color,1.0);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Fallback &quot;Specular&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> UnityShader </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity </tag>
            
            <tag> Shader </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºCommandBufferçš„Bloomæ•ˆæœçš„å®ç°</title>
      <link href="/posts/257b5b2c/"/>
      <url>/posts/257b5b2c/</url>
      
        <content type="html"><![CDATA[<h1>èƒŒæ™¯</h1><p>æœ€è¿‘åœ¨é…åˆåŠ¨æ•ˆåŒäº‹ä½¿ç”¨åå¤„ç†æŠ€æœ¯å®ç°Bloomè¾‰å…‰çš„æ•ˆæœã€‚é¦–å…ˆå¦‚æœè¦å®ç°Bloomæ•ˆæœæ˜¯å¿…é¡»å¼€å¯HDRçš„ï¼Œå¼€å¯HDRä¹‹åå†…å­˜é‡Œä¼šå¢åŠ ä¸¤ä¸ªRenderTextureï¼Œå¹¶ä¸”éšç€å±å¹•åˆ†è¾¨ç‡çš„å¢åŠ è¿™ä¸¤ä¸ªRender Textureä¼šè¶Šæ¥è¶Šå¤§ï¼Œè¿™æ˜¯æ— æ³•é¿å…çš„ä¸€éƒ¨åˆ†å¼€é”€ã€‚ä¸€å¼€å§‹æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯Unityå®˜æ–¹æä¾›çš„å…¼å®¹Build-inæ¸²æŸ“ç®¡çº¿çš„<a href="https://docs.unity3d.com/Packages/com.unity.postprocessing@3.4/manual/index.html">Post Processing stack V2</a>åå¤„ç†æ’ä»¶ï¼Œè¿™ä¸ªæ’ä»¶ååˆ†å¼ºå¤§ï¼Œé™¤äº†Bloomæ•ˆæœè¿˜èƒ½å®ç°å¾ˆå¤šå…¶ä»–çš„åå¤„ç†æ•ˆæœã€‚ä½†åŒæ—¶è¿™ä¸ªæ’ä»¶çš„å¼€é”€å®åœ¨æ˜¯å¤ªå¤§äº†ï¼Œåœ¨ä½¿ç”¨äº†è¿™ä¸ªæ’ä»¶ä¹‹åæˆ‘ä»¬åªæ˜¯ä¸ºäº†å®ç°ä¸€ä¸ªBloomæ•ˆæœè€Œé€ æˆè¿™ä¹ˆå¤§çš„å†…å­˜æ•ˆæ˜¯å¾—ä¸å¿å¤±çš„ã€‚æ¯”èµ·æˆ‘ä»¬è¦å®ç°çš„Bloomæ•ˆæœï¼Œä½¿ç”¨è¿™ä¸ªæ’ä»¶é€ æˆçš„å¼€é”€æ˜¯æ— æ³•æ¥å—çš„ã€‚<br>ä¸ºäº†åšä¼˜åŒ–æ‰“å‡ºåŒ…æ¥åšäº†æ€§èƒ½å¯¹æ¯”åˆ†æï¼Œå‘ç°æ•´ä¸ªæ’ä»¶é€ æˆçš„ä¸»è¦å¼€é”€åœ¨å†…å­˜å ç”¨ä¸Šã€‚<br>åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†ä¸€ä¸ªBloomæ’ä»¶ï¼Œä½†æ˜¯æ’ä»¶å·²ç»æ¯”è¾ƒè€äº†ï¼Œè¿˜æ˜¯åŸºäºGraphics.Blitçš„æ–¹å¼å®ç°çš„åå¤„ç†æ•ˆæœï¼Œå› æ­¤ç¬”è€…åœ¨æ­¤æ’ä»¶çš„åŸºç¡€ä¸Šå®ç°äº†åŸºäºCommandBufferçš„Bloomæ•ˆæœã€‚</p><h1>å‰ç½®çŸ¥è¯†</h1><h2 id="å¤§æ¦‚æ–¹æ¡ˆ">å¤§æ¦‚æ–¹æ¡ˆ</h2><h1>Post Processingåå¤„ç†</h1><p>åå¤„ç†å€¼å¾—æ˜¯åœ¨æ¸²æŸ“å®Œæ•´ä¸ªåœºæ™¯å¾—åˆ°å±å¹•å›¾åƒåï¼Œå†å¯¹è¿™ä¸ªå›¾åƒè¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œï¼Œå®ç°å„ç§å±å¹•ç‰¹æ•ˆã€‚<br>è¦å®ç°åå¤„ç†ï¼Œéœ€è¦ç”¨åˆ°Unityæä¾›çš„æ¥å£ï¼šOnRenderImageå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„è°ƒç”¨æ—¶æœºæ˜¯åœ¨æ‰€æœ‰çš„Shaderä¸­ä¸é€æ˜å’Œé€æ˜çš„Passå…¨éƒ¨æ‰§è¡Œå®Œæ¯•åè°ƒç”¨çš„</p><h1>Bloomæ•ˆæœ</h1><p>Bloomæ•ˆæœæ¨¡æ‹ŸçœŸå®æ‘„åƒæœºï¼Œè®©å›¾ç‰‡ä¸­çš„è¾ƒäº®åŒºåŸŸâ€œæ‰©æ•£â€åˆ°å‘¨å›´åŒºåŸŸï¼Œé€ æˆä¸€ç§æœ¦èƒ§çš„æ•ˆæœã€‚</p><h2 id="Bloomæ•ˆæœå®ç°åŸç†">Bloomæ•ˆæœå®ç°åŸç†</h2><p>Bloomçš„å®ç°åŸç†æ¯”è¾ƒç®€å•ï¼šé¦–å…ˆæ ¹æ®ä¸€ä¸ªé˜ˆå€¼æå–å‡ºå›¾åƒä¸­è¾ƒäº®çš„éƒ¨åˆ†ï¼ŒæŠŠå®ƒä»¬å­˜å‚¨åœ¨ä¸€å¼ æ¸²æŸ“çº¹ç†(RenderTexture)ä¸­ï¼›å†åˆ©ç”¨ä¸€äº›æ¨¡ç³Šç®—æ³•å¯¹è¿™å¼ çº¹ç†è¿›è¡Œæ¨¡ç³Šå¤„ç†ï¼Œæ¨¡æ‹Ÿå…‰çº¿æ‰©æ•£çš„æ•ˆæœï¼›æœ€åå†å°†å…¶å’ŒåŸå›¾åƒè¿›è¡Œæ··åˆï¼Œå¾—åˆ°æœ€ç»ˆçš„æ•ˆæœã€‚</p><h2 id="Bloomæ•ˆæœå®ç°">Bloomæ•ˆæœå®ç°</h2><h3 id="Bloomçš„Shaderå®ç°">Bloomçš„Shaderå®ç°</h3><p>ä¸Šæ–‡æåˆ°å®ç°Bloomæ•ˆæœéœ€è¦ä¸‰ä¸ªç¯èŠ‚ï¼šæå–é«˜äº®ã€è¿›è¡Œæ¨¡ç³Šã€ä¸åŸå›¾åƒæ··åˆã€‚é‚£ä¹ˆæˆ‘ä»¬å°±è¦åœ¨Shaderä¸­å»ç¼–å†™ä¸‰ä¸ªPassåˆ†åˆ«å¤„ç†è¿™ä¸‰ä¸ªé˜¶æ®µã€‚<br>å¦å¤–è€ƒè™‘åˆ°ç§»åŠ¨å¹³å°çš„æ€§èƒ½ç“¶é¢ˆï¼Œå› æ­¤ä½¿ç”¨ä¸€äº›å¯é€‰çš„æ“ä½œé¡¹</p><p><strong>é˜¶æ®µä¸€ï¼šæå–å›¾ç‰‡é«˜äº®éƒ¨åˆ†</strong></p><p><strong>é˜¶æ®µäºŒï¼šå°†é«˜äº®éƒ¨åˆ†æ¨¡ç³Šå¤„ç†</strong></p><p><strong>é˜¶æ®µä¸‰ï¼šå°†æ¨¡ç³Šå¤„ç†åçš„å›¾åƒä¸åŸå›¾æ··åˆ</strong></p><h3 id="æå–é«˜äº®éƒ¨åˆ†-ç»“åˆShaderå…¥é—¨ç²¾è¦">æå–é«˜äº®éƒ¨åˆ† ç»“åˆShaderå…¥é—¨ç²¾è¦</h3><p>é¦–å…ˆè·å¾—ç›¸æœºçš„å±å¹•çº¹ç†</p><p>å¯¹SetGlobalTextureçš„ç†è§£<br>CommandBufferå’ŒShaderç±»ä¸­éƒ½å¯ä»¥æ‰§è¡Œä¸€ä¸ªSetGlobalTextureçš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½¿ç”¨è¿˜æ˜¯è¦è¯´ä¸€ä¸‹</p><h1>å‚è€ƒèµ„æ–™</h1><p><a href="https://docs.unity3d.com/Packages/com.unity.postprocessing@3.4/manual/index.html">Unity PostProcessingåå¤„ç†å®˜æ–¹æ–‡æ¡£</a></p><p><a href="https://docs.unity3d.com/Manual/render-pipelines-overview.html">Unity Render Pipelineå®˜æ–¹æ–‡æ¡£</a></p><p><a href="https://docs.unity3d.com/ScriptReference/Rendering.CommandBuffer.html">CommandBufferå®˜æ–¹æ–‡æ¡£</a></p><p><a href="https://docs.unity3d.com/Manual/GraphicsCommandBuffers.html">Extending the Built-in Render Pipeline with CommandBuffers</a></p><p><a href="https://blog.unity.com/engine-platform/extending-unity-5-rendering-pipeline-command-buffers">Extending Unity 5 rendering pipeline: Command buffers</a></p>]]></content>
      
      
      <categories>
          
          <category> ç¡¬æŠ€èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Shader </tag>
            
            <tag> æ¸²æŸ“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unityæ¸²æŸ“é¡ºåº</title>
      <link href="/posts/fff34a27/"/>
      <url>/posts/fff34a27/</url>
      
        <content type="html"><![CDATA[<p>åœ¨å¼€å§‹å­¦ä¹ Unityæ¸²æŸ“é¡ºåºä¹‹å‰, æˆ‘ä»¬æœ€å¥½å¯¹Unityäº‹ä»¶æ‰§è¡Œé¡ºåºæœ‰ä¸€å®šçš„äº†è§£, ä¹Ÿå°±æ˜¯ä¸‹é¢è¿™å¼ å›¾</p><p><a href="https://zhuanlan.zhihu.com/p/66558476">Gammaã€Linearã€sRGB å’ŒUnity Color Spaceï¼Œä½ çœŸæ‡‚äº†å—ï¼Ÿ</a></p><h1>å¦‚ä½•ç†è§£UIçš„æ¸²æŸ“</h1><h1>å¦‚ä½•ç†è§£Meshçš„æ¸²æŸ“</h1><p>æ— è®ºUIè¿˜æ˜¯æ¨¡å‹, éƒ½æ˜¯è¦å…ˆæ›´æ–°é¡¶ç‚¹çš„ä½ç½®ç­‰ä¿¡æ¯, ç„¶åå†æ¸²æŸ“å‡ºæ¥, å®é™…æ¸²æŸ“éƒ½æ˜¯åœ¨RenderObjectçš„æ—¶å€™, UIçš„é¡¶ç‚¹ä¿¡æ¯æ›´æ–°ä¹Ÿæ˜¯çŸ¥é“çš„, æ¨¡å‹é¡¶ç‚¹ç­‰æ•°æ®çš„æ›´æ–°åœ¨ä»€ä¹ˆæ—¶å€™å‘¢?<br>é™¤äº†UIä»¥å¤–, æ™®é€šçš„æ¨¡å‹, æ¯ä¸€å¸§é‡Œé¢æ¨¡å‹çš„é¡¶ç‚¹ä¹Ÿéƒ½ä¼šå‘ç”Ÿå˜åŒ–, é‚£æ¨¡å‹çš„</p><p>Unityä¸­ä¸€ä¸ªåœºæ™¯ä¸‹çš„æ‰€æœ‰ç‰©ä½“ï¼Œä¸è®ºæ˜¯UIã€2Dç‰©ä½“è¿˜æ˜¯3Dç‰©ä½“ï¼Œéƒ½æ˜¯åœ¨ä¸€ä¸ªä¸‰ç»´ç©ºé—´ä¸­è¿›è¡Œæ¸²æŸ“çš„ï¼Œç„¶åæˆ‘ä»¬é€è¿‡åœºæ™¯ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ‘„åƒæœºè§‚å¯Ÿåœºæ™¯ä¸­ç‰©ä½“æ¸²æŸ“åçš„é®æŒ¡å…³ç³»ã€‚å½“æˆ‘ä»¬çœ‹åˆ°ç‰©ä½“ä¹‹é—´å­˜åœ¨æŸç§é®æŒ¡å…³ç³»æ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šç›´è§‚åœ°è®¤ä¸ºè¿™æ˜¯ç”±äºä¸åŒç‰©ä½“ä¸æ‘„åƒæœºä¹‹é—´çš„è·ç¦»ä¸åŒå¯¼è‡´çš„ã€‚Unityç¡®å®ä¼šæ ¹æ®ç‰©ä½“è·ç¦»æ‘„åƒæœºçš„è·ç¦»æ¥å†³å®šæ¸²æŸ“ç»“æœï¼Œé™¤æ­¤ä¹‹å¤–Unityä¸­è¿˜æä¾›äº†å…¶ä»–æ–¹å¼æ¥å½±å“æ¸²æŸ“ç»“æœï¼Œè¿›è€Œæ”¹å˜ç‰©ä½“ä¹‹é—´çš„é®æŒ¡å…³ç³»ï¼Œæ¯”å¦‚å¯¹äºä¸¤ä¸ªCanvasç‰©ä½“ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ç¦»æ‘„åƒæœºè¿œçš„Canvasçš„SortingOrderå¤§äºç¦»æ‘„åƒæœºè¿‘çš„Canvasçš„SortingOrderï¼Œç„¶åæˆ‘ä»¬å°±ä¼šçœ‹åˆ°ç¦»æ‘„åƒæœºè¿œçš„Canvasåè€Œæ¸²æŸ“åœ¨äº†ç¦»æ‘„åƒæœºè¿‘çš„Canvasä¸Šé¢ã€‚æœ¬æ–‡è®°å½•ç¬”è€…ä¸ªäººå¯¹Unityä¸­æ¸²æŸ“é¡ºåºçš„åˆ†æç†è§£ã€‚</p><h1>Canvasç»„ä»¶</h1><p>Canvasç»„ä»¶å…·æœ‰ä¸€ä¸ªåä¸ºRenderModeå±æ€§<br>ScreenSpace-Overlayæ¨¡å¼ä¸‹æœ€ç®€å• ä½†æ˜¯å±€é™æ€§ä¹Ÿæ¯”è¾ƒé«˜ ä¸èƒ½å¤„ç†ç²’å­å’ŒUIçš„å±‚çº§å…³ç³»<br>ScreenSpace-Camera æ¨¡å¼å¯ä»¥å¤„ç†ç²’å­å’ŒUIçš„å±‚çº§å…³ç³»<br>WorldSpace</p><h1>æ¸²æŸ“é¡ºåº</h1><p>æ‰€æœ‰éœ€è¦æ˜¾ç¤ºçš„ç‰©ä½“éƒ½ä¼šæœ‰Rendererç»„ä»¶ï¼ŒMeshRendererã€SpriteRendererã€CanvasRendererã€PaticleSystemRenderer<br>SortingOrder SortingLayerID</p><p><strong>sortingLayerå’Œorder in layer(c#ä¸­å±æ€§åä¸ºsortingOrder)çš„å±æ€§åªé€‚ç”¨äºShaderä¸­æ²¡æœ‰ZWriteçš„ï¼Œä¸€æ—¦Shaderæœ‰è¿›è¡ŒZTestã€å¹¶ä¸”ZWriteæœ‰å†™å…¥ï¼Œé‚£ä¹ˆShaderçš„ZTestä¼˜å…ˆçº§å°±æ˜¯æœ€é«˜çš„åä¹‹ï¼Œä¸€æ—¦æ²¡æœ‰ZWriteï¼Œé‚£ä¹ˆæ§åˆ¶Rendererçš„sortingLayerå’Œorder in layer(c#ä¸­å±æ€§åä¸ºsortingOrder)çš„å±æ€§å°±æœ‰æ•ˆæœ</strong></p><h1>æ‘„åƒæœºçš„Size</h1><p>æ‰¾åˆ°åœºæ™¯ä¸­çš„MainCameraèŠ‚ç‚¹ä¸Šçš„Cameraç»„ä»¶ï¼Œè®¾ç½®ç»„ä»¶ä¸Šçš„Projectionå±æ€§ä¸º<code>Orthographic</code>ï¼ŒCameraä¸Šçš„å°±å‡ºç°äº†Sizeå±æ€§ï¼ŒSizeå®šä¹‰äº†é€è¿‡è¯¥æ‘„åƒæœºå¯ä»¥çœ‹åˆ°çš„è§†é‡é«˜åº¦çš„ä¸€åŠã€‚<br>CanvasScalerå’ŒCameraSizeæ­é…ä½¿ç”¨<br>Canvasåªè¦ä¸æ˜¯ScreenOverLayæ¨¡å¼ï¼Œ å°±å¯ä»¥å°†Canvasçœ‹ä½œä¸€ä¸ª3Dåœºæ™¯ä¸­çš„ç‰©ä½“ï¼Œè¯¥ç‰©ä½“å’Œåœºæ™¯ä¸­çš„å…¶ä»–ç‰©ä½“è·ç¦»æ‘„åƒæœºçš„è¿œè¿‘ä¸åŒï¼Œä¼šç›´æ¥å½±å“æœ€åçš„æ˜¾ç¤ºæ•ˆæœ</p><p>Canvasä¸‹çš„æ‰€æœ‰ç»„ä»¶éƒ½ç›¸å½“äºæ˜¯åœ¨ä¸€ä¸ªæ–°çš„åæ ‡ç©ºé—´ä¸‹è¿›è¡Œè®¡ç®—ï¼Œå°†Canvasä¸­çš„å…ƒç´ ç”±Canvasåæ ‡ç©ºé—´è½¬æ¢åˆ°ä¸–ç•Œåæ ‡ç©ºé—´ä¸‹æ—¶éœ€è¦æœ‰ä¸€ä¸ªæ¯”ä¾‹æ¢ç®—<br>ç²’å­ç³»ç»Ÿä¼šç»å¸¸å’ŒUIç³»ç»Ÿæ”¾åœ¨ä¸€èµ·ä½¿ç”¨ï¼Œä½†æ˜¯ç”±äºUIçš„é‡å ç­‰åŸå›  ç²’å­ç»å¸¸ä¼šå‡ºç°æ˜¾ç¤ºå±‚çº§ä¸æ­£ç¡®çš„é—®é¢˜ï¼Œå› æ­¤è¿˜éœ€è¦æ‰‹åŠ¨å»ç®¡ç†ç²’å­å’ŒUIçš„å±‚çº§</p><h1>SortingLayer</h1><h1>ç²’å­å’ŒUIå…ƒç´ çš„æ¸²æŸ“é¡ºåº</h1><p>è·ç¦»æ‘„åƒæœºçš„è·ç¦»ã€LayerIDã€OrderInLayerå’Œç²’å­UIçš„æ¸²æŸ“é¡ºåºå¯¹æœ€ç»ˆå±å¹•ä¸Šæ˜¾ç¤ºæ•ˆæœçš„å½±å“<br>åœ¨Unityé»˜è®¤çš„æ¸²æŸ“ç®¡çº¿ä¸‹åŒLayerIDã€åŒOrderInLayerçš„UIå’Œç²’å­æ˜¯å…ˆæ¸²æŸ“ç²’å­è¿˜æ˜¯å…ˆUI</p><h1>å‚è€ƒæ–‡ç« </h1><p><a href="https://zhuanlan.zhihu.com/p/473875401">Unityæ¸²æŸ“é¡ºåº</a><br><a href="https://zhuanlan.zhihu.com/p/673810066">UIå’Œæ¨¡å‹çš„å±‚çº§å¤„ç†</a><br><a href="https://docs.unity3d.com/2022.3/Documentation/Manual/built-in-rendering-order.html">Rendering Order In Build-in Render Pipeline</a><br><a href="https://docs.unity3d.com/2021.3/Documentation/Manual/2DSorting.html">2D Sorting</a><br><a href="https://docs.unity3d.com/Packages/com.unity.ugui@2.0/manual/script-CanvasScaler.html">Unity CanvasScaler</a><br><a href="https://blog.csdn.net/wjp494754224/article/details/105813042">å…³äºUGUIå’Œ3Dç‰©ä½“æ¸²æŸ“é¡ºåº</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ’åºç®—æ³•</title>
      <link href="/posts/735e5788/"/>
      <url>/posts/735e5788/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/SoIncredible/programming-practice">Githubä»“åº“</a></p><h1>å†’æ³¡æ’åº(Bubble)</h1><h2 id="æ€æƒ³">æ€æƒ³</h2><h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2><h1>å¿«é€Ÿæ’åº(Quick)</h1><h2 id="æ€æƒ³-2">æ€æƒ³</h2><p>å¿«é€Ÿæ’åºå¼•å…¥çš„pivotçš„æ¦‚å¿µ,æ¯æ¬¡éå†åºåˆ—æ—¶,ä»è¿™ä¸ªåºåˆ—ä¸­é€‰ä¸€ä¸ªæ•°(ä¸€èˆ¬å¯ä»¥é€‰æ‹©åºåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªæ•°),éå†å®Œä¸€éåºåˆ—ä¹‹åèƒ½å¤Ÿæ‰¾åˆ°è¢«é€‰ä¸­æ•°åœ¨è¿™ä¸ªåºåˆ—ä¸­çš„ä½ç½®,å°†è¯¥ä½ç½®æ ‡è®°ä¸ºpivot,<strong>äº¤æ¢pivotå·¦ä¾§å¤§äºpivotValueçš„æ•°å’Œå³ä¾§å°äºpivotValueçš„æ•°,æœ€ç»ˆäº¤æ¢indexä¸ºpivotå’Œè¢«é€‰ä¸­æ•°æ‰€åœ¨indexä½ç½®</strong>,æ¥ç€ä»¥è¯¥pivotä¸ºç•Œå°†åºåˆ—æ‹†åˆ†æˆä¸¤ä¸ªå­åºåˆ—,é‡å¤ä¸Šé¢çš„æ“ä½œ,ç›´åˆ°åºåˆ—çš„é•¿åº¦ä¸º1.</p><h2 id="æ—¶é—´å¤æ‚åº¦">æ—¶é—´å¤æ‚åº¦</h2><p>å¿«é€Ÿæ’åºä¸æ˜¯ä¸€ä¸ªç¨³å®šçš„ç®—æ³•,åŸå› æ˜¯pivotçš„å–å€¼ä¼šå¯¼è‡´pivotä¸¤ä¾§åºåˆ—é•¿åº¦ä¸æ˜¯ç›¸ç­‰çš„,æœ€åçš„æƒ…å†µæ˜¯,pivotæ¯æ¬¡å–å€¼å–å¾—éƒ½æ˜¯æ•°ç»„ä¸­æœ€å¤§çš„é‚£ä¸ªå€¼,è¿™æ ·ä»–çš„åˆ†æ²»é€’å½’å±‚æ•°å°±æ˜¯n,åœ¨æ¯ä¸€å±‚ä¸­éƒ½éœ€è¦éå†å®Œæ‰€æ•°ç»„ä¸­æ‰€æœ‰çš„å…ƒç´ ,å› æ­¤æ¯ä¸€å±‚ä¸­çš„æ—¶é—´å¤æ‚åº¦æ˜¯<code>n</code>,æ‰€ä»¥æœ€åæƒ…å†µä¸‹å¿«é€Ÿæ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(n^2)</code>.</p><p>å¹³å‡æƒ…å†µä¸‹,å¿«é€Ÿæ’åºçš„åˆ†æ²»é€’å½’å±‚æ•°ä¸º<code>logn</code>,æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(nlogn)</code>.</p><h2 id="æ³¨æ„">æ³¨æ„</h2><p>åˆ†åŒºç»“æŸæ—¶ï¼š<br>left æŒ‡å‘ç¬¬ä¸€ä¸ªå¤§äºæˆ–ç­‰äº pivotValue çš„å…ƒç´ ã€‚<br>right æŒ‡å‘æœ€åä¸€ä¸ªå°äº pivotValue çš„å…ƒç´ ã€‚<br>å› æ­¤pivotè¦å’Œrightäº¤æ¢.</p><h2 id="ä»£ç å®ç°-2">ä»£ç å®ç°</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">void Swap(int *arr, int x, int y)</span><br><span class="line">&#123;</span><br><span class="line">    int temp = arr[x];</span><br><span class="line">    arr[x] = arr[y];</span><br><span class="line">    arr[y] = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void InnerQuickSort(int *arr, int beginIndex, int endIndex)</span><br><span class="line">&#123;</span><br><span class="line">    if (beginIndex &gt;= endIndex)</span><br><span class="line">    &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    int left = beginIndex + 1;</span><br><span class="line">    int right = endIndex;</span><br><span class="line">    int pivotValue = arr[beginIndex]; // é€‰æ‹©èµ·å§‹ä½ç½®çš„å…ƒç´ ä½œä¸ºæ¢è½´</span><br><span class="line"></span><br><span class="line">    while (left &lt;= right)</span><br><span class="line">    &#123;</span><br><span class="line">        // æ‰¾åˆ°å·¦ä¾§ç¬¬ä¸€ä¸ªå¤§äºç­‰äº pivot çš„å…ƒç´ </span><br><span class="line">        while (left &lt;= right &amp;&amp; arr[left] &lt; pivotValue)</span><br><span class="line">        &#123;</span><br><span class="line">            left++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // æ‰¾åˆ°å³ä¾§ç¬¬ä¸€ä¸ªå°äº pivot çš„å…ƒç´ </span><br><span class="line">        while (left &lt;= right &amp;&amp; arr[right] &gt;= pivotValue)</span><br><span class="line">        &#123;</span><br><span class="line">            right--;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // å¦‚æœå·¦æŒ‡é’ˆå’Œå³æŒ‡é’ˆæ²¡æœ‰äº¤é”™ï¼Œäº¤æ¢å®ƒä»¬</span><br><span class="line">        if (left &lt; right)</span><br><span class="line">        &#123;</span><br><span class="line">            Swap(arr, left, right);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // å°†æ¢è½´æ”¾åˆ°æ­£ç¡®çš„ä½ç½®</span><br><span class="line">    Swap(arr, beginIndex, right);</span><br><span class="line"></span><br><span class="line">    // é€’å½’åœ°å¯¹å·¦å³å­æ•°ç»„æ’åº</span><br><span class="line">    InnerQuickSort(arr, beginIndex, right - 1);</span><br><span class="line">    InnerQuickSort(arr, right + 1, endIndex);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void QuickSort(int *arr, int size)</span><br><span class="line">&#123;</span><br><span class="line">    // é€‰æ‹©pivot</span><br><span class="line">    // èƒ½å¤Ÿæ ‡è®°ä¸¤ä¸ªå­åºåˆ—</span><br><span class="line">    InnerQuickSort(arr, 0, size - 1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int arr[10] = &#123;26, 99, 10, 77, 55, 89, 44, 32, 17, 18&#125;;</span><br><span class="line"></span><br><span class="line">    QuickSort(arr, 10);</span><br><span class="line"></span><br><span class="line">    for (int i = 0; i &lt; 10; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; arr[i] &lt;&lt; &quot; &quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>æ’å…¥æ’åº(Insert)</h1><h2 id="æ€æƒ³-3">æ€æƒ³</h2><p>æ’å…¥æ’åºè®¤ä¸ºä¸€ä¸ªæ•°ç»„ä¼šè¢«åˆ†æˆå·²æ’åºéƒ¨åˆ†å’Œæœªæ’åºéƒ¨åˆ†,å·²æ’åºéƒ¨åˆ†é•¿åº¦é»˜è®¤æ˜¯1.æ¯æ¬¡éå†çš„æ—¶å€™éƒ½ä»æœªæ’åºæ•°ç»„ä¸­æ‹¿å–ç¬¬ä¸€ä¸ªå…ƒç´ ,æ’å…¥åˆ°å·²ç»æ’åºæ•°ç»„ä¸­.é‡å¤è¯¥æ­¥éª¤ç›´åˆ°æœªæ’åºéƒ¨åˆ†é•¿åº¦ä¸º0.</p><h2 id="æ—¶é—´å¤æ‚åº¦-2">æ—¶é—´å¤æ‚åº¦</h2><p>å¤–å±‚æ˜¯n<br>å†…å±‚æ˜¯T(n)=(nâˆ’1)+(nâˆ’2)+(nâˆ’3)+â‹¯+1= $\frac{n(nâˆ’1)}{2}$</p><p>æ‰€ä»¥æ—¶é—´å¤æ‚åº¦O($n^{2}$)</p><h2 id="ä»£ç å®ç°-3">ä»£ç å®ç°</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">void InsertionSort(int *arr, int size)</span><br><span class="line">&#123;</span><br><span class="line">    for (int i = 1; i &lt; size; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        int preIndex = i - 1;</span><br><span class="line">        int current = arr[i];</span><br><span class="line">        // ä»</span><br><span class="line">        while (preIndex &gt;= 0 &amp;&amp; arr[preIndex] &gt; current)</span><br><span class="line">        &#123;</span><br><span class="line">            arr[preIndex + 1] = arr[preIndex];</span><br><span class="line">            preIndex--;</span><br><span class="line">        &#125;</span><br><span class="line">        arr[preIndex + 1] = current;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int arr[10] = &#123;26, 99, 10, 77, 55, 89, 44, 32, 17, 18&#125;;</span><br><span class="line">    InsertionSort(arr, 10);</span><br><span class="line"></span><br><span class="line">    for (int i = 0; i &lt; 10; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; arr[i] &lt;&lt; &quot; &quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>é€‰æ‹©æ’åº(Selection)</h1><h2 id="æ€æƒ³-4">æ€æƒ³</h2><p>é€‰æ‹©æ’åºè®¤ä¸ºä¸€ä¸ªæ•°ç»„ä¼šè¢«åˆ†æˆå·²æ’åºéƒ¨åˆ†å’Œæœªæ’åºéƒ¨åˆ†,éå†æ•´ä¸ªæ•°ç»„,æ¯æ¬¡éå†çš„æ—¶å€™ä»æœªæ’åºéƒ¨åˆ†é‡Œé¢éå†å‡ºæœ€å°çš„å€¼,å°†å…¶ä¸æœªæ’åºéƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªå…ƒç´ äº¤æ¢,å°†æœªæ’åºéƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ·»åŠ åˆ°å·²æ’åºéƒ¨åˆ†çš„æœ«å°¾,é‡å¤è¯¥æ“ä½œç›´åˆ°æœªæ’åºéƒ¨åˆ†é•¿åº¦ä¸º0</p><h2 id="æ—¶é—´å¤æ‚åº¦-3">æ—¶é—´å¤æ‚åº¦</h2><p>å¤–å±‚æ˜¯n<br>å†…å±‚æ˜¯T(n)=(nâˆ’1)+(nâˆ’2)+(nâˆ’3)+â‹¯+1= $\frac{n(nâˆ’1)}{2}$</p><p>æ‰€ä»¥æ—¶é—´å¤æ‚åº¦O($n^{2}$)</p><h2 id="ä»£ç å®ç°-4">ä»£ç å®ç°</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">// éå†æ•´ä¸ªæ•°ç»„,æ¯æ¬¡éå†çš„æ—¶å€™ä»æœªæ’åºçš„æ•°ç»„é‡Œé¢éå†å‡ºæœ€å°çš„å€¼,å°†å…¶ä¸æœªæ’åºéƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªå…ƒç´ äº¤æ¢,é‡å¤è¯¥æ“ä½œç›´åˆ°æœªæ’åºæ•°ç»„é•¿åº¦ä¸º0</span><br><span class="line"></span><br><span class="line">void Swap(int *arr, int x, int y)</span><br><span class="line">&#123;</span><br><span class="line">    int temp = arr[x];</span><br><span class="line">    arr[x] = arr[y];</span><br><span class="line">    arr[y] = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void SelectionSort(int *arr, int size)</span><br><span class="line">&#123;</span><br><span class="line">    for (int i = 0; i &lt; size - 1; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        int tempMinIndex = i;</span><br><span class="line">        for (int j = i + 1; j &lt; size; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            // æ‰¾åˆ°æœ€å°çš„</span><br><span class="line">            if (arr[tempMinIndex] &gt; arr[j])</span><br><span class="line">            &#123;</span><br><span class="line">                tempMinIndex = j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Swap(arr, tempMinIndex, i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int arr[10] = &#123;26, 99, 10, 77, 55, 89, 44, 32, 17, 18&#125;;</span><br><span class="line">    SelectionSort(arr, 10);</span><br><span class="line"></span><br><span class="line">    for (int i = 0; i &lt; 10; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; arr[i] &lt;&lt; &quot; &quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>å½’å¹¶æ’åº(Merge)</h1><h2 id="æ€æƒ³-5">æ€æƒ³</h2><p>å½’å¹¶æ’åºé‡‡ç”¨åˆ†æ²»çš„æ€æƒ³,å…ˆè®©å±€éƒ¨æœ‰åº,ç„¶åå°†å¤šä¸ªæœ‰åºçš„å±€éƒ¨æ’åºæˆä¸€ä¸ªæ›´å¤§çš„æœ‰åºå±€éƒ¨.</p><h2 id="å®ç°æ€è·¯">å®ç°æ€è·¯</h2><ol><li>ä¼ å…¥ä¸€ä¸ªæ•°ç»„,æ•°ç»„é•¿åº¦ä¸ºsize</li><li>åˆ†æ²»,å°†æ•°ç»„åˆ†æˆsizeä¸ªé•¿åº¦ä¸º1çš„å­æ•°ç»„,è¿™äº›æ•°ç»„é»˜è®¤æ˜¯æœ‰åºçš„.</li><li>åˆå¹¶,å°†è¿™sizeä¸ªé•¿åº¦ä¸º1çš„å­æ•°ç»„åˆå¹¶æˆ$\frac{size}{2}$ä¸ªé•¿åº¦ä¸º2çš„å­æ•°ç»„.æ³¨æ„,å¦‚æœsizeä¸ºå¥‡æ•°,å°±è¦åˆ†æˆ$\frac{size - 1}{2}$ä¸ªé•¿åº¦ä¸º2çš„å­æ•°ç»„å’Œä¸€ä¸ªé•¿åº¦ä¸º1çš„å­æ•°ç»„</li><li>é‡å¤ç¬¬2ã€3æ­¥æ“ä½œ,ç›´åˆ°å­æ•°ç»„çš„é•¿åº¦å˜ä¸º<code>size</code>.</li></ol><h2 id="æ—¶é—´å¤æ‚åº¦-4">æ—¶é—´å¤æ‚åº¦</h2><p>å¤–å±‚å¾ªç¯æ—¶é—´å¤æ‚åº¦æ˜¯<code>log(n)</code>,å†…å±‚å¾ªç¯å¤æ‚åº¦<code>n</code>,æ€»å¤æ‚åº¦<code>O(nlogn)</code></p><h2 id="ä»£ç å®ç°-5">ä»£ç å®ç°</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">// 1. ä¼ å…¥ä¸€ä¸ªæ•°ç»„, æ•°ç»„é•¿åº¦ä¸ºsize</span><br><span class="line">// 2. åˆ†æ²», å°†æ•°ç»„åˆ†æˆsizeä¸ªé•¿åº¦ä¸º1çš„å­æ•°ç»„, è¿™äº›æ•°ç»„é»˜è®¤æ˜¯æœ‰åºçš„.</span><br><span class="line">// 3. åˆå¹¶, å°†è¿™sizeä¸ªé•¿åº¦ä¸º1çš„å­æ•°ç»„åˆå¹¶æˆ$\frac&#123;size&#125; &#123;2&#125; $ä¸ªé•¿åº¦ä¸º2çš„å­æ•°ç»„.æ³¨æ„, å¦‚æœsizeä¸ºå¥‡æ•°, å°±è¦åˆ†æˆ$\frac&#123;size - 1&#125; &#123;2&#125; $ä¸ªé•¿åº¦ä¸º2çš„å­æ•°ç»„å’Œä¸€ä¸ªé•¿åº¦ä¸º1çš„å­æ•°ç»„</span><br><span class="line">// 4. é‡å¤ç¬¬2ã€3æ­¥æ“ä½œ, ç›´åˆ°å­æ•°ç»„çš„é•¿åº¦å˜ä¸º`size`.</span><br><span class="line"></span><br><span class="line">void MergeSort(int *arr, int size);</span><br><span class="line">void Merge(int *arr, int size, int begin, int mid, int end);</span><br><span class="line"></span><br><span class="line">void MergeSort(int *arr, int size)</span><br><span class="line">&#123;</span><br><span class="line">    for (int curSize = 1; curSize &lt; size; curSize *= 2)</span><br><span class="line">    &#123;</span><br><span class="line">        // æ­¤å¤„å¯¹è¾¹ç•Œå€¼çš„åˆ¤å®š</span><br><span class="line">        for (int index = 0; index &lt; size - curSize; index += 2 * curSize)</span><br><span class="line">        &#123;</span><br><span class="line">            Merge(arr, size, index, index + curSize, index + 2 * curSize - 1 &gt; size - 1 ? size - 1 : index + 2 * curSize - 1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Merge(int *arr, int size, int begin, int mid, int end)</span><br><span class="line">&#123;</span><br><span class="line">    int *temp = new int[size];</span><br><span class="line">    for (int i = 0; i &lt; size; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        temp[i] = arr[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    int index = begin;</span><br><span class="line">    int left = begin;</span><br><span class="line">    int right = mid;</span><br><span class="line"></span><br><span class="line">    while (left &lt;= mid - 1 &amp;&amp; right &lt;= end)</span><br><span class="line">    &#123;</span><br><span class="line">        // å·¦è¾¹å¤§äºå³è¾¹</span><br><span class="line">        if (temp[left] &gt; temp[right])</span><br><span class="line">        &#123;</span><br><span class="line">            arr[index++] = temp[right++];</span><br><span class="line">        &#125;</span><br><span class="line">        else // å³è¾¹å¤§äºå·¦è¾¹</span><br><span class="line">        &#123;</span><br><span class="line">            arr[index++] = temp[left++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    while (left &lt;= mid - 1)</span><br><span class="line">        arr[index++] = temp[left++];</span><br><span class="line">    while (right &lt;= end)</span><br><span class="line">        arr[index++] = temp[right++];</span><br><span class="line"></span><br><span class="line">    delete[] temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int arr[10] = &#123;26, 99, 10, 77, 55, 89, 44, 32, 17, 18&#125;;</span><br><span class="line">    MergeSort(arr, 10);</span><br><span class="line"></span><br><span class="line">    for (int i = 0; i &lt; 10; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; arr[i] &lt;&lt; &quot; &quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»è¿‡ChatGPTä¼˜åŒ–è¿‡çš„ä»£ç ">ç»è¿‡ChatGPTä¼˜åŒ–è¿‡çš„ä»£ç </h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;algorithm&gt; // ä¸ºäº†ä½¿ç”¨ std::min</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">void MergeSort(int *arr, int size);</span><br><span class="line">void Merge(int *arr, int begin, int mid, int end);</span><br><span class="line"></span><br><span class="line">void MergeSort(int *arr, int size)</span><br><span class="line">&#123;</span><br><span class="line">    for (int curSize = 1; curSize &lt; size; curSize *= 2)</span><br><span class="line">    &#123;</span><br><span class="line">        for (int index = 0; index &lt; size; index += 2 * curSize)</span><br><span class="line">        &#123;</span><br><span class="line">            int mid = index + curSize; // ä¸­é—´ä½ç½®</span><br><span class="line">            int end = std::min(index + 2 * curSize - 1, size - 1); // å³è¾¹ç•Œ</span><br><span class="line">            if (mid &lt; size) // ç¡®ä¿ä¸­é—´ä½ç½®åœ¨æ•°ç»„èŒƒå›´å†…</span><br><span class="line">            &#123;</span><br><span class="line">                Merge(arr, index, mid, end);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Merge(int *arr, int begin, int mid, int end)</span><br><span class="line">&#123;</span><br><span class="line">    int *temp = new int[end - begin + 1];</span><br><span class="line">    for (int i = begin; i &lt;= end; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        temp[i - begin] = arr[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    int index = begin;</span><br><span class="line">    int left = 0; // temp çš„å·¦åŠéƒ¨åˆ†èµ·å§‹ä½ç½®</span><br><span class="line">    int right = mid - begin; // temp çš„å³åŠéƒ¨åˆ†èµ·å§‹ä½ç½®</span><br><span class="line"></span><br><span class="line">    while (left &lt; mid - begin &amp;&amp; right &lt; end - begin + 1)</span><br><span class="line">    &#123;</span><br><span class="line">        if (temp[left] &gt; temp[right])</span><br><span class="line">        &#123;</span><br><span class="line">            arr[index++] = temp[right++];</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            arr[index++] = temp[left++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    while (left &lt; mid - begin)</span><br><span class="line">        arr[index++] = temp[left++];</span><br><span class="line">    while (right &lt; end - begin + 1)</span><br><span class="line">        arr[index++] = temp[right++];</span><br><span class="line"></span><br><span class="line">    delete[] temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int arr[10] = &#123;26, 99, 10, 77, 55, 89, 44, 32, 17, 18&#125;;</span><br><span class="line">    MergeSort(arr, 10);</span><br><span class="line"></span><br><span class="line">    for (int i = 0; i &lt; 10; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; arr[i] &lt;&lt; &quot; &quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1>å¸Œå°”æ’åº</h1><h2 id="æ€æƒ³-6">æ€æƒ³</h2><h2 id="ä»£ç å®ç°-6">ä»£ç å®ç°</h2><h1>åŸºæ•°æ’åº</h1><h2 id="æ€æƒ³-7">æ€æƒ³</h2><h2 id="ä»£ç å®ç°-7">ä»£ç å®ç°</h2><h1>è®¡æ•°æ’åº</h1><h2 id="æ€æƒ³-8">æ€æƒ³</h2><h2 id="ä»£ç å®ç°-8">ä»£ç å®ç°</h2><h1>æ¡¶æ’åº</h1><h2 id="æ€æƒ³-9">æ€æƒ³</h2><h2 id="ä»£ç å®ç°-9">ä»£ç å®ç°</h2><h1>å †æ’åº</h1><h2 id="æ€æƒ³-10">æ€æƒ³</h2><h2 id="ä»£ç å®ç°-10">ä»£ç å®ç°</h2>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>C++é—®é¢˜è®°å½•</title>
      <link href="/posts/bcb0fea1/"/>
      <url>/posts/bcb0fea1/</url>
      
        <content type="html"><![CDATA[<h1>å¹¶ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯newå‡ºæ¥çš„</h1><p>åœ¨ä½¿ç”¨äº†ä¸€å¹´å¤šC#ä¹‹å,å›å¤´çœ‹C++æ—¶,æœ‰å¾ˆå¤šç–‘æƒ‘.é¦–å…ˆæ˜¯,åœ¨C#ä¸­,æ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯éœ€è¦newçš„.</p><p>çœ‹ä¸‹é¢ä»£ç :</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªç®€å•çš„ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Person</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        std ::cout &lt;&lt; <span class="string">&quot;æ‰§è¡Œæ— å‚æ„é€ å‡½æ•°&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°ï¼Œç”¨äºåˆå§‹åŒ–å¯¹è±¡</span></span><br><span class="line">    <span class="built_in">Person</span>(<span class="type">const</span> std::string &amp;n, <span class="type">int</span> a) : <span class="built_in">name</span>(n), <span class="built_in">age</span>(a)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;æ‰§è¡Œæœ‰å‚æ„é€ å‡½æ•°&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æˆå‘˜å‡½æ•°ï¼Œç”¨äºæ˜¾ç¤ºå¯¹è±¡ä¿¡æ¯</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">displayInfo</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Name: &quot;</span> &lt;&lt; name &lt;&lt; <span class="string">&quot;, Age: &quot;</span> &lt;&lt; age &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ææ„å‡½æ•°ï¼Œåœ¨å¯¹è±¡é”€æ¯æ—¶è‡ªåŠ¨è°ƒç”¨</span></span><br><span class="line">    ~<span class="built_in">Person</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Destroying person: &quot;</span> &lt;&lt; name &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// åœ¨æ ˆä¸Šåˆ›å»º Person ç±»çš„å¯¹è±¡</span></span><br><span class="line">    <span class="function">Person <span class="title">person</span><span class="params">(<span class="string">&quot;Alice&quot;</span>, <span class="number">23</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒç”¨å¯¹è±¡çš„æˆå‘˜å‡½æ•°</span></span><br><span class="line">    person.<span class="built_in">displayInfo</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨æ ˆä¸Šåˆ›å»º Person ç±»å¯¹è±¡</span></span><br><span class="line">    Person *p = <span class="keyword">new</span> <span class="built_in">Person</span>(<span class="string">&quot;Hank&quot;</span>, <span class="number">20</span>);</span><br><span class="line">    p-&gt;<span class="built_in">displayInfo</span>();</span><br><span class="line">    <span class="keyword">delete</span> p;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹åœ¨æ ˆä¸Šåˆ›å»ºçš„å¯¹è±¡çš„ç‰¹ç‚¹:</p><ul><li>åœ¨æ ˆä¸Šåˆ›å»ºçš„å¯¹è±¡ä¸éœ€è¦new,ä¹Ÿä¸éœ€è¦delete,å…¶ç”Ÿå‘½å‘¨æœŸè·Ÿéšå…¶æ‰€åœ¨æ–¹æ³•åŸŸçš„ç”Ÿå‘½å‘¨æœŸä¸€è‡´.</li><li>åœ¨æ ˆä¸Šåˆ›å»ºçš„å¯¹è±¡ä¸éœ€è¦delete</li><li>åœ¨æ ˆä¸Šåˆ›å»ºçš„å¯¹è±¡è°ƒç”¨å…¶å­—æ®µå’Œæ–¹æ³•æˆå‘˜æ—¶,ä½¿ç”¨æ“ä½œç¬¦<code>.</code>,åœ¨å †ä¸Šåˆ›å»ºçš„å¯¹è±¡ä½¿ç”¨æ“ä½œç¬¦<code>-&gt;</code>è®¿é—®å…¶æˆå‘˜.</li></ul><p><a href="https://blog.csdn.net/qq_30835655/article/details/68938861">è¿™ç¯‡æ–‡ç« </a>ä»‹ç»äº†å¦‚ä½•åœ¨C++ä¸­å®ç°åªèƒ½åœ¨å †ä¸Šæˆ–è€…åªèƒ½åœ¨æ ˆä¸Šåˆ›å»ºçš„å¯¹è±¡</p><h1>Warning: treating â€˜c-headerâ€™ input as â€˜c+Â±headerâ€™ when in C++ mode, this behavior is deprecated</h1><p>æ¯”å¦‚ä¸€ä¸ªcppæ–‡ä»¶ä¸­å¼•ç”¨äº†æŸä¸€ä¸ªå¤´æ–‡ä»¶,åœ¨ç¼–è¯‘çš„æ—¶å€™å°±æ²¡å¿…è¦æŠŠè¿™ä¸ªå¤´æ–‡ä»¶åˆ—å‡ºæ¥.</p><p><a href="https://stackoverflow.com/questions/23534362/warning-treating-c-header-input-as-c-header-when-in-c-mode-this-behavi">https://stackoverflow.com/questions/23534362/warning-treating-c-header-input-as-c-header-when-in-c-mode-this-behavi</a></p><p>åœ¨C++ä¸­å¯ä»¥è¾ƒä¸ºè‡ªç”±åœ°æ§åˆ¶æŸä¸€ä¸ªå¯¹è±¡æ˜¯åˆ›å»ºåœ¨å †ä¸Šè¿˜æ˜¯æ ˆä¸Šï¼Œè€Œåœ¨C#ä¸­ï¼Œå€¼ç±»å‹åªèƒ½åˆ›å»ºåœ¨æ ˆä¸Šï¼Œå †ç±»å‹åªèƒ½åˆ›å»ºåœ¨å †ä¸Šï¼Œåœ¨ä¸è€ƒè™‘è£…æ‹†ç®±ç±»å‹å¼ºè½¬çš„æƒ…å†µä¸‹ã€‚</p><h1>C++å®çš„ä½¿ç”¨</h1><p>åœ¨ C++ ä¸­ï¼Œé™¤äº†ç³»ç»Ÿç›¸å…³çš„å®ï¼Œå…¶ä»–å®çš„å¼€å…³æ§åˆ¶æ–¹å¼ä¸»è¦æœ‰ç¼–è¯‘å™¨é»˜è®¤å®šä¹‰ã€æ„å»ºç³»ç»Ÿè®¾ç½®ã€å¤´æ–‡ä»¶åŒ…å«ç­‰ï¼Œä»¥ä¸‹æ˜¯å…·ä½“ä»‹ç»ï¼š<br>ç¼–è¯‘å™¨é»˜è®¤å®šä¹‰<br>ä¸€äº›ç¼–è¯‘å™¨ä¼šæ ¹æ®è‡ªèº«ç‰¹æ€§å’Œç¼–è¯‘é€‰é¡¹ï¼Œé»˜è®¤å®šä¹‰æŸäº›å®ã€‚ä¾‹å¦‚ï¼ŒGCC ç¼–è¯‘å™¨ä¼šå®šä¹‰__GNUC__å®ï¼Œç”¨äºæ ‡è¯†ä½¿ç”¨çš„æ˜¯ GCC ç¼–è¯‘å™¨ï¼Œå…¶å€¼è¡¨ç¤º GCC çš„ç‰ˆæœ¬å·ã€‚<br>å¯¹äº C++ æ ‡å‡†åº“ç›¸å…³çš„å®ï¼Œå¦‚__cplusplusï¼Œå®ƒç”¨äºæ ‡è¯†å½“å‰ç¼–è¯‘ç¯å¢ƒçš„ C++ æ ‡å‡†ç‰ˆæœ¬ã€‚åœ¨ C++11 ç¯å¢ƒä¸‹ï¼Œ__cplusplusçš„å€¼é€šå¸¸è¢«å®šä¹‰ä¸º201103Lï¼Œåœ¨ C++20 ç¯å¢ƒä¸‹åˆ™ä¸º202002Lç­‰ï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®æ‰€æ”¯æŒçš„ C++ æ ‡å‡†è‡ªåŠ¨å®šä¹‰è¯¥å®ã€‚<br>æ„å»ºç³»ç»Ÿè®¾ç½®<br>Makefileï¼šå¯ä»¥åœ¨ Makefile ä¸­é€šè¿‡CFLAGSï¼ˆé’ˆå¯¹ C è¯­è¨€ï¼‰æˆ–CXXFLAGSï¼ˆé’ˆå¯¹ C++ è¯­è¨€ï¼‰å˜é‡æ¥å®šä¹‰å®ã€‚æ¯”å¦‚è¦å®šä¹‰ä¸€ä¸ªåä¸ºMY_MACROçš„å®ï¼Œå¯ä»¥å†™æˆCFLAGS += -DMY_MACROæˆ–CXXFLAGS += -DMY_MACROã€‚å¦‚æœè¦ä¸ºå®æŒ‡å®šå€¼ï¼Œä¾‹å¦‚MY_MACROçš„å€¼ä¸º10ï¼Œåˆ™å¯ä»¥å†™æˆCFLAGS += -DMY_MACRO=10æˆ–CXXFLAGS += -DMY_MACRO=10ã€‚<br>CMakeï¼šä½¿ç”¨add_definitionså‘½ä»¤æ¥å®šä¹‰å®ï¼Œå¦‚add_definitions(-DMY_MACRO)æˆ–add_definitions(-DMY_MACRO=10)ã€‚ä¹Ÿå¯ä»¥é€šè¿‡setå‘½ä»¤ç»“åˆCMAKE_C_FLAGSæˆ–CMAKE_CXX_FLAGSå˜é‡æ¥è®¾ç½®ï¼Œä¾‹å¦‚set(CMAKE_CXX_FLAGS â€œ${CMAKE_CXX_FLAGS} -DMY_MACRO=10â€)ã€‚<br>Ninjaï¼šä¸ Makefile ç±»ä¼¼ï¼Œåœ¨ç”Ÿæˆ Ninja æ„å»ºæ–‡ä»¶æ—¶ï¼Œå¯ä»¥é€šè¿‡ç›¸å…³çš„å‘½ä»¤è¡Œå‚æ•°æˆ–é…ç½®é€‰é¡¹æ¥æ·»åŠ å®å®šä¹‰ã€‚å…·ä½“æ–¹å¼å–å†³äºç”Ÿæˆ Ninja æ–‡ä»¶çš„å·¥å…·æˆ–è„šæœ¬ï¼Œä¾‹å¦‚ä½¿ç”¨ CMake ç”Ÿæˆ Ninja æ–‡ä»¶æ—¶ï¼Œå¯ä»¥é€šè¿‡ CMake çš„é…ç½®æ¥é—´æ¥å½±å“ Ninja æ„å»ºæ—¶çš„å®å®šä¹‰ã€‚<br>å¤´æ–‡ä»¶åŒ…å«<br>è®¸å¤šåº“çš„å¤´æ–‡ä»¶ä¼šæ ¹æ®è‡ªèº«çš„éœ€æ±‚å’Œæ¡ä»¶å®šä¹‰ä¸€äº›å®ã€‚å½“åŒ…å«è¿™äº›å¤´æ–‡ä»¶æ—¶ï¼Œç›¸åº”çš„å®å°±ä¼šè¢«å®šä¹‰ã€‚ä¾‹å¦‚ï¼Œåœ¨åŒ…å«&lt;stdio.h&gt;å¤´æ–‡ä»¶æ—¶ï¼Œå¯èƒ½ä¼šå¼•å…¥ä¸€äº›ä¸æ ‡å‡†è¾“å…¥è¾“å‡ºç›¸å…³çš„å®å®šä¹‰ã€‚<br>ä¸€äº›è·¨å¹³å°çš„åº“ä¼šåœ¨å¤´æ–‡ä»¶ä¸­æ ¹æ®ä¸åŒçš„å¹³å°æ¥å®šä¹‰ç‰¹å®šçš„å®ã€‚ä»¥ OpenGL åº“ä¸ºä¾‹ï¼Œåœ¨ Windows å¹³å°ä¸‹åŒ…å«&lt;windows.h&gt;å¤´æ–‡ä»¶åï¼Œå¯èƒ½ä¼šå®šä¹‰ä¸€äº›ä¸ Windows å›¾å½¢ç³»ç»Ÿç›¸å…³çš„å®ï¼Œç„¶ååœ¨ OpenGL çš„å¤´æ–‡ä»¶ä¸­ä¼šæ ¹æ®è¿™äº›å®æ¥è¿›ä¸€æ­¥å®šä¹‰ä¸ OpenGL åœ¨ Windows å¹³å°ä¸Šç›¸å…³çš„ç‰¹å®šå®ã€‚<br>å‘½ä»¤è¡Œå‚æ•°<br>åœ¨ä½¿ç”¨ç¼–è¯‘å™¨å‘½ä»¤è¡Œè¿›è¡Œç¼–è¯‘æ—¶ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æ¥å®šä¹‰å®ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ GCC ç¼–è¯‘æ—¶ï¼Œå¯ä»¥é€šè¿‡-Dé€‰é¡¹æ¥å®šä¹‰å®ï¼Œå¦‚gcc -D MY_MACRO main.cä¼šåœ¨ç¼–è¯‘main.cæ–‡ä»¶æ—¶å®šä¹‰MY_MACROå®ã€‚å¦‚æœè¦ä¸ºå®èµ‹å€¼ï¼Œå¯ä½¿ç”¨-D MY_MACRO=10çš„å½¢å¼ã€‚<br>åœ¨ä½¿ç”¨ CMake ç­‰æ„å»ºç³»ç»Ÿæ—¶ï¼Œä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­é€šè¿‡-Dé€‰é¡¹æ¥ä¼ é€’è‡ªå®šä¹‰çš„å®å®šä¹‰ã€‚ä¾‹å¦‚cmake -D MY_MACRO=10â€¦ï¼Œè¿™ä¼šåœ¨è¿è¡Œ CMake é…ç½®é¡¹ç›®æ—¶å®šä¹‰MY_MACROå®ï¼Œåç»­çš„ç¼–è¯‘è¿‡ç¨‹ä¸­å°±å¯ä»¥ä½¿ç”¨è¯¥å®ã€‚</p><p>ç®€å•çš„ä½¿ç”¨å¯ä»¥çœ‹ä¸€ä¸‹<a href="https://github.com/SoIncredible/programming-practice">è¿™ä¸ªä»“åº“</a>ä¸‹çš„<code>Code/CPP/assertAndMacro</code></p><h1>C++æ¨¡æ¿å’ŒC#èŒƒå‹(generic)ä¹‹é—´çš„åŒºåˆ«</h1><p>C# æ³›å‹å’Œ C++ æ¨¡æ¿å‡æ˜¯æ”¯æŒå‚æ•°åŒ–ç±»å‹çš„è¯­è¨€åŠŸèƒ½ã€‚ ä½†æ˜¯ï¼Œä¸¤è€…ä¹‹é—´å­˜åœ¨å¾ˆå¤šä¸åŒã€‚ åœ¨è¯­æ³•å±‚æ¬¡ï¼ŒC# æ³›å‹æ˜¯å‚æ•°åŒ–ç±»å‹çš„ä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ³•ï¼Œè€Œä¸å…·æœ‰ C++ æ¨¡æ¿çš„å¤æ‚æ€§ã€‚ æ­¤å¤–ï¼ŒC# ä¸è¯•å›¾æä¾› C++ æ¨¡æ¿æ‰€å…·æœ‰çš„æ‰€æœ‰åŠŸèƒ½ã€‚ åœ¨å®ç°å±‚æ¬¡ï¼Œä¸»è¦åŒºåˆ«åœ¨äº C# æ³›å‹ç±»å‹çš„æ›¿æ¢åœ¨è¿è¡Œæ—¶æ‰§è¡Œï¼Œä»è€Œä¸ºå®ä¾‹åŒ–å¯¹è±¡ä¿ç•™äº†æ³›å‹ç±»å‹ä¿¡æ¯.</p><p>ä»¥ä¸‹æ˜¯ C# æ³›å‹å’Œ C++ æ¨¡æ¿ä¹‹é—´çš„ä¸»è¦å·®å¼‚ï¼š</p><p>C# æ³›å‹çš„çµæ´»æ€§ä¸ C++ æ¨¡æ¿ä¸åŒã€‚ ä¾‹å¦‚ï¼Œè™½ç„¶å¯ä»¥è°ƒç”¨ C# æ³›å‹ç±»ä¸­çš„ç”¨æˆ·å®šä¹‰çš„è¿ç®—ç¬¦ï¼Œä½†æ˜¯æ— æ³•è°ƒç”¨ç®—æœ¯è¿ç®—ç¬¦ã€‚</p><p>C# ä¸å…è®¸ä½¿ç”¨éç±»å‹æ¨¡æ¿å‚æ•°ï¼Œå¦‚ template C<int i> {}ã€‚</p><p>C# ä¸æ”¯æŒæ˜¾å¼å®šåˆ¶åŒ–ï¼›å³ç‰¹å®šç±»å‹æ¨¡æ¿çš„è‡ªå®šä¹‰å®ç°ã€‚</p><p>C# ä¸æ”¯æŒéƒ¨åˆ†å®šåˆ¶åŒ–ï¼šéƒ¨åˆ†ç±»å‹å‚æ•°çš„è‡ªå®šä¹‰å®ç°ã€‚</p><p>C# ä¸å…è®¸å°†ç±»å‹å‚æ•°ç”¨ä½œæ³›å‹ç±»å‹çš„åŸºç±»ã€‚</p><p>C# ä¸å…è®¸ç±»å‹å‚æ•°å…·æœ‰é»˜è®¤ç±»å‹ã€‚</p><p>åœ¨ C# ä¸­ï¼Œæ³›å‹ç±»å‹å‚æ•°æœ¬èº«ä¸èƒ½æ˜¯æ³›å‹ï¼Œä½†æ˜¯æ„é€ ç±»å‹å¯ä»¥ç”¨ä½œæ³›å‹ã€‚ C++ å…è®¸ä½¿ç”¨æ¨¡æ¿å‚æ•°ã€‚</p><p>C++ å…è®¸åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨å¯èƒ½å¹¶éå¯¹æ‰€æœ‰ç±»å‹å‚æ•°æœ‰æ•ˆçš„ä»£ç ï¼Œéšåé’ˆå¯¹ç”¨ä½œç±»å‹å‚æ•°çš„ç‰¹å®šç±»å‹æ£€æŸ¥æ­¤ä»£ç ã€‚ C# è¦æ±‚ç±»ä¸­ç¼–å†™çš„ä»£ç å¯å¤„ç†æ»¡è¶³çº¦æŸçš„ä»»ä½•ç±»å‹ã€‚ ä¾‹å¦‚ï¼Œåœ¨ C++ ä¸­å¯ä»¥ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œæ­¤å‡½æ•°å¯¹ç±»å‹å‚æ•°çš„å¯¹è±¡ä½¿ç”¨ç®—æœ¯è¿ç®—ç¬¦ + å’Œ -ï¼Œåœ¨å®ä¾‹åŒ–å…·æœ‰ä¸æ”¯æŒè¿™äº›è¿ç®—ç¬¦çš„ç±»å‹çš„æ¨¡æ¿æ—¶ï¼Œæ­¤å‡½æ•°å°†äº§ç”Ÿé”™è¯¯ã€‚ C# ä¸å…è®¸æ­¤æ“ä½œï¼›å”¯ä¸€å…è®¸çš„è¯­è¨€æ„é€ æ˜¯å¯ä»¥ä»çº¦æŸä¸­æ¨æ–­å‡ºæ¥çš„æ„é€ ã€‚</p><h1>C++ wchar_tä»‹ç»ä»¥åŠå’Œstringç±»å‹çš„è½¬æ¢</h1><p><a href="https://blog.csdn.net/sxhlovehmm/article/details/40919607">https://blog.csdn.net/sxhlovehmm/article/details/40919607</a></p><h1>å…³äºCMake</h1><p>è¿˜æ˜¯å›å¤´æ¥çœ‹ä¸€ä¸‹ä»C++æºæ–‡ä»¶å˜æˆå¯æ‰§è¡Œæ–‡ä»¶çš„è¿‡ç¨‹.</p><p>æ‰§è¡ŒCMakeå‘½ä»¤,å®è´¨ä¸Šæ˜¯åœ¨æ„å»ºmakefileçš„è¿‡ç¨‹,å³ ç”Ÿæˆæ„å»ºæ–‡ä»¶.<br>æ‰§è¡ŒCMakeå®åœ¨ç”Ÿæˆmake, æ‰§è¡Œmakeæ‰æ˜¯çœŸæ­£çš„å¼€å§‹å°†C++æºä»£ç è½¬æ¢æˆå¯æ‰§è¡Œæ–‡ä»¶.</p><h2 id="CMakeä¸­å¸¸ç”¨å‘½ä»¤">CMakeä¸­å¸¸ç”¨å‘½ä»¤</h2><h3 id="target-include-directories">target_include_directories</h3><p>åœ¨CMakeä¸­ç”¨äºä¸ºç‰¹å®šçš„ç›®æ ‡æŒ‡å®šåŒ…å«ç›®å½•, è¿™äº›æŒ‡å®šçš„ç›®å½•åœ¨ç¼–è¯‘æ—¶ä¼šè¢«æ·»åŠ åˆ°ç¼–è¯‘å™¨çš„æœç´¢è·¯å¾„ä¸­, ä½¿å¾—ç¼–è¯‘å™¨å¯ä»¥æ‰¾åˆ°ç›®æ ‡çš„æºæ–‡ä»¶åŒ…å«çš„å¤´æ–‡ä»¶. å½“é¡¹ç›®åŒ…å«å¤šä¸ªç›®å½•ï¼Œå¹¶ä¸”æºæ–‡ä»¶åœ¨ä¸åŒç›®å½•ä¸‹åˆ†å¸ƒæ—¶ï¼Œtarget_include_directoriesèƒ½å¤Ÿå¸®åŠ©ç¼–è¯‘å™¨æ‰¾åˆ°è¿™äº›åˆ†æ•£çš„å¤´æ–‡ä»¶ã€‚è¿™å¯¹äºä¿æŒé¡¹ç›®çš„ç»„ç»‡ç»“æ„æ¸…æ™°ã€è§£å†³å¤´æ–‡ä»¶ä¾èµ–é—®é¢˜éå¸¸æœ‰ç”¨ã€‚<br>ä½¿ç”¨æ–¹æ³•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">target_include_directories(&lt;target&gt;</span><br><span class="line">  [BEFORE]</span><br><span class="line">  &lt;INTERFACE|PUBLIC|PRIVATE&gt; [items1...]</span><br><span class="line">  [&lt;INTERFACE|PUBLIC|PRIVATE&gt; [items2...] ...])</span><br></pre></td></tr></table></figure><ul><li><target>: ç›®æ ‡çš„åç§°ï¼Œå¯ä»¥æ˜¯å¯æ‰§è¡Œæ–‡ä»¶æˆ–åº“ã€‚</li><li>BEFORE: å¯é€‰å…³é”®å­—ï¼ŒæŒ‡å®šåŒ…å«ç›®å½•åº”è¯¥åœ¨é»˜è®¤ç›®å½•ä¹‹å‰è¢«æ·»åŠ åˆ°ç¼–è¯‘å™¨çš„æœç´¢è·¯å¾„ã€‚</li><li>&lt;INTERFACE|PUBLIC|PRIVATE&gt;: æŒ‡å®šåŒ…å«ç›®å½•çš„èŒƒå›´ï¼š<ul><li>PRIVATE: ç›®å½•ä»…å¯¹è¯¥ç›®æ ‡å¯è§ï¼Œä¸ä¼šå½±å“ä¾èµ–è¯¥ç›®æ ‡çš„å…¶ä»–ç›®æ ‡ã€‚</li><li>INTERFACE: ç›®å½•ä¸ä¼šæ·»åŠ åˆ°è¯¥ç›®æ ‡çš„ç¼–è¯‘é€‰é¡¹ä¸­ï¼Œä½†ä¼šæ·»åŠ åˆ°é“¾æ¥è¯¥ç›®æ ‡çš„å…¶ä»–ç›®æ ‡ä¸­ã€‚</li><li>PUBLIC: ç›®å½•æ—¢ä¼šæ·»åŠ åˆ°è¯¥ç›®æ ‡çš„ç¼–è¯‘é€‰é¡¹ä¸­ï¼Œä¹Ÿä¼šæ·»åŠ åˆ°é“¾æ¥è¯¥ç›®æ ‡çš„å…¶ä»–ç›®æ ‡ä¸­ã€‚</li></ul></li><li><code>[items...]</code>: è¦æ·»åŠ ä¸ºåŒ…å«ç›®å½•çš„è·¯å¾„åˆ—è¡¨ã€‚</li></ul><h3 id="add-executable">add_executable</h3><p>add_executable()å‘½ä»¤ç”¨äºå®šä¹‰ä¸€ä¸ªæ–°çš„å¯æ‰§è¡Œç›®æ ‡ï¼Œä¹Ÿå°±æ˜¯è¦ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿™ä¸ªå‘½ä»¤å‘Šè¯‰CMakeè¦ç¼–è¯‘ä¸€ç³»åˆ—çš„æºæ–‡ä»¶ï¼Œç„¶åå°†å…¶é“¾æ¥ä»¥äº§ç”Ÿä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_executable(&lt;name&gt; [WIN32] [MACOSX_BUNDLE] [EXCLUDE_FROM_ALL] source1 [source2 ...])</span><br></pre></td></tr></table></figure><p>å…¶ä¸­</p><ul><li><code>&lt;name&gt;</code> æ˜¯è¦ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶çš„åç§°ã€‚</li><li><code>[WIN32]</code> åœ¨Windowsä¸Šç”Ÿæˆä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œè€Œä¸æ˜¯æ§åˆ¶å°åº”ç”¨ç¨‹åºã€‚</li><li><code>[MACOSX_BUNDLE]</code> åœ¨macOSä¸Šç”Ÿæˆä¸€ä¸ªbundleã€‚</li><li><code>[EXCLUDE_FROM_ALL]</code> è¡¨ç¤ºæ­¤ç›®æ ‡ä¸ä¼šè¢«é»˜è®¤æ„å»ºï¼ˆä¾‹å¦‚ï¼Œå½“ä½ è¿è¡Œ â€œmakeâ€ æˆ– â€œninjaâ€ æ—¶ï¼‰ã€‚</li><li>source1, source2, â€¦ æ˜¯è¦ç¼–è¯‘çš„æºæ–‡ä»¶ã€‚</li></ul><h3 id="target-link-options">target_link_options</h3><h3 id="pkg-check-modules">pkg_check_modules</h3><h3 id="include">include</h3><h3 id="find-package">find_package</h3><h3 id="set">set</h3><h3 id="add-subdirectory">add_subdirectory</h3><p>add_subdirectory() æ˜¯ CMake ä¸­çš„ä¸€ä¸ªå‘½ä»¤ï¼Œç”¨äºæ·»åŠ ä¸€ä¸ªå­ç›®å½•åˆ°æ„å»ºä¸­ã€‚å½“æ­¤å‘½ä»¤è¢«æ‰§è¡Œæ—¶ï¼ŒCMake ä¼šè¿›å…¥æŒ‡å®šçš„å­ç›®å½•ï¼Œå¹¶æŸ¥æ‰¾å¹¶å¤„ç†é‚£ä¸ªå­ç›®å½•ä¸‹çš„ CMakeLists.txt æ–‡ä»¶ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_subdirectory(source_dir [binary_dir] [EXCLUDE_FROM_ALL])</span><br></pre></td></tr></table></figure><p>å‚æ•°è§£é‡Šï¼š</p><ul><li>source_dirï¼šè¦åŠ å…¥æ„å»ºçš„å­ç›®å½•çš„è·¯å¾„ã€‚è¿™æ˜¯å¿…éœ€çš„ã€‚</li><li>binary_dirï¼šä¸ºå­ç›®å½•ç”Ÿæˆçš„æ„å»ºæ–‡ä»¶ï¼ˆå¦‚ Makefiles æˆ–é¡¹ç›®æ–‡ä»¶ï¼‰åº”æ”¾ç½®çš„ç›®å½•ã€‚é€šå¸¸ï¼Œå¦‚æœæ‚¨æ²¡æœ‰æŒ‡å®šï¼ŒCMake å°†åœ¨å½“å‰äºŒè¿›åˆ¶ç›®å½•ä¸‹ä¸ºå­ç›®å½•åˆ›å»ºä¸€ä¸ªåŒåç›®å½•ã€‚è¿™ä¸æ˜¯å¿…éœ€çš„ã€‚</li><li>EXCLUDE_FROM_ALLï¼šå½“è®¾ç½®æ­¤é€‰é¡¹æ—¶ï¼Œè¿™ä¸ªå­ç›®å½•ä¸‹çš„ç›®æ ‡ï¼ˆä¾‹å¦‚åº“æˆ–å¯æ‰§è¡Œæ–‡ä»¶ï¼‰ä¸ä¼šè¢«é»˜è®¤æ„å»ºç›®æ ‡ï¼ˆä¾‹å¦‚ â€œmakeâ€ æˆ– â€œninjaâ€ çš„é»˜è®¤ç›®æ ‡ï¼‰åŒ…æ‹¬è¿›æ¥ã€‚<br>å‡è®¾æœ‰ä»¥ä¸‹çš„ç›®å½•ç»“æ„ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/my_project</span><br><span class="line">â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">â””â”€â”€ /sub_project</span><br><span class="line">    â””â”€â”€ CMakeLists.txt</span><br></pre></td></tr></table></figure><p>åœ¨ /my_project/CMakeLists.txt (æ ¹ç›®å½•ä¸‹é¢çš„CMakeLists.txt)ä¸­ï¼Œä½ å¯ä»¥è¿™æ ·å†™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_subdirectory(sub_project)</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œå½“CMakeå¤„ç† /my_project/CMakeLists.txt æ—¶ï¼Œå®ƒä¹Ÿä¼šå¤„ç† /sub_project/CMakeLists.txtã€‚</p><h3 id="CMAKE-MODULE-PATH">CMAKE_MODULE_PATH</h3><h3 id="CMAKE-MODULE-PATH-2">CMAKE_MODULE_PATH</h3><h3 id="CMAKE-PREFIX-PATH">CMAKE_PREFIX_PATH</h3><h3 id="FindXXX-cmake">FindXXX.cmake</h3><h3 id="XXX-INCLUDE-DIRS"><XXX>_INCLUDE_DIRS</h3><h3 id="XXX-LIBRARIES"><XXX>_LIBRARIES</h3><h3 id="XXX-EXECUTABLE"><XXX>_EXECUTABLE</h3><h3 id="XXX-ROOT-DIR"><XXX>_ROOT_DIR</h3><h3 id="XXX-FOUND"><XXX>_FOUND</h3><h1>å…³äºC++ä¸­çš„*å’Œ&amp;ç¬¦å·</h1><p>&amp;ç¬¦å·å¤šç”¨äº</p><p>åœ¨C++ä¸­æœ‰ç¬¦åˆç±»å‹çš„æ¦‚å¿µ,å¼•ç”¨å’ŒæŒ‡é’ˆå°±æ˜¯ç¬¦åˆç±»å‹ä¸­çš„ä¸¤ç§,*å’Œ&amp;å·æ˜¯è¿™ä¸¤ç§ç¬¦åˆç±»å‹ä¸­ç»å¸¸ä½¿ç”¨åˆ°çš„ç¬¦å·.</p><p>å¼•ç”¨ä¸ºå¯¹è±¡èµ·äº†å¦å¤–ä¸€ä¸ªåå­—,å¼•ç”¨å¿…é¡»åˆå§‹åŒ–.</p><p>C++ä¸­å‡½æ•°å‚æ•°çš„ä¼ é€’æ–¹å¼æœ‰:</p><ul><li>æŒ‰å€¼ä¼ é€’</li><li>æŒ‰æŒ‡é’ˆä¼ é€’</li><li>æŒ‰å¼•ç”¨ä¼ é€’</li></ul><p>å‡½æ•°ä¼ å‚çš„è¿‡ç¨‹,å‘ç”Ÿäº†ä»€ä¹ˆ?<br>å¦‚ä½•ç†è§£å‡½æ•°å‚æ•°ä¸­çš„&amp;ç¬¦å·,æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">void func(int a, int &amp;b)&#123;</span><br><span class="line">    a++;</span><br><span class="line">    b++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()&#123;</span><br><span class="line"></span><br><span class="line">    int a = 1;</span><br><span class="line">    int b = 2;</span><br><span class="line">    func(a, b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨è°ƒç”¨å‡½æ•°æ—¶,æˆ‘ä»¬éœ€è¦å‘å‡½æ•°ä¸­ä¼ å…¥ä¸€ç³»åˆ—çš„å‚æ•°,å¦‚æœæˆ‘ä»¬ä¸ç»™å‚æ•°æ·»åŠ &amp;æ—¶,ä½ å¯ä»¥ç†è§£ä¸º,è°ƒç”¨å‡½æ•°ä¸€æ–¹,ä¹Ÿå°±æ˜¯åŸå§‹å‚æ•°æŒæœ‰ä¸€æ–¹æ‰€æŒæœ‰çš„å‡½æ•°,å’ŒçœŸæ­£å‚ä¸å‡½æ•°æ‰§è¡Œçš„å‚æ•°,æ˜¯å®Œå…¨æ²¡å…³ç³»çš„. &amp;çš„ä½œç”¨å°±æ˜¯å°†è¿™ä¸¤ä¸ªå‚æ•°å…³è”èµ·æ¥,æˆ–è€…è¯´,è®©è¿™ä¸¤ä¸ªå‚æ•°å°±æ˜¯ä¸€ä¸ªå‚æ•°.å› æ­¤,å‡½æ•°å†…å¯¹å‚æ•°çš„æ“ä½œä¼šåœ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•,å›åˆ°è°ƒç”¨å‡½æ•°ä¾§æ—¶,å¯¹å‚æ•°åšçš„ä¿®æ”¹ä¼šå¾—ä»¥ä¿ç•™.</p><p>é‚£å¦‚æœæˆ‘æƒ³è¦æŠŠå¤–å±‚å’Œå‡½æ•°å†…å±‚çš„å­—æ®µå…³è”èµ·æ¥,è¯¥æ€ä¹ˆåšå‘¢?é€šè¿‡æŒ‡é’ˆå•Š,æŒ‡é’ˆä¹‹é—´çš„ä¼ å€¼æ˜¯å¤åˆ¶,ä½†æ˜¯åªè¦æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜åœ°å€ä¸€æ ·,å°±å¯ä»¥ä½¿ç”¨ä¸åŒçš„æŒ‡é’ˆå¯¹åŒä¸€ç‰‡å†…å­˜åœ°å€æ“ä½œå•Š.</p><p>å¼•ç”¨&amp;ç¬¦å·çš„ä½œç”¨æ›´å¤šçš„æ˜¯ç”¨åœ¨å‡½æ•°ä¼ å‚ä¸­,é¿å…ä¸å¿…è¦çš„å‚æ•°å¤åˆ¶é€ æˆé¢å¤–å¼€é”€.<br>è¿·ç³Šäº†,ç›´æ¥ç”¨æŒ‡é’ˆå°±å¯ä»¥<br>æ¯”å¦‚ä¸€ä¸ªç«™</p><h1>æ¨¡ç‰ˆtemplateçš„ä½¿ç”¨</h1><p>åœ¨ C++ é‡Œï¼Œæ¨¡æ¿å‡½æ•°å’Œæ¨¡æ¿ç±»çš„å®šä¹‰å’Œå£°æ˜é€šå¸¸éœ€è¦æ”¾åœ¨åŒä¸€ä¸ªå¤´æ–‡ä»¶ä¸­ã€‚è¿™æ˜¯å› ä¸ºæ¨¡æ¿åœ¨ç¼–è¯‘æ—¶æ‰ä¼šè¢«å®ä¾‹åŒ–ï¼Œç¼–è¯‘å™¨éœ€è¦çœ‹åˆ°æ¨¡æ¿çš„å®Œæ•´å®šä¹‰æ‰èƒ½ç”Ÿæˆå…·ä½“çš„ä»£ç ã€‚åœ¨ä½ çš„ä»£ç é‡Œï¼ŒStack ç±»çš„å®šä¹‰æ”¾åœ¨äº† stack.h å¤´æ–‡ä»¶ä¸­ï¼Œè€Œæˆå‘˜å‡½æ•°çš„å®ç°æ”¾åœ¨äº† stack.cpp æ–‡ä»¶ä¸­ï¼Œè¿™å°±å¯¼è‡´ç¼–è¯‘å™¨åœ¨ç¼–è¯‘ main.cpp æ—¶ï¼Œæ— æ³•æ‰¾åˆ° Stack<custom> ç±»æˆå‘˜å‡½æ•°çš„å…·ä½“å®ç°ï¼Œä»è€Œåœ¨é“¾æ¥é˜¶æ®µå‡ºç°æœªå®šä¹‰ç¬¦å·çš„é”™è¯¯ã€‚</p><h1>å¦‚ä½•åœ¨C++ä¸­å®ç°C#ä¸­çš„åå°„ HybridCLRå¯èƒ½ä¼šç”¨åˆ°</h1><h1>C++ volatile å…³é”®å­—</h1><h1>C++ inline å…³é”®å­—</h1><h1>C++ å‹å…ƒ</h1><h1>C++ ç»§æ‰¿å¤šä¸ªç±»</h1><h1>å‚è€ƒèµ„æ–™</h1><p><a href="https://zhuanlan.zhihu.com/p/652187383">ã€CMakeã€‘ ç®€å•çš„CMakeListså‘½ä»¤</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®ç»“æ„â€”â€”æ ‘</title>
      <link href="/posts/62b3cca9/"/>
      <url>/posts/62b3cca9/</url>
      
        <content type="html"><![CDATA[<blockquote><p>äºŒå‰æ ‘çš„å„ç§éå†æ–¹å¼çš„å®Œæ•´C++ä»£ç åœ¨<a href="https://github.com/SoIncredible/programming-practice/blob/master/Code/CPP/Tree/BinaryTree/BinaryTree.h">githubä»“åº“ä¸Š</a></p></blockquote><h1>äºŒå‰æ ‘</h1><h2 id="éå†">éå†</h2><ul><li>æŒ‰ç…§éå†æ–¹å¼å¯ä»¥åˆ†ä¸ºé€’å½’éå†å’Œè¿­ä»£éå†</li><li>æŒ‰ç…§éå†ç»“æœå¯ä»¥åˆ†æˆæ·±åº¦éå†å’Œå¹¿åº¦éå†</li></ul><h2 id="å¹¿åº¦ä¼˜å…ˆéå†">å¹¿åº¦ä¼˜å…ˆéå†</h2><h3 id="å±‚åºéå†">å±‚åºéå†</h3><h2 id="æ·±åº¦ä¼˜å…ˆéå†">æ·±åº¦ä¼˜å…ˆéå†</h2><p>æ·±åº¦ä¼˜å…ˆéå†æŒ‰ç…§éå†æ–¹å¼å¯ä»¥åˆ†ä¸ºé€’å½’éå†å’Œè¿­ä»£éå†, æŒ‰ç…§éå†ç»“æœå¯ä»¥åˆ†ä¸ºå‰åºéå†ã€ä¸­åºéå†å’Œåç»­éå†, å‰ã€ä¸­ã€ååºæŒ‡çš„æ˜¯çˆ¶èŠ‚ç‚¹çš„éå†é¡ºåº.</p><h3 id="é€’å½’æ–¹å¼">é€’å½’æ–¹å¼</h3><p>é€’å½’æ–¹å¼è°ƒç”¨æ ˆè¿™ç§æ–¹å¼ä¸äºŒå‰æ ‘çš„ä¸‰ç§æ·±åº¦ä¼˜å…ˆéå†æ–¹å¼å¤©ç„¶å¥‘åˆ èŠ‚ç‚¹çš„éå†é¡ºåºå’ŒèŠ‚ç‚¹çš„å¤„ç†é¡ºåºå®Œå…¨ä¸€è‡´<br>ä½¿ç”¨è¿­ä»£æ–¹å¼æ˜¯éœ€è¦æˆ‘ä»¬é¢å¤–æ¨¡æ‹Ÿè°ƒç”¨æ ˆçš„ä½œç”¨æœºåˆ¶ è®©ä»–è¡¨ç°ä¸ºèŠ‚ç‚¹çš„ä¾¿åˆ©é¡ºåº å’Œå¤„ç†é¡ºåºä¸€è‡´</p><p><strong>å‰åºéå†</strong></p><p><a href="https://leetcode.cn/problems/binary-tree-preorder-traversal/description/">é…å¥—ç»ƒä¹  144.äºŒå‰æ ‘çš„å‰åºéå†</a></p><blockquote><p>éå†é¡ºåº ä¸­-&gt;å·¦-&gt;å³</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="type">void</span> BinaryTree&lt;T&gt;::<span class="built_in">InnerPreorderTraversalRecursion</span>(BinaryTreeNode&lt;T&gt; *cur, Queue&lt;BinaryTreeNode&lt;T&gt;&gt; *queue)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// å‰åºéå† ä¸­-&gt;å·¦-&gt;å³</span></span><br><span class="line">    <span class="keyword">if</span> (cur == <span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¾“å‡ºcurçš„index</span></span><br><span class="line">    queue-&gt;<span class="built_in">EnQueue</span>(cur);</span><br><span class="line">    <span class="comment">// éå†å·¦</span></span><br><span class="line">    <span class="built_in">InnerPreorderTraversalRecursion</span>(cur-&gt;left, queue);</span><br><span class="line">    <span class="comment">// éå†å³</span></span><br><span class="line">    <span class="built_in">InnerPreorderTraversalRecursion</span>(cur-&gt;right, queue);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="type">void</span> BinaryTree&lt;T&gt;::<span class="built_in">PreorderTraversalRecursion</span>(Queue&lt;BinaryTreeNode&lt;T&gt;&gt; *queue)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// åœ¨ä½¿ç”¨C++æ—¶ï¼Œå½“å‘ä¸€ä¸ªæ–¹æ³•è¯·æ±‚è¿”å›ä¸€ç»„æ•°æ®ç»“æ„æ—¶ï¼Œæœ€å¥½çš„åšæ³•æ˜¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶å‘è¿™ä¸ªæ–¹æ³•ä¸­ä¼ å…¥ç”¨æ¥å­˜å‚¨ç»“æœçš„æŒ‡é’ˆ</span></span><br><span class="line">    <span class="comment">// å› ä¸ºè¿™æ ·èƒ½ç¡®ä¿è¿™ä¸ªæŒ‡é’ˆçš„newå’Œdeleteæ˜¯æˆå¯¹å‡ºç°çš„</span></span><br><span class="line">    <span class="comment">// å¦‚æœä½ åœ¨è¿™ä¸ªæ–¹æ³•å†…éƒ¨newäº†ä¸€ä¸ªé˜Ÿåˆ— ç„¶åè¿”å›å‡ºå» å¤–éƒ¨å¾ˆæœ‰å¯èƒ½åœ¨å®Œæˆæ“ä½œåå¿˜è®°å¯¹è¿™ä¸ªé˜Ÿåˆ—æ‰§è¡Œdeleteæ“ä½œï¼Œè¿™å°±é€ æˆå†…å­˜æ³„æ¼äº†</span></span><br><span class="line">    <span class="built_in">InnerPreorderTraversalRecursion</span>(_root, queue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¸­åºéå†</strong></p><p><a href="https://leetcode.cn/problems/binary-tree-inorder-traversal/description/">é…å¥—ç»ƒä¹  94.äºŒå‰æ ‘çš„ä¸­åºéå†</a><br>âš ï¸æ³¨æ„: ä¸­åºéå†è¦æ¯”å‰åºå’Œååºç‰¹æ®Š å› ä¸ºéå†æ ‘èŠ‚ç‚¹çš„é¡ºåºå’Œå¤„ç†æ ‘èŠ‚ç‚¹çš„é¡ºåºæ˜¯ä¸ä¸€æ ·çš„</p><blockquote><p>éå†é¡ºåº å·¦-&gt;ä¸­-&gt;å³</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸­åºéå†</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="type">void</span> BinaryTree&lt;T&gt;::<span class="built_in">InorderTraversalRecursion</span>(Queue&lt;BinaryTreeNode&lt;T&gt;&gt; *queue)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">InnerInorderTraversalRecursion</span>(_root, queue);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="type">void</span> BinaryTree&lt;T&gt;::<span class="built_in">InnerInorderTraversalRecursion</span>(BinaryTreeNode&lt;T&gt; *cur, Queue&lt;BinaryTreeNode&lt;T&gt;&gt; *queue)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// å‰åºéå† ä¸­-&gt;å·¦-&gt;å³</span></span><br><span class="line">    <span class="keyword">if</span> (cur == <span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†å·¦</span></span><br><span class="line">    <span class="built_in">InnerInorderTraversalRecursion</span>(cur-&gt;left, queue);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¾“å‡ºcurçš„index</span></span><br><span class="line">    queue-&gt;<span class="built_in">EnQueue</span>(cur);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†å³</span></span><br><span class="line">    <span class="built_in">InnerInorderTraversalRecursion</span>(cur-&gt;right, queue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ååºéå†</strong></p><p><a href="https://leetcode.cn/problems/binary-tree-postorder-traversal/description/">é…å¥—ç»ƒä¹  145.äºŒå‰æ ‘çš„ååºéå†</a></p><blockquote><p>éå†é¡ºåº å·¦-&gt;å³-&gt;ä¸­</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="type">void</span> BinaryTree&lt;T&gt;::<span class="built_in">InnerPostorderTraversalRecursion</span>(BinaryTreeNode&lt;T&gt; *cur, Queue&lt;BinaryTreeNode&lt;T&gt;&gt; *queue)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// å‰åºéå† ä¸­-&gt;å·¦-&gt;å³</span></span><br><span class="line">    <span class="keyword">if</span> (cur == <span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†å·¦</span></span><br><span class="line">    <span class="built_in">InnerPostorderTraversalRecursion</span>(cur-&gt;left, queue);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†å³</span></span><br><span class="line">    <span class="built_in">InnerPostorderTraversalRecursion</span>(cur-&gt;right, queue);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// è¾“å‡ºcurçš„index</span></span><br><span class="line">     queue-&gt;<span class="built_in">EnQueue</span>(cur);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿­ä»£æ–¹å¼</p><ul><li>å‰åºéå†</li><li>ååºéå†</li><li>ä¸­åºéå† âš ï¸æ³¨æ„: ä¸­åºéå†è¦æ¯”å‰åºå’Œååºç‰¹æ®Š å› ä¸ºéå†æ ‘èŠ‚ç‚¹çš„é¡ºåºå’Œå¤„ç†æ ‘èŠ‚ç‚¹çš„é¡ºåºæ˜¯ä¸ä¸€æ ·çš„</li></ul><h3 id="è¿­ä»£æ–¹å¼">è¿­ä»£æ–¹å¼</h3><p><strong>å‰åºæ–¹å¼</strong></p><p>ä¸èƒ½ç”¨é€’å½’äº†, é‚£å°±è¦ç”¨è¿­ä»£çš„æ–¹å¼å°è¯•æ¨¡æ‹Ÿé€’å½’çš„æ€æƒ³, é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦åœ¨ä»£ç ä¸­æ‰‹åŠ¨çš„åˆ›å»ºä¸€ä¸ªæ ˆ, ç”¨æ¥æ¨¡æ‹Ÿé€’å½’æ–¹å¼ä¸­çš„å‡½æ•°è°ƒç”¨æ ˆ<br>ç”±äºŒå‰æ ‘èŠ‚ç‚¹çš„ç»“æ„å¯çŸ¥, æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªèŠ‚ç‚¹æ‰¾åˆ°è¯¥èŠ‚ç‚¹çš„å·¦å³å­©å­(å¦‚æœæœ‰çš„è¯),</p><p><strong>ååºéå†</strong><br><a href="https://leetcode.cn/problems/binary-tree-postorder-traversal/description/">é…å¥—ç»ƒä¹  145.äºŒå‰æ ‘çš„ååºéå†</a></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="type">void</span> BinaryTree&lt;T&gt;::<span class="built_in">PostorderTraversalIteration</span>(Queue&lt;BinaryTreeNode&lt;T&gt;&gt; *queue)</span><br><span class="line">&#123;</span><br><span class="line">    Stack&lt;BinaryTreeNode&lt;T&gt;&gt; stack = Stack&lt;BinaryTreeNode&lt;T&gt;&gt;();</span><br><span class="line"></span><br><span class="line">    stack.<span class="built_in">Push</span>(_root);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è€Œåç»­éå†çš„é¡ºåºæ˜¯å·¦ -&gt; å³ -&gt; ä¸­ éœ€è¦å°†é˜Ÿåˆ—ç¿»è½¬ä¸€ä¸‹</span></span><br><span class="line">    <span class="keyword">while</span>(!stack.<span class="built_in">IsEmpty</span>())&#123;</span><br><span class="line">        BinaryTreeNode&lt;T&gt; *node = stack.<span class="built_in">Pop</span>();</span><br><span class="line">        queue-&gt;<span class="built_in">EnQueue</span>(node);</span><br><span class="line">        <span class="keyword">if</span>(node-&gt;left != <span class="literal">nullptr</span>)&#123;</span><br><span class="line">            stack.<span class="built_in">Push</span>(node-&gt;left);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (node-&gt;right != <span class="literal">nullptr</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            stack.<span class="built_in">Push</span>(node-&gt;right);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†é˜Ÿåˆ—åè½¬</span></span><br><span class="line"></span><br><span class="line">    queue-&gt;<span class="built_in">Reverse</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸­åºéå†</p><p>ä¸­åºéå†éœ€è¦å¼•å…¥ä¸€ä¸ªcuræŒ‡é’ˆ, æ€è€ƒå¼•å…¥è¿™ä¸ªæŒ‡é’ˆçš„ç›®çš„æ˜¯ä»€ä¹ˆ? ç›®å‰æˆ‘çš„ç†è§£æ˜¯, è¿™ä¸ªæŒ‡é’ˆæ˜¯ä¸€ä¸ªå³è½¬æ ‡è®°, å¦‚æœæŒ‡é’ˆæ˜¯nulläº†, ä»£è¡¨ä»¥å½“å‰æ ˆé¡¶èŠ‚ç‚¹ä¸ºæ ¹ç»“ç‚¹çš„æ ‘çš„å·¦å­æ ‘å·²éå†å®Œæ¯•</p><h3 id="è¿­ä»£æ–¹å¼çš„ç»Ÿä¸€å†™æ³•-æ ‡è®°æ³•">è¿­ä»£æ–¹å¼çš„ç»Ÿä¸€å†™æ³•(æ ‡è®°æ³•)</h3><p>è¿­ä»£æ–¹å¼çš„å›°éš¾ç‚¹åœ¨äº æˆ‘ä»¬é€šè¿‡äºŒå‰æ ‘èŠ‚ç‚¹ èƒ½å¤Ÿéå†èŠ‚ç‚¹çš„æ–¹å¼ å’Œ äºŒå‰æ ‘çš„å‰ã€ä¸­ã€ååºéå†æ–¹å¼éƒ½ä¸å¤ªä¸€æ ·, æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»™èŠ‚ç‚¹æ‰“æ ‡è®°çš„æ–¹å¼ æ¥åˆ¤æ–­ä¸€ä¸ªèŠ‚ç‚¹åˆ°åº•æ˜¯è¯¥è¿›è¡Œéå†è¿˜æ˜¯å†™å…¥ç»“æœé›†å’Œ.</p><h1>æ³¨æ„</h1><p>ä¸åŒçš„ç¼–è¯‘å™¨ Winä¸Šçš„MinGWå’ŒMacä¸Šçš„clangè²Œä¼¼å¯¹äºæŒ‡é’ˆé‡Šæ”¾æ“ä½œæœ‰ä¸åŒçš„å¤„ç†ï¼Œå¿…é¡»ä¸‹é¢è¿™æ®µä»£ç ï¼Œç¬”è€…åœ¨äºŒå‰æ ‘ç±»çš„ææ„æ–¹æ³•ä¸­æŠŠäºŒå‰æ ‘ä¸­æ‰€æœ‰çš„èŠ‚ç‚¹å…¨éƒ¨é‡Šæ”¾æ‰ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">BinaryTree&lt;T&gt;::~<span class="built_in">BinaryTree</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// å‰åºéå†æ‰€æœ‰èŠ‚ç‚¹</span></span><br><span class="line">    Queue&lt;BinaryTreeNode&lt;T&gt;&gt; *queue = <span class="keyword">new</span> Queue&lt;BinaryTreeNode&lt;T&gt;&gt;();</span><br><span class="line">    <span class="built_in">PreorderTraversalRecursion</span>(queue);</span><br><span class="line">    <span class="keyword">while</span>(!queue-&gt;<span class="built_in">IsEmpty</span>())&#123;</span><br><span class="line">        BinaryTreeNode&lt;T&gt;* node = queue-&gt;<span class="built_in">DeQueue</span>();</span><br><span class="line">        <span class="keyword">delete</span> node;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">delete</span> queue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è°ƒç”¨äºŒå‰æ ‘ç±»çš„åœ°æ–¹mainæ–¹æ³•ä¸­ï¼Œæ‰‹åŠ¨é‡Šæ”¾æ‰äºŒå‰æ ‘å¯¹è±¡å ç”¨çš„å†…å­˜ï¼Œåœ¨Macçš„Clangä¸­ï¼Œè¯¥æ“ä½œä¼šæŠ¥é”™ï¼Œä½†æ˜¯åœ¨Winçš„MinGWä¸­ï¼Œå°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜ã€‚</p><h1>æ—¶é—´å¤æ‚åº¦</h1><p>å¸¸ç”¨æ—¶é—´å¤æ‚åº¦è¡¨ç¤º<code>O(n)</code> <code>O(log n)</code> <code>O(n!)</code> <code>O(n^2)</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">multiply</span><span class="params">(<span class="type">int</span> A, <span class="type">int</span> B)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> B?<span class="built_in">multiply</span>(A&lt;&lt;<span class="number">1</span>,B&gt;&gt;<span class="number">1</span>)+(B&amp;<span class="number">1</span>?A:<span class="number">0</span>):<span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç åŠŸèƒ½<br>è¿™æ®µä»£ç é€šè¿‡é€’å½’å’Œä½æ“ä½œå®ç°äº†ä¸¤ä¸ªæ•´æ•°çš„ä¹˜æ³•ï¼Œé¿å…äº†ç›´æ¥ä½¿ç”¨ * è¿ç®—ç¬¦ã€‚</p><p>å…³é”®ç‚¹<br>ä½æ“ä½œï¼š</p><p>å·¦ç§»æ“ä½œ A &lt;&lt; 1 ç›¸å½“äº A * 2ã€‚<br>å³ç§»æ“ä½œ B &gt;&gt; 1 ç›¸å½“äº B / 2ã€‚<br>æŒ‰ä½ä¸æ“ä½œ B &amp; 1 ç”¨äºæ£€æŸ¥ B çš„æœ€ä½ä½æ˜¯å¦ä¸º 1ã€‚<br>é€’å½’ï¼š</p><p>æ¯æ¬¡é€’å½’è®¡ç®—å½“å‰ä½çš„è´¡çŒ®ï¼Œå¹¶å°†é—®é¢˜è§„æ¨¡ç¼©å°ä¸€åŠï¼Œç›´åˆ° B == 0ã€‚<br>æ—¶é—´å¤æ‚åº¦ï¼š</p><p>æ¯æ¬¡é€’å½’å°† B å‡å°‘ä¸€åŠï¼Œå› æ­¤é€’å½’æ·±åº¦ä¸º O(log B)ã€‚<br>æ¯æ¬¡é€’å½’çš„è®¡ç®—é‡ä¸ºå¸¸æ•°ï¼Œå› æ­¤æ€»æ—¶é—´å¤æ‚åº¦ä¸º O(log B)ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Unityä¸­çš„åŠ¨æ€é“¾æ¥åº“</title>
      <link href="/posts/4ea0c9c3/"/>
      <url>/posts/4ea0c9c3/</url>
      
        <content type="html"><![CDATA[<h1>å•¥æ˜¯åŠ¨æ€é“¾æ¥åº“</h1><p>å¦‚æœä½ åœ¨æœç´¢å¼•æ“ä¸Šç›´æ¥æœç´¢åŠ¨æ€é“¾æ¥åº“çš„å®šä¹‰, æœç´¢ç»“æœå¤§éƒ¨åˆ†éƒ½ä¼šä¸<a href="https://learn.microsoft.com/zh-cn/troubleshoot/windows-client/setup-upgrade-and-drivers/dynamic-link-library">Microsoftä»¥åŠWindowså¹³å°æœ‰å…³</a>: åŠ¨æ€é“¾æ¥åº“ï¼ˆDynamic Link Libraryï¼ŒDLLï¼‰æ˜¯å¾®è½¯å…¬å¸åœ¨Windowsæ“ä½œç³»ç»Ÿä¸­å®ç°å…±äº«å‡½æ•°åº“çš„ä¸€ç§æœºåˆ¶ï¼Œæ—¨åœ¨è§£å†³é™æ€åº“ä»£ç å†—ä½™é—®é¢˜ã€‚å…¶æ ¸å¿ƒåŸç†æ˜¯ç¨‹åºç¼–è¯‘æ—¶ä»…æ ‡è®°æ‰€éœ€åº“æ–‡ä»¶ï¼Œè¿è¡Œæ—¶ç”±ç³»ç»ŸåŠ è½½å™¨åŠ¨æ€è½½å…¥å†…å­˜ï¼Œå®ç°å¤šç¨‹åºå…±äº«åŒä¸€ä»½åº“ä»£ç ï¼Œå‡å°‘èµ„æºå ç”¨ã€‚åœ¨éWindowså¹³å°ä¸Šä¹Ÿå­˜åœ¨å’ŒåŠ¨æ€é“¾æ¥åº“ä¸€æ ·å…±äº«ä»£ç çš„æœºåˆ¶, åªæ˜¯ä¸å«åŠ¨æ€é“¾æ¥åº“ç½¢äº†. ç¬”è€…åœ¨è¿™é‡Œæƒ³è®¨è®ºæ˜¯DLLè¿™ç§ä»£ç å…±äº«çš„æ€æƒ³æœºåˆ¶, ä¸å±€é™åœ¨Windowswå¹³å°ä¸Š, å› æ­¤ä¸‹æ–‡ä¸­ä»»ä½•å¹³å°çš„ä»£ç å…±äº«åº“ç¬”è€…å…¨éƒ¨ç§°ä¹‹ä¸ºDLLæˆ–åŠ¨æ€åº“.</p><p>åŠ¨æ€é“¾æ¥åº“åˆ†ä¸ºä¸¤ç§: ç”±<strong>åŸç”Ÿè¯­è¨€(Native Languagege)*ç¼–å†™å¹¶ç¼–è¯‘çš„</strong>åŸç”ŸDLL<strong>å’Œç”±</strong>æ‰˜ç®¡ç±»è¯­è¨€(Managed Language)<strong>ç¼–å†™å¹¶ç¼–è¯‘çš„</strong>æ‰˜ç®¡DLL**.<br>åŸç”ŸDLLæ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„DLL, è¿™ç±»DLLåœ¨ä¸åŒçš„å¹³å°æœ‰å„è‡ªåŠ¨æ€é“¾æ¥åº“çš„æ–‡ä»¶æ ¼å¼. åœ¨Windowsä¸Šæ˜¯<code>.dll</code>, åœ¨Macä¸Šæ˜¯<code>.dylib</code>, åœ¨Linuxä¸Šæ˜¯<code>.so</code>. åŸç”Ÿè¯­è¨€ç¼–å†™å‡ºæ¥çš„ç¨‹åºï¼Œç»è¿‡ç¼–è¯‘åç›´æ¥ç”Ÿæˆå½“å‰æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶å¹³å°çš„â€œæœ¬åœ°æœºå™¨ç â€ï¼ˆNative Codeï¼‰ã€‚ç¨‹åºæ— éœ€é¢å¤–çš„â€œè™šæ‹Ÿæœºâ€ã€â€œè§£é‡Šå™¨â€ã€â€œè¿è¡Œæ—¶ä¸­é—´å±‚â€å°±èƒ½ç›´æ¥åœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Šè¢«åŠ è½½å’Œè¿è¡Œã€‚åŸç”Ÿè¯­è¨€å¤©ç„¶ä¸æ“ä½œç³»ç»Ÿã€ç¡¬ä»¶æ¶æ„å¼ºç›¸å…³ã€‚ä»¥ä¸‹è¯­è¨€éƒ½æ˜¯åŸç”Ÿè¯­è¨€: Cã€C++ã€Objective-Cï¼ˆmacOS/iOSä¸‹ï¼‰ã€Rustï¼ˆé»˜è®¤å°±æ˜¯ç›´æ¥ç¼–è¯‘æœ¬åœ°æœºå™¨ç ï¼‰ã€Goè¯­è¨€ï¼ˆGo 1.5ä»¥åå®Œå…¨æ”¯æŒæ— éœ€è™šæ‹Ÿæœºï¼Œèƒ½ç›´æ¥ç¼–è¯‘åŸç”Ÿæœºå™¨ç ï¼‰ã€Fortranã€Delphi/Pascalï¼ˆæ¯”å¦‚ Embarcadero Delphiï¼‰ã€Zigã€Assembly æ±‡ç¼–ï¼ˆæœ€å½»åº•çš„native codeï¼‰ã€Swiftï¼ˆç¼–è¯‘æ¨¡å¼ä¸åŒï¼Œæœ¬åœ°æˆ–æ‰˜ç®¡ä¸¤ç§ï¼Œä¸»æµiOSå¼€å‘æ˜¯æœ¬åœ°çš„ï¼‰.</p><p>æ‰˜ç®¡DLLä¸åŸç”ŸDLLä¸åŒ, C#å’ŒJavaéƒ½æ˜¯æ‰˜ç®¡è¯­è¨€, å› ä¸ºå®ƒä»¬çš„ç¼–è¯‘å™¨å¹¶ä¸æ˜¯ç›´æ¥å°†å®ƒä»¬ç¼–è¯‘æˆæœºå™¨ç , è€Œæ˜¯æœ‰ä¸€ä¸ªä¸­é—´æ€, æ¯”å¦‚C#çš„ä¸­é—´æ€å°±æ˜¯IL, ç„¶åè¿è¡Œæ—¶ç”±CLRè§£ææ‰§è¡ŒILä»£ç , Javaçš„JVMåº”è¯¥ä¹Ÿæ˜¯ç±»ä¼¼çš„æœºåˆ¶. å› æ­¤, ä½¿ç”¨C#ç­‰æ‰˜ç®¡è¯­è¨€å¯¼å‡ºçš„dllå¹¶ä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„DLL.</p><h1>åœ¨Unityä¸­ä½¿ç”¨DLL</h1><p>æˆ‘ä»¬å…ˆæ¥è¯´æ‰˜ç®¡ä»£ç , ç¬”è€…ä½œä¸ºUnityå¼€å‘è€…, å°±ä»¥C#ä¸ºä¾‹æ¥è®², C#è¯­è¨€ç¼–è¯‘å¯¼å‡ºçš„dll, æœ¬è´¨ä¸Šæ˜¯ä¸€ç»„ç¨‹åºé›†ç¼–è¯‘å¯¼å‡ºçš„ILä»£ç é›†åˆ, æ ¹æ®ä¸Šæ–‡çš„æè¿°, C#çš„ç¼–è¯‘å…¶å®ä¸å—å¹³å°çš„é™åˆ¶, è¿™ç‚¹å¾ˆå¥½ç†è§£, å› æ­¤å„ä¸ªå¹³å°çš„C#åŠ¨æ€åº“çš„æ–‡ä»¶æ‰©å±•åéƒ½æ˜¯<code>.dll</code>. å› æ­¤, <strong>æ‰˜ç®¡ç±»å‹çš„.dllæ ¼å¼çš„åŠ¨æ€åº“æ˜¯å¯ä»¥åœ¨éWindowså¹³å°ä¸Šè¢«æ­£ç¡®è¯†åˆ«å’Œæ‰§è¡Œçš„</strong>, å› æ­¤éšç€.Netæ”¯æŒè·¨å¹³å°, .dllè¿™ç§æ–‡ä»¶æ ¼å¼ä¹Ÿå°±å‡ºç°åœ¨äº†å„ä¸ªå¹³å°ä¸Š, å› æ­¤å½“ä½ åœ¨æŸä¸€ä¸ªéWindowså¹³å°ä¸Šçœ‹åˆ°äº†ä¸€ä¸ª.dllæ–‡ä»¶è¢«ä½¿ç”¨å¹¶æ­£ç¡®æ‰§è¡Œ, å¾ˆæœ‰å¯èƒ½è¿™æ˜¯ä¸€ä¸ªC#dll. å½“ç„¶è¿™æ˜¯æœ‰å‰æçš„: è¿™<strong>ç±»dllå¿…é¡»åœ¨.Netç¯å¢ƒä¸‹æ‰èƒ½å¤Ÿæ­£ç¡®çš„æ‰§è¡Œ</strong>. <a href="http://xn--UnityEditor-i98wtf052m.Net">UnityEditoræ˜¾ç„¶æ˜¯.Net</a>(Mono)ç¯å¢ƒ, å› æ­¤C#ç±»å‹çš„dllå¯¼å…¥è¿›Unityä¹‹åå°±èƒ½æ­£ç¡®è¯†åˆ«å¹¶æ‰§è¡Œ. æˆ‘ä»¬çš„ä¸šåŠ¡ä»£ç å¯ä»¥ç›´æ¥è®¿é—®C#dllä¸­çš„æˆå‘˜.</p><p>è‡³äºéæ‰˜ç®¡çš„åŠ¨æ€åº“, æƒ³è¦åœ¨Unityå¼€å‘ä¸­ä½¿ç”¨å°±ååˆ†éº»çƒ¦äº†(ä¸åªæ˜¯Unity, æ‰€æœ‰è¦è·¨å¹³å°çš„å¼€å‘è°ƒç”¨éæ‰˜ç®¡åŠ¨æ€åº“éƒ½ååˆ†éº»çƒ¦), å› ä¸ºéæ‰˜ç®¡çš„åŠ¨æ€åº“ä¸å¹³å°å¼ºç»‘å®š, å¦‚æœè¦åšè·¨å¹³å°å¼€å‘, å°±éœ€è¦é’ˆå¯¹æ¯ä¸€ä¸ªå¹³å°æ„å»ºä¸“é—¨çš„åŠ¨æ€åº“, å…‰è¿™ä¸€ç‚¹å°±ååˆ†éº»çƒ¦, <strong>åº”å½“åœ¨å„è‡ªç›®æ ‡å¹³å°ä¸Šæ„å»ºåŠ¨æ€åº“, è€Œä¸æ˜¯åœ¨ä¸€ä¸ªå¹³å°ä¸Šä½¿ç”¨äº¤å‰ç¼–è¯‘çš„æ–¹å¼æ„å»ºå…¶ä»–å¹³å°çš„åŠ¨æ€åº“.</strong> é™¤æ­¤ä¹‹å¤–, è¿˜éœ€è¦å¼€å‘è€…ä½¿ç”¨<code>[DLLImport]</code>å±æ€§åœ¨C#å±‚æ‰‹åŠ¨åšä¸€ä¸‹æ¡¥æ¥.</p><p>ä¸‹é¢æ˜¯ç¬”è€…å°è¯•åœ¨Unityä¸­æ„å»ºä¸€ä¸ªæ”¯æŒåœ¨Armç‰ˆæœ¬çš„Windowså’ŒArmç‰ˆæœ¬çš„Macå¹³å°ä¸Šè°ƒç”¨åŸç”ŸDLLçš„å°è¯•.</p><h1>Unityä¸­è°ƒç”¨éæ‰˜ç®¡çš„åŠ¨æ€åº“</h1><p>å¦‚æœæƒ³åœ¨C#ä¾§ä½¿ç”¨C++ä¸­çš„ä¸€ä¸ªç±»çš„è¯, éœ€è¦å°†è¿™ä¸ªç±»çš„æ¯ä¸€ä¸ªpublicæˆå‘˜æ–¹æ³•å°è£…ä¸€ä¸ª<strong>é™æ€æ–¹æ³•</strong>ä¾›C#æµ‹è°ƒç”¨, ç„¶åC#ä¾§åšä¸€ä¸ªä¸­é—´å±‚çš„å°è£…,å³åœ¨C#ä¾§å°†è¿™äº›é™æ€æ–¹æ³•é‡æ–°å°è£…æˆç±».</p><p>ä»¥ä¸€ä¸ªStackç»“æ„ä¸ºä¾‹:</p><h2 id="C-ä¾§">C++ä¾§</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// StackLib.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> STACKLIBRARY_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STACKLIBRARY_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _WIN32</span></span><br><span class="line">    <span class="meta">#<span class="keyword">ifdef</span> BUILDING_DLL</span></span><br><span class="line">        <span class="meta">#<span class="keyword">define</span> DLL_PUBLIC __declspec(dllexport)</span></span><br><span class="line">    <span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">        <span class="meta">#<span class="keyword">define</span> DLL_PUBLIC __declspec(dllimport)</span></span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">if</span> __GNUC__ &gt;= 4</span></span><br><span class="line">        <span class="meta">#<span class="keyword">define</span> DLL_PUBLIC __attribute__((visibility(<span class="string">&quot;default&quot;</span>)))</span></span><br><span class="line">    <span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">        <span class="meta">#<span class="keyword">define</span> DLL_PUBLIC</span></span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Stack</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Stack</span>();</span><br><span class="line">    ~<span class="built_in">Stack</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Push</span><span class="params">(<span class="type">int</span> value)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">Pop</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">IsEmpty</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::stack&lt;<span class="type">int</span>&gt; stack_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Cé£æ ¼æ¥å£å¯¼å‡º</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">DLL_PUBLIC Stack* <span class="title">CreateStack</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">DLL_PUBLIC <span class="type">void</span> <span class="title">DestroyStack</span><span class="params">(Stack* instance)</span></span>;</span><br><span class="line"><span class="function">DLL_PUBLIC <span class="type">void</span> <span class="title">Push</span><span class="params">(Stack* instance, <span class="type">int</span> value)</span></span>;</span><br><span class="line"><span class="function">DLL_PUBLIC <span class="type">int</span> <span class="title">Pop</span><span class="params">(Stack* instance)</span></span>;</span><br><span class="line"><span class="function">DLL_PUBLIC <span class="type">bool</span> <span class="title">IsEmpty</span><span class="params">(Stack* instance)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// STACKLIBRARY_H</span></span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// StackLib.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;StackLib.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdexcept&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// --- Stackçš„å®ç° ---</span></span><br><span class="line"></span><br><span class="line">Stack::<span class="built_in">Stack</span>() &#123;&#125;</span><br><span class="line">Stack::~<span class="built_in">Stack</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Stack::Push</span><span class="params">(<span class="type">int</span> value)</span> </span>&#123;</span><br><span class="line">    stack_.<span class="built_in">push</span>(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Stack::Pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (stack_.<span class="built_in">empty</span>())</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>; <span class="comment">// æˆ–throw std::underflow_error</span></span><br><span class="line">    <span class="type">int</span> value = stack_.<span class="built_in">top</span>();</span><br><span class="line">    stack_.<span class="built_in">pop</span>();</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Stack::IsEmpty</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> stack_.<span class="built_in">empty</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --- C æ¥å£å®ç° ---</span></span><br><span class="line"><span class="function">Stack* <span class="title">CreateStack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Stack</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DestroyStack</span><span class="params">(Stack* instance)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">delete</span> instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Push</span><span class="params">(Stack* instance, <span class="type">int</span> value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (instance) &#123;</span><br><span class="line">        instance-&gt;<span class="built_in">Push</span>(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Pop</span><span class="params">(Stack* instance)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> instance ? instance-&gt;<span class="built_in">Pop</span>() : <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">IsEmpty</span><span class="params">(Stack* instance)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> instance ? instance-&gt;<span class="built_in">IsEmpty</span>() : <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨Macä¸Š, å¯¼å‡ºdylib:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -std=c++11 -dynamiclib -o libStackLibrary.dylib StackLib.cpp</span><br></pre></td></tr></table></figure><p>åœ¨Windowsä¸Š, å¯¼å‡ºdll:<br>ç¬”è€…çš„æ“ä½œç¯å¢ƒæ˜¯VMWareä¸‹çš„ArmWin11è™šæ‹Ÿæœº, ä½¿ç”¨çš„æ˜¯Visual Studio 2022è‡ªå¸¦çš„ç¼–è¯‘å™¨<code>x64 Native Tools Command Prompt for VS 2022</code>, å®‰è£…äº†VisualStudioä¹‹åä½¿ç”¨Windowsè‡ªå¸¦çš„æœç´¢åŠŸèƒ½åº”è¯¥æ˜¯èƒ½æœåˆ°çš„, æ‰“å¼€æ˜¯ä¸€ä¸ªç»ˆç«¯, è¾“å…¥ä¸‹é¢å‘½ä»¤:</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cl /LD /DBUILDING_DLL=<span class="number">1</span> StackLib.cpp /Fe:StackLibrary.dll</span><br></pre></td></tr></table></figure><blockquote><p>ğŸ’¡ç¬”è€…ä¹Ÿå°è¯•ä½¿ç”¨<a href="https://sourceforge.net/projects/mingw-gcc-arm-eabi/">MinGW GCC For ARM</a>æ¥æ„å»ºDLL, ä½†æ˜¯æ„å»ºå‡ºçš„dllå¯¼å…¥åˆ°Unityä¸­æ„å»ºå‡ºæ¥exeå¹¶ä¸èƒ½æ­£ç¡®è¿è¡Œ, å¹¶æ²¡æœ‰æ·±ç©¶.</p></blockquote><h2 id="C-ä¾§-2">C#ä¾§</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.InteropServices;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">CPP</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">StackCaller</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> Text Log;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Log.text = <span class="built_in">string</span>.Empty;</span><br><span class="line">            Log.text += <span class="string">&quot;StackCaller start\n&quot;</span>;</span><br><span class="line">            Debug.Log(<span class="string">&quot;StackCaller start&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// åˆ›å»ºæ ˆå®ä¾‹</span></span><br><span class="line">            <span class="keyword">var</span> stackWrapper = <span class="keyword">new</span> StackCPP();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å…¥æ ˆæ“ä½œ</span></span><br><span class="line">            stackWrapper.Push(<span class="number">10</span>);</span><br><span class="line">            stackWrapper.Push(<span class="number">20</span>);</span><br><span class="line">            stackWrapper.Push(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å‡ºæ ˆæ“ä½œå¹¶è¾“å‡ºç»“æœ</span></span><br><span class="line">            <span class="keyword">while</span> (!stackWrapper.IsEmpty())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">int</span> <span class="keyword">value</span> = stackWrapper.Pop();</span><br><span class="line">                Log.text += <span class="string">&quot;Popped value: &quot;</span> + <span class="keyword">value</span> + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">                Debug.Log(<span class="string">&quot;Popped value: &quot;</span> + <span class="keyword">value</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// é”€æ¯æ ˆå®ä¾‹</span></span><br><span class="line">            stackWrapper.DestroyStack();</span><br><span class="line">            Log.text += <span class="string">&quot;Stack destroyed&quot;</span>;</span><br><span class="line">            Debug.Log(<span class="string">&quot;Stack destroyed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">StackDLL</span>&#123;</span><br><span class="line">        <span class="comment">// å¼•å…¥C++åŠ¨æ€é“¾æ¥åº“ä¸­çš„å‡½æ•°</span></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;StackLibrary&quot;</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> IntPtr <span class="title">CreateStack</span>()</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;StackLibrary&quot;</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">DestroyStack</span>(<span class="params">IntPtr stackWrapper</span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;StackLibrary&quot;</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">Push</span>(<span class="params">IntPtr stackWrapper, <span class="built_in">int</span> <span class="keyword">value</span></span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;StackLibrary&quot;</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">int</span> <span class="title">Pop</span>(<span class="params">IntPtr stackWrapper</span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DllImport(<span class="string">&quot;StackLibrary&quot;</span>)</span>]</span><br><span class="line">        [<span class="meta">return: MarshalAs(UnmanagedType.I1)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="built_in">bool</span> <span class="title">IsEmpty</span>(<span class="params">IntPtr stackWrapper</span>)</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">StackCPP</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> IntPtr stackPointer;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">StackCPP</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            stackPointer = StackDLL.CreateStack();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Push</span>(<span class="params"><span class="built_in">int</span> <span class="keyword">value</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            StackDLL.Push(stackPointer, <span class="keyword">value</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">Pop</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> StackDLL.Pop(stackPointer);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsEmpty</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> StackDLL.IsEmpty(stackPointer);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DestroyStack</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            StackDLL.DestroyStack(stackPointer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>æ€»ç»“</h1><ul><li>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯Mac, æ³¨æ„ä½ çš„Macæ¶æ„æ˜¯armè¿˜æ˜¯x86çš„, åœ¨Macå¹³å°çš„BuildPlayeré¡µé¢, é€‰æ‹©å¯¹åº”çš„Apple Siliconã€Intelæˆ–Apple Silicon + Interl.</li><li>åœ¨Unityå¼€å‘åœºæ™¯ä¸‹, åŸç”Ÿdllé€‚ç”¨äºå¿…é¡»åˆ©ç”¨C/C++ä¼˜åŠ¿/å¹³å°/æ€§èƒ½çš„æç‰¹æ®Šåœºæ™¯, æœ¬æ–‡åªæ˜¯ä¸ºäº†æ¼”ç¤ºä½œç”¨, å®é™…å¼€å‘ä¸­æ˜¯ç»å¯¹ä¸ä¼šåœ¨è¿™ç§åœºæ™¯ä¸‹è°ƒç”¨åŸç”Ÿdllçš„.</li><li>æƒ³è¦åœ¨å“ªä¸ªå¹³å°è·‘, å°±ç°åœ¨å“ªä¸ªå¹³å°ä¸Šæ„å»ºåŸç”Ÿçš„dll, ç„¶åå°†æ„å»ºå‡ºçš„dllå¯¼å…¥åˆ°Unity, å†ç”¨Unityæ„å»ºå‡ºå“ªä¸ªå¹³å°çš„Package.</li></ul><h1>[DllImport(â€œ__Internalâ€)]</h1><p>[DllImport(â€œxxx.dllâ€)] æ˜¯ .NET / C# çš„ P/Invoke è¯­æ³•ï¼Œä½œç”¨æ˜¯è®© C# å¯ä»¥è°ƒç”¨å¤–éƒ¨çš„ Cã€C++ã€Objective-C ç­‰â€œæœ¬åœ°å‡½æ•°â€ã€‚</p><p>ä¸€èˆ¬å†™æˆè¿™æ ·ï¼š</p><p>[DllImport(â€œmyPluginâ€)]<br>public static extern int MyNativeFunction(int a, int b);<br>2. â€œ__Internalâ€ ç‰¹æ®Šå«ä¹‰</p><p>å½“ä½ ç”¨ [DllImport(â€œ__Internalâ€)] è¿™æ ·å†™æ—¶ï¼Œâ€œ__Internalâ€æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ä¼ªåç§°ï¼Œè€Œä¸æ˜¯æŒ‡æŸä¸ªå®é™…æ–‡ä»¶ã€‚<br>å…¶çœŸæ­£å«ä¹‰æ˜¯ï¼š</p><p>è®© .NET æˆ– Unity åœ¨ æœ¬è¿›ç¨‹/æœ¬ç¨‹åº/ä¸»å¯æ‰§è¡Œç¨‹åºè‡ªèº« çš„å¯¼å‡ºè¡¨é‡Œå¯»æ‰¾æœ¬åœ°å®ç°çš„ç¬¦å·ã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¢« [DllImport(â€œ__Internalâ€)] æ ‡æ³¨çš„æ–¹æ³•ï¼Œå¯¹åº”çš„æœ¬åœ°æ–¹æ³•ä½“éœ€è¦åœ¨å½“å‰å¯æ‰§è¡Œç¨‹åºå†…éƒ¨ï¼ˆè€Œä¸æ˜¯æŸä¸ªå¤–éƒ¨ DLL æ–‡ä»¶é‡Œï¼‰ã€‚<br>ç¬¦å·åæœç´¢ä¼šåœ¨è‡ªå·±çš„ executable å¯¼å‡ºé‡Œæ‰¾ã€‚<br>3. åº”ç”¨åœºæ™¯ä¸¾ä¾‹</p><p>åœºæ™¯Aï¼šiOSã€Mac ç­‰å¹³å°ï¼ˆç‰¹åˆ«æ˜¯ Unityï¼‰</p><p>Unity/IL2CPP åœ¨ç”Ÿæˆ iOSã€Mac åŸç”Ÿå·¥ç¨‹æ—¶ï¼Œå¦‚æœä½ å†™äº†ï¼š<br>[DllImport(â€œ__Internalâ€)]<br>public static extern void MyFunc();<br>å®é™…ä¸Šï¼ŒIL2CPP ç¼–è¯‘å™¨ä¼šåœ¨æœ€ç»ˆçš„ App binaryï¼ˆæˆ– Framework äºŒè¿›åˆ¶ï¼‰é‡Œæœ åä¸º MyFunc çš„å¯¼å‡ºå‡½æ•°ï¼Œè€Œä¸æ˜¯å»åŠ¨æ€æŸ¥æ‰¾æŸä¸ªå¤–éƒ¨åº“ï¼ˆ.dylibã€.soã€.dllï¼‰ã€‚<br>è¿™æ ·åšçš„å¥½å¤„ï¼š<br>iOS å¹³å°ä¸å…è®¸åƒ Windows é‚£æ ·åŠ¨æ€é“¾æ¥ç¬¬ä¸‰æ–¹ DLLï¼Œæ‰€æœ‰ Native ä»£ç éƒ½å¿…é¡»é™æ€é“¾æ¥è¿› App çš„ä¸»å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚<br>[DllImport(â€œ__Internalâ€)] æ˜¯å”¯ä¸€å®‰å…¨æ”¯æŒçš„æ–¹å¼ã€‚<br>åœºæ™¯Bï¼šè‡ªå·±å†™å¥½æœ¬åœ°å‡½æ•°å¹¶é“¾æ¥è¿›ä¸»ç¨‹åº</p><p>å¦‚æœä½ åœ¨æ„å»ºçš„ä¸»ç¨‹åºä¸­åµŒå…¥äº†è‡ªå·±çš„ C ä»£ç ï¼Œå¯ä»¥ç›´æ¥ç»™å¯¼å‡ºç¬¦å·ä»¥ä¾› .NET æŸ¥æ‰¾ï¼Œæ— éœ€æ‹†åˆ†å¤–éƒ¨ DLL æ–‡ä»¶ã€‚<br>4. å¯¹æ¯”è°ƒç”¨å¤–éƒ¨DLL</p><p>[DllImport(â€œuser32.dllâ€)] å°±æ˜¯åœ¨æ‰¾ Windows çš„ç³»ç»ŸåŠ¨æ€åº“ã€‚<br>[DllImport(â€œ__Internalâ€)] æ˜¯åœ¨æ‰¾å½“å‰ç¨‹åºï¼ˆAppã€è‡ªèº«è¿›ç¨‹ã€ä¸» binaryï¼‰ä¸­å®šä¹‰çš„æœ¬åœ°ç¬¦å·â€”â€”é€šå¸¸åªæœ‰åœ¨æœ¬åœ°ä»£ç ç¼–è¯‘æˆä¸»ç¨‹åºæ—¶æ‰ä¼šæœ‰ã€‚<br>5. Unityçš„å¸¸è§ç”¨æ³•</p><p>åœ¨ Unity iOS æ’ä»¶å¼€å‘ä¸­ï¼ŒNative ä»£ç ï¼ˆC/Objective-C/C++/Swiftï¼‰æœ€ç»ˆä¼šè¢«é“¾æ¥è¿›ä¸» app binaryï¼Œæ­¤æ—¶ C# è®¿é—®åŸç”Ÿå‡½æ•°éƒ½è¦ç”¨ [DllImport(â€œ__Internalâ€)]ï¼Œä¸èƒ½å†™æˆ â€œyourlib.dylibâ€ â€”â€” å¦åˆ™æ‰¾ä¸åˆ°æˆ–è¢«è‹¹æœå®¡æ ¸æ‹’ç»ã€‚</p><p>[DllImport(â€œ__Internalâ€)]<br>public static extern void MyObjCFunc();</p><p>[DllImport(â€œ__Internalâ€)] è®© C#ï¼ˆMono/.NET/Unityï¼‰å»ä¸»ç¨‹åºè‡ªèº«å¯¼å‡ºç¬¦å·è¡¨é‡Œæ‰¾å‡½æ•°ï¼Œè€Œä¸æ˜¯å»åŠ è½½æŸä¸ªå¤–éƒ¨DLLæ–‡ä»¶ã€‚<br>å¸¸è§äº iOSã€Mac Unity åŸç”Ÿæ’ä»¶å¼€å‘åœºæ™¯ã€‚<br>Windows å¹³å°ä¸€èˆ¬ç”¨ [DllImport(â€œxxx.dllâ€)] åŠ è½½å¤–éƒ¨åº“ã€‚<br>å¦‚æœä½ åœ¨ Windows ä¸‹ç”¨ [DllImport(â€œ__Internalâ€)]ï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹ç”¨ä¸åˆ°ï¼ˆé™¤éè‡ªå·±è‡ªå®šä¹‰å¯æ‰§è¡Œæ–‡ä»¶å‡ºå£ï¼Œä¸”ç”¨Mono/IL2CPPç­‰ç‰¹æ®Šæ–¹æ¡ˆï¼‰ã€‚</p><h2 id="âš ï¸æ³¨æ„äº‹é¡¹">âš ï¸æ³¨æ„äº‹é¡¹</h2><ul><li><code>unknown type name '__declspec' å’Œ unknown type name 'class' é”™è¯¯</code>  <a href="https://blog.csdn.net/lc250123/article/details/81985336">https://blog.csdn.net/lc250123/article/details/81985336</a></li></ul><hr><p>ä»¥å®ç°å†’æ³¡æ’åºåŠŸèƒ½ä¸ºä¾‹è®°å½•å¦‚ä½•åœ¨<code>C#</code>å’Œ<code>C++</code>ä¸­ç¼–å†™ã€ç”Ÿæˆå’Œè°ƒç”¨DLL</p><h1>CPPä¸­çš„DLL</h1><h2 id="Macç¯å¢ƒ">Macç¯å¢ƒ</h2><p>1.åˆ›å»ºå¤´æ–‡ä»¶å’ŒCPPæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// åˆ›å»ºå¤´æ–‡ä»¶</span><br><span class="line">touch Head.h</span><br><span class="line"></span><br><span class="line">// è¾…åŠ©ç±»çš„æ–¹æ³• </span><br><span class="line">touch Utils.cpp</span><br><span class="line"></span><br><span class="line">// æ’åºæ–¹æ³•</span><br><span class="line">touch SortUtils.cpp</span><br><span class="line"></span><br><span class="line">// ä¸»æ–¹æ³•</span><br><span class="line">touch Main.cpp</span><br></pre></td></tr></table></figure><p>2.ç¼–å†™å„æ–‡ä»¶</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Head.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> HEAD_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HEAD_H</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">void</span> <span class="title">Swap</span><span class="params">(<span class="type">int</span> &amp;x, <span class="type">int</span> &amp;y)</span></span>;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">void</span> <span class="title">PrintArr</span><span class="params">(<span class="type">int</span> *arr, <span class="type">int</span> size)</span></span>;</span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">void</span> <span class="title">BubbleSort</span><span class="params">(<span class="type">int</span> *arr, <span class="type">int</span> size)</span></span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Utils.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;Head.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">void</span> <span class="title">Swap</span><span class="params">(<span class="type">int</span> &amp;x, <span class="type">int</span> &amp;y)</span></span>&#123;</span><br><span class="line">  <span class="type">int</span> temp = x;</span><br><span class="line">  x = y;</span><br><span class="line">  y = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">void</span> <span class="title">PrintArr</span><span class="params">(<span class="type">int</span> *arr, <span class="type">int</span> size)</span></span>&#123;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;Sorted Array:&quot;</span> &lt;&lt; endl;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; size; i++)&#123;</span><br><span class="line">    cout &lt;&lt; arr[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line"> &#125;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SortUtils.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;Head.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">void</span> <span class="title">BubbleSort</span><span class="params">(<span class="type">int</span> *arr, <span class="type">int</span> size)</span></span>&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; size; i++)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; size - i - <span class="number">1</span>; j++)&#123;</span><br><span class="line">      <span class="keyword">if</span>(arr[j] &gt; arr[j+<span class="number">1</span>])&#123;</span><br><span class="line">          <span class="built_in">Swap</span>(arr[j], arr[j+<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Main.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="comment">// æ“ä½œdllç›¸å…³å¤´æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;dlfcn.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*BubbleSort)</span><span class="params">(<span class="type">int</span>*,<span class="type">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*PrintArr)</span><span class="params">(<span class="type">int</span>*,<span class="type">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åŠ è½½DLL</span></span><br><span class="line">  <span class="type">void</span> *handle = <span class="built_in">dlopen</span>(<span class="string">&quot;Utils.dylib&quot;</span>,RTLD_LAZY);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆ¤æ–­DLLæ˜¯å¦åŠ è½½æˆåŠŸ</span></span><br><span class="line">  <span class="keyword">if</span>(handle == <span class="literal">nullptr</span>)&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Load DLL Fail!&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  BubbleSort bubbleSort = <span class="built_in">reinterpret_cast</span>&lt;BubbleSort&gt;(<span class="built_in">dlsym</span>(handle,<span class="string">&quot;BubbleSort&quot;</span>));</span><br><span class="line">  PrintArr printArr = <span class="built_in">reinterpret_cast</span>&lt;PrintArr&gt;(<span class="built_in">dlsym</span>(handle,<span class="string">&quot;PrintArr&quot;</span>));</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// åˆ¤æ–­DLLä¸­çš„ä¸¤ä¸ªå‡½æ•°æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">  <span class="keyword">if</span>(bubbleSort == <span class="literal">nullptr</span>)&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Load BubbleSort Func Fail!&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span>(printArr == <span class="literal">nullptr</span>)&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Load PrintArr Func Fail!&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;Input Random Numbers:(Press X and then Press Enter to End Input)&quot;</span> &lt;&lt; endl;</span><br><span class="line">  </span><br><span class="line">  <span class="type">int</span> number = <span class="number">0</span>;</span><br><span class="line">  vector&lt;<span class="type">int</span>&gt; randomNums;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">while</span>(cin &gt;&gt; number)&#123;</span><br><span class="line">    randomNums.<span class="built_in">push_back</span>(number);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="type">int</span> size = randomNums.<span class="built_in">size</span>();</span><br><span class="line">  <span class="type">int</span> arr[size];</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; size; i++)&#123;</span><br><span class="line">    arr[i] = randomNums[i];</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">bubbleSort</span>(arr,size);</span><br><span class="line">  <span class="built_in">printArr</span>(arr,size);</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">dlclose</span>(handle);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.ç”ŸæˆDLL</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">g++ -c -fPIC Utils.cpp -o Utils.o</span><br><span class="line"></span><br><span class="line">g++ -c -fPIC SortUtils.cpp -o SortUtils.o</span><br><span class="line"></span><br><span class="line">// Macç¯å¢ƒä¸­C++çš„dllæ–‡ä»¶ç±»å‹æ˜¯.dylib</span><br><span class="line">g++ -shared SortUtils.o Utils.o -o Utils.dylib</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -shared SortUtils.cpp Utils.cpp -o Utils.dylib</span><br></pre></td></tr></table></figure><p>4.ç¼–è¯‘Main.cpp</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ Main.cpp -o a</span><br></pre></td></tr></table></figure><p>5.è¿è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./a</span><br></pre></td></tr></table></figure><h1>CSä¸­çš„DLL</h1><h2 id="Macç¯å¢ƒ-2">Macç¯å¢ƒ</h2><p>1.åˆ›å»ºDLLé¡¹ç›®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŒ‡å®šåˆ›å»ºçš„é¡¹ç›®åç§°å’Œ.NETç‰ˆæœ¬</span></span><br><span class="line">dotnet new classlib -o Utils -f net8.0</span><br></pre></td></tr></table></figure><p>2.ç¼–å†™DLLè„šæœ¬</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SortUtils.cs</span></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Utils;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">SortUtils</span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SortUtils</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">BubbleSort</span>(<span class="params"><span class="built_in">int</span>[] arr</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; arr.Length; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; arr.Length - i - <span class="number">1</span>; j++)&#123;</span><br><span class="line">          <span class="keyword">if</span>(arr[j] &gt; arr[j+<span class="number">1</span>]) Utils.Utils.Swap(<span class="keyword">ref</span> arr[j], <span class="keyword">ref</span> arr[j+<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Utils.cs</span></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Utils</span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Utils</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Swap</span>(<span class="params"><span class="keyword">ref</span> <span class="built_in">int</span> x, <span class="keyword">ref</span> <span class="built_in">int</span> y</span>)</span>&#123;</span><br><span class="line">      <span class="built_in">int</span> temp = x;</span><br><span class="line">      x = y;</span><br><span class="line">      y = temp;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">PrintArr</span>(<span class="params"><span class="built_in">int</span>[] arr</span>)</span>&#123;</span><br><span class="line">      Console.WriteLine(<span class="string">&quot;Sorted Array:&quot;</span>);</span><br><span class="line">      <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; arr.Length; i++)&#123;</span><br><span class="line">        Console.Write(<span class="string">$&quot;<span class="subst">&#123;arr[i]&#125;</span> &quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      Console.Write(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.ç¼–è¯‘ç”ŸæˆDLL</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet build</span><br></pre></td></tr></table></figure><p>4.åˆ›å»ºå¼•ç”¨DLLçš„é¡¹ç›®</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet <span class="keyword">new</span> console -o Project -f net7<span class="number">.0</span></span><br></pre></td></tr></table></figure><p>5.åœ¨é¡¹ç›®ä¸­å¼•ç”¨DLL</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim Project.csproj</span><br></pre></td></tr></table></figure><p>åœ¨Projectæ ‡ç­¾ä¸‹æ·»åŠ å¦‚ä¸‹ä»£ç </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Reference</span> <span class="attr">Include</span>=<span class="string">&quot;DLLæ–‡ä»¶å&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">HintPath</span>&gt;</span>DLLæ–‡ä»¶è·¯å¾„<span class="tag">&lt;/<span class="name">HintPath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Reference</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ItemGroup</span>&gt;</span></span><br></pre></td></tr></table></figure><p>6.ç¼–å†™æµ‹è¯•ä»£ç </p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Program.cs</span></span><br><span class="line"><span class="keyword">using</span> System.Text.RegularExpressions;</span><br><span class="line"><span class="keyword">using</span> Utils;</span><br><span class="line"><span class="keyword">using</span> SortUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Program</span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    Console.WriteLine(<span class="string">&quot;Input Random Numbers:&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">string</span>? input = Console.ReadLine();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(input == <span class="literal">null</span>)&#123;</span><br><span class="line">      Console.WriteLine(<span class="string">&quot;Input Nums Null!&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Regex regex = <span class="keyword">new</span> Regex(<span class="string">@&quot;\d+&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    MatchCollection matches = regex.Matches(input);</span><br><span class="line">      </span><br><span class="line">    List&lt;<span class="built_in">int</span>&gt; randomNums = <span class="keyword">new</span> List&lt;<span class="built_in">int</span>&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">foreach</span>(Match match <span class="keyword">in</span> matches)&#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="built_in">int</span>.TryParse(match.Value,<span class="keyword">out</span> <span class="built_in">int</span> number))&#123;</span><br><span class="line">        randomNums.Add(number);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">int</span>[] arr = randomNums.ToArray();</span><br><span class="line">    </span><br><span class="line">    SortUtils.SortUtils.BubbleSort(arr);</span><br><span class="line">    Utils.Utils.PrintArr(arr);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>7.éªŒè¯</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet run</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¡¬æŠ€èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æŠ€æœ¯æ–‡æ¡£ </tag>
            
            <tag> C# </tag>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UMLå›¾å­¦ä¹ ç¬”è®°</title>
      <link href="/posts/6ea8fdb7/"/>
      <url>/posts/6ea8fdb7/</url>
      
        <content type="html"><![CDATA[<h1>èƒŒæ™¯</h1><p><a href="https://cloud.tencent.com/developer/article/1684161">https://cloud.tencent.com/developer/article/1684161</a></p><p>UMLå›¾æœ‰å¾ˆå¤šä¸­ï¼Œä½†æ˜¯å¹¶éå¿…é¡»æŒæ¡æ‰€æœ‰çš„UMLå›¾ï¼Œæ‰èƒ½å®Œæˆç³»ç»Ÿåˆ†æå’Œè®¾è®¡å·¥ä½œã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨UMLå›¾ä¸­ï¼Œåªè¦æŒæ¡ç±»å›¾ã€ç”¨ä¾‹å›¾ã€æ—¶åºå›¾çš„ä½¿ç”¨ï¼Œå°±èƒ½å®Œæˆå¤§éƒ¨åˆ†çš„å·¥ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŒæ¡UMLçš„20%ï¼Œå°±å¯ä»¥åš80%çš„äº‹æƒ…ã€‚å¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œæœ€é¢‘ç¹ä½¿ç”¨çš„è«è¿‡äºç±»å›¾ã€‚å› æ­¤æˆ‘ä»¬å…ˆä¸»è¦æ¢è®¨ç±»å›¾ï¼Œå…¶ä»–çš„å›¾æˆ‘ä»¬åœ¨ä¹‹åä¼šä¸æ–­è¡¥å……è¿›æ¥ã€‚</p><h1>ç±»å›¾</h1><p>ç±»å›¾æ˜¯é¢å‘å¯¹è±¡ç³»ç»Ÿå»ºæ¨¡ä¸­æœ€å¸¸ç”¨å’Œæœ€é‡è¦çš„å›¾ï¼Œæ˜¯å®šä¹‰å…¶ä»–å›¾çš„åŸºç¡€ã€‚ç±»å›¾ä¸»è¦æ˜¯ç”¨æ¥æ˜¾ç¤ºç³»ç»Ÿä¸­çš„ç±»ã€æ¥å£ä»¥åŠå®ƒä»¬ä¹‹å‰é™æ€ç»“æ„å’Œå…³ç³»çš„ä¸€ç§é™æ€æ¨¡å‹ã€‚ç±»å›¾ä¸­æœ€åŸºæœ¬çš„å…ƒç´ æ˜¯ç±»ã€æ¥å£ã€‚æˆ‘ä»¬è®¾è®¡å‡ºç±»å›¾åï¼Œå°±å¯ä»¥ç”¨ä»£ç å®ç°ç±»å›¾ä¸­åŒ…å«çš„å†…å®¹ã€‚</p><h2 id="ç±»å›¾ä¸­å…·ä½“ç±»ã€æŠ½è±¡ã€æ¥å£å’ŒåŒ…çš„è¡¨ç¤ºæ–¹æ³•">ç±»å›¾ä¸­å…·ä½“ç±»ã€æŠ½è±¡ã€æ¥å£å’ŒåŒ…çš„è¡¨ç¤ºæ–¹æ³•</h2><p>UMLç±»å›¾ä¸­å…·ä½“ç±»ã€æŠ½è±¡ç±»ã€æ¥å£å’ŒåŒ…æœ‰ä¸åŒçš„è¡¨ç¤ºæ–¹æ³•ã€‚</p><h2 id="åœ¨UMLä¸­è¡¨ç¤ºå…·ä½“ç±»">åœ¨UMLä¸­è¡¨ç¤ºå…·ä½“ç±»</h2><p>å…·ä½“ç±»åœ¨ç±»å›¾ä¸­ç”¨çŸ©å½¢æ¡†è¡¨ç¤ºï¼ŒçŸ©å½¢æ¡†åˆ†ä¸ºä¸‰å±‚ï¼šç¬¬ä¸€å±‚æ˜¯ç±»åï¼›ç¬¬äºŒå±‚æ˜¯ç±»çš„æˆå‘˜å˜é‡ï¼›ç¬¬ä¸‰å±‚æ˜¯ç±»çš„æ–¹æ³•ã€‚æˆå‘˜å˜é‡ä»¥åŠæ–¹æ³•å‰çš„è®¿é—®ä¿®é¥°ç¬¦ç”¨ç¬¦å·æ¥è¡¨ç¤ºï¼š</p><ul><li><code>+</code>è¡¨ç¤º<code>public</code></li><li><code>-</code>è¡¨ç¤º<code>private</code></li><li><code>#</code>è¡¨ç¤º<code>protected</code></li><li>ä¸å¸¦ç¬¦å·è¡¨ç¤º<code>default</code></li></ul><img src="/posts/6ea8fdb7/%E7%B1%BB%E5%9B%BE%E7%A4%BA%E4%BE%8B.jpg" class=""><h2 id="åœ¨UMLç±»å›¾ä¸­è¡¨ç¤ºæŠ½è±¡ç±»">åœ¨UMLç±»å›¾ä¸­è¡¨ç¤ºæŠ½è±¡ç±»</h2><p>æŠ½è±¡ç±»åœ¨UMLç±»å›¾ä¸­åŒæ ·ç”¨çŸ©å½¢æ¡†è¡¨ç¤ºï¼Œä½†æ˜¯æŠ½è±¡ç±»çš„ç±»åä»¥åŠæŠ½è±¡æ–¹æ³•çš„åå­—éƒ½ç”¨æ–œä½“å­—è¡¨ç¤º</p><img src="/posts/6ea8fdb7/%E6%8A%BD%E8%B1%A1%E7%B1%BB.jpg" class=""><h2 id="åœ¨UMLç±»å›¾ä¸­è¡¨ç¤ºæ¥å£">åœ¨UMLç±»å›¾ä¸­è¡¨ç¤ºæ¥å£</h2><p>æ¥å£åœ¨ç±»å›¾ä¸­ä¹Ÿæ˜¯ä½¿ç”¨çŸ©å½¢æ¡†è¿›è¡Œè¡¨ç¤ºçš„ï¼Œä½†æ˜¯ä¸ç±»çš„è¡¨ç¤ºæ–¹æ³•ä¸åŒçš„æ˜¯ï¼Œæ¥å£åœ¨ç±»å›¾ä¸­çš„ç¬¬ä¸€å±‚é¡¶ç«¯ç”¨æ„é€ å‹<code>&lt;&lt;interface&gt;&gt;</code>è¡¨ç¤ºï¼Œä¸‹é¢æ˜¯æ¥å£çš„åå­—ï¼Œç¬¬äºŒå±‚æ˜¯æ–¹æ³•ã€‚æ­¤å¤–ï¼Œæ¥å£è¿˜æœ‰å¦å¤–ä¸€ç§è¡¨ç¤ºæ–¹æ³•ï¼Œä¿—ç§°æ£’æ£’ç³–è¡¨ç¤ºæ³•ï¼Œå°±æ˜¯ç±»ä¸Šé¢çš„ä¸€æ ¹æ£’æ£’ç³–ï¼ˆåœ†åœˆ+å®çº¿ï¼‰ã€‚åœ†åœˆæ—è¾¹ä¸ºæ¥å£åç§°ï¼Œæ¥å£æ–¹æ³•åœ¨å®ç°ç±»ä¸­å‡ºç°ã€‚</p><img src="/posts/6ea8fdb7/%E6%8E%A5%E5%8F%A3.jpg" class=""><h2 id="åœ¨UMLç±»å›¾ä¸­è¡¨ç¤ºåŒ…ï¼ˆçœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªJavaä¸­çš„æ¦‚å¿µï¼Œå…ˆä¸å†™äº†ï¼‰">åœ¨UMLç±»å›¾ä¸­è¡¨ç¤ºåŒ…ï¼ˆçœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªJavaä¸­çš„æ¦‚å¿µï¼Œå…ˆä¸å†™äº†ï¼‰</h2><h1>åœ¨ç±»å›¾ä¸­è¡¨ç¤ºå…³ç³»</h1><p>ç±»å’Œç±»ã€ç±»å’Œæ¥å£ã€æ¥å£å’Œæ¥å£ä¹‹é—´å­˜åœ¨ä¸€å®šçš„å…³ç³»ï¼ŒUMLç±»å›¾ä¸­ä¸€èˆ¬ä¼šæœ‰è¿çº¿æŒ‡æ˜å®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚å…³ç³»ä¸€å…±æœ‰å…­ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯å®ç°å…³ç³»ã€æ³›åŒ–å…³ç³»ã€å…³è”å…³ç³»ã€ä¾èµ–å…³ç³»ã€èšåˆå…³ç³»ã€ç»„åˆå…³ç³»ã€‚</p><p><img src="https://pic4.zhimg.com/v2-e6a48521352fff8270e753ea4a79d9fb_r.jpg" alt=""></p><p>ä¸‹é¢æ¥è¯¦ç»†è®²è¿°è¿™äº›å…³ç³»ï¼Œä»¥åŠåœ¨UMLç±»å›¾ä¸­å¦‚ä½•è¡¨ç¤ºè¿™äº›å…³ç³»ã€‚</p><h2 id="å®ç°å…³ç³»">å®ç°å…³ç³»</h2><p>å®ç°å…³ç³»æ˜¯æŒ‡æ¥å£åŠå…¶å®ç°ç±»ä¹‹é—´çš„å…³ç³»ã€‚åœ¨UMLç±»å›¾ä¸­ï¼Œå®ç°å…³ç³»ç”¨ç©ºå¿ƒä¸‰è§’å’Œè™šçº¿ç»„æˆçš„ç®­å¤´æ¥è¡¨ç¤ºï¼Œä»å®ç°ç±»æŒ‡å‘æ¥å£ï¼Œåœ¨Javaï¼ˆå‚è€ƒçš„åŸæ–‡æ˜¯ä»¥Javaä½œä¸ºå¼€å‘è¯­è¨€çš„ï¼ŒC#å’ŒJavaé«˜åº¦ç›¸ä¼¼ï¼‰ä¸­å®ç°å…³ç³»å¯ä»¥ç›´æ¥ç¿»è¯‘ä¸ºå…³é”®å­—<code>implements</code>ã€‚</p><img src="/posts/6ea8fdb7/UML%E5%9B%BE.jpg" class=""><h2 id="æ³›åŒ–å…³ç³»">æ³›åŒ–å…³ç³»</h2><p>æ³›åŒ–å…³ç³»<code>Generalization</code>æ˜¯æŒ‡å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„ç»§æ‰¿å…³ç³»ã€‚å¦‚æœå¯¹è±¡Aå’Œå¯¹è±¡Bä¹‹é—´çš„<code>is a</code>å…³ç³»æˆç«‹ï¼Œé‚£ä¹ˆäºŒè€…ä¹‹é—´å°±å­˜åœ¨ç»§æ‰¿å…³ç³»ï¼Œå¯¹è±¡Bæ˜¯çˆ¶å¯¹è±¡ï¼Œå¯¹è±¡Aæ˜¯å­å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå¹´è–ªåˆ¶å‘˜å·¥<code>is a</code>å‘˜å·¥ï¼Œå¾ˆæ˜¾ç„¶å¹´è–ªåˆ¶å‘˜å·¥Salaryå¯¹è±¡å’Œå‘˜å·¥Employeeå¯¹è±¡ä¹‹é—´å­˜åœ¨ç»§æ‰¿å…³ç³»ï¼ŒEmployeeå¯¹è±¡æ˜¯çˆ¶å¯¹è±¡ï¼ŒSalaryå¯¹è±¡æ˜¯å­å¯¹è±¡ã€‚</p><p>åœ¨UMLç±»å›¾ä¸­ï¼Œæ³›åŒ–å…³ç³»ç”¨ç©ºå¿ƒä¸‰è§’å½¢å’Œå®çº¿ç»„æˆçš„ç®­å¤´è¡¨ç¤ºï¼Œä»å­ç±»æŒ‡å‘çˆ¶ç±»ï¼Œåœ¨Javaï¼ˆC#ï¼‰ä¸­æ³›åŒ–å…³ç³»å¯ä»¥ç›´æ¥ç¿»è¯‘ä¸ºå…³é”®å­—<code>extends</code>ã€‚</p><img src="/posts/6ea8fdb7/%E6%B3%9B%E5%8C%96%E5%85%B3%E7%B3%BB.jpg" class=""><h2 id="å…³è”å…³ç³»">å…³è”å…³ç³»</h2><p>å…³è”å…³ç³»<code>Association</code>æ˜¯æŒ‡å¯¹è±¡å’Œå¯¹è±¡ä¹‹é—´çš„é“¾æ¥ï¼Œå®ƒä½¿ä¸€ä¸ªå¯¹è±¡çŸ¥é“å¦ä¸€ä¸ªå¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ã€‚åœ¨Javaï¼ˆC#ï¼‰ä¸­ï¼Œå…³è”å…³ç³»çš„ä»£ç è¡¨ç°æˆä¸ºä¸€ä¸ªå¯¹è±¡å«æœ‰å¦ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡çš„ç±»ä»£ç ä¸­åŒ…å«æœ‰å¯¹å¦ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´å°±æ˜¯å…³è”å…³ç³»ã€‚</p><p>å…³è”å…³ç³»æœ‰å•å‘å…³è”å’ŒåŒå‘å…³è”ã€‚å¦‚æœä¸¤ä¸ªå¯¹è±¡éƒ½çŸ¥é“ï¼ˆå³å¯ä»¥è°ƒç”¨ï¼‰å¯¹æ–¹çš„å…¬å…±å±æ€§å’Œæ“ä½œï¼Œé‚£ä¹ˆäºŒè€…å°±æ˜¯åŒå‘å…³è”ã€‚å¦‚æœåªæœ‰ä¸€ä¸ªå¯¹è±¡çŸ¥é“ï¼ˆå³å¯ä»¥è°ƒç”¨ï¼‰å¦ä¸€ä¸ªå¯¹è±¡çš„å…¬å…±å±æ€§å’Œæ“ä½œï¼Œé‚£ä¹ˆå°±æ˜¯å•å‘å…³è”ï¼Œå¤§å¤šæ•°å…³è”éƒ½æ˜¯å•å‘å…³è”ï¼Œå•å‘å…³è”å…³ç³»æ›´å®¹æ˜“å»ºç«‹å’Œç»´æŠ¤ï¼Œæœ‰åŠ©äºå¯»æ‰¾å¯é‡ç”¨çš„ç±»ã€‚</p><p>åœ¨UMLå›¾ä¸­ï¼ŒåŒå‘å…³è”å…³ç³»ç”¨å¸¦ç®­å¤´çš„å®çº¿æˆ–è€…æ— ç®­å¤´çš„å®ç°åŒçº¿è¡¨ç¤ºã€‚å•å‘å…³è”ç”¨ä¸€ä¸ªå¸¦ç®­å¤´çš„å®çº¿è¡¨ç¤ºï¼Œç®­å¤´æŒ‡å‘è¢«å…³è”çš„å¯¹è±¡ï¼Œè¿™å°±æ˜¯å¯¼èˆªæ€§<code>Navigatity</code>ã€‚</p><img src="/posts/6ea8fdb7/UML%E5%9B%BE.png" class=""><p>ä¸€ä¸ªå¯¹è±¡å¯ä»¥æŒæœ‰å…¶ä»–å¯¹è±¡çš„æ•°ç»„æˆ–è€…é›†åˆã€‚åœ¨UMLä¸­ï¼Œé€šè¿‡æ”¾ç½®å¤šé‡æ€§<code>multipicity</code>è¡¨è¾¾å¼åœ¨å…³è”çº¿çš„æœ«ç«¯æ¥è¡¨ç¤ºã€‚å¤šé‡æ€§è¡¨è¾¾å¼å¯ä»¥æ˜¯ä¸€ä¸ªæ•°å­—ã€ä¸€æ®µèŒƒå›´æˆ–è€…æ˜¯å®ƒä»¬çš„ç»„åˆã€‚å¤šé‡æ€§å…è®¸çš„è¡¨è¾¾å¼å¦‚ä¸‹ï¼š</p><ul><li>æ•°å­—ï¼šç²¾ç¡®çš„æ•°é‡</li><li><code>*</code>æˆ–è€…<code>0..*</code>ï¼šè¡¨ç¤º0åˆ°å¤šä¸ª</li><li><code>0..1</code>ï¼šè¡¨ç¤º0æˆ–è€…1ä¸ªï¼Œåœ¨Javaä¸­ç»å¸¸ç”¨ä¸€ä¸ªç©ºå¼•ç”¨æ¥å®ç°</li><li><code>1..*</code>ï¼šè¡¨ç¤º1åˆ°å¤šä¸ª</li></ul><p>åœ¨å…³è”å…³ç³»ä¸­ï¼Œå¦ä¸€ä¸ªç±»çš„å¯¹è±¡æ˜¯è¿™ä¸ªç±»çš„å±æ€§ï¼Œè€Œåœ¨ä¾èµ–å…³ç³»ä¸­ï¼Œæ˜¯é™¤äº†è¿™ç§æƒ…å†µä¹‹å¤–çš„æ‰€æœ‰åœ¨è¿™ä¸ªç±»ä¸­å¼•ç”¨å¦ä¸€ä¸ªç±»çš„å½¢å¼ï¼Œéƒ½ç®—ä¾èµ–å…³ç³»</p><p>å…³è”å…³ç³»åˆåˆ†ä¸ºä¾èµ–å…³è”ã€èšåˆå…³è”å’Œç»„åˆå…³è”ä¸‰ç§ç±»å‹</p><h2 id="ä¾èµ–å…³ç³»">ä¾èµ–å…³ç³»</h2><p>ä¾èµ–<code>Dependency</code>å…³ç³»æ˜¯ä¸€ç§å¼±å…³è”å…³ç³»ã€‚å¦‚æœå¯¹è±¡Aç”¨åˆ°å¯¹è±¡Bï¼Œä½†æ˜¯å’ŒBçš„å…³ç³»ä¸æ˜¯å¤ªæ˜æ˜¾çš„æ—¶å€™ï¼Œå°±å¯ä»¥æŠŠè¿™ç§å…³ç³»çœ‹ä½œä¾èµ–å…³ç³»ã€‚å¦‚æœå¯¹è±¡Aä¾èµ–äºå¯¹è±¡Bï¼Œåˆ™A <code>use a</code> Bã€‚æ¯”å¦‚é©¾é©¶å‘˜å’Œæ±½è½¦çš„å…³ç³»ï¼Œé©¾é©¶å‘˜ä½¿ç”¨æ±½è½¦ï¼Œä¸¤è€…æ˜¯ä¾èµ–å…³ç³»ã€‚</p><p>åœ¨UMLç±»å›¾ä¸­ï¼Œä¾èµ–å…³ç³»ç”¨ä¸€ä¸ªå¸¦è™šçº¿çš„ç®­å¤´è¡¨ç¤ºï¼Œç”±ä½¿ç”¨æ–¹å‘æŒ‡å‘è¢«ä½¿ç”¨æ–¹ï¼Œè¡¨ç¤ºä½¿ç”¨æ–¹å¯¹è±¡æ˜¯æœ‰çš„è¢«ä½¿ç”¨æ–¹å¯¹è±¡çš„å¼•ç”¨ã€‚</p><img src="/posts/6ea8fdb7/UML%E5%9B%BE-1681836701455-4.png" class=""><p>ä¾èµ–å…³ç³»åœ¨ä»£ç ä¸­çš„å…·ä½“è¡¨ç°å½¢å¼ä¸ºBä¸ºAçš„æ„é€ å™¨æˆ–æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡ã€æ–¹æ³•æˆ–æ„é€ å™¨çš„å‚æ•°ã€æ–¹æ³•çš„è¿”å›å€¼ï¼Œæˆ–è€…Aè°ƒç”¨Bçš„é™æ€æ–¹æ³•ã€‚</p><p>ä¸å¥½ç†è§£ï¼Œç›´æ¥çœ‹ä»£ç ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">B</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> field1; <span class="comment">//æˆå‘˜å˜é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method1</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;åœ¨Bç±»çš„æ–¹æ³•1ä¸­&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">method2</span>() <span class="comment">//é™æ€æ–¹æ³•</span></span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;åœ¨Bç±»é™æ€æ–¹æ³•2ä¸­&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯ä¾èµ–Bç±»çš„Aç±»ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">A</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method1</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//  Aä¾èµ–äºBçš„ç¬¬ä¸€ç§è¡¨ç°å½¢å¼ï¼šBä¸ºAçš„å±€éƒ¨å˜é‡</span></span><br><span class="line">        B b = <span class="keyword">new</span> B();</span><br><span class="line">        b.method1();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method2</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Aä¾èµ–äºBçš„ç¬¬äºŒç§è¡¨ç°å½¢å¼ï¼šè°ƒç”¨Bä¸­çš„é™æ€æ–¹æ³•</span></span><br><span class="line">        B.method2();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method3</span>(<span class="params">B b</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Aä¾èµ–Bçš„ç¬¬ä¸‰ç§è¡¨ç°å½¢å¼ï¼šBä½œä¸ºAçš„æ–¹æ³•å‚æ•°</span></span><br><span class="line">        <span class="built_in">string</span> s = b.field1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> B <span class="title">method</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Aä¾èµ–Bçš„ç¬¬å››ç§è¡¨ç°å½¢å¼ï¼šBä½œä¸ºAçš„æ–¹æ³•çš„è¿”å›å€¼</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> B();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="èšåˆå…³ç³»å’Œç»„åˆå…³ç³»">èšåˆå…³ç³»å’Œç»„åˆå…³ç³»</h2><p>èšåˆ<code>Aggregation</code>æ˜¯å…³è”å…³ç³»çš„ä¸€ç§ç‰¹ä¾‹ï¼Œå®ƒä½“ç°çš„æ˜¯æ•´ä½“ä¸éƒ¨åˆ†çš„æ‹¥æœ‰å…³ç³»ï¼Œå³<code>has a</code>çš„å…³ç³»ã€‚æ­¤æ—¶æ•´ä½“ä¸éƒ¨åˆ†ä¹‹é—´æ˜¯å¯åˆ†ç¦»çš„ï¼Œå®ƒä»¬å¯ä»¥å…·æœ‰å„è‡ªçš„ç”Ÿå‘½å‘¨æœŸï¼Œéƒ¨åˆ†å¯ä»¥å±äºå¤šä¸ªæ•´ä½“å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥ä¸ºå¤šä¸ªæ•´ä½“å¯¹è±¡å…±äº«ï¼Œæ‰€ä»¥èšåˆå…³ç³»ä¹Ÿå¸¸ç§°ä¸ºå…±äº«å…³ç³»ã€‚ä¾‹å¦‚ï¼Œå…¬å¸éƒ¨é—¨ä¸å‘˜å·¥çš„å…³ç³»ï¼Œä¸€ä¸ªå‘˜å·¥å¯ä»¥å±äºå¤šä¸ªéƒ¨é—¨ï¼Œä¸€ä¸ªéƒ¨é—¨æ’¤é”€äº†ï¼Œå‘˜å·¥å¯ä»¥è½¬åˆ°å…¶ä»–éƒ¨é—¨ã€‚</p><p>åœ¨UMLå›¾ä¸­ï¼Œèšåˆå…³ç³»ç”¨ç©ºå¿ƒè±å½¢+å®çº¿ç®­å¤´è¡¨ç¤ºï¼Œç©ºå¿ƒè±å½¢åœ¨æ•´ä½“ä¸€æ–¹ï¼Œç®­å¤´æŒ‡å‘éƒ¨åˆ†ä¸€æ–¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/posts/6ea8fdb7/UML%E5%9B%BE-1681836784310-6.jpg" class="" title="UMLå›¾"><p>ç»„åˆ<code>Composition</code>ä¹Ÿæ˜¯å…³è”å…³ç³»çš„ä¸€ç§ç‰¹ä¾‹ï¼Œå®ƒåŒæ ·ä½“ç°æ•´ä½“ä¸éƒ¨åˆ†ä¹‹é—´çš„åŒ…å«å…³ç³»ï¼Œå³<code>contains a</code>çš„å…³ç³»ã€‚ä½†æ­¤æ—¶æ•´ä½“ä¸éƒ¨åˆ†æ˜¯ä¸å¯åˆ†çš„ï¼Œéƒ¨åˆ†ä¹Ÿä¸èƒ½ç»™å…¶ä»–æ•´ä½“å…±äº«ï¼Œä½œä¸ºæ•´ä½“çš„å¯¹è±¡è´Ÿè´£éƒ¨åˆ†çš„å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™ç§å…³ç³»æ¯”èšåˆæ›´å¼ºï¼Œä¹Ÿç§°ä¸ºå¼ºèšåˆã€‚å¦‚æœAç»„åˆBï¼Œåˆ™Aéœ€è¦çŸ¥é“Bçš„ç”Ÿå‘½å‘¨æœŸï¼Œå³å¯èƒ½Aè´Ÿè´£ç”Ÿæˆæˆ–è€…é‡Šæ”¾Bï¼Œæˆ–è€…Aé€šè¿‡æŸç§é€”å¾„çŸ¥é“Bçš„ç”Ÿæˆå’Œé‡Šæ”¾ã€‚</p><p>æ¯”å¦‚è¯´ï¼ŒäººåŒ…å«å¤´ã€èº¯å¹²ã€å››è‚¢ï¼Œå®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸä¸€è‡´ã€‚å½“äººå‡ºç”Ÿæ—¶ï¼Œå¤´ã€èº¯å¹²ã€å››è‚¢åŒæ—¶è¯ç”Ÿã€‚å½“äººæ­»äº¡æ—¶ï¼Œä½œä¸ºäººä½“ç»„æˆéƒ¨åˆ†çš„å¤´ã€èº¯å¹²ã€å››è‚¢åŒæ—¶æ­»äº¡ã€‚</p><p>åœ¨UMLå›¾ä¸­ï¼Œç»„åˆå…³ç³»ç”¨å®å¿ƒè±å½¢åŠ å®çº¿ç®­å¤´è¡¨ç¤ºï¼Œå®å¿ƒè±å½¢åœ¨æ•´ä½“ä¸€æ–¹ï¼Œç®­å¤´æŒ‡å‘éƒ¨åˆ†ä¸€æ–¹ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img src="/posts/6ea8fdb7/UML%E5%9B%BE-1681836995575-8.png" class=""><p>åœ¨ä»£ç å½¢å¼ä¸Šï¼Œèšåˆå…³ç³»å’Œç»„åˆå…³ç³»ä¸­éƒ¨åˆ†å¯¹è±¡æ˜¯æ•´ä½“å¯¹è±¡çš„ä¸€ä¸ªæˆå‘˜å˜é‡ã€‚ä½†æ˜¯ï¼Œåœ¨å®é™…åº”ç”¨å¼€å‘æ—¶ï¼Œä¸¤ä¸ªå¯¹è±¡ä¹‹é—´çš„å…³ç³»åˆ°åº•æ˜¯èšåˆè¿˜æ˜¯ç»„åˆï¼Œæœ‰æ—¶å€™å¾ˆéš¾åŒºåˆ«ã€‚åœ¨C#ä¸­ï¼Œä»…ä»ç±»ä»£ç æœ¬èº«æ˜¯åŒºåˆ†ä¸äº†ç»„åˆå’Œèšåˆçš„ã€‚å¦‚æœä¸€å®šè¦åŒºåˆ†ï¼Œé‚£ä¹ˆå¦‚æœåœ¨åˆ é™¤æ•´ä½“å¯¹è±¡çš„æ—¶å€™ï¼Œå¿…é¡»åˆ é™¤æ‰éƒ¨åˆ†å¯¹è±¡ï¼Œé‚£ä¹ˆå°±æ˜¯ç»„åˆå…³ç³»ï¼›å¦åˆ™å°±æœ‰å¯èƒ½æ˜¯èšåˆå…³ç³»ã€‚ä»ä¸šåŠ¡è§’åº¦æ¥çœ‹ï¼Œå¦‚æœä½œä¸ºæ•´ä½“çš„å¯¹ä¸‹å²—å¿…é¡»è¦éƒ¨åˆ†å¯¹è±¡çš„å‚ä¸ï¼Œæ‰èƒ½å®Œæˆè‡ªå·±çš„èŒè´£ï¼Œé‚£ä¹ˆäºŒè€…ä¹‹é—´å°±æ˜¯ç»„åˆå…³ç³»ï¼Œå¦åˆ™å°±æ˜¯èšåˆå…³ç³»ã€‚</p><p>ä¾‹å¦‚ï¼Œæ±½è½¦å’Œè½®èƒï¼Œæ±½è½¦ä½œä¸ºæ•´ä½“ï¼Œè½®èƒä½œä¸ºéƒ¨åˆ†ã€‚å¦‚æœç”¨åœ¨äºŒæ‰‹è½¦é”€å”®ä¸šåŠ¡ç¯å¢ƒä¸‹ï¼ŒäºŒè€…å°±æ˜¯èšåˆå…³ç³»ã€‚å› ä¸ºè½®èƒä½œä¸ºæ±½è½¦çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ï¼Œå®ƒå’Œæ±½è½¦å¯ä»¥åˆ†åˆ«ç”Ÿäº§ä»¥åè£…é…èµ·æ¥ä½¿ç”¨ï¼Œä½†æ˜¯æ±½è½¦å¯ä»¥æ›´æ¢æ–°çš„è½®èƒï¼Œè½®èƒä¹Ÿå¯ä»¥æ‹†ä¸‹æ¥ç»™åˆ«çš„æ±½è½¦ä½¿ç”¨ã€‚å¦‚æœç”¨åœ¨é©¾é©¶ç³»ç»Ÿä¸šåŠ¡ç¯å¢ƒä¸Šï¼Œæ±½è½¦å¦‚æœæ²¡æœ‰è½®èƒï¼Œå°±æ— æ³•å®Œæˆå½¢å¼ä»»åŠ¡ï¼ŒäºŒè€…ä¹‹é—´å°±æ˜¯ä¸€ä¸ªç»„åˆå…³ç³»ã€‚å†æ¯”å¦‚ç½‘ä¸Šä¹¦åº—ä¸šåŠ¡ä¸­çš„è®¢å•å’Œè®¢å•é¡¹ä¹‹é—´çš„å…³ç³»ï¼Œå¦‚æœè®¢å•ä¸­æ²¡æœ‰è®¢å•é¡¹ï¼Œä¹Ÿå°±æ— æ³•å®Œæˆè®¢å•çš„ä¸šåŠ¡ï¼Œæ‰€ä»¥äºŒè€…æ˜¯ç»„åˆå…³ç³»ã€‚è€Œè´­ç‰©è½¦å’Œå•†å“ä¹‹é—´çš„å…³ç³»ï¼Œå› ä¸ºå•†å“çš„ç”Ÿå‘½å‘¨æœŸå¹¶ä¸è¢«è´­ç‰©è½¦æ§åˆ¶ï¼Œå•†å“å¯ä»¥è¢«å¤šä¸ªè´­ç‰©è½¦å…±äº«ï¼Œå› æ­¤ï¼ŒäºŒè€…ä¹‹é—´æ˜¯èšåˆå…³ç³»ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è½¯æŠ€èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æŠ€æœ¯æ–‡æ¡£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºåç¨‹Coroutine</title>
      <link href="/posts/83d7c4e7/"/>
      <url>/posts/83d7c4e7/</url>
      
        <content type="html"><![CDATA[<h1>Unityä¸­çš„åç¨‹å’ŒçœŸæ­£çš„åç¨‹å¹¶ä¸æ˜¯ä¸€å›äº‹</h1><p>Unityçš„åç¨‹è¿™ä¸ªæ¦‚å¿µè¿˜çœŸæœ‰å¯èƒ½ä¼šè®©åªæ¥è§¦è¿‡Unityçš„C#å¼€å‘è€…äº§ç”Ÿè¯¯è§£, æ¯”å¦‚åœ¨å®é™…å¼€å‘ä¸­, ä¸€ä¸ªèµ„æºåŒæ­¥åŠ è½½çš„æ—¶é—´å¤ªä¹…, å°±ä¼šé˜»å¡æ¸¸æˆè¿›ç¨‹, äºæ˜¯æˆ‘ä»¬å¸Œæœ›å¼‚æ­¥åŠ è½½è¿™ä¸ªèµ„æº, æˆ‘ä»¬çš„åšæ³•å¯èƒ½æ˜¯å°†è°ƒç”¨<code>Resources.Load</code>æ¥å£æ”¹ä¸º<code>Resources.LoadAsync</code>æ¥å£. ç„¶åå°†èµ„æºåŠ è½½çš„æ–¹æ³•è¿”å›ç±»å‹æ”¹ä¸º<code>IEnumerator</code>, è°ƒç”¨<code>StartCoroutine</code>å¯åŠ¨è¿™ä¸ªåç¨‹, ä¸€æ°”å‘µæˆ. å¦‚æœä½ ä»æœªæƒ³è¿‡ä¸Šè¿°è¿™ä¸€åˆ‡Unityå’ŒC#ç¼–è¯‘å™¨åœ¨èƒŒåä¸ºæˆ‘ä»¬åšäº†ä»€ä¹ˆ, é‚£ä¹ˆä½ è‚¯å‘¢ä¸ªä¼šäº§ç”Ÿä¸‹é¢ä¸‰ä¸ªè¯¯è§£: ä¸€æ˜¯è¯¯ä»¥ä¸ºUnityä¸­æ‰€è¯´çš„åç¨‹å’Œæ“ä½œç³»ç»Ÿçº§åˆ«çš„åç¨‹æ˜¯ä¸€ä¸ªæ¦‚å¿µ; äºŒæ˜¯æŠŠå¼‚æ­¥å’Œåç¨‹ç”šè‡³çº¿ç¨‹æ¦‚å¿µæŒ‚é’©, è®¤ä¸ºè¦å®ç°å¼‚æ­¥å¿…é¡»ä¾èµ–åç¨‹æˆ–è€…çº¿ç¨‹. ä¸‰æ˜¯<code>yield return</code>å…³é”®å­—çš„è¯¯è§£, è®¤ä¸ºåé¢åªèƒ½è·Ÿåç¨‹ã€<code>WaitForSeconds</code>.</p><h1>æ‹¨ä¹±åæ­£</h1><p>Unityä¸­çš„åç¨‹ï¼ˆCoroutinesï¼‰å¹¶ä¸æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„â€œçœŸåç¨‹â€ï¼Œè€Œæ˜¯<strong>åŸºäºC#è¿­ä»£å™¨ï¼ˆIEnumeratorï¼‰å’ŒUnityå¼•æ“çš„å¸§è°ƒåº¦æœºåˆ¶å®ç°çš„ä¸€ç§åç¨‹æ¨¡æ‹Ÿ</strong>. åœ¨æ¸¸æˆå¼€å‘çš„å®¢æˆ·ç«¯é¢†åŸŸ, æˆ‘ä»¬åœ¨æ—¥å¸¸å¼€å‘ä¸­å‡ ä¹ä¸ä¼šæ¶‰åŠåˆ°çœŸçš„å¤šçº¿ç¨‹(Unityçš„Dotså½“ç„¶è¿˜æ˜¯ç”¨åˆ°å¤šçº¿ç¨‹çš„äº†, ä½†Dotsä¸åœ¨æœ¬ç¯‡åšå®¢çš„è®¨è®ºèŒƒå›´å†…).</p><p>é¦–å…ˆæƒ³ä¸€ä¸‹, ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å¼‚æ­¥å‘¢? ç¬”è€…è®¤ä¸º, ä½¿ç”¨å¼‚æ­¥çš„åŸå› , æ˜¯å› ä¸ºæˆ‘ä»¬ä¸æƒ³è®©æŸäº›æ“ä½œé˜»å¡æ•´ä¸ªæµç¨‹. äºæ˜¯ç¬”è€…ç®€å•æ€»ç»“äº†ä¸€ä¸‹æˆ‘ä»¬åœ¨å®¢æˆ·ç«¯å¼€å‘ä¸­ä¼šä½¿ç”¨çš„å¼‚æ­¥æ“ä½œåœºæ™¯:</p><ul><li>ç­‰å¾…ä¸€æ®µæ—¶é—´åå°½å¿ƒæŸç§æ“ä½œ: æ‰“å¼€ä¸€ä¸ªé¡µé¢ã€æ’­æ”¾ä¸€ä¸ªåŠ¨æ•ˆç­‰ç­‰</li><li>å¼‚æ­¥åŠ è½½èµ„æº</li><li>å¼‚æ­¥ç­‰å¾…ç½‘ç»œ</li></ul><p>ä½ ä¼šå‘ç°, ä¸Šè¿°è¿™äº›å¼‚æ­¥åœºæ™¯ä¸­, CPUå¥½åƒéƒ½ä¸éœ€è¦åšä»€ä¹ˆäº‹æƒ…, æ¯”å¦‚åŠ è½½èµ„æºåªæ˜¯ä¸€ä¸ªIOæ“ä½œ, å¦‚æœåŒæ­¥åŠ è½½èµ„æº, åœ¨èµ„æºåŠ è½½ä¸Šæ¥ä¹‹å‰, CPUå°±åªèƒ½å¹²ç­‰ç€, é˜»å¡æ¸¸æˆè¿›ç¨‹. ä½¿ç”¨å¼‚æ­¥åŠ è½½çš„æ–¹å¼, CPUæƒ³IOå‘å‡ºåŠ è½½æŒ‡ä»¤ä¹‹å, å°±å¯ä»¥å»æ‰§è¡Œåˆ«çš„æ“ä½œäº†. ç½‘ç»œè¯·æ±‚ä¹Ÿæ˜¯åŒç†. ä¸Šè¿°å¼‚æ­¥æ“ä½œéƒ½æ˜¯éCPUå¯†é›†å‹çš„æ“ä½œ.</p><p>è€Œè¿˜æœ‰ä¸€äº›æ˜¯éœ€è¦CPUæ‰§è¡Œå¾ˆç¹é‡çš„ä»»åŠ¡è€Œäº§ç”Ÿçš„å¼‚æ­¥åœºæ™¯, æ¯”å¦‚æ¶‰åŠåˆ°å¤§é‡é€»è¾‘è¿ç®—çš„, CPUæ‰§è¡Œè¿™äº›é€»è¾‘è¦è€—è´¹å¤§é‡çš„æ—¶é—´, è¿™ä¾¿æ˜¯CPUå¯†é›†å‹çš„æ“ä½œ. è¿™æ—¶æˆ‘ä»¬ä¼šé€‰æ‹©åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹, åœ¨æ–°çš„çº¿ç¨‹ä¸Šæ‰§è¡Œè¿™æ®µé€»è¾‘, ä»è€Œä¸ä¼šé˜»å¡åŸæ¥çš„çº¿ç¨‹. å› ä¸ºCPUæœ‰å¤šä¸ªæ ¸å˜›, æˆ‘ä»¬å¯ä»¥ç®€å•çš„ç†è§£ä¸ºä¸€ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªCPUçš„ä¸€ä¸ªæ ¸å¿ƒ(è¿™æ˜¯ååˆ†ä¸ä¸¥è°¨çš„, å› ä¸ºçº¿ç¨‹å¹¶ä¸æ˜¯ä¸€ä¸ªçº¯ç‰©ç†çš„æ¦‚å¿µ, æ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿæ¦‚å¿µ, ä½†åœ¨è¿™é‡Œåªæ˜¯ä¸ºäº†å¸®åŠ©ç†è§£), å¼€è¾Ÿæ–°çš„çº¿ç¨‹èƒ½è®©æˆ‘ä»¬åœ¨<strong>åŒä¸€æ—¶åˆ»</strong>åˆ©ç”¨CPUä¸­çš„å¤šä¸ªæ ¸å¿ƒ. åªæ˜¯æ¸¸æˆå¼€å‘çš„å®¢æˆ·ç«¯ä¸­å¾ˆå°‘ä¼šæœ‰CPUå¯†é›†å‹çš„æ“ä½œ(æ¸¸æˆç•Œçš„ç¬‘è¯: ä¸€æ ¸æœ‰éš¾, å…«æ ¸å›´è§‚), è¿™æ˜¯Unity3Då‰ç«¯ç¨‹åºå‘˜ç”±äºå¼€å‘åœºæ™¯çš„åŸå› è€Œå¯¹å¼‚æ­¥å’Œåç¨‹çº¿ç¨‹æ¦‚å¿µäº§ç”Ÿè¯¯è§£çš„åŸå› .<br>å› æ­¤å¼‚æ­¥æ˜¯å¼‚æ­¥, å¤šçº¿ç¨‹æ˜¯å¤šçº¿ç¨‹, ä¸€èˆ¬æ¥è¯´, åªæœ‰å¼‚æ­¥åœºæ™¯ä¸ºCPUå¯†é›†å‹æ“ä½œæ—¶, å¼‚æ­¥æ“ä½œæ‰æœ‰å¯èƒ½æ¶‰åŠåˆ°å¤šçº¿ç¨‹, æ¶‰åŠåˆ°å¤šçº¿ç¨‹çš„æ“ä½œæˆ‘ä»¬å°±ä¼šä½¿ç”¨<code>await</code>å…³é”®å­—è€Œä¸ä¼šç”¨<code>yield return</code>çš„ä¼ªåç¨‹äº†.</p><p>æ‰€ä»¥å¦„å›¾ä½¿ç”¨Unityåç¨‹æ¥åšä¸€äº›CPUå¯†é›†å‹çš„å·¥ä½œæ˜¯æ ¹æœ¬ä¸å¯èƒ½çš„, å› ä¸ºåç¨‹æœ¬è´¨ä¸Šè¿˜æ˜¯è¿è¡Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸Š, Unityåç¨‹åªé€‚åˆé‚£äº›I/Oå¯†é›†å‹çš„æ“ä½œ, å› ä¸ºè¿™ç±»æ“ä½œå¹¶ä¸çœŸçš„ä¼šå ç”¨CPUçš„æ‰§è¡Œæ—¶é—´, è¿™æ®µæ—¶é—´çš„CPUèƒ½å¤Ÿå»åšåˆ«çš„äº‹æƒ….</p><h1>æ­å¼€<code>yield return</code>çš„é¢çº±</h1><p>æœ‰ä¸‹é¢çš„ä»£ç :</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">C</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">M</span>()</span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> IEnumerator <span class="title">A</span>()</span>&#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;SaySomething&quot;</span>);</span><br><span class="line">        <span class="function"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title">BClass</span>(<span class="params"><span class="number">0</span></span>)</span>; </span><br><span class="line">        Console.WriteLine(<span class="string">&quot;SaySomething&quot;</span>);</span><br><span class="line">        <span class="function"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title">BClass</span>(<span class="params"><span class="number">1</span></span>)</span>;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;SaySomething&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BClass</span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">BClass</span>(<span class="params"><span class="built_in">int</span> idx</span>)</span>&#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç¬”è€…å‘ç°<a href="https://sharplab.io/">SharpLab</a>ä¹‹å‰, <code>yield return</code>ä¸€ç›´å¾ˆç¥ç§˜, åœ¨<code>SharpLab</code>ä¸­å¤„ç†ä¹‹å, <code>yield return</code>çš„ç¥ç§˜é¢çº±è¢«è½»æ˜“æ­å¼€:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"><span class="keyword">using</span> System.Reflection;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.CompilerServices;</span><br><span class="line"><span class="keyword">using</span> System.Security;</span><br><span class="line"><span class="keyword">using</span> System.Security.Permissions;</span><br><span class="line"></span><br><span class="line">[<span class="meta">assembly: CompilationRelaxations(8)</span>]</span><br><span class="line">[<span class="meta">assembly: RuntimeCompatibility(WrapNonExceptionThrows = true)</span>]</span><br><span class="line">[<span class="meta">assembly: Debuggable(DebuggableAttribute.DebuggingModes.Default | DebuggableAttribute.DebuggingModes.IgnoreSymbolStoreSequencePoints | DebuggableAttribute.DebuggingModes.EnableEditAndContinue | DebuggableAttribute.DebuggingModes.DisableOptimizations)</span>]</span><br><span class="line">[<span class="meta">assembly: SecurityPermission(SecurityAction.RequestMinimum, SkipVerification = true)</span>]</span><br><span class="line">[<span class="meta">assembly: AssemblyVersion(<span class="string">&quot;0.0.0.0&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">module: UnverifiableCode</span>]</span><br><span class="line">[<span class="meta">module: RefSafetyRules(11)</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">C</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BClass</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">BClass</span>(<span class="params"><span class="built_in">int</span> idx</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    [<span class="meta">CompilerGenerated</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">sealed</span> <span class="keyword">class</span> &lt;<span class="title">A</span>&gt;<span class="title">d__1</span> : <span class="title">IEnumerator</span>&lt;<span class="title">object</span>&gt;, <span class="title">IEnumerator</span>, <span class="title">IDisposable</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">int</span> &lt;&gt;<span class="number">1</span>__state;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">object</span> &lt;&gt;<span class="number">2</span>__current;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> C &lt;&gt;<span class="number">4</span>__this;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">object</span> IEnumerator&lt;<span class="built_in">object</span>&gt;.Current</span><br><span class="line">        &#123;</span><br><span class="line">            [<span class="meta">DebuggerHidden</span>]</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> &lt;&gt;<span class="number">2</span>__current;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">object</span> IEnumerator.Current</span><br><span class="line">        &#123;</span><br><span class="line">            [<span class="meta">DebuggerHidden</span>]</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> &lt;&gt;<span class="number">2</span>__current;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DebuggerHidden</span>]</span><br><span class="line">        <span class="keyword">public</span> &lt;A&gt;d__1(<span class="built_in">int</span> &lt;&gt;<span class="number">1</span>__state)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>.&lt;&gt;<span class="number">1</span>__state = &lt;&gt;<span class="number">1</span>__state;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DebuggerHidden</span>]</span><br><span class="line">        <span class="keyword">void</span> IDisposable.Dispose()</span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">MoveNext</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">switch</span> (&lt;&gt;<span class="number">1</span>__state)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="literal">default</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                    &lt;&gt;<span class="number">1</span>__state = <span class="number">-1</span>;</span><br><span class="line">                    Console.WriteLine(<span class="string">&quot;SaySomething&quot;</span>);</span><br><span class="line">                    &lt;&gt;<span class="number">2</span>__current = <span class="keyword">new</span> BClass(<span class="number">0</span>);</span><br><span class="line">                    &lt;&gt;<span class="number">1</span>__state = <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    &lt;&gt;<span class="number">1</span>__state = <span class="number">-1</span>;</span><br><span class="line">                    Console.WriteLine(<span class="string">&quot;SaySomething&quot;</span>);</span><br><span class="line">                    &lt;&gt;<span class="number">2</span>__current = <span class="keyword">new</span> BClass(<span class="number">1</span>);</span><br><span class="line">                    &lt;&gt;<span class="number">1</span>__state = <span class="number">2</span>;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    &lt;&gt;<span class="number">1</span>__state = <span class="number">-1</span>;</span><br><span class="line">                    Console.WriteLine(<span class="string">&quot;SaySomething&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">bool</span> IEnumerator.MoveNext()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//ILSpy generated this explicit interface implementation from .override directive in MoveNext</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.MoveNext();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">DebuggerHidden</span>]</span><br><span class="line">        <span class="keyword">void</span> IEnumerator.Reset()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NotSupportedException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">M</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">NullableContext(1)</span>]</span><br><span class="line">    [<span class="meta">IteratorStateMachine(typeof(&lt;A&gt;d__1))</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> IEnumerator <span class="title">A</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        &lt;A&gt;d__1 &lt;A&gt;d__ = <span class="keyword">new</span> &lt;A&gt;d__1(<span class="number">0</span>);</span><br><span class="line">        &lt;A&gt;d__.&lt;&gt;<span class="number">4</span>__this = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">return</span> &lt;A&gt;d__;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹<code>yield return</code>å…³é”®å­—çš„ä½œç”¨: åŒ…å«æœ‰<code>yield return</code>çš„æ–¹æ³•ç»è¿‡ç¼–è¾‘å™¨å¤„ç†ä¹‹åå˜æˆäº†ä¸€ä¸ªå®ç°äº†<code>IEnumerator</code>æ¥å£çš„ç±», æˆ‘ä»¬çŸ¥é“<code>IEnumerator</code>æ˜¯ä¸€ä¸ªè¿­ä»£å™¨, è¿­ä»£å™¨çš„ä¸€ä¸ªä½œç”¨å°±æ˜¯è¿­ä»£æˆ–è€…å«éå†å…ƒç´ , <code>yield return</code>åè·Ÿç€çš„, ä¾¿æ˜¯è¿™ä¸ªè¿­ä»£å™¨ä¸­çš„ä¸€ä¸ªå…ƒç´ . <code>yield return</code>åªæ˜¯åœ¨çŠ¶æ€æœºé‡Œé¢ä¸€ä¸ªæ–°å¢ä¸€ä¸ªçŠ¶æ€, ç„¶ååœ¨è¿™ä¸ªçŠ¶æ€çš„åˆ†æ”¯ä¸­æ‰§è¡Œä»ä¸Šä¸€ä¸ª<code>yield return</code>(ä¸åŒ…å«), åˆ°è¿™ä¸€ä¸ª<code>yield return</code>(åŒ…å«)ä¹‹é—´çš„ä»£ç , å¹¶ä¸”è¿­ä»£å™¨ä¸­ä¼šå¤šä¸€ä¸ªå…ƒç´ . å¦å¤–, ä¸åªæ˜¯<code>WaitForSeconds</code>å’Œ<code>IEnumerator</code>å¯ä»¥è¢«<code>yield return</code>, ä»»ä½•æ•°æ®ç»“æ„éƒ½å¯ä»¥. æˆ‘ä»¬ç¼–å†™è¿”å›ç±»å‹æ˜¯<code>IEnumerator</code>çš„æ–¹æ³•æ—¶, å…¶å®æ˜¯åœ¨å€ŸåŠ©<code>yield return</code>æ„é€ ä¸€ä¸ªåŒ…å«æŸäº›å…ƒç´ çš„è¿­ä»£å™¨çš„è¿‡ç¨‹.<br>åªæ˜¯, ä¸æ˜¯éšä¾¿ä¸€ä¸ªç±»å‹è¢«<code>yield return</code>å°±å¯ä»¥å®ç°å¼‚æ­¥äº†, åªæœ‰Unity<strong>ç²¾å¿ƒè®¾è®¡è¿‡çš„ç±»å‹</strong>, æ­é…ä¸ŠUnity<code>MonoBehaviour</code>ä¸­çš„é©±åŠ¨é€»è¾‘, æ‰èƒ½å®ç°çœŸæ­£çš„å¼‚æ­¥æ“ä½œ.</p><p>è¦ä½¿ç”¨<code>IEnumerator</code>å®ç°å¼‚æ­¥, éœ€è¦MonoBehaviourå’Œç»§æ‰¿è‡ªUnityEngineå‘½åç©ºé—´ä¸‹<code>YieldInstruction</code>ç±»å‹çš„é…åˆ. ä½ è°ƒç”¨çš„æ‰€æœ‰çš„Unityæä¾›çš„å¼‚æ­¥æ“ä½œæ¥å£, å…¶è¿”å›å€¼çš„ç±»å‹éƒ½åŒ…å«åœ¨ä¸‹å›¾ä¸­:</p><p>æ¯”å¦‚<code>AssetBundle.LoadFromFileAsync()</code>, å…¶è¿”å›ç±»å‹æ˜¯ä¸€ä¸ª<code>AsyncOperation</code>, æˆ‘ä»¬ç¼–å†™å¦‚ä¸‹ä»£ç :</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> IEnumerator <span class="title">LoadAsync</span>(<span class="params"><span class="built_in">string</span> path</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// Logic Before</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">return</span> AssetBundle.LoadFromFileAsync(path);</span><br><span class="line">    <span class="comment">// Logic After</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨åœ¨èƒŒåå°±ä¼šæŠŠ<code>AssetBundle.LoadFromFileAsync(path)</code>è¿”å›çš„<code>AsyncOperation</code>å®ä¾‹åˆ—ä¸ºè¦è¿­ä»£çš„å…ƒç´ . é­”æ³•å°±å‘ç”Ÿåœ¨MonoBehaviouræ¯ä¸€å¸§Updateä¹‹åå¯¹è¿­ä»£å™¨çš„è¿­ä»£æ“ä½œä¸­, æœ‰å¯èƒ½ä¼šå…ˆåˆ¤æ–­è¿™ä¸ª<code>AsyncOperation</code>å…ƒç´ ä¸­çš„<code>isDone</code>å­—æ®µ, ç„¶åå†å†³å®šæ˜¯å¦è¦æ‰§è¡ŒMoveNextæ–¹æ³•, ä»¥ä¸‹æ˜¯ç¬”è€…çš„çŒœæµ‹<code>MonoBehaviour</code>ä¸­æ‰§è¡Œçš„ä¼ªä»£ç :</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">MyMonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;IEnumerator&gt; _coroutineLists = <span class="keyword">new</span> List&lt;IEnumerator&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Coroutine <span class="title">StartCoroutine</span>(<span class="params">IEnumerator coroutine</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æŸç§æ‰‹æ®µ å°†IEnumeratorè½¬æ¢æˆCoroutine</span></span><br><span class="line">        <span class="keyword">return</span> Coroutine;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™ä¸ªæ–¹æ³•åœ¨Updateä¸­è°ƒç”¨</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CoroutineUpdate</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> coroutine <span class="keyword">in</span> _coroutineLists)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (coroutine.Current <span class="keyword">is</span> AsyncOperation asyncOperation)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// é€šè¿‡AsyncOperationä¸­çš„isDoneåˆ¤æ–­å½“å‰çš„å¼‚æ­¥æ“ä½œæ˜¯å¦å®Œæˆ</span></span><br><span class="line">                <span class="comment">// åªæœ‰å®Œæˆäº†æ‰ä¼šè°ƒç”¨MoveNextæ–¹æ³•</span></span><br><span class="line">                <span class="keyword">if</span>(!asyncOperation.isDone)&#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (coroutine.MoveNext())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// å½“å‰åç¨‹è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæˆ</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">// å½“å‰åç¨‹æ‰§è¡Œå®Œæˆäº†</span></span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>ç°åœ¨ä½ çŸ¥é“ä¸ºä»€ä¹ˆè¯´Unityåç¨‹æ˜¯â€œä¼ªåç¨‹â€äº†å—</h1><ul><li>è¢«åŠ¨è°ƒåº¦ï¼šåç¨‹çš„æ¢å¤å®Œå…¨ç”±Unityå¼•æ“æ§åˆ¶ï¼Œè€Œéä¸»åŠ¨è®©å‡ºç»™å…¶ä»–åç¨‹ã€‚</li><li>å•çº¿ç¨‹é™åˆ¶ï¼šæ— æ³•åˆ©ç”¨å¤šæ ¸CPUå®ç°å¹¶è¡Œè®¡ç®—ï¼Œä»…é€‚ç”¨äºå¼‚æ­¥ç­‰å¾…æˆ–åˆ†å¸§å¤„ç†ã€‚</li><li>åŸºäºè¿­ä»£å™¨ï¼šåº•å±‚å®ç°æ˜¯çŠ¶æ€æœºï¼ˆIEnumeratorï¼‰ï¼Œè€ŒéçœŸæ­£çš„åç¨‹åŸè¯­ã€‚</li></ul><h1>Unityåç¨‹çš„å±€é™æ€§</h1><ul><li>ä¾èµ–ä¸»çº¿ç¨‹ï¼šæ‰€æœ‰åç¨‹ä»£ç åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œé•¿æ—¶é—´è¿è¡Œçš„æ“ä½œä¼šé˜»å¡æ¸²æŸ“å’Œé€»è¾‘æ›´æ–°ã€‚</li><li>æ— ç‹¬ç«‹æ ˆï¼šåç¨‹çš„â€œæš‚åœâ€çŠ¶æ€ç”±IEnumeratorä¿å­˜å±€éƒ¨å˜é‡ï¼Œè€Œéç‹¬ç«‹çš„æ‰§è¡Œæ ˆã€‚</li><li>æ— æ³•è·¨çº¿ç¨‹ï¼šæ— æ³•åœ¨åå°çº¿ç¨‹ä¸­å¯åŠ¨æˆ–æ¢å¤åç¨‹ã€‚</li></ul><h1>æ€»ç»“</h1><p>Unityä¸­ä½¿ç”¨è¿­ä»£å™¨æ¥å®ç°å¼‚æ­¥, åªæ˜¯è¿­ä»£å™¨è¯¸å¤šä½¿ç”¨åœºæ™¯çš„ä¸€ç§, <code>IEnumerator</code>å’Œ<code>IEnumerable</code>è¿˜æœ‰æ›´å¹¿é˜”çš„å¤©åœ°, åœ¨<a href="https://soincredible.github.io/posts/133a9667/">è¿™ç¯‡åšå®¢</a>ä¸­ä¼šè¯¦ç»†æ¢è®¨.</p><h1>å‡ ç§å¯ä»¥å®ç°å›¾ç‰‡é€æ˜åº¦æ¸å˜æ•ˆæœçš„æ–¹æ³•</h1><p>æ–¹æ³•ä¸€ï¼šä½¿ç”¨åç¨‹</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Net.Mime;</span><br><span class="line"><span class="keyword">using</span> Unity.Collections;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestCoroutine</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> Image testImg;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">float</span> colorAlpha = <span class="number">1f</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        StartCoroutine(Test());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">IEnumerator <span class="title">Test</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span> (colorAlpha &gt;= <span class="number">0.0f</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            colorAlpha -= <span class="number">0.02f</span>;</span><br><span class="line">            testImg.GetComponent&lt;Image&gt;().color = <span class="keyword">new</span> Color(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, colorAlpha);</span><br><span class="line">            <span class="function"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title">WaitForSeconds</span>(<span class="params"><span class="number">0.05f</span></span>)</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•äºŒï¼šä½¿ç”¨<code>Time.deltatime</code></p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Net.Mime;</span><br><span class="line"><span class="keyword">using</span> Unity.Collections;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestCoroutine</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> Image testImg;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">float</span> colorAlpha = <span class="number">1f</span>;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (colorAlpha &gt;= <span class="number">0.0f</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            colorAlpha -= <span class="number">0.1f</span> * Time.deltaTime;</span><br><span class="line">            testImg.GetComponent&lt;Image&gt;().color = <span class="keyword">new</span> Color(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, colorAlpha);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ä¸ªä¾‹å­æˆ‘æœ‰ç‚¹ç†è§£Time.deltatimeçš„å«ä¹‰äº†ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨<code>colorAlpha -= 0.1f * Time.deltaTime;</code>å¤„ä½¿ç”¨äº†Time.deltatimeï¼Œå®ƒçš„ä½œç”¨æ˜¯ä½¿å¾—<code>colorAlpha</code>å˜é‡æ¯ä¸€ç§’å‡0.1fï¼Œå¦‚æœä½¿ç”¨æ‰“æ–­ç‚¹çš„æ–¹å¼å»åˆ†æ­¥è°ƒè¯•ï¼Œæ¯æ¬¡Updateçš„æ—¶å€™éƒ½ä¼šå»æ‰§è¡Œè¿™ä¸€è¡Œä»£ç ï¼Œç„¶åå¯ä»¥çœ‹åˆ°æ¯æ¬¡Updateå<code>colorAlpha</code>ä¼šæ¯æ¬¡å‡å°ä¸€ç‚¹ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´Time.deltaTimeæ˜¯ä¸€ä¸ªå¾ˆå°çš„æ•°ï¼Œå®ƒèƒ½å¤Ÿç¡®ä¿åœ¨1så†…å°†colorAlphaè¿™ä¸ªå˜é‡å‡å°‘0.1ï¼Œè€Œä¸”è¿™ä¸ªè¿‡ç¨‹æ˜¯è¿ç»­çš„ã€‚</p><p>ä½¿ç”¨åç¨‹çš„é‚£ä¸ªæ–¹å¼å‘¢ï¼Œå®ƒèƒ½å¤Ÿå®ç°åœ¨ä¸€æ®µæ—¶é—´é—´éš”å†…æ¸å˜çš„æ•ˆæœæ˜¯å› ä¸ºæœ‰<code>yield return new WaitForSeconds()</code>æ–¹æ³•å’Œwhileå¾ªç¯çš„å…±åŒé…åˆï¼Œè€Œä¸”å¦‚æœä½ WaitForSecondsæ–¹æ³•ä¸­çš„æ•°å¤ªå¤§çš„è¯ä¼šå¯¼è‡´å˜åŒ–çš„è¿‡ç¨‹éå¸¸çš„ç”Ÿç¡¬ï¼Œä¸å¤Ÿè¿è´¯ï¼Œä¹Ÿå°±æ˜¯è¯´å’ŒTime.deltatimeç›¸æ¯”ï¼Œä½¿ç”¨åç¨‹çš„æ–¹å¼å®ç°çš„æ¸å˜æ˜¾å¾—åƒæ˜¯éè¿ç»­å¼çš„æ¸å˜ï¼Œè€Œä¸”å†™æ³•ä¹Ÿä¸å¦‚Time.deltatimeæ–¹ä¾¿ï¼Œæ‰€ä»¥æˆ‘ä¸ªäººè®¤ä¸ºä½¿ç”¨Time.deltatimeçš„æ–¹æ³•å®ç°æ¸å˜æ•ˆæœä¼šæ›´å¥½ä¸€ç‚¹ã€‚</p><p>æˆ‘åœ¨ç½‘ä¸Šçœ‹åˆ°äº†è¿™æ ·çš„å†™æ³•ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Net.Mime;</span><br><span class="line"><span class="keyword">using</span> Unity.Collections;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestCoroutine</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> Image testImg;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">float</span> colorAlpha = <span class="number">1f</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        StartCoroutine(Test());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">IEnumerator <span class="title">Test</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span> (colorAlpha &gt;= <span class="number">0.0f</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            colorAlpha -= <span class="number">0.1f</span> * Time.deltaTime;</span><br><span class="line">            testImg.GetComponent&lt;Image&gt;().color = <span class="keyword">new</span> Color(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, colorAlpha);</span><br><span class="line">            <span class="keyword">yield</span> <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä¸ªäººæ„Ÿè§‰è¿™å’Œç›´æ¥å†™åœ¨Updateä¸­æ²¡æœ‰ä»»ä½•åŒºåˆ«å•Šï¼Œè¿™æ ·å†™éš¾é“æœ‰ä»€ä¹ˆåˆ«çš„å¥½å¤„ä¹ˆï¼ŸğŸ¥²ä¸è¿‡è¿™æ ·ç¡®å®ä¹Ÿè¾¾åˆ°äº†è¿ç»­æ¸å˜çš„æ•ˆæœã€‚</p><blockquote><p>2025.5.10æ›´æ–°<br>è¿™æ®µå®ç°æ–¹å¼ä»¥ç¬”è€…ç°åœ¨çš„æ°´å¹³æ¥çœ‹ç¡®å®æ˜¯è¦ä¼˜äºå‰ä¸¤è€…çš„. é¦–å…ˆWaitForSecondä¼šé€ æˆé¢å¤–å¼€é”€, è€Œåç¨‹ä¼šåœ¨æ¯ä¸€å¸§Updateä¹‹åã€LateUpdateä¹‹å‰æ‰§è¡Œ, ä½¿ç”¨<code>Time.deltaTime</code>æ˜¯åˆç†çš„. å…¶æ¬¡, åœ¨<code>Update()</code>æ–¹æ³•é‡Œé¢åšé¢œè‰²æ¸å˜æœ‰ç‚¹å¤§æå°ç”¨çš„æ„Ÿè§‰äº†. è¯´ä¸ä¸Šæ¥.</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> è½¯æŠ€èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C#é—®é¢˜æ‚è®°</title>
      <link href="/posts/34114324/"/>
      <url>/posts/34114324/</url>
      
        <content type="html"><![CDATA[<h1>ä½¿ç”¨C#åˆ›å»ºä¸€ä¸ªæ–‡ä»¶</h1><p>é‡åˆ° <code>System.IO.DirectoryNotFoundException</code> é”™è¯¯è¡¨æ˜å°è¯•è®¿é—®çš„ç›®å½•è·¯å¾„ä¸­çš„æŸéƒ¨åˆ†ä¸å­˜åœ¨ã€‚è¿™ä¸ªé—®é¢˜é€šå¸¸å‘ç”Ÿåœ¨å°è¯•åˆ›å»ºæ–‡ä»¶æˆ–ç›®å½•ã€è¯»å–æ–‡ä»¶ã€æˆ–è€…æ‰§è¡Œå…¶ä»–éœ€è¦è®¿é—®æ–‡ä»¶ç³»ç»Ÿçš„æ“ä½œæ—¶ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæœ‰å‡ ä¸ªå¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼š</p><h2 id="ç¡®è®¤è·¯å¾„çš„æ­£ç¡®æ€§">ç¡®è®¤è·¯å¾„çš„æ­£ç¡®æ€§</h2><p>é¦–å…ˆï¼Œç¡®è®¤ä½ å°è¯•è®¿é—®çš„è·¯å¾„æ˜¯æ­£ç¡®çš„ã€‚æ£€æŸ¥è·¯å¾„ä¸­çš„æ¯ä¸€éƒ¨åˆ†ï¼Œç¡®ä¿æ²¡æœ‰æ‹¼å†™é”™è¯¯æˆ–è€…è·¯å¾„é”™è¯¯ã€‚è·¯å¾„åº”è¯¥å®Œå…¨åŒ¹é…åˆ°ä½ æƒ³è¦è®¿é—®çš„ä½ç½®ã€‚</p><h2 id="ç¡®è®¤ç›®å½•ç»“æ„å­˜åœ¨">ç¡®è®¤ç›®å½•ç»“æ„å­˜åœ¨</h2><p>åœ¨å°è¯•åˆ›å»ºæ–‡ä»¶ä¹‹å‰ï¼Œç¡®ä¿æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ç»“æ„å·²ç»å­˜åœ¨ã€‚å¦‚æœç›®å½•ç»“æ„ä¸­çš„ä»»ä½•éƒ¨åˆ†ä¸å­˜åœ¨ï¼Œå°è¯•åˆ›å»ºæ–‡ä»¶æ—¶å°±ä¼šå¼•å‘ <code>DirectoryNotFoundException</code>ã€‚</p><h2 id="åˆ›å»ºç¼ºå¤±çš„ç›®å½•">åˆ›å»ºç¼ºå¤±çš„ç›®å½•</h2><p>å¦‚æœä½ çš„åº”ç”¨ç¨‹åºéœ€è¦åœ¨ç‰¹å®šçš„ç›®å½•ä¸­åˆ›å»ºæ–‡ä»¶ï¼Œä½†é‚£äº›ç›®å½•å¯èƒ½ä¸å­˜åœ¨ï¼Œä½ åº”è¯¥é¦–å…ˆæ£€æŸ¥è¿™äº›ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå®ƒä»¬ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç æ®µæ¥å®ç°è¿™ä¸€ç‚¹ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> directoryPath = <span class="string">@&quot;/Users/mac/Desktop/TetrisBlock/TetrisBlock-Unity/Assets/FontProcessLog/RedundantFontInfo&quot;</span>;</span><br><span class="line"><span class="built_in">string</span> filePath = Path.Combine(directoryPath, <span class="string">&quot;SFUIDisplay-Bold.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¡®ä¿ç›®å½•å­˜åœ¨</span></span><br><span class="line"><span class="keyword">if</span> (!Directory.Exists(directoryPath))</span><br><span class="line">&#123;</span><br><span class="line">    Directory.CreateDirectory(directoryPath);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç°åœ¨å¯ä»¥å®‰å…¨åœ°åˆ›å»ºæ–‡ä»¶äº†</span></span><br><span class="line">File.WriteAllText(filePath, <span class="string">&quot;Your content here&quot;</span>);</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç é¦–å…ˆæ£€æŸ¥ç›®æ ‡ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨ <code>Directory.CreateDirectory</code> æ–¹æ³•åˆ›å»ºå®ƒã€‚è¿™æ ·å¯ä»¥ç¡®ä¿åœ¨å°è¯•å†™å…¥æ–‡ä»¶ä¹‹å‰ï¼Œæ–‡ä»¶çš„ç›®æ ‡ç›®å½•å·²ç»å­˜åœ¨ï¼Œä»è€Œé¿å… <code>DirectoryNotFoundException</code>ã€‚</p><h2 id="ä½¿ç”¨ç»å¯¹è·¯å¾„è€Œéç›¸å¯¹è·¯å¾„">ä½¿ç”¨ç»å¯¹è·¯å¾„è€Œéç›¸å¯¹è·¯å¾„</h2><p>ç¡®ä¿ä½ ä½¿ç”¨çš„æ˜¯ç»å¯¹è·¯å¾„è€Œéç›¸å¯¹è·¯å¾„ï¼Œå› ä¸ºç›¸å¯¹è·¯å¾„å¯èƒ½ä¼šå› ä¸ºå½“å‰å·¥ä½œç›®å½•çš„ä¸åŒè€Œå¯¼è‡´è·¯å¾„è§£æé”™è¯¯ã€‚åœ¨ä½ çš„ä¾‹å­ä¸­ï¼Œä½ å·²ç»ä½¿ç”¨äº†ç»å¯¹è·¯å¾„ï¼Œè¿™æ˜¯ä¸€ä¸ªå¥½çš„åšæ³•ã€‚</p><h2 id="æ£€æŸ¥æƒé™é—®é¢˜">æ£€æŸ¥æƒé™é—®é¢˜</h2><p>ç¡®ä¿ä½ çš„åº”ç”¨ç¨‹åºæˆ–è€…ä½ çš„ç”¨æˆ·è´¦æˆ·æœ‰æƒé™è®¿é—®æŒ‡å®šçš„è·¯å¾„ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæƒé™é™åˆ¶å¯èƒ½ä¼šå¯¼è‡´æ— æ³•è®¿é—®è·¯å¾„ã€‚</p><h1>é‡å†™ã€é‡è½½ã€å¤šæ€çš„åŒºåˆ«</h1><p>é‡å†™ <code>override</code> é‡è½½ <code>overload</code> å¤šæ€<code>polymorphism</code></p><p>é‡å†™<code>override</code>æŒ‡çš„æ˜¯é‡å†™äº†ä¸€ä¸ªæ–¹æ³•æ¥å®ç°ä¸åŒçš„åŠŸèƒ½ï¼Œä¸€èˆ¬æ˜¯ç”¨äºå­ç±»åœ¨ç»§æ‰¿çˆ¶ç±»çš„æ—¶å€™åï¼Œé‡å†™çˆ¶ç±»ä¸­çš„æ–¹æ³•ï¼Œé‡å†™çš„è§„åˆ™ï¼š</p><ol><li>é‡å†™æ–¹æ³•çš„å‚æ•°åˆ—è¡¨å¿…é¡»å®Œå…¨ä¸è¢«é‡å†™æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ç›¸åŒï¼Œå¦åˆ™å°±ä¸èƒ½ç§°ä¹‹ä¸ºé‡å†™è€Œæ˜¯é‡è½½</li><li>é‡å†™æ–¹æ³•çš„è®¿é—®ä¿®é¥°ç¬¦ä¸€å®šè¦å¤§äºè¢«é‡å†™æ–¹æ³•çš„è®¿é—®ä¿®é¥°ç¬¦public &gt; protected &gt; default &gt; private</li><li>é‡å†™çš„æ–¹æ³•çš„è¿”å›å€¼å¿…é¡»å’Œè¢«é‡å†™æ–¹æ³•çš„è¿”å›å€¼ä¸€è‡´</li><li>é‡å†™çš„æ–¹æ³•æ‰€æŠ›å‡ºçš„å¼‚å¸¸å¿…é¡»å’Œè¢«é‡å†™æ–¹æ³•æ‰€æŠ›å‡ºçš„å¼‚å¸¸ä¸€è‡´ï¼Œæˆ–è€…æ˜¯å…¶å­ç±»</li><li>è¢«é‡å†™çš„æ–¹æ³•ä¸èƒ½æ˜¯privateï¼Œå¦åˆ™åœ¨å…¶å­ç±»ä¸­åªæ˜¯æ–°å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶æ²¡æœ‰å¯¹å…¶è¿›è¡Œé‡å†™</li><li>é™æ€æ–¹æ³•ä¸èƒ½è¢«é‡å†™ä¸ºéé™æ€æ–¹æ³•</li><li>é™æ€æ–¹æ³•å±äºç±»ï¼Œä¸èƒ½è¢«é‡å†™ï¼Œå› æ­¤ä¹Ÿä¸èƒ½å¤šæ€</li></ol><p>é‡è½½<code>overload</code>ä¸€èˆ¬ç”¨äºåœ¨ä¸€ä¸ªç±»å†…å®ç°è‹¥å¹²é‡è½½çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•çš„åç§°ç›¸åŒè€Œå‚æ•°å½¢å¼ä¸åŒ</p><p>é‡è½½çš„è§„åˆ™ï¼š</p><ol><li>åœ¨ä½¿ç”¨é‡è½½æ—¶åªèƒ½é€šè¿‡ç›¸åŒçš„æ–¹æ³•åã€ä¸åŒçš„å‚æ•°å½¢å¼å®ç°ã€‚å¯ä»¥æ˜¯ä¸åŒçš„å‚æ•°ä¸ªæ•°ï¼Œä¸åŒçš„å‚æ•°é¡ºåºï¼ˆå‚æ•°ç±»å‹å¿…é¡»ä¸ä¸€æ ·ï¼‰</li><li>ä¸èƒ½é€šè¿‡è®¿é—®æƒé™ã€è¿”å›ç±»å‹ã€æŠ›å‡ºçš„å¼‚å¸¸è¿›è¡Œé‡è½½</li><li>æ–¹æ³•çš„å¼‚å¸¸ç±»å‹å’Œæ•°ç›®ä¸ä¼šå¯¹é‡è½½é€ æˆå½±å“</li></ol><p>å¤šæ€<code>polymorphism</code>å¯ä»¥æ˜¯é™æ€çš„æˆ–åŠ¨æ€çš„ï¼Œåœ¨é™æ€å¤šæ€æ€§ä¸­ï¼Œå‡½æ•°çš„å“åº”æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™å‘ç”Ÿçš„ã€‚åœ¨åŠ¨æ€å¤šæ€æ€§ä¸­ï¼Œå‡½æ•°çš„å“åº”æ˜¯åœ¨è¿è¡Œæ—¶å‘ç”Ÿçš„ã€‚</p><p>é™æ€å¤šæ€ï¼šåœ¨ç¼–è¯‘é˜¶æ®µï¼Œå‡½æ•°å’Œå¯¹è±¡çš„è¿æ¥æœºåˆ¶è¢«ç§°ä¸ºæ—©èµ·ç»‘å®šï¼Œä¹Ÿè¢«ç§°ä¸ºé™æ€ç»‘å®šã€‚C#æä¾›äº†ä¸¤ç§æŠ€æœ¯æ¥å®ç°é™æ€å¤šæ€æ€§ï¼šå‡½æ•°é‡è½½å’Œ<a href="#2">è¿ç®—ç¬¦é‡è½½</a></p><p>åŠ¨æ€å¤šæ€çš„ä¸‰ä¸ªæ¡ä»¶ï¼š</p><ol><li>ç»§æ‰¿</li><li>é‡å†™ï¼ˆé‡å†™çˆ¶ç±»ç»§æ‰¿çš„æ–¹æ³•ï¼‰</li><li>çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»çš„å¯¹è±¡ï¼ˆè¿™ä¸ªåœ¨<a href="http://soincredible777.com.cn/posts/133a9667/">IEnumeratorå’ŒIEnumerableçš„ç†è§£ä¸è¾¨æ</a>è¿™ç¯‡åšå®¢æœ«å°¾æåˆ°äº†ï¼Œå½“æ—¶è¿˜ä¸å¤ªæ˜ç¡®è¿™æ˜¯å®ç°å¤šæ€çš„ä¸€ä¸ªæ¡ä»¶ï¼‰ï¼Œè¯­å¥åœ¨å †å†…å­˜ä¸­å¼€è¾Ÿäº†å­ç±»çš„å¯¹è±¡ï¼Œå¹¶æŠŠæ ˆå†…å­˜ä¸­çš„çˆ¶ç±»çš„å¼•ç”¨æŒ‡å‘äº†è¿™ä¸ªå­ç±»çš„å¯¹è±¡</li></ol><h2 id="å‡½æ•°é‡è½½å®ä¾‹">å‡½æ•°é‡è½½å®ä¾‹</h2><p>æˆ‘ä»¬å¯ä»¥åœ¨åŒä¸€ä¸ªèŒƒå›´å†…å¯¹ç›¸åŒçš„å‡½æ•°åæœ‰å¤šä¸ªå®šä¹‰ï¼Œå‡½æ•°çš„å®šä¹‰å¿…é¡»å½¼æ­¤ä¸åŒï¼Œå¯ä»¥æ˜¯å‚æ•°åˆ—è¡¨ä¸­çš„å‚æ•°ç±»å‹ä¸åŒï¼Œä¹Ÿå¯ä»¥æ˜¯å‚æ•°ä¸ªæ•°ä¸åŒã€‚<strong>ä¸èƒ½é‡è½½åªæœ‰è¿”å›ç±»å‹ä¸åŒçš„å‡½æ•°å£°æ˜</strong></p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">LearnOverload</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Overload</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">Add</span>(<span class="params"><span class="built_in">int</span> a, <span class="built_in">int</span> b, <span class="built_in">int</span> c</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> a + b + c;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">Add</span>(<span class="params"><span class="built_in">int</span> a, <span class="built_in">int</span> b</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> a + b;</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">float</span> <span class="title">Add</span>(<span class="params"><span class="built_in">float</span> a, <span class="built_in">float</span> b</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> a + b;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">int</span> a = <span class="number">1</span>;</span><br><span class="line">            <span class="built_in">int</span> b = <span class="number">1</span>;</span><br><span class="line">            <span class="built_in">int</span> c = <span class="number">1</span>;</span><br><span class="line">            Console.WriteLine(Overload.Add(a, b));</span><br><span class="line">            Console.WriteLine(Overload.Add(a, b, c));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŠ¨æ€å¤šæ€ï¼š">åŠ¨æ€å¤šæ€ï¼š</h2><p>C#å…è®¸æˆ‘ä»¬ä½¿ç”¨å…³é”®å­—<code>abstract</code>åˆ›å»ºæŠ½è±¡ç±»ï¼Œç”¨äºæä¾›æ¥å£éƒ¨åˆ†ç±»çš„å®ç°ã€‚å½“ä¸€ä¸ªæ´¾ç”Ÿç±»ç»§æ‰¿è‡ªè¯¥æŠ½è±¡ç±»æ—¶ï¼Œå®ç°å³å®Œæˆã€‚æŠ½è±¡ç±»åŒ…å«æŠ½è±¡æ–¹æ³•ï¼ŒæŠ½è±¡æ–¹æ³•å¯ä»¥è¢«æ´¾ç”Ÿç±»å®ç°ï¼Œæ´¾ç”Ÿç±»å…·æœ‰æ›´ä¸“ä¸šçš„åŠŸèƒ½ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨æŠ½è±¡ç±»çš„æ—¶å€™è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>æˆ‘ä»¬ä¸èƒ½åˆ›å»ºä¸€ä¸ªæŠ½è±¡ç±»çš„å®ä¾‹</li><li>æˆ‘ä»¬ä¸èƒ½åœ¨ä¸€ä¸ªæŠ½è±¡ç±»å¤–éƒ¨å£°æ˜ä¸€ä¸ªæŠ½è±¡æ–¹æ³•</li><li>é€šè¿‡åœ¨ç±»å®šä¹‰å‰é¢æ”¾ç½®å…³é”®å­—<code>sealed</code>ï¼Œå¯ä»¥å°†ç±»å£°æ˜ä¸ºå¯†å°ç±»ã€‚å½“ä¸€ä¸ªç±»è¢«å£°æ˜ä¸º<code>sealed</code>æ—¶ï¼Œå®ƒä¸èƒ½è¢«ç»§æ‰¿ã€‚æŠ½è±¡ç±»ä¸èƒ½è¢«å£°æ˜ä¸º<code>sealed</code></li></ul><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">PolymorhismApplication</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Shape</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="built_in">int</span> <span class="title">Area</span>()</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Rectangle</span> : <span class="title">Shape</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">int</span> _length;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">int</span> _width;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Rectangle</span>(<span class="params"><span class="built_in">int</span> a, <span class="built_in">int</span> b</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            _length = a;</span><br><span class="line">            _width = b;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Length</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">set</span> &#123; _length = <span class="keyword">value</span>; &#125;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> _length; &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Width</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">set</span> &#123; _width = <span class="keyword">value</span>; &#125;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> _width; &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> <span class="title">Area</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> _length * _width;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">RectangleTest</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Rectangle r = <span class="keyword">new</span> Rectangle(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">            Console.WriteLine(r.Area());</span><br><span class="line">            Console.ReadKey();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢ä½¿ç”¨äº†è™šæ–¹æ³•æ¥å®ç°å¤šæ€</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">PolymorhismApplication</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Shape</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="built_in">int</span>? Area()</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;æ‰§è¡Œäº†ç»˜åˆ¶å›¾å½¢çš„åŸºç±»&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Rectangle</span> : <span class="title">Shape</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">int</span> _length;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">int</span> _width;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Rectangle</span>(<span class="params"><span class="built_in">int</span> a, <span class="built_in">int</span> b</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            _length = a;</span><br><span class="line">            _width = b;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Length</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">set</span> &#123; _length = <span class="keyword">value</span>; &#125;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> _length; &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Width</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">set</span> &#123; _width = <span class="keyword">value</span>; &#125;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> _width; &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span>? Area()</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;æ‰§è¡Œç»˜åˆ¶çŸ©å½¢çš„å‡½æ•°&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> _length * _width;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Circle</span> : <span class="title">Shape</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">int</span> _radius;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Radius</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">set</span> &#123; _radius = <span class="keyword">value</span>; &#125;</span><br><span class="line">            <span class="keyword">get</span> &#123; <span class="keyword">return</span> _radius; &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Circle</span>(<span class="params"><span class="built_in">int</span> radius</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            _radius = radius;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span>? Area()</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;æ‰§è¡ŒCircleç±»çš„ç»˜åˆ¶å‡½æ•°&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">base</span>.Area();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Test</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> shapes = <span class="keyword">new</span> List&lt;Shape&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">new</span> Rectangle(<span class="number">2</span>, <span class="number">3</span>),</span><br><span class="line">                <span class="keyword">new</span> Circle(<span class="number">2</span>)</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> p <span class="keyword">in</span> shapes)</span><br><span class="line">            &#123;</span><br><span class="line">                p.Area();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Console.ReadKey();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è”æƒ³ï¼šåœ¨å†™æšä¸¾å™¨é‚£ä¸€ç¯‡åšå®¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬è‡ªå·±å†™æšä¸¾å™¨çš„ç›®çš„æ˜¯ä¸ºäº†æšä¸¾è‡ªå·±è‡ªå®šä¹‰çš„æ•°æ®ç±»å‹ï¼Œè€ŒC#ä¸­æ˜¯æœ‰Listè¿™ä¸ªæ•°æ®ç±»å‹çš„ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæˆ‘ä»¬è‡ªå®šä¹‰çš„æ•°æ®ç±»å‹æ”¾åœ¨Listé‡Œï¼Œä¸ä¹Ÿèƒ½å®ç°æšä¸¾çš„æ•ˆæœä¹ˆï¼Œé‚£æˆ‘ä»¬è‡ªå·±å†™æšä¸¾å™¨çš„æ„ä¹‰ä½•åœ¨å‘¢ï¼Ÿ</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">learnIEnumerator</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Person</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">set</span>; <span class="keyword">get</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Person</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Name = name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShowName</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(Name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> ll = <span class="keyword">new</span> List&lt;Person&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">new</span> Person(<span class="string">&quot;æç£Š&quot;</span>),</span><br><span class="line">                    <span class="keyword">new</span> Person(<span class="string">&quot;ç‹åˆš&quot;</span>),</span><br><span class="line">                    <span class="keyword">new</span> Person(<span class="string">&quot;å½¤å½¤&quot;</span>),</span><br><span class="line">                    <span class="keyword">new</span> Person(<span class="string">&quot;ä¸¹ä¸¹&quot;</span>),</span><br><span class="line">                &#125;</span><br><span class="line">                ;</span><br><span class="line">            <span class="keyword">foreach</span> (Person p <span class="keyword">in</span> ll)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(p.Name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="span-id-2-è¿ç®—ç¬¦é‡è½½-span"><span id = "2">è¿ç®—ç¬¦é‡è½½</span></h2><p>æˆ‘ä»¬å¯ä»¥é‡å®šä¹‰æˆ–è€…é‡è½½C#ä¸­å†…ç½®çš„è¿ç®—ç¬¦ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹çš„è¿ç®—ç¬¦ã€‚é‡è½½è¿ç®—ç¬¦å…·æœ‰ç‰¹æ®Šåç§°çš„å‡½æ•°ï¼Œæ˜¯é€šè¿‡å…³é”®å­—<code>operator</code>åè·Ÿè¿ç®—ç¬¦çš„ç¬¦å·æ¥å®šä¹‰çš„ã€‚äºå…¶ä»–å‡½æ•°ä¸€æ ·ï¼Œé‡è½½è¿ç®—ç¬¦è¿”å›ç±»å‹å’Œå‚æ•°åˆ—è¡¨ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">OverloadOperator</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Box</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">double</span> length;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">double</span> breadth;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">double</span> height;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">double</span> <span class="title">getVolume</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> length * breadth * height;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBreadth</span>(<span class="params"><span class="built_in">double</span> bre</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            breadth = bre;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLength</span>(<span class="params"><span class="built_in">double</span> len</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            length = len;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHeight</span>(<span class="params"><span class="built_in">double</span> hei</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            height = hei;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> Box <span class="keyword">operator</span> +(Box b, Box c)</span><br><span class="line">        &#123;</span><br><span class="line">            Box box = <span class="keyword">new</span> Box();</span><br><span class="line">            box.length = b.length + c.length;</span><br><span class="line">            box.breadth = b.breadth + c.breadth;</span><br><span class="line">            box.height = b.height + c.height;</span><br><span class="line">            <span class="keyword">return</span> box;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Tester</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Box Box1 = <span class="keyword">new</span> Box();</span><br><span class="line">            Box Box2 = <span class="keyword">new</span> Box();</span><br><span class="line">            Box Box3 = <span class="keyword">new</span> Box();</span><br><span class="line">            <span class="built_in">double</span> volume = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            Box1.setLength(<span class="number">6.0</span>);</span><br><span class="line">            Box1.setBreadth(<span class="number">7.0</span>);</span><br><span class="line">            Box1.setHeight(<span class="number">5.0</span>);</span><br><span class="line"></span><br><span class="line">            Box2.setLength(<span class="number">12.0</span>);</span><br><span class="line">            Box2.setBreadth(<span class="number">13.0</span>);</span><br><span class="line">            Box2.setHeight(<span class="number">10.0</span>);</span><br><span class="line"></span><br><span class="line">            volume = Box1.getVolume();</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Box1çš„ä½“ç§¯ï¼š&#123;0&#125;&quot;</span>, volume);</span><br><span class="line"></span><br><span class="line">            volume = Box2.getVolume();</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Box2çš„ä½“ç§¯ï¼š&#123;0&#125;&quot;</span>, volume);</span><br><span class="line"></span><br><span class="line">            Box3 = Box1 + Box2;</span><br><span class="line"></span><br><span class="line">            volume = Box3.getVolume();</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Box3çš„ä½“ç§¯ï¼š&#123;0&#125;&quot;</span>, volume);</span><br><span class="line">            Console.ReadKey();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç å®ç°çš„æ˜¯æˆ‘ä»¬è‡ªå·±å¯¹è‡ªå®šä¹‰ç±»Boxçš„åŠ æ³•è¿ç®—ç¬¦ï¼Œå®ƒæŠŠä¸¤ä¸ªBoxå¯¹è±¡çš„å±æ€§ç›¸åŠ ï¼Œå¹¶è¿”å›ç›¸åŠ åçš„Boxå¯¹è±¡ã€‚</p><h1>C#ä¸­outå’Œrefä¹‹é—´çš„åŒºåˆ«</h1><p>é¦–å…ˆä¸¤è€…éƒ½æ˜¯æŒ‰åœ°å€ä¼ é€’çš„ï¼Œä½¿ç”¨åéƒ½å°†æ”¹å˜åŸæ¥å‚æ•°çš„æ•°å€¼ã€‚</p><p>å…¶æ¬¡ï¼Œrefå¯ä»¥æŠŠå‚æ•°çš„æ•°å€¼ä¼ é€’è¿›å‡½æ•°ï¼Œä½†æ˜¯outæ˜¯è¦æŠŠå‚æ•°æ¸…ç©ºï¼Œæˆ‘ä»¬æ— æ³•æŠŠä¸€ä¸ªæ•°å€¼ä»outä¼ é€’è¿›å»ï¼Œoutè¿›å»åï¼Œå‚æ•°çš„æ•°å€¼ä¸ºç©ºï¼Œæˆ‘ä»¬å¿…é¡»åˆå§‹åŒ–ä¸€æ¬¡ã€‚</p><h1>C#ä¸­çš„paramså…³é”®å­—</h1><p>paramsæ˜¯C#å…³é”®å­—ï¼Œå¯å˜é•¿å‚æ•°ï¼Œæ˜¯åœ¨å£°æ˜æ–¹æ³•æ—¶å‚æ•°ç±»å‹æˆ–è€…å‚æ•°ä¸ªæ•°ä¸ç¡®å®šçš„æ—¶å€™ä½¿ç”¨çš„ã€‚</p><p>å…³äºparamså‚æ•°æ•°ç»„ï¼Œéœ€è¦æŒæ¡ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li>å‚æ•°æ•°ç»„å¿…é¡»æ˜¯ä¸€ç»´æ•°ç»„</li><li>ä¸å…è®¸å°†paramsä¿®é¥°ç¬¦ä¸refå’Œoutä¿®é¥°ç¬¦ç»„åˆèµ·æ¥ä½¿ç”¨</li><li>ä¸å‚æ•°æ•°ç»„å¯¹åº”çš„å®å‚å¯ä»¥æ˜¯åŒä¸€ç±»å‹çš„æ•°ç»„åï¼Œä¹Ÿå¯ä»¥æ˜¯ä»»æ„å¤šä¸ªä¸è¯¥æ•°ç»„å…ƒç´ å±äºåŒä¸€ç±»å‹çš„å˜é‡</li><li>å¦‚æœå®å‚æ˜¯æ•°ç»„æŒ‰å¼•ç”¨ä¼ é€’ï¼Œè‹¥å®å‚æ˜¯å˜é‡æˆ–è¡¨è¾¾å¼åˆ™æŒ‰å€¼ä¼ é€’</li><li>å½¢å¼ä¸ºï¼šæ–¹æ³•ä¿®é¥°ç¬¦ è¿”å›ç±»å‹ æ–¹æ³•å(params ç±»å‹[] å˜é‡å)</li><li>paramså‚æ•°å¿…é¡»æ˜¯å‚æ•°åˆ—è¡¨çš„æœ€åä¸€ä¸ªå‚æ•°</li></ol><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        UserParams(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">int</span>[] myarray = <span class="keyword">new</span> <span class="built_in">int</span>[<span class="number">3</span>] &#123; <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span> &#125;;</span><br><span class="line">        UserParams(myarray);</span><br><span class="line"></span><br><span class="line">        UserParams2(<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&quot;dasd&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">UserParams</span>(<span class="params"><span class="keyword">params</span> <span class="built_in">int</span>[] list</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; list.Length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(list[i]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Console.WriteLine();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">UserParams2</span>(<span class="params"><span class="keyword">params</span> <span class="built_in">object</span>[] list</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; list.Length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(list[i]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Console.WriteLine();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>ç»“æ„ä½“å’Œç±»çš„åŒºåˆ«</h1><ul><li><p>å…³äºç»“æ„ä½“ï¼ŒC#çš„ç»“æ„ä¸åŒäºä¼ ç»Ÿçš„Cæˆ–è€…C++ä¸­çš„ç»“æ„ï¼Œå®ƒçš„ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p><ul><li>ç»“æ„å¯ä»¥å¸¦æœ‰æ–¹æ³•ã€å­—æ®µã€ç´¢å¼•ã€å±æ€§ã€è¿ç®—ç¬¦æ–¹æ³•å’Œäº‹ä»¶</li><li>ç»“æ„å¯ä»¥è‡ªå®šä¹‰æ„é€ å‡½æ•°ï¼Œä½†æ˜¯ä¸èƒ½å®šä¹‰ææ„å‡½æ•°ã€‚è¦æ³¨æ„ï¼Œæˆ‘ä»¬ä¸èƒ½ä¸ºç»“æ„å®šä¹‰æ— å‚çš„æ„é€ å‡½æ•°ï¼Œæ— å‚çš„æ„é€ å‡½æ•°é»˜è®¤æ˜¯è‡ªåŠ¨å®šä¹‰çš„ï¼Œè€Œä¸”ä¸èƒ½è¢«æ”¹å˜</li><li>ä¸ç±»ä¸åŒï¼Œç»“æ„ä¸èƒ½ç»§æ‰¿å…¶ä»–çš„ç»“æ„æˆ–ç±»</li><li>ç»“æ„ä¸èƒ½ä½œä¸ºå…¶ä»–ç»“æ„æˆ–ç±»çš„åŸºç¡€ç»“æ„ï¼ˆä¸èƒ½è¢«ç»§æ‰¿ï¼‰</li><li>ç»“æ„å¯ä»¥å®ç°ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£</li><li>ç»“æ„æˆå‘˜ä¸èƒ½åˆ¶å®šä¸º<code>abstract</code>ã€<code>virtual</code>læˆ–è€…<code>protected</code></li><li>å½“æˆ‘ä»¬ä½¿ç”¨Newæ“ä½œæœåˆ›å»ºä¸€ä¸ªç»“æ„å¯¹è±¡çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨é€‚å½“çš„æ„é€ å‡½æ•°æ¥åˆ›å»ºç»“æ„ã€‚ä¸ç±»ä¸åŒï¼Œç»“æ„å¯ä»¥ä¸é€‚ç”¨Newæ“ä½œç¬¦å³å¯ä»¥è¢«å®ä¾‹åŒ–</li><li>å¦‚æœä¸ä½¿ç”¨Newæ“ä½œç¬¦ï¼Œæœ‰åœ¨æ‰€æœ‰çš„å­—æ®µéƒ½è¢«åˆå§‹åŒ–ä¹‹åï¼Œå­—ç¬¦æ‰è¢«èµ‹å€¼ï¼Œå¯¹è±¡æ‰è¢«å¼•ç”¨ã€‚</li></ul></li><li><p>ç±»å’Œç»“æ„çš„åŒºåˆ«</p><ul><li>ç±»æ˜¯å¼•ç”¨ç±»å‹ï¼Œç»“æ„æ˜¯å€¼ç±»å‹</li><li>ç»“æ„ä¸æ”¯æŒç»§æ‰¿</li><li>ç»“æ„ä¸èƒ½å£°æ˜é»˜è®¤çš„æ„é€ å‡½æ•°</li></ul></li></ul><h1>C#çš„ç±»ä¿®é¥°ç¬¦</h1><ul><li><p><code>public</code>ï¼šè®¿é—®ä¸å—é™åˆ¶çš„ï¼Œæ‰€æœ‰çš„æœ¬ç¨‹åºé›†ä»¥åŠå…¶ä»–çš„ç¨‹åºé›†é‡Œé¢çš„ç±»éƒ½èƒ½å¤Ÿè®¿é—®</p></li><li><p><code>internal</code>ï¼šæœ¬ç¨‹åºé›†å†…çš„ç±»å¯ä»¥è®¿é—®ï¼Œè¿™æ˜¯ç±»é»˜è®¤çš„ä¿®é¥°ç¬¦ï¼Œåœ¨ä¸€ä¸ªç¨‹åºé›†å†…ï¼Œpublicå’Œinternalçš„æƒé™æ˜¯ä¸€æ ·çš„</p></li><li><p><code>partial</code>ï¼šéƒ¨åˆ†ç±»ï¼Œå¯ä»¥å°†ä¸€ä¸ªç±»åˆ†æˆå‡ éƒ¨åˆ†å†™åœ¨ä¸åŒçš„æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆç¼–è¯‘æ—¶å°†åˆæˆä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”å„ä¸ªéƒ¨åˆ†ä¸èƒ½åˆ†æ•£åœ¨ä¸åŒçš„ç¨‹åºé›†ä¸­</p></li><li><p><code>abstract</code>ï¼šä¿®é¥°ç±»çš„æ—¶å€™è¡¨ç¤ºè¯¥ç±»ä¸ºæŠ½è±¡ç±»ï¼Œä¸èƒ½å¤Ÿåˆ›å»ºè¯¥ç±»çš„å®ä¾‹ã€‚ä¿®é¥°æ–¹æ³•çš„æ—¶å€™è¡¨ç¤ºè¯¥æ–¹æ³•éœ€è¦å­ç±»æ¥å®ç°ï¼Œå¦‚æœå­ç±»æ²¡æœ‰å®ç°è¯¥æ–¹æ³•é‚£ä¹ˆå­ç±»åŒæ ·æ˜¯æŠ½è±¡ç±»ï¼›å¹¶ä¸”å«æœ‰æŠ½è±¡æ–¹æ³•çš„ç±»ä¸€å®šæ˜¯æŠ½è±¡ç±»ã€‚</p></li><li><p><code>sealed</code>ï¼šä¿®é¥°ç±»è¡¨ç¤ºè¯¥ç±»ä¸èƒ½å¤Ÿè¢«ç»§æ‰¿</p></li><li><p><code>static</code>ï¼šä¿®é¥°ç±»æ—¶è¡¨ç¤ºè¯¥ç±»æ˜¯é™æ€ç±»ï¼Œä¸èƒ½å¤Ÿå®ä¾‹åŒ–è¯¥ç±»çš„å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»ä¹Ÿå°±ä¸èƒ½å¤Ÿå«æœ‰å¯¹è±¡æˆå‘˜ï¼Œå³è¯¥ç±»æ‰€æœ‰æˆå‘˜ä¸ºé™æ€ã€‚</p></li><li><p><code>new</code>ï¼šåªèƒ½ç”¨äºåµŒå¥—çš„ç±»ï¼Œè¡¨ç¤ºå¯¹ç»§æ‰¿çˆ¶ç±»åŒåç±»å‹çš„éšè—</p></li></ul><p><strong>C#ç±»ä¿®é¥°ç¬¦çš„æ€»ç»“</strong></p><ul><li>æŠ½è±¡ç±»å°±æ˜¯ä¸èƒ½ä½¿ç”¨newæ–¹æ³•è¿›è¡Œå®ä¾‹åŒ–çš„ç±»ï¼Œå³æ²¡æœ‰å…·ä½“å®ä¾‹å¯¹è±¡çš„ç±»ã€‚æŠ½è±¡ç±»æœ‰ç‚¹ç±»ä¼¼â€œæ¨¡æ¿â€çš„ä½œç”¨ï¼Œç›®çš„æ˜¯æ ¹æ®å…¶æ ¼å¼æ¥åˆ›å»ºå’Œä¿®æ”¹æ–°çš„ç±»ï¼Œå¯¹è±¡ä¸èƒ½ç”±æŠ½è±¡ç±»ç›´æ¥åˆ›å»ºï¼Œåªå¯ä»¥é€šè¿‡æŠ½è±¡ç±»æ´¾ç”Ÿå‡ºæ–°çš„å­ç±»ï¼Œå†ç”±å…¶å­ç±»æ¥åˆ›å»ºå¯¹è±¡ã€‚å½“ä¸€ä¸ªç±»è¢«å£°æ˜ä¸ºæŠ½è±¡ç±»æ—¶ï¼Œè¦åœ¨è¿™ä¸ªç±»å‰é¢åŠ ä¸Šä¿®é¥°ç¬¦abstract</li><li>åœ¨æŠ½è±¡ç±»ä¸­çš„æˆå‘˜æ–¹æ³•å¯ä»¥åŒ…æ‹¬<strong>ä¸€èˆ¬æ–¹æ³•</strong>å’Œ<strong>æŠ½è±¡æ–¹æ³•</strong>ï¼ŒæŠ½è±¡æ–¹æ³•å°±æ˜¯ä»¥abstractä¿®é¥°çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•åªå£°æ˜è¿”å›çš„æ•°æ®ç±»å‹ã€æ–¹æ³•åç§°å’Œæ‰€éœ€çš„å‚æ•°ï¼Œæ²¡æœ‰æ–¹æ³•ä½“ï¼Œä¹Ÿå°±æ˜¯è¯´å†²å‘æ–¹æ³•åªéœ€è¦å£°æ˜è€Œä¸éœ€è¦å®ç°ã€‚å½“ä¸€ä¸ªæ–¹æ³•ä¸ºæŠ½è±¡æ–¹æ³•æ—¶ï¼Œæ„å‘³ç€è¿™ä¸ªæ–¹æ³•å¿…é¡»è¢«å­ç±»çš„æ–¹æ³•æ‰€é‡å†™ï¼Œå¦åˆ™å…¶å­ç±»çš„è¯¥æ–¹æ³•ä»ç„¶æ˜¯abstractçš„ï¼Œè€Œè¿™ä¸ªå­ç±»ä¹Ÿå¿…é¡»æ˜¯æŠ½è±¡çš„ï¼Œå³å£°æ˜ä¸ºabstractï¼Œæƒ³è¦è°ƒç”¨<strong>æŠ½è±¡ç±»ä¸­çš„ä¸€èˆ¬æ–¹æ³•åªèƒ½é€šè¿‡å®šä¹‰ä¸€ä¸ªå­ç±»å¹¶å®ä¾‹åŒ–å®ƒä¹‹åæ‰èƒ½è°ƒç”¨</strong>ã€‚</li><li>æŠ½è±¡ç±»ä¸­ä¸ä¸€å®šåŒ…å«æŠ½è±¡æ–¹æ³•ï¼Œä½†æ˜¯åŒ…å«æŠ½è±¡æ–¹æ³•çš„ç±»ä¸€å®šè¦è¢«å£°æ˜ä¸ºæŠ½è±¡ç±»ã€‚æŠ½è±¡ç±»æœ¬èº«ä¸å…·å¤‡å®é™…çš„åŠŸèƒ½ï¼Œåªèƒ½ç”¨äºæ´¾ç”Ÿå…¶å­ç±»ã€‚æŠ½è±¡ç±»ä¸­å¯ä»¥åŒ…å«æ„é€ æ–¹æ³•ï¼Œä½†æ˜¯æ„é€ æ–¹æ³•ä¸èƒ½è¢«å£°æ˜ä¸ºæŠ½è±¡ã€‚</li><li>è°ƒç”¨æŠ½è±¡ç±»ä¸­çš„æ–¹æ³•ï¼ˆæŠ½è±¡æ–¹æ³•å’ŒéæŠ½è±¡æ–¹æ³•ï¼‰ï¼Œå¦‚æœæ–¹æ³•æ˜¯staticçš„ï¼Œç›´æ¥ä½¿ç”¨<code>æŠ½è±¡ç±».æ–¹æ³•</code>å°±å¯ä»¥äº†ï¼Œå¦‚æœæ˜¯éstaticçš„åˆ™å¿…é¡»ä¸€ä¸ªç»§æ‰¿çš„éæŠ½è±¡ç±»ï¼Œç„¶åç”¨è¿™ä¸ªéæŠ½è±¡ç±»çš„å®ä¾‹æ¥è°ƒç”¨æ–¹æ³•ã€‚</li><li>æŠ½è±¡ç±»å¯ä»¥å®ç°æ¥å£ï¼Œæ¥å£ä¸­çš„æ–¹æ³•ï¼Œåœ¨æŠ½è±¡ç±»ä¸­å¯ä»¥ä¸å®ç°ï¼Œå½“æœ‰å­ç±»ç»§æ‰¿æŠ½è±¡ç±»æ—¶ï¼Œå¹¶ä¸”å­ç±»ä¸æ˜¯æŠ½è±¡ç±»æ—¶ï¼Œå­ç±»éœ€è¦å°†æŠ½è±¡ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•å’Œæ¥å£ä¸­çš„æ–¹æ³•éƒ½å®ç°ã€‚</li><li>æŠ½è±¡ç±»ä¸èƒ½ç”¨finalæ¥ä¿®é¥°ï¼Œå³ä¸€ä¸ªç±»ä¸èƒ½æ—¢æ˜¯æœ€ç»ˆç±»åˆæ˜¯æŠ½è±¡ç±»ã€‚</li><li>abstractä¸èƒ½ä¸privateã€staticã€finalã€nativeå¹¶åˆ—ä¿®é¥°åŒä¸€ä¸ªæ–¹æ³•ã€‚</li></ul><p><strong>TIPSï¼šæŠ½è±¡æ–¹æ³•å’Œè™šæ–¹æ³•éƒ½å¯ä»¥ä¾›æ´¾ç”Ÿç±»é‡å†™ï¼Œå®ƒä»¬çš„åŒºåˆ«å¦‚ä¸‹</strong></p><ul><li>è™šæ–¹æ³•å¿…é¡»æœ‰å®ç°éƒ¨åˆ†ï¼Œå¹¶ä¸ºæ´¾ç”Ÿç±»æä¾›äº†è¦†ç›–æ–¹æ³•çš„é€‰é¡¹ï¼›æŠ½è±¡æ–¹æ³•æ²¡æœ‰æä¾›å®ç°éƒ¨åˆ†æŠ½è±¡æ–¹æ³•æ˜¯ä¸€ç§å¼ºåˆ¶æ´¾ç”Ÿç±»è¦†ç›–çš„æ–¹æ³•ï¼Œå¦åˆ™æ´¾ç”Ÿç±»å°†ä¸èƒ½è¢«å®ä¾‹åŒ–ã€‚</li><li>æŠ½è±¡æ–¹æ³•åªèƒ½åœ¨æŠ½è±¡ç±»ä¸­å£°æ˜ï¼ŒæŠ½è±¡æ–¹æ³•å¿…é¡»åœ¨æ´¾ç”Ÿç±»ä¸­é‡å†™ï¼Œè¿™ä¸€ç‚¹è·Ÿæ¥å£ç±»ä¼¼ï¼›è™šæ–¹æ³•ä¸æ˜¯ä¹Ÿä¸å¿…è¦é‡å†™ã€‚å¦‚æœç±»åŒ…å«æŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆè¯¥ç±»ä¹Ÿæ˜¯æŠ½è±¡çš„ï¼Œä¹Ÿå¿…é¡»å£°æ˜ä¸ºæŠ½è±¡çš„ã€‚</li><li>æŠ½è±¡æ–¹æ³•ä¸èƒ½å£°æ˜æ–¹æ³•å®ä½“ï¼Œè€Œè™šæ–¹æ³•å¯ä»¥ï¼›åŒ…å«æŠ½è±¡æ–¹æ³•çš„ç±»ä¸èƒ½å¤Ÿè¢«å®ä¾‹åŒ–ï¼Œè€ŒåŒ…å«è™šæ–¹æ³•çš„ç±»å¯ä»¥è¢«å®ä¾‹åŒ–ã€‚</li></ul><p>protectedã€privateã€protected internalåªèƒ½ç”¨äºåµŒå¥—çš„ç±»</p><p>ä¸ºä»€ä¹ˆè¦æœ‰åµŒå¥—ç±»ï¼Ÿ</p><p>åµŒå¥—ç±»ä¸»è¦ç”¨äºå½“è¯¥ç±»ä»…ä»…è¢«æ‰€åœ¨ç±»ä½¿ç”¨ï¼Œä¸éœ€è¦å¤–éƒ¨è¿›è¡Œæ˜¾å¼åœ°æ„é€ ï¼Œå¹¶ä¸”éœ€è¦å¯¹æ‰€åœ¨ç±»çš„æˆå‘˜è¿›è¡Œå¤§é‡è®¿é—®æ“ä½œçš„æƒ…å†µ</p><p>åµŒå¥—ç±»å‹çš„è®¿é—®ä¿®é¥°ç¬¦ä¸ºï¼špublicã€internalã€protectedã€privateå’Œprotected internal</p><h1>éšæœºæ•°</h1><p>éšæœºæ•°ç”Ÿæˆçš„åŸç†å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šä¼ªéšæœºæ•°ç”Ÿæˆï¼ˆPseudo-Random Number Generation, PRNGï¼‰å’ŒçœŸéšæœºæ•°ç”Ÿæˆï¼ˆTrue Random Number Generation, TRNGï¼‰ã€‚å¤§å¤šæ•°è®¡ç®—æœºç³»ç»Ÿä½¿ç”¨çš„æ˜¯ä¼ªéšæœºæ•°ç”Ÿæˆå™¨ï¼Œå› ä¸ºå®ƒä»¬æ•ˆç‡é«˜ä¸”æ˜“äºå®ç°ã€‚ä»¥ä¸‹æ˜¯éšæœºæ•°ç”Ÿæˆçš„åŸºæœ¬åŸç†å’Œæ–¹æ³•ã€‚</p><ol><li>ä¼ªéšæœºæ•°ç”Ÿæˆï¼ˆPRNGï¼‰<br>ä¼ªéšæœºæ•°ç”Ÿæˆå™¨æ˜¯ä¸€ç§ç®—æ³•ï¼Œå®ƒé€šè¿‡æ•°å­¦å…¬å¼æˆ–é¢„å®šä¹‰çš„è§„åˆ™ç”Ÿæˆä¸€ä¸ªçœ‹ä¼¼éšæœºçš„æ•°åˆ—ã€‚ä¼ªéšæœºæ•°ç”Ÿæˆå™¨å¹¶ä¸æ˜¯çœŸæ­£çš„éšæœºï¼Œå®ƒæ˜¯ç¡®å®šæ€§çš„ï¼Œå³åªè¦è¾“å…¥ç›¸åŒçš„åˆå§‹å€¼ï¼ˆç§å­ï¼‰ï¼Œå°±ä¼šç”Ÿæˆç›¸åŒçš„éšæœºæ•°åºåˆ—ã€‚</li></ol><p>1.1 åŸºæœ¬åŸç†<br>ä¼ªéšæœºæ•°ç”Ÿæˆå™¨é€šå¸¸åŸºäºä»¥ä¸‹å…¬å¼ï¼š</p><p>$$ X_{n + 1}  = (a â‹… X_{n} + c) \space mod \space m$$</p><p>å…¶ä¸­:</p><ul><li>$X_{n}$ å½“å‰éšæœºæ•°(ç§å­)</li><li>$X_{n+1}$ ä¸‹ä¸€ä¸ªéšæœºæ•°</li><li>a ä¹˜æ•°</li><li>c å¢é‡</li><li>m æ¨¡æ•°ï¼ˆModulusï¼‰ã€‚</li><li>åˆå§‹å€¼$X_{0}$ ç§å­</li></ul><p>è¿™ä¸ªå…¬å¼è¢«ç§°ä¸ºçº¿æ€§åŒä½™ç”Ÿæˆå™¨ï¼ˆLinear Congruential Generator, LCGï¼‰ï¼Œæ˜¯æœ€å¸¸è§çš„ä¼ªéšæœºæ•°ç”Ÿæˆç®—æ³•ä¹‹ä¸€ã€‚</p><h1>int?</h1><p><code>int?</code>è¡¨ç¤ºå¯ç©ºç±»å‹ï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„å€¼ç±»å‹ï¼Œå®ƒçš„å€¼å¯ä»¥ä¸ºnullï¼Œåœ¨å˜é‡è®¾åˆå€¼çš„æ—¶å€™ï¼Œç»™å˜é‡èµ‹å€¼ä¸ºnullï¼Œè€Œä¸æ˜¯0</p><p><code>int??</code>ç”¨äºåˆ¤æ–­å¹¶èµ‹å€¼ï¼Œå…ˆåˆ¤æ–­å½“å‰å˜é‡æ˜¯å¦ä¸ºnullï¼Œå¦‚æœæ˜¯å°±å¯ä»¥èµ‹ä¸€ä¸ªæ–°å€¼ï¼Œå¦åˆ™è·³è¿‡ã€‚æ³¨ï¼šè¿™æ˜¯ä¸€ä¸ªå³å€¼ï¼Œä¸æ˜¯ä¸€ä¸ªstatementã€‚</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">int</span>ï¼Ÿ a=<span class="literal">null</span>ï¼›</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">b</span>()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>.a ?? <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>public class ObjectPool<T> where T : IPoolObject, new() new()çš„å«ä¹‰æ˜¯ä»€ä¹ˆ?</h1><p>åœ¨ C# ä¸­ï¼Œ<code>where T : new()</code> æ˜¯ä¸€ä¸ª<strong>æ³›å‹çº¦æŸ</strong>ï¼Œå®ƒè¡¨ç¤ºæ³›å‹ç±»å‹å‚æ•° <code>T</code> å¿…é¡»å…·æœ‰ä¸€ä¸ª<strong>æ— å‚æ•°çš„å…¬å…±æ„é€ å‡½æ•°</strong>ã€‚è¿™æ„å‘³ç€ä½¿ç”¨ <code>new()</code> çº¦æŸçš„ç±»å‹ <code>T</code> å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p><ol><li><code>T</code> å¿…é¡»æ˜¯ä¸€ä¸ªéæŠ½è±¡ç±»ï¼ˆå³ä¸èƒ½æ˜¯æŠ½è±¡ç±»æˆ–æ¥å£ï¼‰ã€‚</li><li><code>T</code> å¿…é¡»æœ‰ä¸€ä¸ªæ— å‚æ•°çš„å…¬å…±æ„é€ å‡½æ•°ï¼ˆå³ <code>public T()</code>ï¼‰ã€‚</li></ol><p>åœ¨ä½ çš„ä¾‹å­ä¸­ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ObjectPool</span>&lt;<span class="title">T</span>&gt; <span class="keyword">where</span> <span class="title">T</span> : <span class="title">IPoolObject</span>, <span class="title">new</span>()</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç çš„å«ä¹‰æ˜¯ï¼š</p><ul><li><code>T</code> æ˜¯ä¸€ä¸ªæ³›å‹ç±»å‹å‚æ•°ã€‚</li><li><code>T</code> å¿…é¡»å®ç° <code>IPoolObject</code> æ¥å£ï¼ˆ<code>where T : IPoolObject</code>ï¼‰ã€‚</li><li><code>T</code> å¿…é¡»å…·æœ‰ä¸€ä¸ªæ— å‚æ•°çš„å…¬å…±æ„é€ å‡½æ•°ï¼ˆ<code>where T : new()</code>ï¼‰ã€‚</li></ul><hr><h3 id="new-çš„ä½œç”¨"><strong><code>new()</code> çš„ä½œç”¨</strong></h3><p>ä½¿ç”¨ <code>new()</code> çº¦æŸåï¼Œä»£ç ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>new T()</code> æ¥åˆ›å»ºç±»å‹ <code>T</code> çš„å®ä¾‹ã€‚å› ä¸ºç¼–è¯‘å™¨çŸ¥é“ <code>T</code> æ»¡è¶³æ— å‚æ•°æ„é€ å‡½æ•°çš„çº¦æŸï¼Œæ‰€ä»¥å¯ä»¥å®‰å…¨åœ°ç”Ÿæˆå®ä¾‹ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç ">ç¤ºä¾‹ä»£ç </h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IPoolObject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Reset</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ObjectPool</span>&lt;<span class="title">T</span>&gt; <span class="keyword">where</span> <span class="title">T</span> : <span class="title">IPoolObject</span>, <span class="title">new</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; pool = <span class="keyword">new</span> List&lt;T&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">GetObject</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (pool.Count &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            T obj = pool[<span class="number">0</span>];</span><br><span class="line">            pool.RemoveAt(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> obj;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// ä½¿ç”¨ new T() åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> T();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ReturnObject</span>(<span class="params">T obj</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        obj.Reset();</span><br><span class="line">        pool.Add(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyPoolObject</span> : <span class="title">IPoolObject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Reset</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Resetting object...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        ObjectPool&lt;MyPoolObject&gt; pool = <span class="keyword">new</span> ObjectPool&lt;MyPoolObject&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å¯¹è±¡</span></span><br><span class="line">        MyPoolObject obj = pool.GetObject();</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Object created&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿”å›å¯¹è±¡</span></span><br><span class="line">        pool.ReturnObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¾“å‡º">è¾“å‡º</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Object created</span><br><span class="line">Resetting object...</span><br></pre></td></tr></table></figure><h4 id="è§£é‡Š">è§£é‡Š</h4><ol><li><strong><code>new T()</code></strong>ï¼šåœ¨ <code>GetObject()</code> æ–¹æ³•ä¸­ï¼Œå½“æ± ä¸­æ²¡æœ‰å¯ç”¨å¯¹è±¡æ—¶ï¼Œç›´æ¥é€šè¿‡ <code>new T()</code> åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</li><li><strong><code>where T : new()</code></strong>ï¼šç¡®ä¿æ³›å‹ç±»å‹å‚æ•° <code>T</code> æœ‰ä¸€ä¸ªæ— å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œå› æ­¤ <code>new T()</code> æ˜¯åˆæ³•çš„ã€‚</li><li><strong><code>where T : IPoolObject</code></strong>ï¼šç¡®ä¿ <code>T</code> å®ç°äº† <code>IPoolObject</code> æ¥å£ï¼Œå› æ­¤å¯ä»¥è°ƒç”¨ <code>Reset()</code> æ–¹æ³•ã€‚</li></ol><hr><h3 id="ä¸ºä»€ä¹ˆéœ€è¦-new-çº¦æŸï¼Ÿ"><strong>ä¸ºä»€ä¹ˆéœ€è¦ <code>new()</code> çº¦æŸï¼Ÿ</strong></h3><p>åœ¨ C# ä¸­ï¼Œæ³›å‹ç±»å‹å‚æ•°æ˜¯æœªçŸ¥çš„ç±»å‹ï¼Œç¼–è¯‘å™¨æ— æ³•ç¡®å®šç±»å‹ <code>T</code> æ˜¯å¦å…·æœ‰æ„é€ å‡½æ•°ã€‚å¦‚æœä½ å°è¯•åœ¨æ²¡æœ‰ <code>new()</code> çº¦æŸçš„æƒ…å†µä¸‹ä½¿ç”¨ <code>new T()</code>ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚</p><h4 id="é”™è¯¯ç¤ºä¾‹">é”™è¯¯ç¤ºä¾‹</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ObjectPool</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">CreateObject</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ç¼–è¯‘é”™è¯¯ï¼šT å¿…é¡»å…·æœ‰æ— å‚æ•°æ„é€ å‡½æ•°</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> T();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é”™è¯¯ä¿¡æ¯">é”™è¯¯ä¿¡æ¯</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;new()&#x27; constraint must be used on type parameter &#x27;T&#x27; to create instances of the type.</span><br></pre></td></tr></table></figure><h4 id="è§£å†³æ–¹æ³•">è§£å†³æ–¹æ³•</h4><p>æ·»åŠ  <code>new()</code> çº¦æŸï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ObjectPool</span>&lt;<span class="title">T</span>&gt; <span class="keyword">where</span> <span class="title">T</span> : <span class="title">new</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">CreateObject</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> T();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="new-çš„é™åˆ¶"><strong><code>new()</code> çš„é™åˆ¶</strong></h3><p>è™½ç„¶ <code>new()</code> çº¦æŸå…è®¸ä½ ä½¿ç”¨ <code>new T()</code>ï¼Œä½†å®ƒæœ‰ä»¥ä¸‹é™åˆ¶ï¼š</p><ol><li><p><strong>åªèƒ½è°ƒç”¨æ— å‚æ•°çš„æ„é€ å‡½æ•°</strong>ï¼š</p><ul><li>å¦‚æœ <code>T</code> åªæœ‰å¸¦å‚æ•°çš„æ„é€ å‡½æ•°ï¼ˆä¾‹å¦‚ <code>T(int value)</code>ï¼‰ï¼Œåˆ™æ— æ³•ä½¿ç”¨ <code>new()</code> çº¦æŸã€‚</li><li>è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡å·¥å‚æ¨¡å¼æˆ–å§”æ‰˜æ¥åˆ›å»ºå¯¹è±¡ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ <code>new T()</code>ã€‚</li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ObjectPool</span>&lt;<span class="title">T</span>&gt; <span class="keyword">where</span> <span class="title">T</span> : <span class="title">IPoolObject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> Func&lt;T&gt; objectFactory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ObjectPool</span>(<span class="params">Func&lt;T&gt; factory</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        objectFactory = factory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">CreateObject</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> objectFactory();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ä¸èƒ½ç”¨äºæŠ½è±¡ç±»æˆ–æ¥å£</strong>ï¼š</p><ul><li><code>new()</code> çº¦æŸè¦æ±‚ç±»å‹ <code>T</code> æ˜¯å¯ä»¥å®ä¾‹åŒ–çš„ï¼ˆéæŠ½è±¡ç±»ï¼‰ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ç”¨äºæŠ½è±¡ç±»æˆ–æ¥å£ã€‚</li></ul></li></ol><hr><h3 id="æ€»ç»“"><strong>æ€»ç»“</strong></h3><ul><li><code>new()</code> æ˜¯ä¸€ä¸ªæ³›å‹çº¦æŸï¼Œè¡¨ç¤ºæ³›å‹ç±»å‹å‚æ•°å¿…é¡»å…·æœ‰ä¸€ä¸ªæ— å‚æ•°çš„å…¬å…±æ„é€ å‡½æ•°ã€‚</li><li>å®ƒå…è®¸åœ¨æ³›å‹ç±»æˆ–æ–¹æ³•ä¸­é€šè¿‡ <code>new T()</code> åˆ›å»ºå®ä¾‹ã€‚</li><li>å¸¸ç”¨äºéœ€è¦åŠ¨æ€åˆ›å»ºæ³›å‹ç±»å‹å®ä¾‹çš„åœºæ™¯ï¼Œæ¯”å¦‚å¯¹è±¡æ± ã€å·¥å‚æ¨¡å¼ç­‰ã€‚</li><li>ç»“åˆå…¶ä»–çº¦æŸï¼ˆå¦‚æ¥å£çº¦æŸ <code>where T : IPoolObject</code>ï¼‰ï¼Œå¯ä»¥æ›´çµæ´»åœ°å®šä¹‰æ³›å‹ç±»çš„è¡Œä¸ºã€‚</li></ul><h1>å›ºå®šé•¿åº¦å­—ç¬¦ä¸²</h1><p>å¦‚æœä½ å¸Œæœ› <code>_moveStrus[posY, posX].moveDir</code> çš„è¾“å‡ºæ˜¯ä¸€ä¸ªå›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥é€šè¿‡æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ–¹å¼æ¥å®ç°ã€‚<code>BrickMoveDir</code> æ˜¯ä¸€ä¸ªæšä¸¾å€¼ï¼Œé»˜è®¤ä¼šé€šè¿‡ <code>ToString()</code> è¾“å‡ºæšä¸¾çš„åç§°ã€‚å¦‚æœä½ å¸Œæœ›å°†å…¶è¾“å‡ºä¸ºå›ºå®šé•¿åº¦ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¤„ç†ï¼š</p><hr><h3 id="æ–¹æ³•-1ï¼šä½¿ç”¨å­—ç¬¦ä¸²æ ¼å¼åŒ–å¹¶å¡«å……ç©ºæ ¼"><strong>æ–¹æ³• 1ï¼šä½¿ç”¨å­—ç¬¦ä¸²æ ¼å¼åŒ–å¹¶å¡«å……ç©ºæ ¼</strong></h3><p>ä½ å¯ä»¥ç”¨ <code>String.Format</code> æˆ–æ’å€¼å­—ç¬¦ä¸²ï¼ˆC# 6.0 åŠä»¥ä¸Šæ”¯æŒï¼‰æ¥å¯¹å€¼è¿›è¡Œæ ¼å¼åŒ–ï¼Œå¹¶é€šè¿‡æŒ‡å®šå›ºå®šå®½åº¦å¡«å……ç©ºæ ¼ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç -2">ç¤ºä¾‹ä»£ç </h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sb.AppendFormat(<span class="string">&quot;&#123;0,-10&#125;&quot;</span>, _moveStrus[posY, posX].moveDir);</span><br></pre></td></tr></table></figure><ul><li><code>&#123;0,-10&#125;</code> è¡¨ç¤ºå°†ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼å·¦å¯¹é½ï¼Œå¹¶ç¡®ä¿å ç”¨ 10 ä¸ªå­—ç¬¦çš„å®½åº¦ã€‚å¦‚æœå€¼çš„é•¿åº¦ä¸è¶³ 10ï¼Œåˆ™å¡«å……ç©ºæ ¼ï¼›å¦‚æœå€¼çš„é•¿åº¦è¶…è¿‡ 10ï¼Œåˆ™ä¸ä¼šæˆªæ–­ã€‚</li></ul><p>æˆ–è€…ä½¿ç”¨å­—ç¬¦ä¸²æ’å€¼çš„æ–¹å¼ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sb.Append(<span class="string">$&quot;<span class="subst">&#123;_moveStrus[posY, posX].moveDir,<span class="number">-10</span>&#125;</span>&quot;</span>);</span><br></pre></td></tr></table></figure><hr><h3 id="æ–¹æ³•-2ï¼šé€šè¿‡-PadRight-æˆ–-PadLeft-å¡«å……"><strong>æ–¹æ³• 2ï¼šé€šè¿‡ <code>PadRight</code> æˆ– <code>PadLeft</code> å¡«å……</strong></h3><p>ä½ å¯ä»¥å°† <code>moveDir</code> è½¬æ¢ä¸ºå­—ç¬¦ä¸²åï¼Œä½¿ç”¨ <code>PadRight</code>ï¼ˆå·¦å¯¹é½ï¼‰æˆ– <code>PadLeft</code>ï¼ˆå³å¯¹é½ï¼‰æ¥å¡«å……åˆ°å›ºå®šé•¿åº¦ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç -3">ç¤ºä¾‹ä»£ç </h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sb.Append(_moveStrus[posY, posX].moveDir.ToString().PadRight(<span class="number">10</span>));</span><br></pre></td></tr></table></figure><ul><li><code>PadRight(10)</code> ä¼šå°†å­—ç¬¦ä¸²å¡«å……åˆ° 10 ä¸ªå­—ç¬¦å®½åº¦ï¼Œå³ä¾§è¡¥ç©ºæ ¼ã€‚</li><li>å¦‚æœéœ€è¦å³å¯¹é½ï¼Œå¯ä»¥ä½¿ç”¨ <code>PadLeft(10)</code>ã€‚</li></ul><hr><h3 id="æ–¹æ³•-3ï¼šåŠ ä¸Š-t-åˆ¶è¡¨ç¬¦"><strong>æ–¹æ³• 3ï¼šåŠ ä¸Š <code>\t</code> åˆ¶è¡¨ç¬¦</strong></h3><p>å¦‚æœä½ å¸Œæœ›ä½¿ç”¨åˆ¶è¡¨ç¬¦ï¼ˆ<code>\t</code>ï¼‰æ¥å¯¹é½åˆ—ï¼Œå¯ä»¥åœ¨æ¯ä¸ªå€¼åé¢è¿½åŠ ä¸€ä¸ª <code>\t</code>ã€‚ä¸è¿‡ï¼Œåˆ¶è¡¨ç¬¦çš„å®½åº¦åœ¨ä¸åŒç¯å¢ƒä¸‹å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼ˆé€šå¸¸ä¸º 4 æˆ– 8 ä¸ªå­—ç¬¦ï¼‰ï¼Œå› æ­¤ä¸æ¨èç”¨äºç²¾ç¡®å¯¹é½ã€‚</p><h4 id="ç¤ºä¾‹ä»£ç -4">ç¤ºä¾‹ä»£ç </h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sb.Append(_moveStrus[posY, posX].moveDir + <span class="string">&quot;\t&quot;</span>);</span><br></pre></td></tr></table></figure><hr><h3 id="æ–¹æ³•-4ï¼šå°†æšä¸¾å€¼è½¬æ¢ä¸ºæ•´æ•°å¹¶æ ¼å¼åŒ–"><strong>æ–¹æ³• 4ï¼šå°†æšä¸¾å€¼è½¬æ¢ä¸ºæ•´æ•°å¹¶æ ¼å¼åŒ–</strong></h3><p>å¦‚æœä½ å¸Œæœ›è¾“å‡ºçš„å€¼æ˜¯å›ºå®šå®½åº¦çš„æ•°å­—ï¼ˆè€Œä¸æ˜¯æšä¸¾åç§°ï¼‰ï¼Œå¯ä»¥å°† <code>BrickMoveDir</code> è½¬æ¢ä¸ºæ•´æ•°ï¼Œå†è¿›è¡Œæ ¼å¼åŒ–ã€‚ä¾‹å¦‚ï¼Œç¡®ä¿è¾“å‡ºå ç”¨ 4 ä¸ªå­—ç¬¦å®½åº¦ï¼š</p><h4 id="ç¤ºä¾‹ä»£ç -5">ç¤ºä¾‹ä»£ç </h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sb.AppendFormat(<span class="string">&quot;&#123;0,4&#125;&quot;</span>, (<span class="built_in">int</span>)_moveStrus[posY, posX].moveDir);</span><br></pre></td></tr></table></figure><ul><li><code>&#123;0,4&#125;</code> è¡¨ç¤ºå³å¯¹é½å¹¶å ç”¨ 4 ä¸ªå­—ç¬¦å®½åº¦ã€‚</li></ul><hr><h3 id="å®Œæ•´ç¤ºä¾‹"><strong>å®Œæ•´ç¤ºä¾‹</strong></h3><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•å°† <code>_moveStrus</code> çš„å†…å®¹æŒ‰å›ºå®šå®½åº¦è¾“å‡ºåˆ° <code>StringBuilder</code> ä¸­ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> posY = <span class="number">0</span>; posY &lt; <span class="number">8</span>; posY++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> posX = <span class="number">0</span>; posX &lt; <span class="number">8</span>; posX++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// å°† moveDir è¾“å‡ºä¸ºå›ºå®šå®½åº¦çš„å­—ç¬¦ä¸²ï¼ˆå·¦å¯¹é½ï¼Œå®½åº¦ 10ï¼‰</span></span><br><span class="line">        sb.Append(<span class="string">$&quot;<span class="subst">&#123;_moveStrus[posY, posX].moveDir,<span class="number">-10</span>&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    sb.AppendLine(); <span class="comment">// æ¢è¡Œ</span></span><br><span class="line">&#125;</span><br><span class="line">Console.WriteLine(sb.ToString());</span><br></pre></td></tr></table></figure><hr><h3 id="è¾“å‡ºç¤ºä¾‹"><strong>è¾“å‡ºç¤ºä¾‹</strong></h3><p>å‡è®¾ <code>_moveStrus[posY, posX].moveDir</code> çš„å€¼ä¸º <code>Up</code>ã€<code>Down</code>ã€<code>Left</code> ç­‰ï¼Œè¾“å‡ºå¯èƒ½å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Up        Down      Left      Right     None      None      None      None      </span><br><span class="line">None      None      None      None      None      None      None      None      </span><br><span class="line">...</span><br></pre></td></tr></table></figure><hr><h3 id="æ€»ç»“-2"><strong>æ€»ç»“</strong></h3><ul><li>å¦‚æœéœ€è¦å›ºå®šå®½åº¦çš„å­—ç¬¦è¾“å‡ºï¼Œæ¨èä½¿ç”¨ <strong>å­—ç¬¦ä¸²æ ¼å¼åŒ–</strong>ï¼ˆ<code>String.Format</code> æˆ–æ’å€¼å­—ç¬¦ä¸²ï¼‰æˆ– <strong>PadRight/PadLeft</strong>ã€‚</li><li>å¦‚æœéœ€è¦ä½¿ç”¨åˆ¶è¡¨ç¬¦ï¼ˆ<code>\t</code>ï¼‰ï¼Œè¯·æ³¨æ„å®ƒçš„å®½åº¦å¯èƒ½å› ç¯å¢ƒè€Œå¼‚ï¼Œä¸é€‚åˆç²¾ç¡®å¯¹é½ã€‚</li><li>å¦‚æœéœ€è¦è¾“å‡ºæ•°å­—è€Œéå­—ç¬¦ä¸²ï¼Œå¯ä»¥å°†æšä¸¾è½¬æ¢ä¸ºæ•´æ•°åæ ¼å¼åŒ–ã€‚</li></ul><h1>æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜</h1><p><a href="https://blog.csdn.net/weixin_42186870/article/details/106086671">https://blog.csdn.net/weixin_42186870/article/details/106086671</a></p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> expPlus = Mathf.FloorToInt((DoushenMgr.Instance.GetTasksExpPlus() - <span class="number">1.0f</span>) * <span class="number">100f</span>);</span><br></pre></td></tr></table></figure><h1>C#ä¸­çš„å€¼ç±»å‹</h1><p>foreachä¸å€¼ç±»å‹å¤©ç„¶ä¸ç›¸å®¹, å¦‚æœè¦éå†ä¸€ä¸ªå€¼ç±»å‹çš„é›†åˆ, é‚£ä¹ˆä½ åªèƒ½æ˜¯å»è®¿é—®è¿™äº›å€¼, è€Œä¸èƒ½å»æ”¹å˜è¿™äº›å€¼. å› ä¸º è¿™ä¸ªç»“æ„å°±ä¼šå¯¼è‡´ dataæ˜¯ä»é›†åˆä¸­æ·±æ‹·è´å‡ºæ¥çš„, è·Ÿé›†åˆé‡Œçš„æ•°æ®å·²ç»æ²¡æœ‰å…³ç³»äº†.</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span>(<span class="keyword">var</span> data <span class="keyword">in</span> dataCollection)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> Info&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨ä¸€ä¸ªCollectionæ¯”å¦‚Listæˆ–è€…Dictionaryéå†ç”±Infoæ„æˆçš„é›†åˆ, å¹¶ä¸”å°è¯•ä¿®æ”¹å…¶ä¸­çš„å€¼, æ˜¯ä¸æ”¯æŒçš„, foreachå˜› å¦‚æœè¿™æ˜¯ä¸ªclasså°±å¯ä»¥<br>è¿™æ˜¯å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹çš„æœ¬è´¨åŒºåˆ«</p><h1>C# CodeGenerator</h1><p><a href="https://devblogs.microsoft.com/dotnet/introducing-c-source-generators/">https://devblogs.microsoft.com/dotnet/introducing-c-source-generators/</a></p><h1>C# æ¥å£</h1><p>å®šä¹‰æ¥å£çš„ç›®çš„, è®©ä¸€äº›ç±»å‹å…·æœ‰æŸäº›è¡Œä¸º, å¹¶ä¸”å¯ä»¥é€šè¿‡å£°æ˜æ¥å£ç±»å‹, æ¥æŒæœ‰æ¥å£çš„å®ä¾‹, ä¸€ä¸ªå®ä¾‹çš„å¯¹è±¡æ—¢å¯ä»¥æ˜¯è¯¥å®ä¾‹çš„classç±»å‹, ä¹Ÿå¯ä»¥æ˜¯å…¶å®ç°çš„ä»»æ„ä¸€ä¸ªæ¥å£çš„ç±»å‹.</p><p>ä¸¤ç§åœºæ™¯:</p><ol><li><p>Unityçš„EventSystemæä¾›äº†IDragHandlerã€IBeginDragHandlerä¸€ç³»åˆ—æ¥å£ç”¨æ¥è·å–ç”¨æˆ·çš„æ“ä½œè¾“å…¥è¡Œä¸º.<br>è¿™ç§åœºæ™¯ä¸‹, æ¥å£çš„ä½œç”¨æ˜¯ ä¿è¯äº†EventSystemçš„ç‹¬ç«‹æ€§ã€éš”ç¦»æ€§, EventSystemé€šè¿‡å¯¹å¤–æš´éœ²æ¥å£çš„æ–¹å¼, è®©å¤–éƒ¨ EventSystemä¸­</p></li><li><p>C#ä¸­çš„éæ‰˜ç®¡èµ„æºåœ¨ä½¿ç”¨çš„æ—¶å€™å¯ä»¥å®ç°IDisposableæ¥å£</p></li><li><p>è¯­æ³•ç³–foreach</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> ç¡¬æŠ€èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Keep On Keeping On</title>
      <link href="/posts/fd7e9d17/"/>
      <url>/posts/fd7e9d17/</url>
      
        <content type="html"><![CDATA[<h1>åˆé›†</h1><p><a href="https://soincredible.github.io/posts/d97e22f1">C#</a><br><a href="">Unity</a></p><ul><li><a href="">Animation</a></li><li><a href="">èµ„æºåŠ è½½ç®¡ç†</a></li><li><a href="">ä»£ç çƒ­æ›´</a></li><li><a href="">ç½‘ç»œé€šä¿¡</a></li><li><a href="">è®¾è®¡æ¨¡å¼</a></li><li><a href="https://soincredible.github.io/ae5b3442">å·¥å…·å¼€å‘</a></li><li><a href="">æ€§èƒ½ä¼˜åŒ–</a></li><li><a href="https://soincredible.github.io/e0e34b4b">UGUI</a></li><li><a href="">æ¸²æŸ“</a></li><li><a href="">Shader</a></li><li><a href="">URP</a></li><li><a href="">HDRP</a></li><li><a href="">æ’ä»¶åˆé›†</a><br><a href="">è®¾è®¡æ¨¡å¼</a><br><a href="https://soincredible.github.io/posts/e1a82e1">æ•°æ®ç»“æ„ç®—æ³•</a><br><a href="">æ¸²æŸ“</a><br><a href="">å»ºæ¨¡</a><br><a href="">äº‘æœåŠ¡å™¨</a><br><a href="">AI</a><br><a href="">é˜…è¯»</a><br><a href="">è¿·æ€</a><br><a href="">Jekins</a><br><a href="">æˆ‘å†™çš„æ’ä»¶</a></li></ul><p>Obsidian + Git + Hexo + PigGo + äº‘æœåŠ¡å™¨ + äº‘å­˜å‚¨çš„æ–¹æ¡ˆ <a href="https://zhuanlan.zhihu.com/p/554333805">https://zhuanlan.zhihu.com/p/554333805</a><br>å›¾åºŠæ–¹æ¡ˆ <a href="https://tbed.hellohao.cn/">https://tbed.hellohao.cn/</a><br>PicGo <a href="https://github.com/Molunerfinn/PicGo">https://github.com/Molunerfinn/PicGo</a></p><h1>ProjectO</h1><p><a href="https://soincredible.github.io/posts/8a8aad75">https://soincredible.github.io/posts/8a8aad75</a></p><ul><li>ETæ¡†æ¶</li><li>Animancer</li><li>è¡Œä¸ºæ ‘</li><li>æŠ€èƒ½ç¼–è¾‘å™¨</li><li>æ¨¡å‹æå–</li><li>YooAsset</li><li>Slate</li><li>Odin</li><li><a href="https://github.com/Cysharp/MagicPhysX">MagicPhysX</a> C#ç»‘å®šç‰©ç†åº“</li><li><a href="https://assetstore.unity.com/packages/tools/terrain/world-streamer-2-176482#description">WorldStreamer</a> å¤§åœ°å›¾åŠ è½½æ–¹æ¡ˆ</li><li><a href="">UniStorm</a></li></ul><h1>TODO</h1><ul><li>æ¸¸æˆè¡Œä¸šæŠ¥å‘Š</li><li>â­•ï¸ æ­£åˆ™è¡¨è¾¾å¼</li><li>â­•ï¸ LinQè¡¨è¾¾å¼</li><li>â­•ï¸ åœºæ™¯å¦‚æœæ‰“äº†AssetBundleæ˜¯å¦‚ä½•åŠ è½½çš„ï¼Ÿå’Œæ™®é€šèµ„æºä¸€æ ·å—ï¼Ÿ-&gt; AssetBundleåšå®¢è¡¥å…¨</li><li>â­•ï¸ åç¼–è¯‘å…¥é—¨</li><li>â­•ï¸ ä¾èµ–æ³¨å…¥åšå®¢</li><li>â­•ï¸ <a href="https://docs.unity3d.com/2022.3/Documentation/Manual/class-TextureImporterOverride.html">ææ¸…æ¥šUnity TextureImporterä¸­å‡ ç§å‹ç¼©æ ¼å¼çš„ä½¿ç”¨</a></li><li>â­•ï¸ Unityç²’å­ç³»ç»Ÿçš„ä½¿ç”¨ -&gt; UIæ¡†æ¶åšå®¢+å®ç°</li><li>â­•ï¸ Unityæ¸²æŸ“ç®¡çº¿äº†è§£</li><li>â­•ï¸ æ³¨æ„åˆ°å›¾é›†å’Œæ•£å›¾ä¸€æ ·,éƒ½æ˜¯å¯ä»¥è®¾ç½®åœ¨ä¸åŒå¹³å°ä¸Šçš„Compress Formatçš„,éœ€è¦æµ‹è¯•çš„æ˜¯,å³ä½¿å°†å›¾é›†è®¾ç½®äº†åˆç†çš„å‹ç¼©æ ¼å¼,å¦‚æœå›¾é›†ä¸­çš„æ•£å›¾ç”¨çš„å‹ç¼©æ ¼å¼ä¸åˆç†,è¿˜æ˜¯ä¼šå¯¼è‡´åŒ…ä½“ä¼šå¤§.</li><li>â­•ï¸ å·¥å…·åº“æ•´ç†<ul><li>â­•ï¸ æƒé‡éšæœºæ± </li><li>â­•ï¸ åœ¨çº¿é…ç½®è¡¨</li><li>â­•ï¸ å¼•ç”¨èµ„æºæ£€æŸ¥å·¥å…·</li><li>â­•ï¸ çŠ¶æ€æœº</li><li>â­•ï¸ ç¼“å­˜æ± </li></ul></li><li>â­•ï¸ TimeLineæ’ä»¶</li><li>â­•ï¸ Cinemachineæ’ä»¶</li><li>â­•ï¸ äºŒå‰æ ‘ç®—æ³•æ•´ç†</li><li>â­•ï¸ å›¾ç®—æ³•æ•´ç†</li><li><a href="https://www.mmzsblog.cn/articles/2022/02/23/1645604883865.html#toc_h4_188">Unityé¢è¯•</a></li><li><a href="https://www.bilibili.com/video/BV1sB4y1n7hg/?spm_id_from=333.1387.homepage.video_card.click&amp;vd_source=83f4165825ce9df46cf4fd576ccb1102">ARPG</a></li><li><a href="https://www.bilibili.com/video/BV1x44y1e7Ro/?spm_id_from=333.337.search-card.all.click&amp;vd_source=83f4165825ce9df46cf4fd576ccb1102">Unity Animator</a></li><li><a href="https://www.bilibili.com/opus/904636480410877954">è¡—éœ¸å¯¼è®º</a></li></ul><h1>èµ„æº</h1><ul><li><a href="https://sharplab.io/">ä¸€ä¸ªèƒ½åœ¨çº¿æŸ¥çœ‹ç»è¿‡C#ç¼–è¯‘å™¨å¤„ç†è¿‡åC#ä»£ç çš„ç½‘ç«™</a></li><li><a href="https://referencesource.microsoft.com/">C#æºç </a> 2025.7.18 è¿™ä¸ªç½‘ç«™æŒ‚æ‰äº†https://sourceroslyn.io/</li><li><a href="https://zhuanlan.zhihu.com/p/452412091">Macå®‰è£…Windowsè™šæ‹Ÿæœº</a></li><li><a href="https://github.com/icsharpcode/AvaloniaILSpy">èƒ½å¤Ÿåœ¨Macä¸Šè¿è¡Œçš„ILSpy</a></li><li><a href="https://tableconvert.com/zh-cn/markdown-generator">MarkDownåœ¨çº¿è¡¨æ ¼ç”Ÿæˆ</a></li><li><a href="https://z-library.sk/">åœ¨çº¿å›¾ä¹¦é¦†</a></li><li><a href="https://godbolt.org/">Compiler Explorer ä¸€ä¸ªåœ¨çº¿çš„æŸ¥çœ‹C++ä»£ç å¯¹åº”æ±‡ç¼–è¯­è¨€çš„å·¥å…·</a></li><li><a href="https://assimp.org/">å¼€æºçš„C++èµ„äº§å¯¼å…¥åº“(OpenGLå­¦ä¹ æ¨¡å‹å¯¼å…¥ä¸€èŠ‚æåŠ)</a></li><li><a href="https://glm.g-truc.net/0.9.8/index.html">OpenGLæ•™ç¨‹ä¸­ä½¿ç”¨çš„æ•°å­¦åº“</a></li><li><a href="https://github.com/nothings/stb">ä¸€ä¸ªC++ä¸­æµè¡Œçš„å›¾ç‰‡åŠ è½½åº“</a></li><li><a href="https://www.glfw.org/docs/latest/index.html">GLFWä¸»é¡µ</a></li><li><a href="https://www.shadertoy.com/">ä¸€ä¸ªåœ¨çº¿çš„Shaderæ„å»ºå™¨</a></li><li>Gradle</li><li><a href="https://www.jenkins.io/">Jenkins</a></li><li><a href="https://www.youtube.com/watch?v=vOBSAFmL610&amp;list=PLI9CK8e_e3MeDv8K1vi0FosBV4dKmcOo3">C#æœåŠ¡å™¨</a></li><li><a href="https://www.bilibili.com/video/BV1X7411F744">Games101</a></li><li><a href="https://games-cn.org/forums/topic/allhw/">Games101ä½œä¸š</a></li><li><a href="https://www.bilibili.com/video/BV1oU4y1R7Km">Games104</a></li><li>Android</li><li><a href="https://developer.apple.com/documentation/">IOSå¼€å‘</a></li><li><a href="https://learnopengl-cn.github.io/intro/">OpenGLå­¦ä¹ </a></li><li>æ¸¸æˆé€†å‘</li><li><a href="https://www.bilibili.com/cheese/play/ss32685?csource=Hp_searchresult&amp;spm_id_from=333.337.0.0">Unrealè°Œå˜‰è¯šçš„è“å›¾æ•™ç¨‹ä¸é”™</a></li><li></li><li>Cocos2d</li><li>Godot</li><li><a href="https://programmercarl.com/">ç®—æ³•, ä»£ç éšæƒ³å½•ä¸é”™</a></li><li>è®¾è®¡æ¨¡å¼</li><li><a href="https://www.bilibili.com/video/BV14u41147YH/?spm_id_from=333.337.search-card.all.click&amp;vd_source=83f4165825ce9df46cf4fd576ccb1102">Blenderæ•™ç¨‹</a></li><li><a href="">Vim</a></li><li><a href="https://github.com/LearnShare/Learning-Markdown">MarkDownæ–‡æ¡£ç¼–å†™æŠ€å·§</a></li><li><a href="https://www.piccoloengine.com/topics/node/feed/all">Piccoloæ¸¸æˆå¼•æ“ç¤¾åŒº</a></li><li><a href="https://www.youtube.com/watch?v=fNk_zzaMoSs&amp;list=PLZHQObOWTQDPD3MizzM2xVFitgF8hE_ab&amp;index=2">3b1bâ€”â€”çº¿æ€§ä»£æ•°çš„æœ¬è´¨</a></li><li><a href="https://github.com/AssetRipper/AssetRipper">AssetRipper</a>: Macä¸Šè§£åŒ…AssetBundleçš„å·¥å…·</li><li><a href="https://github.com/libgdx/libgdx">libGDX</a>: è½»é‡çº§æ¸¸æˆå¼•æ“</li><li><a href="https://github.com/Perfare/Il2CppDumper">Il2CppDumper</a>: åç¼–è¯‘å·¥å…·</li><li><a href="https://github.com/NationalSecurityAgency/ghidra">ghidra</a>: åç¼–è¯‘å·¥å…·</li><li><a href="https://github.com/LearnShare/Learning-Markdown">MarkDownæ–‡æ¡£ç¼–å†™æŠ€å·§</a></li><li><a href="https://github.com/modesttree/Zenject">Zenject</a>: Unityä¸­ä½¿ç”¨çš„è½»é‡çº§ä¾èµ–æ³¨å…¥æ¡†æ¶ ç±»ä¼¼çš„è¿˜æœ‰VContainer</li><li><a href="https://github.com/glfw/glfw">GLFW</a></li><li><a href="https://github.com/jenkinsci/jenkins">Jenkins</a></li><li><a href="https://github.com/Unity-Technologies/AssetBundles-Browser">AssetBundleBrowser</a></li><li><a href="https://github.com/egametang/ET">ETæ¡†æ¶</a></li><li><a href="https://github.com/mongodb/mongo">MongoDB</a></li><li><a href="https://github.com/Cysharp/UniTask">UniTask</a></li><li><a href="https://cdprojektred.atlassian.net/wiki/spaces/W3REDkit/pages/36864027/WS+Script+Studio+basics">RedKitå®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://github.com/EllanJiang/GameFramework">GameFrameWork</a></li><li><a href="https://www.youtube.com/@Gdconf">GDC</a></li><li><a href="https://kbengine.github.io//">kbEngine</a></li><li><a href="https://love2d.org/wiki/Game_Distribution">love2dè½»é‡çº§æ¸¸æˆå¼•æ“,å°ä¸‘ç‰Œçš„å¼€å‘å¼•æ“</a></li><li><a href="https://www.mixamo.com/#/?page=3">mixamoå…è´¹ä¸‹è½½è§’è‰²åŠ¨ç”»</a></li><li><a href="https://github.com/snozbot/fungus">å¼€æºå¯¹è¯æ¡†æ¶fungus</a></li><li><a href="https://www.redblobgames.com/">RedBlobGameså¯è§†åŒ–A*å¯»è·¯ç®—æ³•</a></li><li><a href="https://github.com/warmtrue/RVO2-Unity">é¿éšœç®—æ³•RVO</a></li><li><a href="https://github.com/Tencent/xLua">xLua</a></li><li><a href="https://github.com/topics/game">githubæ¸¸æˆåŒº</a></li><li><a href="https://www.yooasset.com/docs/Introduce">YooAsset</a></li><li><a href="https://www.photonengine.com/">Photonâ€”â€”ä¸€ä¸ªä¸“æ³¨äºåšUnityå¤šäººè”æœºæ¡†æ¶çš„å·¥ä½œå®¤</a></li><li><a href="https://osgameclones.com/">å¼€æºæ¸¸æˆåˆé›†</a></li><li><a href="https://github.com/qq362946/Fantasy">Fantacy</a></li><li><a href="https://www.codeandweb.com/texturepacker">TexturePacker</a></li><li><a href="https://www.bilibili.com/video/BV1sE411g7N9?spm_id_from=333.788.videopod.sections&amp;vd_source=83f4165825ce9df46cf4fd576ccb1102">åº„æ‡‚æŠ€æœ¯ç¾æœ¯è¯¾ç¨‹</a></li><li><a href="https://github.com/BoyanTata/AP01">åº„æ‡‚æŠ€æœ¯ç¾æœ¯è¯¾ç¨‹é…å¥—èµ„æº</a></li><li><a href="https://www.bilibili.com/video/BV1TX4y1g75w?spm_id_from=333.788.videopod.sections&amp;vd_source=83f4165825ce9df46cf4fd576ccb1102">Bç«™UPä¸»samlee2025çš„Shaderç³»åˆ—, å°±æ˜¯é€šè¿‡ä»–æ‰çŸ¥é“äº†åº„æ‡‚</a></li><li><a href="https://www.kdocs.cn/l/cbSqBT9pOXH5">UPä¸»samlee2025çš„ç¬”è®°</a></li><li><a href="https://github.com/FreyaHolmer/ShaderForge">ShaderForge</a></li></ul><h1>åšå®¢</h1><ul><li><a href="https://frog-game.github.io/posts/blog/wufengdashijie/">Frogâ€™s Blog</a></li><li><a href="https://www.lfzxb.top/">çƒŸé›¨è¿·ç¦»åŠä¸–æ®‡</a></li><li><a href="https://blog.csdn.net/j756915370?type=blog">æ°´æ›œæ—¥é¸¡</a></li><li><a href="https://networm.me/">ç‹‚é£™</a></li><li><a href="https://ameye.dev/">Alexander Ameye</a></li><li><a href="https://candycat1992.github.io/">CandyCatå†¯ä¹ä¹</a></li><li><a href="https://www.ownself.org/">OWNSELF</a></li><li><a href="https://blog.codingnow.com/">äº‘é£çš„Blog</a></li><li><a href="https://www.liuocean.com/">Lâ€™s Blog</a></li><li><a href="https://blog.stephencleary.com/">Stephen Cleary</a> C#ä¸“å®¶</li><li><a href="https://walkingfat.com/">è¡Œå°¸èµ°æ²¹</a></li><li><a href="https://acegikmo.com/">ShaderForgeä½œè€…çš„åšå®¢, è¿˜æ˜¯ä¸ªæ•°å­¦å®¶</a></li></ul><h1>Cover</h1><ul><li><a href="https://www.notion.so/images/page-cover/met_gerome_1890.jpg">https://www.notion.so/images/page-cover/met_gerome_1890.jpg</a></li></ul><p>ä¸çŸ¥é“ä»å“ªé‡Œå¬åˆ°çš„ä¸€å¥è¯ ç¨‹åºå‘˜åªè¦èƒ½æŠŠäº‘ã€æ°´ã€è‰çš„Shaderæ¸²æŸ“ææ˜ç™½å°±ç®—è¿‡å…³äº†ã€‚</p><p>åšå®¢æ”¶å½• <a href="https://zhuanlan.zhihu.com/p/100922816">https://zhuanlan.zhihu.com/p/100922816</a><br><a href="https://javahikers.github.io/2019/06/16/personal-blog-being-included-in-google/">https://javahikers.github.io/2019/06/16/personal-blog-being-included-in-google/</a></p><h1>Unity æ’ä»¶åˆé›†</h1><p><a href="https://assetstore.unity.com/packages/tools/utilities/vfolders-2-255470">vFolders 2</a></p><p>ç›´æ¥ä½¿ç”¨Macå‘½ä»¤è¡Œæ¯”è¾ƒä¸¤ä¸ªæ–‡ä»¶æ˜¯å¦ä¸€æ¨¡ä¸€æ · åŸºäºhashå€¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shasum filename</span><br></pre></td></tr></table></figure><p>æœ¬æ–‡æ ‡é¢˜<strong>Keep On Keeping On</strong>, å‡ºè‡ªå°å²›ç§€å¤«æ­»äº¡ææµ….</p><p>å¿ƒæ™º<br>ç»æµ<br>å†å²<br>å°è¯´<br>è¿åŠ¨å¥åº·<br>å·¥ä½œæŠ€èƒ½</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ETä¸­åå°„ä¸ç‰¹æ€§çš„ä½¿ç”¨</title>
      <link href="/posts/cd96d12/"/>
      <url>/posts/cd96d12/</url>
      
        <content type="html"><![CDATA[<h1>ETä¸­ç”¨åˆ°çš„å…¶ä»–Attribute</h1><p>[BsonIgnore]<br>[UnityEngine.HideInInspector]<br>[MemoryPackIgnore]</p><blockquote><p>2025.3.20æ›´æ–°</p></blockquote><p>ç¬”è€…æœ€è¿‘åœ¨çœ‹ETæ¡†æ¶çš„Demo,é‡Œé¢æœ‰ä¸€ä¸ªåä¸º<code>CodeLoader</code>çš„è„šæœ¬,é‡Œé¢ç”¨åˆ°äº†åå°„çš„ä¸œè¥¿</p><p>åå°„å¯ä»¥ç›´æ¥ä¸ç¨‹åºé›†äº¤äº’,è¶Šè¿‡å¸¸è§„çš„ç±»æ„é€ å‡½æ•°,ç›´æ¥ç”±ç¨‹åºé›†ä¸­å®ä¾‹åŒ–å‡ºå¯¹è±¡æ¥.<br>é€šè¿‡åå°„æ‰§è¡Œæ–¹æ³•/å®ä¾‹åŒ–å¯¹è±¡çš„æ–¹å¼ä¹Ÿæœ‰ç¼ºç‚¹,åœ¨Editorä¸­æ— æ³•ç›´è§‚å®šä½åˆ°è°ƒç”¨</p><p>Assemblyç¨‹åºé›†æä¾›ç»™äº†ä¸€ä¸ª<code>GetTypes()</code>æ¥å£,å…è®¸ä½ è®¿é—®è¯¥ç¨‹åºé›†ä¸­åŒ…å«çš„æ‰€æœ‰Type<br>Typeä¸­å­˜å‚¨äº†FullNameã€ä»¥åŠè¿™ä¸ªTypeæ‰€å¤„çš„ç¨‹åºé›†</p><p>åœ¨<code>CodeTypes</code>è„šæœ¬çš„Awakeæ–¹æ³•ä¸­</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Awake</span>(<span class="params">Assembly[] assemblies</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Dictionary&lt;<span class="built_in">string</span>, Type&gt; addTypes = AssemblyHelper.GetAssemblyTypes(assemblies);</span><br><span class="line">    <span class="keyword">foreach</span> ((<span class="built_in">string</span> fullName, Type type) <span class="keyword">in</span> addTypes)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.allTypes[fullName] = type;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (type.IsAbstract)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®°å½•æ‰€æœ‰çš„æœ‰BaseAttributeæ ‡è®°çš„çš„ç±»å‹</span></span><br><span class="line">        <span class="built_in">object</span>[] objects = type.GetCustomAttributes(<span class="keyword">typeof</span>(BaseAttribute), <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="built_in">object</span> o <span class="keyword">in</span> objects)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>.types.Add(o.GetType(), type);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>CodeLoaderä¸­çš„Startæ–¹æ³•å¦‚ä¸‹:</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!Define.IsEditor)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">byte</span>[] modelAssBytes = <span class="keyword">this</span>.dlls[<span class="string">&quot;Unity.Model.dll&quot;</span>].bytes;</span><br><span class="line">        <span class="built_in">byte</span>[] modelPdbBytes = <span class="keyword">this</span>.dlls[<span class="string">&quot;Unity.Model.pdb&quot;</span>].bytes;</span><br><span class="line">        <span class="built_in">byte</span>[] modelViewAssBytes = <span class="keyword">this</span>.dlls[<span class="string">&quot;Unity.ModelView.dll&quot;</span>].bytes;</span><br><span class="line">        <span class="built_in">byte</span>[] modelViewPdbBytes = <span class="keyword">this</span>.dlls[<span class="string">&quot;Unity.ModelView.pdb&quot;</span>].bytes;</span><br><span class="line">        <span class="comment">// å¦‚æœéœ€è¦æµ‹è¯•ï¼Œå¯æ›¿æ¢æˆä¸‹é¢æ³¨é‡Šçš„ä»£ç ç›´æ¥åŠ è½½Assets/Bundles/Code/Unity.Model.dll.bytesï¼Œä½†çœŸæ­£æ‰“åŒ…æ—¶å¿…é¡»ä½¿ç”¨ä¸Šé¢çš„ä»£ç </span></span><br><span class="line">        <span class="comment">//modelAssBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, &quot;Unity.Model.dll.bytes&quot;));</span></span><br><span class="line">        <span class="comment">//modelPdbBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, &quot;Unity.Model.pdb.bytes&quot;));</span></span><br><span class="line">        <span class="comment">//modelViewAssBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, &quot;Unity.ModelView.dll.bytes&quot;));</span></span><br><span class="line">        <span class="comment">//modelViewPdbBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, &quot;Unity.ModelView.pdb.bytes&quot;));</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Define.EnableIL2CPP)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> kv <span class="keyword">in</span> <span class="keyword">this</span>.aotDlls)</span><br><span class="line">            &#123;</span><br><span class="line">                TextAsset textAsset = kv.Value;</span><br><span class="line">                RuntimeApi.LoadMetadataForAOTAssembly(textAsset.bytes, HomologousImageMode.SuperSet);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.modelAssembly = Assembly.Load(modelAssBytes, modelPdbBytes);</span><br><span class="line">        <span class="keyword">this</span>.modelViewAssembly = Assembly.Load(modelViewAssBytes, modelViewPdbBytes);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.enableDll)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">byte</span>[] modelAssBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, <span class="string">&quot;Unity.Model.dll.bytes&quot;</span>));</span><br><span class="line">            <span class="built_in">byte</span>[] modelPdbBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, <span class="string">&quot;Unity.Model.pdb.bytes&quot;</span>));</span><br><span class="line">            <span class="built_in">byte</span>[] modelViewAssBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, <span class="string">&quot;Unity.ModelView.dll.bytes&quot;</span>));</span><br><span class="line">            <span class="built_in">byte</span>[] modelViewPdbBytes = File.ReadAllBytes(Path.Combine(Define.CodeDir, <span class="string">&quot;Unity.ModelView.pdb.bytes&quot;</span>));</span><br><span class="line">            <span class="keyword">this</span>.modelAssembly = Assembly.Load(modelAssBytes, modelPdbBytes);</span><br><span class="line">            <span class="keyword">this</span>.modelViewAssembly = Assembly.Load(modelViewAssBytes, modelViewPdbBytes);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            Assembly[] assemblies = AppDomain.CurrentDomain.GetAssemblies();</span><br><span class="line">            <span class="keyword">foreach</span> (Assembly ass <span class="keyword">in</span> assemblies)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">string</span> name = ass.GetName().Name;</span><br><span class="line">                <span class="keyword">if</span> (name == <span class="string">&quot;Unity.Model&quot;</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">this</span>.modelAssembly = ass;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (name == <span class="string">&quot;Unity.ModelView&quot;</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">this</span>.modelViewAssembly = ass;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.modelAssembly != <span class="literal">null</span> &amp;&amp; <span class="keyword">this</span>.modelViewAssembly != <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    (Assembly hotfixAssembly, Assembly hotfixViewAssembly) = <span class="keyword">this</span>.LoadHotfix();</span><br><span class="line"></span><br><span class="line">    World.Instance.AddSingleton&lt;CodeTypes, Assembly[]&gt;(<span class="keyword">new</span>[]</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">typeof</span> (World).Assembly, <span class="keyword">typeof</span> (Init).Assembly, <span class="keyword">this</span>.modelAssembly, <span class="keyword">this</span>.modelViewAssembly, hotfixAssembly,</span><br><span class="line">        hotfixViewAssembly</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    IStaticMethod start = <span class="keyword">new</span> StaticMethod(<span class="keyword">this</span>.modelAssembly, <span class="string">&quot;ET.Entry&quot;</span>, <span class="string">&quot;Start&quot;</span>);</span><br><span class="line">    start.Run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ æ˜¯Editoræ¨¡å¼ä¸‹çš„è¯,ä½ åº”è¯¥ä¼šèµ°åˆ°<code>this.enableDll</code>ä¸ºtrueçš„åˆ†æ”¯<br>é€šè¿‡æ‰§è¡ŒCodeLoaderä¸­çš„Startæ–¹æ³•,è¢«éå†åˆ°çš„ç¨‹åºé›†æœ‰<code>World</code>ç±»æ‰€åœ¨çš„ç¨‹åºé›†<code>Unity.Core</code>ã€<code>Init</code>ç±»æ‰€åœ¨çš„ç¨‹åºé›†<code>Unity.Loader</code>ã€modelAssemBly<code>Unity.Model</code>,modelViewAssembly<code>Unity.ModelView</code>,hotfixAssembly<code>Unity.Hotfix</code>,hotfixViewAssembly<code>Unity.HotfixView</code></p><p>ä»£å…¥ä¸€ä¸‹å°±æ˜¯,é€šè¿‡AddSingletonæ–¹æ³•,åˆ›å»ºäº†CodeTypeså®ä¾‹,å¹¶å°†ä¸Šé¢æåˆ°çš„ç¨‹åºé›†ä½œä¸ºå‚æ•°ä¼ å…¥CodeTypeçš„Awakeæ–¹æ³•ä¸­.</p><p>ç„¶ååœ¨modelAssembly<code>Unity.Model</code>ä¸­,æ‰¾åˆ°<code>ET.Entry</code>ç±»ä¸­çš„Startæ–¹æ³•,å¹¶æ‰§è¡Œè¯¥æ–¹æ³•,ç„¶ååœ¨è¯¥æ–¹æ³•ä¸­,æ‰§è¡Œäº†<code>CodeTypes.Instance.CreateCode</code>æ–¹æ³•,è¯¥æ–¹æ³•ä¼šåœ¨ä¸Šé¢æ”¶é›†åˆ°çš„ç¨‹åºé›†ä¸­,æ‰¾åˆ°æ‰€æœ‰è¢«æ ‡è®°äº†CodeAttributeå±æ€§çš„ç±»,å¹¶å°†è¿™äº›ç±»å®ä¾‹åŒ–å‡ºæ¥,è¿™äº›ç±»åˆ†åˆ«æ˜¯</p><ul><li>EntitySystemSingleton</li><li>MessageDispatcher MessagePatcherä¸­çš„Awakeæ–¹æ³•ä¸­å®ä¾‹åŒ–äº†æ‰€æœ‰è¢«æ ‡è®°ä¸ºMessageHandlerAttributeå±æ€§çš„ç±»</li><li>EventSystem</li><li>HttpDispatcher</li><li>LSEntitySystemSingleton</li><li>AIDispatcherComponent</li><li>ConsoleDispatcher</li><li>MessageSessionDispatcher</li><li>NumericWatcherComponent</li><li>UIEventComponent<br>ä¹Ÿå°±æ˜¯è¯´,ä¸Šé¢è¿™åä¸ªç±»,é€šè¿‡æ‰§è¡ŒETçš„Entryæ–¹æ³•ä¹‹åå°±å·²ç»è¢«åˆ›å»ºå‡ºæ¥äº†.</li></ul><p>åœ¨<code>MessageSessionDispatcher</code>çš„Awakeæ–¹æ³•ä¸­å¦‚ä¸‹ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    HashSet&lt;Type&gt; types = CodeTypes.Instance.GetTypes(<span class="keyword">typeof</span> (MessageSessionHandlerAttribute));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (Type type <span class="keyword">in</span> types)</span><br><span class="line">    &#123;</span><br><span class="line">        IMessageSessionHandler iMessageSessionHandler = Activator.CreateInstance(type) <span class="keyword">as</span> IMessageSessionHandler;</span><br><span class="line">        <span class="keyword">if</span> (iMessageSessionHandler == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Log.Error(<span class="string">$&quot;message handle <span class="subst">&#123;type.Name&#125;</span> éœ€è¦ç»§æ‰¿ IMHandler&quot;</span>);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">object</span>[] attrs = type.GetCustomAttributes(<span class="keyword">typeof</span>(MessageSessionHandlerAttribute), <span class="literal">true</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">foreach</span> (<span class="built_in">object</span> attr <span class="keyword">in</span> attrs)</span><br><span class="line">        &#123;</span><br><span class="line">            MessageSessionHandlerAttribute messageSessionHandlerAttribute = attr <span class="keyword">as</span> MessageSessionHandlerAttribute;</span><br><span class="line">            </span><br><span class="line">            Type messageType = iMessageSessionHandler.GetMessageType();</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">ushort</span> opcode = OpcodeType.Instance.GetOpcode(messageType);</span><br><span class="line">            <span class="keyword">if</span> (opcode == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Log.Error(<span class="string">$&quot;æ¶ˆæ¯opcodeä¸º0: <span class="subst">&#123;messageType.Name&#125;</span>&quot;</span>);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            MessageSessionDispatcherInfo messageSessionDispatcherInfo = <span class="keyword">new</span> (messageSessionHandlerAttribute.SceneType, iMessageSessionHandler);</span><br><span class="line">            <span class="keyword">this</span>.RegisterHandler(opcode, messageSessionDispatcherInfo);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ä¸­çš„<code>GetCustomAttributes(typeof(MessageSessionHandlerAttribute), true);</code>æ¥å£</p><h1>AIHandlerAttribute</h1><h1>CodeAttribute</h1><h1>ConfigAttribute</h1><h1>ConsoleHandlerAttribute</h1><h1>EnableClassAttribute</h1><h1>EntitySystemAttribute</h1><h1>EntitySystemOfAttribute</h1><h1>EventAttribute</h1><h1>HttpHandlerAttribute</h1><h1>InvokeAttribute</h1><h1>LSEntitySystemAttribute</h1><h1>LSEntitySystemOfAttribute</h1><h1>MessageAttribute</h1><h1>MessageHandlerAttribute</h1><h2 id="MessageLocationHandlerAttribute">MessageLocationHandlerAttribute</h2><h1>MessageSessionHandlerAttritube</h1><h1>NumericWAtcherAttribute</h1><h1>ResponseTypeAttribute</h1><h1>UIEventAttribute</h1><hr><h1>èƒŒæ™¯</h1><p>è¿™ç¯‡åšå®¢æœ¬æ¥æƒ³èŠä¸€èŠåå°„çš„å†…å®¹ï¼Œä½†æ˜¯åå°„çš„å‰ç½®çŸ¥è¯†ç‚¹ä¼˜ç‚¹å¤ªå¤šäº†ï¼Œæ‰€ä»¥çœŸæ­£è¦èŠåˆ°åå°„å¯èƒ½è¦åˆ°ä¸‹ä¸€ç¯‡åšå®¢äº†ã€‚</p><h1>ç‰¹æ€§</h1><p>ç‰¹æ€§ï¼ˆAttributeï¼‰æ˜¯ç”¨äºåœ¨è¿è¡Œæ—¶ä¼ é€’ç¨‹åºä¸­å„ç§å…ƒç´ ï¼ˆæ¯”å¦‚ç±»ã€æ–¹æ³•ã€ç»“æ„ã€æšä¸¾ã€ç»„ä»¶ç­‰ç­‰ï¼‰çš„è¡Œä¸ºä¿¡æ¯çš„å£°æ˜æ€§æ ‡ç­¾ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç‰¹æ€§å‘ç¨‹åºæ·»åŠ å£°æ˜æ€§ä¿¡æ¯ã€‚ä¸€ä¸ªå£°æ˜æ€§æ ‡ç­¾æ˜¯é€šè¿‡æ”¾ç½®åœ¨å®ƒæ‰€åº”ç”¨çš„å…ƒç´ å‰é¢çš„æ–¹æ‹¬å·<code>[]</code>æ¥æè¿°çš„ã€‚</p><p>ç‰¹æ€§ç”¨äºæ·»åŠ å…ƒæ•°æ®ï¼Œå¦‚ç¼–è¯‘å™¨æŒ‡ä»¤å’Œæ³¨é‡Š</p><h1>åå°„</h1><p>åå°„æŒ‡ç¨‹åºå¯ä»¥è®¿é—®ã€æ£€æµ‹å’Œä¿®æ”¹å®ƒæœ¬èº«çŠ¶æ€å’Œè¡Œä¸ºçš„ä¸€ç§èƒ½åŠ›ã€‚ç¨‹åºé›†åŒ…å«æ¨¡å—ï¼Œè€Œæ¨¡å—åŒ…å«ç±»å‹ï¼Œç±»å‹åˆåŒ…å«æˆå‘˜ã€‚åå°„æä¾›äº†å°è£…ç¨‹åºé›†ã€æ¨¡å—å’Œç±»å‹çš„å¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åå°„åŠ¨æ€åœ°åˆ›å»ºç±»å‹çš„å®ä¾‹ï¼Œå°†ç±»å‹ç»‘å®šåˆ°ç°æœ‰å¯¹è±¡ä¸Šï¼Œæˆ–è€…ä»ç°æœ‰å¯¹è±¡ä¸­è·å–ç±»å‹ã€‚ç„¶åå¯ä»¥è°ƒç”¨ç±»å‹çš„æ–¹æ³•æˆ–è€…è®¿é—®å…¶å­—æ®µå’Œå±æ€§ã€‚</p><h2 id="ä¼˜ç¼ºç‚¹">ä¼˜ç¼ºç‚¹</h2><p>ä¼˜ç‚¹ï¼š</p><ol><li>åå°„æé«˜äº†ç¨‹åºçš„çµæ´»æ€§å’Œæ‰©å±•æ€§</li><li>é™ä½è€¦åˆæ€§ï¼Œæé«˜è‡ªé€‚åº”èƒ½åŠ›</li><li>å®ƒå…è®¸ç¨‹åºåˆ›å»ºå’Œæ§åˆ¶ä»»ä½•ç±»çš„å¯¹è±¡ï¼Œæ— éœ€æå‰ç¡¬ç¼–ç ç›®æ ‡ç±»</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>æ€§èƒ½é—®é¢˜ï¼šåå°„åŸºæœ¬ä¸Šæ˜¯ä¸€ç§è§£é‡Šæ“ä½œï¼Œç”¨äºå­—æ®µå’Œæ–¹æ³•æ¥å…¥æ—¶è¦è¿œæ…¢äºç›´æ¥ä»£ç ï¼Œå› æ­¤åå°„æœºåˆ¶ä¸»è¦åº”ç”¨åœ¨å¯¹çµæ´»æ€§å’Œæ‹“å±•æ€§è¦æ±‚å¾ˆé«˜çš„ç³»ç»Ÿæ¡†æ¶ä¸Šï¼Œæ™®é€šç¨‹åºä¸å»ºè®®ä½¿ç”¨ã€‚</li><li>ä½¿ç”¨åå°„ä¼šæ¨¡ç³Šç¨‹åºå†…éƒ¨çš„é€»è¾‘ï¼Œç¨‹åºå‘˜å¸Œæœ›åœ¨æºç ä¸­çœ‹åˆ°ç¨‹åºçš„é€»è¾‘ï¼Œåå°„å´ç»•è¿‡äº†æºä»£ç çš„æŠ€æœ¯ï¼Œå› è€Œä¼šå¸¦æ¥ç»´æŠ¤çš„é—®é¢˜ï¼Œåå°„ä»£ç æ¯”ç›¸åº”çš„ç›´æ¥ä»£ç æ›´ä¸ºå¤æ‚ã€‚</li></ol><h1>åå°„ä¸ºä»€ä¹ˆæ…¢?</h1><p>å› ä¸ºä¿¡æ¯éƒ½æ˜¯å­—ç¬¦ä¸² æ˜¯è¦æ£€ç´¢å­—ç¬¦ä¸²çš„ è€Œä¸”å­—ç¬¦ä¸²çš„æ£€ç´¢æ˜¯å¤§å°ä¸æ•æ„Ÿçš„.</p><h2 id="åå°„çš„ç”¨é€”ï¼š">åå°„çš„ç”¨é€”ï¼š</h2><p>åå°„æœ‰ä»¥ä¸‹ç”¨é€”ï¼š</p><ol><li>å®ƒå…è®¸åœ¨è¿è¡Œæ—¶æŸ¥çœ‹ç‰¹æ€§ï¼ˆattributeï¼‰ä¿¡æ¯</li><li>å®ƒå…è®¸å®¡æŸ¥é›†åˆä¸­çš„å„ç§ç±»å‹ï¼Œä»¥åŠå®ä¾‹åŒ–è¿™äº›ç±»å‹</li><li>å®ƒå…è®¸å»¶è¿Ÿç»‘å®šçš„æ–¹æ³•å’Œå±æ€§</li><li>å®ƒå…è®¸åœ¨è¿è¡Œæ—¶åˆ›å»ºæ–°çš„ç±»å‹ï¼Œç„¶åä½¿ç”¨è¿™äº›ç±»å‹æ‰§è¡Œä¸€äº›ä»»åŠ¡</li></ol><h1>TEngineä¸­çš„åå°„</h1><p>åœ¨TEngineä¸­æœ‰ä¸€ä¸ªæ¨¡å—, æ˜¯åœ¨ToolBarä¸Šå¢åŠ æŒ‰é’®çš„, æ ¹æ®Unityå®˜æ–¹çš„æ–‡æ¡£, ToolBaråŒºåŸŸæ˜¯æ²¡æœ‰å¯¹å¼€å‘è€…æš´éœ²APIçš„, ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ²¡æœ‰åŠæ³•åœ¨ToolBaråŒºåŸŸè‡ªå®šä¹‰å†…å®¹, è€ŒTEngineé‡‡ç”¨åå°„çš„æ–¹å¼è·å–åˆ°äº†æ§åˆ¶ToolBaråŒºåŸŸè¡¨ç°çš„å®ä¾‹, å¹¶ä¿®æ”¹å…¶ä¸­çš„æ–¹æ³•å­—æ®µ, è¾¾åˆ°äº†è‡ªå®šä¹‰Toolbarçš„æ•ˆæœ.</p>]]></content>
      
      
      <categories>
          
          <category> ET </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
            <tag> ET </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºå‘½åç©ºé—´</title>
      <link href="/posts/73546a6d/"/>
      <url>/posts/73546a6d/</url>
      
        <content type="html"><![CDATA[<p>å‘½åç©ºé—´çš„è®¾è®¡ç›®çš„æ˜¯æä¾›ä¸€ç§è®©ä¸€ç»„åç§°äºå…¶ä»–åç§°åˆ†å‰²å¼€æ¥çš„æ–¹å¼ï¼Œåœ¨ä¸€ä¸ªå‘½åç©ºé—´ä¸­å£°æ˜çš„ç±»çš„åç§°ä¸å¦ä¸€ä¸ªå‘½åç©ºé—´ä¸­å£°æ˜çš„ç›¸åŒçš„ç±»çš„åç§°ä¸å†²çªã€‚</p><p>æˆ‘ä»¬ä¸¾ä¸€ä¸ªè®¡ç®—æœºç³»ç»Ÿä¸­çš„ä¾‹å­ï¼Œä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­å¯ä»¥åŒ…å«å¤šä¸ªæ–‡ä»¶å¤¹ï¼Œæ¯ä¸ªæ–‡ä»¶å¤¹ä¸­ä¸èƒ½æœ‰ç›¸åŒçš„æ–‡ä»¶åï¼Œä½†ä¸åŒæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶å¯ä»¥é‡åã€‚</p><p><img src="https://www.runoob.com/wp-content/uploads/2019/09/0129A8E9-30FE-431D-8C48-399EA4841E9D.jpg" alt=""></p><h1>è‡ªå®šä¹‰å‘½åç©ºé—´</h1><p>å‘½åç©ºé—´çš„å®šä¹‰æ˜¯ä»¥å…³é”®å­—<code>namespace</code>å¼€å§‹ï¼Œåé¢è·Ÿå‘½åç©ºé—´çš„åç§°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">namespace_name</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="comment">// ä»£ç å£°æ˜</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ¼”ç¤ºäº†å‘½åç©ºé—´çš„ç”¨æ³•ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">first_space</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">class</span> <span class="title">namespace_cl</span></span><br><span class="line">   &#123;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">func</span>()</span></span><br><span class="line">      &#123;</span><br><span class="line">         Console.WriteLine(<span class="string">&quot;Inside first_space&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">second_space</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">class</span> <span class="title">namespace_cl</span></span><br><span class="line">   &#123;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">func</span>()</span></span><br><span class="line">      &#123;</span><br><span class="line">         Console.WriteLine(<span class="string">&quot;Inside second_space&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">class</span> <span class="title">TestClass</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">   &#123;</span><br><span class="line">      first_space.namespace_cl fc = <span class="keyword">new</span> first_space.namespace_cl();</span><br><span class="line">      second_space.namespace_cl sc = <span class="keyword">new</span> second_space.namespace_cl();</span><br><span class="line">      fc.func();</span><br><span class="line">      sc.func();</span><br><span class="line">      Console.ReadKey();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç çš„è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Inside first_space</span><br><span class="line">Inside second_space</span><br></pre></td></tr></table></figure><h1>usingå…³é”®å­—</h1><p>usingå…³é”®å­—è¡¨æ˜ç¨‹åºä½¿ç”¨çš„æ˜¯ç»™å®šå‘½åç©ºé—´ä¸­çš„åç§°ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨ç¨‹åºä¸­ä½¿ç”¨Systemå‘½åç©ºé—´ï¼Œå…¶ä¸­</p><p>æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ <strong>using</strong> å‘½åç©ºé—´æŒ‡ä»¤ï¼Œè¿™æ ·åœ¨ä½¿ç”¨çš„æ—¶å€™å°±ä¸ç”¨åœ¨å‰é¢åŠ ä¸Šå‘½åç©ºé—´åç§°ã€‚è¯¥æŒ‡ä»¤å‘Šè¯‰ç¼–è¯‘å™¨éšåçš„ä»£ç ä½¿ç”¨äº†æŒ‡å®šå‘½åç©ºé—´ä¸­çš„åç§°ã€‚ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†å‘½åç©ºé—´çš„åº”ç”¨ã€‚</p><p>è®©æˆ‘ä»¬ä½¿ç”¨ using æŒ‡å®šé‡å†™ä¸Šé¢çš„å®ä¾‹ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> first_space;</span><br><span class="line"><span class="keyword">using</span> second_space;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">first_space</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">class</span> <span class="title">abc</span></span><br><span class="line">   &#123;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">func</span>()</span></span><br><span class="line">      &#123;</span><br><span class="line">         Console.WriteLine(<span class="string">&quot;Inside first_space&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">second_space</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">class</span> <span class="title">efg</span></span><br><span class="line">   &#123;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">func</span>()</span></span><br><span class="line">      &#123;</span><br><span class="line">         Console.WriteLine(<span class="string">&quot;Inside second_space&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">class</span> <span class="title">TestClass</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">   &#123;</span><br><span class="line">      abc fc = <span class="keyword">new</span> abc();</span><br><span class="line">      efg sc = <span class="keyword">new</span> efg();</span><br><span class="line">      fc.func();</span><br><span class="line">      sc.func();</span><br><span class="line">      Console.ReadKey();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åµŒå¥—å‘½åç©ºé—´">åµŒå¥—å‘½åç©ºé—´</h2><p>å‘½åç©ºé—´å¯ä»¥è¢«åµŒå¥—ï¼Œå³æ‚¨å¯ä»¥åœ¨ä¸€ä¸ªå‘½åç©ºé—´å†…å®šä¹‰å¦ä¸€ä¸ªå‘½åç©ºé—´ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">namespace_name1</span> </span><br><span class="line">&#123;</span><br><span class="line">   <span class="comment">// ä»£ç å£°æ˜</span></span><br><span class="line">   <span class="keyword">namespace</span> <span class="title">namespace_name2</span> </span><br><span class="line">   &#123;</span><br><span class="line">     <span class="comment">// ä»£ç å£°æ˜</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨ç‚¹ï¼ˆ.ï¼‰è¿ç®—ç¬¦è®¿é—®åµŒå¥—çš„å‘½åç©ºé—´çš„æˆå‘˜ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> SomeNameSpace;</span><br><span class="line"><span class="keyword">using</span> SomeNameSpace.Nested;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">SomeNameSpace</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyClass</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;In SomeNameSpace&quot;</span>);</span><br><span class="line">            Nested.NestedNameSpaceClass.SayHello();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†…åµŒå‘½åç©ºé—´</span></span><br><span class="line">    <span class="keyword">namespace</span> <span class="title">Nested</span>  </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">NestedNameSpaceClass</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SayHello</span>()</span></span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">&quot;In Nested&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ä¸Šé¢çš„ä»£ç è¢«ç¼–è¯‘å’Œæ‰§è¡Œæ—¶ï¼Œå®ƒä¼šäº§ç”Ÿä¸‹åˆ—ç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In SomeNameSpace</span><br><span class="line">In Nested</span><br></pre></td></tr></table></figure><p>åœ¨å¹³æ—¶çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°è¿™æ ·çš„å‘½åç©ºé—´å†™æ³•ï¼š<code>namespace View.Effect.Pfx</code>ï¼Œ<strong>è¿™ä»æ¦‚å¿µä¸Šæ¥è®²å¹¶ä¸å±äºåµŒå¥—å‘½åç©ºé—´</strong>ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨ä¸Šæ¥è®²è¿™å’ŒåµŒå¥—å‘½åç©ºé—´çš„ä½¿ç”¨æ˜¯æ²¡æœ‰åŒºåˆ«çš„ã€‚</p><h1>namespaceåœ¨ä½¿ç”¨ä¸­é‡åˆ°çš„ç–‘æƒ‘</h1><h2 id="èƒŒæ™¯">èƒŒæ™¯</h2><p>æˆ‘åœ¨ä½¿ç”¨<code>C++</code>çš„æ—¶å€™å°±å¯¹<code>namespace</code>çš„ç†è§£ååˆ†æ¬ ç¼ºã€‚è€Œåˆ°äº†C#ä¸­ï¼Œæˆ‘å‘ç°namespaceçš„ä½œç”¨ç›¸è¾ƒäº<code>C++</code>å¥½åƒå‘ç”Ÿäº†å˜åŒ–ï¼Œæˆ‘å°†é€šè¿‡ä¸‹é¢è¿™ä¸ªåœºæ™¯æ¥æè¿°æˆ‘çš„ç–‘æƒ‘ï¼šæˆ‘ç°åœ¨åˆ›å»ºäº†ä¸¤ä¸ªè„šæœ¬åˆ†åˆ«ä¸ºè„šæœ¬Aå’Œè„šæœ¬Bï¼Œåœ¨è¿™ä¸¤ä¸ªè„šæœ¬ä¸­åˆ†åˆ«å®šä¹‰äº†ç±»Aå’Œç±»Bï¼Œæˆ‘ä»¬è¦åœ¨è„šæœ¬Bä¸­å®šä½å¹¶ä½¿ç”¨è„šæœ¬Aä¸­çš„ç±»Aã€‚</p><h2 id="C-å’ŒC-å®šä½å¹¶è¯†åˆ«ä¸åŒè„šæœ¬ä¸­ç±»çš„æ–¹å¼">C++å’ŒC#å®šä½å¹¶è¯†åˆ«ä¸åŒè„šæœ¬ä¸­ç±»çš„æ–¹å¼</h2><p>å¯¹äºC#æ¥è®²ï¼Œåœ¨ç±»Bä¸­è®¿é—®ç±»Açš„å…³é”®æ˜¯ç¡®ä¿C#ç¼–è¯‘å™¨èƒ½å¤Ÿæ‰¾åˆ°å¹¶è¯†åˆ«ç±»Aï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li>ç¡®ä¿æºä»£ç æ–‡ä»¶åŒ…å«å…¬å¼€å®šä¹‰çš„ç±»Aã€‚å¦‚æœç±»Aä¸æ˜¯å…¬å…±publicç±»å‹ï¼ŒæŒ‰ç…§è®¿é—®ä¿®é¥°ç¬¦çš„è§„å®šï¼Œç±»Bå¯èƒ½æ— æ³•è·å–ç±»Aï¼Œæ‰€ä»¥åº”è¯¥å°†ç±»Aè®¾ç½®ä¸ºpublicã€‚</li><li>å¦‚æœç±»Bå’Œç±»Aä½äºåŒä¸€ä¸ª<code>å‘½åç©ºé—´</code>ï¼Œå®ƒä»¬åº”è¯¥èƒ½å¤Ÿç›¸äº’è®¿é—®ï¼Œæ— éœ€é¢å¤–çš„æ“ä½œã€‚</li><li>å¦‚æœç±»Aå’Œç±»Bä½äºä¸åŒçš„å‘½åç©ºé—´ï¼Œåˆ™éœ€è¦åœ¨ç±»Bçš„æºæ–‡ä»¶é¡¶éƒ¨ä½¿ç”¨usingè¯­å¥å¯¼å…¥ç±»Aæ‰€åœ¨çš„å‘½åç©ºé—´</li><li><strong>å¦‚æœç±»Aæ²¡æœ‰åˆ¶å®šå‘½åç©ºé—´ï¼Œé‚£ä¹ˆå®ƒå±äºå…¨å±€å‘½åç©ºé—´ï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ç±»Bä¸­ä½¿ç”¨ç±»Aï¼Œè€Œæ— éœ€é¢å¤–çš„<code>using</code>è¯­å¥ï¼Œå½“ç„¶åœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¸ºç±»å®šä¹‰åˆé€‚çš„å‘½åç©ºé—´æ¥å®ç°æ›´å¥½çš„ä»£ç ç»„ç»‡ã€é¿å…åç§°å†²çªï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚åªæœ‰åœ¨æå°‘æ•°çš„ç‰¹å®šåœºæ™¯ä¸‹æ‰è€ƒè™‘å°†ç±»æ”¾å…¥å…¨å±€å‘½åç©ºé—´ã€‚</strong></li><li>å¦‚æœç±»Aå’Œç±»Bä½äºä¸åŒçš„é¡¹ç›®/ç¨‹åºé›†ä¸­ï¼Œæ¯”å¦‚Unityçš„æ’ä»¶ï¼Œè¦ç¡®ä¿æ­£ç¡®åœ°å¼•ç”¨äº†åŒ…å«ç±»Açš„ç¨‹åºé›†ã€‚åœ¨Unityç¼–è¾‘å™¨ä¸­ï¼Œå¯ä»¥å°†åŒ…å«ç±»Açš„DLLæ‹–æ”¾è‡³Assetç›®å½•ï¼Œç„¶åUnityä¼šè‡ªåŠ¨å¤„ç†å¼•ç”¨å…³ç³»ã€‚è€Œåœ¨æ™®é€šçš„C#ä¸­ï¼Œå¯ä»¥é€šè¿‡Visual Studioç­‰IDEæ·»åŠ å¯¹åº”çš„<code>.dll</code>æ–‡ä»¶ä½œä¸ºå¼•ç”¨ã€‚</li></ol><p>å¯¹äºC++æ¥è®²ï¼Œåœ¨ç±»Bä¸­èƒ½å¤Ÿæ‰¾åˆ°å¹¶ä½¿ç”¨ç±»Aæ¶‰åŠä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li>å£°æ˜ï¼šç¡®ä¿ç±»Aåœ¨å¯¹åº”çš„å¤´æ–‡ä»¶ä¸­å…¬å¼€å£°æ˜</li><li><strong>å¼•ç”¨ï¼šåœ¨ç±»Bæ‰€åœ¨çš„å¤´æ–‡ä»¶çš„é¡¶éƒ¨åŒ…å«ç±»Açš„å¤´æ–‡ä»¶ï¼Œè¿™é‡Œè¦æ³¨æ„ä½¿ç”¨æ­£ç¡®çš„æ–‡ä»¶è·¯å¾„å’Œæ–‡ä»¶å</strong></li><li>è®¿é—®<ul><li>é™æ€æˆå‘˜ï¼šé€šè¿‡<code>ç±»å::æˆå‘˜</code>çš„æ–¹å¼ç›´æ¥è®¿é—®é™æ€æˆå‘˜</li><li>éé™æ€æˆå‘˜ï¼šåˆ›å»ºä¸€ä¸ªç±»Açš„å¯¹è±¡å®ä¾‹ï¼Œç„¶åä½¿ç”¨<code>ç±»å.æˆå‘˜</code>è®¿é—®éé™æ€æˆå‘˜ï¼Œå¦‚æœæ˜¯æŒ‡é’ˆï¼Œåˆ™ä½¿ç”¨<code>-&gt;</code></li></ul></li><li>å¦‚æœç±»Bå’Œç±»Aä½äºä¸åŒçš„é¡¹ç›®ï¼Œéœ€è¦ç¡®ä¿æ­£ç¡®åœ°æ„å»ºå’Œé“¾æ¥å®ƒä»¬ï¼Œä¾‹å¦‚ï¼Œå°†é¡¹ç›®Aæ„å»ºä¸ºé™æ€åº“æˆ–åŠ¨æ€åº“ï¼ˆ<code>.lib</code>æˆ–<code>.dll</code>ï¼‰ï¼Œç„¶åå°†å…¶æ·»åŠ åˆ°é¡¹ç›®Bçš„é“¾æ¥å™¨è¾“å…¥ä¸­ã€‚æ­¤å¤–ï¼Œåˆ«å¿˜äº†åœ¨ç±»Bä¸­åŒ…å«ç±»Aæ‰€åœ¨çš„å¤´æ–‡ä»¶ã€‚</li></ol><p>æ‰€ä»¥C++å’ŒC#åœ¨ç±»Bå¦‚ä½•æ‰¾åˆ°å¹¶ä½¿ç”¨ç±»Açš„è¿‡ç¨‹ä¸­æœ‰ä¸€å®šçš„ç›¸ä¼¼æ€§ï¼Œå°½ç®¡å®ƒä»¬åˆ†åˆ«å±äºä¸åŒçš„ç¼–ç¨‹èŒƒå¼ã€‚ä¸‹é¢æ˜¯ä¸€äº›ä¸»è¦çš„åŒºåˆ«</p><ol><li>æ–‡ä»¶åŒ…å«ï¼š<ul><li>C++éœ€è¦ä½¿ç”¨<code>include</code>è¯­å¥åœ¨å¤´æ–‡ä»¶ä¸­åŒ…å«å¯¹åº”çš„å¤´æ–‡ä»¶ï¼Œè¿™å°±æ˜¯åœ¨ç¼–è¯‘æ—¶ï¼Œå°†ç±»Açš„å£°æ˜å¼•å…¥åˆ°ç±»Bçš„å¤´æ–‡ä»¶ä¸­ã€‚</li><li><strong>C#éœ€è¦ä½¿ç”¨<code>using</code>è¯­å¥æŒ‡å®šæŸä¸ªå‘½åç©ºé—´ï¼Œå¦‚æœç±»Aå’Œç±»Bä¸åœ¨åŒä¸€ä¸ªå‘½åç©ºé—´çš„è¯ï¼Œè€Œä¸éœ€è¦æŒ‡å®šå…·ä½“çš„æ–‡ä»¶åï¼ŒC#ä¼šåœ¨é¡¹ç›®èŒƒå›´å†…è‡ªåŠ¨å¤„ç†ç›¸å…³ç±»å‹çš„å¼•ç”¨</strong></li></ul></li><li>å¼•ç”¨è¯­æ³•<ul><li>C++ï¼šç±»æˆå‘˜çš„è®¿é—®è¯­æ³•æ˜¯<code>å¯¹è±¡å.æˆå‘˜</code>æˆ–è€…<code>å¯¹è±¡æŒ‡é’ˆ-&gt;æˆå‘˜</code></li><li>C#ï¼šç±»æˆå‘˜è®¿é—®è¯­æ³•ä¹Ÿæ˜¯<code>å¯¹è±¡å.æˆå‘˜</code>ï¼Œå®é™…ä¸Šä¸åŒºåˆ†å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹</li></ul></li><li>ç¼–è¯‘å’Œé“¾æ¥æ–¹å¼ï¼š<ul><li>C++ï¼šç¼–è¯‘å™¨éœ€è¦åœ¨ç¼–è¯‘é˜¶æ®µå¤„ç†åŒ…å«å…³ç³»ï¼Œæ¯ä¸ªæºæ–‡ä»¶åœ¨è¢«ç¼–è¯‘å‰é€šè¿‡é¢„å¤„ç†å™¨å°†ç›¸å…³æ–‡ä»¶å±•å¼€ã€åˆå¹¶ï¼Œç„¶åå½¢æˆå•ç‹¬çš„ç›®æ ‡æ–‡ä»¶ã€‚åœ¨é“¾æ¥é˜¶æ®µï¼Œå†å°†æ‰€æœ‰ç›®æ ‡æ–‡ä»¶ä»¥åŠç¬¬ä¸‰æ–¹åº“è¿›è¡Œé“¾æ¥ç”Ÿæˆå¯æ‰§è¡Œç¨‹åºã€‚</li><li><strong>C#ï¼šåŸºäº<code>.NET</code>å¹³å°ï¼Œæºä»£ç åœ¨ä¸€å¼€å§‹è¢«ç¼–è¯‘æˆä¸­é—´è¯­è¨€ï¼Œè€Œå„è‡ªçš„ç±»åˆ†åˆ«ä¿å­˜åœ¨å®ƒä»¬è‡ªå·±çš„æ–‡ä»¶ä¸­ï¼Œåœ¨è¿è¡Œæ—¶ï¼ŒILä¼šé€šè¿‡å³æ—¶ç¼–è¯‘å˜ä¸ºæœ¬åœ°æœºå™¨ç ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œç›¸å…³ç±»å‹ä¹‹é—´çš„å¼•ç”¨åœ¨è¿è¡Œæ—¶è¿›è¡Œè§£æã€‚</strong></li></ul></li></ol><p>å…¶å®æˆ‘ä»¬æƒ³è¦åœ¨ç±»Bä¸­è®¿é—®ç±»Açš„æ–¹æ³•æˆ–è€…å˜é‡ï¼Œä¸å‘½åç©ºé—´çš„å…³ç³»ä¸å¤§ã€‚å…³é”®æ˜¯ä½¿ç”¨æ­£ç¡®çš„è®¿é—®ä¿®é¥°ç¬¦ä»¥åŠåˆé€‚åœ°ä½¿ç”¨å¯¹è±¡æˆ–è€…å¼•ç”¨ã€‚</p><p>æœ‰ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š</p><ol><li>è®¿é—®é™æ€æˆå‘˜ï¼Œå¦‚æœç±»Aä¸­æœ‰ä¸€ä¸ªé™æ€æ–¹æ³•æˆ–æˆ–é™æ€å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ç±»ååŠ ä¸Šæˆå‘˜åè¿›è¡Œè®¿é—®</li><li>è®¿é—®éé™æ€æˆå‘˜ï¼šå¯¹äºéé™æ€æˆå‘˜ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç±»Açš„å¯¹è±¡å®ä¾‹ï¼Œç„¶åé€šè¿‡è¯¥å®ä¾‹å¼•ç”¨å¯¹åº”çš„æ–¹æ³•å’Œå˜é‡ã€‚ç¡®ä¿è¿™äº›æ–¹æ³•å’Œå˜é‡å—åˆ°é€‚å½“çš„è®¿é—®ä¿®é¥°ç¬¦ä¿æŠ¤ã€‚</li></ol><p>ä¸è¿‡å‘½åç©ºé—´å¯èƒ½ä¼šå½±å“ä¸Šè¿°è¿‡ç¨‹ï¼Œå¦‚æœç±»Aå’Œç±»Bä½äºåŒä¸€ä¸ªå‘½åç©ºé—´ï¼Œåˆ™æ— éœ€ç‰¹åˆ«å£°æ˜ï¼›ä½†æ˜¯å¦‚æœå®ƒä»¬ä½äºä¸åŒçš„å‘½åç©ºé—´ï¼Œé‚£ä¹ˆåœ¨ç±»Bçš„æ–‡ä»¶é¡¶éƒ¨éœ€è¦æ·»åŠ <code>using</code>è¯­å¥æ¥å¼•ç”¨ç±»Aæ‰€åœ¨çš„å‘½åç©ºé—´ã€‚æ‰€ä»¥ï¼Œç†è§£è®¿é—®ä¿®é¥°ç¬¦å¦‚ä½•ä¸å¯¹è±¡æˆ–å¼•ç”¨ç›¸ç»“åˆæ˜¯ä½¿ç”¨çš„å…³é”®ã€‚åŒæ—¶ï¼Œç¡®ä¿åœ¨è·¨å‘½åç©ºé—´è®¿é—®æ—¶èƒ½æ­£ç¡®åœ°ä½¿ç”¨usingè¯­å¥ã€‚</p><p>æ€»ç»“ï¼šC++å’ŒC#åœ¨ç±»Bå®šä½å¹¶ä½¿ç”¨ç±»Açš„åŸºæœ¬æ¦‚å¿µç›¸ä¼¼ï¼Œéƒ½éœ€è¦å…ˆå¯¼å…¥å£°æ˜ï¼Œç„¶ååœ¨å…¶ä»–ç±»ä¸­ä½¿ç”¨ã€‚ä¸»è¦çš„ä¸åŒç‚¹åœ¨äºåŒ…å«/å¯¼å…¥æ–¹å¼ã€è®¿é—®è¯­æ³•ä»¥åŠç¼–è¯‘é“¾æ¥æ€è·¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IEnumeratorä¸IEnumerableç†è§£ä¸è¾¨æ</title>
      <link href="/posts/133a9667/"/>
      <url>/posts/133a9667/</url>
      
        <content type="html"><![CDATA[<h1>IEnumeratoræ›´å¹¿é˜”çš„å¤©åœ°</h1><p>ç¼–å†™çš„å‡ ä¹æ‰€æœ‰ç¨‹åºéƒ½éœ€è¦å¾ªç¯è®¿é—®é›†åˆï¼Œå› æ­¤éœ€è¦ç¼–å†™ä»£ç æ¥æ£€æŸ¥é›†åˆä¸­çš„æ¯ä¸€é¡¹ã€‚</p><p>è¿­ä»£å™¨å¯ä»¥è¯»å–é›†åˆä¸­çš„æ•°æ®ï¼Œä½†æ˜¯ä¸èƒ½ä»åº•å±‚ä¿®æ”¹é›†åˆï¼Œå› ä¸ºè¿­ä»£å™¨çš„å®ç°æ–¹æ³•ä¸­åªå®ç°äº†Getæ–¹æ³•ï¼Œæ‰€ä»¥ä¸èƒ½å¯¹é›†åˆä¸­çš„æ•°æ®è¿›è¡Œä¿®æ”¹</p><p>è¯­æ³•ç³–ï¼šè®¡ç®—æœºä¸­æ·»åŠ æŸç§è¯­æ³•ï¼Œè¿™ç§è¯­æ³•å¯¹è¯­è¨€åŠŸèƒ½æ²¡æœ‰å½±å“ï¼Œä½†æ˜¯æ›´æ–¹ä¾¿ç¨‹åºå‘˜ä½¿ç”¨ï¼Œè¯­æ³•ç³–è®©ä»£ç æ›´åŠ ç®€æ´ï¼Œæœ‰æ›´é«˜çš„å¯è¯»æ€§</p><h1>åŸºæœ¬æ¦‚å¿µ</h1><p>åç¨‹ï¼ˆCoroutineï¼‰ï¼šååŒç¨‹åºï¼Œåœ¨ä¸»ç¨‹åºè¿è¡Œçš„åŒæ—¶ï¼Œå¼€å¯å¦å¤–ä¸€æ®µé€»è¾‘å¤„ç†ï¼Œæ¥ååŒå½“å‰ç¨‹åºçš„æ‰§è¡Œã€‚Unityçš„åç¨‹ç³»ç»Ÿæ˜¯åŸºäºC#çš„ä¸€ä¸ªç®€å•è€Œå¼ºå¤§çš„æ¥å£â€”â€”è¿­ä»£å™¨ï¼ˆIEnumeratorï¼‰ï¼Œåç¨‹å¹¶ä¸æ˜¯å¤šçº¿ç¨‹çš„ï¼Œåªæ˜¯è¿è¡Œçš„ç»“æœå¾ˆåƒå¤šçº¿ç¨‹è€Œå·²ã€‚å®ƒä»¬æœ€å¤§çš„åŒºåˆ«å°±æ˜¯å¤šçº¿ç¨‹å¯ä»¥å¤šæ ¸å¹¶å‘ï¼Œä½†æ˜¯åç¨‹åªèƒ½æ˜¯å•æ ¸æŒ‰å¸§é¡ºåºè½®è½¬ï¼Œçº¿ç¨‹å¯ä»¥ä½¿ç”¨å¤šä¸ªCPUï¼Œåç¨‹ä¸èƒ½ï¼Œæ‰€ä»¥çº¿ç¨‹æ˜¯çœŸçš„å¹¶è¡Œã€‚åç¨‹æ˜¯åœ¨Unityä¸»çº¿ç¨‹ä¸­è¿è¡Œçš„ï¼Œæ¯ä¸€å¸§ä¸­å¤„ç†ä¸€æ¬¡ï¼Œè€Œå¹¶ä¸ä¸ä¸»çº¿ç¨‹å¹¶è¡Œã€‚è¿™å°±æ„å‘³ç€åœ¨åç¨‹ä¹‹é—´ä¸å­˜åœ¨ç€æ‰€è°“çš„çº¿ç¨‹é—´çš„åŒæ­¥å’Œäº’æ–¥é—®é¢˜ï¼Œè®¿é—®åŒä¸€ä¸ªå€¼ä¹Ÿéƒ½æ˜¯å®‰å…¨çš„ï¼Œä¸ä¼šå‡ºç°æ­»é”ã€‚</p><h1>åç¨‹çš„ç”¨æ³•ï¼š</h1><h2 id="å¼€å¯åç¨‹ï¼š">å¼€å¯åç¨‹ï¼š</h2><p>å¼€å¯åç¨‹çš„ä¸¤ç§æ–¹å¼ï¼š</p><ul><li><code>StartCoroutine(string methodName)</code>ã€‚å‚æ•°æ˜¯æ–¹æ³•åï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼‰ï¼›æ­¤æ–¹æ³•å¯ä»¥åŒ…å«ä¸€ä¸ªå‚æ•°ï¼Œå½¢å‚æ–¹æ³•å¯ä»¥æœ‰è¿”å›å€¼</li><li><code>StartCoroutine(IEnumerator method)</code>ã€‚å‚æ•°æ˜¯æ–¹æ³•å(TestMethod())ï¼Œæ–¹æ³•ä¸­å¯ä»¥åŒ…å«å¤šä¸ªå‚æ•°ï¼›IEnumeratorç±»å‹çš„æ–¹æ³•ä¸èƒ½å«æœ‰refæˆ–è€…outç±»å‹çš„å‚æ•°ï¼Œä½†æ˜¯å¯ä»¥å«æœ‰è¢«ä¼ é€’çš„å¼•ç”¨ï¼›å¿…é¡»è¦æœ‰è¿”å›å€¼ï¼Œå¹¶ä¸”è¿”å›å€¼çš„ç±»å‹ä¸ºIEnumeratorï¼Œè¿”å›å€¼ä½¿ç”¨<code>yield return expression</code>æˆ–è€…<code>yield return value</code>ï¼Œæˆ–è€…<code>yield break</code>è¯­å¥ã€‚</li></ul><h2 id="ç»ˆæ­¢åç¨‹">ç»ˆæ­¢åç¨‹</h2><p>ç»ˆæ­¢åç¨‹çš„ä¸¤ç§æ–¹å¼</p><ul><li><code>StopCoroutine(string methodName)</code>ï¼Œåªèƒ½ç»ˆæ­¢åˆ¶å®šçš„åç¨‹ï¼Œåœ¨ç¨‹åºä¸­è°ƒç”¨StopCoroutine()æ–¹æ³•åªèƒ½ç»ˆæ­¢ä»¥å­—ç¬¦ä¸²å½¢å¼å¯åŠ¨çš„åç¨‹ã€‚</li><li><code>StopAllCoroutine()</code>ï¼Œç»ˆæ­¢æ‰€æœ‰åç¨‹</li></ul><p>æŒ‚èµ·</p><ul><li><code>yield</code>ï¼šæŒ‚èµ·ï¼Œç¨‹åºé‡åˆ°<code>yield</code>å…³é”®å­—çš„æ—¶å€™ä¼šè¢«æŒ‚èµ·ï¼Œæš‚åœæ‰§è¡Œï¼Œç­‰å¾…æ¡ä»¶æ»¡è¶³çš„æ—¶å€™ä»å½“å‰ä½ç½®ç»§ç»­æ‰§è¡Œ</li><li><code>yield return 0</code> or <code>yield return null</code>ï¼šç¨‹åºåœ¨ä¸‹ä¸€å¸§ä¸­ä»å½“å‰ä½ç½®ç»§ç»­æ‰§è¡Œ</li><li><code>yield return 1,2,3...</code>ï¼šç­‰å¾…ç¨‹åº1ï¼Œ2ï¼Œ3â€¦å¸§ä¹‹åä»å½“å‰ä½ç½®ç»§ç»­æ‰§è¡Œ</li><li><code>yield return new WaitForSeconds(n)</code>:ç¨‹åºç­‰å¾…nç§’ä¹‹åä»å½“å‰ä½ç½®ç»§ç»­æ‰§è¡Œ</li><li><code>yield new WaitForEndOfFrame()</code>ï¼šåœ¨æ‰€æœ‰çš„æ¸²æŸ“ä»¥åŠGUIç¨‹åºæ‰§è¡Œå®Œæˆåä»å½“å‰ä½ç½®ç»§ç»­æ‰§è¡Œ</li><li><code>yield new WaitForFixedUpdate()</code>ï¼šæ‰€æœ‰è„šæœ¬ä¸­FixedUpdate()å‡½æ•°éƒ½è¢«æ‰§è¡Œåä»å½“å‰ä½ç½®ç»§ç»­æ‰§è¡Œ</li><li><code>yield return WWW</code>ï¼šç­‰å¾…ä¸€ä¸ªåç¨‹æ‰§è¡Œå®Œæˆåä»å½“å‰ä½ç½®ç»§ç»­æ‰§è¡Œ</li><li><code>yield return SatrtCoroutine()</code>ï¼šç­‰å¾…ä¸€ä¸ªåç¨‹æ‰§è¡Œå®Œæˆåä»å½“å‰ä½ç½®ç»§ç»­æ‰§è¡Œ</li><li><code>yield break</code>ï¼šå°†ä¼šå¯¼è‡´åç¨‹çš„æ‰§è¡Œæ¡ä»¶ä¸è¢«æ»¡è¶³ï¼Œä¸ä¼šä»å½“å‰çš„ä½ç½®ç»§ç»­æ‰§è¡Œç¨‹åºï¼Œè€Œæ˜¯ç›´æ¥ä»å½“å‰ä½ç½®è·³å‡ºå‡½æ•°ä½“å›åˆ°å‡½æ•°çš„æ ¹éƒ¨</li></ul><h1>åç¨‹çš„æ‰§è¡ŒåŸç†</h1><p>åç¨‹å‡½æ•°çš„è¿”å›å€¼æ˜¯IEnumeratorï¼Œå®ƒæ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œå¯ä»¥æŠŠå®ƒå½“æˆæ‰§è¡Œä¸€ä¸ªåºåˆ—çš„æŸä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå®ƒæä¾›äº†ä¸¤ä¸ªé‡è¦çš„æ¥å£ï¼Œåˆ†åˆ«æ˜¯<code>Current</code>(è¿”å›æŒ‡å‘å½“å‰çš„å…ƒç´ )å’Œ<code>MoveNext</code>ï¼ˆå°†æŒ‡é’ˆå‘åç§»åŠ¨ä¸€ä¸ªå•ä½ï¼Œå¦‚æœç§»åŠ¨æˆåŠŸï¼Œåˆ™è¿”å›<code>true</code>ï¼‰</p><p>yieldå…³é”®å­—ç”¨æ¥å£°æ˜åºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå€¼æˆ–è€…æ˜¯ä¸€ä¸ªæ— æ„ä¹‰çš„å€¼ï¼Œå¦‚æœç”¨<code>yield return x</code>ï¼ˆxæŒ‡çš„æ˜¯ä¸€ä¸ªå…·ä½“çš„å¯¹è±¡æˆ–è€…æ•°å€¼ï¼‰çš„è¯ï¼Œé‚£ä¹ˆMoveNextè¿”å›ä¸ºtrueå¹¶ä¸”Currentè¢«èµ‹å€¼ä¸ºxï¼Œå¦‚æœä½¿ç”¨<code>yield break</code>ä½¿å¾—<code>MoveNext</code>è¿”å›ä¸º<code>false</code></p><p>å¦‚æœ<code>MoveNext</code>å‡½æ•°è¿”å›ä¸º<code>true</code>å°±æ„å‘³ç€åç¨‹çš„æ‰§è¡Œæ¡ä»¶è¢«æ»¡è¶³ï¼Œåˆ™èƒ½å¤Ÿä»å½“å‰ä½ç½®ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œå¦åˆ™ä¸èƒ½ä»å½“å‰ä½ç½®ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚</p><h1>ç†è§£åç¨‹çš„æœ¬è´¨</h1><p>æˆ‘ä»¬éƒ½è¯´åç¨‹çš„æœ¬è´¨æ˜¯è¿­ä»£å™¨ï¼Œæˆ‘åœ¨ä¹‹å‰çš„åšå®¢ä¸­ä¹Ÿå¯¹è¿­ä»£å™¨(IEnumerator)æœ‰è¿‡è¯¦ç»†çš„ä»‹ç»äº†ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯æ²¡æœ‰åŠæ³•æŠŠåç¨‹å’Œè¿­ä»£å™¨è”ç³»èµ·æ¥ï¼Œæˆ‘è®¤ä¸ºé—®é¢˜å‡ºåœ¨äº†æˆ‘å¯¹yieldå’Œforeachçš„ç†è§£ä¸Šäº†ï¼Œä¸‹é¢æˆ‘å°†å…ˆè¯•å›¾ç†è§£foreachå†…éƒ¨çš„å·¥ä½œåŸç†</p><h2 id="é›†åˆç±»çš„å…³é”®è¦ç´ ">é›†åˆç±»çš„å…³é”®è¦ç´ </h2><p>æ ¹æ®å®šä¹‰ï¼ŒMicrosoft .NET Frameworké›†åˆæ˜¯è‡³å°‘å¯ä»¥å®ç°<code>IEnumerable&lt;T&gt;</code>ï¼ˆæˆ–éæ³›å‹IEnumerableç±»å‹ï¼‰çš„ç±»ï¼Œæ­¤æ¥å£è‡³å…³é‡è¦ï¼Œå› ä¸ºè‡³å°‘å¿…é¡»å®ç°<code>IEnumerable&lt;T&gt;</code>çš„æ–¹æ³•ï¼Œæ‰æ”¯æŒè¿­ä»£é›†åˆã€‚</p><p>foreachè¯­æ³•ååˆ†ç®€å•ï¼Œå¼€å‘è€…æ— éœ€çŸ¥é“å…ƒç´ æ•°é‡ï¼Œé¿å…ç¼–ç è¿‡äºå¤æ‚ã€‚ä¸è¿‡ï¼Œè¿è¡Œæ—¶<code>Runtime</code>ä¸ç›´æ¥æ”¯æŒforeachè¯­å¥ã€‚C#ç¼–è¯‘å™¨ä¼šè½¬æ¢ä»£ç ï¼Œæ¥ä¸‹æ¥ä¼šå¯¹æ­¤éƒ¨åˆ†è¿›è¡Œä»‹ç»ï¼š</p><p>foreachå’Œæ•°ç»„ï¼šä¸‹é¢å±•ç¤ºäº†ç®€å•çš„foreachå¾ªç¯ï¼Œç”¨äºè¿­ä»£æ•´æ•°æ•°ç»„ï¼Œç„¶åå°†æ¯ä¸ªæ•´æ•°æ‰“å°è¾“å‡ºåˆ°æ§åˆ¶å°ä¸­ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span>[] array = <span class="keyword">new</span> <span class="built_in">int</span>[] &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="built_in">int</span> item <span class="keyword">in</span> array)&#123;</span><br><span class="line">Console.WriteLine(item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ­¤ä»£ç ä¸­ï¼ŒC#ç¼–è¾‘å™¨ä¸ºforå¾ªç¯åˆ›å»ºäº†ç­‰åŒçš„<code>CIL</code>ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span>[] tempArray;</span><br><span class="line"><span class="built_in">int</span>[] array = <span class="keyword">new</span> <span class="built_in">int</span>[]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;;</span><br><span class="line">tempArray = array;</span><br><span class="line"><span class="keyword">for</span>(<span class="built_in">int</span> counter = <span class="number">0</span>;(counter &lt; tempArray.Length); counter++)&#123;</span><br><span class="line"><span class="built_in">int</span> item = tempArray[counter];</span><br><span class="line">Console.WriteLine(item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¯·æ³¨æ„ï¼Œforeachä¾èµ–å¯¹Lengthå±æ€§å’Œç´¢å¼•è¿ç®—ç¬¦<code>[]</code>çš„æ”¯æŒã€‚å€ŸåŠ©Lengthå±æ€§ï¼ŒC#ç¼–è¯‘å™¨å¯ä»¥ä½¿ç”¨forè¯­å¥è¿­ä»£æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚</p><p><code>foreach</code>å’Œ<code>IEnumerable&lt;T&gt;</code>é›†åˆï¼šè™½ç„¶å‰é¢çš„ä»£ç é€‚ç”¨äºé•¿åº¦å›ºå®šä¸”å§‹ç»ˆæ”¯æŒç´¢å¼•è¿ç®—ç¬¦çš„æ•°ç»„ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰ç±»å‹é›†åˆçš„å…ƒç´ æ•°é‡éƒ½æ˜¯å·²çŸ¥çš„ã€‚æ­¤å¤–ï¼Œè®¸å¤šé›†åˆç±»ï¼ˆåŒ…æ‹¬<code>Stack&lt;T&gt;</code>ã€<code>Queue&lt;T&gt;</code>å’Œ<code>Dictionary&lt;TKey and TValue&gt;</code>ï¼‰éƒ½ä¸æ”¯æŒæŒ‰ç´¢å¼•æ£€ç´¢å…ƒç´ ã€‚å› æ­¤ï¼Œéœ€è¦ä½¿ç”¨ä¸€ç§æ›´ä¸ºé€šç”¨çš„æ–¹æ³•æ¥è¿­ä»£å…ƒç´ é›†åˆã€‚è¿­ä»£å™¨æ¨¡å¼å°±æ´¾ä¸Šç”¨åœºäº†ï¼ˆè¿­ä»£å™¨æ¨¡å¼åœ¨<a href="http://soincredible777.com.cn/posts/279644bd/">è¿™ç¯‡åšå®¢</a>ä¸­æœ‰ä»‹ç»ï¼‰ã€‚å‡è®¾å¯ä»¥ç¡®å®šç¬¬ä¸€ä¸ªã€ç¬¬äºŒä¸ªå’Œæœ€åä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰å¿…è¦çŸ¥é“å…ƒç´ çš„æ•°é‡ï¼Œä¹Ÿå°±æ²¡æœ‰å¿…è¦æ”¯æŒæŒ‰ç´¢å¼•æ£€ç´¢å…ƒç´ ã€‚</p><p><code>System.Collections.Generic.IEnumerator&lt;T&gt;</code>å’Œéæ³›å‹<code>System.Collections.IEnumerator</code>æ¥å£æ—¨åœ¨å¯ç”¨è¿­ä»£å™¨æ¨¡å¼ï¼ˆè€Œä¸æ˜¯å‰é¢ä»‹ç»çš„é•¿åº¦ç´¢å¼•æ¨¡å¼ï¼‰æ¥è¿­ä»£å…ƒç´ é›†åˆã€‚å®ƒä»¬çš„å…³ç³»ç±»å›¾å¦‚ä¸‹ï¼š</p><p><code>IEnumerator&lt;T&gt;</code>æ´¾ç”Ÿè‡ªIEnumeratoråŒ…å«ä¸‰ä¸ªæˆå‘˜ã€‚ç¬¬ä¸€ä¸ªæˆå‘˜æ˜¯å¸ƒå°”å‹MoveNextã€‚ä½¿ç”¨åˆ™ä¸­æ–¹æ³•ï¼Œå¯ä»¥åœ¨é›†åˆä¸­ä»ä¸€ä¸ªå…ƒç´ ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ ï¼ŒåŒæ—¶æ£€æµ‹æ˜¯å¦å·²ç»æšä¸¾å®Œæ‰€æœ‰é¡¹ã€‚ç¬¬äºŒä¸ªæˆå‘˜æ˜¯åªè¯»å±æ€§Currentï¼Œç”¨äºè¿”å›å½“å‰å¤„ç†çš„å…ƒç´ ã€‚<code>Currentåœ¨IEnumerator&lt;T&gt;</code>ä¸­è¿›è¡Œé‡è½½ï¼Œæä¾›æŒ‰ç±»å‹åˆ†ç±»çš„å®ç°ä»£ç ã€‚å€ŸåŠ©é›†åˆç±»ä¸­çš„è¿™ä¸¤ä¸ªæˆå‘˜ï¼Œåªéœ€è¦ä½¿ç”¨whileå¾ªç¯ï¼Œå³å¯è¿­ä»£é›†åˆï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">System.Collections.Generic.Stack&lt;<span class="built_in">int</span>&gt; stack = <span class="keyword">new</span> System.Collections.Generic.Stack&lt;<span class="built_in">int</span>&gt;();</span><br><span class="line"><span class="built_in">int</span> number;</span><br><span class="line"><span class="keyword">while</span>(stack.MoveNext())&#123;</span><br><span class="line">  number = stack.Current;</span><br><span class="line">  Console.WriteLine(number);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ­¤ä»£ç ä¸­ï¼Œå½“ç§»åˆ°é›†åˆçš„æœ«å°¾æ—¶ï¼ŒMoveNextæ–¹æ³•è¿”å›falseã€‚è¿™æ ·ä¸€æ¥ï¼Œä¾¿æ— éœ€åœ¨å¾ªç¯çš„åŒæ—¶è®¡ç®—å…ƒç´ çš„æ•°é‡ã€‚</p><p>ï¼ˆResetæ–¹æ³•é€šå¸¸ä¼šæŠ›å‡ºNotImplementedExceptionï¼Œå› æ­¤ä¸å¾—è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœéœ€è¦é‡æ–°å¼€å§‹è¿›è¡Œæšä¸¾ï¼Œåªéœ€è¦æ–°å»ºä¸€ä¸ªæšä¸¾å™¨å°±å¯ä»¥äº†ã€‚ï¼‰</p><p>å‰é¢çš„ç¤ºä¾‹å±•ç¤ºçš„æ˜¯C#ç¼–è¯‘å™¨è¾“å‡ºè¦ç‚¹ï¼Œä½†å®é™…ä¸Šå¹¶éæŒ‰æ­¤æ–¹å¼è¿›è¡Œç¼–è¯‘ï¼Œå› ä¸ºå…¶ä¸­ç•¥å»äº†ä¸¤ä¸ªé‡è¦çš„å®ç°ç»†èŠ‚ï¼šäº¤é”™å’Œé”™è¯¯å¤„ç†ã€‚</p><p>çŠ¶æ€ä¸ºå…±äº«ï¼šå‰é¢ç¤ºä¾‹ä¸­å±•ç¤ºçš„å®ç°ä»£ç å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå³å¦‚æœä¸¤ä¸ªæ­¤ç±»å¾ªç¯å½¼æ­¤äº¤é”™ï¼ˆä¸€ä¸ªforeachåœ¨å¦å¤–ä¸€ä¸ªå¾ªç¯å†…ï¼Œä¸¤ä¸ªå¾ªç¯ä½¿ç”¨ç›¸åŒçš„é›†åˆï¼‰ï¼Œé›†åˆå¿…é¡»å§‹ç»ˆæœ‰å½“å‰å…ƒç´ çš„çŠ¶æ€æŒ‡ç¤ºç¬¦ï¼Œä»¥ä¾¿åœ¨è°ƒç”¨MoveNextçš„æ—¶å€™ï¼Œå¯ä»¥ç¡®å®šä¸‹ä¸€ä¸ªå…ƒç´ ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œäº¤é”™çš„ä¸€ä¸ªå¾ªç¯å¯èƒ½ä¼šå½±å“å¦ä¸€ä¸ªå¾ªç¯ã€‚ï¼ˆå¯¹äºå¤šä¸ªçº¿ç¨‹æ‰§è¡Œçš„å¾ªç¯ä¹Ÿæ˜¯å¦‚æ­¤ï¼‰ã€‚</p><p>é€šè¿‡ä»£ç ç†è§£ä¸Šé¢è¯´çš„è¿™ä¸ªæƒ…å†µï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// stackæ˜¯æˆ‘ä»¬è¦éå†çš„é›†åˆï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥æ”¯æŒIEnumerator&lt;T&gt;è¿™ä¸ªæ¥å£ï¼Œé‚£æˆ‘ä»¬æ‰€åšçš„æ‰€æœ‰æ“ä½œå°†ä¼šç›´æ¥å½±å“é›†åˆçš„çŠ¶æ€</span></span><br><span class="line"><span class="comment">// æ¢ä¸ªè§’åº¦ç†è§£ï¼Œä»»ä½•è¦éå†è¿™ä¸ªé›†åˆçš„åœ°æ–¹éƒ½æ˜¯ç”¨åˆ°äº†åŒä¸€ä¸ªæšä¸¾å™¨ï¼Œæ‰€ä»¥åœ¨åµŒå¥—å¾ªç¯ä¸­ï¼ˆå¦‚ä¸‹ä»£ç ï¼‰ä¸€ä¸ªæšä¸¾ä¼šå½±å“åˆ°åˆ«çš„æšä¸¾</span></span><br><span class="line">System.Collections.Generic.Stack&lt;<span class="built_in">int</span>&gt; stack = <span class="keyword">new</span> System.Collections.Generic.Stack&lt;<span class="built_in">int</span>&gt;();</span><br><span class="line"><span class="built_in">int</span> number;</span><br><span class="line"><span class="keyword">while</span>(stack.MoveNext())&#123;</span><br><span class="line">  <span class="keyword">while</span>(stack.MoveNext)&#123;</span><br><span class="line">    number = stack.Current;</span><br><span class="line">    Console.WriteLine(number);</span><br><span class="line">  &#125;</span><br><span class="line">  number = stack.Current;</span><br><span class="line">  Console.WriteLine(number);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé›†åˆç±»ä¸ç›´æ¥æ”¯æŒ<code>IEnumerator&lt;T&gt;</code>å’ŒIEnumeratoræ¥å£ã€‚è€Œæ˜¯ç›´æ¥æ”¯æŒå¦ä¸€ç§æ¥å£<code>IEnumerable&lt;T&gt;</code>ï¼Œå…¶å”¯ä¸€çš„æ–¹æ³•æ˜¯<code>GetEnumerator</code>ã€‚æ­¤æ–¹æ³•ç”¨äºè¿”å›æ”¯æŒ<code>IEnumerator&lt;T&gt;</code>çš„å¯¹è±¡ã€‚ä¸å¿…ä½¿ç”¨å§‹ç»ˆæŒ‡ç¤ºçŠ¶æ€çš„é›†åˆç±»ï¼Œè€Œæ˜¯å¯ä»¥ä½¿ç”¨å¦ä¸€ç§ç±»ï¼Œé€šå¸¸ä¸ºåµŒå¥—ç±»ï¼Œè¿™æ ·ä¾¿æœ‰æƒè®¿é—®é›†åˆå†…éƒ¨ï¼Œä»è€Œæ”¯æŒ<code>IEnumerator&lt;T&gt;</code>æ¥å£ï¼Œå¹¶ä¸”å§‹ç»ˆæŒ‡ç¤ºè¿­ä»£å¾ªç¯çš„çŠ¶æ€ã€‚æšä¸¾å™¨å°±åƒæ˜¯åºåˆ—ä¸­çš„â€œæ¸¸æ ‡â€æˆ–è€…â€œä¹¦ç­¾â€ã€‚å¯ä»¥æœ‰å¤šä¸ªâ€œä¹¦ç­¾â€ï¼Œç§»åŠ¨å…¶ä¸­ä»»ä½•ä¸€ä¸ªéƒ½å¯ä»¥æšä¸¾é›†åˆï¼Œä¸å…¶ä»–æšä¸¾äº’ä¸å½±å“ã€‚ä½¿ç”¨æ­¤æ¨¡å¼å°±ç›¸å½“äºæœ‰å¤šä¸ªç‹¬ç«‹å·¥ä½œçš„æšä¸¾å™¨åœ¨éå†è¿™ä¸ªé›†åˆï¼Œå› æ­¤äº’ä¸å½±å“äº†ï¼Œforeachå¾ªç¯çš„C#ç­‰åŒä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">System.Collections.Generic.Stack&lt;<span class="built_in">int</span>&gt; stack = <span class="keyword">new</span> System.Collections.Generic.Stack&lt;<span class="built_in">int</span>&gt;();</span><br><span class="line"><span class="built_in">int</span> number;</span><br><span class="line">Syste,.Collections/Generic.Stack&lt;<span class="built_in">int</span>&gt;/Enumerator enumerator;</span><br><span class="line">enumerator = stack.GetEnumerator();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(enumerator.MoveNext())&#123;</span><br><span class="line">  number = enumerator.Current;</span><br><span class="line">  Console.WriteLine(number);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿­ä»£åæ¸…é™¤çŠ¶æ€ï¼šç”±äºå®ç°<code>IEnumerator&lt;T&gt;</code>æ¥å£çš„ç±»å§‹ç»ˆæŒ‡ç¤ºçŠ¶æ€ï¼Œå› æ­¤æœ‰æ—¶éœ€è¦åœ¨é€€å‡ºå¾ªç¯åæ¸…é™¤çŠ¶æ€ï¼ˆå› ä¸ºè¦ä¹ˆæ‰€æœ‰è¿­ä»£å‡å·²å®Œæˆï¼Œè¦ä¹ˆæŠ›å‡ºå¼‚å¸¸ï¼‰ã€‚ä¸ºæ­¤ï¼Œä»IDisposableæ´¾ç”Ÿ<code>IEnumerator&lt;T&gt;</code>æ¥å£ã€‚å®ç°IEnumeratorçš„æšä¸¾å™¨ä¸ä¸€å®šå®ç°IDisposableï¼Œå¦‚æœå®ç°äº†ï¼ŒåŒæ ·ä¹Ÿä¼šè°ƒç”¨Disposeã€‚è¿™æ ·å¯ä»¥åœ¨é€€å‡ºforeachå¾ªç¯åè°ƒç”¨Disposeã€‚å› æ­¤ï¼Œæœ€ç»ˆCILçš„C#ç­‰åŒå¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">System.Collections.Generic.Stack&lt;<span class="built_in">int</span>&gt; stack = <span class="keyword">new</span> System.Collections.Generic.Stack&lt;<span class="built_in">int</span>&gt;();</span><br><span class="line">System.Collections.Generic.Stack&lt;<span class="built_in">int</span>&gt;.Enumerator enumerator;</span><br><span class="line">IDisposable disposable;</span><br><span class="line">enumerator = stack.GetRnumerator();</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">  <span class="built_in">int</span> numeber;</span><br><span class="line">  <span class="keyword">while</span>(enumerator.MoveNext())&#123;</span><br><span class="line">    number = enumerator.Current;</span><br><span class="line">    Console.WriteLine(number);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">finally</span>&#123;</span><br><span class="line">  disposable = (IDisposable)enumerator;</span><br><span class="line">  disposable.Dispose();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œç”±äº<code>IEnumerator&lt;T&gt;</code>æ”¯æŒIDisposableæ¥å£ï¼Œå› æ­¤usingè¯­å¥å¯ä»¥å°†ä¸Šé¢çš„ä»£ç ç®€åŒ–ä¸ºä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">System.Collections.Generic.Stack&lt;<span class="built_in">int</span>&gt; stack = <span class="keyword">new</span> System.Collections.Generic.Stack&lt;<span class="built_in">int</span>&gt;();</span><br><span class="line"><span class="built_in">int</span> number;</span><br><span class="line"><span class="keyword">using</span>(System.Collections.Generic.Stack&lt;<span class="built_in">int</span>&gt;.Enumerator enumerator = stack.GetEnumerator())&#123;</span><br><span class="line">  <span class="keyword">while</span>(enumerator.MoveNext())&#123;</span><br><span class="line">    number = enumerator.Current;</span><br><span class="line">    Console.WriteLine(number);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶è€Œï¼Œé‡æ–°è°ƒç”¨CILå¹¶ä¸ç›´æ¥æ”¯æŒusingå…³é”®å­—ã€‚å› æ­¤ï¼Œæœªç®€åŒ–çš„ä»£ç å®é™…ä¸Šä½¿ç”¨C#æ›´ç²¾ç¡®è¡¨ç¤ºçš„foreach CILä»£ç ã€‚</p><p>åœ¨<em>ä¸å®ç°</em> IEnumerable çš„æƒ…å†µä¸‹ä½¿ç”¨ foreachï¼š C# ä¸è¦æ±‚å¿…é¡»å®ç° <code>IEnumerable/IEnumerable&lt;T&gt;</code> æ‰èƒ½ä½¿ç”¨ foreach è¿­ä»£æ•°æ®ç±»å‹ã€‚ç¼–è¯‘å™¨æ”¹ç”¨é¸­å­ç±»å‹è¿™ä¸€æ¦‚å¿µï¼›å®ƒä½¿ç”¨ Current å±æ€§å’Œ MoveNext æ–¹æ³•æŸ¥æ‰¾å¯è¿”å›ç±»å‹çš„ GetEnumerator æ–¹æ³•ã€‚é¸­å­ç±»å‹æ¶‰åŠæŒ‰åç§°æœç´¢ï¼Œè€Œä¸ä¾èµ–æ¥å£æˆ–æ˜¾å¼æ–¹æ³•è°ƒç”¨ã€‚ï¼ˆâ€œé¸­å­ç±»å‹â€ä¸€è¯æºè‡ªå°†åƒé¸­å­ä¸€æ ·çš„é¸Ÿè§†ä¸ºé¸­å­çš„æ€ªè¯æƒ³æ³•ï¼Œå¯¹è±¡å¿…é¡»ä»…å®ç° Quack æ–¹æ³•ï¼Œæ— éœ€å®ç° IDuck æ¥å£ã€‚ï¼‰ å¦‚æœé¸­å­ç±»å‹æ‰¾ä¸åˆ°å®ç°çš„åˆé€‚å¯æšä¸¾æ¨¡å¼ï¼Œç¼–è¯‘å™¨ä¾¿ä¼šæ£€æŸ¥é›†åˆæ˜¯å¦å®ç°æ¥å£ã€‚</p><p>åˆ°æ­¤ä¸ºæ­¢æˆ‘ä»¬ç®—æ˜¯ç†è§£äº†<code>foreach</code>çš„åŸºæœ¬åŸç†äº†ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œforeachæ˜¯ä¸æ”¯æŒå¯¹æˆ‘ä»¬éå†çš„å…ƒç´ è¿›è¡Œä¿®æ”¹çš„ï¼Œæˆ‘ä»¬ä¸‹é¢å°è¯•ä¸€ä¸‹ä½¿ç”¨foreachçš„æ€æƒ³å»è‡ªå·±å®ç°ä¸€ä¸‹å¯¹é›†åˆçš„éå†ã€‚</p><p>çœ‹ä¸€ä¸‹ä¸‹é¢è¿™æ®µä»£ç ï¼Œé‡Œé¢ç»¼åˆäº†æ¯”è¾ƒå¤šçš„çŸ¥è¯†ç‚¹ï¼Œå¤šæ€ã€ç»§æ‰¿ã€æ³›å‹ã€Structï¼Œè¿˜æœ‰æˆ‘ä»¬çš„è¿­ä»£å™¨æ¨¡å¼ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> ActivityData</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> _activityName;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> _activityStartDate;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> _activityEndDate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> ActivityName</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> _activityName; &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123; _activityName = <span class="keyword">value</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> ActivityStartDate</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> _activityStartDate; &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123; _activityStartDate = <span class="keyword">value</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> ActivityEndDate</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> _activityEndDate; &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123; _activityEndDate = <span class="keyword">value</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ActivityData</span>(<span class="params"><span class="built_in">string</span> activityName, <span class="built_in">string</span> activityStartDate, <span class="built_in">string</span> activityEndDate</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ActivityName = activityName;</span></span><br><span class="line">        <span class="comment">// ActivityStartDate = activityStartDate;</span></span><br><span class="line">        <span class="comment">// ActivityEndDate = activityEndDate;</span></span><br><span class="line">        _activityStartDate = activityStartDate;</span><br><span class="line">        _activityEndDate = activityEndDate;</span><br><span class="line">        _activityName = activityName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ConcreteEnumerator</span>&lt;<span class="title">T</span>&gt; : <span class="title">IEnumerator</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> T[] _collection;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> _index;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConcreteEnumerator</span>(<span class="params">T[] collection</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _collection = collection;</span><br><span class="line">        _index = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">MoveNext</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        _index++;</span><br><span class="line">        <span class="keyword">if</span> (_index &lt; _collection.Length)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">object</span> IEnumerator.Current &#123; <span class="keyword">get</span>; &#125; = <span class="keyword">new</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T Current</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span> =&gt; _collection[_index];</span><br><span class="line">        <span class="keyword">set</span> =&gt; _collection[_index] = <span class="keyword">value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Dispose</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Reset</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        _index = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ConcreteCollection</span>&lt;<span class="title">T</span>&gt; : <span class="title">IEnumerable</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> T[] _collection;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConcreteCollection</span>(<span class="params">T[] collection</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _collection = collection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">IEnumerator</span>&lt;<span class="title">T</span>&gt; <span class="title">GetEnumerator</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ConcreteEnumerator&lt;T&gt;(_collection);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    IEnumerator IEnumerable.GetEnumerator()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> GetEnumerator();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span>[] a = &#123; <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span> &#125;;</span><br><span class="line"></span><br><span class="line">        ConcreteCollection&lt;<span class="built_in">int</span>&gt; cc = <span class="keyword">new</span> ConcreteCollection&lt;<span class="built_in">int</span>&gt;(a);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ConcreteEnumerator&lt;int&gt; ce = cc.GetEnumerator&lt;int&gt;();</span></span><br><span class="line"></span><br><span class="line">        ConcreteEnumerator&lt;<span class="built_in">int</span>&gt;? ce = cc.GetEnumerator() <span class="keyword">as</span> ConcreteEnumerator&lt;<span class="built_in">int</span>&gt;;</span><br><span class="line">        <span class="keyword">while</span> (ce != <span class="literal">null</span> &amp;&amp; ce.MoveNext())</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(ce.Current);</span><br><span class="line">            ce.Current++;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;ä¿®æ”¹åçš„é›†åˆçš„å€¼ä¸ºï¼š&quot;</span> + ce.Current);</span><br><span class="line">            Console.WriteLine();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Console.WriteLine();</span><br><span class="line"></span><br><span class="line">        ActivityData[] data =</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">new</span> ActivityData(<span class="string">&quot;Unicorn&quot;</span>, <span class="string">&quot;2023-05-21&quot;</span>, <span class="string">&quot;2023-05-23&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> ActivityData(<span class="string">&quot;Flower&quot;</span>, <span class="string">&quot;2023-05-22&quot;</span>, <span class="string">&quot;2023-05-25&quot;</span>)</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        ConcreteCollection&lt;ActivityData&gt; activityDataCollection = <span class="keyword">new</span> ConcreteCollection&lt;ActivityData&gt;(data);</span><br><span class="line">        <span class="keyword">using</span> (ConcreteEnumerator&lt;ActivityData&gt;? activityDataEnumerator =</span><br><span class="line">               activityDataCollection.GetEnumerator() <span class="keyword">as</span> ConcreteEnumerator&lt;ActivityData&gt;)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">while</span> (activityDataEnumerator != <span class="literal">null</span> &amp;&amp; activityDataEnumerator.MoveNext())</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">&quot;å½“å‰æ´»åŠ¨åï¼š&quot;</span> + activityDataEnumerator.Current.ActivityName);</span><br><span class="line">                Console.WriteLine(<span class="string">&quot;å½“å‰æ´»åŠ¨å¼€å§‹æ—¥æœŸï¼š&quot;</span> + activityDataEnumerator.Current.ActivityStartDate);</span><br><span class="line">                Console.WriteLine(<span class="string">&quot;å½“å‰æ´»åŠ¨ç»“æŸæ—¥æœŸï¼š&quot;</span> + activityDataEnumerator.Current.ActivityEndDate);</span><br><span class="line">                Console.WriteLine();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Console.ReadKey();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æˆ‘ä»¬ä¸Šé¢çš„ä»£ç æ˜¯æŒ‰ç…§foreachçš„æ€æƒ³å»éå†æˆ‘ä»¬æ‰€æœ‰çš„å…ƒç´ çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å®ç°äº†åœ¨éå†çš„è¿‡ç¨‹ä¸­æ›´æ”¹å…ƒç´ çš„å†…å®¹ï¼Œforeachä¹‹æ‰€ä»¥ä¸èƒ½ä¿®æ”¹å…ƒç´ çš„å€¼ï¼Œæ˜¯å› ä¸ºåœ¨foreachçš„å®ç°ä¸­å¹¶æ²¡æœ‰æš´éœ²Currentå±æ€§çš„setæ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬æ²¡æœ‰åŠæ³•åœ¨foreachéå†çš„æ—¶å€™æ›´æ”¹é›†åˆçš„å€¼ã€‚</li></ul><p>ä¸‹é¢æ”¾å‡ å¼ æˆ‘å’ŒChatGPTçš„æˆªå›¾ï¼ŒçœŸçš„ç‰›é€¼ï¼š</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸¤æ®µä»£ç ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IEnumerable&lt;<span class="built_in">int</span>&gt; <span class="title">Fibonacci</span>(<span class="params"><span class="built_in">int</span> count</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> prev1 = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">int</span> prev2 = <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; count; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span> current = prev1 + prev2;</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> current; <span class="comment">// ä½¿ç”¨yield returnè¿”å›å½“å‰å€¼</span></span><br><span class="line">        </span><br><span class="line">        prev1 = prev2;</span><br><span class="line">        prev2 = current;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨Unityä¸­æ‰§è¡Œå¦‚ä¸‹çš„ä»£ç ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestCoroutine</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;æˆ‘æ˜¯Updateä¸­çš„æ–¹æ³•1&quot;</span>);</span><br><span class="line">        StartCoroutine(Test());</span><br><span class="line">        Debug.Log(<span class="string">&quot;æˆ‘æ˜¯Updateä¸­çš„æ–¹æ³•2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">IEnumerator <span class="title">Test</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;ç¬¬ä¸€æ¬¡æ‰§è¡Œæ–¹æ³•&quot;</span>);</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Debug.Log(<span class="string">&quot;ç¬¬äºŒæ¬¡æ‰§è¡Œæ–¹æ³•&quot;</span>);</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Debug.Log(<span class="string">&quot;ç¬¬ä¸‰æ¬¡æ‰§è¡Œæ–¹æ³•&quot;</span>);</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ§åˆ¶å°çš„è¾“å‡ºç»“æœæ˜¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">æˆ‘æ˜¯Updateä¸­çš„æ–¹æ³•1</span><br><span class="line">ç¬¬ä¸€æ¬¡æ‰§è¡Œæ–¹æ³•</span><br><span class="line">æˆ‘æ˜¯Updateä¸­çš„æ–¹æ³•2</span><br><span class="line"></span><br><span class="line">æˆ‘æ˜¯Updateä¸­çš„æ–¹æ³•1</span><br><span class="line">ç¬¬ä¸€æ¬¡æ‰§è¡Œæ–¹æ³•</span><br><span class="line">æˆ‘æ˜¯Updateä¸­çš„æ–¹æ³•2</span><br><span class="line">ç¬¬äºŒæ¬¡æ‰§è¡Œæ–¹æ³•</span><br><span class="line"></span><br><span class="line">æˆ‘æ˜¯Updateä¸­çš„æ–¹æ³•1</span><br><span class="line">ç¬¬ä¸€æ¬¡æ‰§è¡Œæ–¹æ³•</span><br><span class="line">æˆ‘æ˜¯Updateä¸­çš„æ–¹æ³•2</span><br><span class="line">ç¬¬äºŒæ¬¡æ‰§è¡Œæ–¹æ³•</span><br><span class="line">ç¬¬ä¸‰æ¬¡æ‰§è¡Œæ–¹æ³•</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹ç¬¬ä¸‰æ¬¡Updateä¸­ä»£ç æ‰§è¡Œçš„é¡ºåºæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼šç¬¬äºŒæ¬¡Updateä¸­çš„Coroutineæ¯”ç¬¬ä¸€æ¬¡ä¸­çš„Coroutineå…ˆæ‰§è¡Œäº†ï¼Œè€Œä¸”æ˜¯åœ¨è¿™ä¸€æ¬¡Updateç»“æŸäº†ä¹‹åæ‰è°ƒç”¨çš„åç¨‹ï¼Œå°±æ˜¯åœ¨åé¢çš„Coroutineè¦å…ˆäºå‰é¢çš„åç¨‹æ‰§è¡Œã€‚</p><h1>IEnumerableå’ŒIEnumerator</h1><p><code>IEnumerable</code>å’Œ<code>IEnumerator</code>æœ¬è´¨æ˜¯ä¸¤ä¸ªæ¥å£ï¼ŒäºŒè€…çš„æºç å¦‚ä¸‹ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Decompiled with JetBrains decompiler</span></span><br><span class="line"><span class="comment">// Type: System.Collections.IEnumerator</span></span><br><span class="line"><span class="comment">// Assembly: netstandard, Version=2.1.0.0, Culture=neutral, PublicKeyToken=cc7b13ffcd2ddd51</span></span><br><span class="line"><span class="comment">// MVID: 5A41D6B7-1898-42EC-A409-FD0B1C3E3DCF</span></span><br><span class="line"><span class="comment">// Assembly location: /Applications/2021.3.14f1/Unity.app/Contents/NetStandard/ref/2.1.0/netstandard.dll</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">System.Collections</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span><span class="doctag">&lt;para&gt;</span>Supports a simple iteration over a non-generic collection.<span class="doctag">&lt;/para&gt;</span><span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IEnumerator</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span><span class="doctag">&lt;para&gt;</span>Gets the current element in the collection.<span class="doctag">&lt;/para&gt;</span><span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="built_in">object</span> Current &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span><span class="doctag">&lt;para&gt;</span>Advances the enumerator to the next element of the collection.<span class="doctag">&lt;/para&gt;</span><span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="built_in">bool</span> <span class="title">MoveNext</span>()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span><span class="doctag">&lt;para&gt;</span>Sets the enumerator to its initial position, which is before the first element in the collection.<span class="doctag">&lt;/para&gt;</span><span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Reset</span>()</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Decompiled with JetBrains decompiler</span></span><br><span class="line"><span class="comment">// Type: System.Collections.IEnumerable</span></span><br><span class="line"><span class="comment">// Assembly: netstandard, Version=2.1.0.0, Culture=neutral, PublicKeyToken=cc7b13ffcd2ddd51</span></span><br><span class="line"><span class="comment">// MVID: 5A41D6B7-1898-42EC-A409-FD0B1C3E3DCF</span></span><br><span class="line"><span class="comment">// Assembly location: /Applications/2021.3.14f1/Unity.app/Contents/NetStandard/ref/2.1.0/netstandard.dll</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">System.Collections</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span><span class="doctag">&lt;para&gt;</span>Exposes an enumerator, which supports a simple iteration over a non-generic collection.<span class="doctag">&lt;/para&gt;</span><span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IEnumerable</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span><span class="doctag">&lt;para&gt;</span>Returns an enumerator that iterates through a collection.<span class="doctag">&lt;/para&gt;</span><span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function">IEnumerator <span class="title">GetEnumerator</span>()</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äºŒè€…çš„åŒºåˆ«ä¸è”ç³»ï¼š</p><p>ä¸€ä¸ªé›†åˆå¯æŸ¥è¯¢ï¼ˆä½¿ç”¨foreachï¼Œwhereï¼Œanyç­‰ï¼‰ï¼Œå¿…é¡»ä»¥æŸç§æ–¹å¼è¿”å›IEnumerator objectï¼Œä¹Ÿå°±æ˜¯å¿…é¡»å®ç°IEnumerableæ¥å£</p><p>IEnumerator objectå…·ä½“å®ç°äº†iteratorï¼ˆé€šè¿‡MoveNext(),Reset(),Currentï¼‰ã€‚</p><p>ä»è¿™ä¸¤ä¸ªæ¥å£çš„é€‰è¯ä¸Šï¼Œå¯ä»¥çœ‹å‡ºIEnumerableæ˜¯ä¸€ä¸ªå£°æ˜å¼çš„æ¥å£ï¼Œå£°æ˜å®ç°è¯¥æ¥å£çš„classæ˜¯â€œå¯æšä¸¾çš„â€</p><p>IEnumerableå’ŒIEnumeratoré€šè¿‡IEnumerableçš„GetEnumerator()æ–¹æ³•å»ºç«‹äº†è¿æ¥ã€‚</p><p>çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">learnIEnumerator</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Person</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">set</span>; <span class="keyword">get</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Person</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Name = name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShowName</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(Name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PeopleEnum</span> : <span class="title">IEnumerator</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> Person[] _person;</span><br><span class="line">        <span class="built_in">int</span> position = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">PeopleEnum</span>(<span class="params">Person[] person</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            _person = person;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">MoveNext</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            position++;</span><br><span class="line">            <span class="keyword">return</span> (position &lt; _person.Length);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Reset</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            position = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">object</span> Current</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">try</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> _person[position];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span> (Exception e)</span><br><span class="line">                &#123;</span><br><span class="line">                    Console.WriteLine(e);</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> InvalidOperationException();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PersonSet</span> : <span class="title">IEnumerable</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> Person[] people;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">PersonSet</span>(<span class="params">Person[] pArray</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            people = <span class="keyword">new</span> Person[pArray.Length];</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; pArray.Length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                people[i] = pArray[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> IEnumerator <span class="title">GetEnumerator</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// è°ƒç”¨äº†æ„é€ å‡½æ•°å§ï¼Ÿ</span></span><br><span class="line">            <span class="comment">// ç±»çš„å£°æ˜å…¶å®å°±æ˜¯è°ƒç”¨æ„é€ å‡½æ•°çš„è¿‡ç¨‹</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> PeopleEnum(people);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æˆ‘ç°åœ¨ç–‘æƒ‘çš„ç‚¹å°±åœ¨äºï¼Œå¿…é¡»è¦åœ¨Personç±»çš„åŸºç¡€ä¸Šå†å¥—ä¸€ä¸ªPeople Listçš„ç±»ä¹ˆï¼Ÿ</span></span><br><span class="line">    <span class="comment">// æ‹¿æœ€ç®€å•çš„intå’Œ int[]</span></span><br><span class="line">    <span class="comment">// int ç›¸å½“äº Person ä»£è¡¨æ¯ä¸€ä¸ªPersonçš„å®ä¾‹ï¼Œå®ƒåœç•™åœ¨ä¸ªä½“è¿™ä¸ªå±‚é¢</span></span><br><span class="line">    <span class="comment">// int[] ç›¸å½“äº People å®ƒé‡Œé¢æ˜¯è¦å®ç°é›†åˆä»¥å¤–ï¼Œè€Œä¸”ç»§æ‰¿IEnumerableæ¥å£ï¼Œè¯´æ˜å®ƒæ˜¯å¯ä»¥æšä¸¾çš„ï¼Œå®ƒæ˜¯é›†åˆè¿™ä¸ªå±‚é¢çš„</span></span><br><span class="line">    <span class="comment">// ç„¶åæˆ‘ä»¬è¿˜éœ€è¦å»è‡ªå®šä¹‰ä¸€ä¸ªè¿­ä»£å™¨ï¼Œæ¥å®ç°å¯¹äºPeopleçš„æšä¸¾</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†æŠ½è±¡ä¸€ä¸‹</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬è¦å®ç°æšä¸¾æˆ‘ä»¬è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ä¸‰ä¸ªç±»</span></span><br><span class="line">    <span class="comment">// 1.æ•°æ®ç»“æ„çš„å®šä¹‰ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªä¸ªä½“å®ƒæœ‰å“ªäº›å±æ€§</span></span><br><span class="line">    <span class="comment">// 2.åŒ…å«1ä¸­æ•°æ®ç»“æ„çš„é›†åˆï¼Œé™¤æ­¤ä¹‹å¤–è¯¥é›†åˆç»§æ‰¿IEnumerableæ¥å£ï¼Œè°ƒç”¨GetEnumeratoræ–¹æ³•</span></span><br><span class="line">    <span class="comment">// 3ã€‚å®ç°GetEnumeratoræ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Person[] person = <span class="keyword">new</span> Person[<span class="number">4</span>]</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">new</span> Person(<span class="string">&quot;æç£Š&quot;</span>),</span><br><span class="line">                <span class="keyword">new</span> Person(<span class="string">&quot;ç‹åˆš&quot;</span>),</span><br><span class="line">                <span class="keyword">new</span> Person(<span class="string">&quot;å½¤å½¤&quot;</span>),</span><br><span class="line">                <span class="keyword">new</span> Person(<span class="string">&quot;ä¸¹ä¸¹&quot;</span>),</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            PersonSet listPeople = <span class="keyword">new</span> PersonSet(person);</span><br><span class="line">            <span class="keyword">foreach</span> (Person p <span class="keyword">in</span> listPeople)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(p.Name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬è¦å®ç°æšä¸¾æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„æ•°æ®ç»“æ„çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬æ€»å…±è¦å®ç°ä¸‰ä¸ªç±»ï¼š</p><ol><li>æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„æ•°æ®ç»“æ„çš„ç±»ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦æšä¸¾çš„æ¯ä¸€ä¸ªå…ƒç´ çš„ç±»</li><li>åŒ…å«æˆ‘ä»¬è‡ªå®šä¹‰æ•°æ®ç»“æ„çš„ç±»çš„ç±»ï¼Œä¹Ÿå°±æ˜¯é›†åˆï¼Œè¿™ä¸ªç±»è¦ç»§æ‰¿IEnumerableæ¥å£ï¼Œé‡å†™GetEnumeratorå‡½æ•°</li><li>æšä¸¾æˆ‘ä»¬å®šå®šä¹‰æ•°æ®ç»“æ„çš„ç±»ï¼Œä¹Ÿå°±æ˜¯æšä¸¾å™¨ï¼Œç»§æ‰¿IEnumeratoræ¥å£ï¼Œé‡å†™MoveNextæ–¹æ³•ã€Resetæ–¹æ³•å’ŒCurrent</li></ol><p>å…¶ä¸­æœ€å›°æ‰°æˆ‘çš„æ˜¯ç¬¬äºŒä¸ªç±»ï¼Œæˆ–è€…è¯´foreachçš„ç”¨æ³•ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨GetEnumeratoræ–¹æ³•çš„æ—¶å€™ä¼šå‘å…¶ä¸­ä¼ å…¥æˆ‘ä»¬è¦æšä¸¾çš„è‡ªå®šä¹‰æ•°æ®ç»“æ„çš„æ•°ç»„ï¼Œé€šè¿‡returnè¯­å¥æ–°å»ºçš„PeopleEnumç±»ä¸­ä¼ çš„peopleå‚æ•°æ˜¯å…³é”®ï¼Œå®ƒå‘Šè¯‰äº†æšä¸¾å™¨æˆ‘ä»¬è¦æšä¸¾ä»€ä¹ˆç±»å‹çš„æ•°æ®ï¼Œä»¥åŠæšä¸¾çš„æ•°æ®æœ‰å“ªäº›ã€‚</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PersonSet</span> : <span class="title">IEnumerable</span></span><br><span class="line">    &#123;</span><br><span class="line">  <span class="comment">// peopleå°±æ˜¯æˆ‘ä»¬è¦æšä¸¾çš„é›†åˆ</span></span><br><span class="line">        <span class="keyword">private</span> Person[] people;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">PersonSet</span>(<span class="params">Person[] pArray</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            people = <span class="keyword">new</span> Person[pArray.Length];</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; pArray.Length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                people[i] = pArray[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> IEnumerator <span class="title">GetEnumerator</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// è°ƒç”¨äº†æ„é€ å‡½æ•°å§ï¼Ÿ</span></span><br><span class="line">            <span class="comment">// ç±»çš„å£°æ˜å…¶å®å°±æ˜¯è°ƒç”¨æ„é€ å‡½æ•°çš„è¿‡ç¨‹</span></span><br><span class="line">          </span><br><span class="line">          <span class="comment">// è¿™ä¸€è¡Œä»£ç ååˆ†å…³é”®ï¼Œå®ƒæŠŠæšä¸¾å™¨å’Œæˆ‘ä»¬è¦æšä¸¾çš„é›†åˆè”ç³»åˆ°ä¸€èµ·äº†</span></span><br><span class="line">          <span class="comment">// è¿™è¡Œä»£ç å‘Šè¯‰æˆ‘ä»¬çš„æšä¸¾å™¨ç±»æˆ‘ä»¬è¦æšä¸¾çš„æ•°æ®æ˜¯ä»€ä¹ˆã€æœ‰å“ªäº›</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> PeopleEnum(people);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1>yieldå…³é”®å­—</h1><p>yieldå…³é”®å­—æ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼ŒèƒŒåå…¶å®ç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„ç±»ï¼Œæ˜¯ä¸€ä¸ªæšä¸¾å™¨ï¼Œæšä¸¾å™¨å…·ä½“å®ç°äº†MoveNextã€Resetå’ŒCurrentã€‚</p><p>å…ˆçœ‹ä¸€æ®µä»£ç ï¼Œé€šè¿‡<code>yield return</code>å®ç°äº†ç±»ä¼¼ç”¨foreachä¾¿éå†æ•°ç»„çš„åŠŸèƒ½ï¼Œè¯´æ˜yield returnä¹Ÿæ˜¯ç”¨æ¥å®ç°è¿­ä»£å™¨çš„åŠŸèƒ½çš„</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">static</span> System.Console;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//ä¸€ä¸ªè¿”å›ç±»å‹ä¸ºIEnumerable&lt;int&gt;ï¼Œå…¶ä¸­åŒ…å«ä¸‰ä¸ªyield return</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IEnumerable&lt;<span class="built_in">int</span>&gt; <span class="title">enumerableFuc</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//é€šè¿‡foreachå¾ªç¯è¿­ä»£æ­¤å‡½æ•°</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="function"><span class="built_in">int</span> item <span class="keyword">in</span> <span class="title">enumerableFuc</span>())</span></span><br><span class="line">        &#123;</span><br><span class="line">            WriteLine(item);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ReadKey();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„è¾“å‡ºç»“æœå°†ä¼šæ˜¯ï¼š<code>1 2 3</code>ã€‚</p><p>å¦‚æœæˆ‘åœ¨ä»£ç ä¸­åŠ å…¥<code>yield break</code>ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">yield</span> <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆç»“æœå°±åªä¼šè¾“å‡º1å’Œ2ï¼Œè¯´æ˜è¿™ä¸ªè¿­ä»£å™¨è¢«yield breakç»™åœæ‰äº†ï¼Œæ‰€ä»¥yield breakæ˜¯ç”¨æ¥ç»ˆæ­¢è¿­ä»£çš„ã€‚</p><p>æˆ‘ä»¬ç°åœ¨æŠŠä¸Šé¢éå†äººåçš„é‚£ä¸ªç¨‹åºæ”¹å†™æˆ<code>yield</code>çš„å½¢å¼çœ‹ä¸€ä¸‹ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">learnIEnumerator</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Person</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">set</span>; <span class="keyword">get</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Person</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Name = name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ShowName</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(Name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PersonSet</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> Person[] people;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">PersonSet</span>(<span class="params">Person[] pArray</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            people = <span class="keyword">new</span> Person[pArray.Length];</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; pArray.Length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                people[i] = pArray[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> IEnumerable&lt;Str4ing&gt; <span class="title">PersonEnum</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; people.Length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">yield</span> <span class="keyword">return</span> people[i].Name;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">            &#123;</span><br><span class="line">                Person[] person = <span class="keyword">new</span> Person[<span class="number">4</span>]</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">new</span> Person(<span class="string">&quot;æç£Š&quot;</span>),<span class="function">ty</span></span><br><span class="line"><span class="function">                    <span class="keyword">new</span> <span class="title">Person</span>(<span class="params"><span class="string">&quot;ç‹åˆš&quot;</span></span>),</span></span><br><span class="line"><span class="function">                    <span class="keyword">new</span> <span class="title">Person</span>(<span class="params"><span class="string">&quot;å½¤å½¤&quot;</span></span>),</span></span><br><span class="line"><span class="function">                    <span class="keyword">new</span> <span class="title">Person</span>(<span class="params"><span class="string">&quot;ä¸¹ä¸¹&quot;</span></span>),</span></span><br><span class="line"><span class="function">                &#125;</span>;</span><br><span class="line"></span><br><span class="line">                PersonSet listPerson = <span class="keyword">new</span> PersonSet(person);</span><br><span class="line">                IEnumerator&lt;String&gt; enumerator = listPerson.PersonEnum().GetEnumerator();</span><br><span class="line">                <span class="keyword">while</span> (enumerator.MoveNext())</span><br><span class="line">                &#123;</span><br><span class="line">                    String current = enumerator.Current;</span><br><span class="line">                    Console.WriteLine(current);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ¥çœ‹ä¸€æ®µä»£ç ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IEnumerable&lt;<span class="built_in">int</span>&gt; <span class="title">Fibonacci</span>(<span class="params"><span class="built_in">int</span> count</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> prev1 = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">int</span> prev2 = <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; count; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span> current = prev1 + prev2;</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> current; <span class="comment">// ä½¿ç”¨yield returnè¿”å›å½“å‰å€¼</span></span><br><span class="line">        </span><br><span class="line">        prev1 = prev2;</span><br><span class="line">        prev2 = current;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™æ®µä»£ç ä¸­æˆ‘ä»¬ä½¿ç”¨äº†forå¾ªç¯åµŒå¥—äº†ä¸€ä¸ª<code>yield return</code> è¯­å¥ï¼Œæˆ‘åœ¨è¿™é‡Œæ—¶å¸¸ä¼šæœ‰ä¸€ä¸ªè¯¯åŒºå°±æ˜¯ï¼Œæˆ‘ä¼šä¹ æƒ¯æ€§åœ°è®¤ä¸ºforå¾ªç¯æ˜¯ç”¨æ¥å®ç°<code>MoveNext</code>çš„æ–¹æ³•çš„ï¼Œä½†å…¶å®ä¸æ˜¯ï¼Œå› ä¸ºçœ‹è¿™æ®µä»£ç </p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IEnumerable&lt;<span class="built_in">int</span>&gt; <span class="title">enumerableFuc</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ƒé‡Œé¢æ²¡æœ‰forå¾ªç¯ä½†æ˜¯ä¾ç„¶å¯ä»¥å®ç°<code>MoveNext</code>çš„åŠŸèƒ½å•ŠğŸ˜‚ï¼Œæ‰€ä»¥æ— è®ºæ˜¯ä½¿ç”¨forå¾ªç¯è¿˜æ˜¯æŠŠæ‰€æœ‰å…ƒç´ ç½—åˆ—å‡ºæ¥ï¼Œè¿™ä¸ªç¯èŠ‚çš„ç›®çš„éƒ½æ˜¯ä¸ºäº†å‘Šè¯‰yield returnè‡ªåŠ¨ç”Ÿæˆçš„é‚£ä¸ªè¿­ä»£å™¨å®ƒè¦éå†çš„è¿™ä¸ªé›†åˆä¸­æœ‰å¤šå°‘ä¸ªå…ƒç´ ï¼Œä»…æ­¤è€Œå·²ï¼Œ<code>MoveNext</code>ä¼šè¢«ç¼–è¯‘å™¨éšå¼åœ°å¤„ç†ï¼Œå®Œå…¨ä¸éœ€è¦æˆ‘ä»¬æ“å¿ƒã€‚</p><p>è¿˜æœ‰ä¸€ç‚¹ï¼Œæˆ‘ä»¬ä¸€ä¸ªIEnumerableæ–¹æ³•ä¸­åªä¼šç”Ÿæˆä¸€ä¸ªè¿­ä»£å™¨ï¼Œç†è§£ä¸€ä¸‹è¿™å¥è¯ï¼Œè¿˜æ˜¯è›®é‡è¦çš„ï¼Œå›é¡¾ä¸€ä¸‹è¿­ä»£å™¨æ¨¡å¼ä¸­çš„å››ä¸ªè§’è‰²ï¼Œæœ‰ä¸€ä¸ªå«åšå…·ä½“èšåˆè§’è‰²ï¼Œæœ‰ä¸€ä¸ªå«åšå…·ä½“è¿­ä»£å™¨è§’è‰²ï¼Œå…·ä½“è¿­ä»£å™¨è¿­ä»£çš„å°±æ˜¯å…·ä½“èšåˆè§’è‰² ï¼ˆé›†åˆï¼‰ï¼Œé›†åˆæœ¬è´¨å°±æ˜¯ä¸€ç±»äº‹ç‰©çš„ç»„åˆï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ä¸€ä¸ªè¿­ä»£å™¨å°±å¯ä»¥å®Œæˆå¯¹è¿™ä¸€ä¸ªé›†åˆçš„å…¨éƒ¨éå†äº†ï¼Œæˆ‘ä¹‹å‰å­˜åœ¨çš„ä¸€ä¸ªè¯¯åŒºæ˜¯æˆ‘è®¤ä¸ºæ¯è°ƒç”¨ä¸€æ¬¡yieldè¯­å¥å°±ä¼šç”Ÿæˆä¸€ä¸ªè¿­ä»£å™¨ã€‚</p><p>æœ€åå†æ¥çœ‹çœ‹ä½¿ç”¨äº†yieldè¯­å¥åæˆ‘ä»¬å¯ä»¥å°‘å†™å“ªäº›ä»£ç ï¼Œæˆ‘ä»¬é¦–å…ˆä¸éœ€è¦è‡ªå·±ç¼–å†™å…·ä½“çš„è¿­ä»£å™¨ç±»äº†ï¼Œç›¸å¯¹åº”çš„æŠ½è±¡è¿­ä»£å™¨ç±»ä¹Ÿä¸éœ€è¦äº†ï¼Œæˆ‘ä»¬ç°åœ¨åªéœ€è¦åœ¨å…·ä½“èšåˆç±»ä¸­å®šä¹‰ä¸€ä¸‹è·å–è¿­ä»£å™¨çš„æ–¹æ³•å°±å¯ä»¥äº†ã€‚æ‰€ä»¥çœŸçš„å¥½çœäº‹å•Šï¼</p><p>ä¸€èˆ¬æˆ‘ä»¬ä¼šåœ¨åç¨‹ä¸­å¤„ç†å„ç§å„æ ·çš„ä¸šåŠ¡å˜›ï¼Œæ¯”å¦‚ä¸‹å›¾ï¼š</p><img src="/posts/133a9667/image-20230421111245324.png" class=""><p>å¯ä»¥çœ‹åˆ°é‡Œé¢yield returnçš„ä¸œè¥¿äº”èŠ±å…«é—¨ï¼Œä½†æ˜¯ç‰¢è®°æˆ‘ä»¬ä¸Šé¢è®²åˆ°çš„ï¼Œéå†ä¸€ä¸ªå…·ä½“èšåˆè§’è‰²åªä¼šæœ‰ä¸€ä¸ªè¿­ä»£å™¨ï¼Œæ¥çœ‹çœ‹ChatGPTæ€ä¹ˆè¯´ï¼š</p><img src="/posts/133a9667/image-20230421111517366.png" class=""><p>æˆ‘ä»¬ç°åœ¨ç†è§£ä¸€ä¸‹StartCoroutineæ–¹æ³•ï¼Œè¯¥æ–¹æ³•é‡Œé¢ä¼šä¼ å…¥ä¸€ä¸ªIEnumeratorç±»å‹çš„æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬ç±»æ¯”ä¸€ä¸‹è°ƒç”¨StartCoroutineæ–¹æ³•å°±ç›¸å½“äºæ˜¯ä½¿ç”¨äº†foreachï¼Œçœ‹ä¸€ä¸‹ä¼ªä»£ç ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">YieldExample</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IEnumerable&lt;<span class="built_in">int</span>&gt; <span class="title">GetValues</span>(<span class="params"><span class="built_in">int</span> count</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">1</span>; i &lt;= count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">yield</span> <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨é™æ€æ–¹æ³•GetValuesï¼Œè·å–è¿­ä»£å™¨</span></span><br><span class="line">        IEnumerable&lt;<span class="built_in">int</span>&gt; valuesEnumerable = YieldExample.GetValues(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Type of the GetEnumerator instance: &quot;</span> + valuesEnumerable.GetType().FullName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨foreachå¾ªç¯éå†è¿­ä»£å™¨</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="built_in">int</span> <span class="keyword">value</span> <span class="keyword">in</span> valuesEnumerable)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="keyword">value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬è°ƒç”¨äº†StartCoroutineæ–¹æ³•åç±»ä¼¼äºè°ƒç”¨äº†foreachå¾ªç¯ï¼Œä¼šä¸æ–­éå†æ•´ä¸ªé›†åˆï¼Œä½†æ˜¯åœ¨Unityçš„StartCoroutineæ–¹æ³•ä¸­å®ƒæ‰€éå†çš„é›†åˆæ˜¯æ‰§è¡Œæ—¶æœºçš„é›†åˆï¼Œå› ä¸ºåœ¨Unityçš„åç¨‹ä¸­æˆ‘ä»¬ä¸€èˆ¬yield returnçš„éƒ½æ˜¯ä¸€äº›åç¨‹å†æ‰§è¡Œçš„æ—¶æœºï¼Œè€Œä¸”ä»”ç»†æƒ³æƒ³åç¨‹çš„è¿ä½œæ–¹å¼è·Ÿçº¯C#è¿˜ä¸ä¸€æ ·ï¼Œåœ¨çº¯C#ä¸­æˆ‘ä»¬éœ€è¦ç”¨yield returnè¿”å›æˆ‘ä»¬è¦éå†çš„é›†åˆçš„å…ƒç´ ï¼Œæ¯”å¦‚ä¸Šé¢è¿™æ®µä»£ç </p><p>è€Œåç¨‹çš„ä»£ç ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">FlyPfxManager.Create();</span><br><span class="line">ActivityManager.Create();</span><br><span class="line"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">PlayDefine.Init();</span><br><span class="line">PlayViewDefine.Init(<span class="number">1.5f</span>);</span><br><span class="line"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">CmdManager.Create();</span><br><span class="line"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">DataManager.Create();</span><br><span class="line"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">AuthManager.Create();</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çš„ç›®çš„æ˜¯åœ¨ä¸€æ®µæ—¶é—´å†…æ‰§è¡Œå¾ˆå¤šç§æ–¹æ³•ï¼Œyield returnè¿”å›çš„å…ƒç´ ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿ï¼Œå®ƒæ˜¯æˆ‘ä»¬è¾¾åˆ°å¼‚æ­¥çš„æ‰‹æ®µï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯åç¨‹å’Œçº¯C#ä¸­IEnumeratorçš„åŒºåˆ«</p><p>æ€»ä¹‹å°±æ˜¯ä½¿ç”¨StartCoroutineå’Œforeachéƒ½èƒ½è¾¾åˆ°éå†ä¸€ä¸ªå…·ä½“èšåˆè§’è‰²çš„æ‰€æœ‰å…ƒç´ çš„ä½œç”¨ï¼Œä½†æ˜¯å®ƒä»¬éå†è¿™ä¸ªé›†åˆå…ƒç´ çš„ç›®çš„æ˜¯ä¸åŒçš„ï¼ŒStartCoroutineéå†é›†åˆæ˜¯ä¸ºäº†å®ç°æ—¶é—´é—´éš”ï¼Œè€Œçº¯C#çš„foreachéå†é›†åˆæ˜¯ä¸ºäº†å±•ç¤ºæˆ–è€…è¯»å–åˆ°ï¼ˆåªè¯»ï¼‰é›†åˆä¸­æ‰€æœ‰å…ƒç´ çš„ä¿¡æ¯ã€‚</p><p>é‚£æˆ‘æƒ³åç¨‹åˆ°æ­¤åº”è¯¥å°±ç†è§£äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª<code>IEnumerator Func()</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼šä½¿ç”¨<code>StartCoroutine(Func());</code>ï¼Œå› æ­¤ï¼Œ<code>Func()</code>å°±æ˜¯ä¸€ä¸ªå…·ä½“èšåˆè§’è‰²ï¼ˆä¸€ä¸ªé›†åˆï¼‰è€ŒStartCoroutineå°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œå®ƒå»éå†æ•´ä¸ª<code>Func()</code>é›†åˆï¼Œæ‰€ä»¥è¯´åç¨‹çš„æœ¬è´¨æ˜¯è¿­ä»£å™¨å¥½åƒæ²¡ä»€ä¹ˆé—®é¢˜ã€‚</p><p>å…³äº<code>IEnumerator</code>ã€<code>IEnumerable</code>å’Œ<code>yield</code>çš„æ¢è®¨å°±å…ˆå‘Šä¸€æ®µè½äº†ã€‚</p><h1>å°ç»“</h1><p>ä»Šå¤©æ˜¯é¡¹ç›®çš„éªŒæ”¶ç¯èŠ‚ï¼Œå·¥ä½œæ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥èŠ±äº†ä¸€å¤©çš„æ—¶é—´å†™å®Œäº†è¿™ç¯‡åšå®¢ï¼Œæœ¬ç¯‡åšå®¢ä»IEnumeratorå’ŒIEnumerableå‡ºå‘ï¼Œå¼•å‡ºäº†ç±»å’Œæ¥å£çš„è¾¨æã€C#ä¸­çš„ä¿®é¥°ç¬¦ã€è™šå‡½æ•°å’ŒæŠ½è±¡å‡½æ•°çš„åŒºåˆ«è¾¨æç­‰ç­‰å¾ˆå¤šé›¶ç¢çš„çŸ¥è¯†ç‚¹ï¼ŒçœŸçš„æ˜¯æ”¶è·æ»¡æ»¡ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨Macå’ŒWindowsä¸Šé…ç½®dotNetå¼€å‘ç¯å¢ƒ</title>
      <link href="/posts/724ccb4/"/>
      <url>/posts/724ccb4/</url>
      
        <content type="html"><![CDATA[<h1>èƒŒæ™¯</h1><p>æœ¬æ–‡ä¸»è¦è®°å½•å¦‚ä½•é…ç½®.NETç¯å¢ƒï¼Œä»¥åŠå¦‚ä½•åˆ›å»ºæœ€ç®€å•çš„C# applicationã€‚</p><h1>åœ¨Macä¸Šé…ç½®dotNetå¼€å‘ç¯å¢ƒ</h1><p>è¿™é‡Œæ˜¯.Net7çš„<a href="https://download.visualstudio.microsoft.com/download/pr/86bb5988-5fb5-4e22-8f21-de5992e1a689/f8f616f84dc38100a8464c4644a371ce/dotnet-sdk-7.0.201-osx-arm64.pkg">ä¸‹è½½åœ°å€</a>ï¼Œæ‰“å¼€ä¸‹è½½çš„pkgï¼ŒæŒ‰ç…§æŒ‡å¼•å®Œæˆå®‰è£…ã€‚åœ¨ç»ˆç«¯ä¸­è¾“å…¥<code>dotnet</code>ï¼Œå¦‚æœå®‰è£…æˆåŠŸï¼Œä¼šå¼¹å‡ºå¦‚ä¸‹å†…å®¹ï¼š</p><img src="/posts/724ccb4/image-20230310161307972.png" class=""><h1>ä½¿ç”¨Terminalåˆ›å»ºä¸€ä¸ªæœ€ç®€å•çš„C#å‘½ä»¤</h1><p>åœ¨ç»ˆç«¯ä¸­è¾“å…¥ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dotnet new console -o MyApp -f net7.0</span><br><span class="line">cd MyApp</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°å„å‘½ä»¤çš„è§£é‡Šï¼š</p><ul><li><code>dotnet new conslole</code> å‘½ä»¤ç”¨æ¥åˆ›å»ºæ–°çš„console APP</li><li>-<code>o</code>å‚æ•°ä¼šåˆ›å»ºåä¸º<code>MyApp</code>çš„ç›®å½•ï¼Œç”¨äºå­˜å‚¨åº”ç”¨å¹¶ä½¿ç”¨æ‰€éœ€æ–‡ä»¶è¿›è¡Œå¡«å……</li><li><code>-f</code>å‚æ•°æŒ‡ç¤ºconsoleæˆ‘ä»¬åˆ›å»ºçš„æ˜¯.NET7çš„åº”ç”¨ç¨‹åº</li></ul><p>åˆ›å»ºçš„MyAppæ–‡ä»¶å¤¹ä¸­çš„ä¸»æ–‡ä»¶ç§°ä¸º<code>Program..cs</code>ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒåŒ…å«çš„å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Console.WriteLine(<span class="string">&quot;Hello World!&quot;</span>);</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ç»ˆç«¯ä¸­è¿è¡Œ<code>dotnet run</code>æ¥è¿è¡Œ<code>.NET</code>åº”ç”¨ï¼Œç»ˆç«¯ä¸­ä¼šè¾“å‡ºå¦‚ä¸‹ç»“æœï¼š</p><img src="/posts/724ccb4/%E6%88%AA%E5%B1%8F2023-03-10%2016.41.32.png" class=""><h2 id="ä½¿ç”¨Rideræ‰“å¼€å¹¶è¿è¡ŒC-é¡¹ç›®">ä½¿ç”¨Rideræ‰“å¼€å¹¶è¿è¡ŒC#é¡¹ç›®</h2><p>ä½¿ç”¨Rideræ‰“å¼€å¹¶è¿è¡ŒC#é¡¹ç›®ä¸åƒä½¿ç”¨IDEAæ‰“å¼€å¹¶è¿è¡Œjavaä»£ç é‚£æ ·ç¹çï¼Œç›´æ¥åœ¨Riderä¸­é€‰æ‹©<code>File</code>-&gt;<code>Open</code>ï¼Œé€‰æ‹©ä½ ä½¿ç”¨Terminalåˆ›å»ºçš„C# applicationæ‰“å¼€ï¼Œå°±å¯ä»¥åœ¨Riderä¸­è¿è¡Œé¡¹ç›®äº†ã€‚</p><h1>åœ¨Windowsä¸Šé…ç½®dotNetå¼€å‘ç¯å¢ƒ</h1><p>Windowsä¸Šå®‰è£…dotNetçš„æ–¹å¼å¤šç§å¤šæ ·ï¼Œè€Œä¸”å®˜æ–¹çš„æ•™ç¨‹ä¹Ÿå¾ˆè¯¦ç»†ï¼Œå¯ä»¥ç›´æ¥çœ‹<a href="https://learn.microsoft.com/zh-cn/dotnet/core/install/windows?tabs=net70">å®˜ç½‘æ•™ç¨‹</a></p>]]></content>
      
      
      <categories>
          
          <category> ç¡¬æŠ€èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
            <tag> Rider </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨Macå’ŒWindowsä¸Šé…ç½®Javaå¼€å‘ç¯å¢ƒ</title>
      <link href="/posts/f57878ea/"/>
      <url>/posts/f57878ea/</url>
      
        <content type="html"><![CDATA[<h1>èƒŒæ™¯</h1><p>æœ¬æ–‡ä¸»è¦è®°å½•äº†JDKã€JREã€JVMçš„åŒºåˆ«ã€åœ¨Macå’ŒWindowsä¸Šé…ç½®Javaå¼€å‘ç¯å¢ƒã€åˆ›å»ºå¹¶è¿è¡Œæœ€ç®€å•çš„Javaç¨‹åºä»¥åŠå¦‚ä½•å°†å•ä¸ªjavaæ–‡ä»¶å¯¼å…¥<code>IntelliJ IDEA</code>ä¸­è¿è¡Œ</p><h1>JDK JRE JVMçš„åŒºåˆ«ä¸è”ç³»</h1><h2 id="ä»€ä¹ˆæ˜¯JDKï¼Ÿ">ä»€ä¹ˆæ˜¯JDKï¼Ÿ</h2><p>JDKæ˜¯Java Development Kitï¼ŒJDKæ˜¯ç”¨äºåˆ¶ä½œç¨‹åºå’ŒJavaåº”ç”¨ç¨‹åºçš„è½¯ä»¶å¼€å‘ç¯å¢ƒã€‚Javaå¼€å‘äººå‘˜å¯ä»¥åœ¨Windowsã€MacOSã€Linuxä¸Šä½¿ç”¨ï¼Œæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„ç¼–ç¨‹è¯­è¨€ã€‚JDKå¯ä»¥å¸®åŠ©ä»–ä»¬ç¼–å†™å’Œè¿è¡ŒJavaç¨‹åºï¼Œå¯ä»¥åœ¨åŒä¸€å°è®¡ç®—æœºä¸Šé¢å®‰è£…å¤šä¸ªç‰ˆæœ¬çš„JDKã€‚</p><h2 id="ä»€ä¹ˆæ˜¯JREï¼Ÿ">ä»€ä¹ˆæ˜¯JREï¼Ÿ</h2><p>JREæ˜¯Java Runtime Environmentã€‚JREæ˜¯ä¸€ä¸ªæ—¨åœ¨è¿è¡Œå…¶ä»–è½¯ä»¶çš„è½¯ä»¶ï¼Œå®ƒåŒ…å«ç±»åº“ã€åŠ è½½å™¨ç±»å’ŒJVMã€‚ç®€å•æ¥è¯´ï¼Œå¦‚æœæƒ³è¦è¿è¡ŒJavaç¨‹åºï¼Œæˆ‘ä»¬å°±éœ€è¦JREï¼Œå¦‚æœæˆ‘ä»¬åªæ˜¯ä¸€ä¸ªä¸€èˆ¬çš„ç”¨æˆ·ï¼Œå°±ä¸éœ€è¦å®‰è£…JDKï¼Œåªéœ€è¦å®‰è£…JREæ¥è¿è¡ŒJavaç¨‹åºå³å¯ï¼Œä¸è¿‡æ‰€æœ‰çš„JDKç‰ˆæœ¬éƒ½ä¸JREæ†ç»‘åœ¨ä¸€èµ·ï¼Œå› æ­¤æ— éœ€åœ¨PCå•ç‹¬ä¸‹è½½å’Œå®‰è£…JREã€‚</p><h2 id="ä»€ä¹ˆæ˜¯JVMï¼Ÿ">ä»€ä¹ˆæ˜¯JVMï¼Ÿ</h2><p>JVMæ˜¯Java Virtual Machineã€‚JVMæ˜¯ä¸€ä¸ªå¼•æ“ï¼Œå®ƒæä¾›è¿è¡Œæ—¶ç¯å¢ƒé©±åŠ¨Javaä»£ç æˆ–è€…åº”ç”¨ç¨‹åºï¼Œå®ƒå°†Javaå­—èŠ‚ç è½¬æ¢æˆæœºå™¨è¯­è¨€ï¼ŒJVMæ˜¯Javaè¿è¡Œç¯å¢ƒï¼ˆJREï¼‰çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒä¸èƒ½å•ç‹¬ä¸‹è½½å’Œå®‰è£…ã€‚è¦å®‰è£…JVMï¼Œéœ€è¦å®‰è£…JREã€‚</p><h2 id="å°èŠ‚">å°èŠ‚</h2><ul><li>JDKæ˜¯ä¸€ä¸ªè½¯ä»¶å¼€å‘å·¥å…·åŒ…ï¼Œè€ŒJREæ˜¯ä¸€ä¸ªå…è®¸Javaç¨‹åºè¿è¡Œçš„è½¯ä»¶åŒ…ï¼ŒJVMåˆ™æ˜¯ä¸€ä¸ªæ‰§è¡Œå­—èŠ‚ç çš„ç¯å¢ƒã€‚</li><li>JDKçš„å…¨ç§°æ˜¯Java Development Kitï¼ŒJREçš„å…¨ç§°æ˜¯Java Runtime Environmentï¼Œè€ŒJVMçš„å…¨ç§°æ˜¯Java Virtual Machineã€‚</li><li>JDK æ˜¯å¹³å°ç›¸å…³çš„ï¼ŒJRE ä¹Ÿæ˜¯å¹³å°ç›¸å…³çš„ï¼Œä½†æ˜¯ JVM ä¸æ˜¯å¹³å°ç›¸å…³çš„ã€‚</li><li>JDK åŒ…å«å¼€å‘ã€è°ƒè¯•ç­‰å·¥å…·ã€‚JRE åŒ…å«ç±»åº“å’Œå…¶ä»–æ”¯æŒæ–‡ä»¶ï¼Œè€Œè½¯ä»¶å¼€å‘å·¥å…·ä¸åŒ…å«åœ¨ JVM ä¸­ã€‚</li><li>JDK é™„å¸¦å®‰è£…ç¨‹åºï¼Œå¦ä¸€æ–¹é¢ï¼ŒJRE ä»…åŒ…å«æ‰§è¡Œæºä»£ç çš„ç¯å¢ƒï¼Œè€Œ JVM æ†ç»‘åœ¨è½¯ä»¶ JDK å’Œ JRE ä¸­ã€‚</li></ul><img src="/posts/f57878ea/34bd93945111189caf3351ac3c0af3b92a6eed.jpg" class=""><h1>JDKçš„æ–‡ä»¶ç›®å½•</h1><p>åœ¨JDK1.8ä¹‹å‰ï¼ŒJDKçš„æ–‡ä»¶ç›®å½•å¦‚ä¸‹ï¼š</p><img src="/posts/f57878ea/image-20230312172651494.png" class=""><p>ä¸€äº›é‡è¦çš„æ–‡ä»¶å¤¹çš„ä½œç”¨è§£é‡Šå¦‚ä¸‹ï¼š</p><ul><li><p><strong>bin</strong>: è¯¥è·¯å¾„ä¸‹å­˜æ”¾äº†JDKçš„å„ç§å‘½ä»¤ï¼Œå¸¸ç”¨çš„javacã€javaç­‰ã€‚</p></li><li><p><strong>include</strong>: ä¸€äº›å¹³å°ç‰¹å®šçš„å¤´æ–‡ä»¶ï¼Œæ”¯æŒJavaæœ¬åœ°æ¥å£å’ŒJavaè™šæ‹Ÿæœºè°ƒè¯•ç¨‹åºæ¥å£çš„æœ¬åœ°ç¼–ç¨‹æŠ€æœ¯ã€‚</p></li><li><p><strong>jre</strong>: è¿è¡Œjavaç¨‹åºæ‰€å¿…é¡»çš„JREç¯å¢ƒã€‚</p></li><li><p><strong>lib</strong>ï¼šJDKå·¥å…·å‘½ä»¤çš„å®é™…æ‰§è¡Œç¨‹åºï¼Œbinè·¯å¾„ä¸‹çš„ç»å¤§éƒ¨åˆ†å‘½ä»¤éƒ½æ˜¯åŒ…è£…äº†tools.jarå¦‚ï¼ˆlib-&gt;tools.jar-&gt;sun\tools\javac\Main.class javacå‘½ä»¤çš„å®é™…æ‰§è¡Œç±»ï¼›binä¸‹çš„javac.exeå‘½ä»¤å®é™…ä¸Šä»…ä»…åŒ…è£…äº†è¿™ä¸ªJavaç±»ï¼‰ã€‚</p></li></ul><p>ä½†åœ¨1.8ç‰ˆæœ¬ä¹‹åï¼Œåœ¨å®‰è£…JDKçš„æ—¶å€™å°±ä¸å¸¦æœ‰<code>jre</code>è¿™ä¸ªæ–‡ä»¶å¤¹äº†ï¼Œå…·ä½“åŸå› å¹¶ä¸æ¸…æ¥šï¼Œä½†æ˜¯åœ¨ç›®å‰çš„ä½¿ç”¨ä¸­jreæ–‡ä»¶å¤¹çš„ç¼ºå¤±å¹¶æ²¡æœ‰é€ æˆä»€ä¹ˆå½±å“ï¼Œä¸è¿‡ä¸ºäº†ä¿æŒJDKçš„å®Œæ•´æ€§ï¼Œæˆ‘è¿˜æ˜¯è¦å°†jreæ·»åŠ åˆ°jdkçš„ç›®å½•ä¸‹ã€‚</p><p>æ— è®ºæ˜¯Macè¿˜æ˜¯Windowséƒ½å…ˆè¿›å…¥åˆ°JDKçš„æ ¹ç›®å½•ä¸‹ï¼Œç„¶ååˆ†åˆ«åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼š</p><p>Windowsä¸‹éœ€è¦è¾“å…¥:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin\jlink.exe --module-path jmods --add-modules java.desktop --output jre</span><br></pre></td></tr></table></figure><p>Macä¸‹éœ€è¦è¾“å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/jlink --module-path jmods --add-modules java.desktop --output jre</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œä¸Šé¢çš„æŒ‡ä»¤ï¼Œjreå°±æ·»åŠ åˆ°JDKçš„æ–‡ä»¶å¤¹é‡Œé¢äº†ã€‚</p><h1>Macä¸Šé…ç½®JDK</h1><p>Armæ¶æ„çš„Macå’ŒX86æ¶æ„çš„Macå®‰è£…çš„JDKæ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™æ˜¯JDKçš„<a href="https://www.oracle.com/java/technologies/downloads/#java11-mac">ä¸‹è½½åœ°å€</a>ï¼Œæˆ‘ä»¬è¦é€‰æ‹©MacOSä¸‹çš„<code>Arm 64 Compressed Archive</code>è¿›è¡Œä¸‹è½½ã€‚</p><p>ä¸‹è½½å®Œæˆä¹‹åï¼Œæ‰“å¼€ç»ˆç«¯å¹¶è¾“å…¥ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bash_profile</span><br></pre></td></tr></table></figure><p>æ‰“å¼€æ–‡ä»¶åè¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># é…ç½®JDK11 ç¯å¢ƒå˜é‡ </span><br><span class="line"># JAVA_HOMEï¼šJDKå®‰è£…è·¯å¾„ï¼ˆä¿®æ”¹æˆä½ è‡ªå·±çš„ï¼‰</span><br><span class="line">export JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk-11/Contents/Home</span><br><span class="line"># $JAVA_HOME/bin ä¸‹é¢æ˜¯JDKçš„å„ç§å‘½ä»¤  </span><br><span class="line">export PATH=$JAVA_HOME/bin:$PATH:.</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¾“å…¥<code>source ~/.bash_profile</code>ä½¿åˆšæ‰é…ç½®çš„æ–‡ä»¶ç”Ÿæ•ˆï¼Œæ¥ç€è¾“å…¥<code>java -version</code>æŸ¥çœ‹JDKæ˜¯å¦å®‰è£…æˆåŠŸ ã€‚åˆ°è¿™é‡Œè¿˜æ²¡æœ‰ç»“æŸï¼Œå¦‚æœæˆ‘ä»¬é‡å¯ç»ˆç«¯å†è¾“å…¥<code>java -version</code>æ˜¯ä¼šæŠ¥é”™çš„ï¼ŒåŸå› æ˜¯é‡å¯åçš„ç»ˆç«¯å¹¶æ²¡æœ‰è®©<code>.bash_profile</code>é…ç½®æ–‡ä»¶ç”Ÿæ•ˆï¼Œæ‰€ä»¥æˆ‘éœ€è¦åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œ<code>vim ~/.zshrc</code>ï¼Œåœ¨æœ€åä¸€è¡Œæ·»åŠ <code>source ~/.bash_profile</code>ï¼Œä¿å­˜åé€€å‡ºï¼Œç„¶åæ‰§è¡Œ<code>source ~/.zshrc</code>ï¼Œè¿™æ ·å°±å¯ä»¥è®©ç»ˆç«¯æ¯æ¬¡å¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨å°†<code>./bash_profile</code>é…ç½®æ–‡ä»¶ç”Ÿæ•ˆã€‚</p><h1>åœ¨Windowsä¸Šé…ç½®JDKç¯å¢ƒ</h1><p>ä½¿ç”¨è¿™ä¸ª<a href="https://www.oracle.com/java/technologies/downloads">ä¸‹è½½åœ°å€</a>ä¸‹è½½Windowsç‰ˆæœ¬çš„JDKã€‚</p><img src="/posts/f57878ea/image-20230312090840861.png" class=""><p>ä¸‹è½½åˆ—è¡¨ä¸­æœ‰ä¸€ä¸ª<code>Compressed Archive</code>å’Œä¸€ä¸ª<code>installer</code>ï¼ŒäºŒè€…çš„åŒºåˆ«æ˜¯ï¼š<code>Compressed Archive</code>åªä¼šä¸‹è½½jdkçš„æ–‡ä»¶ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»é…ç½®ç¯å¢ƒï¼Œé…ç½®çš„æ–¹æ³•ç¨åä¼šæåŠï¼Œå…ˆè¯´<code>installer</code>æ˜¯ä»€ä¹ˆï¼š<code>installer</code>ä¸‹è½½çš„æ˜¯ä¸€ä¸ªå®‰è£…å™¨ï¼Œä¼šå¸®åŠ©æˆ‘ä»¬å°†<code>Compressed Archive</code>ä¸­ä¸‹è½½çš„jdkæ–‡ä»¶å®‰è£…åˆ°æŒ‡å®šè·¯å¾„ã€‚å¹¶ä¸”ç¯å¢ƒå˜é‡ä¸­ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€æ¡å˜é‡ï¼š</p><img src="/posts/f57878ea/image-20230312093657005.png" class=""><p>åœ¨è¿™ç§æƒ…å†µä¸‹ç›´æ¥æ‰“å¼€ç»ˆç«¯ï¼Œ<code>java</code>å’Œ<code>javac</code>å‘½ä»¤éƒ½æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨çš„,è¿™æ˜¯å› ä¸º<code>installer</code>åœ¨ä¸ºæˆ‘ä»¬å®‰è£…jdkçš„æ—¶å€™ä¹Ÿå°†è¿™äº›å·¥å…·å¤åˆ¶åˆ°äº†è¿™ä¸ªè·¯å¾„ä¸‹ã€‚</p><img src="/posts/f57878ea/image-20230312094042102.png" class=""><p>é€šè¿‡installerçš„æ–¹æ³•è™½ç„¶è¯´ä¹Ÿå¯ä»¥å®Œæˆjdkçš„å®‰è£…ï¼Œä½†æ˜¯å’Œæ‰‹åŠ¨é…ç½®jdkä»è‡ªç”±åº¦ä¸Šæ¥è®²è¿˜æ˜¯æœ‰å·®åˆ«çš„ï¼Œä¸‹é¢ä»‹ç»å¦‚ä½•ä½¿ç”¨<code>Compressed Archive</code>æ¥é…ç½®jdkã€‚</p><p>è¿™æ˜¯æˆ‘jdkçš„å­˜æ”¾è·¯å¾„ï¼š</p><img src="/posts/f57878ea/image-20230312094543160.png" class=""><p>æˆ‘ä»¬æ‰“å¼€ç¯å¢ƒå˜é‡ï¼Œåˆ›å»ºä¸¤ä¸ªæ–°çš„ç³»ç»Ÿå˜é‡ï¼š<code>JAVA_HOME</code>å’Œ<code>CLASSPATH</code>ï¼Œå˜é‡å€¼å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å…·ä½“å€¼éœ€è¦æŒ‰ç…§ä¸åŒçš„ç‰ˆæœ¬å’Œè®¾å¤‡åšä¿®æ”¹</span></span><br><span class="line">D:\ä¸‹è½½\jdk-19_windows-x64_bin\jdk-19.0.2</span><br><span class="line">.;%JAVA_HOME%\lib\dt.jar;%JAVA_HOME%\lib\tools.jar</span><br></pre></td></tr></table></figure><img src="/posts/f57878ea/image-20230312170104688.png" class=""><img src="/posts/f57878ea/image-20230312170141595.png" class=""><p>æœ€ååœ¨ç¯å¢ƒå˜é‡ä¸­æ‰¾åˆ°Pathï¼Œæ–°å»ºä¸‹é¢ä¸¤ä¸ªå˜é‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">D:\ä¸‹è½½\jdk-19_windows-x64_bin\jdk-19.0.2\bin</span><br><span class="line">D:\ä¸‹è½½\jdk-19_windows-x64_bin\jdk-19.0.2\jre\bin</span><br></pre></td></tr></table></figure><p>æ·»åŠ å®Œæˆä¹‹åé‡å¯ç»ˆç«¯ï¼Œè¾“å…¥<code>java</code>ï¼Œçœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ä»£è¡¨é…ç½®æˆåŠŸäº†ã€‚</p><img src="/posts/f57878ea/image-20230312170856996.png" class=""><h1>åœ¨Macå’ŒWindowsä¸Šä¸å€ŸåŠ©ä»»ä½•IDEè¿è¡ŒJavaè„šæœ¬</h1><p><span id = "1">æˆ‘ä»¬ç°åœ¨åªä¼šç”¨åˆ°ä¸¤ä¸ªå‘½ä»¤<code>java</code>å’Œ<code>javac</code>ï¼Œæˆ‘ä»¬ç¼–å†™ä¸€ä¸ª<code>hello.java</code>æ–‡ä»¶ï¼Œæ³¨æ„æ–‡ä»¶åè¦å’Œç±»åä¸€æ ·ï¼š</span></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">hello</span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// mainå‡½æ•°çš„æ‹¼å†™éƒ½æ˜¯å°å†™çš„ï¼Œå¤§å°å†™æ•æ„Ÿ</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;HelloWorld!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬åœ¨ç»ˆç«¯ä¸­ä¾æ¬¡æ‰§è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">javacå‘½ä»¤ä¼šå°†.javaæ–‡ä»¶ç¼–è¯‘æˆclassæ–‡ä»¶</span></span><br><span class="line">javac hello.java</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">javaå‘½ä»¤ä¼šè¿è¡Œclassæ–‡ä»¶</span></span><br><span class="line">java hello</span><br></pre></td></tr></table></figure><h1>ä½¿ç”¨IntelliJ IDEAæ‰“å¼€å¹¶è¿è¡Œjavaæ–‡ä»¶</h1><h2 id="èƒŒæ™¯">èƒŒæ™¯</h2><p>æˆ‘ä½¿ç”¨è®°äº‹æœ¬æˆ–è€…<code>Sublime</code>ç­‰Text Editorç¼–å†™äº†ä¸€ä¸ªjavaæ–‡ä»¶ï¼Œæˆ‘æƒ³è¦åœ¨IDEAä¸­è¿è¡Œè¿™ä¸ªjavaç¨‹åºï¼Œæˆ‘è¯¥æ€ä¹ˆåšï¼Ÿ</p><h2 id="IntelliJ-IDEAä¸­javaé¡¹ç›®çš„æ–‡ä»¶ç»“æ„">IntelliJ IDEAä¸­javaé¡¹ç›®çš„æ–‡ä»¶ç»“æ„</h2><p>æˆ‘å…ˆä½¿ç”¨IDEAåˆ›å»ºä¸€ä¸ªéå¸¸ç®€å•çš„Javaé¡¹ç›®ï¼Œé¡¹ç›®çš„æ–‡ä»¶ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><img src="/posts/f57878ea/image-20230310111924493.png" class=""><ul><li><code>.idea</code>ç›®å½•å’Œ<code>iml</code>æ–‡ä»¶æ˜¯IDEAçš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥éšè—</li><li><code>src</code>ç›®å½•æ˜¯ä»£ç æºæ–‡ä»¶å­˜æ”¾çš„ç›®å½•</li><li><code>out</code>æ˜¯Javaç¨‹åºçš„è¾“å‡ºç›®å½•ï¼Œå­˜æ”¾å­—èŠ‚ç æ–‡ä»¶</li><li><code>external Libraries</code>æ˜¯JDKçš„æ‰©å±•ç±»åº“</li></ul><h2 id="ä½¿ç”¨IDEAè¿è¡Œå•ä¸ªjavaç¨‹åº">ä½¿ç”¨IDEAè¿è¡Œå•ä¸ªjavaç¨‹åº</h2><p>æƒ³è¦ä½¿ç”¨IDEAè¿è¡Œjavaé¡¹ç›®ï¼Œå°±éœ€è¦è¿™ä¸ªé¡¹ç›®èƒ½å¤Ÿç¬¦åˆIDEAé¡¹ç›®çš„æ–‡ä»¶ç»“æ„ï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥å°†å•ä¸ªjavaæ–‡ä»¶æ”¾å…¥IDEAä¸­è¿è¡Œï¼š</p><p><strong>æ–¹æ³•ä¸€</strong></p><p>åœ¨IDEAä¸­é€‰æ‹©<code>File</code>-&gt;<code>Open</code>-&gt;æ‰“å¼€javaæ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹</p><img src="/posts/f57878ea/%E6%88%AA%E5%B1%8F2023-03-1016.55.36.png" class=""><p>æ‰“å¼€æ–‡ä»¶å¤¹åç‚¹å‡»<code>File</code>-&gt;<code>Project Structure</code>ï¼Œä¸ºé¡¹ç›®é…ç½®<code>jdk</code>å’Œ<code>output</code>æ–‡ä»¶å¤¹ï¼Œç‚¹å‡»Applyï¼Œè¿”å›é¡¹ç›®å°±å¯ä»¥è¿è¡Œäº†ã€‚</p><img src="/posts/f57878ea/%E6%88%AA%E5%B1%8F2023-03-1017.15.25.png" class=""><p><strong>æ–¹æ³•äºŒ</strong></p><p>ç›´æ¥åœ¨IDEAä¸­æ–°å»ºé¡¹ç›®ï¼Œé€‰æ‹©ä¸å‹¾é€‰æ·»åŠ ç¤ºä¾‹ä»£ç ã€‚</p><img src="/posts/f57878ea/%E6%88%AA%E5%B1%8F2023-03-1017.22.02.png" class=""><p>é¡¹ç›®æ‰“å¼€åå°†æƒ³è¦è¿è¡Œçš„javaä»£ç æ‹–åˆ°srcä¸­å»ï¼Œç„¶åå°±å¯ä»¥è¿è¡Œäº†ã€‚</p><h1>Java:main()å‡½æ•°çš„ä¸€äº›çŸ¥è¯†ç‚¹</h1><p>ä¸Šæ–‡ä¸­å·²ç»å±•ç¤ºäº†ä¸€ä¸ª<a href="#1">æœ€ç®€å•çš„Javaç¨‹åº</a>ï¼Œ<code>main</code>å‡½æ•°çš„å‰é¢æœ‰ä¸¤ä¸ªå±æ€§ï¼š<code>public</code>å’Œ<code>static</code>ï¼Œä¸¤ä¸ªå±æ€§æ˜¯å¿…é¡»è¦æœ‰çš„ï¼Œå¦åˆ™Javaç¨‹åºå°†æ— æ³•æ­£å¸¸è¿è¡Œã€‚</p><h2 id="ä¸ºä»€ä¹ˆè¦static">ä¸ºä»€ä¹ˆè¦static</h2><p>Mainæ–¹æ³•æ˜¯Javaç¨‹åºçš„å…¥å£ï¼ŒJVMä¼šæŸ¥æ‰¾ç±»ä¸­çš„<code>public static void main(String[] args)</code>ï¼Œå¦‚æœæ‰¾ä¸åˆ°è¯¥æ–¹æ³•å°±ä¼šæŠ›å‡ºé”™è¯¯<code>NoSuchMethodError:main</code>ç»ˆæ­¢ç¨‹åºMainæ–¹æ³•å¿…é¡»ä¸¥æ ¼éµå¾ªå®ƒçš„è¯­æ³•è§„åˆ™ï¼Œæ–¹æ³•ç­¾åå¿…é¡»æ˜¯public static voidï¼Œå‚æ•°ç±»å‹æ˜¯Stringç±»å‹ï¼Œåœ¨Java1.5ä»¥åŠä»¥åçš„ç‰ˆæœ¬è¿˜å¯ä»¥ä½¿ç”¨å¯å˜çš„å‚æ•°ï¼š<code>public static void main(String ... args)</code>ã€‚</p><p>JVMè°ƒç”¨mainæ–¹æ³•çš„ä»¥åä¸éœ€è¦åˆ›å»ºä»»ä½•åŒ…å«è¿™ä¸ªmainæ–¹æ³•çš„å®ä¾‹ï¼Œå¦‚æœmainæ–¹æ³•ä¸å£°æ˜ä¸ºé™æ€çš„ï¼ŒJVMå°±å¿…é¡»åˆ›å»ºmainç±»çš„å®ä¾‹ï¼Œå› ä¸ºæ„é€ å™¨å¯ä»¥è¢«é‡è½½ï¼ŒJVMæ²¡åŠæ³•ç¡®å®šè°ƒç”¨çš„æ˜¯å“ªä¸ªmainæ–¹æ³•ã€‚é™æ€æ–¹æ³•å’Œé™æ€æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­å°±å¯ä»¥ç›´æ¥è°ƒç”¨è€Œä¸éœ€è¦åƒå®ä¾‹æ–¹æ³•ä¸€æ ·åˆ›å»ºå®ä¾‹åæ‰å¯ä»¥è¢«è°ƒç”¨ï¼Œå¦‚æœmainæ–¹æ³•æ˜¯é™æ€çš„ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè¢«åŠ è½½åˆ°JVMä¸Šä¸‹æ–‡ä¸­æˆä¸ºå¯æ‰§è¡Œçš„æ–¹æ³•ã€‚</p><h2 id="ä¸ºä»€ä¹ˆè¦public">ä¸ºä»€ä¹ˆè¦public</h2><p>JavaæŒ‡å®šäº†ä¸€äº›å¯è®¿é—®çš„ä¿®é¥°ç¬¦ï¼Œæ¯”å¦‚privateã€protectedã€publicï¼Œä»»ä½•æ–¹æ³•æˆ–è€…å˜é‡éƒ½å¯ä»¥å£°æ˜ä¸ºpublicï¼ŒJavaå¯ä»¥ä»è¯¥ç±»ä¹‹å¤–çš„åœ°æ–¹è®¿é—®ã€‚å› ä¸ºmainæ–¹æ³•æ˜¯å…¬å…±çš„ï¼ŒJVMå°±å¯ä»¥è½»æ¾çš„è®¿é—®å’Œæ‰§è¡Œå®ƒã€‚</p><h3 id="ä¸ºä»€ä¹ˆæ˜¯void">ä¸ºä»€ä¹ˆæ˜¯void</h3><p>å› ä¸ºmainè¿”å›ä»»ä½•å€¼å¯¹ç¨‹åºéƒ½æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œæ‰€ä»¥è®¾ç½®æˆvoidã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¡¬æŠ€èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> IDEA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Riderå’ŒUnityè¿›è¡Œæ¸¸æˆå¼€å‘åˆæ¢</title>
      <link href="/posts/61a4721e/"/>
      <url>/posts/61a4721e/</url>
      
        <content type="html"><![CDATA[<h1>æœ¬æ–‡è®°å½•çš„é—®é¢˜</h1><p><a href="#1">è§£å†³M1Mac â€œæ— æ³•æ‰“å¼€åº”ç”¨ï¼Œå› ä¸ºAppleæ— æ³•æ£€æŸ¥å…¶æ˜¯å¦åŒ…å«æ¶æ„è½¯ä»¶â€ çš„é—®é¢˜</a></p><p><a href="#2">åœ¨Macä¸Šå®‰è£…å¤šä¸ªç‰ˆæœ¬çš„Unityï¼Œå¹¶ä¸”ä¸ºæ¯ä¸ªç‰ˆæœ¬å®‰è£…æ‰©å±•modules</a></p><p>å¦‚ä½•ä½¿ç”¨Rideråˆ›å»ºä¸€ä¸ªæ™®é€šçš„C#å·¥ç¨‹ï¼Ÿå®ƒçš„æ–‡ä»¶ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>ä»€ä¹ˆæ˜¯namespaceï¼Ÿå®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆè¯¥é—®é¢˜åœ¨<a href="http://soincredible777.com.cn/posts/73546a6d/">è¿™ç¯‡æ–‡ç« </a>ä¸­å¾—åˆ°äº†è§£å†³ï¼‰</p><h1>èƒŒæ™¯</h1><p>ä»Šå¤©æ˜¯2023å¹´3æœˆ7å·ï¼Œæˆ‘å…¥èŒçš„ç¬¬ä¸‰å¤©ï¼Œå…¬å¸å¼ºåˆ¶ä½¿ç”¨Unityæ­é…Riderè¿›è¡Œå¼€å‘ï¼Œæ–‡æœ¬ä¼šè®°å½•å¦‚ä½•ä½¿ç”¨Rideråˆ›å»ºç®€å•çš„C#å·¥ç¨‹ï¼Œå¹¶ä¸”äº†è§£é¡¹ç›®çš„æ–‡ä»¶ç»“æ„ã€‚</p><p>åœ¨ä»Šå¤©çš„å·¥ä½œä¸­ä¹Ÿé‡åˆ°äº†å…¶ä»–çš„é—®é¢˜ï¼Œä¹Ÿå°†åœ¨æœ¬æ–‡ä¸­åšè®°å½•ã€‚</p><h1><span id = "2">åœ¨Macä¸Šå®‰è£…å¤šä¸ªç‰ˆæœ¬çš„Unityå’Œå¯¹åº”çš„modules</span></h1><p>å…¬å¸ä½¿ç”¨çš„Unityç‰ˆæœ¬ä¸º<code>2021.3.14f1</code>ï¼Œæˆ‘è‡ªå·±åšé¡¹ç›®ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯<code>2021.3.8f1c1</code>ï¼Œè¿™ä¸¤ä¸ªç‰ˆæœ¬åœ¨UnityHubä¸­çš„Installerä¸­éƒ½æ˜¯æ‰¾ä¸åˆ°çš„ï¼Œéœ€è¦å»å®˜ç½‘çš„<code>Archive</code>ä¸­ä¸‹è½½ã€‚</p><img src="/posts/61a4721e/image-20230307212335202.png" class="" title="image-20230307212335202"><p>è¿™é‡Œæ˜¯å®˜ç½‘çš„å½’æ¡£ï¼Œæ„Ÿè°¢å®‡å“¥çš„å°TIPSï¼šç‰ˆæœ¬å·ä¸­å¸¦c1çš„æ˜¯åœ¨Unityä¸­æ–‡å®˜ç½‘ä¸Šä¸‹è½½çš„ï¼Œä¸å¸¦c1çš„æ˜¯åœ¨Unityçš„è‹±æ–‡å®˜ç½‘ä¸Šä¸‹è½½çš„ã€‚è¿™æ˜¯Unityçš„<a href="https://unity.com/releases/editor/archive">è‹±æ–‡ç‰ˆæœ¬å½’æ¡£åœ°å€</a>ï¼Œè¿™æ˜¯<a href="https://unity.cn/releases/full/2021">ä¸­æ–‡ç‰ˆæœ¬å½’æ¡£åœ°å€</a>ã€‚</p><p><span id = "1">ä¸‹è½½å®Œæˆä¹‹åï¼Œåœ¨æ‰“å¼€<code>pkg</code>åŒ…çš„æ—¶å€™ä¼šå¼¹å‡ºâ€œ<strong>æ— æ³•æ‰“å¼€åº”ç”¨ï¼Œå› ä¸ºAppleæ— æ³•æ£€æŸ¥å…¶æ˜¯å¦åŒ…å«æ¶æ„è½¯ä»¶</strong>â€çš„é—®é¢˜ï¼Œè§£å†³æ–¹æ³•æ˜¯åœ¨ç»ˆç«¯ä¸­è¾“å…¥ï¼š</span></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo spctl --master-disable</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰“å¼€<code>è®¾ç½®</code>-&gt;<code>å®‰å…¨æ€§ä¸éšç§</code>-&gt;<code>é€šç”¨</code>ï¼Œé€‰æ‹©ä»»ä½•æ¥æºï¼Œå°±å¯ä»¥æ‰“å¼€åˆšæ‰ä¸‹è½½çš„å®‰è£…åŒ…äº†ã€‚</p><img src="/posts/61a4721e/%E6%88%AA%E5%B1%8F2023-03-08%2011.39.29.png" class="" title="æˆªå±2023-03-08 11.39.29"><p>ä¸‹é¢æ˜¯æ¼”ç¤ºå¦‚ä½•åœ¨Macä¸Šå®‰è£…å¤šä¸ªç‰ˆæœ¬çš„Unityã€‚Macç³»ç»Ÿä¼šå°†Unity Editorå®‰è£…åœ¨<code>Applications/Unity</code>è¿™ä¸ªæ–‡ä»¶ç›®å½•ï¼Œå¦‚æœç”µè„‘ä¸­æ²¡æœ‰è¿™ä¸ªç›®å½•åˆ™ä¼šè‡ªåŠ¨åˆ›å»ºã€‚åœ¨å®‰è£…moduleçš„æ—¶å€™ï¼Œå¿…é¡»é¦–å…ˆç¡®ä¿<code>Applications/Unity</code>è·¯å¾„å­˜åœ¨ï¼Œç„¶åç¡®ä¿è¯¥è·¯å¾„ä¸­æœ‰è¦å®‰è£…çš„moduleå¯¹åº”ç‰ˆæœ¬çš„Unity Editorï¼Œå¦åˆ™moduleä¼šå®‰è£…å¤±è´¥ã€‚æˆåŠŸå®‰è£…çš„moduleä¼šæ”¾åœ¨<code>Applications/Unity/PlaybackEngines</code>ç›®å½•ä¸‹ã€‚è¿™æ˜¯æ•´ä¸ªç›®å½•çš„ç»“æ„ï¼š</p><img src="/posts/61a4721e/image-20230308110717748.png" class="" title="image-20230308110717748"><p>ç°åœ¨æˆ‘è¦å®‰è£…<code>Unity2021.3.14f1</code>å’Œ<code>Unity2021.3.8f1c1</code>ä¸¤ä¸ªç‰ˆæœ¬çš„Editorå’Œå„è‡ªå¯¹åº”çš„<code>iOS</code>ã€<code>Android</code>ã€<code>MacOS</code>ã€<code>Windows</code>çš„moduleã€‚æˆ‘å…ˆå®‰è£…äº†<code>2021.3.14f1</code>ç‰ˆæœ¬ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»º<code>Applications/Unity</code>è·¯å¾„ï¼Œç„¶åæˆ‘ä¹Ÿå®Œæˆäº†å¯¹åº”ç‰ˆæœ¬moduleçš„å®‰è£…ã€‚è¿™æ—¶å¦‚æœç»§ç»­å®‰è£…<code>2021.3.8f1c1</code>çš„è¯ï¼Œç³»ç»Ÿä¼šç›´æ¥è¦†ç›–æ‰<code>Applications/Unity</code>ä¸­<code>2021.3.14f1</code>è¿™ä¸ªç‰ˆæœ¬çš„Editorï¼Œæ‰€ä»¥æˆ‘å…ˆæŠŠè¿™ä¸ªæ–‡ä»¶å¤¹çš„åå­—æ”¹æˆäº†<code>2021.3.8f1c1</code>ï¼Œç„¶åå†å®‰è£…æ–°ç‰ˆæœ¬çš„Editorï¼Œè¿™æ ·ç³»ç»Ÿåˆä¼šè‡ªåŠ¨åˆ›å»º<code>Applications/Unity</code>è¿™ä¸ªè·¯å¾„ï¼Œå¹¶åœ¨è¯¥è·¯å¾„ä¸‹å®‰è£…æ–°ç‰ˆæœ¬çš„Editorå’Œmoduleï¼Œå°±ä¸ä¼šå‡ºç°è¦†ç›–çš„é—®é¢˜äº†ã€‚æ–°ç‰ˆæœ¬çš„Editorå’Œmoduleå®‰è£…å®Œæˆä¹‹åæœ€å¥½å°†æ–‡ä»¶å¤¹çš„åå­—æ”¹æˆEditorå¯¹åº”çš„ç‰ˆæœ¬å·æ¥æ–¹ä¾¿ç®¡ç†ï¼Œæ¯”å¦‚<code>2021.3.14f1</code>ã€‚å¦‚æœä¹‹åéœ€è¦ç»™æŸä¸€ä¸ªç‰ˆæœ¬å®‰è£…æ–°çš„moduleï¼Œéœ€è¦å…ˆæŠŠè¯¥ç‰ˆæœ¬çš„æ–‡ä»¶å¤¹åæ”¹å›<code>Unity</code>ï¼Œç„¶åå†å®‰è£…moduleï¼Œå®‰è£…æˆåŠŸä¹‹åå°†æ–‡ä»¶å¤¹åå†æ”¹å›å¯¹åº”çš„ç‰ˆæœ¬å·ã€‚ç°åœ¨æˆ‘çš„Macä¸Šå°±æœ‰ä¸¤ä¸ªç‰ˆæœ¬çš„UnityEditoräº†ğŸ¤¤ğŸ¤¤ğŸ¤¤</p><img src="/posts/61a4721e/%E6%88%AA%E5%B1%8F2023-03-08%2011.25.15.png" class=""><p>æœ€åå†è®°å½•ä¸€ä¸ªå°é—®é¢˜ï¼šæˆ‘æ¯ä¸ªEditorç‰ˆæœ¬éƒ½ä¸‹è½½äº†å››ä¸ªmoduleï¼š<code>iOS</code>ã€<code>Android</code>ã€<code>Windows</code>ã€<code>MacOS</code>ï¼Œå‰ä¸‰ä¸ªå®‰è£…å®Œæˆä¹‹åéƒ½ä¼šåœ¨<code>PlaybackEngines</code>æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶ï¼Œå”¯ç‹¬MacOSçš„moduleå®‰è£…æˆåŠŸä¹‹åä¸ä¼šå‡ºç°åœ¨<code>PlaybackEngines</code>çš„æ–‡ä»¶å¤¹é‡Œï¼Œæˆ‘è®¤ä¸ºå¯èƒ½æ˜¯å› ä¸ºæˆ‘çš„ç”µè„‘æœ¬èº«å°±æ˜¯MacOSï¼Œæ¢è¨€ä¹‹ï¼Œå¦‚æœæˆ‘çš„ç”µè„‘æ˜¯Windowsï¼Œé‚£åœ¨<code>Playback Engines</code>è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹å¯èƒ½å°±æ²¡æœ‰Windowsç›¸å…³çš„moduleäº†ï¼Œè¿™ä¸ªé—®é¢˜å¯èƒ½ä¸ç”µè„‘çš„ç³»ç»Ÿæœ‰å…³ã€‚</p><img src="/posts/61a4721e/image-20230308112954910.png" class="" title="image-20230308112954910"><h1>Riderä½¿ç”¨æŠ€å·§</h1><ul><li>BookMarkçš„ä½¿ç”¨</li></ul>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ–‡æ¡£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
            <tag> Unity </tag>
            
            <tag> Rider </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unityé—®é¢˜æ‚è®°</title>
      <link href="/posts/127bc3c9/"/>
      <url>/posts/127bc3c9/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬ç¯‡åšå®¢è®°å½•ç¬”è€…åœ¨Unityå¼€å‘ä¸­é‡åˆ°çš„å„ç§å°é—®é¢˜ï¼Œæœ‰å¯èƒ½æ˜¯Unityå¥‡æ€ªçš„bugã€Unity Editorçš„ä½¿ç”¨å°æŠ€å·§æˆ–è€…æ˜¯ä¸€äº›ä¸å€¼å¾—å¼€ä¸€ç¯‡æ–°åšå®¢çš„å°çŸ¥è¯†ç‚¹</p></blockquote><h1>Unity Scriptable Objectè¸©å‘</h1><p>ä¸‹é¢æ˜¯ä¸€ä¸ªåä¸º<code>EntityBaseProperty.cs</code>çš„è„šæœ¬ï¼Œä½†æ˜¯åœ¨åˆ›å»ºä¸€ä¸ª<code>PlayerEntityProperty</code>SOçš„æ—¶å€™ä¼šæç¤ºä½ æ‰¾ä¸åˆ°è¿™ä¸ªè„šæœ¬ã€‚ä½ å¿…é¡»è®©è„šæœ¬çš„åå­—å’ŒSOçš„ç±»åä¿æŒä¸€è‡´ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªSOéƒ½è¦æ–°å»ºä¸€ä¸ªå’ŒSOç±»å‘½ä¸€æ ·çš„è„šæœ¬æ¥å†™ã€‚</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EntityBaseProperty</span> : <span class="title">ScriptableObject</span></span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[<span class="meta">CreateAssetMenu(fileName = <span class="string">&quot;PlayerEntityProperty&quot;</span>, menuName = <span class="string">&quot;CreatePlayerEntityProperty&quot;</span>, order = 0)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerEntityProperty</span> : <span class="title">CharacterProperty</span></span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1>Unityé¡¹ç›®ä»£ç æ­£å¸¸è¿è¡Œä½†æ˜¯åœ¨Riderä¸­å¤§é‡æŠ¥çº¢</h1><p>Riderçš„<code>solution wide analysis</code>ç»„ä»¶æœ‰é—®é¢˜ï¼Œåœ¨Unityçš„<code>Settings -&gt; External Tools -&gt; Regenerate project files</code>è§£å†³ã€‚<br>ä¹Ÿæœ‰å¯èƒ½æ˜¯Unityç¼–è¯‘é¡¹ç›®çš„dllå‡ºé—®é¢˜äº†, åˆ é™¤æ‰Unityå·¥ç¨‹ä¸­<code>Library/ScriptAssemblies</code>ç›®å½•, é‡æ–°æ‰“å¼€Unity, è®©å®ƒé‡æ–°ç¼–è¯‘ä¸€ä¸‹</p><h1>GetComponentsInChildrenæ¥å£</h1><p>GetComponentsInChildrenæ–¹æ³•ä¸­è¦ä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°çš„ä½œç”¨æ˜¯æ˜¯å¦åŒ…æ‹¬å¤„äºéæ¿€æ´»çŠ¶æ€çš„èŠ‚ç‚¹ï¼Œé»˜è®¤æ˜¯false</p><h1>GetComponentInParentæ¥å£</h1><p>GetComponentInParentæ–¹æ³•ä¸­è¦ä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°çš„ä½œç”¨æ˜¯æ˜¯å¦åŒ…æ‹¬å¤„äºéæ¿€æ´»çŠ¶æ€çš„èŠ‚ç‚¹ï¼Œé»˜è®¤æ˜¯false</p><h1>DoTween</h1><p>DoTweenä¸ä»…å¯ä»¥ç”¨æ¥åšåŠ¨ç”»ï¼Œä¹Ÿå¯ä»¥å®ç°éŸ³é¢‘å‡å¼±ã€å›¾ç‰‡çš„æ¸æ˜¾æ“ä½œã€‚</p><h1>SpineåŠ¨ç”»çš„ä½¿ç”¨</h1><p>SpineåŠ¨ç”»æœ‰ä¸€ä¸ªä¸“é—¨é’ˆå¯¹UIçš„ç»„ä»¶å«åšSkeletonGraphicï¼ŒSkeletonGraphicç»„ä»¶æ˜¯åŸºäºUICanvasç»˜åˆ¶çš„ï¼Œå› æ­¤å®ƒçš„æ¸²æŸ“å±‚çº§å¯ä»¥è¢«Canvasç®¡ç†<br>å¦å¤–è¿˜æœ‰ä¸“é—¨ä¸ºéUIæ’­æ”¾åŠ¨ç”»çš„SkeletonAnimationç»„ä»¶ï¼Œè¯¥ç»„ä»¶çš„æ¸²æŸ“æ˜¯åŸºäºMeshRendererçš„ï¼Œå› æ­¤ä¸å—Canvasçš„ç®¡ç†ï¼Œå½“è¦åœ¨UIä¸Šå±•ç¤ºSpineåŠ¨ç”»çš„æ—¶å€™ï¼Œè¦é€‰æ‹©ä½¿ç”¨SkeletonGraphicç»„ä»¶ã€‚</p><p>SkeletonGraphicç›¸å…³æ¥å£</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœæ­¢å½“å‰æ­£åœ¨æ’­æ”¾çš„åŠ¨ç”»</span></span><br><span class="line"><span class="comment">// heartBeatFlower.AnimationState.ClearTrack(0);    </span></span><br><span class="line">heartBeatFlower.AnimationState.SetEmptyAnimation(<span class="number">0</span>,<span class="number">0</span>); </span><br><span class="line"><span class="comment">// æ’­æ”¾æ–°çš„åŠ¨ç”»</span></span><br><span class="line">heartBeatFlower.AnimationState.SetAnimation(<span class="number">0</span>, <span class="string">&quot;chufa&quot;</span>, <span class="literal">false</span>);  </span><br></pre></td></tr></table></figure><blockquote><p>2024.11.8æ›´æ–°<br>ä½¿ç”¨SkeletonGraphic.AnimationState.ClearTrack(0)é‡åˆ°å‘äº†ï¼Œç›®å‰ç¬”è€…è¿˜ä¸æ¸…æ¥šSpineçš„ä½œç”¨åŸç†ï¼Œä»è¡¨ç°ä¸Šçœ‹ï¼Œè°ƒç”¨è¯¥æ¥å£ä¼šå°†SpineåŠ¨ç”»ä»è½¨é“ä¸Šç§»é™¤ï¼Œä¹‹åæƒ³è¦å†æ¬¡æ’­æ”¾è¯¥åŠ¨ç”»çš„è¯å°±æ— æ³•åœ¨è½¨é“ä¸Šæ‰¾åˆ°è¿™ä¸ªåŠ¨ç”»ï¼Œæ‰€ä»¥å¦‚æœæœ‰åˆ‡æ¢æ’­æ”¾åŠ¨ç”»çš„éœ€æ±‚ï¼Œåªéœ€è¦è°ƒç”¨heartBeatFlower.AnimationState.SetAnimation(0, â€œchufaâ€, false);  å°±å¯ä»¥äº†</p></blockquote><p>SkeletonAnimationç›¸å…³æ¥å£</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœæ­¢å½“å‰æ­£åœ¨æ’­æ”¾çš„åŠ¨ç”»</span></span><br><span class="line">heartBeatFlower.state.SetEmptyAnimation(<span class="number">0</span>,<span class="number">0</span>);            </span><br><span class="line"><span class="comment">// æ’­æ”¾æ–°çš„åŠ¨ç”»</span></span><br><span class="line">heartBeatFlower.state.SetAnimation(<span class="number">0</span>, <span class="string">&quot;loop&quot;</span>, <span class="literal">true</span>);  </span><br></pre></td></tr></table></figure><h1>Animatorä½¿ç”¨</h1><p>Animatorä¸­å¿…é¡»è®¾ç½®ä¸€ä¸ªä»Entryè¿›å…¥çš„é»˜è®¤çŠ¶æ€ï¼Œè¿™ä¸ªä»Entryè¿›å…¥é»˜è®¤çŠ¶æ€çš„æ“ä½œä¼šåœ¨Animatoræ‰€æŒ‚è½½çš„æ¸¸æˆç‰©ä½“çš„ActiveçŠ¶æ€å˜ä¸ºtrueæˆ–è€…Animatorç»„ä»¶è‡ªèº«çš„enableçŠ¶æ€å˜ä¸ºtrueçš„æ—¶å€™è‡ªåŠ¨æ‰§è¡Œï¼Œæ— æ³•æ§åˆ¶ã€‚å¦‚æœåœ¨é»˜è®¤çŠ¶æ€è®¾ç½®äº†æŸäº›åŠ¨ç”»ï¼Œåœ¨å…¶ä»–å¼€å‘åŒäº‹ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹è®¾ç½®äº†è¿™ä¸ªAnimatorèŠ‚ç‚¹çš„ActiveçŠ¶æ€ï¼Œå°±ä¼šå¯¼è‡´åŠ¨ç”»çš„è‡ªåŠ¨è§¦å‘ï¼Œå¯èƒ½ä¼šç»™åˆ«äººç•™å‘ã€‚æ›´å¥½çš„ä½¿ç”¨Animatorçš„æ–¹æ³•æ˜¯å°†é»˜è®¤çŠ¶æ€è®¾ç½®ä¸ºä¸€ä¸ªç©ºçŠ¶æ€ã€‚è®©çœŸæ­£çš„åŠ¨ç”»çŠ¶æ€æŒ‡å‘é»˜è®¤çŠ¶æ€ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img src="/posts/127bc3c9/image.png" class=""><p>åœ¨æˆ‘ä»¬éœ€è¦æ’­æ”¾åŠ¨ç”»çš„æ—¶æœºå¯ä»¥é€šè¿‡<a href="https://docs.unity3d.com/cn/current/ScriptReference/Animator.Play.html"><code>Animator.Play()</code></a>æ¥å£ï¼Œå¹¶ä¸”åœ¨åŠ¨ç”»æ’­æ”¾å®Œä¹‹åä¼šè‡ªåŠ¨çš„è¿›å…¥é»˜è®¤çŠ¶æ€ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯ä¸ç”¨é€šè¿‡æ§åˆ¶ActiveçŠ¶æ€æ¥æ§åˆ¶åŠ¨ç”»çš„æ’­æ”¾ï¼Œè€Œä¸”åœ¨ä»£ç ä¸­æˆ‘ä»¬ä¹Ÿæ˜¯é€šè¿‡<code>Animator.Play</code>æ¥å£æ§åˆ¶åŠ¨ç”»çš„æ’­æ”¾ï¼Œæ¯”é€šè¿‡ActiveçŠ¶æ€æ¥æ§åˆ¶çš„æ–¹æ³•æ›´è®©äººçŸ¥é“è¿™è¡Œä»£ç åœ¨åšä»€ä¹ˆã€‚</p><p>æ¥å£çš„å…·ä½“å‚æ•°å¦‚ä¸‹ï¼Œå…¶ä¸­ç¬¬ä¸‰ä¸ªå‚æ•°normalizedTimeæ˜¯ä¸€ä¸ªå½’ä¸€åŒ–çš„æ—¶é—´ï¼Œ[0,1]æŒ‡ä»åŠ¨ç”»çš„ä»€ä¹ˆæ—¶åˆ»å¼€å§‹æ’­æ”¾</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Play</span> (<span class="params"><span class="built_in">string</span> stateName, <span class="built_in">int</span> layer= <span class="number">-1</span>, <span class="built_in">float</span> normalizedTime= <span class="built_in">float</span>.NegativeInfinity</span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Play</span> (<span class="params"><span class="built_in">int</span> stateNameHash, <span class="built_in">int</span> layer= <span class="number">-1</span>, <span class="built_in">float</span> normalizedTime= <span class="built_in">float</span>.NegativeInfinity</span>)</span>;</span><br></pre></td></tr></table></figure><blockquote><p>2024.12.18æ›´æ–°<br>æœ€è¿‘å°è¯•äº†ä¸€ç§æ–°çš„å»¶æ—¶æ–¹æ³•,ä»¥å‰åœ¨å¤„ç†å½“æŸä¸€åŠ¨ç”»æ’­æ”¾å®Œæ¯•å,æ‰§è¡Œä¸€æ®µé€»è¾‘çš„æ—¶å€™,éƒ½æ˜¯ç”¨<br>ä¸‹é¢è¿™ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥å¯¹å½“å‰çš„Animatoræ’­æ”¾åŠ¨ç”»çš„normalizedTimeåšè°ƒæ•´</p><img src="/posts/127bc3c9/image-1.png" class=""><p>2025.6.18æ›´æ–°<br>æ›´å¥å£®çš„ç‰ˆæœ¬ TODO Eddie è¿™ä¸ªé—®é¢˜èƒ½ä¸èƒ½æŠ½æˆ<br>Unityçš„Animatorå¤ªéš¾ç”¨äº† ç¬”è€…æ˜¯å¸Œæœ›åœ¨åŠ¨ç”»æ’­æ”¾å®Œæˆä¹‹å æ‰§è¡ŒæŸä¸ªæ“ä½œ Animatoråªéœ€è¦ç»™æˆ‘ä¸€ä¸ªå›è°ƒçš„æ¥å£å°±å¯ä»¥ è¿™æ ·å°±ä¸éœ€è¦æˆ‘è‡ªå·±æ¥å®ç°äº†.<br>Animaceræ’ä»¶åº”è¯¥æ˜¯æœ‰è¿™ä¸ªæ¥å£çš„, éœ€è¦éªŒè¯ä¸€ä¸‹</p></blockquote><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">m_ddz_zhounianqing_JY12_zhuanchang_GameObject.SetActiveEx(<span class="literal">true</span>);</span><br><span class="line"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">m_ddz_zhounianqing_JY12_zhuanchang_Animator.Play(<span class="string">&quot;ddz_jiyang_12nian_zhuanchang&quot;</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰å¾…è¿›å…¥åŠ¨ç”»çŠ¶æ€</span></span><br><span class="line"><span class="built_in">float</span> waitAnimStateTimeout = <span class="number">2f</span>, timer = <span class="number">0f</span>;</span><br><span class="line"><span class="keyword">while</span> (!m_ddz_zhounianqing_JY12_zhuanchang_Animator.GetCurrentAnimatorStateInfo(<span class="number">0</span>)</span><br><span class="line">            .IsName(<span class="string">&quot;ddz_jiyang_12nian_zhuanchang&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    timer += Time.deltaTime;</span><br><span class="line">    <span class="keyword">if</span> (timer &gt; waitAnimStateTimeout) &#123;</span><br><span class="line">        QDebug.LogError(<span class="string">&quot;åŠ¨ç”»æ²¡æœ‰åˆ‡æ¢åˆ°ç›®æ ‡çŠ¶æ€ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰å¾…åŠ¨ç”»éå¾ªç¯æƒ…å†µä¸‹æ­£å¸¸æ’­æ”¾ç»“æŸ</span></span><br><span class="line">timer = <span class="number">0f</span>;</span><br><span class="line"><span class="built_in">float</span> waitAnimPlayTimeout = <span class="number">10f</span>;</span><br><span class="line"><span class="keyword">while</span> (m_ddz_zhounianqing_JY12_zhuanchang_Animator.GetCurrentAnimatorStateInfo(<span class="number">0</span>)</span><br><span class="line">            .normalizedTime &lt; <span class="number">1.0f</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    timer += Time.deltaTime;</span><br><span class="line">    <span class="keyword">if</span> (timer &gt; waitAnimPlayTimeout) &#123;</span><br><span class="line">        QDebug.LogError(<span class="string">&quot;åŠ¨ç”»æ’­æ”¾è¶…æ—¶ï¼Œå¯èƒ½åŠ¨ç”»clipå¾ªç¯/æ²¡åˆ‡åˆ°/é€Ÿåº¦å¾ˆæ…¢ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">QDebug.Log(<span class="string">&quot;è½¬åœºç»“æŸ&quot;</span>);</span><br><span class="line">m_ddz_zhounianqing_JY12_zhuanchang_GameObject.SetActiveEx(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure><h1>Animationä½“ç§¯ä¼˜åŒ–çš„é—®é¢˜</h1><p><a href="https://blog.uwa4d.com/archives/UWA_Pipeline22.html">https://blog.uwa4d.com/archives/UWA_Pipeline22.html</a></p><h1>DOTweenAnimationç»„ä»¶ä½¿ç”¨</h1><p>DOTweenAnimationç»„ä»¶æŒ‚è½½åœ¨èŠ‚ç‚¹ä¸Šï¼Œè°ƒç”¨æ’­æ”¾çš„æ—¶å€™åªæ’­ç¬¬ä¸€æ¬¡ï¼Œä¹‹åä¸æ’­äº†ï¼Œéœ€è¦ææ¸…æ¥šä¸ºä»€ä¹ˆ</p><h1>åç¨‹çš„å‘</h1><ul><li>åç¨‹ä¸­çš„ç­‰å¾…ä¸€ç§’å¹¶ä¸æ˜¯çœŸæ­£çš„ä¸€ç§’æœ‰å¯èƒ½ä¼šæœ‰è¯¯å·®</li><li>æç¤ºè¦æ‰§è¡ŒCoroutineçš„ç‰©ä½“çš„çŠ¶æ€æ˜¯inactiveçš„<br>ä¸€ä¸ªGameObject,åœ¨åŒä¸€å¸§å†…,å…ˆè¢«SetActiveäº†,ç„¶åç´§æ¥ç€ç”¨è¿™ä¸ªGameObjectä¸Šçš„ä¸€ä¸ªMonoæ‰§è¡ŒStartCoroutine,ä¼šæç¤ºGameObjectæ— æ³•è¢«æ‰§è¡Œ,éªŒè¯æ˜¯å¦æ˜¯è¿™æ ·çš„.</li></ul><h1>Unityçš„Animationçš„ä½¿ç”¨çš„å‘</h1><p>Animationä¸­æœ‰ä¸€ä¸ªLegacyå­—æ®µï¼Œå¦‚æœä¸å‹¾é€‰è¿™ä¸ªé€‰é¡¹ï¼Œåœ¨Animationä¸­æ˜¯æ²¡æœ‰åŠæ³•é€šè¿‡Animation.Play()æ¥å£æ’­æ”¾è¯¥åŠ¨ç”»çš„ã€‚<br>æœ‰å…´è¶£å¯ä»¥åšä¸€ä¸ªå®éªŒï¼Œåˆ›å»ºä¸€ä¸ªå‹¾é€‰äº†Legacyå’Œä¸€ä¸ªæœªå‹¾é€‰Legacyçš„åŠ¨ç”»ï¼Œå°†è¿™ä¸¤ä¸ªåŠ¨ç”»éƒ½æ·»åŠ åˆ°ä¸€ä¸ªAnimationç»„ä»¶ä¸Šã€‚åœ¨ä»£ç ä¸­è·å–è¿™ä¸ªAnimationç»„ä»¶çš„å¼•ç”¨ï¼Œè°ƒç”¨<code>Animation.GetClipCount()</code>æ¥å£å¾—åˆ°çš„å€¼ä¸º2ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨<code>foreach(AnimationState state in Animation)</code>å»éå†å´åªä¼šéå†åˆ°å‹¾é€‰äº†Legacyçš„AnimationClip</p><h1>XMLæ–‡ä»¶è¯»å–é€»è¾‘</h1><p>å®šä¹‰éœ€è¦ä»XMLä¸­è¯»å–çš„æ•°æ®ç»“æ„</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">XmlRoot(<span class="string">&quot;AssetBundleConfig&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AssetBundleConfig</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;BundleRule&gt; Bundles;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;AtlasRule&gt; Atlas;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BundleRule</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Relative;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Path;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Type;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> Recursion;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AtlasRule</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Path;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> Recursion;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰XMLæ–‡ä»¶å†…å®¹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">AssetBundleConfig</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">&quot;AssetBundleConfigSchema.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å¸¦æœ‰å¹³å°åç§°çš„bundleåªä¼šå‡ºç°åç§°æ‰€ä»£è¡¨çš„å¹³å°--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Bundles</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">BundleRule</span> <span class="attr">name</span>=<span class="string">&quot;Art_Animation&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Path</span>&gt;</span>Assets/Art/Animation<span class="tag">&lt;/<span class="name">Path</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Type</span>&gt;</span>SubFolder<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Recursion</span>&gt;</span>false<span class="tag">&lt;/<span class="name">Recursion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">BundleRule</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">BundleRule</span> <span class="attr">name</span>=<span class="string">&quot;Art_Audio&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Path</span>&gt;</span>Assets/Art/Audio<span class="tag">&lt;/<span class="name">Path</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Type</span>&gt;</span>None<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Recursion</span>&gt;</span>false<span class="tag">&lt;/<span class="name">Recursion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">BundleRule</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">BundleRule</span> <span class="attr">name</span>=<span class="string">&quot;Art_CustomShaders&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Path</span>&gt;</span>Assets/Art/CustomShaders<span class="tag">&lt;/<span class="name">Path</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Type</span>&gt;</span>None<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Recursion</span>&gt;</span>false<span class="tag">&lt;/<span class="name">Recursion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">BundleRule</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">BundleRule</span> <span class="attr">name</span>=<span class="string">&quot;Art_Fonts&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Path</span>&gt;</span>Assets/Art/Fonts<span class="tag">&lt;/<span class="name">Path</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Type</span>&gt;</span>None<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Recursion</span>&gt;</span>false<span class="tag">&lt;/<span class="name">Recursion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">BundleRule</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">BundleRule</span> <span class="attr">name</span>=<span class="string">&quot;Art_Fonts8x8&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Relative</span>&gt;</span>Assets/Art/Fonts<span class="tag">&lt;/<span class="name">Relative</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Path</span>&gt;</span>Assets/Art/Fonts/Fonts8x8<span class="tag">&lt;/<span class="name">Path</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Type</span>&gt;</span>SubFolder<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Recursion</span>&gt;</span>true<span class="tag">&lt;/<span class="name">Recursion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">BundleRule</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Bundles</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">Atlas</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">AtlasRule</span> <span class="attr">name</span>=<span class="string">&quot;Art_Atlas&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Path</span>&gt;</span>Assets/Art/Texture/Atlas<span class="tag">&lt;/<span class="name">Path</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Recursion</span>&gt;</span>true<span class="tag">&lt;/<span class="name">Recursion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">AtlasRule</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Atlas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">AssetBundleConfig</span>&gt;</span></span><br></pre></td></tr></table></figure><p>C#è„šæœ¬è¯»å–è¯¥XMLæ–‡ä»¶</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> T <span class="title">LoadXmlConfig</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="built_in">string</span> path</span>) <span class="keyword">where</span> T : <span class="keyword">class</span></span></span><br><span class="line">&#123;</span><br><span class="line">    XmlSerializer xmlSerializer = <span class="keyword">new</span> XmlSerializer(<span class="keyword">typeof</span>(T));</span><br><span class="line">    T result;</span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> reader = XmlReader.Create(path))</span><br><span class="line">    &#123;</span><br><span class="line">        result = (T) xmlSerializer.Deserialize(reader);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨æ—¶åªéœ€è¦æŠŠ<code>AssetBundleConfig</code>ä½œä¸ºTä¼ å…¥è¯¥æ–¹æ³•ï¼Œå°±å¯ä»¥è¿”å›XMLçš„å†…å®¹</p><h1>å†™ä¸€ä¸ªå‡çš„è¿›åº¦æ¡</h1><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">UI</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">LoadingUICartoon</span> : <span class="title">LoadingUI</span></span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">SerializeField</span>] <span class="keyword">private</span> Text progressText;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">float</span> currentValue = <span class="number">0f</span>; <span class="comment">// å½“å‰å€¼</span></span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">float</span> targetValue = <span class="number">100f</span>; <span class="comment">// ç›®æ ‡å€¼</span></span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">float</span> speed = <span class="number">1f</span>; <span class="comment">// å¢é•¿é€Ÿåº¦</span></span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">bool</span> endLoading = <span class="literal">false</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            canvas.sortingLayerID = R.SortingLayers.Default;</span><br><span class="line">            progressText.text = <span class="string">&quot;0%&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (endLoading)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ä½¿ç”¨æŒ‡æ•°è¡°å‡çš„æ–¹å¼é€æ¸æ¥è¿‘ç›®æ ‡å€¼</span></span><br><span class="line">            currentValue += (targetValue - currentValue) * speed * Time.deltaTime;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ›´æ–°Textç»„ä»¶çš„æ˜¾ç¤ºå†…å®¹</span></span><br><span class="line">            progressText.text = Mathf.FloorToInt(currentValue).ToString() + <span class="string">&quot;%&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetProgress</span>(<span class="params"><span class="built_in">float</span> progress</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            endLoading = <span class="literal">true</span>;</span><br><span class="line">            progressText.text = progress.ToString(<span class="string">&quot;0&quot;</span>) + <span class="string">&quot;%&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>Unityä¸­å¯¹å¯¼å…¥çš„èµ„äº§è¿›è¡Œè‡ªåŠ¨åŒ–çš„å¯¼å…¥æ ¼å¼è®¾ç½®</h1><h1>Unityé¢„åˆ¶ä½“ä¸­çš„Imageç»„ä»¶å†…å®¹ä¸æ˜¾ç¤º</h1><p><a href="https://blog.csdn.net/WGYHAPPY/article/details/116161817">https://blog.csdn.net/WGYHAPPY/article/details/116161817</a></p><h1>ä½¿ç”¨æ‘„åƒæœºæ¸²æŸ“ä¸€ä¸ªRenderTexture ä»¥åŠ æˆ‘æƒ³è¦æŠŠä¸€ä¸ªCanvasæ”¾åˆ°ä¸–ç•Œåæ ‡ä¸‹,å³ä¸ä¼šåœ¨ä¸Šå±‚åµŒå¥—ä¸€ä¸ªUICanvas</h1><p><a href="https://blog.csdn.net/qq_37179591/article/details/118148818">https://blog.csdn.net/qq_37179591/article/details/118148818</a></p><h1>Macä¸‹å¦‚ä½•æ‰“å‡ºä¹˜å·</h1><p><a href="https://www.zhihu.com/question/20367435">https://www.zhihu.com/question/20367435</a></p><h1>æŸ¥è¯¢èµ„æºå¼•ç”¨</h1><p>å¯¹è¯¥å·¥å…·è¿›è¡Œæ‰©å……, å˜æˆä¸€ä¸ªèµ„äº§åº“å·¥å…·, èƒ½å¤Ÿæ–¹ä¾¿å¼€å‘è€…å¿«é€Ÿçš„ç®¡ç†èµ„æº<br>è§<a href="https://github.com/SoIncredible/UnityUtils">GitHub</a>å·¥å…·åº“<br>Unityæ’ä»¶<a href="https://docs.google.com/document/d/1M3drHsRSCNKk-colYnCYECM_TR2XgtGB_8GFc_La19E/edit?tab=t.0#heading=h.z6ne0og04bp5">FR2</a></p><h1>Unityä¸­åˆå¹¶ä¸¤ä¸ªMesh</h1><p><a href="https://blog.csdn.net/qq_42980269/article/details/123064307">https://blog.csdn.net/qq_42980269/article/details/123064307</a></p><h1>åœ¨Unityå·¥ç¨‹ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„</h1><p>å¦‚æœä½ åœ¨C#ä¸­çœ‹åˆ°è¿™æ ·çš„ç›®å½•:<code>configFilePath = $&quot;../Config/Excel/s/&#123;Options.Instance.StartConfig&#125;/&#123;configType.Name&#125;.bytes&quot;;</code>,å®ƒä»£è¡¨çš„æ˜¯è·ŸUnityå·¥ç¨‹çš„æ ¹ç›®å½•åŒçº§ä¸‹æœ‰ä¸€ä¸ªConfigç›®å½•:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Root</span><br><span class="line"> - Unityå·¥ç¨‹ç›®å½•</span><br><span class="line"> - Configç›®å½•</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å¦‚æœä½ è¦ä½¿ç”¨AssetDatabaseåŠ è½½æŸä¸€ä¸ªèµ„æºçš„è¯,èµ„æºçš„è·¯å¾„ä¸€å®šæ˜¯&quot;Assets/â€¦&quot;èµ·æ‰‹çš„</p><h1>Unityå…³é—­è‡ªåŠ¨ç¼–è¯‘</h1><p>åœ¨2020.3.48f1ä¸­<code>Preference</code>-&gt;Generalä¸€æ ä¸­å–æ¶ˆå‹¾é€‰<code>Auto Refresh</code>,ä½†æ˜¯åœ¨2022.3.15f1ç‰ˆæœ¬ä¸­ç¬”è€…å¹¶æ²¡æœ‰æ‰¾åˆ°è¯¥å­—æ®µ.</p><h1>Unity é¢œè‰²åå…­è¿›åˆ¶å’ŒRGBä¹‹é—´çš„è½¬æ¢æ–¹å¼</h1><p><a href="https://blog.csdn.net/f_957995490/article/details/120727626">https://blog.csdn.net/f_957995490/article/details/120727626</a></p><h1>è®©ä¸€æ®µä»£ç åªåœ¨Editoræ¨¡å¼ä¸‹è¿è¡Œ</h1><p>ä¸¤ç§æ–¹å¼, ä¸€ç§æ–¹å¼æ˜¯å°†ä»£ç è„šæœ¬æ”¾åˆ°Editorç›®å½•ä¸‹, å¦ä¸€ç§æ˜¯å°†è„šæœ¬æ”¾åœ¨Runtimeä¸‹, ä½†æ˜¯ç”¨å®åŒ…è£¹èµ·æ¥, å¦‚æœæ”¾åœ¨Editorä¸‹çš„è¯åˆ™ä¸èƒ½æŒ‚è½½åˆ°èŠ‚ç‚¹ä¸Š.</p><h1>GUIDä¸FileID</h1><p>ä¸€ä¸ªfbxæ–‡ä»¶ä¸­å¯èƒ½æœ‰å¤šä¸ªå­æ¨¡å‹ æˆ–è€…è¯´çš„æ›´æ™®éçš„æƒ…å†µ: ä¸€ä¸ªè¢«AssetDatabaseæ”¶å½•çš„èµ„äº§ä¸­å¯èƒ½åŒ…å«å¤šä¸ªéƒ¨åˆ†, éœ€è¦é€šè¿‡guid+fileIdçš„æ–¹å¼æ‰èƒ½å®šä½åˆ°ä¸€ä¸ªèµ„äº§</p><p>FileIDä¸­å¹¶æ²¡æœ‰è¢«åºåˆ—åŒ–åœ¨metaæ–‡ä»¶ä¸­, åœ¨ç¿»é˜…çš„Unityçš„æºç ä¹‹å, æ‰¾åˆ°äº†FileIDçš„ç”Ÿæˆé€»è¾‘:</p><p>åœ¨<code>YAMLNode.cpp</code>è„šæœ¬é‡Œé¢, YAMLMappingæ–¹æ³•, ç”¨æ¥å‘metaæ–‡ä»¶ä¸­æ·»åŠ fileID, FileIdè¢«PersistentManagerç®¡ç†</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">YAMLMapping::<span class="built_in">YAMLMapping</span>(<span class="type">const</span> PPtr&lt;Object&gt;&amp; value) : <span class="built_in">useInlineStyle</span>(<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">GetPersistentManager</span>().<span class="built_in">Lock</span>();</span><br><span class="line"></span><br><span class="line">    SerializedObjectIdentifier identifier;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">GetPersistentManager</span>().<span class="built_in">InstanceIDToSerializedObjectIdentifier</span>(value.<span class="built_in">GetInstanceID</span>(), identifier))</span><br><span class="line">    &#123;</span><br><span class="line">        FileIdentifier id = <span class="built_in">GetPersistentManager</span>().<span class="built_in">PathIDToFileIdentifierInternal</span>(identifier.serializedFileIndex);</span><br><span class="line">        <span class="built_in">Append</span>(<span class="string">&quot;fileID&quot;</span>, identifier.localIdentifierInFile);</span><br><span class="line">        <span class="built_in">Append</span>(<span class="string">&quot;guid&quot;</span>, id.guid);</span><br><span class="line">        <span class="built_in">Append</span>(<span class="string">&quot;type&quot;</span>, id.type);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">GetPersistentManager</span>().<span class="built_in">Unlock</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯å–çš„, åœ¨<code>AssetImporter.cpp</code>ä¸­, æ ¹æ®å¯¼å…¥èµ„äº§çš„åå­—å’Œèµ„äº§çš„ç±»å‹ç”Ÿæˆä¸€ä¸ªid</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LocalIdentifierInFileType <span class="title">AssetImporter::GenerateFileIDHashBased</span><span class="params">(<span class="type">const</span> Unity::Type* type, <span class="type">const</span> core::string&amp; name)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    MdFourGenerator mdfourGen;</span><br><span class="line">    mdfourGen.<span class="built_in">Feed</span>(<span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(type-&gt;<span class="built_in">GetPersistentTypeID</span>()));</span><br><span class="line">    mdfourGen.<span class="built_in">Feed</span>(name);</span><br><span class="line">    Hash128 Hash128 = mdfourGen.<span class="built_in">Finish</span>();</span><br><span class="line">    LocalIdentifierInFileType fileID = (SInt32)(*<span class="built_in">reinterpret_cast</span>&lt;UInt32*&gt;(&amp;Hash128));</span><br><span class="line">    <span class="built_in">Assert</span>(m_FileIDToRecycleName.<span class="built_in">empty</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (m_UsedFileIDs.<span class="built_in">count</span>(fileID) == <span class="number">1</span> || fileID == kAssetImporterFileID || fileID == kAssetMetaDataFileID)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> fileID;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><a href="https://blog.csdn.net/qq_33060405/article/details/147315678">Unityçš„åºåˆ—åŒ–ä¸­çš„å‡ ä¸ªæ¦‚å¿µï¼šâ€œGUIDâ€ã€â€œLocal IDâ€ã€â€œ Instance IDâ€</a></li><li><a href="https://zhuanlan.zhihu.com/p/654506392">unity fileID vs GUID</a></li><li><a href="https://blog.csdn.net/qq_17758883/article/details/105345454">Unityæ–‡ä»¶ã€æ–‡ä»¶å¼•ç”¨ã€Metaè¯¦è§£</a></li></ul><h1>Unityçš„åºåˆ—åŒ–ä¸­çš„å‡ ä¸ªæ¦‚å¿µï¼šâ€œGUIDâ€ã€â€œLocal IDâ€ã€â€œ Instance IDâ€</h1><p><a href="https://blog.csdn.net/qq_33060405/article/details/147315678">æ–‡æ¡£</a></p><h1>Unityä¸­çš„PhysicsRaycasterä¸ºä»€ä¹ˆè¦ç»§æ‰¿UIBehaviour</h1><p>RectTransformUtility.ScreenPointToLocalPointInRectangleæ¥å£</p><h1>Unityä¸­çš„å¯¹ç§°æŒ‰é’®</h1><p>æœ‰ä¸€ç±»éœ€æ±‚, ä¼šå‡ºä¸€ä¸ªæŒ‰é’®, å‘å·¦çš„, ç„¶åè¦ä½ æ°´å¹³ç¿»è½¬ä¸€ä¸‹å˜æˆå‘å³çš„ æ³¨æ„è¦ç”¨RectTransformçš„scale ä¸è¦ç”¨Rotation å› ä¸ºRotationä¼šæŠŠè¿™ä¸ªå›¾ç‰‡çš„æ­£é¢åè½¬çš„èƒŒç¦»æ‘„åƒæœº è¿™æ ·å°„çº¿å°±æ£€æµ‹ä¸åˆ°è¿™ä¸ªå›¾ç‰‡äº†</p><p><a href="https://www.cnblogs.com/tian98/p/15623292.html">Unityæ§åˆ¶å°è¾“å‡ºè¿‡å¤šä¸æ˜¾ç¤ºçš„è§£å†³æ–¹æ¡ˆ</a></p><h1>Unityä¸­çš„Awake</h1><p>å¦‚æœä¸€ä¸ªèŠ‚ç‚¹å®ä¾‹åŒ–å‡ºæ¥è¢«è®¾ç½®ä¸ºäº†activeä¸ºfalse, å…¶Awakeæ–¹æ³•å°±ä¸ä¼šæ‰§è¡Œ, æ‰€ä»¥ä¸åº”è¯¥ä½¿ç”¨Unityæä¾›çš„ç”Ÿå‘½å‘¨æœŸ</p>]]></content>
      
      
      <categories>
          
          <category> ç¡¬æŠ€èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é—®é¢˜æ‚è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Butterflyé­”æ”¹æ—¥è®°</title>
      <link href="/posts/370bdedc/"/>
      <url>/posts/370bdedc/</url>
      
        <content type="html"><![CDATA[<img src="https://ghchart.rshah.org/SoIncredible" alt="SoIncredible's Github chart" /><h1>å®‰è£…Butterflyä¸»é¢˜</h1><p>å»åˆ°<a href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly GitHub</a>ä¸»é¡µ,åœ¨åšå®¢æ ¹ç›®å½•è¿è¡Œä»¥ä¸‹å‘½ä»¤:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone -b master https://github.com/jerryc127/hexo-theme-butterfly.git themes/butterfly</span><br></pre></td></tr></table></figure><p>å®Œæˆå,åœ¨<code>_config.yml</code>ä¸­æ›´æ”¹themeä¸ºButterfly(å½“å‰çš„ç‰ˆæœ¬ä¸º4.5.1),åˆ°æ­¤è¿˜ä¸èƒ½å¤ŸæˆåŠŸå¯åŠ¨hexo,ç¡¬è¦å¯åŠ¨ä¼šæŠ¥ä»¥ä¸‹é”™è¯¯:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extends includes/layout.pug block content include ./includes/mixins/post-ui.pug #recent-posts.recent-posts +postUI include includes/pagination.pug</span><br></pre></td></tr></table></figure><p>éœ€è¦å…ˆå®‰è£…ä»¥ä¸‹ä¾èµ–:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-renderer-pug hexo-renderer-stylus --save</span><br></pre></td></tr></table></figure><p>è¿è¡Œhexoä¸‰ä»¶å¥—,hexoæˆåŠŸå¯åŠ¨.</p><p>Note:åœ¨Macæˆ–è€…Linuxä¸­å¦‚æœæƒ³è¦æ›´æ”¹æŸä¸ªæ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰æ–‡ä»¶çš„æƒé™,è¿è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod -R 777 æ–‡ä»¶å¤¹å #Rå¿…é¡»å¤§å†™</span><br></pre></td></tr></table></figure><h1>æ·»åŠ åŠ è½½åŠ¨ç”»</h1><p>åšå®¢é‡Œæœ‰ä¸€äº›å›¾ç‰‡æ¯”è¾ƒå¤§,è¿›äººåˆ°åšå®¢åè¿˜æ²¡æœ‰å®Œå…¨åŠ è½½å‡ºæ¥,è¿™æ ·å¾ˆä¸å¥½çœ‹,æ‰€ä»¥æˆ‘æƒ³åšä¸€ä¸ªåŠ è½½åŠ¨ç”».</p><p>å‚è€ƒåŸå¸–åœ¨<a href="https://anzhiy.cn/posts/52d8.html">è¿™é‡Œ</a>,æ³¨æ„Butterflyä¸»é¢˜çš„ç‰ˆæœ¬æ˜¯**4.5.1*.*</p><img src="/posts/370bdedc/image-20221214202908896.png" class=""><ul><li><p>ä¿®æ”¹<code>themes/butterfly/layout/includes/loading/fullpage-loading.pug</code></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#loading-box</span>(onclick=&#x27;document<span class="selector-class">.getElementById</span>(&quot;loading-box&quot;)<span class="selector-class">.classList</span><span class="selector-class">.add</span>(&quot;loaded&quot;)&#x27;)</span><br><span class="line">  <span class="selector-class">.loading-bg</span></span><br><span class="line">    <span class="selector-tag">div</span><span class="selector-class">.loading-img</span></span><br><span class="line">    <span class="selector-class">.loading-image-dot</span></span><br><span class="line"></span><br><span class="line">script.</span><br><span class="line">  const preloader = &#123;</span><br><span class="line">    endLoading: () =&gt; &#123;</span><br><span class="line">      document<span class="selector-class">.body</span><span class="selector-class">.style</span><span class="selector-class">.overflow</span> = &#x27;auto&#x27;;</span><br><span class="line">      document<span class="selector-class">.getElementById</span>(&#x27;loading-box&#x27;)<span class="selector-class">.classList</span><span class="selector-class">.add</span>(&quot;loaded&quot;)</span><br><span class="line">    &#125;,</span><br><span class="line">    initLoading: () =&gt; &#123;</span><br><span class="line">      document<span class="selector-class">.body</span><span class="selector-class">.style</span><span class="selector-class">.overflow</span> = &#x27;&#x27;;</span><br><span class="line">      document<span class="selector-class">.getElementById</span>(&#x27;loading-box&#x27;)<span class="selector-class">.classList</span><span class="selector-class">.remove</span>(&quot;loaded&quot;)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  window<span class="selector-class">.addEventListener</span>(&#x27;load&#x27;,()=&gt; &#123; preloader<span class="selector-class">.endLoading</span>() &#125;)</span><br><span class="line"></span><br><span class="line">  if (!&#123;theme<span class="selector-class">.pjax</span> &amp;&amp; theme<span class="selector-class">.pjax</span><span class="selector-class">.enable</span>&#125;) &#123;</span><br><span class="line">    document<span class="selector-class">.addEventListener</span>(&#x27;pjax:send<span class="string">&#x27;, () =&gt; &#123; preloader.initLoading() &#125;)</span></span><br><span class="line"><span class="string">    document.addEventListener(&#x27;</span>pjax:complete<span class="string">&#x27;, () =&gt; &#123; preloader.endLoading() &#125;)</span></span><br><span class="line"><span class="string">  &#125;</span></span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹<code>themes/butterfly/layout/includes/loading/index.pug</code></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if theme<span class="selector-class">.preloader</span><span class="selector-class">.source</span> === <span class="number">1</span></span><br><span class="line">  include ./fullpage-loading<span class="selector-class">.pug</span></span><br><span class="line">else if theme<span class="selector-class">.preloader</span><span class="selector-class">.source</span> === <span class="number">2</span></span><br><span class="line">  include ./pace<span class="selector-class">.pug</span></span><br><span class="line">else</span><br><span class="line">  include ./fullpage-loading<span class="selector-class">.pug</span></span><br><span class="line">  include ./pace<span class="selector-class">.pug</span></span><br></pre></td></tr></table></figure></li><li><p>æ–°å»º<code>source/css/progress_bar.css</code>, ä¹Ÿå¯ä»¥ä¸åšè¿™ä¸€æ­¥ä¸‹é¢é…ç½®æ–‡ä»¶<code>pace_css_url</code>è¿™ä¸€é¡¹å°±è¦ç•™ç©º, è¿™ä¸€æ­¥æ˜¯ä¿®æ”¹ pace åŠ è½½çš„èƒ¶å›Šæ ·å¼ç”¨çš„.</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.pace</span> &#123;</span><br><span class="line">  -webkit-<span class="attribute">pointer-events</span>: none;</span><br><span class="line">  <span class="attribute">pointer-events</span>: none;</span><br><span class="line">  -webkit-user-select: none;</span><br><span class="line">  -moz-user-select: none;</span><br><span class="line">  user-select: none;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">2000</span>;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">margin</span>: auto;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">4rem</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#eaecf2</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> <span class="number">#e3e8f7</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.pace-inactive</span> <span class="selector-class">.pace-progress</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">transition</span>: <span class="number">0.3s</span> ease-in;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.pace</span> <span class="selector-class">.pace-progress</span> &#123;</span><br><span class="line">  -webkit-<span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  -moz-<span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  -ms-<span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  -o-<span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  -webkit-<span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  -moz-<span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  -ms-<span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  -o-<span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="attribute">max-width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">2000</span>;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(-<span class="number">45deg</span>, <span class="number">#ee7752</span>, <span class="number">#e73c7e</span>, <span class="number">#23a6d5</span>, <span class="number">#23d5ab</span>);</span><br><span class="line">  <span class="attribute">animation</span>: gradient <span class="number">1.5s</span> ease infinite;</span><br><span class="line">  <span class="attribute">background-size</span>: <span class="number">200%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.pace</span><span class="selector-class">.pace-inactive</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">transition</span>: <span class="number">0.3s</span>;</span><br><span class="line">  <span class="attribute">top</span>: -<span class="number">8px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@keyframes</span> gradient &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">background-position</span>: <span class="number">0%</span> <span class="number">50%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">50%</span> &#123;</span><br><span class="line">    <span class="attribute">background-position</span>: <span class="number">100%</span> <span class="number">50%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">background-position</span>: <span class="number">0%</span> <span class="number">50%</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>ä¿®æ”¹<code>themes/butterfly/source/css/_layout/loading.styl</code>, å…¶ä¸­çš„é¢œè‰²å¯ä»¥æ›¿æ¢æˆä½ å–œæ¬¢çš„è‰²å€¼ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">if hexo-config(&#x27;preloader&#x27;)</span><br><span class="line">  <span class="selector-class">.loading-bg</span></span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">position</span>: fixed;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">var</span>(<span class="comment">/* è¿™é‡Œæ›¿æ¢æˆä½ çš„è‰²å€¼ */</span>);</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">1001</span>;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">transition</span>: .<span class="number">3s</span>;</span><br><span class="line"></span><br><span class="line">  <span class="selector-id">#loading-box</span></span><br><span class="line">    <span class="selector-class">.loading-img</span></span><br><span class="line">      <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">      <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">      <span class="attribute">margin</span>: auto;</span><br><span class="line">      <span class="attribute">border</span>: <span class="number">4px</span> solid <span class="number">#f0f0f2</span>;</span><br><span class="line">      <span class="attribute">animation-duration</span>: .<span class="number">3s</span>;</span><br><span class="line">      <span class="attribute">animation-name</span>: loadingAction;</span><br><span class="line">      <span class="attribute">animation-iteration-count</span>: infinite;</span><br><span class="line">      <span class="attribute">animation-direction</span>: alternate;</span><br><span class="line">    <span class="selector-class">.loading-image-dot</span></span><br><span class="line">      <span class="attribute">width</span>: <span class="number">30px</span>;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">      <span class="attribute">background</span>: <span class="number">#6bdf8f</span>;</span><br><span class="line">      <span class="attribute">position</span>: absolute;</span><br><span class="line">      <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">      <span class="attribute">border</span>: <span class="number">6px</span> solid <span class="number">#fff</span>;</span><br><span class="line">      <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">      <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">      <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">18px</span>, <span class="number">24px</span>);</span><br><span class="line">    &amp;<span class="selector-class">.loaded</span></span><br><span class="line">      <span class="selector-class">.loading-bg</span></span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">z-index</span>: -<span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">@keyframes</span> loadingAction</span><br><span class="line">    <span class="number">0%</span> &#123;</span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">100%</span> &#123;</span><br><span class="line">        <span class="attribute">opacity</span>: .<span class="number">4</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul></li><li><p>åœ¨<code>[BlogRoot]/source/css/</code>ä¸‹åˆ›å»ºä¸€ä¸ªcustom.cssçš„æ–‡ä»¶,åœ¨è¯¥æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç :</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.loading-img</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">/* è¿™é‡Œå¡«ä½ åšå®¢å¤´åƒçš„åœ°å€ */</span>) no-repeat center center;</span><br><span class="line">  <span class="attribute">background-size</span>: cover;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹<code>_config.butterfly.yml</code>ä¸­<code>preloader</code>é€‰é¡¹, æ”¹å®Œä»¥å<code>source: 1</code>ä¸ºæ»¡å±åŠ è½½æ— paceèƒ¶å›Š,<code>source: 2</code>ä¸ºpaceèƒ¶å›Šæ— æ»¡å±åŠ¨ç”», <code>source: 3</code>æ˜¯ä¸¤è€…éƒ½å¯ç”¨ã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Loading Animation (åŠ è½½åŠ¨ç”»)</span></span><br><span class="line"><span class="attr">preloader:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># source</span></span><br><span class="line">  <span class="comment"># 1. fullpage-loading</span></span><br><span class="line">  <span class="comment"># 2. pace (progress bar)</span></span><br><span class="line">  <span class="comment"># else all</span></span><br><span class="line">  <span class="attr">source:</span> <span class="number">3</span></span><br><span class="line">  <span class="comment"># pace theme (see https://codebyzach.github.io/pace/)</span></span><br><span class="line">  <span class="attr">pace_css_url:</span> <span class="string">/css/progress_bar.css</span></span><br></pre></td></tr></table></figure></li><li><p>è®°å¾—è¦åœ¨<code>_config.butterfly.yml</code>ä¸­æ·»åŠ <code>inject</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">    <span class="comment"># è‡ªå®šä¹‰css</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;/css/custom.css&quot;</span> <span class="string">media=&quot;defer&quot;</span> <span class="string">onload=&quot;this.media=&#x27;all&#x27;&quot;&gt;</span></span><br></pre></td></tr></table></figure><h1>å‘åšå®¢ä¸­æ·»åŠ å›¾ç‰‡,å¹¶ä¸”èƒ½å¤Ÿåœ¨Typoraå’Œç½‘é¡µä¸­éƒ½èƒ½æ­£å¸¸æ˜¾ç¤º</h1><p><strong>é—®é¢˜æè¿°</strong>:åœ¨Typoraä¸­æ’å…¥å›¾ç‰‡æ—¶ä½¿ç”¨çš„æ˜¯ç›¸å¯¹è·¯å¾„,è¯¥å¹¶ä¸èƒ½å¤Ÿè¢«hexoè¯†åˆ«,å¯¼è‡´å¯åŠ¨hexoçš„æ—¶å€™æ–‡ç« å†…çš„å›¾ç‰‡æ²¡æœ‰åŠæ³•æ­£å¸¸æ˜¾ç¤º.åè¿‡æ¥å¦‚æœä½¿ç”¨äº†hexoèƒ½å¤Ÿè¯†åˆ«çš„å›¾ç‰‡è·¯å¾„,åœ¨Typoraä¸­åˆä¸èƒ½å¤Ÿæµè§ˆå›¾ç‰‡äº†.</p><p><strong>è§£å†³åŠæ³•</strong>:</p><ul><li><p>å°†<code>_config.yml</code>ä¸­<code>post_asset_folder:</code>è®¾ç½®ä¸ºtrue,åœ¨æ–°å»ºæ–‡ç« æ—¶hexoä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå’Œæ–‡ç« åŒåçš„æ–‡ä»¶å¤¹å­˜æ”¾æ–‡ç« ä¸­çš„å›¾ç‰‡.</p></li><li><p>è°ƒæ•´Typoraä¸­çš„è®¾ç½®</p></li></ul><img src="/posts/370bdedc/image-20221215000601553.png" class=""><ul><li><p>å®‰è£…æ’ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-renderer-marked #ä¸æ¨è,è¿™ä¸€ä¸ªåŒ…å¯ä»¥ä¸å®‰è£…</span><br><span class="line">npm install hexo-image-link --save</span><br><span class="line"></span><br><span class="line">npm uninstall hexo-renderer-marker --save  #å¸è½½ marked </span><br><span class="line">npm install hexo-renderer-markdown-it --save  #å®‰è£…markdown-it</span><br></pre></td></tr></table></figure></li></ul></li></ul><p>Note:å¦‚æœæƒ³è¦ç»™æ–‡ç« æ·»åŠ å°é¢,å¯ä»¥åœ¨scaffoldæ–‡ä»¶å¤¹çš„post.mdä¸­æ›´æ”¹ä¸€ä¸‹æ–‡ç« çš„æ¨¡æ¿</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">title: &#123;&#123; title &#125;&#125;</span><br><span class="line">date: &#123;&#123; date &#125;&#125;</span><br><span class="line">tags:</span><br><span class="line">updated: </span><br><span class="line">top<span class="emphasis">_img:</span></span><br><span class="line"><span class="emphasis">categories:</span></span><br><span class="line"><span class="emphasis">cover: </span></span><br></pre></td></tr></table></figure><p>å°†å°é¢çš„è¿æ¥å¡«åœ¨<code>cover</code>åé¢,å¦‚æœå°é¢å›¾ç‰‡åœ¨æœ¬åœ°å°±ç›´æ¥å¡«å°é¢å›¾ç‰‡çš„æ–‡ä»¶å.</p><h1>æ·»åŠ æœ¬åœ°æœç´¢</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-searchdb --save</span><br></pre></td></tr></table></figure><p>åœ¨<code>_config.yml</code>ä¸­æ·»åŠ </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Search</span></span><br><span class="line">search:</span><br><span class="line">path: search.xml</span><br><span class="line">field: post</span><br><span class="line">format: html</span><br><span class="line">limit: 10000</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> template: ./search.xml è¿™ä¸€è¡Œæ·»åŠ ä¸Šä¼šæŠ¥é”™,å…ˆæ³¨é‡Šæ‰</span></span><br></pre></td></tr></table></figure><p>å°†<code>_config.butterfly.yml</code>ä¸­localsearchçš„enableæ”¹ä¸ºtrue</p><h1>è®¾ç½®æ–‡ç« æ°¸ä¹…åŒ–è¿æ¥</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-abbrlink --save</span><br></pre></td></tr></table></figure><h1>ç»Ÿè®¡å­—æ•°é˜…è¯»æ—¶é—´</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-wordcount --save</span><br></pre></td></tr></table></figure><p>æ›´æ”¹<code>_config.butterfly.yml</code>ä¸­çš„ä»£ç </p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">wordcount:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">post_wordcount:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">min2read:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">total_wordcount:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h1>è‡ªå®šä¹‰ç½‘ç«™æ ·å¼</h1><p><strong>æŒ–å‘:äº†è§£CSSçš„å·¥ä½œåŸç†</strong></p><p>åœ¨<code>[BlogRoot]/source/css/custom.css</code>ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç :</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* é¢œè‰² */</span></span><br><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">  <span class="attr">--anzhiyu-theme-op</span>: <span class="number">#4259ef23</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-gray-op</span>: <span class="number">#9999992b</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-theme-top</span>: <span class="built_in">var</span>(--anzhiyu-theme);</span><br><span class="line">  <span class="attr">--anzhiyu-white</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-white-op</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.2</span>);</span><br><span class="line">  <span class="attr">--anzhiyu-black</span>: <span class="number">#000</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-black-op</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.2</span>);</span><br><span class="line">  <span class="attr">--anzhiyu-none</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="attr">--anzhiyu-gray</span>: <span class="number">#999999</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-yellow</span>: <span class="number">#ffc93e</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-main</span>: <span class="built_in">var</span>(--anzhiyu-theme);</span><br><span class="line">  <span class="attr">--anzhiyu-main-op</span>: <span class="built_in">var</span>(--anzhiyu-theme-op);</span><br><span class="line">  <span class="attr">--anzhiyu-shadow-theme</span>: <span class="number">0</span> <span class="number">8px</span> <span class="number">12px</span> -<span class="number">3px</span> <span class="built_in">var</span>(--anzhiyu-theme-op);</span><br><span class="line">  <span class="attr">--anzhiyu-shadow-main</span>: <span class="number">0</span> <span class="number">8px</span> <span class="number">12px</span> -<span class="number">3px</span> <span class="built_in">var</span>(--anzhiyu-main-op);</span><br><span class="line">  <span class="attr">--anzhiyu-shadow-blue</span>: <span class="number">0</span> <span class="number">8px</span> <span class="number">12px</span> -<span class="number">3px</span> <span class="built_in">rgba</span>(<span class="number">40</span>, <span class="number">109</span>, <span class="number">234</span>, <span class="number">0.2</span>);</span><br><span class="line">  <span class="attr">--anzhiyu-shadow-white</span>: <span class="number">0</span> <span class="number">8px</span> <span class="number">12px</span> -<span class="number">3px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.2</span>);</span><br><span class="line">  <span class="attr">--anzhiyu-shadow-black</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">12px</span> <span class="number">4px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.05</span>);</span><br><span class="line">  <span class="attr">--anzhiyu-shadow-yellow</span>: <span class="number">0px</span> <span class="number">38px</span> <span class="number">77px</span> -<span class="number">26px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">201</span>, <span class="number">62</span>, <span class="number">0.12</span>);</span><br><span class="line">  <span class="attr">--anzhiyu-shadow-red</span>: <span class="number">0</span> <span class="number">8px</span> <span class="number">12px</span> -<span class="number">3px</span> <span class="number">#ee7d7936</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-shadow-green</span>: <span class="number">0</span> <span class="number">8px</span> <span class="number">12px</span> -<span class="number">3px</span> <span class="number">#87ee7936</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-shadow-border</span>: <span class="number">0</span> <span class="number">8px</span> <span class="number">16px</span> -<span class="number">4px</span> <span class="number">#2c2d300c</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-shadow-blackdeep</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">16px</span> -<span class="number">3px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.15</span>);</span><br><span class="line">  <span class="attr">--anzhiyu-logo-color</span>: <span class="built_in">linear-gradient</span>(<span class="number">215deg</span>, <span class="number">#4584ff</span> <span class="number">30%</span>, <span class="number">#ff7676</span> <span class="number">70%</span>);</span><br><span class="line">  <span class="attr">--style-border</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--anzhiyu-card-border);</span><br><span class="line">  <span class="attr">--anzhiyu-blue-main</span>: <span class="number">#3b70fc</span>;</span><br><span class="line">  <span class="attr">--style-border-hover</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--anzhiyu-main);</span><br><span class="line">  <span class="attr">--style-border-dashed</span>: <span class="number">1px</span> dashed <span class="built_in">var</span>(--anzhiyu-theme-op);</span><br><span class="line">  <span class="attr">--style-border-avatar</span>: <span class="number">4px</span> solid <span class="built_in">var</span>(--anzhiyu-background);</span><br><span class="line">  <span class="attr">--style-border-always</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--anzhiyu-card-border);</span><br><span class="line">  <span class="attr">--anzhiyu-white-acrylic1</span>: <span class="number">#fefeff</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-white-acrylic2</span>: <span class="number">#fcfdff</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-black-acrylic2</span>: <span class="number">#08080a</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-black-acrylic1</span>: <span class="number">#0b0b0e</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-main-none</span>: <span class="number">#b8b8b800</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;light&quot;</span>]</span> &#123;</span><br><span class="line">  <span class="attr">--anzhiyu-theme</span>: <span class="number">#3b70fc</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-theme-op</span>: <span class="number">#4259ef23</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-blue</span>: <span class="number">#3b70fc</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-red</span>: <span class="number">#d8213c</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-pink</span>: <span class="number">#ff7c7c</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-green</span>: <span class="number">#57bd6a</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-fontcolor</span>: <span class="number">#363636</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-background</span>: <span class="number">#f7f9fe</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-reverse</span>: <span class="number">#000</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-maskbg</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.6</span>);</span><br><span class="line">  <span class="attr">--anzhiyu-maskbgdeep</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.85</span>);</span><br><span class="line">  <span class="attr">--anzhiyu-hovertext</span>: <span class="built_in">var</span>(--anzhiyu-theme);</span><br><span class="line">  <span class="attr">--anzhiyu-ahoverbg</span>: <span class="number">#f7f7fa</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-lighttext</span>: <span class="built_in">var</span>(--anzhiyu-main);</span><br><span class="line">  <span class="attr">--anzhiyu-secondtext</span>: <span class="built_in">rgba</span>(<span class="number">60</span>, <span class="number">60</span>, <span class="number">67</span>, <span class="number">0.6</span>);</span><br><span class="line">  <span class="attr">--anzhiyu-scrollbar</span>: <span class="built_in">rgba</span>(<span class="number">60</span>, <span class="number">60</span>, <span class="number">67</span>, <span class="number">0.4</span>);</span><br><span class="line">  <span class="attr">--anzhiyu-card-btn-bg</span>: <span class="number">#edf0f7</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-post-blockquote-bg</span>: <span class="number">#fafcff</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-post-tabs-bg</span>: <span class="number">#f2f5f8</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-secondbg</span>: <span class="number">#edf0f7</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-shadow-nav</span>: <span class="number">0</span> <span class="number">5px</span> <span class="number">12px</span> -<span class="number">5px</span> <span class="built_in">rgba</span>(<span class="number">102</span>, <span class="number">68</span>, <span class="number">68</span>, <span class="number">0.05</span>);</span><br><span class="line">  <span class="attr">--anzhiyu-card-bg</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-shadow-lightblack</span>: <span class="number">0</span> <span class="number">5px</span> <span class="number">12px</span> -<span class="number">5px</span> <span class="built_in">rgba</span>(<span class="number">102</span>, <span class="number">68</span>, <span class="number">68</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="attr">--anzhiyu-shadow-light2black</span>: <span class="number">0</span> <span class="number">5px</span> <span class="number">12px</span> -<span class="number">5px</span> <span class="built_in">rgba</span>(<span class="number">102</span>, <span class="number">68</span>, <span class="number">68</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="attr">--anzhiyu-card-border</span>: <span class="number">#c0c6d8</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> &#123;</span><br><span class="line">  <span class="attr">--global-bg</span>: <span class="number">#191919</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-theme</span>: <span class="number">#0084ff</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-theme-op</span>: <span class="number">#0084ff23</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-blue</span>: <span class="number">#0084ff</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-red</span>: <span class="number">#ff3842</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-pink</span>: <span class="number">#ff7c7c</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-green</span>: <span class="number">#57bd6a</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-fontcolor</span>: <span class="number">#f7f7fa</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-background</span>: <span class="number">#18171d</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-reverse</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-maskbg</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.6</span>);</span><br><span class="line">  <span class="attr">--anzhiyu-maskbgdeep</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.85</span>);</span><br><span class="line">  <span class="attr">--anzhiyu-hovertext</span>: <span class="number">#0a84ff</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-ahoverbg</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-lighttext</span>: <span class="number">#f2b94b</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-secondtext</span>: <span class="number">#a1a2b8</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-scrollbar</span>: <span class="built_in">rgba</span>(<span class="number">200</span>, <span class="number">200</span>, <span class="number">223</span>, <span class="number">0.4</span>);</span><br><span class="line">  <span class="attr">--anzhiyu-card-btn-bg</span>: <span class="number">#30343f</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-post-blockquote-bg</span>: <span class="number">#000</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-post-tabs-bg</span>: <span class="number">#121212</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-secondbg</span>: <span class="number">#30343f</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-shadow-nav</span>: <span class="number">0</span> <span class="number">5px</span> <span class="number">20px</span> <span class="number">0px</span> <span class="built_in">rgba</span>(<span class="number">28</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">0.4</span>);</span><br><span class="line">  <span class="attr">--anzhiyu-card-bg</span>: <span class="number">#1d1b26</span>;</span><br><span class="line">  <span class="attr">--anzhiyu-shadow-lightblack</span>: <span class="number">0</span> <span class="number">5px</span> <span class="number">12px</span> -<span class="number">5px</span> <span class="built_in">rgba</span>(<span class="number">102</span>, <span class="number">68</span>, <span class="number">68</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="attr">--anzhiyu-shadow-light2black</span>: <span class="number">0</span> <span class="number">5px</span> <span class="number">12px</span> -<span class="number">5px</span> <span class="built_in">rgba</span>(<span class="number">102</span>, <span class="number">68</span>, <span class="number">68</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="attr">--anzhiyu-card-border</span>: <span class="number">#42444a</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* @font-face &#123;</span></span><br><span class="line"><span class="comment">  font-family: Candyhome;</span></span><br><span class="line"><span class="comment">  src: url(https://npm.elemecdn.com/anzhiyu-blog@1.1.6/fonts/Candyhome.ttf);</span></span><br><span class="line"><span class="comment">  font-display: swap;</span></span><br><span class="line"><span class="comment">  font-weight: lighter;</span></span><br><span class="line"><span class="comment">&#125; */</span></span><br><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: ZhuZiAYuanJWD;</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">https://npm.elemecdn.com/anzhiyu-blog@1.1.6/fonts/ZhuZiAWan.woff2</span>);</span><br><span class="line">  <span class="attribute">font-display</span>: swap;</span><br><span class="line">  <span class="attribute">font-weight</span>: lighter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-id">#menus</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&quot;ZhuZiAYuanJWD&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">h1</span><span class="selector-id">#site-title</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: ZhuZiAYuanJWD;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">3em</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">a</span><span class="selector-class">.article-title</span>,</span><br><span class="line"><span class="selector-tag">a</span><span class="selector-class">.blog-slider__title</span>,</span><br><span class="line"><span class="selector-tag">a</span><span class="selector-class">.categoryBar-list-link</span>,</span><br><span class="line"><span class="selector-tag">h1</span><span class="selector-class">.post-title</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: ZhuZiAYuanJWD;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.iconfont</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&quot;iconfont&quot;</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">3em</span>;</span><br><span class="line">  <span class="comment">/* å¯ä»¥å®šä¹‰å›¾æ ‡å¤§å° */</span></span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">  -webkit-<span class="attribute">font-smoothing</span>: antialiased;</span><br><span class="line">  -moz-osx-<span class="attribute">font-smoothing</span>: grayscale;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ—¶é—´è½´ç”Ÿè‚–icon */</span></span><br><span class="line">svg<span class="selector-class">.icon</span> &#123;</span><br><span class="line">  <span class="comment">/* è¿™é‡Œå®šä¹‰svg.iconï¼Œé¿å…å’ŒButterflyè‡ªå¸¦çš„noteæ ‡ç­¾å†²çª */</span></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">1em</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">1em</span>;</span><br><span class="line">  <span class="comment">/* widthå’Œheightå®šä¹‰å›¾æ ‡çš„é»˜è®¤å®½åº¦å’Œé«˜åº¦*/</span></span><br><span class="line">  <span class="attribute">vertical-align</span>: -<span class="number">0.15em</span>;</span><br><span class="line">  fill: currentColor;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.icon-zhongbiao</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#f7c768</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* bilibliç•ªå‰§æ’ä»¶ */</span></span><br><span class="line"><span class="selector-id">#article-container</span> <span class="selector-class">.bangumi-tab</span><span class="selector-class">.bangumi-active</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--anzhiyu-theme);</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--anzhiyu-ahoverbg);</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">a</span><span class="selector-class">.bangumi-tab</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">text-decoration</span>: none <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.bangumi-button</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--anzhiyu-theme) <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10px</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--anzhiyu-ahoverbg) <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">a</span><span class="selector-class">.bangumi-button</span><span class="selector-class">.bangumi-nextpage</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">text-decoration</span>: none <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.bangumi-button</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">10px</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-class">.bangumi-tab</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">10px</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line">svg<span class="selector-class">.icon</span><span class="selector-class">.faa-tada</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.1em</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.bangumi-info-item</span> &#123;</span><br><span class="line">  <span class="attribute">border-right</span>: <span class="number">1px</span> solid <span class="number">#f2b94b</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.bangumi-info-item</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#f2b94b</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.bangumi-info-item</span> <span class="selector-tag">em</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#f2b94b</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è§£å†³artitalkçš„å›¾æ ‡é—®é¢˜ */</span></span><br><span class="line"><span class="selector-id">#uploadSource</span> &gt; svg &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">1.19em</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">1.5em</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*top-imgé»‘è‰²é€æ˜ç»ç’ƒæ•ˆæœç§»é™¤ï¼Œä¸å»ºè®®åŠ ï¼Œé™¤éä½ æ‰§ç€äºå®Œå…¨ä¸€å›¾æµæˆ–è€…èƒŒæ™¯å›¾å¯¹æ¯”è‰²æ˜æ˜¾ */</span></span><br><span class="line"><span class="selector-id">#page-header</span><span class="selector-pseudo">:not</span>(<span class="selector-class">.not-top-img</span>)<span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: transparent <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* é¦–é¡µæ–‡ç« å¡ç‰‡ */</span></span><br><span class="line"><span class="selector-id">#recent-posts</span> &gt; <span class="selector-class">.recent-post-item</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.9</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* é¦–é¡µä¾§æ å¡ç‰‡ */</span></span><br><span class="line"><span class="selector-id">#aside-content</span> <span class="selector-class">.card-widget</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.9</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ–‡ç« é¡µé¢æ­£æ–‡èƒŒæ™¯ */</span></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-id">#post</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.9</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* åˆ†é¡µé¡µé¢ */</span></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-id">#page</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.9</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* å½’æ¡£é¡µé¢ */</span></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-id">#archive</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.9</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ ‡ç­¾é¡µé¢ */</span></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-id">#tag</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.9</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* åˆ†ç±»é¡µé¢ */</span></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-id">#category</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.9</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*å¤œé—´æ¨¡å¼ä¼ªç±»é®ç½©å±‚é€æ˜*/</span></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-id">#recent-posts</span> &gt; <span class="selector-class">.recent-post-item</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#121212</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-class">.card-widget</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#121212</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-tag">div</span><span class="selector-id">#post</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#121212</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-tag">div</span><span class="selector-id">#tag</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#121212</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-tag">div</span><span class="selector-id">#archive</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#121212</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-tag">div</span><span class="selector-id">#page</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#121212</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-tag">div</span><span class="selector-id">#category</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#121212</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-tag">div</span><span class="selector-id">#category</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: transparent <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* é¡µè„šé€æ˜ */</span></span><br><span class="line"><span class="selector-id">#footer</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: transparent <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* å¤´å›¾é€æ˜ */</span></span><br><span class="line"><span class="selector-id">#page-header</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: transparent <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#rightside</span> &gt; <span class="selector-tag">div</span> &gt; <span class="selector-tag">button</span> &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ»šåŠ¨æ¡ */</span></span><br><span class="line"></span><br><span class="line">::-webkit-scrollbar &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">::-webkit-scrollbar-thumb &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#3b70fc</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">2em</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">::-webkit-scrollbar-corner &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: transparent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">::-moz-selection &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#3b70fc</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* éŸ³ä¹æ’­æ”¾å™¨ */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* .aplayer .aplayer-lrc &#123;</span></span><br><span class="line"><span class="comment">  display: none !important;</span></span><br><span class="line"><span class="comment">&#125; */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.aplayer</span><span class="selector-class">.aplayer-fixed</span><span class="selector-class">.aplayer-narrow</span> <span class="selector-class">.aplayer-body</span> &#123;</span><br><span class="line">  <span class="attribute">left</span>: -<span class="number">66px</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">0.3s</span>;</span><br><span class="line">  <span class="comment">/* é»˜è®¤æƒ…å†µä¸‹ç¼©è¿›å·¦ä¾§66pxï¼Œåªç•™ä¸€ç‚¹ç®­å¤´éƒ¨åˆ† */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.aplayer</span><span class="selector-class">.aplayer-fixed</span><span class="selector-class">.aplayer-narrow</span> <span class="selector-class">.aplayer-body</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">0.3s</span>;</span><br><span class="line">  <span class="comment">/* é¼ æ ‡æ‚¬åœæ˜¯å·¦ä¾§ç¼©è¿›å½’é›¶ï¼Œå®Œå…¨æ˜¾ç¤ºæŒ‰é’® */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.aplayer</span><span class="selector-class">.aplayer-fixed</span> &#123;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">999999</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è¯„è®ºæ¡†  */</span></span><br><span class="line"><span class="selector-class">.vwrap</span> &#123;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">2px</span> <span class="number">2px</span> <span class="number">5px</span> <span class="number">#bbb</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.3</span>);</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">30px</span> <span class="number">0px</span> <span class="number">30px</span> <span class="number">0px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è®¾ç½®è¯„è®ºæ¡† */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.vcard</span> &#123;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">2px</span> <span class="number">2px</span> <span class="number">5px</span> <span class="number">#bbb</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.3</span>);</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">30px</span> <span class="number">0px</span> <span class="number">0px</span> <span class="number">0px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* é¼ æ ‡å›¾æ ‡ */</span></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">cursor</span>: <span class="built_in">url</span>(<span class="string">&quot;/img/x1.cur&quot;</span>), auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">a</span>,</span><br><span class="line"><span class="selector-attr">[type=<span class="string">&quot;button&quot;</span>]</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:disabled</span>),</span><br><span class="line"><span class="selector-attr">[type=<span class="string">&quot;reset&quot;</span>]</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:disabled</span>),</span><br><span class="line"><span class="selector-attr">[type=<span class="string">&quot;submit&quot;</span>]</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:disabled</span>),</span><br><span class="line"><span class="selector-tag">button</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:disabled</span>) &#123;</span><br><span class="line">  <span class="attribute">cursor</span>: <span class="built_in">url</span>(<span class="string">&quot;/img/x2.cur&quot;</span>), auto <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* mdç½‘ç«™ä¸‹åˆ’çº¿ */</span></span><br><span class="line"><span class="selector-id">#article-container</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">text-decoration</span>: none <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#article-container</span> <span class="selector-id">#hpp_talk</span> <span class="selector-tag">p</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 404é¡µé¢ */</span></span><br><span class="line"><span class="selector-id">#error-wrap</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">40%</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">1rem</span>;</span><br><span class="line">  <span class="attribute">max-width</span>: <span class="number">1000px</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">0</span>, -<span class="number">50%</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#error-wrap</span> <span class="selector-class">.error-content</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: row;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">1rem</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">18rem</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--card-bg);</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="built_in">var</span>(--card-box-shadow);</span><br><span class="line">  <span class="attribute">transition</span>: all <span class="number">0.3s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#error-wrap</span> <span class="selector-class">.error-content</span> <span class="selector-class">.error-img</span> &#123;</span><br><span class="line">  box-<span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">border-top-left-radius</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">border-bottom-left-radius</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#3b70fc</span>;</span><br><span class="line">  <span class="attribute">background-position</span>: center;</span><br><span class="line">  <span class="attribute">background-size</span>: cover;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#error-wrap</span> <span class="selector-class">.error-content</span> <span class="selector-class">.error-info</span> &#123;</span><br><span class="line">  box-<span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0.5rem</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">font-family</span>: Titillium Web, <span class="string">&quot;PingFang SC&quot;</span>, <span class="string">&quot;Hiragino Sans GB&quot;</span>, <span class="string">&quot;Microsoft JhengHei&quot;</span>, <span class="string">&quot;Microsoft YaHei&quot;</span>, sans-serif;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#error-wrap</span> <span class="selector-class">.error-content</span> <span class="selector-class">.error-info</span> <span class="selector-class">.error_title</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: -<span class="number">4rem</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">9em</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#error-wrap</span> <span class="selector-class">.error-content</span> <span class="selector-class">.error-info</span> <span class="selector-class">.error_subtitle</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: -<span class="number">3.5rem</span>;</span><br><span class="line">  <span class="attribute">word-break</span>: break-word;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.6em</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#error-wrap</span> <span class="selector-class">.error-content</span> <span class="selector-class">.error-info</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">0.5rem</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0.3rem</span> <span class="number">1.5rem</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--btn-bg);</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--btn-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#body-wrap</span><span class="selector-class">.error</span> <span class="selector-class">.aside-list</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: row;</span><br><span class="line">  <span class="attribute">flex-wrap</span>: nowrap;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0px</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">1rem</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: scroll;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#body-wrap</span><span class="selector-class">.error</span> <span class="selector-class">.aside-list</span> <span class="selector-class">.aside-list-group</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: row;</span><br><span class="line">  <span class="attribute">flex-wrap</span>: nowrap;</span><br><span class="line">  <span class="attribute">max-width</span>: <span class="number">1200px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#body-wrap</span><span class="selector-class">.error</span> <span class="selector-class">.aside-list</span> <span class="selector-class">.aside-list-item</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0.5rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#body-wrap</span><span class="selector-class">.error</span> <span class="selector-class">.aside-list</span> <span class="selector-class">.aside-list-item</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">object-fit</span>: cover;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">12px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#body-wrap</span><span class="selector-class">.error</span> <span class="selector-class">.aside-list</span> <span class="selector-class">.aside-list-item</span> <span class="selector-class">.thumbnail</span> &#123;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">230px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">143px</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--anzhiyu-card-bg);</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#body-wrap</span><span class="selector-class">.error</span> <span class="selector-class">.aside-list</span> <span class="selector-class">.aside-list-item</span> <span class="selector-class">.content</span> <span class="selector-class">.title</span> &#123;</span><br><span class="line">  -webkit-line-clamp: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">display</span>: -webkit-box;</span><br><span class="line">  -webkit-box-orient: vertical;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.5</span>;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: flex-end;</span><br><span class="line">  <span class="attribute">align-content</span>: center;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">0.5rem</span>;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#body-wrap</span><span class="selector-class">.error</span> <span class="selector-class">.aside-list</span> <span class="selector-class">.aside-list-item</span> <span class="selector-class">.content</span> <span class="selector-tag">time</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ä»£ç æ¡†ä¸»é¢˜ */</span></span><br><span class="line"><span class="selector-id">#article-container</span> <span class="selector-tag">figure</span><span class="selector-class">.highlight</span> &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸éœ€è¦ä¸€å›¾æµ,åˆ é™¤ä¸Šé¢ä»£ç ä¸­çš„:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* é¡µè„šé€æ˜ */</span></span><br><span class="line"><span class="selector-id">#footer</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: transparent <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* å¤´å›¾é€æ˜ */</span></span><br><span class="line"><span class="selector-id">#page-header</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: transparent <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘æ„Ÿè§‰ä¸€å›¾æµæ›´å¥½çœ‹ä¸€äº›,åŒæ—¶ä¸è¦å¿˜è®°åœ¨<code>_config.butterfly.yml</code>ä¸­backgroundå±æ€§åæ·»åŠ èƒŒæ™¯å›¾ç‰‡çš„åœ°å€.</p><h1>ç»™ç½‘ç«™æ·»åŠ é¡µè„šå¾½æ ‡å’Œè®¡æ—¶å™¨</h1><img src="/posts/370bdedc/image-20221010191820950.png" class=""><p>å¾½æ ‡æˆ‘ä»¬åœ¨å¾ˆå¤šGitHubé¡¹ç›®çš„ä¸»é¡µä¸­ä¹Ÿä¼šçœ‹åˆ°ï¼Œæ¯”å¦‚ï¼š</p><img src="/posts/370bdedc/image-20221010164514318.png" class=""><p><a href="https://shields.io/">æ¨èä¸€ä¸ªå¾½æ ‡ç”Ÿæˆç½‘ç«™</a>ï¼Œä½†æ˜¯æ¯”è¾ƒå¯ä»¥çš„æ˜¯å¾½æ ‡çš„labeléƒ¨åˆ†åº•è‰²ä¿®æ”¹ä¸äº†ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰å›¾æ ‡ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><p>1.æ‰¾åˆ°åˆé€‚çš„å›¾ç‰‡ï¼Œå°½é‡ä¸è¦å¤ªå¤§ï¼ŒèƒŒæ™¯é€æ˜ï¼Œç„¶åå­˜å‚¨pngæ ¼å¼ã€‚</p><p>2.æ‰¾ä¸ªåœ¨çº¿è½¬base64å›¾ç‰‡çš„ç½‘ç«™ï¼Œæ¨è<a href="https://tool.chinaz.com/tools/imgtobase">è¿™ä¸ªåœ¨çº¿ç”ŸæˆBase64çš„ç½‘ç«™</a>,æŠŠåˆ¶ä½œå¥½çš„å›¾ç‰‡è½¬ä¸ºbase64é“¾æ¥ã€‚</p><p>3.æŠŠbase64é“¾æ¥ä½œä¸ºlogoå¡«è¿›å¾½æ ‡é“¾æ¥ï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://img.shields.io/badge/EddieLee-ä¸‹ç­å•¦-d021d6?style=&amp;logo=&lt;ç”Ÿæˆçš„base64ç¼–ç &gt;</span><br></pre></td></tr></table></figure><p>å°†ä¸Šé¢ç”Ÿæˆçš„é“¾æ¥ä½¿ç”¨Chromeæµè§ˆå™¨æ‰“å¼€ï¼Œç”¨Safariæ‰“å¼€æœ‰æ—¶ä¼šæŠ½é£æ˜¾ç¤ºä¸å‡ºæ¥ã€‚å°†æ‰“å¼€çš„é¡µé¢ä¸‹è½½ä¸‹æ¥ï¼Œä¸‹è½½ä¸‹æ¥çš„æ˜¯ä¸€ä¸ª<code>svg</code>æ–‡ä»¶ï¼Œå°†è¿™ä¸ªæ–‡ä»¶æ”¾åˆ°<code>/img</code>ç›®å½•ä¸‹ï¼Œæ–¹ä¾¿ç´¢å¼•ã€‚</p><p>åœ¨<code>Terminal</code>ä¸­å®‰è£…ä¾èµ–ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-butterfly-footer-beautify --save</span><br></pre></td></tr></table></figure><p>åœ¨<code>_config.butterfly.yml</code>ä¸­æ·»åŠ ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">footer_beautify:</span></span><br><span class="line">  <span class="attr">enable:</span></span><br><span class="line">    <span class="attr">timer:</span> <span class="literal">true</span> <span class="comment"># è®¡æ—¶å™¨å¼€å…³</span></span><br><span class="line">    <span class="attr">bdage:</span> <span class="literal">true</span> <span class="comment"># å¾½æ ‡å¼€å…³</span></span><br><span class="line">  <span class="attr">priority:</span> <span class="number">5</span> <span class="comment">#è¿‡æ»¤å™¨ä¼˜å…ˆæƒ</span></span><br><span class="line">  <span class="attr">enable_page:</span> <span class="string">all</span> <span class="comment"># åº”ç”¨é¡µé¢</span></span><br><span class="line">  <span class="attr">exclude:</span> <span class="comment">#å±è”½é¡µé¢</span></span><br><span class="line">    <span class="comment"># - /posts/</span></span><br><span class="line">    <span class="comment"># - /about/</span></span><br><span class="line">  <span class="attr">layout:</span> <span class="comment"># æŒ‚è½½å®¹å™¨ç±»å‹</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">id</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">footer-wrap</span></span><br><span class="line">    <span class="attr">index:</span> <span class="number">0</span></span><br><span class="line">  <span class="comment"># è®¡æ—¶å™¨éƒ¨åˆ†é…ç½®é¡¹</span></span><br><span class="line">  <span class="attr">runtime_js:</span>  <span class="string">/js/runtime/runtime.min.js</span></span><br><span class="line">  <span class="attr">runtime_css:</span> <span class="string">/css/runtime/runtime.min.css</span></span><br><span class="line">  <span class="comment"># å¾½æ ‡éƒ¨åˆ†é…ç½®é¡¹</span></span><br><span class="line">  <span class="attr">swiperpara:</span> <span class="number">4</span> <span class="comment">#è‹¥é0ï¼Œåˆ™å¼€å¯è½®æ’­åŠŸèƒ½ï¼Œæ¯è¡Œå¾½æ ‡ä¸ªæ•°</span></span><br><span class="line">  <span class="attr">bdageitem:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">link:</span> <span class="string">https://hexo.io/</span> <span class="comment">#å¾½æ ‡æŒ‡å‘ç½‘ç«™é“¾æ¥</span></span><br><span class="line">      <span class="attr">shields:</span> <span class="string">https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo</span> <span class="comment">#å¾½æ ‡API</span></span><br><span class="line">      <span class="attr">message:</span> <span class="string">åšå®¢æ¡†æ¶ä¸ºHexo_v5.4.0</span> <span class="comment">#å¾½æ ‡æç¤ºè¯­</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">link:</span> <span class="string">https://beian.miit.gov.cn/#/Integrated/index</span></span><br><span class="line">      <span class="attr">shields:</span> <span class="string">/img/å¤‡æ¡ˆ.svg</span></span><br><span class="line">      <span class="attr">message:</span> <span class="string">æœ¬ç«™å·²åœ¨é²è¿›è¡Œå¤‡æ¡ˆ</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">link:</span> <span class="string">https://butterfly.js.org/</span></span><br><span class="line">      <span class="attr">shields:</span> <span class="string">https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender</span></span><br><span class="line">      <span class="attr">message:</span> <span class="string">ä¸»é¢˜ç‰ˆæœ¬Butterfly_v3.8.2</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">link:</span> <span class="string">https://www.jsdelivr.com/</span></span><br><span class="line">      <span class="attr">shields:</span> <span class="string">https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&amp;logo=jsDelivr</span></span><br><span class="line">      <span class="attr">message:</span> <span class="string">æœ¬ç«™ä½¿ç”¨JsDelivrä¸ºé™æ€èµ„æºæä¾›CDNåŠ é€Ÿ</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">link:</span> <span class="string">https://vercel.com/</span></span><br><span class="line">      <span class="attr">shields:</span> <span class="string">https://img.shields.io/badge/Hosted-Vercel-brightgreen?style=flat&amp;logo=Vercel</span></span><br><span class="line">      <span class="attr">message:</span> <span class="string">æœ¬ç«™é‡‡ç”¨åŒçº¿éƒ¨ç½²ï¼Œé»˜è®¤çº¿è·¯æ‰˜ç®¡äºVercel</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">link:</span> <span class="string">https://vercel.com/</span></span><br><span class="line">      <span class="attr">shields:</span> <span class="string">https://img.shields.io/badge/Hosted-Coding-0cedbe?style=flat&amp;logo=Codio</span></span><br><span class="line">      <span class="attr">message:</span> <span class="string">æœ¬ç«™é‡‡ç”¨åŒçº¿éƒ¨ç½²ï¼Œè”é€šçº¿è·¯æ‰˜ç®¡äºCoding</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">link:</span> <span class="string">https://github.com/</span></span><br><span class="line">      <span class="attr">shields:</span> <span class="string">https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub</span></span><br><span class="line">      <span class="attr">message:</span> <span class="string">æœ¬ç«™é¡¹ç›®ç”±Githubæ‰˜ç®¡</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">link:</span> <span class="string">http://creativecommons.org/licenses/by-nc-sa/4.0/</span></span><br><span class="line">      <span class="attr">shields:</span> <span class="string">https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris</span></span><br><span class="line">      <span class="attr">message:</span> <span class="string">æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯</span></span><br><span class="line">    </span><br><span class="line">  <span class="attr">swiper_css:</span> <span class="string">https://unpkg.zhimg.com/hexo-butterfly-swiper/lib/swiper.min.css</span></span><br><span class="line">  <span class="attr">swiper_js:</span> <span class="string">https://unpkg.zhimg.com/hexo-butterfly-swiper/lib/swiper.min.js</span></span><br><span class="line">  <span class="attr">swiperbdage_init_js:</span> <span class="string">https://unpkg.zhimg.com/hexo-butterfly-footer-beautify/lib/swiperbdage_init.min.js</span></span><br><span class="line"><span class="comment"># see https://akilar.top/posts/8e1264d1/</span></span><br></pre></td></tr></table></figure><p>è®¡æ—¶å™¨éƒ¨åˆ†çš„ä¸¤ä¸ªæ–‡ä»¶ï¼šåœ¨åšå®¢æ ¹ç›®å½•ä¸‹çš„<code>source</code>æ–‡ä»¶å¤¹ä¸‹æ–°å»º<code>/runtime/runtime.css</code>å’Œ<code>js/runtime/runtime.js</code>æ–‡ä»¶ï¼Œå¡«å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* runtime.js */</span></span><br><span class="line"><span class="keyword">var</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createtime</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> t = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&quot;10/10/2022 00:00:00&quot;</span>);</span><br><span class="line">  now.<span class="title function_">setTime</span>(now.<span class="title function_">getTime</span>() + <span class="number">250</span>);</span><br><span class="line">  <span class="keyword">var</span> e = (now - t) / <span class="number">1e3</span> / <span class="number">60</span> / <span class="number">60</span> / <span class="number">24</span>,</span><br><span class="line">    a = <span class="title class_">Math</span>.<span class="title function_">floor</span>(e),</span><br><span class="line">    n = (now - t) / <span class="number">1e3</span> / <span class="number">60</span> / <span class="number">60</span> - <span class="number">24</span> * a,</span><br><span class="line">    r = <span class="title class_">Math</span>.<span class="title function_">floor</span>(n);</span><br><span class="line">  <span class="number">1</span> == <span class="title class_">String</span>(r).<span class="property">length</span> &amp;&amp; (r = <span class="string">&quot;0&quot;</span> + r);</span><br><span class="line">  <span class="keyword">var</span> s = (now - t) / <span class="number">1e3</span> / <span class="number">60</span> - <span class="number">1440</span> * a - <span class="number">60</span> * r,</span><br><span class="line">    i = <span class="title class_">Math</span>.<span class="title function_">floor</span>(s);</span><br><span class="line">  <span class="number">1</span> == <span class="title class_">String</span>(i).<span class="property">length</span> &amp;&amp; (i = <span class="string">&quot;0&quot;</span> + i);</span><br><span class="line">  <span class="keyword">var</span> o = (now - t) / <span class="number">1e3</span> - <span class="number">86400</span> * a - <span class="number">3600</span> * r - <span class="number">60</span> * i,</span><br><span class="line">    l = <span class="title class_">Math</span>.<span class="title function_">round</span>(o);</span><br><span class="line">  <span class="number">1</span> == <span class="title class_">String</span>(l).<span class="property">length</span> &amp;&amp; (l = <span class="string">&quot;0&quot;</span> + l);</span><br><span class="line">  <span class="keyword">let</span> g = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  (g =</span><br><span class="line">    r &lt; <span class="number">18</span> &amp;&amp; r &gt;= <span class="number">9</span></span><br><span class="line">      ? <span class="string">`&lt;img class=&#x27;boardsign&#x27; src=&#x27;/img/è¯ºå€¾åŸæ‘¸é±¼ä¸­.svg&#x27;&gt;&lt;span class=&#x27;textTip&#x27;&gt; &lt;br&gt; æœ¬ç«™å±…ç„¶è¿è¡Œäº† <span class="subst">$&#123;a&#125;</span> å¤©&lt;/span&gt;&lt;span id=&#x27;runtime&#x27;&gt; <span class="subst">$&#123;r&#125;</span> å°æ—¶ <span class="subst">$&#123;i&#125;</span> åˆ† <span class="subst">$&#123;l&#125;</span> ç§’ &lt;/span&gt; &lt;i class=&#x27;fas fa-heartbeat&#x27; style=&#x27;color:red&#x27;&gt;&lt;/i&gt;`</span></span><br><span class="line">      : <span class="string">`&lt;img class=&#x27;boardsign&#x27; src=&#x27;/img/è¯ºå€¾åŸä¸‹ç­å•¦.svg&#x27;&gt;&lt;span class=&#x27;textTip&#x27;&gt; &lt;br&gt; æœ¬ç«™å±…ç„¶è¿è¡Œäº† <span class="subst">$&#123;a&#125;</span> å¤©&lt;/span&gt;&lt;span id=&#x27;runtime&#x27;&gt; <span class="subst">$&#123;r&#125;</span> å°æ—¶ <span class="subst">$&#123;i&#125;</span> åˆ† <span class="subst">$&#123;l&#125;</span> ç§’ &lt;/span&gt; &lt;i class=&#x27;fas fa-heartbeat&#x27; style=&#x27;color:red&#x27;&gt;&lt;/i&gt;`</span>),</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;workboard&quot;</span>) &amp;&amp;</span><br><span class="line">      (<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;workboard&quot;</span>).<span class="property">innerHTML</span> = g);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">createtime</span>();</span><br><span class="line">&#125;, <span class="number">250</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* runtime.css */</span></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-id">#runtime</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">180px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: auto;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">padding-inline</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.7</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#workboard</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-tag">div</span><span class="selector-id">#runtime</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#28b4c8</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">5px</span> <span class="built_in">rgba</span>(<span class="number">28</span>, <span class="number">69</span>, <span class="number">218</span>, <span class="number">0.71</span>);</span><br><span class="line">  <span class="attribute">animation</span>: flashlight <span class="number">1s</span> linear infinite alternate;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#ghbdages</span> <span class="selector-class">.github-badge</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@-moz-keyframes</span> flashlight &#123;</span><br><span class="line">  <span class="selector-tag">from</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">5px</span> <span class="number">#1478d2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">to</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">2px</span> <span class="number">#1478d2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@-webkit-keyframes</span> flashlight &#123;</span><br><span class="line">  <span class="selector-tag">from</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">5px</span> <span class="number">#1478d2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">to</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">2px</span> <span class="number">#1478d2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@-o-keyframes</span> flashlight &#123;</span><br><span class="line">  <span class="selector-tag">from</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">5px</span> <span class="number">#1478d2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">to</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">2px</span> <span class="number">#1478d2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@keyframes</span> flashlight &#123;</span><br><span class="line">  <span class="selector-tag">from</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">5px</span> <span class="number">#1478d2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">to</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">2px</span> <span class="number">#1478d2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>VSCode</code>çš„æ’ä»¶<code>JS &amp; CSS Minifier (Minify)</code>ç”Ÿæˆ<code>runtime.min.css</code>å’Œ<code>runtime.min.js</code>æ–‡ä»¶ã€‚</p><h1>æ·»åŠ ç«™ç‚¹åŠ¨æ€Title</h1><p>åœ¨<code>[BlogRoot]/source/js/</code>ä¸‹æ–°å»º<code>title.js</code>,å¡«å…¥ä»¥ä¸‹ä»£ç ,<strong>æ³¨æ„è¦åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­Inject</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŠ¨æ€æ ‡é¢˜</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">OriginTitile</span> = <span class="variable language_">document</span>.<span class="property">title</span>;</span><br><span class="line"><span class="keyword">var</span> titleTime;</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;visibilitychange&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">hidden</span>) &#123;</span><br><span class="line">    <span class="comment">//ç¦»å¼€å½“å‰é¡µé¢æ—¶æ ‡ç­¾æ˜¾ç¤ºå†…å®¹</span></span><br><span class="line">    <span class="comment">//document.title = &quot;w(ï¾ŸĞ”ï¾Ÿ)w ä¸è¦èµ°ï¼å†çœ‹çœ‹å˜›ï¼&quot;;</span></span><br><span class="line">    <span class="comment">// clearTimeout(titleTime);</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//è¿”å›å½“å‰é¡µé¢æ—¶æ ‡ç­¾æ˜¾ç¤ºå†…å®¹</span></span><br><span class="line">    <span class="comment">//document.title = &quot;â™ª(^âˆ‡^*)æ¬¢è¿è‚¥æ¥ï¼&quot; + OriginTitile;</span></span><br><span class="line">    <span class="comment">//ä¸¤ç§’åå˜å›æ­£å¸¸æ ‡é¢˜</span></span><br><span class="line">    <span class="comment">// titleTime = setTimeout(function () &#123;</span></span><br><span class="line">    <span class="comment">//   document.title = OriginTitile;</span></span><br><span class="line">    <span class="comment">// &#125;, 2000);</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1>æ·»åŠ å¤–æŒ‚æ ‡ç­¾</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">https://www.npmjs.com/package/hexo-butterfly-tag-plugins-plus</span></span><br><span class="line">npm install hexo-butterfly-tag-plugins-plus --save</span><br><span class="line"></span><br><span class="line">npm uninstall hexo-renderer-marked --save</span><br><span class="line">npm install hexo-renderer-kramed --save</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹æ³•å‚è€ƒ:<a href="https://akilar.top/posts/615e2dec/">https://akilar.top/posts/615e2dec/</a></p><h1>å®‰è£…wowjs</h1><p><strong>éœ€è¦è§£å†³çš„é—®é¢˜ç¢°åˆ°äº†é—®é¢˜:</strong></p><p>â€‹æˆ‘åœ¨ç»™ä¸ªäººç®€ä»‹çš„ä¾§è¾¹æ åŠ ä¸Šå˜è‰²çš„æ•ˆæœå,è¿™ä¸€ä¸ªå¡ç‰‡çš„è½½å…¥åŠ¨ç”»å°±ä¸å—æ§åˆ¶äº†,å’Œå…¶ä»–çš„æ¿å—æ ¼æ ¼ä¸å…¥,é™¤äº†ä¸ªäººä¿¡æ¯å¡å¤„çš„åŠ¨ç”»ä¸å—æ§åˆ¶ä»¥å¤–,Git Calendarçš„åŠ è½½åŠ¨ç”»ä¹Ÿä¸å—æ§åˆ¶.éœ€è¦è§£å†³</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-butterfly-wowjs --save</span><br></pre></td></tr></table></figure><p>æ·»åŠ é…ç½®é¡¹</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wowjs</span></span><br><span class="line"><span class="comment"># see https://www.npmjs.com/package/hexo-butterfly-wowjs</span></span><br><span class="line"><span class="attr">wowjs:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment">#æ§åˆ¶åŠ¨ç”»å¼€å…³ã€‚trueæ˜¯æ‰“å¼€ï¼Œfalseæ˜¯å…³é—­</span></span><br><span class="line">  <span class="attr">priority:</span> <span class="number">10</span> <span class="comment">#è¿‡æ»¤å™¨ä¼˜å…ˆçº§</span></span><br><span class="line">  <span class="attr">mobile:</span> <span class="literal">false</span> <span class="comment">#ç§»åŠ¨ç«¯æ˜¯å¦å¯ç”¨ï¼Œé»˜è®¤ç§»åŠ¨ç«¯ç¦ç”¨</span></span><br><span class="line">  <span class="attr">animateitem:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">class:</span> <span class="string">recent-post-item</span> <span class="comment">#å¿…å¡«é¡¹ï¼Œéœ€è¦æ·»åŠ åŠ¨ç”»çš„å…ƒç´ çš„class</span></span><br><span class="line">      <span class="attr">style:</span> <span class="string">animate__zoomIn</span> <span class="comment">#å¿…å¡«é¡¹ï¼Œéœ€è¦æ·»åŠ çš„åŠ¨ç”»</span></span><br><span class="line">      <span class="attr">duration:</span> <span class="number">1.</span><span class="string">5s</span> <span class="comment">#é€‰å¡«é¡¹ï¼ŒåŠ¨ç”»æŒç»­æ—¶é—´ï¼Œå•ä½å¯ä»¥æ˜¯msä¹Ÿå¯ä»¥æ˜¯sã€‚ä¾‹å¦‚3sï¼Œ700msã€‚</span></span><br><span class="line">      <span class="attr">delay:</span> <span class="string">200ms</span> <span class="comment">#é€‰å¡«é¡¹ï¼ŒåŠ¨ç”»å¼€å§‹çš„å»¶è¿Ÿæ—¶é—´ï¼Œå•ä½å¯ä»¥æ˜¯msä¹Ÿå¯ä»¥æ˜¯sã€‚ä¾‹å¦‚3sï¼Œ700msã€‚</span></span><br><span class="line">      <span class="attr">offset:</span> <span class="number">30</span> <span class="comment">#é€‰å¡«é¡¹ï¼Œå¼€å§‹åŠ¨ç”»çš„è·ç¦»ï¼ˆç›¸å¯¹æµè§ˆå™¨åº•éƒ¨ï¼‰</span></span><br><span class="line">      <span class="attr">iteration:</span> <span class="number">1</span> <span class="comment">#é€‰å¡«é¡¹ï¼ŒåŠ¨ç”»é‡å¤çš„æ¬¡æ•°</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">class:</span> <span class="string">card-widget</span></span><br><span class="line">      <span class="attr">style:</span> <span class="string">animate__zoomIn</span></span><br><span class="line">      <span class="attr">delay:</span> <span class="string">200ms</span></span><br><span class="line">    <span class="comment"># - class: flink-list-card</span></span><br><span class="line">    <span class="comment">#   style: wowpanels</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">class:</span> <span class="string">flink-list-card</span></span><br><span class="line">      <span class="attr">style:</span> <span class="string">animate__flipInY</span></span><br><span class="line">      <span class="attr">duration:</span> <span class="string">3s</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">class:</span> <span class="string">flink-list-card</span></span><br><span class="line">      <span class="attr">style:</span> <span class="string">animate__animated</span></span><br><span class="line">      <span class="attr">duration:</span> <span class="string">3s</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">class:</span> <span class="string">article-sort-item</span></span><br><span class="line">      <span class="attr">style:</span> <span class="string">animate__slideInRight</span></span><br><span class="line">      <span class="attr">duration:</span> <span class="number">1.</span><span class="string">5s</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">class:</span> <span class="string">site-card</span></span><br><span class="line">      <span class="attr">style:</span> <span class="string">animate__flipInY</span></span><br><span class="line">      <span class="attr">duration:</span> <span class="string">3s</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">class:</span> <span class="string">site-card</span></span><br><span class="line">      <span class="attr">style:</span> <span class="string">animate__animated</span></span><br><span class="line">      <span class="attr">duration:</span> <span class="string">3s</span></span><br><span class="line">  <span class="attr">animate_css:</span> <span class="string">https://cdn.cbd.int/hexo-butterfly-wowjs/lib/animate.min.css</span></span><br><span class="line">  <span class="attr">wow_js:</span> <span class="string">https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow.min.js</span></span><br><span class="line">  <span class="attr">wow_init_js:</span> <span class="string">https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow_init.js</span></span><br></pre></td></tr></table></figure><h1>é­”æ”¹å…³äºé¡µé¢</h1><h1>æ·»åŠ æ‰“èµåŠŸèƒ½</h1><h1>å¤–æŒ‚æ ‡ç­¾çš„ä½¿ç”¨</h1><h1>æ·»åŠ GitCalendar</h1><h1>åœ¨ä¾§è¾¹æ æ·»åŠ ç”µå­æ—¶é’Ÿ</h1><h1>æ·»åŠ Butterfly Swiperæ’ä»¶</h1><h1>é€‚é…Bç«™è§†é¢‘</h1><p>åœ¨æ–‡ç« ä¸­æ·»åŠ Bç«™çš„è§†é¢‘</p><p>å°†ä¸‹é¢çš„ä»£ç ç›´æ¥å¤åˆ¶åˆ°ä½ æƒ³è¦æ·»åŠ è§†é¢‘çš„åšå®¢ä¸­å»,æ›¿æ¢æ‰aidåé¢é‚£ä¸€ä¸²å­—ç¬¦.<strong>æ³¨æ„,å¦‚æœä½ çš„è§†é¢‘IDæ˜¯BVå¼€å¤´,é‚£ä¹ˆè¦æŠŠaidæ›¿æ¢æˆbvid</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">class</span>=<span class="string">&quot;aspect-ratio&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">iframe</span></span></span><br><span class="line"><span class="tag">    <span class="attr">src</span>=<span class="string">&quot;https://player.bilibili.com/player.html?aid=556933559&amp;&amp;page=1&amp;as_wide=1&amp;high_quality=1&amp;danmaku=0&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">scrolling</span>=<span class="string">&quot;no&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">border</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">frameborder</span>=<span class="string">&quot;no&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">framespacing</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">high_quality</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">danmaku</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">allowfullscreen</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨source/css/custom.cssä¸­æ·»åŠ ä»¥ä¸‹ä»£ç </p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*å“”å“©å“”å“©è§†é¢‘é€‚é…*/</span></span><br><span class="line"><span class="selector-class">.aspect-ratio</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">75%</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">3%</span> auto;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.aspect-ratio</span> <span class="selector-tag">iframe</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div align="center" class="aspect-ratio">  <iframe    src="https://player.bilibili.com/player.html?bvid=BV1uT4y1P7CX&&page=1&as_wide=1&high_quality=1&danmaku=0"    scrolling="no"    border="0"    frameborder="no"    framespacing="0"    high_quality="1"    danmaku="1"    allowfullscreen="true"  ></iframe></div><h1>å­˜åœ¨Bug</h1><h2 id="æ–‡ç« ç›®å½•æ— æ³•è·³è½¬">æ–‡ç« ç›®å½•æ— æ³•è·³è½¬</h2><p>æ‰“å¼€æµè§ˆå™¨çš„å¼€å‘è€…æ¨¡å¼ï¼Œtoc-linkå¹¶æ²¡æœ‰ç”Ÿæˆï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•å®ç°è·³è½¬ï¼Œè§£å†³åŠæ³•ï¼š</p><p>å®‰è£…æ’ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install markdown-it-named-headings --save</span><br></pre></td></tr></table></figure><p>ç„¶åè¿›å…¥é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œä¿®æ”¹æ ¹ç›®å½•ä¸‹ <code>node_modules\hexo-renderer-markdown-it\lib\renderer.js</code> æ–‡ä»¶ï¼Œåœ¨ <code>renderer.js</code> ä¸­æ·»åŠ ä¸€è¡Œä»¥ä½¿ç”¨æ­¤æ’ä»¶ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parser.<span class="title function_">use</span>(<span class="built_in">require</span>(<span class="string">&#x27;markdown-it-named-headings&#x27;</span>))</span><br></pre></td></tr></table></figure><img src="/posts/370bdedc/%E6%88%AA%E5%B1%8F2023-03-1418.44.39.png" class=""><div class="tip warning faa-horizontal animated"><p>å› ä¸º<code>.gitignore</code>å¿½ç•¥äº†<code>node_modules</code>ä¸­çš„ä¿®æ”¹ï¼Œæ‰€ä»¥åœ¨æ–°çš„è®¾å¤‡ä¸Šgit pullä¸‹æ¥ä¹‹åè¿˜è¦æ‰‹åŠ¨åœ°æ·»åŠ ä¸Šé¢è¿™ä¸€è¡Œæ‰å¯ä»¥</p></div>]]></content>
      
      
      <categories>
          
          <category> ç¡¬æŠ€èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æŠ€æœ¯æ–‡æ¡£ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gité—®é¢˜æ‚è®°</title>
      <link href="/posts/a72e4bb6/"/>
      <url>/posts/a72e4bb6/</url>
      
        <content type="html"><![CDATA[<h1>ç»ˆç«¯ä¸­gitç›¸å…³æŒ‡ä»¤æ‰§è¡Œçš„ç»“æœä¸­çš„ä¸­æ–‡ä¹±ç é—®é¢˜</h1><ul><li>åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨<code>git status</code>å‘½ä»¤æ—¶ï¼Œç»“æœæ˜¾ç¤ºä¸ºä¹±ç <br>è§£å†³æ–¹æ³•æ˜¯åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹ä¸¤è¡Œå‘½ä»¤<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global core.quotepath true</span><br><span class="line">git config --global core.quotepath false</span><br></pre></td></tr></table></figure>é‡å¯ç»ˆç«¯ï¼Œå¦‚æœä»ç„¶æ˜¾ç¤ºä¹±ç ï¼Œæ‰§è¡Œä¸‹é¢ä¸¤è¡Œå‘½ä»¤<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global core.quotepath true</span><br><span class="line">git config --global core.quotepath false</span><br></pre></td></tr></table></figure>å†æ¬¡é‡å¯ç»ˆç«¯</li></ul><h1>Clone GitHubä»“åº“å¤±è´¥</h1><p>æ‹‰å–gitä»“åº“æœ‰å¦‚ä¸‹æŠ¥é”™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fatal: unable to access &#x27;https://github.com/xxxxx/xxxxxx.git/&#x27;: Failed to connect to github.com port 443 after 21052 ms: Couldn&#x27;t connect to server</span><br></pre></td></tr></table></figure><p>æœ‰å¯èƒ½æ˜¯å› ä¸ºæœ¬åœ°ä½¿ç”¨äº†ä»£ç†å·¥å…·ï¼Œæ¯”å¦‚Clashä¿®æ”¹äº†ç½‘ç»œç«¯å£ï¼Œè§£å†³æ–¹æ¡ˆå¦‚ä¸‹ğŸ‘‡ğŸ‘‡ğŸ‘‡</p><ul><li><a href="https://blog.csdn.net/qq_27281247/article/details/135925956">https://blog.csdn.net/qq_27281247/article/details/135925956</a></li></ul><h1>Gitä»“åº“å¤ªå¤§æ‹‰å–ä¸ä¸‹æ¥</h1><p>ä¸€äº›æ¯”è¾ƒå¤§çš„ä»“åº“,æ‹‰å–çš„æ—¶å€™ä¼šæœ‰å¦‚ä¸‹æŠ¥é”™:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">remote: Enumerating objects: 1315604, done.</span><br><span class="line">remote: Counting objects: 100% (1362/1362), done.</span><br><span class="line">remote: Compressing objects: 100% (850/850), done.</span><br><span class="line">error: RPC failed; curl 18 transfer closed with outstanding read data remaining</span><br><span class="line">error: 6333 bytes of body are still expected</span><br><span class="line">fetch-pack: unexpected disconnect while reading sideband packet</span><br><span class="line">fatal: early EOF</span><br><span class="line">fatal: fetch-pack: invalid index-pack output</span><br></pre></td></tr></table></figure><p>å› ä¸ºä»“åº“éå¸¸å¤§ï¼Œä¸€æ¬¡æ€§æ‹‰å–å¯èƒ½ä¼šå¯¼è‡´ç½‘ç»œå‹åŠ›è¿‡å¤§ã€‚å¯ä»¥å°è¯•ä½¿ç”¨ --depth å‚æ•°è¿›è¡Œæµ…å…‹éš†ï¼Œåªæ‹‰å–æœ€è¿‘çš„æäº¤è®°å½•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone --depth 1 &lt;repository-url&gt;</span><br></pre></td></tr></table></figure><p>æˆ–è€…å°è¯•å°†ç¼“å­˜å¢å¤§ä¸º1G:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.postBuffer 1048576000</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿˜æ˜¯ä¸è¡Œ,é‚£å°±å°è¯•æš´åŠ›æ‹‰å–,ç¼–å†™ä¸€ä¸ªshellè„šæœ¬é‡å¤æ‰§è¡Œæ‹‰å–ä»“åº“ç›´åˆ°æ‹‰å–æˆåŠŸ:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ£€æŸ¥æ˜¯å¦æä¾›äº†ä»“åº“ç›®å½•ä½œä¸ºå‚æ•°</span></span><br><span class="line">if [ $# -eq 0 ]; then</span><br><span class="line">    echo &quot;è¯·æä¾›è¦æ›´æ–°çš„ä»“åº“ç›®å½•ä½œä¸ºå‚æ•°ã€‚&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è·å–å‘½ä»¤è¡Œä¼ å…¥çš„ä»“åº“ç›®å½•</span></span><br><span class="line">REPO_DIR=&quot;$1&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ£€æŸ¥ä»“åº“ç›®å½•æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">if [ ! -d &quot;$REPO_DIR&quot; ]; then</span><br><span class="line">    echo &quot;æŒ‡å®šçš„ä»“åº“ç›®å½•ä¸å­˜åœ¨ã€‚&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥ä»“åº“ç›®å½•</span></span><br><span class="line">cd &quot;$REPO_DIR&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¾ªç¯æ‹‰å–æ›´æ–°ï¼Œç›´åˆ°æˆåŠŸ</span></span><br><span class="line">while true; do</span><br><span class="line">    git pull</span><br><span class="line">    # è·å–ä¸Šä¸€ä¸ªå‘½ä»¤çš„é€€å‡ºçŠ¶æ€ç </span><br><span class="line">    EXIT_CODE=$?</span><br><span class="line">    if [ $EXIT_CODE -eq 0 ]; then</span><br><span class="line">        echo &quot;ä»“åº“æ›´æ–°æˆåŠŸï¼&quot;</span><br><span class="line">        break</span><br><span class="line">    else</span><br><span class="line">        echo &quot;ä»“åº“æ›´æ–°å¤±è´¥ï¼Œå°†åœ¨ 5 ç§’åé‡è¯•...&quot;</span><br><span class="line">        sleep 5</span><br><span class="line">    fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h1>Git Submodule</h1><p><code>git submodule update --init --recursive</code> æ˜¯ä¸€ä¸ªåœ¨ä½¿ç”¨ Git ç®¡ç†é¡¹ç›®æ—¶éå¸¸å®ç”¨çš„å‘½ä»¤ï¼Œä¸‹é¢ä¸ºä½ è¯¦ç»†è§£é‡Šå®ƒçš„ç”¨é€”å’Œå…¶ä¸­å„å‚æ•°çš„å«ä¹‰ã€‚<br>æ•´ä½“ç”¨é€”<br>è¿™ä¸ªå‘½ä»¤ä¸»è¦ç”¨äºåˆå§‹åŒ–å¹¶æ›´æ–°é¡¹ç›®ä¸­çš„å­æ¨¡å—ï¼ˆsubmoduleï¼‰ã€‚å­æ¨¡å—æ˜¯ Git æä¾›çš„ä¸€ç§æœºåˆ¶ï¼Œå…è®¸åœ¨ä¸€ä¸ª Git ä»“åº“ä¸­åŒ…å«å¦ä¸€ä¸ªç‹¬ç«‹çš„ Git ä»“åº“ï¼Œä¸”èƒ½åˆ†åˆ«å¯¹å®ƒä»¬è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚å½“ä½ å…‹éš†ä¸€ä¸ªåŒ…å«å­æ¨¡å—çš„é¡¹ç›®æ—¶ï¼Œå­æ¨¡å—çš„ä»£ç ä¸ä¼šè‡ªåŠ¨å…‹éš†ä¸‹æ¥ï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æ¥è·å–å­æ¨¡å—çš„ä»£ç ã€‚<br>å‚æ•°è§£é‡Š<br>â€“init<br>ä½œç”¨ï¼šâ€“init å‚æ•°ç”¨äºåˆå§‹åŒ–å­æ¨¡å—ã€‚å½“ä½ å…‹éš†ä¸€ä¸ªåŒ…å«å­æ¨¡å—çš„é¡¹ç›®æ—¶ï¼Œä¸»é¡¹ç›®ä»“åº“ä¸­åªæ˜¯è®°å½•äº†å­æ¨¡å—çš„ä¸€äº›å¼•ç”¨ä¿¡æ¯ï¼ˆå¦‚å­æ¨¡å—çš„ä»“åº“åœ°å€ã€ç‰¹å®šçš„æäº¤å“ˆå¸Œå€¼ï¼‰ï¼Œå­æ¨¡å—çš„ä»£ç å¹¶æ²¡æœ‰å®é™…ä¸‹è½½åˆ°æœ¬åœ°ã€‚â€“init å‚æ•°ä¼šæ ¹æ®ä¸»é¡¹ç›®ä¸­è®°å½•çš„å­æ¨¡å—é…ç½®ä¿¡æ¯ï¼Œåœ¨æœ¬åœ°åˆ›å»ºå­æ¨¡å—çš„ä»“åº“ç›®å½•ï¼Œå¹¶è®¾ç½®å¥½å­æ¨¡å—çš„è¿œç¨‹ä»“åº“åœ°å€ç­‰ä¿¡æ¯ã€‚<br>ç¤ºä¾‹ï¼šå‡è®¾ä½ å…‹éš†äº†ä¸€ä¸ªåä¸º main-project çš„é¡¹ç›®ï¼Œå®ƒåŒ…å«ä¸€ä¸ªå­æ¨¡å— sub-projectã€‚åœ¨å…‹éš† main-project åï¼Œç›´æ¥æŸ¥çœ‹ sub-project ç›®å½•å¯èƒ½ä¸ºç©ºæˆ–è€…åªæœ‰ä¸€äº›é…ç½®æ–‡ä»¶ã€‚ä½¿ç”¨ git submodule update --init å‘½ä»¤åï¼ŒGit ä¼šæ ¹æ® main-project ä¸­è®°å½•çš„ä¿¡æ¯ï¼Œå°† sub-project çš„ä»£ç ä»è¿œç¨‹ä»“åº“å…‹éš†åˆ°æœ¬åœ°çš„ sub-project ç›®å½•ä¸­ã€‚<br>â€“recursive<br>ä½œç”¨ï¼šâ€“recursive å‚æ•°ç”¨äºé€’å½’åœ°åˆå§‹åŒ–å’Œæ›´æ–°å­æ¨¡å—ã€‚å¦‚æœå­æ¨¡å—æœ¬èº«è¿˜åŒ…å«å…¶ä»–å­æ¨¡å—ï¼ˆå³åµŒå¥—å­æ¨¡å—ï¼‰ï¼Œä½¿ç”¨ --recursive å‚æ•°å¯ä»¥ç¡®ä¿æ‰€æœ‰åµŒå¥—å­æ¨¡å—éƒ½è¢«æ­£ç¡®åˆå§‹åŒ–å’Œæ›´æ–°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¼šé€å±‚æ·±å…¥åˆ°æ¯ä¸€ä¸ªå­æ¨¡å—ä¸­ï¼Œå¯¹å…¶ä¸­åŒ…å«çš„å­æ¨¡å—ä¹Ÿæ‰§è¡Œç›¸åŒçš„åˆå§‹åŒ–å’Œæ›´æ–°æ“ä½œã€‚<br>ç¤ºä¾‹ï¼šå‡è®¾ main-project åŒ…å«å­æ¨¡å— sub-project1ï¼Œè€Œ sub-project1 åˆåŒ…å«å­æ¨¡å— sub-project2ã€‚ä½¿ç”¨ git submodule update --init --recursive å‘½ä»¤æ—¶ï¼ŒGit ä¸ä»…ä¼šåˆå§‹åŒ–å’Œæ›´æ–° sub-project1ï¼Œè¿˜ä¼šè¿›ä¸€æ­¥æ·±å…¥åˆ° sub-project1 ä¸­ï¼Œå¯¹ sub-project2 è¿›è¡Œåˆå§‹åŒ–å’Œæ›´æ–°ã€‚<br>å¸¸è§ä½¿ç”¨åœºæ™¯<br>å…‹éš†åŒ…å«å­æ¨¡å—çš„é¡¹ç›®å<br>å½“ä½ å…‹éš†ä¸€ä¸ªåŒ…å«å­æ¨¡å—çš„é¡¹ç›®æ—¶ï¼Œé€šå¸¸éœ€è¦æ‰§è¡Œè¿™ä¸ªå‘½ä»¤æ¥è·å–å­æ¨¡å—çš„ä»£ç ã€‚ä¾‹å¦‚ï¼š<br>bash<br>git clone <main-project-repo-url><br>cd main-project<br>git submodule update --init --recursive<br>æ‹‰å–ä¸»é¡¹ç›®æ›´æ–°å<br>å¦‚æœä¸»é¡¹ç›®æ›´æ–°äº†å­æ¨¡å—çš„å¼•ç”¨ä¿¡æ¯ï¼ˆå¦‚å­æ¨¡å—çš„æäº¤å“ˆå¸Œå€¼ï¼‰ï¼Œæˆ–è€…æ·»åŠ äº†æ–°çš„å­æ¨¡å—ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æ¥æ›´æ–°æœ¬åœ°çš„å­æ¨¡å—ä»£ç ï¼š<br>bash<br>git pull<br>git submodule update --init --recursive<br>é€šè¿‡ä½¿ç”¨ git submodule update --init --recursive å‘½ä»¤ï¼Œä½ å¯ä»¥æ–¹ä¾¿åœ°ç®¡ç†é¡¹ç›®ä¸­çš„å­æ¨¡å—ï¼Œç¡®ä¿å­æ¨¡å—çš„ä»£ç ä¸ä¸»é¡¹ç›®è®°å½•çš„å¼•ç”¨ä¿¡æ¯ä¿æŒä¸€è‡´ã€‚</p><h1>ä½¿ç”¨Gitç®¡ç†Unityé¡¹ç›®</h1><h2 id="äº†è§£Unityçš„ç›®å½•ç»“æ„">äº†è§£Unityçš„ç›®å½•ç»“æ„</h2><p>å®˜æ–¹å‚è€ƒæ–‡æ¡£https://docs.unity3d.com/Manual/ExternalVersionControlSystemSupport.html</p><ul><li>Assetsï¼šå­˜å‚¨æ‰€æœ‰æ¸¸æˆèµ„æºçš„æ–‡ä»¶å¤¹ï¼ŒåŒ…æ‹¬è„šæœ¬ã€çº¹ç†ã€å£°éŸ³ã€<code>ç¼–è¾‘å™¨å®šåˆ¶</code>ç­‰ç­‰ã€‚æ˜¯é¡¹ç›®ä¸­æœ€é‡è¦çš„æ–‡ä»¶å¤¹ã€‚</li><li>Libraryï¼šè¢«å¯¼å…¥èµ„æºçš„æœ¬åœ°ç¼“å­˜ï¼Œä½¿ç”¨Gitåšç‰ˆæœ¬æ§åˆ¶æ—¶ä¸éœ€è¦ç®¡è¿™ä¸ªæ–‡ä»¶å¤¹ã€‚å¦‚æœUnityçš„é¡¹ç›®æ–‡ä»¶å¤ªå¤§ï¼Œå¯ä»¥è¯•è¯•åˆ é™¤Libraryæ–‡ä»¶å¤¹</li><li>Logsï¼šæ—¥å¿—æ–‡ä»¶å¤¹ï¼Œç”±Unityè‡ªåŠ¨ç”Ÿæˆç®¡ç†ï¼Œè®°å½•æŠ¥é”™å´©æºƒä¿¡æ¯ï¼Œéšæ—¶å¯ä»¥åˆ é™¤æ¸…ç†</li><li>Packagesï¼šåŒ…é…ç½®ä¿¡æ¯ï¼Œç”±Unityè‡ªåŠ¨ç”Ÿæˆç®¡ç†ï¼Œç”¨äºæ”¾ç½®ä¸€äº›å®˜æ–¹ç»„ä»¶å’Œç¬¬ä¸‰æ–¹æ’ä»¶</li><li>ProjectSettingsï¼šå·¥ç¨‹è®¾ç½®ä¿¡æ¯ï¼Œç”±Unityè‡ªåŠ¨ç”Ÿæˆç®¡ç†</li><li>UserSettingsï¼šç¼–è¾‘å™¨çš„ç”¨æˆ·æ„å»ºè®¾ç½®ï¼Œè®°å½•ç”¨æˆ·çš„ä½¿ç”¨åå¥½ï¼Œå¦‚Unityç¼–è¾‘å™¨çš„å¸ƒå±€æ–¹å¼ç­‰ç­‰ã€‚</li><li>Tempï¼šä¸´æ—¶æ–‡ä»¶å¤¹ï¼ŒUnityè¿è¡Œè¿‡ç¨‹ä¸­ç”Ÿæˆçš„å†å²æ–‡ä»¶ã€‚</li></ul><p><a href="https://github.com/github/gitignore/blob/main/Unity.gitignore">è¿™é‡Œ</a>æ˜¯githubå®˜æ–¹æä¾›çš„ä¸åŒå·¥ç¨‹ä¸­gitignoreä¸­çš„å†…å®¹ï¼Œä½†æ˜¯å‚è€ƒä»·å€¼ä¸å¤§ï¼Œæˆ‘ä»¬è‡ªå·±é¡¹ç›®å·¥ç¨‹æ–‡ä»¶çš„æ–¹å¼å¾ˆå¤šæ ·ï¼ˆå½“ç„¶Unityå·¥ç¨‹æ–‡ä»¶å¤¹ä¸‹çš„åŸºæœ¬ç»“æ„æ˜¯ä¸å˜çš„ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šåœ¨å·¥ç¨‹æ–‡ä»¶å¤¹ä¹‹å¤–ä¸Šä¼ å¾ˆå¤šæˆ‘ä»¬è‡ªå·±çš„æ–‡ä»¶ï¼‰</p><p>2023.07.13æ›´æ–°</p><p>ç°åœ¨æˆ‘å¸Œæœ›è¿™ä¸ªå‘½ä»¤å¯ä»¥æ›´åŠ å…¨èƒ½ä¸€äº›ï¼Œå®ƒèƒ½å¤Ÿå¸®åŠ©æˆ‘åˆ›å»ºgitä»“åº“ã€åˆ›å»ºgitignoreã€åˆ›å»ºREADMEæ–‡ä»¶ä¸€ä½“çš„å‘½ä»¤ï¼Œæˆ‘å°†è¿™ä¸ªå‘½ä»¤å‘½åä¸º</p><p>ä½†æ˜¯æ¯ä¸€æ¬¡ç»™Unityé¡¹ç›®åˆ›å»ºGitä»“åº“çš„æ—¶å€™éƒ½éœ€è¦æ‰‹åŠ¨ç”Ÿæˆè¿™ä¸ª<code>.gitigonre</code>æ–‡ä»¶ï¼Œéå¸¸åœ°éº»çƒ¦ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨ç»ˆç«¯ç¼–å†™ä¸€ä¸ªå‘½ä»¤åœ¨è‡ªåŠ¨ç”Ÿæˆ<code>.ginignore</code>æ–‡ä»¶ï¼Œåœ¨Macå’ŒWindowsä¸Šæ“ä½œæœ‰æ‰€ä¸åŒã€‚</p><h3 id="Mac">Mac</h3><p>åœ¨Macçš„ç»ˆç«¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªShellè„šæœ¬æˆ–ç®€å•åœ°å®šä¹‰ä¸€ä¸ªåˆ«åæ¥å®ç°è‡ªå®šä¹‰å‘½ä»¤ã€‚æˆ‘çš„Macæ˜¯Zshç¯å¢ƒï¼š</p><ol><li><p>æ‰“å¼€<code>.zshrc</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.zshrc</span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">generate-unity-<span class="function"><span class="title">gitignore</span></span>() &#123;</span><br><span class="line">  curl https://raw.githubusercontent.com/github/gitignore/master/Unity.gitignore -o .gitignore</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä¿å­˜å¹¶é€€å‡ºç¼–è¾‘å™¨ï¼Œé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ä»¥åº”ç”¨æ›´æ”¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure></li></ol><p>ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„Unityé¡¹ç›®åï¼Œå»åˆ°è¯¥é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼Œä½¿ç”¨<code>generate-unity-gitignore</code>å°±å¯ä»¥ç”Ÿæˆ<code>.gitignore</code>æ–‡ä»¶äº†ã€‚</p><h3 id="Windows">Windows</h3><p>åœ¨Windowsçš„PowerShellç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°æ¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½ï¼š</p><ol><li><p>æ‰“å¼€WindowsPowerShell</p></li><li><p>åˆ›å»ºä¸€ä¸ªåä¸º<code>Microsoft.PowerShell_profile.ps1</code>çš„Profileæ–‡ä»¶</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!(<span class="built_in">Test-Path</span> <span class="literal">-Path</span> <span class="variable">$PROFILE</span>)) &#123;</span><br><span class="line">    <span class="built_in">New-Item</span> <span class="literal">-Type</span> File <span class="literal">-Path</span> <span class="variable">$PROFILE</span> <span class="literal">-Force</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€<code>Microsoft.PowerShell_profile.ps1</code>æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨PowerShellä¸­è¾“å…¥<code>$PROFILE</code>æ‰¾åˆ°æ–‡ä»¶çš„è·¯å¾„</p></li><li><p>å°†ä¸‹é¢çš„å†…å®¹æ·»åŠ åˆ°å…¶ä¸­ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate-unity-gitignore</span></span> &#123;</span><br><span class="line">    <span class="built_in">Invoke-WebRequest</span> <span class="literal">-Uri</span> <span class="string">&quot;https://raw.githubusercontent.com/github/gitignore/master/Unity.gitignore&quot;</span> <span class="literal">-OutFile</span> <span class="string">&quot;.gitignore&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä¿å­˜æ–‡ä»¶å¹¶é€€å‡ºç¼–è¾‘å™¨ï¼Œé‡å¯PowerShellçª—å£æˆ–è€…æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä½¿æ›´æ”¹ç”Ÿæ•ˆï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">. <span class="variable">$Profile</span></span><br></pre></td></tr></table></figure></li></ol><p>ç°åœ¨æˆ‘ä»¬åœ¨PowerShellçª—å£ä¸­è¾“å…¥<code>generate-unity-gitignore</code>å°±å¯ä»¥ç”Ÿæˆ<code>.gitignore</code>äº†</p><p>ä¸è¿‡åœ¨è¿‘æœŸçš„ä½¿ç”¨ä¸­æˆ‘å‘ç°ï¼Œ<code>gitigonre</code>çš„æ–‡ä»¶å†…å®¹æ˜¯ä»githubä¸Šè·å–çš„ï¼Œå¯¹ç½‘ç»œè´¨é‡è¦æ±‚é«˜ï¼Œæœ‰å¯èƒ½ä¼šåˆ›å»ºå¤±è´¥ï¼›è€Œä¸”ç”±äºæˆ‘ä½¿ç”¨çš„ç¼–è¾‘å™¨æ˜¯Riderï¼Œé¡¹ç›®æ–‡ä»¶å¤¹ä¸­ä¼šæœ‰ä¸€ä¸ª.ideaçš„æ–‡ä»¶å¤¹å¹¶æ²¡æœ‰è¢«åˆ—å…¥gitignoreä¸­ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥åœ¨ç”Ÿæˆäº†gitignoreæ–‡ä»¶ä¹‹åå†å°†è¿™ä¸ªæ–‡ä»¶å¤¹åŠ å…¥åˆ°æ–‡ä»¶çš„æœ«å°¾ï¼Œä½†æ˜¯è¿˜æ˜¯å¤ªç¹çäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹åˆ›å»º<code>gitignore</code>æ–‡ä»¶çš„æ–¹å¼ï¼Œæˆ‘ä»¬å°†Macå’ŒWindowså¯¹åº”çš„Shellè„šæœ¬å’ŒPowerShellè„šæœ¬ä¸­<code>generate-unity-gitignore</code>æ–¹æ³•çš„å†…å®¹æ›¿æ¢ï¼š</p><p>2023.07.13æ›´æ–°ï¼šç»è¿‡åœ¨å…¬å¸çš„å­¦ä¹ å’Œè‡ªå·±å¹³æ—¶çš„å¼€å‘ä½¿ç”¨ï¼Œæˆ‘ä»¬ç°åœ¨å°†è¿™ä¸ªåŠŸèƒ½æ‰©å±•ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨Gitç®¡ç†çš„æ ¹æ–‡ä»¶å¤¹å¯èƒ½ä¸ä»…ä»…æ˜¯ä¸€ä¸ªUnityçš„å·¥ç¨‹çš„æ ¹ç›®å½•ï¼Œå› æ­¤ä¹‹å‰çš„gitignoreæ–‡ä»¶å­˜åœ¨ä¸€å®šçš„å±€é™æ€§ï¼Œå› æ­¤æˆ‘åœ¨ä¹‹å‰çš„æ–‡ä»¶åŸºç¡€ä¸Šå¢åŠ ä¸€äº›æ‹“å±•æ€§æ›´é«˜çš„æ–¹æ¡ˆ</p><p><strong>Mac</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;# Unity .gitignore file</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/[Ll]ibrary/</span></span><br><span class="line"><span class="string">/[Tt]emp/</span></span><br><span class="line"><span class="string">/[Oo]bj/</span></span><br><span class="line"><span class="string">/[Bb]uild/</span></span><br><span class="line"><span class="string">/[Bb]uilds/</span></span><br><span class="line"><span class="string">/[Ll]ogs/</span></span><br><span class="line"><span class="string">/[Uu]ser[Ss]ettings/</span></span><br><span class="line"><span class="string">Assets/AssetStoreTools*</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Autogenerated VS/MD/Consulo solution and project files</span></span><br><span class="line"><span class="string">ExportedObj/</span></span><br><span class="line"><span class="string">*.csproj</span></span><br><span class="line"><span class="string">*.unityproj</span></span><br><span class="line"><span class="string">*.sln</span></span><br><span class="line"><span class="string">*.suo</span></span><br><span class="line"><span class="string">*.tmp</span></span><br><span class="line"><span class="string">*.user</span></span><br><span class="line"><span class="string">*.userprefs</span></span><br><span class="line"><span class="string">*.pidb</span></span><br><span class="line"><span class="string">*.booproj</span></span><br><span class="line"><span class="string">*.svd</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">*.dll.mdb</span></span><br><span class="line"><span class="string">*.exe.mdb</span></span><br><span class="line"><span class="string">*.mdb</span></span><br><span class="line"><span class="string">*.pdb</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">*.bak</span></span><br><span class="line"><span class="string">*/symlink</span></span><br><span class="line"><span class="string">*.swp</span></span><br><span class="line"><span class="string">*.swf</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Visual Studio cache directory</span></span><br><span class="line"><span class="string">.vs/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># JetBrains Rider cache files &amp; settings</span></span><br><span class="line"><span class="string">.idea/</span></span><br><span class="line"><span class="string">*.DotSettings.user</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># macOS-specific files</span></span><br><span class="line"><span class="string">.DS_Store</span></span><br><span class="line"><span class="string">._*</span></span><br><span class="line"><span class="string">Icon?</span></span><br><span class="line"><span class="string">*.bak.osx</span></span><br><span class="line"><span class="string">*.gmk.osx</span></span><br><span class="line"><span class="string">.cs.meta</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Thumbnails</span></span><br><span class="line"><span class="string">[Systeme][Cc]ache/</span></span><br><span class="line"><span class="string">[Tt]humbs.db</span></span><br><span class="line"><span class="string">*.stackdump</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Cache files for various systems</span></span><br><span class="line"><span class="string">library-*</span></span><br><span class="line"><span class="string">.sln.docstates</span></span><br><span class="line"><span class="string">.expressionblend</span></span><br><span class="line"><span class="string">Tmp_*</span></span><br><span class="line"><span class="string">_StyleCop.Cache</span></span><br><span class="line"><span class="string">.idea/</span></span><br><span class="line"><span class="string">.vsconfig</span></span><br><span class="line"><span class="string">&quot;</span> &gt;&gt; .gitignore</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>Windows</strong></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">@&#x27;</span></span><br><span class="line"><span class="string"># Unity .gitignore file</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">/[Ll]ibrary/</span></span><br><span class="line"><span class="string">/[Tt]emp/</span></span><br><span class="line"><span class="string">/[Oo]bj/</span></span><br><span class="line"><span class="string">/[Bb]uild/</span></span><br><span class="line"><span class="string">/[Bb]uilds/</span></span><br><span class="line"><span class="string">/[Ll]ogs/</span></span><br><span class="line"><span class="string">/[Uu]ser[Ss]ettings/</span></span><br><span class="line"><span class="string">Assets/AssetStoreTools*</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Autogenerated VS/MD/Consulo solution and project files</span></span><br><span class="line"><span class="string">ExportedObj/</span></span><br><span class="line"><span class="string">*.csproj</span></span><br><span class="line"><span class="string">*.unityproj</span></span><br><span class="line"><span class="string">*.sln</span></span><br><span class="line"><span class="string">*.suo</span></span><br><span class="line"><span class="string">*.tmp</span></span><br><span class="line"><span class="string">*.user</span></span><br><span class="line"><span class="string">*.userprefs</span></span><br><span class="line"><span class="string">*.pidb</span></span><br><span class="line"><span class="string">*.booproj</span></span><br><span class="line"><span class="string">*.svd</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">*.dll.mdb</span></span><br><span class="line"><span class="string">*.exe.mdb</span></span><br><span class="line"><span class="string">*.mdb</span></span><br><span class="line"><span class="string">*.pdb</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">*.bak</span></span><br><span class="line"><span class="string">*/symlink</span></span><br><span class="line"><span class="string">*.swp</span></span><br><span class="line"><span class="string">*.swf</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Visual Studio cache directory</span></span><br><span class="line"><span class="string">.vs/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># JetBrains Rider cache files &amp; settings</span></span><br><span class="line"><span class="string">.idea/</span></span><br><span class="line"><span class="string">*.DotSettings.user</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># macOS-specific files</span></span><br><span class="line"><span class="string">.DS_Store</span></span><br><span class="line"><span class="string">._*</span></span><br><span class="line"><span class="string">Icon?</span></span><br><span class="line"><span class="string">*.bak.osx</span></span><br><span class="line"><span class="string">*.gmk.osx</span></span><br><span class="line"><span class="string">.cs.meta</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Thumbnails</span></span><br><span class="line"><span class="string">[Systeme][Cc]ache/</span></span><br><span class="line"><span class="string">[Tt]humbs.db</span></span><br><span class="line"><span class="string">*.stackdump</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Cache files for various systems</span></span><br><span class="line"><span class="string">library-*</span></span><br><span class="line"><span class="string">.sln.docstates</span></span><br><span class="line"><span class="string">.expressionblend</span></span><br><span class="line"><span class="string">Tmp_*</span></span><br><span class="line"><span class="string">_StyleCop.Cache</span></span><br><span class="line"><span class="string">./idea</span></span><br><span class="line"><span class="string">.vsconfig</span></span><br><span class="line"><span class="string">&#x27;@</span> | <span class="built_in">Set-Content</span> <span class="literal">-Path</span> <span class="string">&quot;.gitignore&quot;</span> <span class="literal">-Encoding</span> utf8</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦‚æœä¹‹åè¿˜æœ‰éœ€è¦å¿½ç•¥çš„æ–‡ä»¶ï¼Œåœ¨è¿™ä¸¤æ®µå†…å®¹çš„æœ«å°¾æ·»åŠ æˆ‘ä»¬è¦å¿½ç•¥çš„æ–‡ä»¶åå³å¯ã€‚</p><h2 id="ä½¿ç”¨SourceTreeç®¡ç†Unityé¡¹ç›®">ä½¿ç”¨SourceTreeç®¡ç†Unityé¡¹ç›®</h2><p><code>SourceTree</code>æ˜¯å¸¦æœ‰å¯è§†åŒ–ç•Œé¢çš„<code>Git</code>ï¼Œæœ‰äº†å®ƒèƒ½å¤Ÿå¤§å¤§æé«˜æˆ‘ä»¬ç‰ˆæœ¬ç®¡ç†çš„æ•ˆç‡ï¼Œä¸‹é¢è®°å½•çš„æ˜¯æˆ‘åœ¨ä½¿ç”¨<code>SourceTree</code>é¢å¯¹ä¸€äº›è¾ƒä¸ºå¤æ‚çš„ä½¿ç”¨åœºæ™¯æ—¶çš„åŸºæœ¬æµç¨‹ï¼Œä¸ºä¹‹åé‡åˆ°ç±»ä¼¼æµç¨‹åšä¸€ä¸ªå‚ç…§ã€‚</p><h2 id="åœ¨Windowsä¸Šä½¿ç”¨SourceTreeæ‰§è¡Œgitå‘½ä»¤æœ‰å¦‚ä¸‹æŠ¥é”™">åœ¨Windowsä¸Šä½¿ç”¨SourceTreeæ‰§è¡Œgitå‘½ä»¤æœ‰å¦‚ä¸‹æŠ¥é”™</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">The host key is not cached for this server:</span><br><span class="line"> gitee.com(port22)</span><br><span class="line">You have no guarantee that the server is the computer</span><br><span class="line">you think it is</span><br><span class="line">The server&#x27;s ssh-ed25519 key fingerprint is:</span><br><span class="line">.................................</span><br><span class="line">if you trust this host, enter &quot;y&quot; to add thie key to</span><br></pre></td></tr></table></figure><p>æ‰“å¼€Windowsç‰ˆçš„SourceTreeï¼Œåœ¨èœå•æ ä¸­é€‰æ‹©<code>å·¥å…·``-&gt;``é€‰é¡¹``-&gt;``ä¸€èˆ¬``-&gt;``SSHå®¢æˆ·ç«¯é…ç½®``-&gt;``SSHå®¢æˆ·ç«¯</code>é€‰æ‹©<code>OpenSSH</code>å°±å¯ä»¥è§£å†³é—®é¢˜ ã€‚</p><h3 id="ä½¿ç”¨SourceTreeåœ¨é”™è¯¯çš„åˆ†æ”¯ä¸Šåšäº†ä¿®æ”¹ï¼Œå¦‚ä½•å°†ä¿®æ”¹ä»é”™è¯¯çš„åˆ†æ”¯è½¬ç§»åˆ°æ­£ç¡®çš„åˆ†æ”¯ä¸Šï¼Ÿ">ä½¿ç”¨SourceTreeåœ¨é”™è¯¯çš„åˆ†æ”¯ä¸Šåšäº†ä¿®æ”¹ï¼Œå¦‚ä½•å°†ä¿®æ”¹ä»é”™è¯¯çš„åˆ†æ”¯è½¬ç§»åˆ°æ­£ç¡®çš„åˆ†æ”¯ä¸Šï¼Ÿ</h3><p>ç´§æ¥ç€ä¸Šé¢é‚£ä¸ªåœ¨ä¸€ä¸ªé¡¹ç›®ä¸­å‘ä¸¤ä¸ªäº‘ç«¯ä»“åº“åŒæ­¥æ›´æ–°ç‰ˆæœ¬çš„ä¾‹å­ä½¿ç”¨åœºæ™¯ï¼Œæˆ‘ææœ‰å¯èƒ½åœ¨<code>Learn</code>åˆ†æ”¯ä¸Šè¿›è¡Œå­¦ä¹ çš„æ—¶å€™çªç„¶è¦ä¿®å¤ä¸€ä¸ªbugæˆ–è€…å®Œæˆæ–°çš„éœ€æ±‚ï¼Œä½†æ˜¯æˆ‘å¿˜è®°åˆ‡æ¢åˆ†æ”¯åˆ°<code>master</code>ä¸Šï¼Œäºæ˜¯æˆ‘åœ¨<code>Learn</code>åˆ†æ”¯ä¸Šå®Œæˆçš„ä»£ç çš„ç¼–å†™ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘å¸Œæœ›å°†æˆ‘åœ¨<code>Learn</code>åˆ†æ”¯ä¸Šåšçš„ä¿®æ”¹è½¬ç§»åˆ°<code>master</code>åˆ†æ”¯ä¸Šï¼Œéœ€è¦ä½¿ç”¨è´®è—<code>stash</code>çš„åŠŸèƒ½ï¼ŒåŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>å½“å‰åˆ†æ”¯æ˜¯<code>Learn</code>ï¼Œç¡®ä¿éœ€è¦æ›´æ”¹åˆ†æ”¯çš„å†…å®¹éƒ½å¤„äºæœªæäº¤<code>commit</code>çš„çŠ¶æ€</li><li>é€‰ä¸­éœ€è¦æ›´æ”¹åˆ†æ”¯çš„å†…å®¹ï¼Œç‚¹å‡»è´®è—<code>stash</code></li><li>åˆ‡æ¢åˆ°<code>master</code>åˆ†æ”¯ä¸Šï¼Œåº”ç”¨åˆšæ‰ç”Ÿæˆçš„è´®è—ï¼Œå°±å°†åœ¨<code>Learn</code>åˆ†æ”¯ä¸Šåšçš„ä¿®æ”¹ç§»åŠ¨åˆ°äº†<code>master</code>åˆ†æ”¯ä¸Š</li><li>æäº¤åˆ°è¿œç¨‹ä»“åº“</li></ol><h3 id="gitignoreæ²¡æœ‰ç”Ÿæ•ˆï¼Œå°†æœ¬åº”è¯¥ignoreçš„æ–‡ä»¶æäº¤äº†è¯¥æ€ä¹ˆåŠï¼Ÿ">gitignoreæ²¡æœ‰ç”Ÿæ•ˆï¼Œå°†æœ¬åº”è¯¥ignoreçš„æ–‡ä»¶æäº¤äº†è¯¥æ€ä¹ˆåŠï¼Ÿ</h3><p>ä»Šå¤©åœ¨ä½¿ç”¨<code>generate-unity-gitignore</code>æ–¹æ³•åœ¨ç»ˆç«¯ä¸­ç”Ÿæˆgitignoreæ–‡ä»¶çš„æ—¶å€™ï¼Œåœ¨æäº¤çš„æ—¶å€™å‘ç°gitignoreæ–‡ä»¶å¥½åƒå¹¶æ²¡æœ‰ç”Ÿæ•ˆï¼Œæäº¤äº†å¤§é‡Libraryå’ŒLogsæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ï¼Œå¯¼è‡´<code>git add .</code>æ“ä½œå¡äº†å¥½ä¹…ï¼Œä½†æ˜¯å·²ç»å°†ä¸è¯¥æäº¤çš„æ–‡ä»¶æäº¤ä¸Šå»äº†ï¼Œè§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><p>1.åˆ é™¤æ‰åŸæ¥çš„.gitignoreæ–‡ä»¶</p><p>2.åˆ›å»ºæ–°çš„.gitignoreæ–‡ä»¶å¹¶ä¸”ç¡®ä¿æ ¼å¼æ­£ç¡®ã€è¦å¿½ç•¥çš„æ–‡ä»¶å¡«å†™æ­£ç¡®</p><p>3.æ¸…é™¤å·²ç»è¢«è·Ÿè¸ªçš„æ–‡ä»¶ç¼“å­˜ï¼Œå¦‚æœè¦é€’å½’åœ°åˆ é™¤æ–‡ä»¶å¤¹ï¼Œè®°å¾—ä½¿ç”¨<code>-r</code>é€‰é¡¹ï¼Œ<code>&lt;directory_path&gt;</code>è¦æ›¿æ¢æˆUnityé¡¹ç›®çš„æ ¹è·¯å¾„ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm -r --cached &lt;directory_path&gt;</span><br></pre></td></tr></table></figure><p>4.æäº¤æ›´æ”¹ï¼Œgitå¸¸è§„ä¸‰ä»¶å¥—ï¼š<code>add</code>ã€<code>commit</code>ã€<code>push</code></p><p>ä¸€èˆ¬æƒ…å†µä¸‹è¿™ç§é—®é¢˜åªä¼šå‡ºç°åœ¨ç¬¬ä¸€æ¬¡æäº¤çš„æ—¶å€™ï¼Œè€Œåœ¨SourceTreeä¸­åœ¨åªæœ‰ä¸€æ¬¡æäº¤çš„æƒ…å†µä¸‹æ²¡æœ‰åŠæ³•æ’¤å›ï¼Œå…·ä½“åšæ³•æ˜¯ï¼Œå°†å·²ç»æäº¤çš„ä½†æ˜¯ä¸éœ€è¦è¿½è¸ªçš„æ–‡ä»¶åˆ é™¤æ‰ï¼Œåœ¨SourceTreeä¸­å°±åšäº†ä¸€æ¬¡æ›´æ”¹ï¼Œç„¶åæäº¤ä¸€æ¬¡</p><p>ç„¶åæ›´æ–°æ–°çš„gitignoreæ–‡ä»¶ï¼Œç„¶åæ’¤é”€åˆ é™¤</p><p>è€Œåœ¨SourceTreeå½“ä¸­çš„æ“ä½œæ–¹æ³•æ˜¯ï¼šæˆ‘ä»¬é¦–å…ˆè¦å°†.gitignoreæ–‡ä»¶æ›´æ–°åˆ°æ­£ç¡®çš„å†…å®¹ï¼Œç„¶åå°†.gitignoreæ–‡ä»¶è´®è—èµ·æ¥ï¼Œé€‰ä¸­æˆ‘ä»¬é”™è¯¯çš„é‚£æ¬¡æäº¤è®°å½•ã€‚</p><p>Gité’©å­çš„ä½¿ç”¨</p><p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ç»å¸¸éœ€è¦æ›´æ”¹æœ¬åœ°çš„æ—¶é—´å»æµ‹è¯•ä¸€äº›æ´»åŠ¨çš„åŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼Œè¿™å¯¼è‡´äº†æˆ‘å¾ˆå¯èƒ½åœ¨æ²¡æœ‰å°†æ—¶é—´è°ƒæ•´å›æ¥å°±åœ¨é”™è¯¯çš„æ—¶é—´ä¸‹å°†æœ¬åœ°çš„ä¿®æ”¹è¿›è¡Œäº†æäº¤ï¼Œå› ä¸ºæˆ‘ä»¬çš„æ¯æ¬¡æäº¤çš„æ—¶é—´ä¼šè¢«è®°å½•ï¼Œåœ¨æäº¤å†å²ä¸­ä¼šå‡ºç°æ–°ä¸€æ¬¡æäº¤è®°å½•çš„æ—¶é—´å´æ¯”ä¹‹å‰æäº¤çš„æ—¶é—´è¿˜è¦å¾€å‰è¿™ç§è¯¡å¼‚çš„è®°å½•ï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›åœ¨æˆ‘ä»¬åšäº†æœ¬åœ°ä¿®æ”¹åœ¨æäº¤ä¹‹å‰ï¼Œå¯ä»¥å…ˆè‡ªåŠ¨åœ°æ£€éªŒæœ¬åœ°çš„æ—¶é—´æ˜¯å¦æ˜¯æ­£ç¡®çš„ï¼Œå› æ­¤æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨åˆ°Gité’©å­ï¼Œ</p><h1>å‚è€ƒèµ„æ–™</h1><p><a href="https://git-scm.com/book/zh/v2">å®˜æ–¹å‚è€ƒä¹¦</a></p>]]></content>
      
      
      <categories>
          
          <category> ç‰ˆæœ¬ç®¡ç†å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VSCodeé…ç½®UnityC#å¼€å‘ç¯å¢ƒ</title>
      <link href="/posts/e57f243c/"/>
      <url>/posts/e57f243c/</url>
      
        <content type="html"><![CDATA[<h1>èƒŒæ™¯</h1><p>ç¬”è€…å¤§å­¦æœŸé—´ç”¨è¿‡ä¸€æ®µæ—¶é—´VSCode+Unityçš„å¼€å‘æ–¹æ¡ˆï¼Œå·¥ä½œä¹‹åä½¿ç”¨äº†Rideré…åˆUnityå¼€å‘ä¹‹åï¼Œè™½ç„¶Rideræ˜¯ä¸€ä¸ªååˆ†å¼ºå¤§çš„IDEï¼Œæœ‰å¼ºå¤§çš„è¡¥å…¨åŠŸèƒ½ï¼Œå¼ºå¤§çš„DebugåŠŸèƒ½ï¼Œä½†æ˜¯ä¹Ÿè®©æˆ‘å¯¹Rideräº§ç”Ÿäº†ä¾èµ–ã€‚å¦å¤–Rideræ²¡æœ‰å…è´¹çš„ç¤¾åŒºç‰ˆï¼Œå› æ­¤è¿˜æ˜¯æƒ³è¦ä½¿ç”¨ä¸€ä¸ªæ›´åŠ è½»é‡çº§çš„ä¿æŒè‡ªå·±å¯¹ä»£ç çš„ç†Ÿæ‚‰ç¨‹åº¦<br>å¦å¤–VSCodeçš„æ’ä»¶ä¹Ÿè®©äººçœ¼å‰ä¸€äº®</p><img src="/posts/e57f243c/image-20220707015057151.png" class=""><p><a href="https://www.bilibili.com/video/BV19741167zU?spm_id_from=333.999.0.0&amp;vd_source=83f4165825ce9df46cf4fd576ccb1102">éº¦æ‰£çš„è§†é¢‘é“¾æ¥</a></p><p><a href="https://code.visualstudio.com/docs/other/unity">VS code å®˜æ–¹æ–‡æ¡£</a></p><h2 id="å‰ç½®å‡†å¤‡-Prerequisites">å‰ç½®å‡†å¤‡ Prerequisites</h2><ol><li><p>å®‰è£…<a href="https://dotnet.microsoft.com/zh-cn/download">.NET SDK</a>ï¼Œæ‰§è¡Œ dotnet --version æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</p></li><li><p>ï¼ˆè¿™ä¸€æ­¥åªé’ˆå¯¹Windowsç”¨æˆ·ï¼‰é‡å¯Windowsè®©æ›´æ”¹çš„è®¾ç½®ç”Ÿæ•ˆ</p></li><li><p>ï¼ˆè¿™ä¸€æ­¥åªé’ˆå¯¹Macç”¨æˆ·)å®‰è£…é•¿æœŸæ”¯æŒç‰ˆ<a href="https://www.mono-project.com/download/stable/">Mono</a>ï¼Œé¿å…é‡åˆ° â€œSome projects have trouble loading. Please review the output for more detailsâ€ çš„é—®é¢˜ æ‰§è¡Œ mono --version æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</p><p>Note: é¢å¤–å®‰è£…çš„è¿™ä¸ªMonoï¼Œä¸ä¼šå¹²é¢„Unityå†…ç½®å®‰è£…çš„Mono</p></li><li><p>åœ¨VSCodeä¸­å®‰è£…C#çš„æ‰©å±•</p></li><li><p>åœ¨VSCodeçš„è®¾ç½®ä¸­ï¼Œå–æ¶ˆå‹¾é€‰ C# extensionâ€™s Omnisharp: Use Modern Net setting(â€œomnisharp.useModernNetâ€ : false)</p><img src="/posts/e57f243c/image-20220707013823965.png" class=""></li></ol><h2 id="åœ¨Unityä¸­è®¾ç½®VSCodeä¸ºé»˜è®¤çš„è„šæœ¬ç¼–è¾‘å™¨">åœ¨Unityä¸­è®¾ç½®VSCodeä¸ºé»˜è®¤çš„è„šæœ¬ç¼–è¾‘å™¨</h2><p>é€‰æ‹© Unity Preferences -&gt; External Toolsï¼Œé€‰æ‹©VSCode.</p><img src="/posts/e57f243c/%E6%88%AA%E5%B1%8F2022-07-0701.43.12.png" class=""><h2 id="å°ç»“">å°ç»“</h2><p>With the solution file selected, you are now ready to start editing with VS Code. Here is a list of some of the things you can expect:</p><ul><li>Syntax Highlighting</li><li>Bracket matching</li><li>IntelliSense</li><li>Snippets</li><li>CodeLens</li><li>Peek</li><li>Go-to Definition</li><li>Code Actions/Lightbulbs</li><li>Go to symbol</li><li>Hover</li></ul><p><strong>å·¨å¤§çš„å‘</strong>ï¼šæˆ‘åœ¨å®‰è£…å®Œæˆdotnetå’Œmonoç»„ä»¶å¹¶ä¸”è®¾ç½®vscodeä¸ºé»˜è®¤ç¼–è¾‘å™¨ä¹‹åï¼Œåœ¨VSCodeä¸­è¾“å…¥rigidbodyæ—¶å¹¶æ²¡æœ‰è¯­æ³•æç¤ºï¼Œä½†<strong>è€å¿ƒç­‰å¾…ä¸€æ®µæ—¶é—´</strong>åï¼Œè¯­æ³•æç¤ºå°±å‡ºç°äº†â€¦â€¦è¿™ä¸ªæœ¬ä¸å­˜åœ¨çš„é—®é¢˜å›°æ‰°äº†æˆ‘ä¸¤å¤©â€¦â€¦</p><img src="/posts/e57f243c/958EBB7CEA0FF5AF41A9A3FECC90845C.jpg" class=""><p>æ™šå®‰ã€‚</p><h1>èƒŒæ™¯</h1><p>æœ¬æ–‡ä¸»è¦è®°å½•å¦‚ä½•é…ç½®.NETç¯å¢ƒï¼Œä»¥åŠå¦‚ä½•åˆ›å»ºæœ€ç®€å•çš„C# applicationã€‚</p><h1>åœ¨Macä¸Šé…ç½®dotNetå¼€å‘ç¯å¢ƒ</h1><p>è¿™é‡Œæ˜¯.Net7çš„<a href="https://download.visualstudio.microsoft.com/download/pr/86bb5988-5fb5-4e22-8f21-de5992e1a689/f8f616f84dc38100a8464c4644a371ce/dotnet-sdk-7.0.201-osx-arm64.pkg">ä¸‹è½½åœ°å€</a>ï¼Œæ‰“å¼€ä¸‹è½½çš„pkgï¼ŒæŒ‰ç…§æŒ‡å¼•å®Œæˆå®‰è£…ã€‚åœ¨ç»ˆç«¯ä¸­è¾“å…¥<code>dotnet</code>ï¼Œå¦‚æœå®‰è£…æˆåŠŸï¼Œä¼šå¼¹å‡ºå¦‚ä¸‹å†…å®¹ï¼š</p><h1>ä½¿ç”¨Terminalåˆ›å»ºä¸€ä¸ªæœ€ç®€å•çš„C#å‘½ä»¤</h1><p>åœ¨ç»ˆç«¯ä¸­è¾“å…¥ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dotnet new console -o MyApp -f net7.0</span><br><span class="line">cd MyApp</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°å„å‘½ä»¤çš„è§£é‡Šï¼š</p><ul><li><code>dotnet new conslole</code> å‘½ä»¤ç”¨æ¥åˆ›å»ºæ–°çš„console APP</li><li>-<code>o</code>å‚æ•°ä¼šåˆ›å»ºåä¸º<code>MyApp</code>çš„ç›®å½•ï¼Œç”¨äºå­˜å‚¨åº”ç”¨å¹¶ä½¿ç”¨æ‰€éœ€æ–‡ä»¶è¿›è¡Œå¡«å……</li><li><code>-f</code>å‚æ•°æŒ‡ç¤ºconsoleæˆ‘ä»¬åˆ›å»ºçš„æ˜¯.NET7çš„åº”ç”¨ç¨‹åº</li></ul><p>åˆ›å»ºçš„MyAppæ–‡ä»¶å¤¹ä¸­çš„ä¸»æ–‡ä»¶ç§°ä¸º<code>Program..cs</code>ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒåŒ…å«çš„å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Console.WriteLine(<span class="string">&quot;Hello World!&quot;</span>);</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ç»ˆç«¯ä¸­è¿è¡Œ<code>dotnet run</code>æ¥è¿è¡Œ<code>.NET</code>åº”ç”¨ï¼Œç»ˆç«¯ä¸­ä¼šè¾“å‡ºå¦‚ä¸‹ç»“æœï¼š</p><h2 id="ä½¿ç”¨Rideræ‰“å¼€å¹¶è¿è¡ŒC-é¡¹ç›®">ä½¿ç”¨Rideræ‰“å¼€å¹¶è¿è¡ŒC#é¡¹ç›®</h2><p>ä½¿ç”¨Rideræ‰“å¼€å¹¶è¿è¡ŒC#é¡¹ç›®ä¸åƒä½¿ç”¨IDEAæ‰“å¼€å¹¶è¿è¡Œjavaä»£ç é‚£æ ·ç¹çï¼Œç›´æ¥åœ¨Riderä¸­é€‰æ‹©<code>File</code>-&gt;<code>Open</code>ï¼Œé€‰æ‹©ä½ ä½¿ç”¨Terminalåˆ›å»ºçš„C# applicationæ‰“å¼€ï¼Œå°±å¯ä»¥åœ¨Riderä¸­è¿è¡Œé¡¹ç›®äº†ã€‚</p><h1>åœ¨Windowsä¸Šé…ç½®dotNetå¼€å‘ç¯å¢ƒ</h1><p>Windowsä¸Šå®‰è£…dotNetçš„æ–¹å¼å¤šç§å¤šæ ·ï¼Œè€Œä¸”å®˜æ–¹çš„æ•™ç¨‹ä¹Ÿå¾ˆè¯¦ç»†ï¼Œå¯ä»¥ç›´æ¥çœ‹<a href="https://learn.microsoft.com/zh-cn/dotnet/core/install/windows?tabs=net70">å®˜ç½‘æ•™ç¨‹</a></p>]]></content>
      
      
      <categories>
          
          <category> ç¯å¢ƒé…ç½® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C# </tag>
            
            <tag> Unity </tag>
            
            <tag> VSCode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»é›¶å¼€å§‹éƒ¨ç½²ä¸ªäººåšå®¢åˆ°äº‘æœåŠ¡å™¨</title>
      <link href="/posts/d182d23d/"/>
      <url>/posts/d182d23d/</url>
      
        <content type="html"><![CDATA[<h1>èƒŒæ™¯</h1><p>æœ€è¿‘æœåŠ¡å™¨è¢«æŒ–çŸ¿ç¨‹åºæ”»å‡»äº†ï¼Œé˜¿é‡Œäº‘ç–¯ç‹‚ç»™æˆ‘å‘æ¶ˆæ¯ï¼Œè¯´å†ä¸å¤„ç†è¦æŠŠæˆ‘çš„æœåŠ¡å™¨å°äº†ï¼Œæ¯”èµ·æ‰¾å‡ºæŒ–çŸ¿ç¨‹åºç„¶åæ¸…ç†æ‰ï¼Œæˆ‘å®æ„¿é€‰æ‹©æŠŠæœåŠ¡å™¨é‡åˆ¶è¿™æ ·æ›´ç®€å•ç²—æš´çš„æ–¹æ³•ï¼Œäºæ˜¯æœ‰äº†è¿™ç¯‡æ–‡ç« ï¼šä»é›¶å¼€å§‹æ­å»ºhexoåšå®¢éƒ¨ç½²åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šã€‚</p><h1>åŸç†</h1><ol><li><p>é¦–å…ˆåœ¨æœ¬åœ°hexoç”Ÿæˆåšå®¢çš„é™æ€æ–‡ä»¶</p></li><li><p>å°†ç”Ÿæˆçš„é™æ€æ–‡ä»¶éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨</p></li><li><p>äº‘æœåŠ¡å™¨é€šè¿‡git-hookåŒæ­¥åˆ°ç½‘ç«™æ ¹ç›®å½•</p></li></ol><h1>æ­å»ºæµç¨‹</h1><h2 id="æœ¬åœ°ç¯å¢ƒæ­å»º">æœ¬åœ°ç¯å¢ƒæ­å»º</h2><ul><li><p>hexo</p></li><li><p>git</p></li><li><p>nodejs</p></li></ul><h2 id="æœåŠ¡å™¨ç¯å¢ƒæ­å»º">æœåŠ¡å™¨ç¯å¢ƒæ­å»º</h2><ul><li><p>nginx</p></li><li><p>git</p></li></ul><h2 id="æœåŠ¡å™¨ç¯å¢ƒæ­å»ºæ­¥éª¤">æœåŠ¡å™¨ç¯å¢ƒæ­å»ºæ­¥éª¤</h2><ol><li><p>å®‰è£…git</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install git  </span><br><span class="line">git --version    #æŸ¥çœ‹gitæ˜¯å¦å®‰è£…æˆåŠŸ    </span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºgitç”¨æˆ·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">adduser git</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ä¿®æ”¹æƒé™</span></span><br><span class="line">chmod 740 /etc/sudoers</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ç¼–è¾‘</span></span><br><span class="line">vim /etc/sudoers</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># Allow root to run any commands anywhere</span></span></span><br><span class="line">root    ALL=(ALL)     ALL</span><br></pre></td></tr></table></figure><p>åœ¨ä¸‹é¢æ·»åŠ ä»£ç ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git    ALL=(ALL)    ALL</span><br></pre></td></tr></table></figure><p>ä¿å­˜é€€å‡ºåæ”¹å›æƒé™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 400 /etc/suders</span><br></pre></td></tr></table></figure></li><li><p>gitæœåŠ¡å™¨å¼€å¯RSAè®¤è¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ssh/ssd_config</span><br></pre></td></tr></table></figure><p>åœ¨â€™sshd_configâ€™ä¸­è®¾ç½®ä»¥ä¸‹å‡ é¡¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RSAAuthentication yes</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line">AuthorizedKeysFile  .ssh/authorized_keys</span><br></pre></td></tr></table></figure><p>è®¾ç½®gitç”¨æˆ·å¯†ç ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo passwd git</span><br></pre></td></tr></table></figure></li><li><p>é…ç½®ssh</p><p>è¿™é‡Œæ˜¯ä¸ºäº†å…å¯†ç™»é™†ï¼Œæˆ‘è®¾ç½®æ²¡é—®é¢˜ï¼Œä½†æ˜¯è¿˜æ˜¯éœ€è¦å¯†ç ï¼ˆæ±—</p><p><strong>æœ¬åœ°å®¢æˆ·ç«¯ç”Ÿæˆå…¬ç§é’¥</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ä¸ªå‘½ä»¤ä¼šåœ¨ç”¨æˆ·.sshæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºå…¬ç§é’¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/.ssh</span><br><span class="line">ls</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id_rsa(ç§é’¥)</span><br><span class="line">id_rsa.pub(å…¬é’¥)</span><br></pre></td></tr></table></figure><p><strong>ä¸Šä¼ å…¬é’¥åˆ°æœåŠ¡å™¨</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub root@139.224.82.218</span><br><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub git@139.224.82.218</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿™é‡Œæˆ‘ä¸¤ä¸ªç”¨æˆ·éƒ½ä¸Šä¼ äº†</span></span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•å…å¯†ç™»é™†</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh git@139.224.82.218</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘è®¾ç½®äº†å…å¯†ç™»é™†å´è¿˜æ˜¯éœ€è¦è¾“å…¥å¯†ç äº†ï¼Œåœ¨æˆ‘çš„ç”µè„‘ä¸Šï¼Œå¿…é¡»è¿›å…¥rootæ¨¡å¼ï¼Œæ‰èƒ½ä½¿ç”¨hexoè¯­å¥ï¼Œè€Œæˆ‘åœ¨æ²¡æœ‰è¿›å…¥<code>root</code>æ¨¡å¼çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå°±æ˜¯ä¸€èˆ¬ç”¨æˆ·æ¨¡å¼ä¸‹ï¼Œå»è®¾ç½®äº†å¦‚ä¸Šçš„sshå…å¯†ç™»é™†ï¼Œæ‰€ä»¥è¯´æˆ‘æ ¹æœ¬å°±æ²¡æœ‰ç»™æˆ‘çš„rootç”¨æˆ·æˆæƒå…å¯†ç™»é™†ï¼Œæ‰€ä»¥æ­£ç¡®çš„åšæ³•æ˜¯å…ˆè¿›å…¥rootæ¨¡å¼ï¼Œå†è¿›è¡Œä¸Šé¢çš„æ“ä½œã€‚æ­£ç¡®æ­¥éª¤å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1.å…ˆè¿›å…¥hexoæ–‡ä»¶æ ¹ç›®å½•ï¼Œå¦‚æœå…ˆè¿›å…¥rootæ¨¡å¼çš„è¯å½“å‰è·¯å¾„å°±å˜æˆäº†/var/rootäº†</span></span><br><span class="line">cd blog</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2.è¿›å…¥rootæ¨¡å¼</span></span><br><span class="line">sudo su</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">3.è·å¾—sshå…¬ç§é’¥</span></span><br><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure><p><strong>å›åˆ°äº‘æœåŠ¡å™¨</strong></p><p>æ›´æ”¹æ–‡ä»¶å¤¹æƒé™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 ~/.ssh/authorized_keys</span><br><span class="line">chmod 700 ~/.ssh</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºgitä»“åº“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir /home/blogRepo</span><br><span class="line"></span><br><span class="line">chmod 777 /home/blogRepo</span><br><span class="line"></span><br><span class="line">cd /home/blogRepo</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">é»˜è®¤åˆ›å»ºåœ¨ /home/git/ç›®å½•ä¸‹</span></span><br><span class="line">git init --bare hexo.git</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>bare</code>å‚æ•°ï¼Œgitå°±ä¼šåˆ›å»ºä¸€ä¸ªè£¸ä»“åº“ï¼Œè£¸ä»“åº“æ²¡æœ‰å·¥ä½œåŒºï¼Œæˆ‘ä»¬ä¸ä¼šåœ¨è£¸ä»“åº“ä¸Šè¿›è¡Œæ“ä½œï¼Œå®ƒåªä¸ºå…±äº«è€Œå­˜åœ¨</p><p><strong>è®¾ç½®é’©å­</strong></p><p>åœ¨<code>blog.git/hooks</code>ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª<code>post-receive</code>æ–‡ä»¶ï¼Œå¹¶ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /home/blogRepo/hexo.git/hooks/post-receive</span><br></pre></td></tr></table></figure><p>åœ¨æ–‡ä»¶ä¸­å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">git --work-tree=/home/website/MyBlog --git-dir=/home/blogRepo/hexo.git checkout -f</span><br></pre></td></tr></table></figure><p>è®¾ç½®è¿™ä¸ªæ–‡ä»¶çš„å¯æ‰§è¡Œæƒé™</p><pre><code>chmod +x /home/blogRepo/hexo.git/hooks/post-receive</code></pre></li><li><p>åˆ›å»º<code>post-receive</code>æ–‡ä»¶ä¸­çš„è·¯å¾„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœä¹‹å‰çš„æ“ä½œä¸€ç›´éƒ½æ˜¯åœ¨rootç”¨æˆ·ä¸‹ï¼Œé‚£gitä»“åº“çš„æ‰€æœ‰è€…å°±æ˜¯rootï¼Œè¿™ä¸€æ­¥éœ€è¦æŠŠgitä»“åº“çš„æ‰€æœ‰è€…ç»™gitç”¨æˆ·</span></span><br><span class="line">sudo chown -R git:git hexo.git</span><br><span class="line"></span><br><span class="line">su root</span><br><span class="line"></span><br><span class="line">cd /home</span><br><span class="line"></span><br><span class="line">mkdir website/MyBlog</span><br><span class="line"></span><br><span class="line">chmod 777 /home/website</span><br><span class="line"></span><br><span class="line">chmod 777 /home/website/MyBlog</span><br></pre></td></tr></table></figure></li><li><p>ä¸‹è½½nginx</p><p>æˆ‘æ˜¯ç”¨yumä¸‹è½½çš„ï¼Œæ‰€ä»¥æˆ‘nginxçš„é…ç½®ç›®å½•åœ¨<code>/etc/nginx/nginx.conf</code>ä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install nginx</span><br><span class="line"></span><br><span class="line">vim /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°é…ç½®æ–‡ä»¶ä¸­çš„æ®µè½ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    ......</span><br><span class="line">    # ç«™ç‚¹æ ¹ç›®å½•</span><br><span class="line">    root /home/website/MyBlog;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯nginxæœåŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹æœ¬åœ°hexoé…ç½®æ–‡ä»¶</p><p><strong>ä¸€å®šè¦å…ˆè¿›å…¥hexoåˆ›å»ºçš„æ–‡ä»¶å¤¹ä¸­å†ä½¿ç”¨hexoè¯­å¥ï¼Œä¸ç„¶ä¼šæŠ¥é”™</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim _config.yml</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹é…ç½®æ–‡ä»¶å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Deployment</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># Docs: https://hexo.io/docs/one-command-deployment</span></span></span><br><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: git@soincredible777.com.cn:/home/blogRepo/hexo.git</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure></li><li><p>hexo éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g -d</span><br></pre></td></tr></table></figure><p>å¤§åŠŸå‘Šæˆï¼</p></li></ol><h1>2023å¹´3æœˆ13æ—¥æ›´æ–°</h1><p>å› ä¸ºç›®å‰ä½¿ç”¨äº†Butterflyçš„åšå®¢ä¸»é¢˜ï¼Œæƒ³è¦ç»™æ¯ç¯‡æ–‡ç« é…ç½®ä¸€ä¸ªå°é¢ï¼Œæ•…ä½¿ç”¨Niginxé…ç½®ä¸€ä¸ªç®€å•çš„å›¾åºŠï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯è®©Nginxå¯ä»¥è®¿é—®ä¸¤ä¸ªè·¯å¾„ï¼Œä¸€ä¸ªæ˜¯åšå®¢çš„è·¯å¾„ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯å›¾ç‰‡å­˜æ”¾çš„è·¯å¾„ï¼Œæ‰“å¼€Nginxçš„é…ç½®æ–‡ä»¶/etc/nginx/nginx.confï¼Œåœ¨å…¶ä¸­æ·»åŠ ä¸€ä¸ªserver</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">      listen       80;</span><br><span class="line">      listen       [::]:80;</span><br><span class="line">      server_name  _;</span><br><span class="line">      root        /home/website/MyBlog/;</span><br><span class="line"></span><br><span class="line">      # Load configuration files for the default server block.</span><br><span class="line">      include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">      error_page 404 /404.html;</span><br><span class="line">      location = /404.html &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      error_page 500 502 503 504 /50x.html;</span><br><span class="line">      location = /50x.html &#123;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  # ä¸Šé¢æ˜¯åšå®¢çš„æœåŠ¡</span><br><span class="line">  # ä¸‹é¢æ˜¯å›¾åºŠçš„æœåŠ¡</span><br><span class="line">  # æ³¨æ„æŠŠç«¯å£çš„é˜²ç«å¢™æƒé™æ‰“å¼€</span><br><span class="line">  server &#123;</span><br><span class="line">      listen       90;</span><br><span class="line">      listen       [::]:90;</span><br><span class="line">      server_name  _;</span><br><span class="line">      root        /home/website/ImageHost/;</span><br><span class="line"></span><br><span class="line">      # Load configuration files for the default server block.</span><br><span class="line">      include /etc/nginx/default.d/*.conf;</span><br><span class="line"></span><br><span class="line">      error_page 404 /404.html;</span><br><span class="line">      location = /404.html &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      error_page 500 502 503 504 /50x.html;</span><br><span class="line">      location = /50x.html &#123;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>æ·»åŠ å®Œæˆåé‡å¯ä»¥ä¸‹Nginx <code>nginx -s reload</code>ï¼Œç°åœ¨å°†å›¾ç‰‡ä¸Šä¼ åˆ°é…ç½®ä¸­çš„å›¾ç‰‡å­˜æ”¾è·¯å¾„ä¸­ï¼Œå°±å¯ä»¥ä½¿ç”¨<code>åŸŸå:ç«¯å£å·/å›¾ç‰‡åç§°</code>è®¿é—®åˆ°å›¾ç‰‡äº†ã€‚</p><p>ä¹‹åä¼šä¸ä¼šæœ‰æ—¶é—´åšä¸€ä¸ªWebAppæ¥å¯è§†åŒ–åœ°ç®¡ç†å›¾ç‰‡å‘¢ï¼Ÿ</p>]]></content>
      
      
      <categories>
          
          <category> ç¡¬æŠ€èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> äº‘æœåŠ¡å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®ç°åŸºäºfrpçš„å†…ç½‘ç©¿é€</title>
      <link href="/posts/1408599b/"/>
      <url>/posts/1408599b/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©èŠ±äº†ä¸€å¤©çš„æ—¶é—´ï¼Œæ‰æŠŠå†…ç½‘ç©¿é€ç»™æå¥½äº†ï¼Œè¿™æ¬¡æŠŠæ­¥éª¤å¥½å¥½è®°ä¸‹æ¥ï¼Œä¸‹æ¬¡å†éœ€è¦é‡æ–°é…ç½®å¯ä»¥æœ‰ä¸ªå‚ç…§ã€‚</p><h2 id="æˆ‘éœ€è¦ç”¨å†…ç½‘ç©¿é€åšä»€ä¹ˆï¼Ÿ">æˆ‘éœ€è¦ç”¨å†…ç½‘ç©¿é€åšä»€ä¹ˆï¼Ÿ</h2><p>æˆ‘å¯å®¤é‡Œæœ‰ä¸€å°iMacï¼Œè¿˜æœ‰ä¸€å°MacBookã€‚æˆ‘åœ¨ä¸¤å°è®¾å¤‡ä¸Šéƒ½æœ‰ç¼–è¾‘åšå®¢çš„éœ€æ±‚ï¼Œä½†å¦‚æœåœ¨ä¸¤å°è®¾å¤‡ä¸Šéƒ½éƒ¨ç½²åšå®¢ä¼šæ¯”è¾ƒæ··ä¹±ï¼Œæ¯”å¦‚iMacä¸Šå­˜æœ‰åšå®¢aã€bã€cï¼ŒMacBookä¸Šå­˜æœ‰dã€eã€fã€‚æ‰€ä»¥æˆ‘æƒ³åªç”¨iMacæ¥æ‰“åŒ…éƒ¨ç½²ï¼Œå¹³æ—¶å¸¦ç€ç¬”è®°æœ¬åœ¨å¤–é¢å†™å¥½äº†åšå®¢ä¹‹åï¼Œç”¨å†…ç½‘ç©¿é€æŠŠç¼–è¾‘å¥½çš„åšå®¢å‘åˆ°iMacä¸Šï¼Œç„¶ååœ¨iMacä¸Šæ‰“åŒ…éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·å°±ä¸ä¼šä¹±äº†ã€‚</p><h2 id="æ­å»ºæ­¥éª¤">æ­å»ºæ­¥éª¤</h2><p>æˆ‘ä»¬éœ€è¦ç°åœ¨githubä¸ŠæŠŠéœ€è¦çš„frpç‰ˆæœ¬ä¸‹è½½ä¸‹æ¥</p><p>æˆ‘çš„Macéƒ½æ˜¯M1ç‰ˆæœ¬çš„ï¼Œæ‰€ä»¥ä¸‹è½½<code>arm64</code>ç‰ˆæœ¬ã€‚</p><p>ä½¿ç”¨<code>uname -a</code>æŸ¥çœ‹ä½ çš„äº‘æœåŠ¡å™¨çš„æ¶æ„ï¼Œæˆ‘çš„æ˜¯<code>x86</code>ï¼Œæ‰€ä»¥ä¸‹è½½<code>amd64</code>ç‰ˆæœ¬</p><p>å¦å¤–ï¼Œæˆ‘ç”¨çš„sshå·¥å…·æ˜¯<code>Termius</code>ã€‚</p><p>macç‰ˆæœ¬ï¼š<a href="">https://github.com/fatedier/frp/releases/download/v0.39.1/frp_0.39.1_darwin_arm64.tar.gz</a></p><p>linuxç‰ˆæœ¬ï¼š<a href="">https://github.com/fatedier/frp/releases/download/v0.39.1/frp_0.39.1_linux_amd64.tar.gz</a></p><ol><li><p>æœåŠ¡å™¨ç«¯</p><p>æˆ‘ä»¬å¯ä»¥åœ¨æœ¬åœ°ä¸‹è½½å¥½æœåŠ¡å™¨ç‰ˆæœ¬çš„frpï¼Œç„¶åç”¨<code>Termius</code>çš„æ–‡ä»¶ä¼ è¾“åŠŸèƒ½æŠŠæ–‡ä»¶ä¼ é€ç»™æœåŠ¡å™¨ï¼Œè¿™æ ·æ¯”è¾ƒå¿«ã€‚</p><p>ä¼ é€åˆ°æ ¹ç›®å½•ä¸‹ï¼Œä½¿ç”¨è§£å‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf frp_0.39.1_linux_amd64.tar.gz</span><br></pre></td></tr></table></figure><p>å°†è§£å‹å‡ºæ¥çš„æ–‡ä»¶å¤¹æ”¹åé—®frpï¼Œç„¶åè¿›å…¥frp</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd frp</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿›å…¥ä¹‹åæˆ‘ä»¬éœ€è¦å¯¹frps.inié…ç½®æ–‡ä»¶åšæ›´æ”¹</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">frpc*å¼€å¤´çš„æ–‡ä»¶æˆ‘ä»¬éƒ½ä¸éœ€è¦ï¼Œå¯ä»¥åˆ æ‰</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä½ çš„éœ€æ±‚åªæ˜¯è¿œç¨‹æ“æ§è®¾å¤‡ä¼ è¾“æ–‡ä»¶çš„è¯ï¼Œé‚£ä¹ˆé‡‡ç”¨é»˜è®¤çš„é…ç½®å°±å¯ä»¥äº†ï¼Œä»€ä¹ˆéƒ½ä¸ç”¨åŠ¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim frps.ini</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">bind_port = 7000       </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">é»˜è®¤çš„å°±å¯ä»¥ï¼Œä»€ä¹ˆéƒ½ä¸ç”¨åŠ¨</span>                                             </span><br></pre></td></tr></table></figure><p><strong>è¿è¡Œfrp</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./frps</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ³¨æ„è¦åœ¨frpç›®å½•ä¸‹</span></span><br></pre></td></tr></table></figure><p><strong>å¼€å¯è‡ªå¯åŠ¨frp</strong></p><ol><li><p>æ·»åŠ systemdé…ç½®æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/lib/systemd/system/frp.service</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=The nginx HTTP and reverse proxy server</span><br><span class="line">After=network.target remote-fs.target nss-lookup.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/root/frp/frps -c /root/frp/frps.ini</span><br><span class="line">KillSignal=SIGQUIT</span><br><span class="line">TimeoutStopSec=5</span><br><span class="line">KillMode=process</span><br><span class="line">PrivateTmp=true</span><br><span class="line">StandardOutput=syslog</span><br><span class="line">StandardError=inherit</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>ExecStartçš„å†…å®¹è¯·æ ¹æ®è‡ªå·±frpå®‰è£…ç›®å½•ä¿®æ”¹ã€‚</p></li><li><p>è®¾ç½®å¼€æœºå¯åŠ¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable frp</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨frp</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start frp</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹frpæ˜¯å¦å¯åŠ¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep frps</span><br></pre></td></tr></table></figure><img src="/posts/1408599b/1079.png" class=""><p>çœ‹åˆ°å¦‚ä¸Šç»“æœï¼Œä»£è¡¨frpå¯åŠ¨æˆåŠŸ</p></li></ol></li><li><p>å®¢æˆ·ç«¯</p><p>æˆ‘ä»¬å…ˆæŠŠfrpæ–‡ä»¶ä¸‹æ”¾åœ¨ç”¨æˆ·æ ¹ç›®å½•ä¸‹ï¼Œç„¶åé…ç½®frpc.iniæ–‡ä»¶å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr = 139.224.82.218</span><br><span class="line">server_port = 7000</span><br></pre></td></tr></table></figure><p>[ssh]<br>type = tcp<br>local_ip = 127.0.0.1<br>local_port = 22<br>remote_port = 6000</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server_addræ˜¯æœåŠ¡å™¨çš„ipåœ°å€</span><br><span class="line"></span><br><span class="line">server_portæ˜¯frpåº”ç”¨å ç”¨çš„ç«¯å£</span><br><span class="line"></span><br><span class="line">æˆ‘ä½¿ç”¨macbookè®¿é—®æœåŠ¡å™¨çš„6000ç«¯å£ï¼Œfrpå°±ä¼šæŠŠè¿™ä¸ªç«¯å£æ˜ å°„æˆiMacçš„22ç«¯å£ã€‚</span><br><span class="line"></span><br><span class="line">**è®¾ç½®Macä¸Šfrpå¼€å¯å¯åŠ¨**</span><br><span class="line"></span><br><span class="line">1. ç»ˆç«¯æ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">```shell</span><br><span class="line">   sudo vim /Library/LaunchDaemons/frpc.plist</span><br></pre></td></tr></table></figure><ol start="2"><li><p>è¿½åŠ å¹¶ä¿å­˜å†…å®¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</span><br><span class="line">&lt;plist version=&quot;1.0&quot;&gt;</span><br><span class="line">&lt;dict&gt;</span><br><span class="line">    &lt;key&gt;Label&lt;/key&gt;</span><br><span class="line">    &lt;string&gt;frpc&lt;/string&gt;</span><br><span class="line">    &lt;key&gt;ProgramArguments&lt;/key&gt;</span><br><span class="line">    &lt;array&gt;</span><br><span class="line">        &lt;string&gt;/Users/jonathan/frpc/frpc&lt;/string&gt;//æ›¿æ¢ä¸ºè‡ªå·±çš„frpcæ‰§è¡Œç¨‹åºè·¯å¾„,å¹¶ç§»é™¤å½“å‰æ³¨é‡Š </span><br><span class="line">        &lt;string&gt;-c&lt;/string&gt;</span><br><span class="line">        &lt;string&gt;/Users/jonathan/frpc/frpc.ini&lt;/string&gt;//æ›¿æ¢ä¸ºè‡ªå·±çš„frpc.inié…ç½®è·¯å¾„,å¹¶ç§»é™¤å½“å‰æ³¨é‡Š </span><br><span class="line">    &lt;/array&gt;</span><br><span class="line">    &lt;key&gt;KeepAlive&lt;/key&gt;</span><br><span class="line">    &lt;true/&gt;</span><br><span class="line">    &lt;key&gt;RunAtLoad&lt;/key&gt;</span><br><span class="line">    &lt;true/&gt;</span><br><span class="line">&lt;/dict&gt;</span><br><span class="line">&lt;/plist&gt;</span><br></pre></td></tr></table></figure></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">3. åŠ å…¥å¯åŠ¨é¡¹</span><br><span class="line"></span><br><span class="line">```shell</span><br><span class="line">sudo chown root /Library/LaunchDaemons/frpc.plist</span><br><span class="line">sudo launchctl load -w /Library/LaunchDaemons/frpc.plist</span><br></pre></td></tr></table></figure><p><strong>å–æ¶ˆfrpè‡ªå¯åŠ¨</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo launchctl unload -w /Library/LaunchDaemons/frpc.plist</span><br></pre></td></tr></table></figure><ol start="3"><li>ä½¿ç”¨MacBookå†…ç½‘ç©¿é€iMac</li></ol><p>ä½¿ç”¨Termiusæ–°å»ºä¸€ä¸ªHOST</p><p>æ³¨æ„Addressè¿˜æ˜¯å¡«æœåŠ¡å™¨çš„IPï¼Œä¸è¦åŠ å†’å·å’Œç«¯å£å·</p><p>åœ¨SSHæ ä¸‹é¢çš„Portä¸­ï¼Œå°†é»˜è®¤çš„22ç«¯å£æ”¹æˆremote_portè®¾ç½®çš„å€¼</p><p>UserNameæ˜¯ä½ iMacçš„ç”¨æˆ·åï¼Œå¯†ç ä¹Ÿæ˜¯å¯¹åº”ç”¨æˆ·åçš„å¯†ç ï¼Œä¸æ˜¯äº‘æœåŠ¡å™¨çš„ï¼ï¼</p><p>å®Œç»“æ’’èŠ±ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ–‡æ¡£ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> äº‘æœåŠ¡å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
